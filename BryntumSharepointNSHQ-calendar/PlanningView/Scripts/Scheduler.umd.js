var BryntumLib;!function(){var e={67228:function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}},22858:function(e){e.exports=function(e){if(Array.isArray(e))return e}},81506:function(e){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},34575:function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},93913:function(e){function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}},16525:function(e,t,n){var r=n(58331);function i(t,n,s){return"undefined"!=typeof Reflect&&Reflect.get?e.exports=i=Reflect.get:e.exports=i=function(e,t,n){var i=r(e,t);if(i){var s=Object.getOwnPropertyDescriptor(i,t);return s.get?s.get.call(n):s.value}},i(t,n,s||t)}e.exports=i},29754:function(e){function t(n){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},t(n)}e.exports=t},2205:function(e,t,n){var r=n(99489);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}},13884:function(e){e.exports=function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,s=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw s}}return n}}},80521:function(e){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},78585:function(e,t,n){var r=n(50008),i=n(81506);e.exports=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?i(e):t}},99489:function(e){function t(n,r){return e.exports=t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t(n,r)}e.exports=t},63038:function(e,t,n){var r=n(22858),i=n(13884),s=n(60379),o=n(80521);e.exports=function(e,t){return r(e)||i(e,t)||s(e,t)||o()}},58331:function(e,t,n){var r=n(29754);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=r(e)););return e}},50008:function(e){function t(n){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=t=function(e){return typeof e}:e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(n)}e.exports=t},60379:function(e,t,n){var r=n(67228);e.exports=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}},34835:function(e,t,n){"use strict";n.r(t),n.d(t,{NTHQScheduler:function(){return oE}});var r=n(34575),i=n.n(r),s=n(93913),o=n.n(s),a=(n(66992),n(41539),n(33948),n(21249),n(57640),n(9924),n(15581),n(2490),n(34514),n(54747),n(57327),n(88449),n(59849),n(12419),n(16525)),l=n.n(a),c=n(2205),d=n.n(c),u=n(78585),h=n.n(u),g=n(29754),m=n.n(g);function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){v(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class y{static cacheFlags(e=navigator.platform,t=navigator.userAgent){const n=this;n._isLinux=Boolean(e.match(/Linux/)),n._isMac=Boolean(e.match(/Mac/)),n._isWindows=Boolean(e.match(/Win32/)),n._isWebkit=Boolean(t.match(/WebKit/)&&!t.match(/Edg/)),n._firefoxVersion=n.getVersion(t,/Firefox\/(\d+)\./),n._isFirefox=n._firefoxVersion>0,n._chromeVersion=n.getVersion(t,/Chrom(?:e|ium)\/(\d+)\./),n._isChrome=n._chromeVersion>0,n._isSafari=Boolean(t.match(/Safari/))&&!n._isChrome,n._isMobileSafari=Boolean(t.match(/Mobile.*Safari/)),n._safariVersion=n.getVersion(t,/Version\/(.*).Safari/),n._isAndroid=Boolean(t.match(/Android/g))}static get supportsOverflowClip(){if(null==this._supportsOverflowClip){const e=document.createElement("div");e.style.overflow="clip",e.style.display="none",document.documentElement.appendChild(e),this._supportsOverflowClip="clip"===e.ownerDocument.defaultView.getComputedStyle(e).getPropertyValue("overflow"),e.remove()}return this._supportsOverflowClip}static get supportsSticky(){return!0}static getVersion(e,t){const n=e.match(t);return n?parseFloat(n[1]):0}static get isTouchDevice(){return"_isTouchDevice"in this?this._isTouchDevice:globalThis.matchMedia("(pointer:coarse)").matches}static get supportsPointerEvents(){return Boolean(globalThis.PointerEvent||globalThis.MSPointerEvent)}static get supportsPointerEventConstructor(){return"undefined"!=typeof PointerEvent}static get isHoverableDevice(){return void 0===this._isHoverableDevice&&(this._isHoverableDevice=globalThis.matchMedia("(any-hover: hover)").matches),this._isHoverableDevice}static get isBrowserEnv(){return"undefined"!=typeof window}static get isMac(){return this._isMac}static get isWindows(){return this._isWindows}static get isLinux(){return this._isLinux}static get isAndroid(){return this._isAndroid}static get isWebkit(){return this._isWebkit}static get isChrome(){return this._isChrome}static get chromeVersion(){return this._chromeVersion}static get isFirefox(){return this._isFirefox}static get firefoxVersion(){return this._firefoxVersion}static get isSafari(){return this._isSafari}static get safariVersion(){return this._safariVersion}static get isMobileSafari(){return this._isMobileSafari}static get platform(){const e=this;return e._isLinux?"linux":e._isMac?"mac":e._isWindows?"windows":e._isAndroid?"android":e._isMobileSafari?"ios":null}static get supportsPassive(){return!0}static get supportsRandomUUID(){if(void 0===this._supportsRandomUUID)try{this._supportsRandomUUID=Boolean(globalThis.crypto.randomUUID().length>0)}catch(e){this._supportsRandomUUID=!1}return this._supportsRandomUUID}static get storageAvailable(){let e,t;try{return e=localStorage,t="__storage_test__",e.setItem(t,t),e.removeItem(t),!0}catch(t){return t instanceof DOMException&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&0!==e.length}}static setLocalStorageItem(e,t){this.storageAvailable&&localStorage.setItem(e,t)}static getLocalStorageItem(e){return this.storageAvailable&&localStorage.getItem(e)}static removeLocalStorageItem(e){this.storageAvailable&&localStorage.removeItem(e)}static searchParam(e,t=null,n=document.location.search){const r=new RegExp(`[?&]${e}=?([^&]*)`),i=n.match(r);return i&&i[1]||t}static getCookie(e){const t=encodeURIComponent(e)+"=",n=document.cookie.split(";");for(let e=0;e<n.length;e++){let r=n[e];for(;" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(t))return decodeURIComponent(r.substring(t.length,r.length))}return""}static download(e,t){const n=document.createElement("a");n.download=e,n.href=t||e,n.style.cssText="display:none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}static downloadBlob(e,t){const n=globalThis.URL.createObjectURL(e);this.download(t,n),globalThis.URL.revokeObjectURL(n)}static get queryString(){var e;const t=new URL(globalThis.location.href).searchParams;return null===(e=Object.fromEntries)||void 0===e?void 0:e.call(Object,t.entries())}static copyToClipboard(e){let t=!0;const n=document.createElement("textarea");n.value=e,n.style.height=n.style.width=0,document.body.appendChild(n),n.select();try{document.execCommand("copy")}catch(e){t=!1}return n.remove(),t}static isBryntumOnline(e){var t;return e=Array.isArray(e)?e:[e],Boolean(/^(www\.)?bryntum\.com/.test(globalThis.location.host)||(null===(t=e)||void 0===t?void 0:t.some((e=>null!=this.queryString[e]))))}static get isCSP(){const{bryntum:e,document:t}=globalThis;return null==e.CSP&&(e.CSP=Boolean(t.querySelector('meta[http-equiv="Content-Security-Policy"]'))),e.CSP}}let b,C,w,S;y.isBrowserEnv&&y.cacheFlags(),y._$name="BrowserHelper";const D=/([a-z])([A-Z])/g,E=/[\n\r]/g,x=/[.*+?^${}()|[\]\\]/g,R=/[&<]/,T=/(^[^a-z]+[^\w]+)/gi,M=/\s+/,k=/^[^a-z]+|[^\w:.-]+/gi,I=(e,t)=>C[t.toLowerCase()]||String.fromCharCode(parseInt(t.substr(2),10)),A=(e,t)=>b[t],F=(e,t,n)=>`${t}-${n.toLowerCase()}`,O=(e,t,n)=>`${t} ${n.toLowerCase()}`,L=e=>e?`_x${[...e].map((e=>e.charCodeAt(0).toString(16))).join("")}`:"__blank__",P={},$={};class _{static capitalize(e){return e&&e[0].toUpperCase()+e.substr(1)}static uncapitalize(e){return e&&e[0].toLowerCase()+e.substr(1)}static hyphenate(e){return P[e]||(P[e]=e.replace(D,F))}static separate(e){return $[e]||($[e]=this.capitalize(e.replace(D,O)))}static createId(e){return String(e).replace(T,L)}static makeValidDomId(e,t=""){return null==e?null:String(e).replace(k,t)}static escapeRegExp(e,t){let n=e.replace(x,"\\$&");return void 0!==t&&(n=new RegExp(n,t)),n}static decodeHtml(e){return e&&String(e).replace(S,I)}static encodeHtml(e=""){return e&&String(e).replace(w,A)}static encodeHtmlBR(e){var t;return null===(t=_.encodeHtml(e))||void 0===t?void 0:t.replace(E,"<br>")}static isHtml(e){return"string"==typeof e&&R.test(e||"")}static initHtmlEntities(e){e=e||{"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"};const t=Object.keys(e);b=e,C=t.reduce(((t,n)=>(t[e[n]]=n,t)),{}),w=new RegExp(`([${t.map((e=>"[-]".includes(e)?"\\"+e:e)).join("")}])`,"g"),S=new RegExp(`(${Object.values(e).join("|")}|&#[0-9]+;)`,"ig")}static safeJsonParse(e){let t=null;try{t=JSON.parse(e)}catch(e){}return t}static safeJsonStringify(e,t=null,n=null){let r=null;try{r=JSON.stringify(e,t,n)}catch(e){}return r}static joinPaths(e,t="/"){return e.join(t).replace(new RegExp("\\"+t+"+","g"),t)}static split(e,t=M){let n=e;return"string"==typeof n&&(n=e.trim(),n=n?n.split(t):[]),n}static xss(e,...t){const n=[];let r=t.length;for(n[r]=e[r];r-- >0;)n[r]=e[r]+_.encodeHtml(t[r]);return n.join("")}static xssBR(e,...t){const n=[];let r=t.length;for(n[r]=e[r];r-- >0;)n[r]=e[r]+_.encodeHtmlBR(t[r]);return n.join("")}static toJavaScriptValue(e,t){const n=Y.typeOf(e);if("boolean"===n||"string"===n||"number"===n||null===e)return _.safeJsonStringify(e);if(e===globalThis)return"window";if("date"===n)return`new Date(${e.getFullYear()}, ${e.getMonth()}, ${e.getDate()}, ${e.getHours()}, ${e.getMinutes()}, ${e.getSeconds()}, ${e.getMilliseconds()})`;if("array"===n)return`[${e.map((e=>_.toJavaScriptValue(e,t)))}]`;if("object"===n||"instance"===n)return this.toJavaScriptString(e,t);if("function"===n){let t=e.toString();return t.match(/^async (\w+?)\(/)?t=t.replace(/^async (\w+?)\(/,"async function("):!t.startsWith("async(")&&t.match(/^(\w+?)\(/)&&(t=t.replace(/^(\w+?)\(/,"function(")),t}return"class"===n?e.toJavaScriptValue?e.toJavaScriptValue(t):Object.prototype.hasOwnProperty.call(e,"$name")?e.$name:e.name:void 0}static toJavaScriptString(e,t={}){var n;const r=null!==(n=t.level)&&void 0!==n?n:0;return"{\n"+Object.keys(e).map((n=>" ".repeat(2*(r+1))+(n.match(/[- *]/)?`"${n}"`:n)+`: ${_.toJavaScriptValue(e[n],f(f({},t),{},{level:r+1}))}`)).join(",\n")+"\n"+" ".repeat(2*r)+"}"}static encodeAttributeSelector(e,t){return`[${e}="${String(t).replace(/["\\]/g,"\\$&")}"]`}static generateUUID(){var e;return y.supportsRandomUUID?globalThis.crypto.randomUUID():null!==(e=globalThis.crypto)&&void 0!==e&&e.getRandomValues?([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^globalThis.crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))):`${Date.now()}-${++_.fakeNodeUUIDIndex}`}}v(_,"fakeNodeUUIDIndex",0),_.initHtmlEntities(),_._$name="StringHelper";const{hasOwnProperty:N,toString:H}=Object.prototype,{isFrozen:B}=Object,j=/\s*<\s*/,V=/\s*>\s*/,z={},W={},U=Object.freeze({});class Y{static assign(e,...t){for(let n,r,i=0;i<t.length;i++)if(n=t[i],n)for(r in n)e[r]=n[r];return e}static assignIf(e,...t){for(let n,r,i=0;i<t.length;i++)if(n=t[i],n)for(r in n)r in e&&void 0!==e[r]||(e[r]=n[r]);return e}static blend(e,t,n){n=n||z,e=e||{};const{clone:r=Y.clone,merge:i=Y.blend}=n;if(Array.isArray(t)){if(t.length>1)return t.forEach((t=>{e=Y.blend(e,t,n)})),e;t=t[0]}if(t){let s,o,a;for(o in t)a=t[o],a&&Y.isObject(a)&&(s=e[o],n.key=o,s&&Y.isObject(s)?(B(s)&&(e[o]=s=r(s,n)),a=i(s,a,n)):a=B(a)?a:r(a,n)),e[o]=a}return e}static clone(e,t){let n,r=e;if(e&&"object"==typeof e)if(t&&"object"==typeof t&&t&&(t=null),Y.isObject(e))for(n in r={},e)r[n]=Y.clone(e[n]);else if(Array.isArray(e))for(r=[],n=e.length;n-- >0;)r[n]=Y.clone(e[n]);else Y.isDate(e)?r=new Date(e.getTime()):t&&(r=t(e));return r}static createTruthyKeys(e){const t=_.split(e),n=t&&{};if(t)for(const e of t)e&&(n[e]=!0);return n}static getPath(e,t){return t.split(".").reduce(((e,t)=>(e||U)[t]),e)}static getPathDefault(e,t,n){const r=Array.isArray(t)?t:"string"==typeof t?t.split("."):[t],i=r.length-1;return r.reduce(((e,t,r)=>(n&&!(t in e)&&(e[t]=r===i?n:{}),(e||U)[t])),e)}static hasPath(e,t){return t.split(".").every((t=>t in e&&(e=e[t],!0)))}static getTruthyKeys(e){const t=[];for(const n in e)e[n]&&t.push(n);return t}static getTruthyValues(e){const t=[];for(const n in e)e[n]&&t.push(e[n]);return t}static isClass(e){var t;return"function"==typeof e&&(null===(t=e.prototype)||void 0===t?void 0:t.constructor)===e}static isDate(e){return Boolean(null==e?void 0:e.getUTCDate)&&"date"===Y.typeOf(e)}static isPromise(e){if(Promise&&Promise.resolve)return Promise.resolve(e)===e||"function"==typeof(null==e?void 0:e.then);throw new Error("Promise not supported in your environment")}static isEmpty(e){if(e&&"object"==typeof e)for(const t in e)return!1;return!0}static isObject(e){const t=null==e?void 0:e.constructor;return Boolean(t?t===Object||t.getPrototypeOf&&t.prototype&&!Object.getPrototypeOf(t.prototype):e&&"object"==typeof e)}static isInstantiated(e){return!!e&&"object"==typeof e&&!Y.isObject(e)}static merge(e,...t){return Y.blend(e,t)}static mergeItems(e,t,n){let r,i,s,o,a,l,c;n=n||z;const{merge:d=Y.blend}=n;if(e=e||{},Array.isArray(t))t.forEach((t=>{e=Y.mergeItems(e,t,n)}));else if(t)for(a in t)if(c=t[a],r=null,a.includes(">")?([a,r]=a.split(V),i=0):a.includes("<")&&([r,a]=a.split(j),i=1),a in e)c&&e[a]&&d&&(n.key=a,c=d(e[a],c,n)),e[a]=c;else if(r){if(!o){o=new Map,s=0;for(const t in e)o.set(t,s++)}if(s=o.get(r),e[a]=c,null==s&&i)s=o.size;else{l=l||[],s=(s||0)+i;for(const e of o){const[t,n]=e;s<=n&&(l&&(l[o.size-n-1]=t),o.set(t,n+1))}if(l)for(;l.length;){const t=l.pop(),n=e[t];delete e[t],e[t]=n}}o.set(a,s)}else{var u;e[a]=c,null===(u=o)||void 0===u||u.set(a,o.size)}return e}static setPath(e,t,n){return t.split(".").reduce(((e,t,r,i)=>r===i.length-1?e[t]=n:(e[t]instanceof Object||(e[t]={}),e[t])),e),e}static typeOf(e){let t,n;return null===e?n="null":e!=e?n="nan":(n=typeof e,"object"===n?e.isBase?n="instance":Array.isArray(e)?n="array":(n=W[t=H.call(e)])||(W[t]=n=t.slice(8,-1).toLowerCase()):"function"===n&&e.isBase&&(n="class")),n}}Object.defineProperty(Y,"hasOwn",{value:Object.hasOwn||((e,t)=>N.call(e,t))}),Y._$name="Objects";let G=!1;try{var q;G=Boolean((null===(q=globalThis.parent)||void 0===q?void 0:q.Siesta)||"undefined"!=typeof process&&(globalThis.StartTest||globalThis.Siesta))}catch(e){}G&&(y._isHoverableDevice=!0);class K{static setVersion(e,t){e=e.toLowerCase(),X[e]={version:t,isNewerThan(e){return K.semanticCompareVersion(e,t,"<")},isOlderThan(e){return K.semanticCompareVersion(e,t,">")}};let n="";n="calendar";const r=`calendar.${e}${t.replace(/\./g,"-")}`;if(y.isBrowserEnv&&!globalThis.bryntum.silenceBundleException)if(!0===globalThis.bryntum[r]){if(!G){let e=n;"core"===e&&(e="grid");let t=_.capitalize(e);throw"schedulerpro"===e&&(t="SchedulerPro"),new Error(`The Bryntum ${t} bundle was loaded multiple times by the application.\n\nCommon reasons you are getting this error includes:\n\n* Imports point to different types of the bundle (e.g. *.module.js and *.umd.js)\n* Imports point to both sources and bundle\n* Imports do not use the shortest relative path, JS treats them as different files\n* Cache busters differ between imports, JS treats ${e}.module.js?1 and ${e}.module.js?2 as different files\n* Imports missing file type, verify they all end in .js\n\nSee https://bryntum.com/products/${e}/docs/guide/${t}/gettingstarted/es6bundle#troubleshooting for more information\n\n`)}globalThis.BUNDLE_EXCEPTION=!0}else globalThis.bryntum[r]=!0}static getVersion(e){if(e=e.toLowerCase(),!X[e])throw new Error("No version specified! Please check that you import VersionHelper correctly into the class from where you call `deprecate` function.");return X[e].version}static semanticCompareVersion(e,t,n="="){t=t||"";const r=(e=e||"").split(/[-.]/),i=t.split(/[-.]/),s=n.includes("<"),o=(e,t)=>{const n=["rc","beta","alpha"],r=e.map((e=>{if(n.includes(e))return-n.indexOf(e)-2;const t=Number.parseInt(e);return Number.isNaN(t)?-n.length:t}));for(;r.length<t;)r.push(-1);return r},a=()=>{const e=Math.max(r.length,i.length),t=o(r,e),n=o(i,e);for(let r=0;r<e;r++)if(t[r]!==n[r])return s?t[r]<n[r]:t[r]>n[r];return!0};switch(n){case"=":return e===t;case"<=":case">=":return e===t||a();case"<":case">":return e!==t&&a()}return!1}static checkVersion(e,t,n){return K.semanticCompareVersion(X.getVersion(e),t,n)}static deprecate(e,t,n){if(!X.checkVersion(e,t,"<"))throw new Error(`Deprecated API use. ${n}`);console.warn(`Deprecation warning: You are using a deprecated API which will change in v${t}. ${n}`)}static get isTestEnv(){return G}static get isDebug(){return!1}}const X=K;y.isBrowserEnv&&((globalThis.bryntum||(globalThis.bryntum={})).getVersion=X.getVersion.bind(X),globalThis.bryntum.checkVersion=X.checkVersion.bind(X),globalThis.bryntum.deprecate=X.deprecate.bind(X),globalThis.bryntum.isTestEnv=X.isTestEnv),K._$name="VersionHelper";const{defineProperty:Z,getOwnPropertyDescriptor:J}=Reflect,{hasOwnProperty:Q,toString:ee}=Object.prototype,te=Symbol("instanceProperties"),ne=Symbol("configuring"),re=Symbol("lazyConfigValues"),ie=ee.call(new Date),se=/\s+/,oe=(e,t)=>(e[t]=1,e);class ae{static get(e,t){const{cache:n}=this,r=n[e]||(n[e]=new ae(e));let i,s=r;return t&&(i=ae.makeCacheKey(e,t),(s=i&&n[i])||(s=r.extend(t),i&&(n[i]=s))),s}constructor(e){const t=this,n=e[0].toUpperCase()+e.substr(1);t.base=t,t.name=e,t.field="_"+e,t.capName=n,t.changer="change"+n,t.initializing="initializing"+n,t.updater="update"+n}get descriptor(){let e=this._descriptor;return e&&Q.call(this,"_descriptor")||(this._descriptor=e=this.makeDescriptor()),e}get initDescriptor(){let e=this._initDescriptor;return e&&Q.call(this,"_initDescriptor")||(this._initDescriptor=e=this.makeInitter()),e}equal(e,t){return e===t}extend(e){const t=Object.assign(Object.create(this),e),{equal:n,merge:r}=e,{equalityMethods:i}=ae;return"string"==typeof n&&(n.endsWith("[]")?t.equal=ae.makeArrayEquals(i[n.substr(0,n.length-2)]):t.equal=i[n]),"string"==typeof r&&(t.merge=ae.mergeMethods[r]),t}define(e){const t=J(e,this.name);let n=this.descriptor;t&&t.get&&(n=Object.assign({},n),n.get=t.get),Z(e,this.name,n)}defineInitter(e,t){const{name:n}=this,r=e[te];let i,s;r[n]||!(s=J(e,n))||"value"in s||(r[n]=s),Z(e,n,this.initDescriptor),this.lazy&&(i=e[re]||(e[re]=new Map),i.set(n,t))}static makeArrayEquals(e){return(t,n)=>{let r,i=t&&n&&t.length===(r=n.length);if(i&&Array.isArray(t)&&Array.isArray(n))if(e)for(;i&&r-- >0;)i=e(t[r],n[r]);else for(;i&&r-- >0;)i=t[r]===n[r];else i=e?e(t,n):t===n;return i}}static makeCacheKey(e,t){const n=Object.keys(t).sort();for(let e,r,i,s=n.length;s-- >0;)if(i=t[e=n[s]],null==i&&!1===i)n.splice(s,1);else{if(r=typeof i,"function"===r)return null;"string"===r?n[s]=`${e}:"${i}"`:"number"===r&&(n[s]=`${e}:${i}`)}return n.length?`${e}>${n.join("|")}`:e}makeDescriptor(){const e=this,{base:t,field:n,changer:r,updater:i,name:s}=e;return t!==e&&t.equal===e.equal?t.descriptor:{get(){var e;return null===(e=this.configObserver)||void 0===e||e.get(s,this),this[n]},set(t){const o=this;let a,l,c=o[n];if("string"==typeof t){let e=t;var d;t.startsWith("up.")?e=null===(d=o.owner)||void 0===d?void 0:d.resolveProperty(t.substr(3)):t.startsWith("this.")&&(e=o.resolveProperty(t.substr(5))),void 0!==e&&"function"!=typeof e&&(t=e)}o[r]&&(a=void 0===(l=o[r](t,c)),a||(t=l,c=o[n])),a||(e.equal===ce?c===t:e.equal(c,t))||(o[n]=t,a=!0,o[i]&&o[i](t,c)),a&&!o.onConfigChange.$nullFn&&o.onConfigChange({name:s,value:t,was:c,config:e})}}}makeInitter(){const e=this;return e!==e.base?e.lazy?e.makeLazyInitter():e.base.initDescriptor:e.makeBasicInitter()}makeBasicInitter(){const e=this,{initializing:t,name:n}=e;return{configurable:!0,get(){const r=this;return e.removeInitter(r),r[t]=!0,r[n]=r[ne][n],r[t]=!1,r.configDone[n]=!0,r[n]},set(t){e.removeInitter(this),this.configDone[n]=!0,this[n]=t}}}makeLazyInitter(){const e=this,{initializing:t,name:n}=e;return{configurable:!0,get(){const r=this,i=r[re].get(n);return e.removeInitter(r),r.isDestroying||(r[t]=!0,r[n]=i,r[t]=!1),r[n]},set(t){e.removeInitter(this),this[n]=t}}}removeInitter(e){const{name:t}=this,n=e[te][t],r=e[re];n?Z(e,t,n):delete e[t],null!=r&&r.delete(t)&&!r.size&&delete e[re]}setDefault(e,t){Z(e.prototype,this.field,{configurable:!0,writable:!0,value:t})}merge(e,t){if(t&&e&&Y.isObject(e)){if(t.isBase)return t.setConfig(e);Y.isObject(t)&&(e=Y.merge(Y.clone(t),e))}return e}}const{prototype:le}=ae,{equal:ce}=le;ae.symbols={configuring:ne,instanceProperties:te,lazyConfigs:re},ae.cache=Object.create(null),ae.equalityMethods={array:ae.makeArrayEquals(),date(e,t){return e===t||!(!e||!t||ee.call(e)!==ie||ee.call(t)!==ie)&&e.getTime()===t.getTime()},strict:ae.equal=ce},ae.mergeMethods={distinct(e,t){let n=t?t.slice():[];if(null!=e)if(Y.isObject(e))if(void 0===t)n=e;else{let t,r;for(t in e)r=n.indexOf(t),e[t]?r<0&&n.push(t):r>-1&&n.splice(r,1)}else Array.isArray(e)?e.forEach((e=>!n.includes(e)&&n.push(e))):n.includes(e)||n.push(e);return n},merge:ae.merge=le.merge,classList(e,t){if("string"==typeof e){if(!e.length)return t;e=e.split(se)}return Array.isArray(e)&&(e=e.reduce(oe,{})),ae.merge(e,t)},objects(e,t){return!0===e?t||{}:ae.merge(e,t)},replace(e){return e},items(e,t){return Y.mergeItems(t,e,{merge:(e,t)=>le.merge(t,e)})}},Object.assign(le,{_descriptor:null,_initDescriptor:null,lazy:!1,nullify:!1,render:!1}),ae._$name="Config";class de{constructor(e){e&&Object.assign(this,e)}getInherited(e,t=!0){let n=this[e];var r;return e in this||(n=null===(r=this.super)||void 0===r?void 0:r.getInherited(e,t),(n||t)&&(this[e]=n=Object.create(n||null))),n}}const{getPrototypeOf:ue}=Object,{hasOwn:he}=Y,{defineProperty:ge}=Reflect,pe=Symbol("classMetaData"),fe=Symbol("mixinTag"),ve=Symbol("originalConfig"),ye=ae.symbols.configuring,be=ae.symbols.instanceProperties,Ce=ae.symbols.lazyConfigs,we={merge:"replace",simple:!0},Se=()=>{},De=e=>new de(e),Ee={},xe=Object.freeze({}),Re=Object.freeze([]);class Te{static get isBase(){return!0}get isBase(){return!0}static get declarable(){return["declarable","configurable","defaultConfig","properties","prototypeProperties"]}constructor(...e){const t=this,n=t.constructor;t.$meta.class!==n&&n.$meta,t.construct(...e),t.afterConstruct(),t.isConstructing=!1}static new(...e){return new this(Y.merge({},...e))}construct(...e){null!==e[0]&&this.configure(...e),this.afterConfigure()}static destroy(...e){const t=e=>{null!=e&&e.destroy?e.destroy():Array.isArray(e)&&e.forEach(t)};t(e)}destroy(){const e=this,{id:t}=e;e.isDestroying=!0,e.destroy=Se,e.doDestroy(),Object.setPrototypeOf(e,null);for(const t in e)"destroy"!==t&&"isDestroying"!==t&&delete e[t];delete e[ve],e.isDestroyed=!0,e.id=t}_thisIsAUsedExpression(e){}static get $$name(){return he(this,"$name")&&this.$name||he(this,"_$name")&&this._$name||this.name}get $$name(){return this.constructor.$$name}startConfigure(e){}finishConfigure(e){}afterConfigure(){}afterConstruct(){}callback(e,t,n=Re){const{handler:r,thisObj:i}=this.resolveCallback(e,"this"===t?this:t)||xe;return null==r?void 0:r.apply(i,n)}resolveProperty(e){let t=this;for(;t;){if(Y.hasPath(t,e))return Y.getPath(t,e);t=t.owner}}resolveCallback(e,t=this,n=!0){if(e.substring){if(e.endsWith("?")&&(e=e.substring(0,e.length-1)),e.startsWith("up.")){for(e=e.substring(3),t=this.owner;t&&!t[e];t=t.owner);if(!t)return}else e.startsWith("this.")&&(e=e.substring(5),t=this);if(!(t&&t instanceof Object))return;if("function"!=typeof t[e])return;e=t[e]}return{handler:e,thisObj:t}}bindCallback(e,t=this){if(e){const{handler:n,thisObj:r}=this.resolveCallback(e,t);if(n)return n.bind(r)}}delay(e,t,n=e.name||e){return e=this.setTimeout?e:e.bind(this),(this.setTimeout?this:globalThis)["number"==typeof t?"setTimeout":"requestAnimationFrame"](e,t,n)}doDestroy(){const e=this,{nullify:t}=e.$meta;if(t)for(let n=0;n<t.length;++n)null!=e[t[n].field]&&(e[t[n].name]=null)}destroyProperties(...e){const t=this;let n,r;for(n of e){var i;!(n in t)||t[ye]&&t[ye][n]||(r=t[n],null!==(i=r)&&void 0!==i&&i.destroy&&r.destroy(),delete t[n])}}configure(e={}){const t=this,{beforeConfigure:n}=e,r=t.$meta.configs,i=t.getDefaultConfiguration();let s,o,a;for(o in t.initialConfig=e,t.isConfiguring=!0,Object.assign(t,t.getProperties()),e)a=e[o],s=r[o],i[o]=s?s.merge(a,i[o],null):a;n&&(delete i.beforeConfigure,n(t,i)),t.setConfig(t[ve]=i,!0),t.isConfiguring=!1}getConfig(e){return this[e]}setConfig(e,t){const n=this,r=n[ye],i=r?n.configDone:n.configDone={},s=n.$meta.configs;let o,a;for(a in n[be]={},n[ye]=r?Object.setPrototypeOf(Object.assign({},e),r):e,e)null!=e[a]||he(e,a)?(o=s[a]||ae.get(a),o.defineInitter(n,e[a]),t||(i[a]=!1)):i[a]=!0;for(a in t&&n.startConfigure(e),e){var l;i[a]||null!==(l=s[a])&&void 0!==l&&l.lazy||(n[a]=e[a])}return r?n[ye]=r:delete n[ye],t&&n.finishConfigure(e),n}hasConfig(e){var t;const n=this,r=n[ye];return Boolean(null!=n["_"+e]||null!=(null===(t=n[Ce])||void 0===t?void 0:t.get(e))||!n.configDone[e]&&r&&(null!=r[e]||he(r,e)))}peekConfig(e){const t=this,n=t[Ce],r=t[ye];return null!=n&&n.has(e)?n.get(e):t.configDone[e]?t[e]:null!=(null==r?void 0:r[e])||he(r,e)?r[e]:void 0}triggerConfig(e){const t=this,{configDone:n}=t,r=t[Ce],i=t[ye],s=null!=r&&r.has(e)||i&&(null!=i[e]||he(i,e))?!n[e]:null;return s&&t.getConfig(e),s}triggerConfigs(e){const t=this,n=t.$meta.configs,r=t[Ce],i=r?[...r.keys()].filter((t=>n[t].lazy===e)):Re;for(const e of i)t.triggerConfig(e);return i.length?i:null}onConfigChange(){}get config(){const e={},t=this[ve];for(const n in t)e[n]=t[n];return e}static processConfigValue(e,t){if(e===globalThis)return globalThis;if(Array.isArray(e))return e.map((e=>Te.processConfigValue(e,t)));if(e instanceof Te){if(t.visited.has(e))return;return e.getCurrentConfig(t)}if(e instanceof HTMLElement||e instanceof DocumentFragment)return null;if(Y.isObject(e)){const n={};for(const r in e)n[r]=Te.processConfigValue(e[r],t);return n}return e}getConfigValue(e,t){var n;const r=this,i=r[Ce];return null!==(n=r.$meta.configs[e])&&void 0!==n&&n.lazy?null!=i&&i.has(e)?Te.processConfigValue(i.get(e),t):void 0:Te.processConfigValue(r[e],t)}preProcessCurrentConfigs(){}getCurrentConfig(e={}){const t=this,n="all"===e.configs?t.config:Y.clone(t.initialConfig),r=e.visited||(e.visited=new Set),i=e.depth||(e.depth=0),s={};if(!r.has(t)){r.add(t),this.preProcessCurrentConfigs(n);for(const r in n){const n=t.getConfigValue(r,f(f({},e),{},{depth:i+1}));void 0!==n&&(s[r]=n)}return s}}getConfigString(e={}){return _.toJavaScriptString(this.getCurrentConfig(e))}getTestCase(e={}){const t=this.isGantt?"Gantt":this.isSchedulerPro?"SchedulerPro":this.isCalendar?"Calendar":this.isScheduler?"Scheduler":this.isGrid?"Grid":this.isTaskBoard?"TaskBoard":null;if(t){const n=t.toLowerCase(),r=`../../build/${n}.module.js`;let i,s;"static"===e.import?(i=`import * as module from "${r}";Object.assign(window, module);`,s=""):(i=`import("${r}").then(module => { Object.assign(window, module);\n`,s="});");const o=K.getVersion(n);return o&&(i+=`\nconsole.log('${t} ${o}');\n`),`${i}      \nconst ${n} = new ${t}(${this.getConfigString(e)});\n${s}`}}downloadTestCase(e={}){e.output="return";const t=this.getTestCase(e);y.download("app.js","data:application/javascript;charset=utf-8,"+escape(t))}static initClass(){return this.$meta.class}static get $meta(){const e=this;let t=e[pe];return he(e,pe)||(e[pe]=t=De(),t.class=e,e.setupClass(t)),t}static onClassMixedIn(){}static mergeConfigs(e,...t){const n=this.$meta.configs,r=Y.clone(e)||{};let i,s,o,a;for(s=0;s<t.length;++s)if(i=t[s],i)for(o in i)a=i[o],n[o]?a=n[o].merge(a,r[o]):r[o]&&a&&(a=ae.merge(a,r[o])),r[o]=a;return r}static mixin(...e){let t,n=this;for(t=0;t<e.length;++t){const r=e[t],i=r[fe]||(r[fe]=Symbol("mixinTag"));n[i]||(n=r(n),n[i]=!0,he(n,"onClassMixedIn")&&n.onClassMixedIn())}return n}static setupClass(e){var t;const n=e.class,r=ue(n).$meta,i=n.$$name,s=r.names,o=n.prototype;if(ge(o,"$meta",{value:e}),Object.assign(e,{super:r,config:Object.create(r.config),configs:Object.create(r.configs),declarables:r.declarables,forkConfigs:r.forkConfigs,hierarchy:Object.freeze([...r.hierarchy,n]),names:s.includes(i)?s:Object.freeze([...s,i]),properties:r.properties,nullify:null===(t=r.nullify)||void 0===t?void 0:t.slice()}),s!==e.names){const e=`is${i}`,t=t=>{he(t,e)||ge(t,e,{get(){return he("object"==typeof t?t.constructor:t,"$name")||console.warn(`$name static property or getter required for class ${i} to provide class name for minified sources.`+(K.isTestEnv?"":"\nhttps://bryntum.com/products/grid/docs/api/Core/widget/Widget#property-$name-static")),!0}})};t(o),t(n)}for(let t,r,i=0;i<e.declarables.length;++i)t=e.declarables[i],he(n,t)&&(r=Ee[t]||(Ee[t]=`setup${_.capitalize(t)}`),n[r](n,e))}static setupConfigs(e,t,n){const r=e.config,i=e.configs,s=e.class;let o,a,l,c,d,u,{nullify:h}=e;for(const g in t)d=t[g],n?(o=i[g])?d=o.merge(d,r[g],e):o=ae.get(g,we):(a=l=c=void 0,d&&"object"==typeof d&&"$config"in d&&(l=d.$config,l&&!Y.isObject(l)&&(l=Y.createTruthyKeys(l)),c="default"in d,a=c?d.default:a,d=d.value),(o=i[g])?(u=o.nullify,l&&(o=o.extend(l)),d=o.merge(d,r[g],e)):(o=ae.get(g,l),o.define(s.prototype),c=!(o.field in s.prototype),u=!1),c&&o.setDefault(s,a),o.nullify&&!u&&(h||(h=e.nullify||(e.nullify=[]))).push(o)),d&&(Y.isObject(d)||Array.isArray(d))&&!Object.isFrozen(d)&&(e.forkConfigs=!0),i[g]=o,r[g]=d}static setupConfigurable(e,t){e.setupConfigs(t,e.configurable,!1)}static setupDefaultConfig(e,t){e.setupConfigs(t,e.defaultConfig,!0)}static setupDeclarable(e,t){const n=e.declarable;let r,i,s=t.declarables;for(i=0;i<n.length;++i)s.includes(n[i])||(r||(t.declarables=r=s=s.slice()),s.push(n[i]))}static setupProperties(e,t){t.properties=t.super.properties.slice(),t.properties.push(e),Object.freeze(t.properties)}static setupPrototypeProperties(e){Object.assign(e.prototype,e.prototypeProperties)}getDefaultConfiguration(){return this.constructor.getDefaultConfiguration()}static getDefaultConfiguration(){const e=this.$meta,t=e.forkConfigs?Te.fork(e.config):Object.create(e.config);if(K.isTestEnv&&y.isBrowserEnv&&t.testConfig&&globalThis.__applyTestConfigs)for(const e in t.testConfig)t[e]=t.testConfig[e];return t}static fork(e){let t,n,r=e;if(e&&Y.isObject(e)&&!Object.isFrozen(e))for(t in r=Object.create(e),e)n=e[t],n&&(Y.isObject(n)?r[t]=Te.fork(n):Array.isArray(n)&&(r[t]=n.slice()));return r}getProperties(){const e=this.$meta.properties,t={};for(let n=0;n<e.length;n++)Object.assign(t,e[n].properties);return t}static get superclass(){return ue(this)}classHierarchy(e){const t=this.$meta.hierarchy,n=e?t.indexOf(e):0;return n>0?t.slice(n):t}static isOfTypeName(e){return this.$meta.names.includes(e)}detachListeners(e){var t;let n=this.$detachers;if(n=null===(t=n)||void 0===t?void 0:t[e],n)for(;n.length;)n.pop()()}trackDetacher(e,t){const n=this.$detachers||(this.$detachers={});(n[e]||(n[e]=[])).push(t)}untrackDetachers(e){const t=this.$detachers;if(t)for(const n in t){const r=t[n];for(let t=r.length;t-- >0;)r[t].eventer===e&&r.splice(t,1)}}}const Me=Te.prototype;Me.onConfigChange.$nullFn=Se.$nullFn=!0,Te[pe]=Me.$meta=De({class:Te,config:Object.freeze({}),configs:Object.create(null),declarables:Te.declarable,forkConfigs:!1,hierarchy:Object.freeze([Te]),names:Object.freeze(["Base"]),nullify:null,properties:Object.freeze([]),super:null}),Object.assign(Me,{$detachers:null,configObserver:null,isConstructing:!0,isDestroyed:!1,isDestroying:!1}),Te.emptyFn=Se,K.setVersion("core","5.2.4"),Te._$name="Base";class ke{static clean(e){return e.reduce(((e,t)=>(null==t||Array.isArray(t)&&0===t.length||""===t||e.push(t),e)),[])}static from(e,t,n){const r=[];if(e)for(const i of e)t&&!t(i)||r.push(n?n(i):i);return r}static remove(e,...t){let n,r,i=!1;for(let s=0;s<t.length;s++)r=t[s],-1!==(n=e.indexOf(r))&&(e.splice(n,1),i=!0);return i}static findInsertionIndex(e,t,n=this.lexicalCompare,r){const i=t.length;let s,o;return r<i&&(s=r>0?n(t[r-1],e):0,o=r<i-1?n(e,t[r]):0,s<1&&o<1)?r:this.binarySearch(t,e,n)}static findLast(e,t,n){for(let{length:r}=e,i=r-1;i>=0;i--)if(t.call(n,e[i],i,e))return e[i]}static binarySearch(e,t,n=0,r=e.length,i=this.lexicalCompare){const s=e.length;let o,a;for(n instanceof Function?(i=n,n=0):r instanceof Function&&(i=r,r=s),--r;n<=r;)o=n+r>>1,a=i(t,e[o]),a>=0?n=o+1:a<0&&(r=o-1);return n}magnitudeCompare(e,t){return e<t?-1:e>t?1:0}lexicalCompare(e,t){return(e=String(e))<(t=String(t))?-1:e>t?1:0}static fill(e,t={},n=null){const r=[],i=Array.isArray(t)?t:[t];for(let t=0;t<e;t++)for(const e of i){const i=Object.assign({},e);n&&n(i,t),r.push(i)}return r}static populate(e,t,n=!1){const r=[];for(let i=0;i<e;i++)r.push(t(i+(n?1:0)));return r}static include(e,...t){for(const n of t)e.includes(n)||e.push(n)}static unique(e){return[...new Set(e)]}static allowNegative(e){return new Proxy(e,{get(e,t,n){if("string"!=typeof t)return Reflect.get(e,t,n);const r=Number(t);return Number.isNaN(r)?Reflect.get(e,t,n):e[r<0?e.length+r:r]},set(e,t,n,r){if("string"!=typeof t)return Reflect.set(e,t,n,r);const i=Number(t);return Number.isNaN(i)?Reflect.set(e,t,n,r):(e[i<0?e.length+i:i]=n,!0)}})}static delta(e,t,n=!1){if(!t)return n?{toAdd:e,toRemove:[],toKeep:[]}:{onlyInA:e,onlyInB:[],inBoth:[]};const r=[],i=[],s=new Set,o=new Set(t);for(let t=0;t<e.length;t++){const n=e[t];o.has(n)?s.add(n):r.push(n)}for(let e=0;e<t.length;e++){const n=t[e];s.has(n)||i.push(n)}return n?{toAdd:r,toRemove:i,toKeep:s}:{onlyInA:r,onlyInB:i,inBoth:[...s]}}static asArray(e){return null==e?e:e instanceof Set?Array.from(e):Array.isArray(e)?e:[e]}static identity(e){return e}static keyBy(e,t,n=ke.identity){const r="string"==typeof t?e=>null==e?void 0:e[t]:t,i="string"==typeof n?e=>null==e?void 0:e[n]:n;return e.reduce(((e,t)=>(e[r(t)]=i(t),e)),{})}}ke._$name="ArrayHelper";const Ie=/,\s*/,Ae=Symbol("decompiled"),Fe=/^\s*(async\s+)?([a-z_]\w*)\s*=>([\s\S]+)$/i,Oe=/^\s*(async\s*)?\s*\(((?:[a-z_]\w*(?:, [a-z_]\w*)*)?)\)\s+=>([\s\S]+)$/i,Le=/^(\s*async)?(?:\s*function)?(?:\s*([a-z_]\w*))?\s*\(((?:[a-z_]\w*(?:, [a-z_]\w*)*)?)\)([\s\S]+)$/i,{hasOwnProperty:Pe}=Object.prototype;class $e{static after(e,t,n,r,i){const s="string"==typeof n,o=!1!==(null==i?void 0:i.return),a=(...t)=>{const i=a.$nextHook.call(e,...t),l=null!=r&&r.isDestroyed?void 0:o?s?r[n](i,...t):n.call(r,i,...t):s?r[n](...t):n.call(r,...t);return void 0===l?i:l};return $e.hookMethod(e,t,a)}static before(e,t,n,r){const i="string"==typeof n,s=(...t)=>{const o=null!=r&&r.isDestroyed?0:i?r[n](...t):n.call(r,...t);return!1===o?o:s.$nextHook.call(e,...t)};return $e.hookMethod(e,t,s)}static curry(e){return function t(...n){return n.length>=e.length?e.apply(this,n):function(...e){return t.apply(this,n.concat(e))}}}static bindAll(e){for(const t in e)"function"==typeof e[t]&&(e[t]=e[t].bind(e))}static createInterceptor(e,t,n){return(...r)=>!1!==t.call(n,...r)&&e.call(n,...r)}static createSequence(e,t,n){return(...r)=>{const i=e.call(n,...r),s=t.call(n,...r);return void 0===s?i:s}}static createThrottled(e,t,n,r,i){let s,o,a=-Number.MAX_VALUE;const l=()=>{o=0,a=performance.now(),s.push.apply(s,r),e.apply(n,s)},c=function(...e){const c=performance.now()-a;s=e,c>=t?(clearTimeout(o),l()):(o||(o=setTimeout(l,t-c)),i&&(s.push.apply(s,r),i.apply(n,s)))};return c.cancel=()=>clearTimeout(o),c}static createBuffered(e,t,n,r){let i,s;const o=()=>{s=0,a.isPending=!1,i.push.apply(i,r),e.apply(n,i)},a=function(...e){i=e,s&&clearTimeout(s),a.isPending=!0,s=setTimeout(o,t)};return a.cancel=()=>{a.isPending=!1,clearTimeout(s)},a}static decompile(e){if(!(Ae in e)){var t,n;const r=e.toString();let i,s,o,a,l,c=Fe.exec(r);c?(i=[c[2]],s=c[3]):(c=Oe.exec(r))?(l=c[2].trim(),i=l?l.split(Ie):[],s=c[3]):(c=Le.exec(r))&&(o=c[2],l=c[3].trim(),i=l?l.split(Ie):[],s=c[4]),s=null===(t=s)||void 0===t?void 0:t.trim(),e[Ae]=a=c&&{args:i,async:Boolean(c[1]),body:null!==(n=s)&&void 0!==n&&n.startsWith("{")?s.substring(1,s.length-1).trim():s},o&&(a.name=o)}return e[Ae]}static hookMethod(e,t,n){return n.$nextHook=e[t],e[t]=n,()=>{if(Pe.call(e,t)){let s,o=e[t];var r;if(o===n)(null===(r=Object.getPrototypeOf(e))||void 0===r?void 0:r[t])===n.$nextHook?delete e[t]:e[t]=n.$nextHook;else for(;s=null===(i=o)||void 0===i?void 0:i.$nextHook;o=s){var i;if(s===n){o.$nextHook=n.$nextHook;break}}}}}static noThrow(e,t,n){const r=e[t];e[t]=(...t)=>{try{return r.apply(e,t)}catch(e){return null==n?void 0:n(e)}}}static returnTrue(){return!0}static animate(e,t,n,r="linear"){let i=!1;const s=new Promise((s=>{const o=performance.now(),a=()=>{const l=Math.min((performance.now()-o)/e,1),c=n&&n.setTimeout?n:globalThis;i||!1===t.call(n,this.easingFunctions[r](l))&&s(),i||1===l?c.requestAnimationFrame((()=>s())):c.requestAnimationFrame(a)};a()}));return s.cancel=()=>(i=!0,!1),s}}const _e=.5,Ne=1.70158,He=7.5625,Be=1.525,je=2/2.75,Ve=2.25/2.75,ze=1/2.75,We=1.5/2.75,Ue=2.5/2.75,Ye=2.625/2.75,Ge=.75,qe=.9375,Ke=.984375;$e.easingFunctions={linear:e=>e,easeInQuad:e=>Math.pow(e,2),easeOutQuad:e=>-(Math.pow(e-1,2)-1),easeInOutQuad:e=>(e/=_e)<1?_e*Math.pow(e,2):-.5*((e-=2)*e-2),easeInCubic:e=>Math.pow(e,3),easeOutCubic:e=>Math.pow(e-1,3)+1,easeInOutCubic:e=>(e/=_e)<1?_e*Math.pow(e,3):_e*(Math.pow(e-2,3)+2),easeInQuart:e=>Math.pow(e,4),easeOutQuart:e=>-(Math.pow(e-1,4)-1),easeInOutQuart:e=>(e/=_e)<1?_e*Math.pow(e,4):-.5*((e-=2)*Math.pow(e,3)-2),easeInQuint:e=>Math.pow(e,5),easeOutQuint:e=>Math.pow(e-1,5)+1,easeInOutQuint:e=>(e/=_e)<1?_e*Math.pow(e,5):_e*(Math.pow(e-2,5)+2),easeInSine:e=>1-Math.cos(e*(Math.PI/2)),easeOutSine:e=>Math.sin(e*(Math.PI/2)),easeInOutSine:e=>-.5*(Math.cos(Math.PI*e)-1),easeInExpo:e=>0===e?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>0===e?0:1===e?1:(e/=_e)<1?_e*Math.pow(2,10*(e-1)):_e*(2-Math.pow(2,-10*--e)),easeInCirc:e=>-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>(e/=_e)<1?-.5*(Math.sqrt(1-e*e)-1):_e*(Math.sqrt(1-(e-=2)*e)+1),easeOutBounce:e=>e<ze?He*e*e:e<je?He*(e-=We)*e+Ge:e<Ue?He*(e-=Ve)*e+qe:He*(e-=Ye)*e+Ke,easeInBack:e=>e*e*((Ne+1)*e-Ne),easeOutBack:e=>(e-=1)*e*((Ne+1)*e+Ne)+1,easeInOutBack:e=>{let t=1.70158;return(e/=_e)<1?_e*(e*e*((1+(t*=Be))*e-t)):_e*((e-=2)*e*((1+(t*=Be))*e+t)+2)},elastic:e=>-1*Math.pow(4,-8*e)*Math.sin((6*e-1)*(2*Math.PI)/2)+1,swingFromTo:e=>{let t=1.70158;return(e/=_e)<1?_e*(e*e*((1+(t*=Be))*e-t)):_e*((e-=2)*e*((1+(t*=Be))*e+t)+2)},swingFrom:e=>e*e*((Ne+1)*e-Ne),swingTo:e=>(e-=1)*e*((Ne+1)*e+Ne)+1,bounce:e=>e<ze?He*e*e:e<je?He*(e-=We)*e+Ge:e<Ue?He*(e-=Ve)*e+qe:He*(e-=Ye)*e+Ke,bouncePast:e=>e<ze?He*e*e:e<je?2-(He*(e-=We)*e+Ge):e<Ue?2-(He*(e-=Ve)*e+qe):2-(He*(e-=Ye)*e+Ke),easeFromTo:e=>(e/=_e)<1?_e*Math.pow(e,4):-.5*((e-=2)*Math.pow(e,3)-2),easeFrom:e=>Math.pow(e,4),easeTo:e=>Math.pow(e,.25)},$e._$name="FunctionHelper";const{isArray:Xe}=Array,{hasOwnProperty:Ze}=Object.prototype,Je={thisObj:1,detachable:1,once:1,detacher:1,prio:1,args:1,expires:1,buffer:1,throttle:1,name:1},Qe=(e,t)=>t.prio-e.prio;var et,tt=e=>class t extends(e||Te){constructor(...e){super(...e),v(this,"eventsSuspended",null)}static get $name(){return"Events"}static get declarable(){return["deprecatedEvents"]}static setupDeprecatedEvents(e,t){const n=t.getInherited("deprecatedEvents"),r=e.deprecatedEvents;for(const e in r)n[e.toLowerCase()]=n[e]=r[e]}static get configurable(){return{listeners:{value:null,$config:{merge(e,t){if(null!==e){if(!e)return t;t&&(e=e?[e]:[]).push[Xe(t)?"apply":"call"](e,t)}return e}}},bubbleEvents:null}}destroy(){this.trigger("beforeDestroy"),super.destroy()}construct(e,...t){var n;(this.configuredListeners=null===(n=e)||void 0===n?void 0:n.listeners)&&delete(e=Y.assign({},e)).listeners,super.construct(e,...t),this.processConfiguredListeners()}processConfiguredListeners(){if(this.configuredListeners){const e=this,{isConfiguring:t}=e;e.isConfiguring=!1,e.listeners=e.configuredListeners,e.configuredListeners=null,e.isConfiguring=t}}doDestroy(){this.trigger("destroy"),this.removeAllListeners(),super.doDestroy()}static setupClass(e){super.setupClass(e),t.prototype.onListen.$nullFn=!0,t.prototype.onUnlisten.$nullFn=!0}addListener(e,t,n){if(Xe(e)){for(let n=0,{length:r}=e;n<r;n++)this.addListener(e[n],t);return}const r=this,i=r.$meta.getInherited("deprecatedEvents");if("string"==typeof e)return r.addListener({[e]:t,detachable:!1!==t.detachable,thisObj:n});{t=e.thisObj=void 0!==e.thisObj?e.thisObj:t;for(const n in e)if(!Je[n]&&null!=e[n]){const s=n.toLowerCase(),o=null==i?void 0:i[s],a=r.eventListeners||(r.eventListeners={}),l=e[n],c=l.expires||e.expires,d={fn:"object"==typeof l?l.fn:l,thisObj:void 0!==l.thisObj?l.thisObj:t,args:l.args||e.args,prio:void 0!==l.prio?l.prio:void 0!==e.prio?e.prio:0,once:void 0!==l.once?l.once:void 0!==e.once&&e.once,buffer:l.buffer||e.buffer,throttle:l.throttle||e.throttle,catchAll:"catchAll"===n};if(o){const{product:e,invalidAsOfVersion:t,message:n}=o;K.deprecate(e,t,n)}if(c){const{alt:i}=c,o=i?c.delay:c,a=e.name||n,l=()=>{r.un(s,d),i&&!d.called&&r.callback(i,t)};r.isDelayable?r.setTimeout({fn:l,name:a,cancelOutstanding:!0,delay:o}):globalThis.setTimeout(l,o)}let u=a[s]||(a[s]=[]);u.$firing&&(a[s]=u=u.slice()),u.splice(ke.findInsertionIndex(d,u,Qe,u.length),0,d),!r.onListen.$nullFn&&u.length<2&&r.onListen(s)}e.relayAll&&r.relayAll(e.relayAll),t&&t!==r&&r.attachAutoDetacher(e,t);const n=!1!==e.detachable,o=e.name,a=e.expires||n||o?()=>{r.isDestroyed||r.removeListener(e,t)}:null;var s;if(a&&(a.eventer=r,a.listenerName=o,o&&null!==(s=t)&&void 0!==s&&s.trackDetacher&&t.trackDetacher(o,a),e.expires&&r.delay(a,isNaN(e.expires)?e.expires.delay:e.expires,o),n))return a}}on(...e){return this.addListener(...e)}un(...e){this.removeListener(...e)}get listeners(){return this.eventListeners}changeListeners(e){if(!this.isConfiguring){if(Array.isArray(e))for(let t=0,n=e[0],{length:r}=e;t<r;n=e[++t])"thisObj"in n||(e[t]=Y.assign({thisObj:this},n));else e&&!("thisObj"in e)&&(e=Y.assign({thisObj:this},e));return e}e&&this.on(e,this)}updateListeners(e,t){t&&this.un(t),e&&this.on(e)}removeListener(e,t=e.thisObj,n){const r=this;if("string"==typeof e)return r.removeListener({[e]:t},n);Object.entries(e).forEach((([e,n])=>{if(!Je[e]&&null!=n){e=e.toLowerCase();const i=r.eventListeners,s=r.findListener(e,n,t);if(s>=0){let t=i[e];t.length>1?(t.$firing&&(i[e]=t=t.slice()),t.splice(s,1)):(delete i[e],r.onUnlisten.$nullFn||r.onUnlisten(e))}}})),e.thisObj&&!e.thisObj.isDestroyed&&r.detachAutoDetacher(e)}findListener(e,t,n){var r;const i=null===(r=this.eventListeners)||void 0===r?void 0:r[e],s=t.fn||t,o=t.thisObj||n;if(i)for(let e,t=0,{length:n}=i;t<n;t++)if(e=i[t],e.fn===s&&e.thisObj===o)return t;return-1}hasListener(e){var t;return Boolean(null===(t=this.eventListeners)||void 0===t?void 0:t[null==e?void 0:e.toLowerCase()])}relayAll(e,t,n=!0){this.relayAllTargets||(this.relayAllTargets=[]);const r=this.relayAllTargets;e.on("beforeDestroy",(({source:t})=>{t===e&&r.filter((t=>t.through===e)).forEach((e=>ke.remove(r,e)))})),r.push({through:e,prefix:t,transformCase:n})}removeAllListeners(){const e=this.eventListeners;let t,n;for(const i in e){const s=e[i];for(t=s.length;t-- >0;){var r;const e=s[t];this.removeListener(i,e),n=e.thisObj,null!==(r=n)&&void 0!==r&&r.untrackDetachers&&n.untrackDetachers(this)}}}relayEvents(e,t,n=""){const r={detachable:!0,thisObj:this};return t.forEach((e=>{r[e]=(t,...r)=>this.trigger(n+e,t,...r)})),e.on(r)}onListen(){}onUnlisten(){}destructorInterceptor(){const{autoDetachers:e,target:t,oldDestructor:n}=this;for(let n=0;n<e.length;n++){const{dispatcher:r,config:i}=e[n];r.isDestroyed||r.removeListener(i,t)}n.call(t)}attachAutoDetacher(e,t){const n=e.thisObj||t,r="doDestroy"in n?"doDestroy":"destroy";if(r in n){let{$autoDetachers:t}=n;t||(n.$autoDetachers=t=[]),n.$oldDestructor||(n.$oldDestructor=n[r],n[r]=this.destructorInterceptor.bind({autoDetachers:t,oldDestructor:n.$oldDestructor,target:n})),t.push({config:e,dispatcher:this})}else n[r]=()=>{this.removeListener(e)}}detachAutoDetacher(e){const t=e.thisObj;t.$oldDestructor&&!t.isDestroying&&(ke.remove(t.$autoDetachers,t.$autoDetachers.find((t=>t.config===e&&t.dispatcher===this))),t.$autoDetachers.length||(t["doDestroy"in t?"doDestroy":"destroy"]=t.$oldDestructor,t.$oldDestructor=null))}await(e,t={checkLog:!0,resetLog:!0,args:null}){const n=this;!1===t&&(t={checkLog:!1});const{args:r}=t;return new Promise((i=>{var s;if(t.checkLog&&null!==(s=n._triggered)&&void 0!==s&&s[e]&&(i(),t.resetLog&&n.clearLog(e)),r){const s=n.on({[e]:(...o)=>{Object.keys(r).every((e=>e in o[0]&&o[0][e]===r[e]))&&(i(...o),t.resetLog&&n.clearLog(e),s())},prio:-1e4})}else n.on({[e]:(...r)=>{i(...r),t.resetLog&&n.clearLog(e)},prio:-1e4,once:!0})}))}clearLog(e){this._triggered&&(e?delete this._triggered[e]:this._triggered={})}trigger(e,t){var n,r,i,s;const o=this,a=e.toLowerCase(),{eventsSuspended:l,relayAllTargets:c,callOnFunctions:d}=o;let u,h=null===(n=o.eventListeners)||void 0===n?void 0:n[a];if(o._triggered||(o._triggered={}),o._triggered[e]=!0,l)return l.shouldQueue&&l.queue.push(arguments),!0;if(null!==(r=o.eventListeners)&&void 0!==r&&r.catchall&&((h=h?h.slice():[]).push(...o.eventListeners.catchall),h.sort(Qe)),!h&&!c&&!d)return!0;if(t?"source"in t||(Object.isExtensible(t)?t.source=o:t=Object.setPrototypeOf({source:o},t)):t={source:o},t.type!==a&&(t.constructor!==Object?Reflect.defineProperty(t,"type",{get:()=>a}):t.type=a),!("bubbles"in t)&&null!==(i=o.bubbleEvents)&&void 0!==i&&i[e]&&(t.bubbles=o.bubbleEvents[e]),d){const n="on"+_.capitalize(e);if(n in o){var g;const e=!o[n]||o.callback(o[n],o,[t]);let r;if(Y.isPromise(e)?(u||(u=[])).push(e):r=!1===e||r,!o.isDestroyed&&Ze.call(o,n)&&(null===(g=o.pluginFunctionChain)||void 0===g||!g[n])){const e=Object.getPrototypeOf(o);if(n in e){const i=e[n].call(o,t);if(Y.isPromise(i)?(u||(u=[])).push(i):r=!1===i||r,o.isDestroyed)return}}if(r)return!1}}if(h){let e,n=0;for(h.$firing=!0;n<h.length&&!o.isDestroyed&&!1!==e;n++){const r=h[n];let i,s=r.thisObj;if(!s||!s.isDestroyed){if(r.called=!0,r.once&&o.removeListener(a,r),"string"==typeof r.fn){if(s&&(i=s[r.fn]),!i){const e=o.resolveCallback(r.fn);i=e.handler,s=e.thisObj}}else i=r.fn;if(r.buffer){if(!r.bufferFn){const e=Number(r.buffer);if("number"!=typeof e||isNaN(e))throw new Error(`Incorrect type for buffer, got "${e}" (expected a Number)`);r.bufferFn=$e.createBuffered(i,e,s,r.args)}i=r.bufferFn}if(r.throttle){const e=Number(r.throttle);if("number"!=typeof e||isNaN(e))throw new Error(`Incorrect type for throttle, got "${e}" (expected a Number)`);r.throttledFn||(r.throttledFn=$e.createThrottled(i,e,s,r.args)),i=r.throttledFn}e=i.call(s||o,...r.args||[],t),Y.isPromise(e)&&(u||(u=[])).push(e)}}if(h.$firing=!1,!1===e)return e}return c&&c.forEach((n=>{let r=e;if(n.transformCase&&(r=_.capitalize(r)),n.prefix&&(r=n.prefix+r),!1===n.through.trigger(r,t))return!1})),t.bubbles&&o.owner&&!o.owner.isDestroyed?o.owner.trigger(e,t):null===(s=u)||void 0===s||!s.length||new Promise((e=>{Promise.all(u).then((t=>{const n=!t.some((e=>!1===e));e(n)}))}))}suspendEvents(e=!1){(this.eventsSuspended||(this.eventsSuspended={shouldQueue:e,queue:[],count:0})).count++}resumeEvents(){const e=this.eventsSuspended;if(e&&0==--e.count&&(this.eventsSuspended=null,e.shouldQueue))for(const t of e.queue)this.trigger(...t);return!Boolean(this.eventsSuspended)}};class nt{static animationFrame(){return new Promise((e=>{requestAnimationFrame(e)}))}static sleep(e){return new Promise((t=>{setTimeout((()=>{t()}),e)}))}static yield(){return Promise.resolve()}}nt._$name="AsyncHelper";const rt=/^(\w+)=(.*)$/,it=globalThis.DocsBrowserInstance&&(null===(et=y.queryString)||void 0===et?void 0:et.__resourceRoot)||"";class st{static get(e,t){return this.fetch(e,t)}static post(e,t,n={}){return t instanceof FormData||"string"==typeof t||(t=JSON.stringify(t),n.headers=n.headers||{},n.headers["Content-Type"]=n.headers["Content-Type"]||"application/json"),this.fetch(e,Object.assign({method:"POST",body:t},n))}static fetch(e,t={}){let n;if("undefined"!=typeof AbortController&&(n=t.abortController=new AbortController,t.signal=n.signal),"credentials"in t||(t.credentials="include"),t.queryParams){const n=Object.entries(t.queryParams);n.length&&(e+=(e.includes("?")?"&":"?")+n.map((([e,t])=>`${e}=${encodeURIComponent(t)}`)).join("&"))}const r=new Promise(((n,i)=>{fetch(it+e,t).then((e=>{t.parseJson?e.json().then((t=>{e.parsedJson=t,n(e)})).catch((t=>{e.parsedJson=null,e.error=t,i(e)})):n(e)})).catch((e=>{e.stack=r.stack,i(e)}))}));return r.stack=(new Error).stack,r.abort=function(){var e;null===(e=n)||void 0===e||e.abort()},r}static mockUrl(e,t){const n=this;(n.mockAjaxMap||(n.mockAjaxMap={}))[e]=t,st.originalFetch||(st.originalFetch=st.fetch,st.fetch=n.mockAjaxFetch.bind(n))}static mockAjaxFetch(e,t){const n=e.split("?");let r=this.mockAjaxMap[n[0]],i=null;if(r){"function"==typeof r&&(r=r(n[0],n[1]&&function(e){const t={},n=e.split("&");for(const e of n){const[n,r,i]=rt.exec(e),s=decodeURIComponent(r),o=decodeURIComponent(i);if(n){let e=t[s];e?(Array.isArray(e)||(e=t[s]=[e]),e.push(o)):t[s]=o}}return t}(n[1]),t));try{i=t.parseJson&&JSON.parse(r.responseText)}catch(e){i=null,r.error=e}return r=Object.assign({status:200,ok:!0,headers:new Headers,statusText:"OK",url:e,parsedJson:i,text:()=>new Promise((e=>{e(r.responseText)})),json:()=>new Promise((e=>{e(i)}))},r),new Promise((function(e,t){r.synchronous?e(r):setTimeout((function(){e(r)}),"delay"in r?r.delay:100)}))}return st.originalFetch(e,t)}}st._$name="AjaxHelper";class ot{static mergeLocales(...e){const t={};return e.forEach((e=>{Object.keys(e).forEach((n=>{"object"==typeof e[n]?t[n]=f(f({},t[n]),e[n]):t[n]=e[n]}))})),t}static trimLocale(e,t,n=!0){const r=(t,n)=>{e[t]&&(n?e[t][n]&&delete e[t][n]:delete e[t])};Object.keys(t).forEach((e=>{Object.keys(t[e]).length>0?Object.keys(t[e]).forEach((t=>r(e,t))):r(e)}))}static publishLocale(e,t){const n=globalThis.bryntum=globalThis.bryntum||{},r=n.locales=n.locales||{};r[e]=r[e]?this.mergeLocales(r[e],t):t}}ot._$name="LocaleHelper";class at extends(tt(Te)){static get defaultConfig(){return{locales:{},throwOnMissingLocale:K.isTestEnv}}construct(...e){const t=this;if(super.construct(...e),y.isBrowserEnv){const e=document.querySelector("script[data-default-locale]"),{locales:n}=globalThis.bryntum||{};e&&(t.defaultLocaleName=e.dataset.defaultLocale),n&&(Object.keys(n).forEach((e=>{if(!e.startsWith("moment")){const r=n[e];r.extends?t.extendLocale(r.extends,r):r.localeName&&t.registerLocale(r.localeName,{desc:r.localeDesc,locale:r})}})),t.locale||"En"!==t.defaultLocaleName&&t.applyLocale(t.defaultLocaleName||Object.keys(t.locales)[0]))}}set locales(e){this._locales=e}get locales(){return this._locales}set locale(e){"string"==typeof e?this.applyLocale(e):(e.locale||(e={locale:e,localeName:e.localeName||"custom"}),this.registerLocale(e.localeName,e),this.applyLocale(e.localeName))}get locale(){return this._locale}registerLocale(e,t){var n;const r=this,i=r.defaultLocaleName===e,s=(null===(n=r.locale)||void 0===n?void 0:n.localeName)===e,o=0===Object.keys(r.locales).length;let a=r.locales[e];a?(t.exclude&&(a.exclude=ot.mergeLocales(a.exclude||{},t.exclude)),a.locale=ot.mergeLocales(a.locale,t.locale)):(r.locales[e]=t,a=r.locales[e]),a.exclude&&ot.trimLocale(a.locale,a.exclude),(i||!r.defaultLocaleName&&(o||s))&&r.internalApplyLocale(a)}extendLocale(e,t){var n;const r=this.locales[e];return!!r&&(r.locale=ot.mergeLocales(r.locale,t),delete r.locale.extends,(null===(n=this.locale)||void 0===n?void 0:n.localeName)===e&&this.applyLocale(e),!0)}internalApplyLocale(e){this._locale=e.locale,this.trigger("locale",e)}applyLocale(e,t=!1,n=!1){const r=this,i=r.locales[e];if(null!=i&&i.locale&&r._locale===i.locale&&!t)return!0;if(!i){if(n)return!0;throw new Error(`Locale ${e} not registered`)}function s(){r.internalApplyLocale(i)}return i.locale?(s(),!0):new Promise(((t,n)=>{r.loadLocale(i.path).then((n=>{n.text().then((n=>{new Function(n)(),y.isBrowserEnv&&(i.locale=globalThis.bryntum.locales[e]),s(),t(i)}))})).catch((e=>n(e)))}))}loadLocale(e){return st.get(e)}set throwOnMissingLocale(e){this._throwOnMissingLocale=e}get throwOnMissingLocale(){return this._throwOnMissingLocale}}const lt=new at,ct=Object.getPrototypeOf(Object),dt=/L{.*?}/g,ut=/L{(.*?)}/g,ht=/((.*?)\.)?(.+)/g,gt=e=>e.replace(/\[\[(\d+)]]/gm,"{$1}"),mt=Object.freeze(Object.create(null));var pt=e=>class t extends(e||Te){static get $name(){return"Localizable"}static get configurable(){return{localeClass:null,localizable:null,localizableProperties:{value:[],$config:{merge:"distinct"}}}}static clsName(e){var t,n;return"string"==typeof e?e:e===ct?"Object":e.$$name||e.name||(null===(t=e.prototype)||void 0===t?void 0:t.$$name)||(null===(n=e.prototype)||void 0===n?void 0:n.name)}static parseLocaleString(e){var t;const n=[];let r;if(null!==(t=e)&&void 0!==t&&t.includes("L{"))for(e=e.replace(/{(\d+)}/gm,"[[$1]]"),ut.lastIndex=0;null!=(r=ut.exec(e));){ht.lastIndex=0;const e=ht.exec(r[1]);n.push({match:gt(r[0]),localeKey:gt(e[3]),localeClass:e[2]})}return n.length>0?n:[{match:e,localeKey:e,localeClass:void 0}]}construct(e={},...t){super.construct(e,...t),lt.on("locale",this.updateLocalization,this),this.updateLocalization()}get localeClass(){return this._localeClass||null}localizeProperty(e){var n,r,i;const s=this,o=Y.getPath(s,e),a=(null===(n=s.$meta.configs[e])||void 0===n?void 0:n.localeKey)||(null===(r=s.fieldMap)||void 0===r||null===(i=r[e])||void 0===i?void 0:i.defaultValue);let l;return a?(l=t.localize(a,s,s.localeClass||s),l&&!(e in(s.initialConfig||mt))&&Y.setPath(s.isColumn?s.data:s,e,l)):"string"==typeof o&&(s.originalLocales=s.originalLocales||{},l=Y.getPath(s.originalLocales,e),void 0===l&&(Y.setPath(s.originalLocales,e,o),l=o),l&&Y.setPath(s,e,l=s.optionalL(l,s))),l||o}updateLocalization(){var e,t;!1!==this.localizable&&(null===(e=this.localizableProperties)||void 0===e||e.forEach(this.localizeProperty,this),null===(t=this.trigger)||void 0===t||t.call(this,"localized"))}static getTranslation(e,n,r){const{locale:i}=lt;let s,o,a=null;if(i)for(const{match:l,localeKey:c,localeClass:d}of this.parseLocaleString(e)){const u=t=>{var s;const o=null===(s=i[t])||void 0===s?void 0:s[c];return o&&(a="function"==typeof o?null!=n?o(n):o:"object"==typeof o||e===l?o:(a||e).replace(l,o),"string"==typeof o&&o.includes("L{")&&(a=this.getTranslation(o,n,r))),o};let h=!1;for(o=r;o&&(s=t.clsName(o))&&!(h=u(s))&&"string"!=typeof o;o=Object.getPrototypeOf(o));!h&&d&&u(d)}return a}static localize(e,n,...r){var i;0===(null===(i=r)||void 0===i?void 0:i.length)&&(r=[this]);let s=null;return r.some((r=>(s=t.getTranslation(e,n,r),null!=s))),s}static L(e,n,...r){var i;0===(null===(i=r)||void 0===i?void 0:i.length)&&(r=[this]);const s=this.localize(e,n,...r);if(null==s&&lt.throwOnMissingLocale&&lt.locale&&e.includes("L{"))throw new Error(`Localization is not found for '${e}' in '${r.map((e=>t.clsName(e))).join(", ")}'. ${lt.locale.localeName?`Locale : ${lt.locale.localeName}`:""}`);return null!=s?s:e}L(e,n){const{localeClass:r,constructor:i}=this;return r&&t.clsName(r)!==t.clsName(i)?t.L(e,n,r,i):t.L(e,n,i)}static optionalL(e,n,...r){var i;const s=lt.throwOnMissingLocale;lt.throwOnMissingLocale=s&&dt.test(e),0===(null===(i=r)||void 0===i?void 0:i.length)&&(r=[this]);const o=t.L(e,n,...r);return lt.throwOnMissingLocale=s,o}optionalL(e,t=this,n=!1){const r=lt.throwOnMissingLocale;lt.throwOnMissingLocale=r&&dt.test(e)&&!n;const i=this.L(e,t);return lt.throwOnMissingLocale=r,i}get localeManager(){return lt}};const{toString:ft}=Object.prototype,vt=ft.call(new Date),yt=new Date,bt=36e5,Ct=(e,t)=>isNaN(e)||null==e?t:e,wt=/([ES]){([^}]+)}/g,St=e=>{let t="th";return["11","12","13"].find((t=>e.endsWith(t)))||(t={1:"st",2:"nd",3:"rd"}[e[e.length-1]]||"th"),e+t},Dt=(e,t,n)=>(At[e]||(At[e]=new Intl.DateTimeFormat(Mt,t))).format(n),Et=(e,t,n,r=!1)=>{let i=Dt(e,t,n);return/am|pm/i.test(i)&&(i=i.replace(/^0/,""),r&&(i=i.replace(/:00/,""))),i},xt=e=>e>=0?e:e+7,Rt=/([^\w])(S+)/gm,Tt=(e,t,n)=>t+"SSS";let Mt="en-US",kt=St,It={},At={},Ft={};const Ot={M:e=>e.getMonth()+1,Mo:e=>kt(Ot.M(e).toString()),MM:e=>(e.getMonth()+1).toString().padStart(2,"0"),MMM:e=>Dt("MMM",{month:"short"},e),MMMM:e=>Dt("MMMM",{month:"long"},e),Q:e=>Math.ceil((e.getMonth()+1)/3),Qo:e=>kt(Ot.Q(e).toString()),D:e=>e.getDate(),Do:e=>kt(Ot.D(e).toString()),DD:e=>e.getDate().toString().padStart(2,"0"),DDD:e=>Math.ceil((new Date(e.getFullYear(),e.getMonth(),e.getDate(),12,0,0)-new Date(e.getFullYear(),0,0,12,0,0))/jt.day.millisecond),DDDo:e=>kt(Ot.DDD(e).toString()),DDDD:e=>Ot.DDD(e).toString().padStart(3,"0"),d:e=>e.getDay(),do:e=>kt(e.getDay().toString()),d1:e=>Dt("d1",{weekday:"narrow"},e).substr(0,1),dd:e=>Ot.ddd(e).substring(0,2),ddd:e=>Dt("ddd",{weekday:"short"},e),dddd:e=>Dt("dddd",{weekday:"long"},e),e:e=>e.getDay(),E:e=>e.getDay()+1,W:e=>en.getWeekNumber(e)[1],Wo:e=>kt(Ot.W(e).toString()),WW:e=>Ot.W(e).toString().padStart(2,"0"),Wp:e=>`${en.localize("L{Week}")} ${Ot.W(e)}`,WWp:e=>`${en.localize("L{Week}")} ${Ot.WW(e)}`,Wp0:e=>`${en.localize("L{Week}")[0]}${Ot.W(e)}`,WWp0:e=>`${en.localize("L{Week}")[0]}${Ot.WW(e)}`,Y:e=>e.getFullYear(),YY:e=>e.getFullYear()%100,YYYY:e=>e.getFullYear(),A:e=>e.getHours()<12?"AM":"PM",a:e=>e.getHours()<12?"am":"pm",H:e=>e.getHours(),HH:e=>e.getHours().toString().padStart(2,"0"),h:e=>e.getHours()%12||12,hh:e=>Ot.h(e).toString().padStart(2,"0"),k:e=>e.getHours()||24,kk:e=>Ot.k(e).toString().padStart(2,"0"),K:e=>Et("K",{hour:"numeric"},e),KK:e=>Et("KK",{hour:"2-digit"},e),m:e=>e.getMinutes(),mm:e=>Ot.m(e).toString().padStart(2,"0"),s:e=>e.getSeconds(),ss:e=>Ot.s(e).toString().padStart(2,"0"),S:e=>Math.floor(e.getMilliseconds()/100).toString(),SS:e=>Math.floor(e.getMilliseconds()/10).toString().padStart(2,"0"),SSS:e=>e.getMilliseconds().toString().padStart(3,"0"),z:e=>Dt("z",{timeZoneName:"short"},e),zz:e=>Dt("zz",{timeZoneName:"long"},e),Z:e=>tn.getGMTOffset(e),LT:e=>Et("LT",{hour:"2-digit",minute:"2-digit"},e),LST:e=>Et("LST",{hour:"numeric",minute:"2-digit"},e,!0),LTS:e=>Et("LTS",{hour:"2-digit",minute:"2-digit",second:"2-digit"},e),L:e=>Dt("L",{year:"numeric",month:"2-digit",day:"2-digit"},e),l:e=>Dt("l",{year:"numeric",month:"numeric",day:"numeric"},e),LL:e=>Dt("LL",{year:"numeric",month:"long",day:"numeric"},e),ll:e=>Dt("ll",{year:"numeric",month:"short",day:"numeric"},e),LLL:e=>Dt("LLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit"},e),lll:e=>Dt("lll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"},e),LLLL:e=>Dt("LLLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"long"},e),llll:e=>Dt("llll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"short"},e)},Lt=`^(?:${Object.keys(Ot).sort(((e,t)=>t.length-e.length)).join("|")})`,Pt=()=>({}),$t=e=>(e=>Kt.test(e))(e)&&{milliseconds:parseInt(e.padEnd(3,"0").substring(0,3))},_t={YYYY:e=>({year:parseInt(e)}),Y:e=>({year:parseInt(e)}),YY:e=>{const t=parseInt(e);return{year:t+(t>1968?1900:2e3)}},MM:e=>({month:parseInt(e)-1}),Mo:e=>({month:parseInt(e)-1}),DD:e=>({date:parseInt(e)}),M:e=>({month:parseInt(e)-1}),D:e=>({date:parseInt(e)}),Do:e=>({date:parseInt(e)}),DDD:Pt,MMM:Pt,MMMM:Pt,DDDo:Pt,DDDD:Pt,d:Pt,do:Pt,d1:Pt,dd:Pt,ddd:Pt,dddd:Pt,Q:Pt,Qo:Pt,W:Pt,Wo:Pt,WW:Pt,e:Pt,E:Pt,HH:e=>({hours:parseInt(e)}),hh:e=>({hours:parseInt(e)}),mm:e=>({minutes:parseInt(e)}),H:e=>({hours:parseInt(e)}),m:e=>({minutes:parseInt(e)}),ss:e=>({seconds:parseInt(e)}),s:e=>({seconds:parseInt(e)}),S:$t,SS:$t,SSS:$t,A:e=>({amPm:e.toLowerCase()}),a:e=>({amPm:e.toLowerCase()}),L:"MM/DD/YYYY",LT:"HH:mm A",LTS:"HH:mm:ss A",Z:e=>{if(!e||!Xt.test(e)&&"Z"!==e)return null;let t=0;if("Z"!==e){const n=Xt.exec(e);t=n?("+"===n[1]?1:-1)*(60*(parseInt(n[2])||0)+(parseInt(n[3])||0)):-1*(new Date).getTimezoneOffset()}return{timeZone:t}}},Nt=Object.keys(_t).sort(((e,t)=>t.length-e.length)),Ht=new RegExp(`(${Nt.join("|")})`),Bt=new RegExp("(l|LL|ll|LLL|lll|LLLL|llll)"),jt={decade:{decade:1,year:10,quarter:40,month:120,week:520,day:3652,hour:87648,minute:5258880,second:315532800,millisecond:3155328e5},year:{decade:.1,year:1,quarter:4,month:12,week:52,day:365,hour:8760,minute:525600,second:31536e3,millisecond:31536e6},quarter:{decade:1/40,year:1/4,quarter:1,month:3,week:4,day:91,hour:2184,minute:131040,second:7862400,millisecond:78624e5},month:{decade:1/120,year:1/12,quarter:1/3,month:1,week:4,day:-30,hour:-720,minute:-43200,second:-2592e3,millisecond:-2592e6},week:{decade:-1/520,year:-1/52,quarter:-1/13,month:-1/4,day:7,hour:168,minute:10080,second:604800,millisecond:6048e5},day:{decade:-1/3652,year:-1/365,quarter:-1/91,month:-1/30,week:1/7,hour:24,minute:1440,second:86400,millisecond:864e5},hour:{decade:-1/87648,year:-1/8760,quarter:-1/2184,month:-1/720,week:1/168,day:1/24,minute:60,second:3600,millisecond:36e5},minute:{decade:-1/5258880,year:-1/525600,quarter:-1/131040,month:-1/43200,week:1/10080,day:1/1440,hour:1/60,second:60,millisecond:6e4},second:{decade:-1/315532800,year:-1/31536e3,quarter:-1/7862400,month:-1/2592e3,week:1/604800,day:1/86400,hour:1/3600,minute:1/60,millisecond:1e3},millisecond:{decade:-1/3155328e5,year:-1/31536e6,quarter:-1/78624e5,month:-1/2592e6,week:1/6048e5,day:1/864e5,hour:1/36e5,minute:1/6e4,second:.001}},Vt={ms:"millisecond",milliseconds:"millisecond",s:"second",seconds:"second",m:"minute",mi:"minute",min:"minute",minutes:"minute",h:"hour",hours:"hour",d:"day",days:"day",w:"week",weeks:"week",M:"month",mo:"month",mon:"month",months:"month",q:"quarter",quarters:"quarter",y:"year",years:"year",dec:"decade",decades:"decade"},zt=/^\s*([-+]?\d+(?:[.,]\d*)?|[-+]?(?:[.,]\d+))\s*([^\s]+)?/i,Wt=/^\s*([-+]?\d+)(?![.,])\s*([^\s]+)?/i,Ut=["millisecond","second","minute","hour","day","week","month","quarter","year","decade"],Yt=[["mil"],["s","sec"],["m","min"],["h","hr"],["d"],["w","wk"],["mo","mon","mnt"],["q","quar","qrt"],["y","yr"],["dec"]],Gt=["decade","year","month","week","day","hour","minute","second","millisecond"],qt=["milliseconds","seconds","minutes","hours","date","month","year"],Kt=/^[0-9]+$/,Xt=/([+-])(\d\d):*(\d\d)*$/,Zt={millisecond:0,second:1,minute:2,hour:3,day:4,week:5,month:6,quarter:7,year:8,decade:9},Jt={round(e,t=1){return Math.round(e/t)*t},floor(e,t=1){return Math.floor(e/t)*t},ceil(e,t=1){return Math.ceil(e/t)*t}},Qt={};class en extends(pt()){static get $name(){return"DateHelper"}static set defaultFormat(e){tn._defaultFormat=e}static get defaultFormat(){return tn._defaultFormat||"YYYY-MM-DDTHH:mm:ssZ"}static set defaultParseFormat(e){this._defaultParseFormat=e}static get defaultParseFormat(){return this._defaultParseFormat||this._defaultFormat||"YYYY-MM-DDTHH:mm:ss.SSSZ"}static buildParser(e){const t=e.split(Ht),n=[];return 1===t.length||Bt.test(e)?[]:(t.reduce(((t,r,i,s)=>{if(0!==i||""!==r)if(Ht.test(r)){const o=(this.localize("L{parsers}")||{})[r]||_t[r];if("Z"===r&&i<s.length-2)throw new Error(`Invalid format ${e} TimeZone (Z) must be last token`);if("string"==typeof o){const e=tn.buildParser(o),r=e.pop();delete r.last,n.push(...e),t=r}else t.pattern=r,t.fn=_t[r]}else t.splitter=r,n.push(t),t={};else Object.prototype.hasOwnProperty.call(t,"pattern")&&n.push(t);return t}),{}),n[n.length-1].last=!0,n)}static makeKey(e){if(10===e.length)return e;e.getTime&&(e=e.getTime());const t=Qt[Math.trunc(e/bt)];if(t)return t;yt.setTime(e);const n=yt.getMonth()+1,r=yt.getDate();return Qt[Math.trunc(e/bt)]=`${yt.getFullYear()}-${n<10?"0"+n:n}-${r<10?"0"+r:r}`}static parseKey(e){return tn.parse(e,"YYYY-MM-DD")}static parse(e,t=tn.defaultParseFormat){if(e instanceof Date)return e;if("string"!=typeof e||!e)return null;const n={year:null,month:null,date:null,hours:null,minutes:null,seconds:null,milliseconds:null};t=t.replace(Rt,Tt);let r,i=Ft[t];i||(i=Ft[t]=tn.buildParser(t)),i.reduce(((e,t)=>{if(!t.last){let r,i,s;if(r="T"===t.splitter&&-1===e.indexOf("T")?e.indexOf(" "):""!==t.splitter?e.indexOf(t.splitter):t.pattern&&t.pattern.length||-1,-1===r||"SSS"===t.pattern&&e.match(/^\d+Z$/)){const t=e.split(/([Z\-+])/);1===t.length?(i=e,s=""):(i=t[0],s=`${t[1]}${t[2]}`)}else i=e.substring(0,r)||e,s=e.substring(r+t.splitter.length);if(t.fn){const e=t.fn(i);e?Object.assign(n,e):s=i+s}return s}Object.assign(n,t.fn(e))}),e),n.year&&!n.date&&(n.date=1);return r=tn.create(n)||new Date(e),r}static create(e){const t=f({},e);let n=isNaN(t.year),r=!1;if(!n){let e=!0;qt.forEach((n=>{n in t&&!isNaN(t[n])||(t[n]=0),e=e&&null===t[n]})),n=e}if("am"===t.amPm?t.hours=t.hours%12:"pm"===t.amPm&&(t.hours=t.hours%12+12),"timeZone"in t&&(r=!0,t.minutes-=t.timeZone),n)return null;const i=[Ct(t.year,2020),Ct(t.month,0),Ct(t.date,1),t.hours,t.minutes,t.seconds,t.milliseconds];return r?new Date(Date.UTC(...i)):new Date(...i)}static toUTC(e){return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()))}static format(e,t=tn.defaultFormat){if(!e||isNaN(e))return null;let n=It[t],r="";if(!n){n=It[t]=[];for(let e=0;e<t.length;e++){const r=t.slice(e).match(Lt),i=null==r?void 0:r[0];if(i){const t=(this.localize("L{formats}")||{})[i]||Ot[i];n.push(t),e+=i.length-1}else if("{"===t[e]){const r=t.indexOf("}",e+1);-1===r?(n.push(t.substr(e+1)),e=t.length):(n.push(t.substring(e+1,r)),e=r)}else n.push(t[e])}}return n.forEach((t=>{r+="string"==typeof t?t:t(e)})),r}static formatRange(e,t){return t.replace(wt,((t,n,r)=>en.format(e["S"===n?0:1],r)))}static asMilliseconds(e,t=null){return"string"==typeof e&&(t=e,e=1),tn.as("millisecond",e,t)}static asMonths(e){const t=tn.as("ms",tn.daysInMonth(e),"day"),n=(e.valueOf()-tn.startOf(e,"month").valueOf())/t;return 12*e.getYear()+e.getMonth()+n}static monthsToDate(e){const t=Math.floor(e),n=e-t,r=new Date(0,t),i=tn.as("ms",tn.daysInMonth(r),"days");return r.setTime(r.getTime()+n*i),r}static formatDelta(e,t){let n,r;"boolean"==typeof t?n=t:t&&(n=t.abbrev);const i=this.getDelta(e,t),s=[],o=(null==t?void 0:t.separator)||(n?"":" ");for(r in i)s.push(`${i[r]}${o}${r}`);return!1===(null==t?void 0:t.asString)?s:s.join(", ")}static getDelta(e,t){let n,r,i,s,o,a,l;"boolean"==typeof t?n=t:t&&(n=t.abbrev,s=tn.normalizeUnit(t.precision),a=t.maxUnit,l=!n&&t.ignoreLocale);const c={},d=n?tn.getShortNameOfUnit:tn.getLocalizedNameOfUnit,u=a?Gt.slice(Gt.indexOf(a)):Gt;for(o of u)if(r=tn.as(o,e),i=s===o,r=Math[i?"round":"floor"](r),(r||i&&!c.length)&&(c[l?o:d.call(tn,o,1!==r)]=r,e-=tn.as("ms",r,o)),i||!e)break;return c}static as(e,t,n="ms"){return"string"==typeof t&&(t=tn.parseDuration(t)),"object"==typeof t&&(n=t.unit,t=t.magnitude),e===n||(e=tn.normalizeUnit(e))===(n=tn.normalizeUnit(n))?t:Zt[n]>Zt[e]?t*Math.abs(jt[n][e]):t/Math.abs(jt[e][n])}static formatContainsHourInfo(e){return/([HhKkmSsAa]|LT|L{3,}|l{3,})/.test(e.replace(/(\\.)/g,""))}static is24HourFormat(e){return tn.format(tn.getTime(13,0,0),e).includes("13")}static add(e,t,n="ms",r=!0){let i;if(i="string"==typeof e?tn.parse(e):r?new Date(e.getTime()):e,"string"==typeof t){const e=en.parseDuration(t);t=e.magnitude,n=e.unit}else t&&"object"==typeof t&&(n=t.unit,t=t.magnitude);if(!n||0===t)return i;switch(n=tn.normalizeUnit(n)){case"millisecond":i.setTime(i.getTime()+t);break;case"second":i.setTime(i.getTime()+1e3*t);break;case"minute":i.setTime(i.getTime()+6e4*t);break;case"hour":i.setTime(i.getTime()+36e5*t);break;case"day":t%1==0?i.setDate(i.getDate()+t):i.setTime(i.getTime()+864e5*t),23===i.getHours()&&0===e.getHours()&&i.setHours(i.getHours()+1);break;case"week":i.setDate(i.getDate()+7*t);break;case"month":{let e=i.getDate();e>28&&(e=Math.min(e,tn.getLastDateOfMonth(tn.add(tn.getFirstDateOfMonth(i),t,"month")).getDate())),i.setDate(e),i.setMonth(i.getMonth()+t);break}case"quarter":tn.add(i,3*t,"month",!1);break;case"year":i.setFullYear(i.getFullYear()+t);break;case"decade":i.setFullYear(i.getFullYear()+10*t)}return i}static diff(e,t,n="ms",r=!0){if(n=tn.normalizeUnit(n),!e||!t)return 0;let i;switch(n){case"year":i=tn.diff(e,t,"month")/12;break;case"quarter":i=tn.diff(e,t,"month")/3;break;case"month":i=12*(t.getFullYear()-e.getFullYear())+(t.getMonth()-e.getMonth());break;case"week":i=tn.diff(e,t,"day")/7;break;case"day":{const n=e.getTimezoneOffset()-t.getTimezoneOffset();i=(t-e+60*n*1e3)/864e5;break}case"hour":i=(t-e)/36e5;break;case"minute":i=(t-e)/6e4;break;case"second":i=(t-e)/1e3;break;case"millisecond":i=t-e}return r?i:Math.round(i)}static startOf(e,t="day",n=!0,r=tn.weekStartDay){if(!e)return null;switch(t=tn.normalizeUnit(t),n&&(e=tn.clone(e)),t){case"year":return e.setMonth(0,1),e.setHours(0,0,0,0),e;case"quarter":return e.setMonth(3*(tn.get(e,"quarter")-1),1),e.setHours(0,0,0,0),e;case"month":return e.setDate(1),e.setHours(0,0,0,0),e;case"week":{const t=e.getDay()-r;return e.setDate(e.getDate()-t),e.setHours(0,0,0,0),e}case"day":return e.setHours(0,0,0,0),e;case"hour":e.getMinutes()>0&&e.setMinutes(0);case"minute":e.getSeconds()>0&&e.setSeconds(0);case"second":e.getMilliseconds()>0&&e.setMilliseconds(0);case"millisecond":return e}}static endOf(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+1)}static clone(e){return new Date(e.getTime())}static clearTime(e,t=!0){return e?(t&&(e=new Date(e.getTime())),e.setHours(0,0,0,0),e):null}static midnight(e,t){let n=tn.clearTime(e);return t&&n<e&&(n=tn.add(n,1,"d")),n}static getTimeOfDay(e,t="ms"){const n=e.getHours()*jt.hour.millisecond+e.getMinutes()*jt.minute.millisecond+e.getSeconds()*jt.second.millisecond+e.getMilliseconds();return"ms"===t?n:tn.as(t,n,"ms")}static set(e,t,n){if(!t)return e;if("string"==typeof t)switch(tn.normalizeUnit(t)){case"millisecond":(0!==n||e.getMilliseconds()>0)&&e.setMilliseconds(n);break;case"second":(0!==n||e.getSeconds()>0)&&e.setSeconds(n);break;case"minute":(0!==n||e.getMinutes()>0)&&e.setMinutes(n);break;case"hour":e.setHours(n);break;case"day":case"date":e.setDate(n);break;case"week":throw new Error("week not implemented");case"month":e.setMonth(n);break;case"quarter":e.setDate(1),e.setMonth(3*(n-1));break;case"year":e.setFullYear(n)}else Object.entries(t).sort(((e,t)=>Zt[e[0]]-Zt[t[0]])).forEach((([t,n])=>{tn.set(e,t,n)}));return e}static setDateToMidday(e,t=!0){return tn.set(tn.clearTime(e,t),"hour",12)}static constrain(e,t,n){return null!=t&&(e=tn.max(e,t)),null==n?e:tn.min(e,n)}static getTime(e,t=0,n=0,r=0){return e instanceof Date&&(r=e.getMilliseconds(),n=e.getSeconds(),t=e.getMinutes(),e=e.getHours()),new Date(2020,0,1,e,t,n,r)}static copyTimeValues(e,t){return e.setHours(t.getHours()),e.setMinutes(t.getMinutes()),e.setSeconds(t.getSeconds()),e.setMilliseconds(t.getMilliseconds()),e}static get isDSTEnabled(){const e=(new Date).getFullYear(),t=new Date(e,0,1),n=new Date(e,6,1);return t.getTimezoneOffset()!==n.getTimezoneOffset()}static isDST(e){const t=e.getFullYear(),n=new Date(t,0,1),r=new Date(t,6,1);return e.getTimezoneOffset()<Math.max(n.getTimezoneOffset(),r.getTimezoneOffset())}static isBefore(e,t){return e<t}static isAfter(e,t){return e>t}static isEqual(e,t,n=null){return null===n?e&&t&&e.getTime()===t.getTime():tn.startOf(e,n)-tn.startOf(t,n)==0}static compare(e,t,n=null){return n&&(e=tn.startOf(e,n),t=tn.startOf(t,n)),e<t?-1:e>t?1:0}static clamp(e,t,n){if(!isNaN(e))return null!=t&&(e=Math.max(e,t)),null!=n&&(e=Math.min(e,n)),new Date(e)}static isSameDate(e,t){return 0===tn.compare(e,t,"d")}static isSameTime(e,t){return e.getHours()===t.getHours()&&e.getMinutes()===t.getMinutes()&&e.getSeconds()===t.getSeconds()&&e.getMilliseconds()===t.getMilliseconds()}static isStartOf(e,t){return tn.isEqual(e,tn.startOf(e,t))}static betweenLesser(e,t,n){return t.getTime()<=e.getTime()&&e.getTime()<n.getTime()}static betweenLesserEqual(e,t,n){return t.getTime()<=e.getTime()&&e.getTime()<=n.getTime()}static intersectSpans(e,t,n,r){return tn.betweenLesser(e,n,r)||tn.betweenLesser(n,e,t)}static compareUnits(e,t){return Math.sign(Zt[tn.normalizeUnit(e)]-Zt[tn.normalizeUnit(t)])}static timeSpanContains(e,t,n,r){return n-e>=0&&t-r>=0}static get weekStartDay(){return null==tn._weekStartDay&&(tn._weekStartDay=this.localize("L{weekStartDay}")||0),tn._weekStartDay}static get nonWorkingDays(){return f({},this.localize("L{nonWorkingDays}"))}static get nonWorkingDaysAsArray(){return Object.keys(this.nonWorkingDays).map(Number)}static get weekends(){return f({},this.localize("L{weekends}"))}static get(e,t){switch(tn.normalizeUnit(t)){case"millisecond":return e.getMilliseconds();case"second":return e.getSeconds();case"minute":return e.getMinutes();case"hour":return e.getHours();case"date":case"day":return e.getDate();case"week":return Ot.W(e);case"month":return e.getMonth();case"quarter":return Math.floor(e.getMonth()/3)+1;case"year":return e.getFullYear()}return null}static daysInYear(e){const t=e.getFullYear(),n=new Date(t+1,0,1)-new Date(t,0,1);return this.as("day",n)}static daysInMonth(e){return 32-new Date(e.getFullYear(),e.getMonth(),32).getDate()}static hoursInDay(e){const t=e.getFullYear(),n=e.getMonth(),r=e.getDate(),i=new Date(t,n,r+1)-new Date(t,n,r);return this.as("hour",i)}static getNormalizedUnitDuration(e,t){let n;switch(t){case"month":n=tn.asMilliseconds(tn.daysInMonth(e),"day");break;case"year":n=tn.asMilliseconds(tn.daysInYear(e),"day");break;case"day":n=tn.asMilliseconds(tn.hoursInDay(e),"hour");break;default:n=tn.asMilliseconds(t)}return n}static getFirstDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth(),1)}static getLastDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth()+1,0)}static min(e,t){return e.getTime()<t.getTime()?e:t}static max(e,t){return e.getTime()>t.getTime()?e:t}static getNext(e,t,n=1,r=tn.weekStartDay){if("week"===t){const t=tn.clone(e),i=t.getDay();return tn.startOf(t,"day",!1),tn.add(t,r-i+7*(n-(r<=i?0:1)),"day",!1),t.getDay()!==r&&tn.add(t,1,"hour"),t}return tn.startOf(tn.add(e,n,t),t,!1)}static isValidDate(e){return tn.isDate(e)&&!isNaN(e)}static isDate(e){return e&&ft.call(e)===vt}static getStartOfNextDay(e,t,n){let r=tn.add(n?e:tn.clearTime(e,t),1,"day");if(r.getDate()===e.getDate()){const n=tn.add(tn.clearTime(e,t),2,"day").getTimezoneOffset(),i=e.getTimezoneOffset();r=tn.add(r,i-n,"minute")}return r}static getEndOfPreviousDay(e,t){const n=t?e:tn.clearTime(e,!0);return n-e?n:tn.add(n,-1,"day")}static getWeekDescription(e,t=e){const n=e.getMonth()===t.getMonth()?en.format(e,"MMMM"):`${en.format(e,"MMM")} - ${en.format(t,"MMM")}`,r=en.getWeekNumber(e);return`${r[1]}, ${n} ${r[0]}`}static getWeekNumber(e,t=en.weekStartDay){const n=new Date(e.getFullYear(),0,1),r=new Date(e.getFullYear(),11,31),i=xt(n.getDay()-t),s=xt(r.getDay()-t),o=(a=e,l=n,Math.floor((a.getTime()-l.getTime()-(a.getTimezoneOffset()-l.getTimezoneOffset())*jt.minute.millisecond)/jt.day.millisecond)+1);var a,l;let c;if(c=i<4?Math.floor((o+i-1)/7)+1:Math.floor((o+i-1)/7),c){let t=e.getFullYear();return 53===c&&s<3&&(t++,c=1),[t,c]}const d=en.getWeekNumber(new Date(e.getFullYear()-1,11,31))[1];return[e.getFullYear()-1,d]}static formatCount(e,t){return t=tn.normalizeUnit(t),1!==e&&(t+="s"),e+" "+t}static getUnitToBaseUnitRatio(e,t,n=!1){return(e=tn.normalizeUnit(e))===(t=tn.normalizeUnit(t))?1:jt[e]&&jt[e][t]&&(n||jt[e][t]>0)?1/tn.as(t,1,e):jt[t]&&jt[t][e]&&(n||jt[t][e]>0)?tn.as(e,1,t):-1}static getShortNameOfUnit(e){return e=tn.parseTimeUnit(e),tn.unitLookup[e].abbrev}static getLocalizedNameOfUnit(e,t=!1){const n=e.charAt(0)===e.charAt(0).toUpperCase();return e=tn.normalizeUnit(e),e=tn.parseTimeUnit(e),e=tn.unitLookup[e][t?"plural":"single"],n&&(e=_.capitalize(e)),e}static normalizeUnit(e){if(!e)return null;const t=e.toLowerCase();return"date"===t||Ut.includes(t)?t:Vt[e]||Vt[t]}static getUnitByName(e){return tn.normalizeUnit(e)||tn.normalizeUnit(tn.parseTimeUnit(e))}static getDurationInUnit(e,t,n,r){return tn.diff(e,t,n,r)}static doesUnitsAlign(e,t){return!(e!==t&&"week"===t)}static getSmallerUnit(e){return Ut[Zt[tn.normalizeUnit(e)]-1]||null}static getLargerUnit(e){return Ut[Zt[tn.normalizeUnit(e)]+1]||null}static round(e,t,n,r){return tn.snap("round",e,t,n,r)}static floor(e,t,n,r){return tn.snap("floor",e,t,n,r)}static ceil(e,t,n,r){return tn.snap("ceil",e,t,n,r)}static snap(e,t,n,r,i=tn.weekStartDay){const s=Jt[e];if("string"==typeof n&&(n=tn.parseDuration(n)),Y.isObject(n)){const o=n.magnitude||n.increment;switch(n.unit){case"week":{const n=t.getDay();return r=tn.add(tn.clearTime(t),n>=i?i-n:-(n-i+7),"day"),tn[e](t,7*o+" days",r)}case"month":{let e;return t=tn.asMonths(t),e=r?t+s(t-(r=tn.asMonths(r)),o):s(t,o),tn.monthsToDate(e)}case"quarter":return tn[e](t,3*o+" months",r);case"year":return tn[e](t,12*o+" months",r);case"decade":return tn[e](t,10*o+" years",r)}n=tn.as("ms",o,n.unit)}if(r){const e=tn.as("ms",r.getTimezoneOffset()-t.getTimezoneOffset(),"ms");return new Date(r.valueOf()+s(tn.diff(r,t,"ms")+e,n))}{const e=60*t.getTimezoneOffset()*1e3;return new Date(s(t.valueOf()-e,n)+e)}}static parseDuration(e,t=!0,n){var r;const i=(t?zt:Wt).exec(e);if(null==e||!i)return null;const s=(e=>{const t=parseFloat(e);return isNaN(t)?null:t})(null===(r=i[1])||void 0===r?void 0:r.replace(",",".")),o=tn.parseTimeUnit(i[2])||n;return o?{magnitude:s,unit:o}:null}static parseTimeUnit(e){const t=null==e?null:tn.durationRegEx.exec(e.toLowerCase());if(!t)return null;for(let e=0;e<Ut.length;e++)if(t[e+1])return Ut[e]}static getGMTOffset(e=new Date){if(!e)return;const t=e.getTimezoneOffset();return t?(t>0?"-":"+")+Math.abs(Math.trunc(t/60)).toString().padStart(2,"0")+":"+Math.abs(t%60).toString().padStart(2,"0"):"Z"}static fillDayNames(){const e=new Date("2000-01-01T12:00:00"),t=tn._dayNames||[],n=tn._dayShortNames||[];t.length=0,n.length=0;for(let r=2;r<9;r++)e.setDate(r),t.push(tn.format(e,"dddd")),n.push(tn.format(e,"ddd"));tn._dayNames=t,tn._dayShortNames=n}static getDayNames(){return tn._dayNames}static getDayName(e){return tn._dayNames[e]}static getDayShortNames(){return tn._dayShortNames}static getDayShortName(e){return tn._dayShortNames[e]}static fillMonthNames(){const e=new Date("2000-01-15T12:00:00"),t=tn._monthNames||[],n=tn._monthShortNames||[];t.length=0,n.length=0;for(let r=0;r<12;r++)e.setMonth(r),t.push(tn.format(e,"MMMM")),n.push(tn.format(e,"MMM"));tn._monthNames=t,tn._monthShortNames=n}static getMonthShortNames(){return tn._monthShortNames}static getMonthShortName(e){return tn._monthShortNames[e]}static getMonthNames(){return tn._monthNames}static getMonthName(e){return tn._monthNames[e]}static set locale(e){Mt=e,At={},It={}}static get locale(){return Mt}static setupDurationRegEx(e=[],t=[]){const n=this,r={};let i="";for(let s=0;s<t.length;s++){const o=t[s],a=e[s];a.canonicalUnitName=Ut[s],r[a.single]=r[a.single.toUpperCase()]=r[a.canonicalUnitName]=r[a.canonicalUnitName.toUpperCase()]=a,i+=(s?"|":"")+"(";for(let e=0;e<o.length;e++)i+=`${o[e]}|`;if(Mt=n.localize("L{locale}")||"en-US","en-US"!==Mt){const e=Yt[s];for(let t=0;t<e.length;t++)i+=`${e[t]}|`}i+=`${a.single}|${a.plural}|${a.canonicalUnitName}|${a.canonicalUnitName}s)`}n.unitLookup=r,n.durationRegEx=new RegExp(`^(?:${i})$`)}static applyLocale(){const e=this,t=e.localize("L{unitAbbreviations}")||[],n=e.unitNames=e.localize("L{unitNames}");"unitNames"!==n&&(Mt=e.localize("L{locale}")||"en-US",kt="en-US"===Mt?St:e.localize("L{ordinalSuffix}")||kt,It={},Ft={},At={},tn._weekStartDay=null,tn.setupDurationRegEx(n,t),tn.fillDayNames(),tn.fillMonthNames())}}v(en,"MS_PER_DAY",864e5);const tn=en;tn.useIntlFormat=Dt,lt.on({locale:"applyLocale",prio:1e3,thisObj:tn}),lt.locale&&tn.applyLocale(),en._$name="DateHelper";const{hasOwn:nn}=Y,rn="1.01"===1.005.toFixed(2)?null:function(e,t){const n=e.toString().split("."),r=+(n[1]?n.join(".")+"1":n[0]);return e.toFixed.call(r,t)};class sn extends Y{static transformArrayToNamedObject(e,t="ref"){const n={};return e.forEach(((e,r)=>{const i=null!=e[t]&&e[t].toString().length?e[t]:r;n[i]=e})),n}static transformNamedObjectToArray(e,t="ref"){return Object.keys(e).filter((t=>e[t])).map((n=>{const r=e[n];return r[t]=n,r}))}static isEqual(e,t,n=!1){if(null===e&&null!==t||void 0===e&&void 0!==t||null===t&&null!==e||void 0===t&&void 0!==e)return!1;if(null==e&&null==t)return!0;if(e===t)return!0;const r=typeof e;if(r===typeof t){switch(r){case"number":case"string":case"boolean":return e===t}switch(!0){case e instanceof Date&&t instanceof Date:return e.getTime()===t.getTime();case Array.isArray(e)&&Array.isArray(t):return e.length===t.length&&e.every(((e,r)=>on.isEqual(e,t[r],n)));case"object"===r&&e.constructor.prototype===t.constructor.prototype:return n?on.isDeeplyEqual(e,t,n):JSON.stringify(e)===JSON.stringify(t)}}return String(e)===String(t)}static isDeeplyEqual(e,t,n={}){if(e===t)return!0;if(!e||!t)return!1;const r=on.keys(e,n.ignore),i=on.keys(t,n.ignore);if(r.length!==i.length)return!1;for(let s=0;s<r.length;s++){const o=r[s],a=i[s];if(o!==a)return!1;const l=e[o],c=t[a];if(!n.shouldEvaluate||!1!==n.shouldEvaluate(o,{value:l,object:e},{value:c,object:t})){if(n.evaluate){const r=n.evaluate(o,{value:l,object:e},{value:c,object:t});if(!1===r)return!1;if(!0===r)continue}if(!on.isEqual(l,c,n))return!1}}return!0}static isPartial(e,t){return e=String(e).toLowerCase(),t=String(t).toLowerCase(),-1!==e.indexOf(t)}static isLessThan(e,t){return e instanceof Date&&t instanceof Date?en.isBefore(e,t):e<t}static isMoreThan(e,t){return e instanceof Date&&t instanceof Date?en.isAfter(e,t):e>t}static fork(e){let t,n,r;if(e&&e.constructor===Object)for(n in t=Object.setPrototypeOf({},e),e)r=e[n],r&&(r.constructor===Object?t[n]=on.fork(r):r instanceof Array&&(t[n]=r.slice()));else t=e;return t}static copyProperties(e,t,n){let r,i;for(i=0;i<n.length;i++)r=n[i],r in t&&(e[r]=t[r]);return e}static copyPropertiesIf(e,t,n){if(t)for(const r of n)r in e||(e[r]=t[r]);return e}static entries(e,t){const n=[],r="function"==typeof t;if(e)for(const i in e)(r?t(i,e[i]):null!=t&&t[i])||n.push([i,e[i]]);return n}static fromEntries(e,t){if(t=t||{},e)for(let n=0;n<e.length;++n)t[e[n][0]]=e[n][1];return t}static keys(e,t,n){const r=[],i="function"==typeof t;if(e){let s=0;for(const o in e)(i?t(o,e[o]):null!=t&&t[o])||(r.push(n?n(o,s):o),++s)}return r}static values(e,t,n){const r=[],i="function"==typeof t;if(e){let s=0;for(const o in e)(i?t(o,e[o]):null!=t&&t[o])||(r.push(n?n(e[o],s):e[o]),++s)}return r}static pathExists(e,t){return t.split(".").every((t=>!(!e||!(t in e)||(e=e[t],0))))}static pathifyKeys(e){const t={};for(const n in e)if(nn(e,n))if(e[n]instanceof Object){const r=this.pathifyKeys(e[n]);for(const e in r)t[`${n}.${e}`]=r[e]}else t[n]=e[n];return t}static deletePath(e,t){t.split(".").reduce(((e,t,n,r)=>{if(null==e)return null;if(nn(e,t)){if(n!==r.length-1)return e[t];delete e[t]}}),e)}static coerce(e,t){const n=Y.typeOf(e),r=Y.typeOf(t),i="string"==typeof e;if(n!==r)switch(r){case"string":return String(e);case"number":return Number(e);case"boolean":return!(i&&(!e||"false"===e||"0"===e))&&Boolean(e);case"null":return!(!i||e&&"null"!==e)&&null;case"undefined":return!(!i||e&&"undefined"!==e)&&void 0;case"date":return i&&isNaN(e)?en.parse(e):Date(Number(e))}return e}static wrapProperty(e,t,n,r,i=!0){const s={};let o=Object.getPrototypeOf(e),a=Object.getOwnPropertyDescriptor(o,t);for(;!a&&o&&i;)o=Object.getPrototypeOf(o),o&&(a=Object.getOwnPropertyDescriptor(o,t));a?(a.set?s.set=t=>{a.set.call(e,t),r&&r.call(e,a.get.call(e))}:s.set=r,a.get?s.get=()=>{let t=a.get.call(e);return n&&(t=n.call(e,t)),t}:s.get=n):(s.set=n=>{e[`_${t}`]=n,r&&r.call(e,n)},s.get=()=>{let r=e[`_${t}`];return n&&(r=n.call(e,r)),r}),Object.defineProperty(e,t,s)}static hookProperty(e,t,n){const r=sn.getPropertyDescriptor(n.prototype,"value"),i=sn.getPropertyDescriptor(e,t),s=`_${t}`,o=class{get value(){return i?i.get.call(this):this[s]}set value(e){i?i.set.call(this,e):this[s]=e}},a=sn.getPropertyDescriptor(o.prototype,"value");return Object.setPrototypeOf(n.prototype,o.prototype),Object.defineProperty(e,t,{configurable:!0,get:r.get||a.get,set:r.set||a.set}),()=>delete e[t]}static getPropertyDescriptor(e,t){let n=null;for(let r=e;r&&!n&&!nn(r,"isBase");r=Object.getPrototypeOf(r))n=Object.getOwnPropertyDescriptor(r,t);return n}static cleanupProperties(e,t=!1){return Object.entries(e).forEach((([n,r])=>{t?void 0===r&&delete e[n]:null==r&&delete e[n]})),e}static removeAllProperties(e){return Object.keys(e).forEach((t=>delete e[t])),e}static assertType(e,t,n){const r=Y.typeOf(e);if(null!=e&&r!==t)throw new Error(`Incorrect type "${r}" for ${n}, expected "${t}"`)}static assertObject(e,t){on.assertType(e,"object",t)}static assertInstance(e,t){on.assertType(e,"instance",t)}static assertClass(e,t){on.assertType(e,"class",t)}static assertFunction(e,t){if("function"!=typeof e||e.isBase||e.$$name)throw new Error(`Incorrect type for ${t}, got "${e}" (expected a function)`)}static assertNumber(e,t){const n=Number(e);if("number"!=typeof e||isNaN(n))throw new Error(`Incorrect type for ${t}, got "${e}" (expected a Number)`)}static assertBoolean(e,t){on.assertType(e,"boolean",t)}static assertString(e,t){on.assertType(e,"string",t)}static assertArray(e,t){on.assertType(e,"array",t)}static toFixed(e,t){return rn?rn(e,t):e.toFixed(t)}static roundTo(e,t=1){return Math.round(e/t)*t}static round(e,t){if(null==t)return e;const n=10**t;return Math.round(e*n)/n}static getMapPath(e,t,n){const r=Array.isArray(t)?t:"string"==typeof t?t.split("."):[t],i=1===r.length,s=r[0],o=e.has(s)?e.get(s):e.set(s,i?n:{}).get(s);return i?o:on.getPathDefault(o,r.slice(1),n)}}const on=sn;sn._$name="ObjectHelper";const an=["border-top-width","border-right-width","border-bottom-width","border-left-width"],ln=["margin-top","margin-right","margin-bottom","margin-left"],cn=["padding-top","padding-right","padding-bottom","padding-left"],dn="border-top-width",un="border-right-width",hn="border-bottom-width",gn="border-left-width",mn=Object.freeze({x:0,y:0}),pn=/^([trblc])(\d*)-([trblc])(\d*)$/i,fn=/^([trblc])(\d*)$/i,vn=["top","right","bottom","left"],yn={t:0,r:1,b:2,l:3},bn=["b-t","l-r","t-b","r-l"],Cn={bt:1,tb:1,lr:1,rl:1},wn=Object.freeze([0,0]),Sn=["width","height"],Dn=(e,t=e,n=e,r=t)=>Array.isArray(e)?Dn.apply(null,e):[e,t,n,r];function En(e){return`${vn[(yn[e.myEdge]+2)%4][0]}${e.myOffset}-${vn[(yn[e.targetEdge]+2)%4][0]}${e.targetOffset}`}class xn{get isRectangle(){return!0}static from(e,t,n){var r;if("string"==typeof e?e=document.querySelector(e):e.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&(e=e.host||e.ownerDocument),"string"==typeof t&&(t=document.querySelector(t)),e.isRectangle)return e;if(e=e.element||e,void 0===n&&"boolean"==typeof t&&(n=t,t=null),null===(r=t)||void 0===r||!r.isRectangle)if(t){let{scrollLeft:e,scrollTop:n}=t;y.isSafari&&t===document.body&&(e=n=0),t=xn.from(t).translate(-e,-n)}else t=mn;const i=e===document||e===globalThis,s=e===document.body&&0===document.body.offsetHeight,o=s&&e.getBoundingClientRect(),a=s?new xn(o.left,o.top,o.width,document.body.parentElement.scrollHeight):i?new xn(0,0,globalThis.innerWidth,globalThis.innerHeight):e.getBoundingClientRect(),l=n||i?[0,0]:[globalThis.pageXOffset,globalThis.pageYOffset];return new xn(a.left+l[0]-t.x,a.top+l[1]-t.y,a.width,a.height)}static fromScreen(e,t){return xn.from(e,t,!0)}static inner(e,t,n=!1){const r=this.from(e,t,n);if(document.body.contains(e)){const t=Mr.getStyleValue(e,an);r.x+=parseFloat(t[gn]),r.y+=parseFloat(t[dn]),r.right-=parseFloat(t[un]),r.bottom-=parseFloat(t[hn])}return r}static content(e,t,n=!1){const r=this.from(e,t,n);if(document.body.contains(e)){const t=Mr.getStyleValue(e,an),n=Mr.getStyleValue(e,cn);r.x+=parseFloat(t[gn])+parseFloat(n["padding-left"]),r.y+=parseFloat(t[dn])+parseFloat(n["padding-top"]),r.right-=parseFloat(t[un])+parseFloat(n["padding-right"]),r.bottom-=parseFloat(t[hn])+parseFloat(n["padding-bottom"])}return r}static client(e,t,n=!1){const r=this.content(e,t,n),i=Mr.scrollBarWidth;let s;return i&&(e.scrollHeight>e.clientHeight&&"hidden"!==Mr.getStyleValue(e,"overflow-y")&&(s=parseFloat(Mr.getStyleValue(e,"padding-right")),r.right+=s-Math.max(s,i)),e.scrollWidth>e.clientWidth&&"hidden"!==Mr.getStyleValue(e,"overflow-x")&&(s=parseFloat(Mr.getStyleValue(e,"padding-bottom")),r.bottom+=s-Math.max(s,i))),r}static outer(e,t,n=!1){const r=this.from(e,t,n);if(document.body.contains(e)){const t=Mr.getStyleValue(e,ln);r.x-=parseFloat(t["margin-left"]),r.y-=parseFloat(t["margin-top"]),r.right+=parseFloat(t["margin-right"]),r.bottom+=parseFloat(t["margin-bottom"])}return r}static union(...e){let t,{x:n,y:r,right:i,bottom:s}=e[0];if(e.length>1)for(let o=1;o<e.length;o++)t=e[o],t.x<n&&(n=t.x),t.y<r&&(r=t.y),t.right>i&&(i=t.right),t.bottom>s&&(s=t.bottom);return new xn(n,r,i-n,s-r)}roundPx(e=globalThis.devicePixelRatio||1){const t=this;return t._x=Mr.roundPx(t._x,e),t._y=Mr.roundPx(t._y,e),t._width=Mr.roundPx(t._width,e),t._height=Mr.roundPx(t._height,e),t}static get $$name(){return hasOwnProperty.call(this,"$name")&&this.$name||hasOwnProperty.call(this,"_$name")&&this._$name||this.name}get $$name(){return this.constructor.$$name}constructor(e,t,n,r){sn.assertNumber(e,"Rectangle.x"),sn.assertNumber(t,"Rectangle.y"),sn.assertNumber(n,"Rectangle.width"),sn.assertNumber(r,"Rectangle.height");const i=this;n<0&&(e+=n,n=-n),r<0&&(t+=r,r=-r),i._x=e,i._y=t,i._width=n,i._height=r}clone(){const e=this,t=new xn(e.x,e.y,e.width,e.height);return t.isAlignRectangle=e.isAlignRectangle,t.minHeight=e.minHeight,t.minWidth=e.minWidth,t}contains(e){const t=this;return!!e.isRectangle&&e._x>=t._x&&e._y>=t._y&&e.right<=t.right&&e.bottom<=t.bottom}intersect(e,t=!1,n=!1){const r=this,i=Math.max(r.y,e.y),s=Math.min(r.right,e.right),o=Math.min(r.bottom,e.bottom),a=Math.max(r.x,e.x);return!!(n?o>=i&&s>=a:o>i&&s>a)&&(!!t||new xn(a,i,s-a,o-i))}equals(e,t=!1){const n=t?e=>Math.round(e):e=>e;return e.isRectangle&&n(e.x)===n(this.x)&&n(e.y)===n(this.y)&&n(e.width)===n(this.width)&&n(e.height)===n(this.height)}translate(e,t){return this._x+=e||0,this._y+=t||0,this}moveTo(e,t){return null!=e&&(this._x=e),null!=t&&(this._y=t),this}getDelta(e){return[e.x-this.x,e.y-this.y]}get center(){return new xn.Point(this.x+this.width/2,this.y+this.height/2)}set x(e){const t=e-this._x;this._x=e,this._width-=t}get x(){return this._x}get start(){return this.left}set left(e){this.x=e}get left(){return this.x}set top(e){this.y=e}get top(){return this.y}set y(e){const t=e-this._y;this._y=e,this._height-=t}get y(){return this._y}set width(e){this._width=e}get width(){return this._width}set height(e){this._height=e}get height(){return this._height}set right(e){this._width=e-this._x}get right(){return this._x+this._width}get end(){return this.right}set bottom(e){this._height=e-this._y}get bottom(){return this._y+this._height}getStart(e,t=!0){return t?e?this.right:this.left:this.top}getEnd(e,t=!0){return t?e?this.left:this.right:this.bottom}get area(){return this.width*this.height}set minWidth(e){const t=this;isNaN(e)?t._minWidth=null:(t._minWidth=Number(e),t.isAlignRectangle||(t.width=Math.max(t.width,t._minWidth)))}get minWidth(){return this._minWidth}set minHeight(e){const t=this;isNaN(e)?t._minHeight=null:(t._minHeight=Number(e),t.isAlignRectangle||(t.height=Math.max(t.height,t._minHeight)))}get minHeight(){return this._minHeight}adjust(e,t,n,r){const i=this;return i.x+=e,i.y+=t,i.width+=n,i.height+=r,i}inflate(e,t=e,n=e,r=t){return Array.isArray(e)&&([e,t,n,r]=Dn(e)),this.adjust(-r,-e,t,n)}deflate(e,t=e,n=e,r=t){return Array.isArray(e)&&([e,t,n,r]=Dn(e)),this.adjust(r,e,-t,-n)}constrainTo(e,t){const n=this,r=n.height,i=n.y,s=n.minWidth||n.width,o=n.minHeight||n.height;if(n.height>=e.height){if(t&&o>e.height)return!1;n._y=e.y,n.height=e.height}if(n.width>=e.width){if(t&&s>e.width)return n.y=i,n.height=r,!1;n._x=e.x,n.width=e.width}let a=n.bottom-e.bottom;return a>0&&n.translate(0,-a),a=n.right-e.right,a>0&&n.translate(-a),a=e.y-n.y,a>0&&n.translate(0,a),a=e.x-n.x,a>0&&n.translate(a),n}alignTo(e){let t,n,r,i,s=this.clone(),{target:o,constrainTo:a,constrainPadding:l}=e;if(o&&!o.isRectangle&&(o=xn.from(o.element?o.element:o)),a){if(!a.isRectangle){i=a===globalThis||a===document;const t="ignorePageScroll"in e?e.ignorePageScroll:!i;a=xn.from(a.element?a.element:a,null,t)}l&&(l=Dn(l),l[0]=Math.min(l[0],o.top),l[1]=Math.min(l[1],a.right-o.right),l[2]=Math.min(l[0],a.bottom-o.bottom),l[3]=Math.min(l[0],o.left),a=a.deflate.apply(a.clone(),l))}const c=this,d=null==(E=e.offset)?wn:"number"==typeof E?[E,E]:E,{align:u,axisLock:h,anchorSize:g,anchorPosition:m,matchSize:p,position:f,rtl:v}=e,y=function(e,t){const n=pn.exec(e),r=n[1],i=n[3],s=parseInt(n[2]||50),o=parseInt(n[4]||50),a=!t||1&yn[r]?s:100-s,l=!t||1&yn[i]?o:100-o;return{myAlignmentPoint:r+a,myEdge:r,myOffset:a,targetAlignmentPoint:i+l,targetEdge:i,targetOffset:l,startZone:yn[i],edgeAligned:Cn[r+i]}}(u,v),b=a&&a.clone(),C=[],w=[{zone:n=y.startZone,align:u}],S=p&&Sn[1&y.startZone],D=c[S];var E;if(S&&h?s[S]=o[S]:!y.edgeAligned&&p&&(s.width=o.width,s.height=o.height),a&&s.constrainTo(a),a&&null!=y.startZone)if(h)w.push({zone:n=(n+2)%4,align:En(y)}),"flexible"===h&&(w.push({zone:n=(y.startZone+1)%4,align:bn[n]}),w.push({zone:n=(n+2)%4,align:bn[n]}));else for(let e=1;e<4;e++)w.push({zone:n=(n+1)%4,align:bn[n]});if(m){const e=1&y.startZone?"y":"x";t={[e]:m[e],edge:vn[(y.startZone+2)%4]}}if(b&&o&&(b.adjust(-o.width,-o.height,o.width,o.height),o.constrainTo(b)),s.minWidth=c.minWidth,s.minHeight=c.minHeight,f)s.moveTo(f.x,f.y),a&&s.constrainTo(a);else{const e="c"===y.myEdge||"c"===y.targetEdge,n=g&&!e?[g[1]+d[0],g[1]+d[1]]:d,l=o.getAlignmentPoint(y.targetAlignmentPoint,n),u=s.getAlignmentPoint(y.myAlignmentPoint);s.translate(l[0]-u[0],l[1]-u[1]);let m=s.intersect(o,!0);if(m)a&&s.constrainTo(a),r=y.startZone,s.translate(...n);else if(a&&!a.contains(s)){const e=s.clone(),l=[];let d,u;t=null,C[0]=d=a.clone(),d.bottom=o.y-n[1],C[1]=d=a.clone(),d.x=o.right+n[0],C[2]=d=a.clone(),d.y=o.bottom+n[1],C[3]=d=a.clone(),d.right=o.x-n[0];for(let e=0;e<w.length;e++){if(S&&2==e&&(s[S]=D),d=C[r=w[e].zone],s=s.alignTo({target:o,offsets:n,align:w[e].align}),s.constrainTo(d,!0)&&(l.push({result:s,zone:r}),!u||s.width<c.width||s.height<c.height)){s.align=w[e].align;break}if(!u||d.area>u.area){const e=s.clone();switch(r){case 0:e.moveTo(null,d.bottom-e.height);break;case 1:e.moveTo(d.left);break;case 2:e.moveTo(null,d.top);break;case 3:e.moveTo(d.right-e.width)}u={area:d.area,result:e,zone:r}}}l.length?(l.length>1&&!h&&l.sort(((t,n)=>Math.sqrt((e.x-t.result.x)**2+(e.y-t.result.y)**2)-Math.sqrt((e.x-n.result.x)**2+(e.y-n.result.y)**2))),s=l[0].result,r=l[0].zone):(s=u.result,r=u.zone,i&&s.constrainTo(a))}else r=y.startZone;if(s.zone=r,s.overlap=m=s.intersect(o,!0),g&&!m){if(!t){const e=1&r,n=e?"y":"x",i=e?"bottom":"right",a=Math.max(o[n],s[n]);let l=a+(Math.min(o[i],s[i])-a)/2-g[0]/2;const c=l+g[0];c>s[i]&&(l-=c-s[i]),l<s[n]&&(l+=s[n]-l),t={[n]:l-s[n],edge:vn[(r+2)%4]}}s.anchor=t}}return s}getAlignmentPoint(e,t=wn){const n=this,r=fn.exec(e),i=r[1].toLowerCase(),s=Math.min(Math.max(parseInt(r[2]||50),0),100)/100;switch(i){case"t":return[n.x+n.width*s,n.y-t[1]];case"r":return[n.right+t[0],n.y+n.height*s];case"b":return[n.x+n.width*s,n.bottom+t[1]];case"l":return[n.x-t[0],n.y+n.height*s];case"c":return[n.x+n.width/2,n.y+n.height/2]}}highlight(){const e=this,t=Mr.createElement({parent:document.body,style:`position:absolute;z-index:9999999;pointer-events:none;\n                            left:${e.x}px;top:${e.y}px;width:${e.width}px;height:${e.height}px`});return Mr.highlight(t).then((()=>t.remove()))}visualize(e,t){const n=this,r=f({style:f({left:`${n.x}px`,top:`${n.y}px`,width:`${n.width}px`,height:`${n.height}px`},e.class?{}:{position:"absolute","z-index":9999999})},e);return t?r:Mr.createElement(r)}toString(e=","){return[`${this.top}px`,`${this.right}px`,`${this.bottom}px`,`${this.left}px`].join(e)}}xn._$name="Rectangle";const Rn=Symbol("value"),Tn=Symbol("length");class Mn{static change(e,t,n,r="string"){n=Mn.normalize(n,"object");const i=Mn.normalize(e,"array").filter((e=>!n[e]));if(t){t=Mn.normalize(t,"array");for(let e=0;e<t.length;++e)i.includes(t[e])||i.push(t[e])}return Mn.normalize(i,r)}static from(e,t){var n,r;e&&(e.isDomClassList?t=null===(n=t)||void 0===n||n:(t=null!==(r=t)&&void 0!==r?r:Y.isObject(e)&&!Y.isEmpty(e),e=new Mn(e)),e.value||t||(e=null));return e||(t?new Mn:null)}static normalize(e,t="string"){const n=typeof(e=e||""),r="array"===t,i=!(r||"object"===t);let s,o,a,l="string"===n;var c;for("object"===n&&(e.nodeType===Element.ELEMENT_NODE&&"function"==typeof e.getAttribute?(e=e.getAttribute("class")||"",l=!0):null!==(c=e)&&void 0!==c&&c.isDomClassList?e=e.values:e instanceof DOMTokenList?e=Array.from(e):e instanceof Map?e=Array.from(e.keys()).filter((t=>e.get(t))):e instanceof Set?e=Array.from(e):Array.isArray(e)||(e=Y.getTruthyKeys(e))),l&&(e=[...new Set(_.split(e))]),o=e.length;o-- >0;)s=e[o],s.length?s.includes(" ")&&e.splice(o,1,..._.split(s)):e.splice(o,1);if(r)a=e;else if(i)a=e.join(" ");else for(a=Object.create(null),o=0;o<e.length;++o)a[e[o]]=!0;return a}constructor(...e){this.process(1,e)}clear(){for(const e in this)this[e]=!1;return this}set(...e){return this.clear().process(1,e)}get isDomClassList(){return!0}clone(){return new Mn(this)}contains(e){return!("string"!=typeof e||!e)&&Boolean(this[e])}toString(){return this.length?`${this.value} `:""}toJSON(){return this.toString()}trim(){return this.value}isEqual(e){const t=Mn.normalize(e,"array"),n=t.length;if(this.length===n){for(let e=0;e<n;e++)if(!this[t[e]])return!1;return!0}return!1}get value(){let e,t=this[Rn];return null==t&&(e=Y.getTruthyKeys(this),this[Tn]=e.length,this[Rn]=t=e.join(" ")),t}set value(e){const t=this,n=Object.keys(t),r=n.length;for(let e=0;e<r;e++)delete t[n[e]];e?t.process(1,[e]):delete t[Rn]}get values(){return Y.getTruthyKeys(this)}get length(){return this.value?this[Tn]:0}process(e,t){for(let n,r,i=0;i<t.length;i++)if(t[i])if(n=t[i],n.isDomClassList||Y.isObject(n))for(r in n)this[r]=e?n[r]:!n[r];else for(n=Mn.normalize(t[i],"array"),r=0;r<n.length;++r)this[n[r]]=e;return delete this[Rn],this}assign(e){for(const t in e)!this[t]!=!e[t]&&(this[t]=e[t],delete this[Rn]);return this}assignTo(e){const t=e.nodeType===Element.ELEMENT_NODE?e.classList:e,n=Mn.from(t);n.add(this),t.value=n.value}add(...e){return this.process(1,e)}remove(...e){return this.process(0,e)}toggle(e,t=Boolean(!this[e])){if(t=Boolean(t),Boolean(this[e])!==t)return this[e]=t,delete this[Rn],!0}split(){return Y.getTruthyKeys(this)}forEach(e){return Y.getTruthyKeys(this).forEach(e)}}Mn.prototype[Rn]=null,Mn._$name="DomClassList";class kn extends xn{static from(e){const t=e.changedTouches;return new kn(t?t[0].screenX:e.screenX,t?t[0].screenY:e.pageY)}constructor(e,t){super(e,t,0,0)}constrain(e){return this.x=Math.min(Math.max(this.x,e.x),e.right-1),this.y=Math.min(Math.max(this.y,e.y),e.bottom-1),this}toArray(){return[this.x,this.y]}}Object.getPrototypeOf(kn).Point=kn,kn._$name="Point";const In=["clientX","clientY","pageX","pageY","screenX","screenY"],An={element:1,thisObj:1,once:1,delegate:1,delay:1,capture:1,passive:1,throttled:1,autoDetach:1,expires:1,block:1},Fn=!0,On={configurable:Fn,value:!0},Ln={Spacebar:"Space",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown"},Pn={Meta:1,Control:1,Alt:1},$n=/^(ctrl|shift|alt|meta)$/;class _n{static normalizeEvent(e){return sn.copyPropertiesIf(e,e.changedTouches[0]||e.touches[0],In)}static getXY(e){return e.touches&&(e=e.touches[0]),[e.clientX,e.clientY]}static getDistanceBetween(e,t){const n=Nn.getXY(e),r=Nn.getXY(t);return Math.sqrt(Math.pow(n[0]-r[0],2)+Math.pow(n[1]-r[1],2))}static getPagePoint(e){return new xn.Point(e.pageX,e.pageY)}static getClientPoint(e){return new xn.Point(e.clientX,e.clientY)}static addListener(e,t,n,r){return r=e.nodeType?"string"==typeof t?Object.assign({element:e,[t]:n},r):Object.assign({element:e},t):e,Nn.on(r)}static on(e){const t=e.element,n=e.thisObj,r=[];for(const i in e)if(!An[i]){let s=e[i];"object"!=typeof s&&(s={handler:s});const o=s.element||t;y.isTouchDevice&&!y.isAndroid&&"contextmenu"===i&&r.push(Nn.addElementListener(o,"touchstart",{handler:Nn.createContextMenuWrapper(s.handler,s.thisObj||n)},e)),r.push(Nn.addElementListener(o,i,s,e))}const i=()=>{for(let e,t=0;t<r.length;t++)e=r[t],Nn.removeEventListener(e[0],e[1],e[2]);r.length=0};return n&&!1!==e.autoDetach&&(n.doDestroy=$e.createInterceptor(n.doDestroy,i,n)),i}static addElementListener(e,t,n,r){const i=Nn.createHandler(e,t,n,r),{spec:s}=i,o=n.expires||r.expires,a=null!=s.capture||null!=s.passive?{capture:s.capture,passive:s.passive}:void 0;if(e.addEventListener(t,i,a),o){const s=n.thisObj||r.thisObj,a=null!=s&&s.isDelayable?s:globalThis,{alt:l}=o,c=l?o.delay:o,{spec:d}=i;d.expires=o,d.timerId=a["number"==typeof c?"setTimeout":"requestAnimationFrame"]((()=>{d.timerId=null,Nn.removeEventListener(e,t,i),l&&!i.called&&("string"==typeof l?s[l]:l).call(s)}),c,`listener-timer-${performance.now()}`)}return[e,t,i,a]}static getComposedPathTarget(e){return e.composedPath()[0]||e.path[0]}static fixEvent(e){var t,n;if(e.fixed)return e;const{type:r,target:i}=e;if((null!=i&&i.shadowRoot||null!=i&&null!==(t=i.getRootNode)&&void 0!==t&&t.call(i).host)&&e.composedPath){const t=this.getComposedPathTarget(e),n=i;Object.defineProperty(e,"target",{value:t,configurable:Fn}),Object.defineProperty(e,"originalTarget",{value:n,configurable:Fn})}if(Object.defineProperty(e,"fixed",On),r.startsWith("key")){const t=Ln[e.key];t&&Object.defineProperty(e,"key",{value:t,configurable:Fn})," "!==e.key||e.code||Object.defineProperty(e,"code",{value:"Space",configurable:Fn})}if(e.metaKey&&!e.ctrlKey&&Object.defineProperty(e,"ctrlKey",On),i&&"offsetX"in e&&(Object.getOwnPropertyDescriptor(e,"borderOffsetX")||Object.defineProperty(e,"borderOffsetX",{get:()=>e.offsetX+(y.isSafari?0:parseInt(i.ownerDocument.defaultView.getComputedStyle(i).getPropertyValue("border-left-width")))}),Object.getOwnPropertyDescriptor(e,"borderOffsetY")||Object.defineProperty(e,"borderOffsetY",{get:()=>e.offsetY+(y.isSafari?0:parseInt(i.ownerDocument.defaultView.getComputedStyle(i).getPropertyValue("border-top-width")))})),(null==i?void 0:i.nodeType)===Element.DOCUMENT_NODE&&"clientX"in e){const t=Mr.elementFromPoint(e.clientX,e.clientY);Object.defineProperty(e,"target",{value:t,configurable:Fn})}if((null==i?void 0:i.nodeType)===Element.TEXT_NODE){const t=e.target.parentElement;Object.defineProperty(e,"target",{value:t,configurable:Fn})}if((null===(n=e.relatedTarget)||void 0===n?void 0:n.nodeType)===Element.TEXT_NODE){const t=e.target.parentElement;Object.defineProperty(e,"relatedTarget",{value:t,configurable:Fn})}return r.startsWith("touch")&&e.touches.length&&this.normalizeEvent(e),e}static createHandler(e,t,n,r){const i=n.delay||r.delay,s=n.throttled||r.throttled,o=n.block||r.block,a="once"in n?n.once:r.once,l="capture"in n?n.capture:r.capture,c="passive"in n?n.passive:r.passive,d="delegate"in n?n.delegate:r.delegate,u=n.handler,h=n.thisObj||r.thisObj,{rtlSource:g=h}=h||{};let m=(e,...t)=>{Nn.playingDemo&&e.isTrusted||null!=h&&h.isDestroyed||(e=Nn.fixEvent(e,null==g?void 0:g.rtl),m.called=!0,("string"==typeof u?h[u]:u).call(h,e,...t),delete e.target,delete e.relatedTarget,delete e.originalarget,delete e.key,delete e.code,delete e.ctrlKey,delete e.fixed)};if(o){const e=m;let t,n;m=(r,...i)=>{const s=performance.now();(!t||r.target!==n||s-t>o)&&(n=r.target,t=s,e(r,...i))}}if(null!=i){const e=m,t=null!=h&&h.setTimeout?h:globalThis;m=(...n)=>{t.setTimeout((()=>{e(...n)}),i)}}if(null!=s){let e,t=s;s.buffer&&(e=e=>s.alt.call(Nn,Nn.fixEvent(e,null==g?void 0:g.rtl)),t=s.buffer),m=null!=h&&h.isDelayable?h.throttle(m,{delay:t,throttled:e}):$e.createThrottled(m,t,h,null,e)}if(a){const n=m;m=(...r)=>{Nn.removeEventListener(e,t,m),n(...r)}}if(d){const e=m;m=(t,...n)=>{var r;const i=(null===(r=(t=Nn.fixEvent(t,null==g?void 0:g.rtl)).target.closest)||void 0===r?void 0:r.call)&&t.target.closest(d);i&&(Object.defineProperty(t,"currentTarget",{get:()=>i,configurable:!0}),e(t,...n))}}return n.thisObj&&!1!==n.autoDetach&&(h.doDestroy=$e.createInterceptor(h.doDestroy,(()=>Nn.removeEventListener(e,t,m)),h)),m.spec={delay:i,throttled:s,block:o,once:a,thisObj:h,capture:l,passive:c,delegate:d},m}static removeEventListener(e,t,n){const{expires:r,timerId:i,thisObj:s,capture:o}=n.spec;null!=r&&r.alt&&i&&(null!=s&&s.isDelayable?s:globalThis)["number"==typeof r.delay?"clearTimeout":"cancelAnimationFrame"](i),e.removeEventListener(t,n,o)}static onTransitionEnd({element:e,animationName:t,property:n,handler:r,mode:i=(t?"animation":"transition"),duration:s=Mr[`get${"transition"===i?"Property":""}${_.capitalize(i)}Duration`](e,n),thisObj:o=globalThis,args:a=[],timerSource:l,runOnDestroy:c}){let d;l=l||(o.isDelayable?o:globalThis);const u=[e,n,...a],h=()=>{g(),o.isDestroyed||(o.callback?o.callback(r,o,u):r.apply(o,u))},g=Nn.on({element:e,[`${i}end`]({animationName:r,propertyName:i,target:s}){s===e&&(i===n||null!=r&&r.match(t))&&(d&&(l.clearTimeout(d),d=null),h())}});return null!=s&&(d=l.setTimeout(h,s+50,"onTransitionEnd",c)),g}static async waitForTransitionEnd(e){return new Promise((t=>{e.handler=t,_n.onTransitionEnd(e)}))}static createContextMenuWrapper(e,t){return n=>{if(1===n.touches.length){const r=n.touches[0],i=setTimeout((()=>{o();const i=new MouseEvent("contextmenu",r);Object.defineProperty(i,"target",{get(){return r.target}}),"string"==typeof e&&(e=t[e]),i.browserEvent=n,e.call(t,i),Nn.contextMenuTouchId=r.identifier}),Nn.longPressTime),s=({clientX:e,clientY:t,type:n})=>{let s="touchend"===n||"pointerup"===n;if(!s){const n=Math.abs(e-r.clientX),i=Math.abs(t-r.clientY);s=n>=5||i>=5}s&&(Nn.contextMenuTouchId=null,o(),clearTimeout(i))},o=Nn.on({element:document,touchmove:s,touchend:s,pointermove:s,pointerup:s,capture:!0})}}}static createDblClickWrapper(e,t,n){let r,i,s;return()=>{i||(i=Nn.on({element:e,touchstart:e=>{r=e.changedTouches[0].identifier,e.preventDefault()},touchend:e=>{if(e.changedTouches[0].identifier===r){e.preventDefault(),clearTimeout(s),r=i=null;const o=xn.from(e.changedTouches[0].target,null,!0),a=e.changedTouches[0].pageX-o.x,l=e.changedTouches[0].pageY-o.y,c=Object.assign({browserEvent:e},e),d=new MouseEvent("dblclick",c);Object.defineProperties(d,{target:{value:e.target},offsetX:{value:a},offsetY:{value:l}}),"string"==typeof t&&(t=n[t]),t.call(n,d)}},once:!0}),s=setTimeout((()=>{i(),r=i=null}),Nn.dblClickTime))}}static toSpecialKey(e,t="ctrlKey"){let n=!1;return!0===e?n=t:"string"==typeof e&&(e=e.toLowerCase()).match($n)&&(n=`${e}Key`),n}}v(_n,"eventNameMap",{mousedown:"MouseDown",mouseup:"MouseUp",click:"Click",dblclick:"DblClick",contextmenu:"ContextMenu",mouseover:"MouseOver",mouseout:"MouseOut",keyup:"KeyUp",keydown:"KeyDown",keypress:"KeyPress"});const Nn=_n;Nn.longPressTime=500,Nn.dblClickTime=300,Nn.on({element:document,capture:!0,mousedown({target:e}){if(!Mr.isTouchEvent){var t;const n=Mr.getRootElement(e);Mr.usingKeyboard=!1,null===(t=n.classList)||void 0===t||t.remove("b-using-keyboard"),Mr.removeClsGlobally(n,"b-using-keyboard")}},touchmove({changedTouches:e}){var t;const n=e[0].target,r=Mr.getRootElement(n);Mr.usingKeyboard=!1,null===(t=r.classList)||void 0===t||t.remove("b-using-keyboard"),Mr.removeClsGlobally(r,"b-using-keyboard")},keydown({target:e,key:t}){if(!Pn[t]){Mr.usingKeyboard=!0;const t=Mr.getRootElement(e);t.nodeType===Node.DOCUMENT_FRAGMENT_NODE?Array.from(t.children).forEach((e=>{e.matches(".b-outer")&&e.classList.add("b-using-keyboard")})):t.classList.add("b-using-keyboard")}}}),y.isTouchDevice&&Nn.on({element:document,touchmove:e=>{e.target.closest(".b-dragging")&&e.preventDefault()},passive:!1,capture:!0}),_n._$name="EventHelper";const Hn={align:"t0-t0"},Bn=Node.ELEMENT_NODE,jn=Node.TEXT_NODE,{isObject:Vn}=sn,zn=/[+-]?\d*\.?\d+[eE]?-?\d*/g,Wn=zn.source,Un=new RegExp(`matrix\\((?:${Wn}),\\s?(?:${Wn}),\\s?(?:${Wn}),\\s?(?:${Wn}),\\s?(${Wn}),\\s?(${Wn})`),Yn=new RegExp("matrix3d\\((?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(-?\\d*),\\s?(-?\\d*)"),Gn=new RegExp(`(?:${Un.source})|(?:${Yn.source})`),qn=new RegExp(`translate(3d|X)?\\((${Wn})px(?:,\\s?(${Wn})px)?`),Kn=new RegExp(`translate(3d|Y)?\\((${Wn})px(?:,\\s?(${Wn})px)?`),Xn=/\s+/,Zn=/\s*;\s*/,Jn=/\s*:\s*/,Qn=/^-?((\d+(\.\d*)?)|(\.?\d+))$/,er={elementData:"",for:"htmlFor",retainElement:""},tr={tag:1,html:1,text:1,children:1,tooltip:1,style:1,dataset:1,parent:1,nextSibling:1,ns:1,reference:1,class:1,className:1,unmatched:1,onlyChildren:1,listeners:1,compareHtml:1,syncOptions:1,keepChildren:1},nr={length:1,parentRule:1,style:1},rr={INPUT:1,TEXTAREA:1},ir={BUTTON:1,IFRAME:1,EMBED:1,INPUT:1,OBJECT:1,SELECT:1,TEXTAREA:1,BODY:1},sr=globalThis,or=document,ar=Object.freeze({}),lr=Array.prototype.slice,cr=Promise.resolve(),dr=["font-size","font-size-adjust","font-style","font-weight","font-family","font-kerning","font-stretch","line-height","text-transform","text-decoration","letter-spacing","word-break"],ur=e=>e._hidden,hr=(e,t,n)=>"children"===n.key?sn.mergeItems(e,t,n):sn.blend(e,t,n),gr=e=>{const t=e.ownerDocument.defaultView.getComputedStyle(e);return"none"!==t.getPropertyValue("display")&&"hidden"!==t.getPropertyValue("visibility")},mr=or.documentElement.getRootNode?e=>e.getRootNode():e=>{for(;e.parentNode;)e=e.parentNode;return e},pr=e=>e&&(e===or.body||Boolean(e.offsetParent)||("offsetParent"in e&&"fixed"!==Mr.getStyleValue(e,"position")?e.offsetParent:pr(e.parentNode))),fr=e=>e&&(or.body.contains(e)||(wr=mr(e))&&(e=>e.host&&e.host instanceof Element)(wr)&&fr(wr.host)),vr=e=>e instanceof Node?e:"string"==typeof e?kr.createElementFromTemplate(e):kr.createElement(e),yr=Object.create(null),br=(e,t)=>{const n=yr[e]||[_.hyphenate(e),t];return yr[e]||(yr[n[0]]=yr[e]=n),n},Cr=/b-slide-in-from-\w+/;["top","right","bottom","left","width","height","maxWidth","maxHeight","minWidth","minHeight","borderSpacing","borderWidth","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","marginTop","marginRight","marginBottom","marginLeft","paddingTop","paddingRight","paddingBottom","paddingLeft","fontSize","letterSpacing","lineHeight","outlineWidth","textIndent","wordSpacing"].forEach((e=>br(e,!0)));let wr,Sr,Dr,Er,xr=null,Rr=0,Tr=null;class Mr{static async slideIn(e,t=1){const n="b-slide-in-"+(t>0?"next":"previous"),{classList:r}=e,{style:i}=e.parentNode,{overflow:s}=i;i.overflow="hidden",r.add(n),await _n.waitForTransitionEnd({element:e,animationName:Cr}),i.overflow=s,r.remove(n)}static isFocusable(e,t=!1){if(!t&&(!kr.isVisible(e)||kr.Widget.fromElement(e,ur)))return!1;const n=e.nodeName;return ir[n]||("A"===n||"LINK"===n)&&!!e.href||null!=e.getAttribute("tabIndex")||"true"===e.contentEditable}static isEditable(e){return e.isContentEditable||rr[e.nodeName]}static isInView(e,t=!1,n){if(!pr(e))return!1;const r=(null==n?void 0:n.positioned)&&"fixed"!==Mr.getStyleValue(n.element,"position"),i=xn.from(globalThis),s=t?"contains":"intersect",o=r&&n.element.offsetParent,a=r&&xn.from(o);if(i.height=or.scrollingElement.scrollHeight,e===or.body)return i;const l=this.getViewportIntersection(e,i,s);return l&&r&&l.translate(or.scrollingElement.scrollLeft,or.scrollingElement.scrollTop),r&&l?l.translate(-a.x+o.scrollLeft,-a.y+o.scrollTop):l}static getViewportIntersection(e,t,n){const{parentNode:r}=e,{parentElement:i}=r.nodeType===Node.DOCUMENT_FRAGMENT_NODE?e.getRootNode().host:e,s=i.ownerDocument.defaultView.getComputedStyle(i),o="visible"!==s.overflowX||"visible"!==s.overflowY,a=(l=e).ownerSVGElement?l.ownerSVGElement.parentNode:l.offsetParent;var l;let c=xn.from(e,null,!0);for(let r=o?e.parentNode:a;c&&r!==or.documentElement;r=r.parentNode){r.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&r.host&&(r=r.host.parentNode);const e=r===or.body,i=r.ownerDocument.defaultView.getComputedStyle(r),s=e?t:xn.inner(r,null,!0);(e||"visible"!==i.overflow)&&(c=s[n](c,!1,!0))}return c}static isVisible(e){const t=e.ownerDocument;for(;e;e=(n=e).parentNode||n.host){if(e===t)return!0;if(e.nodeType===e.ELEMENT_NODE&&!gr(e))return!1}var n;return!1}static isDOMEvent(e){return e instanceof Event}static merge(e,...t){return sn.blend(e,t,{merge:hr})}static normalizeChildren(e,t,n){var r;let i,s,o,a,l,c=null==e?void 0:e.children;if(null!=e&&null!==(r=e.syncOptions)&&void 0!==r&&r.ignoreRefs&&(n=!0),c&&!(e instanceof Node))if(Array.isArray(c))for(s=0;s<c.length;++s)kr.normalizeChildren(c[s],t,n);else for(o in a=c,e.children=c=[],a){var d;i=a[o],null!==(d=i)&&void 0!==d&&d.isWidget&&(i=i.element),l=!o.startsWith("$")&&!kr.isElement(i),l&&(null==t||t(o,!n)),i&&(i instanceof Node||(!1===i.reference?delete i.reference:l&&"string"!=typeof i&&(i.reference=o),kr.normalizeChildren(i,t,n)),c.push(i))}return e}static roundPx(e,t=globalThis.devicePixelRatio||1){const n=1/t;return Math.round(e/n)*n}static floorPx(e,t=globalThis.devicePixelRatio||1){const n=1/t;return Math.floor(e*n)/n}static isCustomElement(e){return Boolean(null==e?void 0:e.shadowRoot)}static elementFromPoint(e,t){let n=document.elementFromPoint(e,t);return kr.isCustomElement(n)&&(n=n.shadowRoot.elementFromPoint(e,t)||n),n}static childFromPoint(e,t,n,r=e){const i=null==n?t:new xn(t,n,0,0);let s=null;return Array.from(e.children).some((e=>{if(xn.from(e,r).contains(i))return s=e.children.length&&kr.childFromPoint(e,i,null,r)||e,!0})),s}static unitize(e,t,n="px"){const[r,i]=br(e);return null!=t&&(t=String(t),t=i&&Qn.test(t)?t+n:t),[r,t]}static get activeElement(){let e=document.activeElement;for(;e.shadowRoot;)e=e.shadowRoot.activeElement;return e}static getActiveElement(e){var t,n;null!==(t=e)&&void 0!==t&&t.isWidget&&(e=e.element);let r=((null===(n=e)||void 0===n?void 0:n.getRootNode())||document).activeElement;for(;null!==(i=r)&&void 0!==i&&i.shadowRoot;){var i;r=r.shadowRoot.activeElement}return r}static getRootElement(e){var t;const n=null===(t=e.getRootNode)||void 0===t?void 0:t.call(e),{nodeType:r}=n;return r===Node.DOCUMENT_NODE?n.body:r===Node.DOCUMENT_FRAGMENT_NODE?n:e.ownerDocument.contains(e)?e.ownerDocument.body:null}static getOutermostElement(e){var t,n;const r=null===(t=(n=e).getRootNode)||void 0===t?void 0:t.call(n);if(null!=r&&r.body)return null==r?void 0:r.body;for(;e.parentNode!==r&&e.parentNode;)e=e.parentNode;return e}static isValidFloatRootParent(e){return e===document.body||"ShadowRoot"===e.constructor.name}static getId(e){return e.id||(e.id="b-element-"+ ++Rr)}static getCommonAncestor(e,t){if(e===t)return e;for(;e&&!(null!==(n=(r=e)[e.isWidget?"owns":"contains"])&&void 0!==n&&n.call(r,t)||e===t);){var n,r;e=e.owner||e.parentNode}return e}static getElement(e){return e instanceof Element?e:or.querySelector(e)}static setAttributes(e,t){const n=kr.getElement(e);if(n&&t)for(const e in t)null==t[e]?n.removeAttribute(e):n.setAttribute(e,t[e])}static setLength(e,t,n){var r,i;return n=1===arguments.length?"number"==typeof e?`${e}px`:null!==(r=e)&&void 0!==r?r:"":(e=kr.getElement(e)).style[t]="number"==typeof n?`${n}px`:null!==(i=n)&&void 0!==i?i:""}static percentify(e,t=2){const n=Math.pow(10,t);return null==e||""===e||isNaN(e)?"":Math.round(e*n)/n+"%"}static getChild(e,t){return e.querySelector(":scope>"+t)}static hasChild(e,t){return null!=kr.getChild(e,t)}static children(e,t){return(">"===t[0]||t.startsWith("# "))&&("#"===t[0]&&(t=t.substr(2)),t=":scope "+t),Array.from(e.querySelectorAll(t))}static getChildElementCount(e){return e.childElementCount}static down(e,t){return e?e.matches&&e.matches(t)?e:(t=":scope "+t,e.querySelector(t)):null}static isDescendant(e,t){const n=kr.getRootElement(e),r=kr.getRootElement(t);return n!==r&&r.host?kr.isDescendant(n,r.host):e.contains(t)}static getEventElement(e,t="target"){return!e||kr.isElement(e)?e:e[t]}static isElement(e){return(null==e?void 0:e.nodeType)===document.ELEMENT_NODE&&kr.isNode(e)}static isNode(e){return Boolean(e)&&"number"==typeof e.nodeType&&!Vn(e)}static forEachSelector(e,t,n){if("string"==typeof e)throw new Error("DomHelper.forEachSelector must provide a root element context (for shadow root scenario)");kr.children(e,t).forEach(n)}static forEachChild(e,t){Array.from(e.children).forEach(t)}static removeEachSelector(e,t){kr.forEachSelector(e,t,(e=>e.remove()))}static removeClsGlobally(e,...t){t.forEach((t=>kr.forEachSelector(e,"."+t,(e=>e.classList.remove(t)))))}static isOrphaned(e){return!fr(e)}static up(e,t){return K.deprecate("Core","6.0.0","DomHelper.up() deprecated, use native `element.closest()` instead"),e.closest(t)}static getAncestor(e,t,n=null){let r,i=!1,s=e;for(t=ke.asArray(t);s=s.parentElement;){if(t.includes(s)){i=!0;break}if(n&&s===n)break;r=s}return i?r||e:null}static getParents(e){const t=[];for(;e.parentElement;)t.push(e.parentElement),e=e.parentElement;return t}static makeValidId(e,t=""){return _.makeValidDomId(e,t)}static createElement(e={},t){var n,r,i;let s,o,a,l,c,d,u,h,g,m,p,v=t;if("boolean"==typeof v)throw new Error("Clean up");t&&(c=t.ignoreRefs,g=t.refOwner,m=t.refs,v=t.returnAll,p=t.syncIdField,c&&(a=!0,c="children"!==c)),"string"==typeof e.parent&&(e.parent=document.getElementById(e.parent));const y=e.parent||e.nextSibling&&e.nextSibling.parentNode,{dataset:b,html:C,reference:w,syncOptions:S,text:D}=e;if(S&&(p=S.syncIdField||p,l=S.ignoreRefs,l&&(a=!0,c="children"!==l,t=f(f({},t),{},{ignoreRefs:!0}))),c&&(g=null),s=e.ns?or.createElementNS(e.ns,e.tag||"svg"):or.createElement(e.tag||"div"),null!=D?kr.setInnerText(s,D):null!=C&&(C instanceof DocumentFragment?s.appendChild(C):s.innerHTML=C),e.tooltip&&kr.Widget.attachTooltip(s,e.tooltip),e.style&&kr.applyStyle(s,e.style),b)for(u in b)h=b[u],null!=h&&(s.dataset[u]=h);y&&this.addChild(y,s,e.nextSibling),g&&(s.$refOwnerId=g.id),w&&!c&&(g?(s.$reference=w,g.attachRef(w,s,e)):(m||((t=Object.assign({},t)).refs=m={}),m[w]=s,s.setAttribute("data-reference",w)));const E=e.className||e.class,x=Object.keys(e);for(E&&s.setAttribute("class",Mn.normalize(E)),o=0;o<x.length;++o)u=x[o],h=e[u],null!=(d=er[u])?s[d||u]=h:!tr[u]&&u&&null!=h&&s.setAttribute(u,h);return e["aria-hidden"]||e.role||Mr.isFocusable(s,!0)||s.htmlFor||s.setAttribute("role","presentation"),null===(n=t)||void 0===n||null===(r=n.callback)||void 0===r||r.call(n,{action:"newElement",domConfig:e,targetElement:s,syncId:g?w:t.syncIdField&&(null===(i=e.dataset)||void 0===i?void 0:i[t.syncIdField])}),!0===v?t.returnAll=v=[s]:Array.isArray(v)&&v.push(s),e.children&&(p&&(s.syncIdMap={}),e.children.forEach((n=>{if(n)if("string"==typeof n){const e=document.createTextNode(n);g&&(e.$refOwnerId=g.id),s.appendChild(e)}else if(isNaN(n.nodeType)){var r,i,o;n.parent=s,!n.ns&&e.ns&&(n.ns=e.ns);const l=kr.createElement(n,f(f({},t),{},{ignoreRefs:null!==(r=null===(i=e.syncOptions)||void 0===i?void 0:i.ignoreRef)&&void 0!==r?r:a})),c=null===(o=n.dataset)||void 0===o?void 0:o[p];null!=c&&(s.syncIdMap[c]=l),delete n.parent}else s.appendChild(n)}))),s.lastDomConfig=e,m||v||s}static createElementFromTemplate(e,t=ar){const{array:n,raw:r,fragment:i}=t;let s;if(kr.supportsTemplate){if((Sr||(Sr=or.createElement("template"))).innerHTML=e,s=Sr.content,i)return s.cloneNode(!0)}else if(s=(Dr||(Dr=new DOMParser)).parseFromString(e,"text/html").body,i){const e=s.childNodes;for(s=document.createDocumentFragment();e.length;)s.appendChild(e[0]);return s}return s=r?s.childNodes:s.children,1!==s.length||n?lr.call(s):s[0]}static triggerMouseEvent(e,t="contextmenu"){const n=(this.isInView(e)||xn.from(e)).center,r=new MouseEvent(t,{clientX:n.x,clientY:n.y,bubbles:!0});e.dispatchEvent(r)}static insertFirst(e,t){return t&&t.nodeType!==Bn&&t.tag&&(t=kr.createElement(t)),e.insertBefore(t,e.firstElementChild)}static insertBefore(e,t,n){return t&&t.nodeType!==Bn&&t.tag&&(t=kr.createElement(t)),n?e.insertBefore(t,n):kr.insertFirst(e,t)}static insertAt(e,t,n){const r=Array.from(e.children);if(n>=r.length)return kr.append(e,t);const i=r[n];return kr.insertBefore(e,t,i)}static append(e,t){if(t.forEach){if(Array.isArray(t)&&(t=t.map((e=>vr(e)))),e.append)e.append(...t);else{const n=document.createDocumentFragment();t.forEach((function(e){n.appendChild(e)})),e.appendChild(n)}return t}return e.appendChild(vr(t))}static getTranslateX(e){const t=e.style.transform;let n=qn.exec(t);return n?parseFloat(n[2]):(n=Gn.exec(t)||Gn.exec(kr.getStyleValue(e,"transform")),n?parseFloat(n[1]||n[3]):0)}static getTranslateY(e){const t=e.style.transform;let n=Kn.exec(t);if(n){const e=parseFloat(n["Y"===n[1]?2:3]);return isNaN(e)?0:e}return n=Gn.exec(t)||Gn.exec(kr.getStyleValue(e,"transform")),n?parseFloat(n[2]||n[4]):0}static getTranslateXY(e){return[kr.getTranslateX(e),kr.getTranslateY(e)]}static getOffsetX(e,t=null){return t?e.getBoundingClientRect().left-t.getBoundingClientRect().left:e.offsetLeft}static getOffsetY(e,t=null){return t?e.getBoundingClientRect().top-t.getBoundingClientRect().top:e.offsetTop}static getOffsetXY(e,t=null){return[kr.getOffsetX(e,t),kr.getOffsetY(e,t)]}static focusWithoutScrolling(e){if(y.isSafari){const t=kr.getParents(e).map((e=>({element:e,scrollLeft:e.scrollLeft,scrollTop:e.scrollTop})));e.focus(),setTimeout((()=>function(e){e.forEach((({element:e,scrollLeft:t,scrollTop:n})=>{e.scrollLeft!==t&&(e.scrollLeft=t),e.scrollTop!==n&&(e.scrollTop=n)}))}(t)),0)}else e.focus({preventScroll:!0})}static getPageX(e){return e.getBoundingClientRect().left+sr.pageXOffset}static getPageY(e){return e.getBoundingClientRect().top+sr.pageYOffset}static getExtremalSizePX(e,t){const n=_.hyphenate(t),r=n.split("-")[1];let i=kr.getStyleValue(e,n);return i=/%/.test(i)?e.parentElement?parseInt(kr.getStyleValue(e.parentElement,r),10):NaN:parseInt(i,10),i}static setScale(e,t,n=t){const r=kr.getStyleValue(e,"transform").split(/,\s*/);r.length>1?(r[0].startsWith("matrix3d")?(r[0]=`matrix3d(${t}`,r[5]=n):(r[0]=`matrix(${t}`,r[3]=n),e.style.transform=r.join(",")):e.style.transform=`scale(${t}, ${n})`}static setTranslateX(e,t){const n=kr.getStyleValue(e,"transform").split(/,\s*/);t=kr.roundPx(t),n.length>1?(n[n[0].startsWith("matrix3d")?12:4]=t,e.style.transform=n.join(",")):e.style.transform=`translateX(${t}px)`}static setTranslateY(e,t){const n=kr.getStyleValue(e,"transform").split(/,\s*/);t=kr.roundPx(t),n.length>1?(n[n[0].startsWith("matrix3d")?13:5]=t,e.style.transform=n.join(",")+")"):e.style.transform=`translateY(${t}px)`}static setTop(e,t){kr.setLength(e,"top",t)}static setLeft(e,t){kr.setLength(e,"left",t)}static setTopLeft(e,t,n){kr.setLength(e,"top",t),kr.setLength(e,"left",n)}static setTranslateXY(e,t,n){if(null==t)return kr.setTranslateY(e,n);if(null==n)return kr.setTranslateX(e,t);t=kr.roundPx(t),n=kr.roundPx(n);const r=kr.getStyleValue(e,"transform").split(/,\s*/),i=r[0].startsWith("matrix3d");r.length>1?(r[i?12:4]=t,r[i?13:5]=n,e.style.transform=r.join(",")+")"):e.style.transform=`translate(${t}px, ${n}px)`}static addTranslateX(e,t){kr.setTranslateX(e,kr.getTranslateX(e)+t)}static addTranslateY(e,t){kr.setTranslateY(e,kr.getTranslateY(e)+t)}static addLeft(e,t){kr.setLeft(e,kr.getOffsetX(e)+t)}static addTop(e,t){kr.setTop(e,kr.getOffsetY(e)+t)}static alignTo(e,t,n=Hn,r){t=t instanceof xn?t:xn.from(t,!0);const i=kr.getTranslateXY(e),s=xn.from(e,!0);r&&(s.roundPx(),t.roundPx());const o=s.alignTo(Object.assign(n,{target:t}));kr.setTranslateXY(e,i[0]+o.x-s.x,i[1]+o.y-s.y)}static getStyleValue(e,t,n,r){const i=n?e.style:e.ownerDocument.defaultView.getComputedStyle(e,r);if(Array.isArray(t)){const e={};for(const n of t)e[n]=i.getPropertyValue(_.hyphenate(n));return e}return i.getPropertyValue(_.hyphenate(t))}static getEdgeSize(e,t,n){const r="border"===t?"-width":"",i={raw:{}};for(const s of["top","right","bottom","left"])n&&!n.includes(s[0])||(i[s]=parseFloat(i.raw[s]=kr.getStyleValue(e,`${t}-${s}${r}`)));return i.width=(i.left||0)+(i.right||0),i.height=(i.top||0)+(i.bottom||0),i}static parseStyle(e){if("string"==typeof e){const t=e.split(Zn);e={};for(let n=0,{length:r}=t;n<r;n++){const r=t[n].split(Jn);e[r[0]]=r[1]}}return e||{}}static applyStyle(e,t,n=!1){if("string"==typeof t)n?(t.length||e.style.cssText.length)&&(e.style.cssText=t):e.style.cssText+=t;else if(t){let r,i;for(r in n&&(e.style.cssText=""),t.style&&"string"!=typeof t.style&&(t=sn.assign({},t,t.style)),t)nr[r]||([r,i]=kr.unitize(r,t[r]),e.style.setProperty(r,i));"string"==typeof t.style&&(e.style.cssText+=t.style)}}static getCSSText(e){if("string"==typeof e)return e;let t="";for(const n in e)nr[n]||(t+=`${_.hyphenate(n)}:${e[n]};`);return t}static addClasses(e,t){K.deprecate("Core","6.0.0","DomHelper.addClasses should be replaced by native classList.add"),e.classList.add(...t)}static removeClasses(e,t){K.deprecate("Core","6.0.0","DomHelper.removeClasses should be replaced by native classList.remove"),e.classList.remove(...t)}static toggleClasses(e,t,n=null){t=ke.asArray(t),!0===n?e.classList.add(...t):!1===n?e.classList.remove(...t):t.forEach((t=>e.classList.toggle(t)))}static addTemporaryClass(e,t,n,r=globalThis){n>0&&(e.classList.add(t),r.setTimeout({fn:t=>e.classList.remove(t),delay:n,name:t,args:[t],cancelOutstanding:!0}))}static getPropertyTransitionDuration(e,t){const n=globalThis.getComputedStyle(e),r=n.transitionProperty.split(", "),i=n.transitionDuration.split(", "),s=r.indexOf(_.hyphenate(t));let o;return-1!==s&&(o=1e3*parseFloat(i[s])),o}static getAnimationDuration(e){return 1e3*parseFloat(kr.getStyleValue(e,"animation-duration"))}static highlight(e,t=globalThis){return e instanceof xn?e.highlight():new Promise((n=>{t.setTimeout((()=>{e.classList.add("b-fx-highlight"),t.setTimeout((()=>{e.classList.remove("b-fx-highlight"),n()}),1e3)}),0)}))}static get scrollBarWidth(){if(null===xr&&or.body){const e=Er||(Er=kr.createElement({parent:or.body,style:"position:absolute;top:-9999em;height:100px;overflow-y:scroll"}));e.parentNode!==or.body&&or.body.appendChild(e),xr=e.offsetWidth}return xr}static get scrollBarPadElement(){return{className:"b-yscroll-pad",children:[{className:"b-yscroll-pad-sizer"}]}}static resetScrollBarWidth(){xr=null}static measureText(e,t,n=!1,r){const i=kr.getMeasureElement(t,r);i[n?"innerHTML":"innerText"]=e;const s=i.clientWidth;return i.className="",s}static measureSize(e,t,n=!0){if(!e)return 0;if("number"==typeof e)return e;if(!e.length)return 0;if(/^\d+(px)?$/.test(e))return parseInt(e);if(t){const r=kr.getMeasureElement(t);r.innerHTML="",r.style.width=kr.setLength(e);const i=n?r.offsetWidth:r.getBoundingClientRect().width;return r.style.width=r.className="",i}return/^\d+em$/.test(e)?14*parseInt(e):isNaN(e)?0:parseInt(e)}static getMeasureElement(e,t=or.body){const n=sr.getComputedStyle(e),r=t.offScreenDiv=t.offScreenDiv||kr.createElement({parent:t,style:"position:fixed;top:-10000px;left:-10000px;visibility:hidden;contain:strict",className:"b-measure-element",children:[{style:"white-space:nowrap;display:inline-block;will-change:contents;width:auto;contain:none"}]},{returnAll:!0})[1];return dr.forEach((e=>{r.style[e]!==n[e]&&(r.style[e]=n[e])})),r.className=e.className,r.parentElement.parentElement!==t&&t.appendChild(r.parentElement),r}static stripTags(e){return(kr.$domParser||(kr.$domParser=new DOMParser)).parseFromString(e,"text/html").body.textContent}static sync(e,t){if("string"==typeof e){if(""===e)return void(t.innerHTML="");e=kr.createElementFromTemplate(e)}return kr.performSync(e,t),t}static performSync(e,t){return e.outerHTML!==t.outerHTML&&(kr.syncAttributes(e,t),kr.syncContent(e,t),kr.syncChildren(e,t),!0)}static getSyncAttributes(e){const t={},n=[];for(let r=0;r<e.attributes.length;r++){const i=e.attributes[r];if(i.specified){const e=i.name.toLowerCase();t[e]=i.value,n.push(e)}}return{attributes:t,names:n}}static syncAttributes(e,t){const{attributes:n,names:r}=kr.getSyncAttributes(e),{attributes:i,names:s}=kr.getSyncAttributes(t),o=r.includes("dataset"),a=r.filter((e=>!s.includes(e))),l=s.filter((e=>!(r.includes(e)||o&&e.startsWith("data-")))),c=r.filter((e=>s.includes(e)));if(a.length>0)for(let e=0;e<a.length;e++){const r=a[e];"style"===r?kr.applyStyle(t,n.style,!0):"dataset"===r?Object.assign(t.dataset,n.dataset):t.setAttribute(r,n[r])}if(l.length>0)for(let e=0;e<l.length;e++)t.removeAttribute(l[e]);if(c.length>0)for(let e=0;e<c.length;e++){const r=c[e];if("style"===r)kr.applyStyle(t,n.style,!0);else if("dataset"===r)Object.assign(t.dataset,n.dataset);else if("class"!==r||!n.class.isDomClassList&&"object"!=typeof n.class)i[r]!==n[r]&&t.setAttribute(r,n[r]);else{let e;e=n.class.isDomClassList?n.class:new Mn(n.class),e.isEqual(i.class)||t.setAttribute("class",e)}}}static syncContent(e,t){0===kr.getChildElementCount(e)&&(t.innerText=e.innerText)}static setInnerText(e,t){const{firstChild:n}=e;(null==n?void 0:n.nodeType)===Element.TEXT_NODE?n.data=t:e.textContent=t}static syncChildren(e,t){const n=this,r=lr.call(e.childNodes),i=lr.call(t.childNodes);for(;r.length;){const e=r.shift(),s=i.shift();if(e&&e.nodeType!==jn&&e.nodeType!==Bn)throw new Error(`Source node type ${e.nodeType} not supported by DomHelper.sync()`);if(s&&s.nodeType!==jn&&s.nodeType!==Bn)throw new Error(`Target node type ${s.nodeType} not supported by DomHelper.sync()`);if(s)if(e.nodeType===s.nodeType)e.nodeType===jn?s.data=e.data:e.tagName===s.tagName?n.performSync(e,s):(t.insertBefore(e,s),s.remove());else{if(e.nodeType!==jn||s.nodeType!==Bn){const t=e.parentElement||e;throw new Error(`Currently no support for transforming nodeType.\n${t.outerHTML}`)}t.innerText=e.data.trim()}else t.appendChild(e)}i.forEach((e=>{e.remove()}))}static syncClassList(e,t){const{classList:n}=e,r="string"==typeof t,i=r?t.split(Xn):Mn.normalize(t,"array"),s=i.length;let o,a=n.length!==s;for(o=0;!a&&o<s;o++)a=!n.contains(i[o]);return a&&(e.className=r?t:i.join(" ")),a}static updateClassList(e,t){const{classList:n}=e;let r,i,s=!1;for(r in t)i=Boolean(t[r]),n.contains(r)!==i&&(n[i?"add":"remove"](r),s=!0);return s}static setTheme(e,t){e=e.toLowerCase();const{head:n}=document,r=kr.getThemeInfo(t).name.toLowerCase();let i=n.querySelectorAll("[data-bryntum-theme]:not([data-loading])"),s=0;if(r===e)return cr;kr.removeEachSelector(n,"#bryntum-theme[data-loading],link[data-bryntum-theme][data-loading]");const o={theme:e,prev:r};function a(t,n,a){const l=Mr.createElement({tag:"link",rel:"stylesheet",dataset:{loading:!0,bryntumTheme:!0},href:t.href.replace(r,e),nextSibling:t});l.addEventListener("load",(()=>{delete l.dataset.loading,Tr=null,++s===i.length&&(i.forEach((e=>e.remove())),zr.trigger("theme",o),n(o))})),l.addEventListener("error",(e=>{delete l.dataset.loading,a(e)}))}if(i.length)return new Promise(((e,t)=>{i.forEach(((n,r)=>{a(n,e,t,i.length)}))}));{const e=n.querySelector("#bryntum-theme:not([data-loading])")||n.querySelector(`[href*="${r}.css"]:not([data-loading])`);if(null==e||!e.href.includes(`${r}.css`))throw new Error(`Theme link for ${r} not found`);return i=[e],new Promise(((t,n)=>a(e,t,n)))}}static get themeInfo(){return Mr.getThemeInfo()}static getThemeInfo(e){if(!Tr){const t=kr.createElement({parent:document.body,className:"b-theme-info"}),n=kr.getStyleValue(t,"content",!1,":before");if(n)try{Tr=JSON.parse(n.replace(/^["']|["']$|\\/g,""))}catch(e){Tr=null}Tr=Tr||(e?{name:e}:null),t.remove()}return Tr}static async transition({element:e,selector:t="[data-dom-transition]",duration:n,action:r,thisObj:i=this,addTransition:s={},removeTransition:o={}}){const a=new Set,l=Array.from(e.querySelectorAll(t)),c=new Map(l.map((t=>{let n=0,r=t.parentElement;for(;r&&r!==e;)n++,r=r.parentElement;t.$depth=n,t.scrollHeight>t.offsetHeight&&"auto"===getComputedStyle(t).overflow&&(t.$scrollTop=t.scrollTop,a.add(t));const{parentElement:i}=t,s=xn.from(t,e),o=xn.from(t,i),l=getComputedStyle(i),c=parseFloat(l.borderLeftWidth);return c&&(s.left-=c,o.left-=c),[t.id,{element:t,globalBounds:s,localBounds:o,depth:n,parentElement:i}]})));r.call(i);const d=Array.from(e.querySelectorAll(t)),u=new Map(d.map((t=>{const n=xn.from(t,e),r=xn.from(t,t.parentElement),i=globalThis.getComputedStyle(t.parentElement),s=parseFloat(i.borderLeftWidth);return s&&(n.left-=s,r.left-=s),[t.id,{element:t,globalBounds:n,localBounds:r}]}))),h=["position","top","left","width","height","padding","margin","zIndex","minWidth","minHeight","opacity","overflow"];for(const[t,n]of c){const r=u.get(t);if(r){const{element:t}=r,{style:i,parentElement:s}=t,o=parseInt(kr.getStyleValue(t,"zIndex")),{globalBounds:l,localBounds:c,depth:d,parentElement:u}=n,g=u!==s;let m;sn.copyProperties(t.$initial={parentElement:s},i,h),g?(r.bounds=r.globalBounds,m=l,e.appendChild(t)):(r.bounds=r.localBounds,m=c,u.appendChild(t));let p="hidden";a.has(t)&&(t.$scrollPlaceholder=kr.createElement({parent:t,style:{height:t.scrollHeight}}),p="auto"),Object.assign(i,{position:"absolute",top:`${m.top}px`,left:`${m.left}px`,width:`${m.width}px`,height:`${m.height}px`,minWidth:0,minHeight:0,padding:0,margin:0,zIndex:d+(o||0),overflow:p}),r.processed=!0}else{const{element:e,localBounds:r,depth:i,parentElement:s}=n;e.$initial={removed:!0},Object.assign(e.style,{position:"absolute",top:`${r.top}px`,left:`${r.left}px`,width:`${r.width}px`,height:`${r.height}px`,minWidth:0,minHeight:0,padding:0,margin:0,zIndex:i,overflow:"hidden"}),s.appendChild(e),u.set(t,{element:e,bounds:r,removed:!0,processed:!0}),d.push(e)}}for(const[,e]of u)if(!e.processed){const{element:t}=e,{style:n,parentElement:r}=t,i=e.bounds=e.localBounds;t.classList.add("b-dom-transition-adding"),sn.copyProperties(t.$initial={parentElement:r},n,h),Object.assign(n,{position:"absolute",top:s.top?0:`${i.top}px`,left:s.left?0:`${i.left}px`,width:s.width?0:`${i.width}px`,height:s.height?0:`${i.height}px`,opacity:s.opacity?0:null,zIndex:r.$depth+1,overflow:"hidden"})}for(const e of a)e.scrollTop=e.$scrollTop;e.classList.add("b-dom-transition"),e.firstElementChild.offsetWidth;for(const[,{element:e,bounds:t,removed:n}]of u)n?Object.assign(e.style,{top:o.top?0:`${t.top}px`,left:o.left?0:`${t.left}px`,width:o.width?0:`${t.width}px`,height:o.height?0:`${t.height}px`,opacity:o.opacity?0:e.$initial.opacity}):Object.assign(e.style,{top:`${t.top}px`,left:`${t.left}px`,width:`${t.width}px`,height:`${t.height}px`,opacity:e.$initial.opacity});await nt.sleep(n),e.classList.remove("b-dom-transition");for(const e of d)e.$initial&&(e.$initial.removed?e.remove():(sn.copyProperties(e.style,e.$initial,h),e.$scrollPlaceholder&&(e.$scrollPlaceholder.remove(),delete e.$scrollPlaceholder),e.classList.remove("b-dom-transition-adding"),e.$initial.parentElement.appendChild(e)));for(const e of a)e.scrollTop=e.$scrollTop,delete e.$scrollTop}static async loadScript(e){return new Promise(((t,n)=>{const r=document.createElement("script");r.src=e,r.onload=t,r.onerror=n,document.head.appendChild(r)}))}static isNamedColor(e){return e&&!/^(#|hsl|rgb)/.test(e)}static get NodeFilter(){return NodeFilter}static addChild(e,t,n){e.insertBefore(t,n)}}const kr=Mr;let Ir;const Ar=()=>kr.isTouchEvent=!1,Fr=()=>{kr.isTouchEvent=!0,clearTimeout(Ir),Ir=setTimeout(Ar,400)};if(or.addEventListener("touchstart",Fr,!0),or.addEventListener("touchend",Fr,!0),kr.canonicalStyles=yr,kr.supportsTemplate="content"in or.createElement("template"),kr.elementPropKey="$bryntum",kr.numberRe=zn,!("children"in Node.prototype)){const e=e=>e.nodeType===e.ELEMENT_NODE;Object.defineProperty(Node.prototype,"children",{get:function(){return Array.prototype.filter.call(this.childNodes,e)}})}Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){const t=(this.document||this.ownerDocument).querySelectorAll(e);let n=t.length;for(;--n>=0&&t.item(n)!==this;);return n>-1}),sr.Element&&!Element.prototype.closest?Node.prototype.closest=Element.prototype.closest=function(e){let t=this;if(!or.documentElement.contains(t))return null;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&t.nodeType===t.ELEMENT_NODE);return null}:Node.prototype.closest=function(e){var t;return null===(t=this.parentNode)||void 0===t?void 0:t.closest(e)},[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach((function(e){Object.prototype.hasOwnProperty.call(e,"remove")||Object.defineProperty(e,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode&&this.parentNode.removeChild(this)}})})),globalThis.addEventListener("resize",(()=>xr=null)),Mr._$name="DomHelper";const Or=e=>e.floating,Lr=new class extends(Te.mixin(tt)){suspendFocusEvents(){jr=!0}resumeFocusEvents(){jr=!1}setupFocusListenersOnce(e,t){e&&!Lr.observedElements.has(e)&&(Lr.setupFocusListeners(e,t),Lr.observedElements.add(e))}setupFocusListeners(e=document,t,n=!1){var r;const i={element:e,touchstart(e){$r=$r||1!==e.changedTouches.length?null:e.changedTouches[0]},touchend:{handler:e=>{$r&&($r.identifier===t.contextMenuTouchId?(e.stopImmediatePropagation(),e.preventDefault()):1===e.changedTouches.length&&e.changedTouches[0].identifier===$r.identifier&&Lr.trigger("globaltap",{event:e}),$r=null)},passive:!1},mousedown:{handler:e=>{_r="mouse",$r||Lr.trigger("globaltap",{event:e}),Hr=e},passive:!1},mouseup(e){Hr=null},keydown(e){_r="key",Nr=e},keypress(){_r="key"},keyup(){Nr=null},focusin(e){const{Widget:t}=Lr;if(t.resetFloatRootScroll(),jr)return;const n=e.relatedTarget?e.relatedTarget instanceof HTMLElement?e.relatedTarget:document.body:null,r=e.target||document.body,i=t.fromElement(n),s=t.fromElement(r),o=Mr.getCommonAncestor(i,s),a=!!(n&&4&r.compareDocumentPosition(n)),l=t.query(Pr);let c=null;if(c=r&&r!==document.body?Mr.getActiveElement(r):Mr.getActiveElement(document),l&&!l._isRevertingFocus&&(!s||!l.owns(s)&&!(4&l.element.compareDocumentPosition(s.element)&&s.up(Or))))return l.focus();let d=Vr("focusout",n,e.target,i,s,a);for(let t,n=i;n&&n!==o;n=t)if(t=n.owner,!n.isDestroying&&n.onFocusOut&&(n.onFocusOut(d),e.target&&c!==Mr.getActiveElement(e.target)))return;if(o&&e.target===o.element)!o.isDestroying&&Mr.getActiveElement(o)===r&&o.focusElement&&o.focusElement!==o.element&&(o.element.contains(c)&&!o.focusDescendant||o.setTimeout((()=>{var e;return null===(e=o.focus)||void 0===e?void 0:e.call(o)}),0));else{d=Vr("focusin",r,n,i,s,a);for(let e=s;e&&e!==o;e=e.owner){var u,h;e.isDestroying||null===(u=(h=e).onFocusIn)||void 0===u||u.call(h,d)}}const g=Mr.getCommonAncestor((null==n?void 0:n.nodeType)===Element.ELEMENT_NODE?n:null,r)||r.parentNode;g&&(d=Vr("focusmove",r,n,i,s,a,{bubbles:!0}),g.dispatchEvent(d))},focusout(e){if(!(jr||e.relatedTarget&&Lr.Widget.fromElement(e.relatedTarget))){const t=e.relatedTarget&&e.relatedTarget instanceof HTMLElement?e.relatedTarget:null;i.focusin({target:t,relatedTarget:e.target}),Nr=Hr=null}},capture:!0,passive:!0};n&&(null===(r=Br)||void 0===r||r()),Br=t.on(i)}get lastInteractionType(){return _r}get shiftKeyDown(){var e;return null===(e=Nr)||void 0===e?void 0:e.shiftKey}get ctrlKeyDown(){var e,t;return(null===(e=Nr)||void 0===e?void 0:e.ctrlKey)||(null===(t=Nr)||void 0===t?void 0:t.metaKey)}get altKeyDown(){var e;return null===(e=Nr)||void 0===e?void 0:e.altKey}isKeyDown(e){var t;return e?(null===(t=Nr)||void 0===t?void 0:t.key)===e||!0===Nr[(null==e?void 0:e.toLowerCase())+"Key"]:Boolean(Nr)}isMouseDown(e=0){var t;return(null===(t=Hr)||void 0===t?void 0:t.button)===e}get currentMouseDown(){return Hr}get currentKeyDown(){return Nr}},Pr=e=>e.isVisible&&e.isTopModal;Lr.observedElements=new Set;let $r,_r,Nr,Hr,Br,jr=!1;function Vr(e,t,n,r,i,s,o){const a=new CustomEvent(e,o);return Object.defineProperty(a,"_target",{get(){return t}}),Object.defineProperty(a,"relatedTarget",{get(){return n}}),a.fromWidget=r,a.toWidget=i,a.backwards=s,a}var zr=Lr;class Wr extends(Te.mixin(tt,pt)){static get configurable(){return{clientListeners:null,disabled:!1,client:null,keyMap:null}}updateClient(e){this.owner||(this.owner=e)}updateKeyMap(e){const{client:t}=this;t.keyMap=t.mergeKeyMaps(t.keyMap,e,_.uncapitalize(this.constructor.$name))}static initPlugins(e,...t){const n=e.plugins||(e.plugins={});for(const r of t)n[r.$$name]=new r(e)}get enabled(){return!this.disabled}getFocusRevertTarget(){var e;return null===(e=this.client)||void 0===e?void 0:e.getFocusRevertTarget()}construct(...e){const t=this;let n,[r,i]=e;1===e.length?sn.isObject(r)&&(i=r,r=i.client):(i=sn.assign({},i),delete i.client),t.client=r,super.construct(i),t.applyPluginConfig(r),n=t.clientListeners,n&&(n=sn.assign({},n),n.thisObj=t,r.on(n))}applyPluginConfig(e){const t=this,n=t.pluginConfig||t.constructor.pluginConfig;if(n){const{assign:r,chain:i,after:s,before:o,override:a}=n;r&&t.applyAssign(e,r),(i||s)&&t.applyChain(e,i||s),o&&t.applyChain(e,o,!1),a&&t.applyOverride(e,a)}}applyAssign(e,t){t.forEach((t=>this.assign(e,t)))}applyChain(e,t,n=!0){if(Array.isArray(t))for(const r of t)this.chain(e,r,r,n);else for(const r in t)this.chain(e,r,t[r],n)}applyOverride(e,t){const n=this;n.overridden||(n.overridden={}),t.forEach((t=>{if(!n[t])throw new Error(`Trying to chain fn ${e.$$name}#${t}, but plugin fn ${n.$$name}#${t} does not exist`);"function"==typeof e[t]&&(n.overridden[t]=e[t].bind(e)),e[t]=n[t].bind(n)}))}assign(e,t){const n=this,r=function(e,t){const n=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),t);return n&&(n.get||n.set)?n:null}(n,t);r?Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:r.get&&r.get.bind(n),set:r.set&&r.set.bind(n)}):e[t]=n[t].bind(n)}chain(e,t,n,r=!0){let i=0;"object"==typeof t&&(t=t.fn),"object"==typeof n&&(i=n.prio||0,n=n.fn);const s=this,o=e.pluginFunctionChain||(e.pluginFunctionChain={}),a=s[n]&&s[n].bind(s),l=s.functionChainRunner;if(!a)throw new Error(`Trying to chain fn ${e.$$name}#${n}, but plugin fn ${s.$$name}#${n} does not exist`);if(!o[t]){let n=e[t];n&&(n=n.bind(e),n.$this=e,n.$prio=0),o[t]=n?[n]:[],e[t]=(...e)=>l(o[t],e)}a.$this=s,a.$prio=i,o[t][r?"push":"unshift"](a),o[t].$sorted=!1}functionChainRunner(e,t){let n,r,i;for(e.$sorted||(e.sort(((e,t)=>t.$prio-e.$prio)),e.$sorted=!0),r=0;r<e.length&&(n=e[r],n.$this.isDestroyed||(i=n(...t),!1!==i));r++);return i}doDisable(e){const t=this,{constructor:n}=t,r="featureClass"in n?n.featureClass:`b-${n.$$name.toLowerCase()}`;var i,s;r&&(null===(i=t.client)||void 0===i||null===(s=i.element)||void 0===s||s.classList[e?"remove":"add"](r)),t.isConfiguring||(e?t.trigger("disable"):t.trigger("enable"))}updateDisabled(e){this.doDisable(e)}throwOverrideIsMissing(e){throw new Error(`Trying to override fn ${e.plugIntoName}#${e.fnName}, but plugin fn ${e.pluginName}#${e.fnName} does not exist`)}get rootElement(){return this.client.rootElement}}v(Wr,"$name","InstancePlugin"),Wr._$name="InstancePlugin";var Ur=e=>class extends(e||Te){static get $name(){return"Pluggable"}get plugins(){return this._plugins||(this._plugins={}),this._plugins}set plugins(e){e&&(Array.isArray(e)||(e=[e]),Wr.initPlugins(this,...e)),this.initPlugins()}initPlugins(){}addPlugins(...e){Wr.initPlugins(this,...e)}hasPlugin(e){return null!=this.getPlugin(e)}getPlugin(e){var t;return"function"==typeof e&&(e=e.$$name),null===(t=this.plugins)||void 0===t?void 0:t[e]}get widgetClass(){}};const{defineProperty:Yr}=Reflect;let Gr;Gr=y.isBrowserEnv?globalThis.performance:{now(){return(new Date).getTime()}};let qr=null;if(K.isTestEnv){const e=globalThis.bryntum||(globalThis.bryntum={});qr=e.globalDelays={timeouts:new Map,intervals:new Map,animationFrames:new Map,idleCallbacks:new Map,isEmpty(e=!1){return qr.timeouts.size+qr.animationFrames.size+qr.idleCallbacks.size+(e?qr.intervals.size:0)===0},getFiltered({ignoreTimeouts:e=[],maxDelay:t=5e3,includeIntervals:n=!1}){const r=[],i=["timeouts","animationFrames","idleCallbacks"];n&&i.push("intervals");for(const n of i){const i=qr[n];for(const[,n]of i.entries())e.includes(n.name)||Number.isInteger(n.delay)&&!(n.delay<t)||r.push(n)}return r}}}const Kr=(e,t,n,r)=>{const i="string"==typeof t,s=(null==r?void 0:r.appendArgs)||[],o=()=>{n.timerId=null,n.lastCallTime=Gr.now();const r=n.args;n.args=null,i?e[t](...r,...s):t.call(e,...r,...s),n.called=!0,++n.calls};return r&&(e=r.thisObj||e),n.lastCallTime=-9e9,n.calls=0,n.invoker=o,o.wrapFn=n,o},Xr=(e,t,n="clearTimeout")=>(t.cancel=()=>{t.isPending&&(e[n](t.timerId),t.args=t.timerId=null)},t.flush=()=>{t.isPending&&(e[n](t.timerId),t.timerId=null,t.invoker())},t.now=(...e)=>{t.cancel(),t.args=e,t.invoker()},t.resume=e=>{const n=t.suspended;t.suspended=e||n<1?0:n-1},t.suspend=()=>{++t.suspended},t.immediate=!1,t.suspended=0,t.timerId=null,Yr(t,"isPending",{get(){return null!==t.timerId}}),t);var Zr=e=>class extends(e||Te){static get $name(){return"Delayable"}static get declarable(){return["delayable"]}doDestroy(){const e=this;super.doDestroy(),e.timeoutIds&&(e.timeoutIds.forEach(((e,t)=>{var n;"function"==typeof e&&e(),clearTimeout(t),null===(n=qr)||void 0===n||n.timeouts.delete(t)})),e.timeoutIds=null),e.timeoutMap&&(e.timeoutMap.forEach(((e,t)=>clearTimeout(t))),e.timeoutMap=null),e.intervalIds&&(e.intervalIds.forEach((e=>{var t;clearInterval(e),null===(t=qr)||void 0===t||t.intervals.delete(e)})),e.intervalIds=null),e.animationFrameIds&&(e.animationFrameIds.forEach((e=>{var t;cancelAnimationFrame(e),null===(t=qr)||void 0===t||t.animationFrames.delete(e)})),e.animationFrameIds=null),e.idleCallbackIds&&(e.idleCallbackIds.forEach((e=>{var t;cancelIdleCallback(e),null===(t=qr)||void 0===t||t.idleCallbacks.delete(e)})),e.idleCallbackIds=null)}hasTimeout(e){var t;return Boolean(null===(t=this.timeoutMap)||void 0===t?void 0:t.has(e))}setTimeout({fn:e,delay:t,name:n,runOnDestroy:r,cancelOutstanding:i,args:s}){var o;(arguments.length>1||"function"==typeof arguments[0])&&([e,t,n,r]=arguments),"string"==typeof e?n=e:n||(n=e.name||e),i&&this.clearTimeout(n);const a=this,l=a.timeoutIds||(a.timeoutIds=new Map),c=a.timeoutMap||(a.timeoutMap=new Map),d=setTimeout((()=>{var t;"string"==typeof e&&(e=a[n]),null==l||l.delete(d),null==c||c.delete(n),null===(t=qr)||void 0===t||t.timeouts.delete(d),e.apply(a,s)}),t);return l.set(d,!r||e),null===(o=qr)||void 0===o||o.timeouts.set(d,{fn:e,delay:t,name:n}),n&&c.set(n,d),d}clearTimeout(e){var t,n;let r=e;if("string"==typeof r){if(!this.timeoutMap)return;r=this.timeoutMap.get(e),this.timeoutMap.delete(e)}clearTimeout(r),null===(t=this.timeoutIds)||void 0===t||t.delete(r),null===(n=qr)||void 0===n||n.timeouts.delete(r)}clearInterval(e){var t,n;clearInterval(e),null===(t=this.intervalIds)||void 0===t||t.delete(e),null===(n=qr)||void 0===n||n.intervals.delete(e)}setInterval(e,t,n){var r;const i=setInterval(e,t);return(this.intervalIds||(this.intervalIds=new Set)).add(i),null===(r=qr)||void 0===r||r.intervals.set(i,{fn:e,delay:t,name:n}),i}requestAnimationFrame(e,t=[],n=this){var r;const i=this.animationFrameIds||(this.animationFrameIds=new Set),s=requestAnimationFrame((()=>{var r;null===(r=qr)||void 0===r||r.animationFrames.delete(s),i.delete(s)&&e.apply(n,t)}));return i.add(s),null===(r=qr)||void 0===r||r.animationFrames.set(s,{fn:e,extraArgs:t,thisObj:n}),s}requestIdleCallback(e,t=[],n=this){var r;const i=this.idleCallbackIds||(this.idleCallbackIds=new Set),s=requestIdleCallback((()=>{var r;null===(r=qr)||void 0===r||r.idleCallbacks.delete(s),i.delete(s)&&e.apply(n,t)}));return i.add(s),null===(r=qr)||void 0===r||r.idleCallbacks.set(s,{fn:e,extraArgs:t,thisObj:n}),s}createOnFrame(e,t=[],n=this,r){let i;const s=(...s)=>{null!=i&&r&&(this.cancelAnimationFrame(i),i=null),null==i&&(i=this.requestAnimationFrame((()=>{"string"==typeof e&&(e=n[e]),i=null,s.push(...t),e.apply(n,s)})))};return s.cancel=()=>this.cancelAnimationFrame(i),s}cancelAnimationFrame(e){var t,n;cancelAnimationFrame(e),null===(t=this.animationFrameIds)||void 0===t||t.delete(e),null===(n=qr)||void 0===n||n.animationFrames.delete(e)}cancelIdleCallback(e){var t,n;cancelIdleCallback(e),null===(t=this.idleCallbackIds)||void 0===t||t.delete(e),null===(n=qr)||void 0===n||n.idleCallbacks.delete(e)}async nextAnimationFrame(){return new Promise((e=>this.requestAnimationFrame(e)))}buffer(e,t){let n=t;t&&"number"!=typeof t?n=t.delay:t=null;const r=(...e)=>{if(r.suspended)return;const{delay:t}=r;r.cancel(),r.called=!1,r.args=e,r.immediate||!t?i():r.timerId=this.setTimeout(i,t)},i=Kr(this,e,r,t);return r.delay=n,Xr(this,r)}raf(e,t){let n=t;t&&"boolean"!=typeof t?n=t.cancelOutstanding:t=null;const r=(...e)=>{r.suspended||(r.cancelOutstanding&&r.cancel(),r.called=!1,r.args=e,r.immediate?i():r.isPending||(r.timerId=this.requestAnimationFrame(i)))},i=Kr(this,e,r,t);return r.cancelOutstanding=n,Xr(this,r,"cancelAnimationFrame")}idle(e,t){let n=t;t&&"boolean"!=typeof t?n=t.cancelOutstanding:t=null;const r=(...e)=>{r.suspended||(r.cancelOutstanding&&r.cancel(),r.called=!1,r.args=e,r.immediate?i():r.isPending||(r.timerId=this.requestIdleCallback(i)))},i=Kr(this,e,r,t);return r.cancelOutstanding=n,this.setTimeout((()=>this.idleCallbackIds.delete(r.timerId)&&r.now()),100),Xr(this,r,"cancelIdleCallback")}throttle(e,t){let n,r=t;t&&"number"!=typeof t?(r=t.delay,n=t.throttled):t=null;const i=this,s=(...e)=>{if(s.suspended)return;const{delay:t}=s,r=Gr.now()-s.lastCallTime;s.args=e,s.immediate||r>=t?(i.clearTimeout(s.timerId),o()):(s.isPending||(s.timerId=i.setTimeout(o,t-r),s.called=!1),n&&(n.wrapFn.args=e,n()))},o=Kr(i,e,s,t);return s.delay=r,n&&(n=Kr(i,n,(()=>{}),t)),Xr(i,s)}static setupDelayable(e){e.setupDelayableMethods(e.delayable)}static setupDelayableMethods(e,t=null){const n=e.static,r=t||this.prototype;n&&delete e.static;for(const t in e){let n=e[t];const i=t+"Now",s=typeof n;r[i]||(r[i]=r[t]),"number"===s?n={type:"buffer",delay:n}:"string"===s&&(n={type:n}),Yr(r,t,{get(){const e=this[n.type](((...e)=>{this[i](...e)}),n);return Yr(this,t,{value:e}),e}})}}get widgetClass(){}};class Jr{get data(){return Object.create(null)}get keys(){return[]}clear(){}getItem(e){return null}removeItem(e){}setItem(e,t){}}Jr._$name="StateStorage";const Qr=()=>Object.create(null),ei=(e,t=0)=>{const n=[],r=localStorage.length;for(let i,s=0;s<r;++s)i=localStorage.key(s),i.startsWith(e)&&n.push(i.slice(t));return n},ti=new Jr,ni={local:class extends(null){constructor(e){super(),this.prefix=e.prefix||""}get isLocal(){return!0}get data(){const e=Qr(),t=this.keys;for(const n of t)e[n]=this.getItem(n);return e}get keys(){return ei(this.prefix,this.prefix.length)}clear(){const e=ei(this.prefix);for(const t of e)localStorage.removeItem(t)}getItem(e){const t=localStorage.getItem(this.prefix+e);return null===t?t:JSON.parse(t)}removeItem(e){return localStorage.removeItem(this.prefix+e)}setItem(e,t){return localStorage.setItem(this.prefix+e,JSON.stringify(t))}},memory:class extends(null){constructor(){super(),this.clear()}get isMemory(){return!0}get data(){return sn.clone(this._data)}get keys(){return Object.keys(this._data)}clear(){this._data=Qr()}getItem(e){return e in this._data?this._data[e]:null}removeItem(e){delete this._data[e]}setItem(e,t){this._data[e]=t}}};class ri extends(Te.mixin(Zr,tt)){static get $name(){return"StateProvider"}static get configurable(){return{prefix:"bryntum-state:",storage:"local"}}static get delayable(){return{writeStatefuls:50}}static get instance(){return this._instance}static set instance(e){null==e?e=ii:(("string"==typeof e||sn.isClass(e)||e instanceof Jr)&&(e={storage:e}),sn.isObject(e)&&(e=new ri(e))),this._instance=e}static setup(e){return this.instance=e,this.instance}doDestroy(){self.writeStatefuls.flush(),super.doDestroy()}get data(){return this.storage.data}set data(e){if(e)for(const t in e)this.setValue(t,e[t]);else this.clear()}clear(){return this.storage.clear(),this}changeStorage(e){if(null==e)e=ti;else{if("string"==typeof e){if(!ni[e])throw new Error(`Invalid storage type "${e}" (expected one of: "${Object.keys(ni).join('", "')}")`);e=ni[e]}sn.isClass(e)&&(e=new e(this))}return e}saveStateful(e,t){(this.pendingSaves||(this.pendingSaves=[])).push([e,t]),this.writeStatefuls()}writeStatefuls(){const e=this,{pendingSaves:t}=e,n=null==t?void 0:t.length,r=[],i=[];if(e.pendingSaves=null,n){for(let e,s,o,a=0;a<n;++a)[s,e]=t[a],!s.isDestroying&&s.isSaveStatePending&&(o=s.saveState(f(f({},e),{},{immediate:!0})),o&&(r.push(o),i.push(s)));r.length&&e.trigger("save",{stateIds:r,saved:i})}}getValue(e){return this.writeStatefuls.flush(),this.storage.getItem(e)}setValue(e,t){const n=this,{storage:r}=n,i=n.getValue(e);return null!=t?(r.setItem(e,t),n.trigger("set",{key:e,value:t,was:i})):null!==i&&(r.removeItem(e),n.trigger("remove",{key:e,was:i})),n}}const ii=new ri({storage:ti});ri._instance=ii,ri._$name="StateProvider";const si=/boolean|number|string/;var oi=e=>{var t;return v(t=class extends(e||Te){afterConstruct(){super.afterConstruct(),this.loadState()}finalizeInit(){this.loadState(),super.finalizeInit()}get isStateful(){return!0}get isStatefulActive(){return!this.statefulSuspended&&!this.isResponsivePending&&!this.isResponsiveUpdating}get state(){return this._state=this.getState()}set state(e){this._state=e,e&&this.applyState(e)}updateStatefulEvents(e){const t=this,n={name:"statefulEvents",thisObj:t};if(t.detachListeners(n.name),e&&("string"==typeof e?e=_.split(e):Array.isArray(e)||(e=sn.getTruthyKeys(e)),e.length)){var r;for(const t of e)n[t]="onStatefulEvent";null===(r=t.on)||void 0===r||r.call(t,n)}}get statefulId(){const e=this,{responsiveState:t}=e;let n=e.stateId;return null==n&&!1===e.hasGeneratedId&&!1!==e.stateful&&(n=e.id),n&&t&&(n=`${n}[${t}]`),n}get statefulness(){const{stateful:e}=this;return Array.isArray(e)?sn.createTruthyKeys(e):e}get stateProvider(){return this._stateProvider||ri.instance}applyState(e){(e=this.pruneState(e))&&this.setConfig(e)}getState(){const e=this,{statefulness:t}=e;let n,r,i=null;if(t)for(n in i={},t)if(t[n]){var s,o;if(r=e[n],null!==(s=r)&&void 0!==s&&s.isStateful)r=r.state;else if(r===(null===(o=e.initialConfig)||void 0===o?void 0:o[n])||!si.test(typeof r))continue;i[n]=r}return i}loadState(e,t){"boolean"==typeof e&&(t=e,e=null);const n=this,{statefulLoaded:r}=n;if(n.isStatefulActive&&(t||!r)){const t=n.loadStatefulData(e||(e=n.statefulId));!r&&e&&(n.defaultState=n.state,n.statefulLoaded=!0),t&&(n.state=t)}}loadStatefulData(e){var t;return(e=this.isStatefulActive?e||this.statefulId:null)&&(null===(t=this.stateProvider)||void 0===t?void 0:t.getValue(e))}resetDefaultState(){this.defaultState&&(this.state=this.defaultState)}resumeStateful(e=!1){this.statefulSuspended=e?0:Math.max(this.statefulSuspended-1,0)}saveState(e){e="string"==typeof e?{id:e}:e||{};const t=this,{stateProvider:n}=t,r=e.id||t.isStatefulActive&&t.statefulId;if(r&&n)return e.immediate?(t.isSaveStatePending=!1,n.setValue(r,t.state)):t.isSaveStatePending||(t.isSaveStatePending=!0,n.saveStateful(t,e)),r}suspendStateful(){++this.statefulSuspended}onConfigChange({name:e,value:t,was:n,config:r}){if(super.onConfigChange({name:e,value:t,was:n,config:r}),!this.isConstructing&&this.isStatefulActive&&this.statefulId){const{stateful:t}=this;(Array.isArray(t)?t.includes(e):null==t?void 0:t[e])&&this.saveState()}}onStatefulEvent(){this.isConstructing||this.saveState()}pruneState(e){const{statefulness:t}=this;if(t){const n={};for(const r in e)t[r]&&(n[r]=e[r]);e=n}return e}get widgetClass(){}},"$name","State"),v(t,"configurable",{stateful:null,statefulEvents:{$config:{merge:"classList"},value:["stateChange"]},stateId:null,stateProvider:null}),v(t,"prototypeProperties",{statefulLoaded:!1,statefulSuspended:0}),t};const ai=sn.getPathDefault(globalThis,"bryntum.idCounts",Object.create(null)),li={string:1,number:1};var ci=e=>class extends(e||Te){static get $name(){return"Identifiable"}static get declarable(){return["identifiable"]}static get configurable(){return{id:""}}static setupIdentifiable(e,t){const{identifiable:n}=e;n.idMap=Object.create(null),Reflect.defineProperty(e,"identifiable",{get(){return n}})}doDestroy(){this.constructor.unregisterInstance(this),super.doDestroy()}changeId(e){return(this.hasGeneratedId=!e)?this.generateAutoId():e}updateId(e,t){const n=this,r=n.constructor;t&&r.unregisterInstance(n,t),n.hasGeneratedId&&!1===r.identifiable.registerGeneratedId||r.registerInstance(n,e)}generateAutoId(){return this.constructor.generateId(`b-${this.$$name.toLowerCase()}-`)}static get all(){return Object.values(this.identifiable.idMap)}static generateId(e="generatedId"){return e+(ai[e]=(ai[e]||0)+1)}static registerInstance(e,t=e.id){const{idMap:n}=this.identifiable;if(t in n&&!this.disableThrow)throw new Error("Id "+t+" already in use");n[t]=e}static unregisterInstance(e,t=e.id){const{idMap:n}=this.identifiable;li[typeof e]?delete n[e]:n[t]===e&&delete n[t]}static getById(e){const t=this.identifiable.idMap;if(t)return t[e]}static get registeredInstances(){const e=this.identifiable.idMap;return e?Object.values(e):[]}};const di=Symbol("STM_PROP"),ui={parentIndex:1};var hi=e=>class extends(e||Te){static get $name(){return"ModelStm"}static get defaultConfig(){return{stm:null}}joinStore(e){this.stm||(this.stm=e.stm)}unjoinStore(e){var t;this.stm===e.stm&&(this.stm=null),null===(t=super.unjoinStore)||void 0===t||t.call(this,e)}get stm(){return this[di]}set stm(e){this[di]=e}beforeChronoFieldSet(e,t){const n=this,{stm:r}=n,i=[];if(!n.inSetting&&null!=r&&r.enabled&&!ui[e]&&!n.constructor.nonPersistableFields[e]&&n.getFieldDefinition(e)){const r={[e]:t},s={[e]:n[e]};i.push([r,s])}return i}beforeSet(e,t,n,r){const{stm:i}=this;if(null!=i&&i.enabled&&!ui[e]&&!this.constructor.nonPersistableFields[e]){var s;const i=(null===(s=super.beforeSet)||void 0===s?void 0:s.call(this,e,t,n,r))||[];let o,a;return"object"==typeof e?[o,a]=Object.keys(e).reduce(((t,n)=>(t[0][n]=e[n],t[1][n]=this.get(n),t)),[{},{}]):(o={[e]:t},a={[e]:this.get(e)}),i.push([o,a]),i}return[]}afterChronoFieldSet(e,t,n){null!=n&&n[0]&&this.afterSet(e,t,!1,!1,n,n[0][0])}shouldRecordFieldChange(e,t,n){const r=this.firstStore;return!(this.constructor.nonPersistableFields[e]||null==t&&null==n||t===n||t instanceof Date&&n instanceof Date&&t.getTime()===n.getTime()||"id"===e||"parentId"===e&&r&&r.oldIdMap[t]===r.getById(n))}afterSet(e,t,n,r,i,s){const{stm:o}=this,a=this.constructor.nonPersistableFields;if(null!=o&&o.isBase&&o.enabled&&!ui[e]&&!a[e]){const e=i.pop();if(s){let t;const[n,r]=e,[i,a]=Object.keys(s).reduce(((e,i)=>{const s=n[i],o=r[i];return this.shouldRecordFieldChange(i,o,s)&&(t=!0,e[0][i]=s,e[1][i]=o),e}),[{},{}]);t&&o.onModelUpdate(this,i,a)}}}beforeInsertChild(e){const t=super.beforeInsertChild?super.beforeInsertChild(e):[],{stm:n}=this;return null!=n&&n.enabled&&t.push(e.reduce(((e,t)=>(t.root===this.root&&e.set(t,{parent:t.parent,index:t.parent?t.parentIndex:void 0}),e)),new Map)),t}afterInsertChild(e,t,n,r){var i;const{stm:s}=this;if(null!=s&&s.enabled){const t=n.pop();r&&s.onModelInsertChild(this,e,r,t)}null===(i=super.afterInsertChild)||void 0===i||i.call(this,e,t,n,r)}beforeRemoveChild(e,t){const n=super.beforeRemoveChild?super.beforeRemoveChild(e,t):[],{stm:r}=this;return null!=r&&r.enabled&&!t&&n.push(e.reduce(((e,t)=>(e.set(t,t.parentIndex),e)),new Map)),n}afterRemoveChild(e,t,n){var r;const{stm:i}=this;if(null!=i&&i.enabled&&!n){const n=t.pop();e&&e.length&&i.onModelRemoveChild(this,e,n)}null===(r=super.afterRemoveChild)||void 0===r||r.call(this,e,t,n)}},gi=e=>class extends(e||Te){static get $name(){return"TreeNode"}static set convertEmptyParentToLeaf(e){!0===e?e={onLoad:!0,onRemove:!0}:!1===e&&(e={onLoad:!1,onRemove:!1}),this._convertEmptyParentToLeaf=e}static get convertEmptyParentToLeaf(){return this._convertEmptyParentToLeaf||{onLoad:!1,onRemove:!1}}ingestChildren(e,t=this.stores){const{inProcessChildren:n,constructor:r}=this,i=t[0];if(!0===e)return!!n||[];if(e){const t=(e=ke.asArray(e)).length,n=[];for(let s,o=0;o<t;o++)s=e[o],s=s.isModel?s:i?i.createRecord(s,!1,!0):new r(s,null,null,!0),s=i?i.processRecord(s):s,n.push(s);if(!0===this.children&&i){const e=i.createSorterFn(i.sorters);n.sort(e)}return n}}processChildren(e=this.stores){const t=this,{meta:n}=t;t.inProcessChildren=!0;const r=t.ingestChildren(t.data[t.constructor.childrenField],e);if(r){const{convertEmptyParentToLeaf:e}=t.constructor;if(!0===e||e.onLoad?r.length:Array.isArray(r)){if(n.isLeaf=!1,!0===t.children)t.children=[];else if(0===r.length)return void(t.children=r);t.appendChild(r)}else!0===r?(n.isLeaf=!1,t.children=!0):t.isRoot||(n.isLeaf=t.constructor.convertEmptyParentToLeaf.onLoad)}t.inProcessChildren=!1}ancestorsExpanded(e=this.firstStore){const{parent:t}=this;return!t||t.isExpanded(e)&&t.ancestorsExpanded(e)}isExpanded(e=this.firstStore){const t=this.instanceMeta(e.id);return Object.prototype.hasOwnProperty.call(t,"collapsed")||(t.collapsed=!this.expanded),!t.collapsed}get expanded(){return this.data.expanded}get childLevel(){let e=this,t=-1;for(;e&&!e.isRoot;)++t,e=e.parent;return t}get isLeaf(){return!1!==this.meta.isLeaf&&!this.isRoot}get isParent(){return!this.isLeaf}get isLoaded(){return this.isParent&&Array.isArray(this.children)}get descendantCount(){return this.getDescendantCount()}get visibleDescendantCount(){return this.getDescendantCount(!0)}getDescendantCount(e=!1,t=this.firstStore){const n=this.children;return!n||!Array.isArray(n)||e&&!this.isExpanded(t)?0:n.reduce(((t,n)=>t+n.getDescendantCount(e)),n.length)}get allChildren(){const e=this.children;return e?e.reduce(((e,t)=>(e.push(t),e.push.apply(e,t.allChildren),e)),[]):[]}get firstChild(){const e=this.children;return(null==e?void 0:e.length)&&e[0]||null}get lastChild(){const e=this.children;return(null==e?void 0:e.length)&&e[e.length-1]||null}get previousSiblingsTotalCount(){let e=this.previousSibling,t=this.parentIndex;for(;e;)t+=e.descendantCount,e=e.previousSibling;return t}get root(){var e;return(null===(e=this.parent)||void 0===e?void 0:e.root)||this}get parentId(){return this.parent&&!this.parent.isAutoRoot?this.parent.id:null}set parentId(e){const t=this,{parent:n}=t,r=null===e?t.firstStore.rootNode:t.firstStore.getById(e);r!==n&&(n||r)&&(t.isBatchUpdating?t.meta.batchChanges.parentId=e:r?r.appendChild(t):t.parent.removeChild(t))}static set parentIdField(e){this._parentIdField=e,Object.defineProperty(this.prototype,e,{set:function(e){this.parentId=e},get:function(){return this.parentId}})}static get parentIdField(){return this._parentIdField||"parentId"}traverse(e,t=!1,n=!1){const r=(n?this.unfilteredChildren:this.children)||this.children;t||e.call(this,this);for(let t=0,i=null==r?void 0:r.length;t<i;t++)r[t].traverse(e,!1,n)}traverseBefore(e,t=!1,n=!1){const r=(n?this.unfilteredChildren:this.children)||this.children;for(let t=0,i=null==r?void 0:r.length;t<i;t++)r[t].traverse(e,!1,n);t||e.call(this,this)}traverseWhile(e,t=!1,n=!1){const r=this;let i=!0;return t||(i=!1!==e.call(r,r)),i&&r.isLoaded&&(i=((n?r.unfilteredChildren:r.children)||this.children).every((t=>t.traverseWhile(e,!1,n)))),i}bubble(e,t=!1){let n=this;for(t||e.call(n,n);n.parent;)n=n.parent,e.call(n,n)}bubbleWhile(e,t=!1){let n=this,r=!0;for(t||(r=e.call(n,n));r&&n.parent;)n=n.parent,r=e.call(n,n);return r}contains(e){return e&&"object"==typeof e&&(e=e.id),!this.traverseWhile((t=>t.id!=e))}getTopParent(e){let t;return e?(t=[],this.bubbleWhile((e=>(t.push(e),e.parent&&!e.parent.isRoot)))):(t=null,this.bubbleWhile((e=>(e.parent||(t=e),e.parent&&!e.parent.isRoot)))),t}appendChild(e,t=!1){return this.insertChild(e,null,t)}insertChild(e,t=null,n=!1){var r,i,s,o,a,l;const c=this,d=Array.isArray(e);var u,h;if(e=ke.asArray(e),"number"==typeof t&&(t=null!==(u=null===(h=c.children)||void 0===h?void 0:h[t])&&void 0!==u?u:null),!n&&!c.stores.every((t=>!1!==t.trigger("beforeAdd",{records:e,parent:c}))))return null;e=c.ingestChildren(e);const g=null!==(r=null!==(i=null===(s=t)||void 0===s?void 0:s.parentIndex)&&void 0!==i?i:null===(o=c.children)||void 0===o?void 0:o.length)&&void 0!==r?r:0,m=null===(a=c.beforeInsertChild)||void 0===a?void 0:a.call(c,e),p=c.internalAppendInsert(e,t,n);return p.length&&c.convertToParent(n),null===(l=c.afterInsertChild)||void 0===l||l.call(c,g,e,m,p),d||!p?p:p[0]}convertToParent(e=!1){const t=this,n=t.isLeaf;t.meta.isLeaf=!1,t.children||(t.children=[]),!n||t.root.isLoading||e||t.signalNodeChanged({isLeaf:{value:!1,oldValue:!0}})}signalNodeChanged(e){this.stores.forEach((t=>{t.trigger("update",{record:this,changes:e}),t.trigger("change",{action:"update",record:this,changes:e})}))}tryInsertChild(){return this.insertChild(...arguments)}internalAppendInsert(e,t,n){const r=this,{stores:i,root:s}=r,{firstStore:o}=s,{parentIdField:a}=r.constructor,l=r.isAutoRoot?null:r.id,c={};let d,u,h,g;if(t&&t.parent!==r&&(t=null),r.children){const n=r.children,i=t?t.parentIndex:n.length;if(n[u=i]===e[0]||n[u=i-1]===e[0])for(d=!0,h=0;d&&h<e.length;h++)e[h]!==n[u+h]&&(d=!1)}if(d)return e;for(h=0;h<e.length;h++){const t=e[h],i=t.parent;c[t.id]=t.root===s,o&&!s.isLoading&&t.traverse((e=>{e.root===s&&(c[e.id]=!0)})),!1===(null==i?void 0:i.removeChild(t,c[t.id],n,!0))?(g||(e=e.slice(),g=!0),e.splice(h--,1)):(t.parent=r,t.data[a]=l,i&&(t.meta.oldParentId=i.id))}if(e.length){Array.isArray(r.children)||(r.children=[]);const s=r.addToChildren(r.children,t,e);r.addToChildren(r.unfilteredChildren,t,e,!0),i.forEach((t=>{t.isChained||(e.forEach((e=>{e.joinStore(t)})),t.onNodeAddChild(r,e,s,c,n),e.forEach((e=>{if(null!=e.meta.oldParentId&&!r.inProcessChildren&&!r.isLoading){const t={[a]:l,[r.getDataSource("parentIndex")]:e.parentIndex},n={},{modified:i,oldParentId:s}=e.meta,o=i.parentIndex;delete e.meta.oldParentId,r.id!==s&&(n[a]={value:l,oldValue:s}),e.parentIndex!==o&&(n.parentIndex={value:e.parentIndex,oldValue:o}),i[a]===r.id?Reflect.deleteProperty(i,a):a in i||(i[a]=s),e.afterChange(t,n)}})))}))}return e}removeChild(e,t=!1,n=!1,r=!1){var i,s;const o=this,a=[],l=o.isLeaf,{children:c,stores:d}=o;if(e=(e=ke.asArray(e)).filter((e=>e.parent===o)),!n)for(const n of d)if(!n.isChained&&!1===n.trigger("beforeRemove",{parent:o,records:e,isMove:t}))return!1;const u=null===(i=o.beforeRemoveChild)||void 0===i?void 0:i.call(o,e,t);for(const r of e){const{parentIdField:e}=r.constructor,{modified:i}=r.meta,s=r.parent?r.parent.id:null;e in i||r.isLinked||(i[e]=s);const l=o.removeFromChildren(c,r);o.removeFromChildren(o.unfilteredChildren,r,!0),d.forEach((e=>{e.isChained||a.push(...e.onNodeRemoveChild(o,[r],l,{isMove:t,silent:n}))})),t||(r.parent=r.parentIndex=r.unfilteredIndex=r.nextSibling=r.previousSibling=null,r.data[e]=null)}return 0===(o.unfilteredChildren||c).length&&o.constructor.convertEmptyParentToLeaf.onRemove&&!o.isRoot&&(o.meta.isLeaf=!0),o.isLeaf===l||n||o.stores.forEach((e=>{const t={isLeaf:{value:!0,oldValue:!1}};e.trigger("update",{record:o,changes:t}),e.trigger("change",{action:"update",record:o,changes:t})})),null===(s=o.afterRemoveChild)||void 0===s||s.call(o,e,u,t),a}clearParentId(){const e=this;Reflect.deleteProperty(e.data,e.parentIdField),Reflect.deleteProperty(e.originalData,e.parentIdField),e.meta.modified&&Reflect.deleteProperty(e.meta.modified,e.parentIdField)}replaceChildren(e){return this.clearChildren(),this.data[this.constructor.childrenField]=e,this.processChildren(),this.children}clearChildren(e=!1){const t=this,{stores:n}=t,r=t.unfilteredChildren||t.children;t.children=[],r&&!0!==r&&(n.forEach((n=>{n.isChained||n.onNodeRemoveChild(t,r,0,{unfiltered:!0,silent:e})})),t.unfilteredChildren&&(t.unfilteredChildren=[]))}clear(){var e;const t=this,{stores:n}=t,r=null===(e=t.children)||void 0===e?void 0:e.slice();if(t.isRoot&&r){for(const e of n)if(!e.isChained&&!1===e.trigger("beforeRemove",{parent:t,records:r,isMove:!1,removingAll:!0}))return!1;t.children.length=0,t.unfilteredChildren&&(t.unfilteredChildren.length=0),n.forEach((e=>{r.forEach((t=>{t.stores.includes(e)&&t.unjoinStore(e),t.parent=t.parentIndex=t.nextSibling=t.previousSibling=null})),e.storage.suspendEvents(),e.storage.clear(),e.storage.resumeEvents(),e.added.clear(),e.modified.clear(),e.trigger("removeAll"),e.trigger("change",{action:"removeall"})}))}}updateChildrenIndices(e,t=!1,n=!1){const r=t?"unfilteredIndex":"parentIndex";let i=null;for(let s=0;s<e.length;s++){const o=e[s],a=o[r];"parentIndex"===r?void 0===a||n?o.setData("parentIndex",s):a!==s&&o.set("parentIndex",s,!0):o[r]=s,t||(o.previousSibling=i,i&&(i.nextSibling=o),s===e.length-1&&(o.nextSibling=null),i=o)}}addToChildren(e,t,n,r=!1){if(e){const i=r?"unfilteredIndex":"parentIndex",s=t?t[i]:e.length;return e.splice(s,0,...n),this.updateChildrenIndices(e,r),s}}removeFromChildren(e,t,n=!1){if(e){const r=t[n?"unfilteredIndex":"parentIndex"];return r>-1&&(e.splice(r,1),this.updateChildrenIndices(e,n)),r}}};const mi={id:1,stores:1,parentIndex:1,parent:1,previousSibling:1,nextSibling:1,unfilteredIndex:1},pi={get(e,t){return"proxyMeta"===t?this.proxyMeta:"constructor"===t?e.constructor:"setData"===t?this.setDataOverride:"set"===t?this.setOverride:mi[t]?this.proxyMeta.data[t]:Reflect.get(e,t,this.proxyRecord)},set(e,t,n){return mi[t]?this.proxyMeta.data[t]=n:e[t]=n,!0},setDataOverride(e,t){"parentIndex"===e?this.proxyMeta.data.parentIndex=t:this.proxyMeta.originalRecord.setData(e,t)},setOverride(e,t,...n){"parentIndex"===e?this.proxyMeta.data.parentIndex=t:this.proxyMeta.originalRecord.set(e,t,...n)}};var fi=e=>{var t;return v(t=class extends(e||Te){link(){if(this.isLinked)return this.$original.link();const e=this,t=f(f({},pi),{},{proxyMeta:{originalRecord:e,data:{id:`${e.id}_link_${_.generateUUID()}`,stores:[]}}}),n=new Proxy(e,t);return t.proxyRecord=n,(e.meta.linkedRecords||(e.meta.linkedRecords=[])).push(n),n}get isLinked(){var e;return Boolean(null===(e=this.proxyMeta)||void 0===e?void 0:e.originalRecord)}get hasLinks(){return Boolean(!this.proxyMeta&&this.$links.length)}removeLink(e,t=null,n=!1){if(e.hasLinks)for(const r of e.$links.slice())t?ke.include(t,r):r.remove(n);else e.isLinked&&ke.remove(e.$original.$links,e)}beforeRemove(e){this.removeLink(this,e)}removeChild(e,t,n,r=!1){if(!r){e=ke.asArray(e);for(const t of e)this.removeLink(t,null,n)}return super.removeChild(e,t,n,r)}get $originalId(){return this.$original.id}get $original(){return this.isLinked?this.proxyMeta.originalRecord:this}get $links(){var e;return null!==(e=this.meta.linkedRecords)&&void 0!==e?e:[]}},"$name","ModelLink"),t};const{defineProperty:vi}=Reflect,yi=Symbol("owner"),bi=/[\s,]+/;var Ci=e=>class extends(e||Te){static get $name(){return"Factoryable"}static get declarable(){return["factoryable","alias","type"]}static register(e,t,n=globalThis.__BRYNTUM_EXAMPLE){const{factoryable:r}=this.initClass(),{caseless:i,registry:s}=r,o=_.split(e,bi);for(let e,a,l=0;l<o.length;++l){if(a=o[l],e=i?a.toLowerCase():a,!n&&e in s)throw new Error(`Type "${a}" already registered with ${r.class.name} factory`);s[a]=s[e]=t.initClass()}}static isA(e,t){return this.isType(e,t,!0)}static isType(e,t,n){const{factoryable:r}=this,{caseless:i,registry:s}=r,o=s[i?t.toLowerCase():t];return!!o&&(n?e instanceof o:e.constructor===o)}static setupAlias(e){e.register(e.alias,e)}static setupFactoryable(e,t){const n=t.super.class;let{factoryable:r}=e;r=f({caseless:!0,defaultType:null,extends:n.factoryable?[n]:null,typeKey:"type"},r),r.class=e,r.registry=Object.create(null),r.extends&&!Array.isArray(r.extends)&&(r.extends=[r.extends]),vi(e,"factoryable",{get(){return r}})}static setupType(e,t){const{type:n}=e;e.register(n,e,t.replaceType),vi(e.prototype,"type",{value:n})}static create(e,t){return this.reconfigure(null,e,t)}static reconfigure(e,t,n){const r=this,{factoryable:i}=r,{typeKey:s}=i;let o,a,l,c,d,u,h,g,m,p=n;if(n&&!sn.isClass(n)&&(p=null,h=typeof n,"function"===h?u=n:"string"===h?p=n:sn.isObject(n)?(o=n.cleanup,a=n.defaults,c=n.owner,u=n.setup,p=n.type,g=n.transform):c=n),g&&(t="string"==typeof g?c[g](t):g(t)),m=t,"string"==typeof m)t={};else if(t){var f;if(!0===t&&(t={}),!sn.isObject(t))return c&&t!==e&&(null==e?void 0:e[yi])===c&&("string"==typeof o?c[o](e):null===(f=o)||void 0===f||f(e),e.destroy()),t;m=t[s]}if(m=m&&r.resolveType(m),e){if(t&&(!m||e.constructor===m))return s in t&&delete(t=sn.assign({},t))[s],e.setConfig(t),e;var v;c&&e[yi]===c&&("string"==typeof o?c[o](e):null===(v=o)||void 0===v||v(e),e.destroy())}if(t){if(a){if(!(l=m)){if(!(l=a[s]||p||i.defaultType))throw new Error(`No default mergeType defined for ${i.class.name} factory`);l=r.resolveType(l)}l&&(t=l.mergeConfigs(a,t))}if(u){if(d="string"==typeof u?c[u](t,m,a):u(t,m,a),null===d)return d;t=d||t}if(!m){if(!(m=t[s]||p||i.defaultType))throw new Error(`No default type defined for ${i.class.name} factory`);m=r.resolveType(m)}a&&!l&&(t=m.mergeConfigs(a,t)),s in t&&delete(t=sn.assign({},t))[s],t=new m(t),c&&(t[yi]=c)}return t||null}static resolveType(e,t){if("string"!=typeof e)return e;const{factoryable:n}=this,r=n.extends;let i,s=n.registry[n.caseless?e.toLowerCase():e];for(i=0;!s&&r&&i<r.length;++i)s=r[i].resolveType(e,!0);if(!s&&!t)throw new Error(`Invalid type name "${e}" passed to ${n.class.name} factory`);return s}};const{getOwnPropertyDescriptor:wi}=Reflect;class Si extends(Te.mixin(Ci)){static get $name(){return"DataField"}static get type(){return"auto"}static get factoryable(){return{defaultType:"auto"}}static get prototypeProperties(){return{compare:null,compareItems:null,dataSource:null,type:null,alwaysWrite:!1,nullable:!0,nullText:null,nullValue:void 0,persist:!0,readOnly:!1,internal:!1}}construct(e){const t=this;e&&(t.name=e.name,Object.assign(t,e)),t.compare&&(t.compareItems=(e,n)=>t.compare(null==e?void 0:e[t.name],null==n?void 0:n[t.name]))}defineAccessor(e,t){const{name:n,dataSource:r}=this;!t&&n in e&&e.$meta.hierarchy.some((e=>{var t;return!1===(null===(t=wi(e.prototype,n))||void 0===t?void 0:t.enumerable)}))||Reflect.defineProperty(e,n,{configurable:!0,enumerable:!0,get:this.complexMapping?function(){return this.complexGet(n,r)}:function(){return this.batching&&n in this.meta.batchChanges?this.meta.batchChanges[n]:r in this.data?this.data[r]:this.data[n]},set(e){const t=this.$meta.fields.map[n];t&&t.readOnly||this.set(n,e)}})}isEqual(e,t){return sn.isEqual(e,t)}print(e){return null==e?this.nullText:this.printValue(e)}printValue(e){return String(e)}}Si._$name="DataField";class Di extends Si{static get $name(){return"ArrayDataField"}static get type(){return"array"}isEqual(e,t){return e===t}}Di.initClass(),Di._$name="ArrayDataField";class Ei extends Si{static get $name(){return"BooleanDataField"}static get type(){return"boolean"}static get alias(){return"bool"}static get prototypeProperties(){return{nullValue:!1}}isEqual(e,t){return null==e&&null==t||super.isEqual(e,t)}convert(e){return null==e?this.nullable?e:this.nullValue:Boolean(e)}}Ei.initClass(),Ei._$name="BooleanDataField";class xi extends Si{static get $name(){return"DateDataField"}static get type(){return"date"}static get prototypeProperties(){return{format:null}}convert(e){return null==e?this.nullable||(e=this.nullValue):"now"===e?e=new Date:e instanceof Date||(e=(e=en.parse(e,this.format||en.defaultParseFormat))||void 0),e}serialize(e){return e instanceof Date&&(e=en.format(e,this.format||en.defaultFormat)),e}printValue(e){return en.format(e,this.format||en.defaultFormat)}}xi.initClass(),xi._$name="DateDataField";class Ri extends Si{static get $name(){return"StringDataField"}static get type(){return"string"}static get prototypeProperties(){return{nullValue:""}}convert(e){return null==e?this.nullable?e:this.nullValue:String(e)}}Ri.initClass(),Ri._$name="StringDataField";class Ti extends Ri{static get $name(){return"DurationUnitDataField"}static get type(){return"durationunit"}isEqual(e,t){return 0===en.compareUnits(e,t)}}Ti.initClass(),Ti._$name="DurationUnitDataField";class Mi extends Si{static get $name(){return"IntegerDataField"}static get type(){return"integer"}static get alias(){return"int"}static get prototypeProperties(){return{nullValue:0,rounding:"round"}}convert(e){return null==e?this.nullable?e:this.nullValue:Math[this.rounding](Number(e))}}Mi.initClass(),Mi._$name="IntegerDataField";class ki extends Si{static get $name(){return"ModelDataField"}static get type(){return"model"}static get prototypeProperties(){return{complexMapping:!0}}isEqual(e,t){return e&&t&&t instanceof e.constructor&&t.id==e.id}}ki.initClass(),ki._$name="ModelDataField";class Ii extends Si{static get $name(){return"NumberDataField"}static get type(){return"number"}static get alias(){return"float"}static get prototypeProperties(){return{nullValue:0,precision:null}}isEqual(e,t){return isNaN(Number(e))&&isNaN(Number(t))||super.isEqual(e,t)}convert(e){if(null==e)return this.nullable?e:this.nullValue;e=Number(e);let t=this.precision;return t?(t=10**t,e=Math.round(e*t)/t):0===t&&(e=Math.round(e)),e}}Ii.initClass(),Ii._$name="NumberDataField";class Ai extends Si{static get $name(){return"ObjectDataField"}static get type(){return"object"}static get prototypeProperties(){return{complexMapping:!0}}}Ai.initClass(),Ai._$name="ObjectDataField";class Fi extends Si{init(e,t){var n;const r=this,i=`${r.name}Store`,s={skipStack:!0};if(r.modelClass&&(s.modelClass=r.modelClass),null===(n=t[`init${_.capitalize(i)}`])||void 0===n||n.call(t,s),!s.storeClass&&!r.storeClass)throw new Error(`Field '${r.name}' with type 'store' must have a storeClass configured`);const o=t.meta[i]=new(s.storeClass||r.storeClass)(s);r.complexMapping?sn.setPath(e,r.dataSource,o):e[r.dataSource]=o,o.verifyNoGeneratedIds=!1,o.usesId=!o.count||!o.every((e=>e.hasGeneratedId)),o.$currentValue=r.getValue(o),o.on("change",(()=>{const e=r.getValue(o);o.$isSettingStoreFieldData||t.set(r.name,e),o.$currentValue=e}))}set(e,t,n){var r,i;const s=`${this.name}Store`,{[s]:o}=n.meta;if(!o)return!1;o.$isSettingStoreFieldData||(o.$isSettingStoreFieldData=!0,e=null!==(r=null===(i=n[`process${_.capitalize(s)}Data`])||void 0===i?void 0:i.call(n,e,n))&&void 0!==r?r:e,o.data=e,o.$isSettingStoreFieldData=!1,o.usesId=!o.count||!o.every((e=>e.hasGeneratedId)))}serialize(e,t){return t.meta[`${this.name}Store`].$currentValue}getValue(e){return e.allRecords.map((t=>{const n=t.persistableData;return e.usesId||delete n.id,n}))}isEqual(e,t){var n,r;return null!==(n=e)&&void 0!==n&&n.isStore&&(e=e.$currentValue),null!==(r=t)&&void 0!==r&&r.isStore&&(t=t.$currentValue),sn.isDeeplyEqual(e,t)}}v(Fi,"$name","StoreDataField"),v(Fi,"type","store"),Fi.initClass(),Fi._$name="StoreDataField";const{defineProperty:Oi}=Reflect,{hasOwn:Li}=sn,Pi=void 0,$i={children:1,data:1,meta:1},_i=["name","title","text","label","description"],Ni={boolean:1,number:1,date:1,object:1};class Hi extends(Te.mixin(hi,gi,fi)){static get $name(){return"Model"}static get declarable(){return["fields"]}static get fields(){return[{name:"parentIndex",type:"number",persist:!1,internal:!0},{name:"readOnly",type:"boolean"}]}static set idField(e){this._assignedIdField=!0,this._idField=e}static get idField(){return this._idField}static set childrenField(e){this._childrenField=e}static get childrenField(){if(!this._childrenField){const e=this.fieldMap.children;this._childrenField=(null==e?void 0:e.dataSource)||"children"}return this._childrenField}get indexPath(){const e=[];let t=this,n=t.childLevel;for(t=this;t&&!t.isRoot;t=t.parent)e[n--]=t.parentIndex+1;return e}construct(e={},t=null,n=null,r=!1,i=!1,s=!1){var o,a;const l=this,c=null!==(o=ke.asArray(t))&&void 0!==o?o:[],{constructor:d,fieldMap:u}=l;let h=null;if(t=c[0],l.meta=f(f({modified:{}},d.metaConfig),n),d.applyConfigs)for(const t in l.getDefaultConfiguration())h||(h={},l.useRawData&&l.useRawData.enabled||(e=f({},e))),t in e&&(void 0!==e[t]&&(h[t]=e[t]),delete e[t]);if(super.construct(h),r||d.exposeProperties(e,s),!Li(d,"idFieldProcessed")){let e=l.meta.idField;e||(d._assignedIdField?e=d.idField:t&&(e=t.idField)),e&&e!==u.id.dataSource&&d.addField({name:"id",dataSource:e,internal:!0}),d.idFieldProcessed=!0}l._internalId=Hi._internalIdCounter++,l.stores=[],l.unjoinedStores=[],l.originalData||(l.originalData=e),l.data=d.processData(e,!1,t,l,i),(null===(a=l.meta.initableValues)||void 0===a?void 0:a.size)&&l.assignInitables(),null==l.id&&l.setData("id",l.generateId(t)),l.data[d.childrenField]&&l.processChildren(c),l.generation=0}set isCreating(e){const t=this;Boolean(t.meta.isCreating)!==e&&(t.meta.isCreating=e,t.stores.forEach((n=>{n.onIsCreatingToggle(t,e)})))}get isCreating(){return Boolean(this.meta.isCreating)}equals(e){if(e instanceof this.constructor){for(let t=this.$meta.fields.defs,n=0,{length:r}=t;n<r;n++){const r=t[n],{name:i}=r;if("id"!==i&&!r.isEqual(this[i],e[i]))return!1}return!0}return!1}get subclass(){return new this.constructor(Object.setPrototypeOf({id:Pi},this.data),this.stores[0],null,!0)}static processData(e,t=!1,n,r,i){const{fieldMap:s,defaultValues:o}=this,{useRawData:a={enabled:!1}}=n||{},l=i||a.enabled?e:sn.clone(e);let c;if(!(t=t||a.disableDefaultValue||i))for(c in o)if(l[c]===Pi){let e=o[c];Array.isArray(e)&&(e=e.slice()),l[c]=e}if(!a.disableTypeConversion&&!i)for(c in s){const n=s[c],{name:i,dataSource:o}=n,d=o!==i,u=n.complexMapping,h=d&&(u?sn.pathExists(e,o):o in e),g=i in e&&(!d||!h),m=!a.disableTypeConversion&&n.convert;if((g||m)&&(!t||g||h)){const e=g?l[i]:u?sn.getPath(l,o):l[o],t=m?n.convert(e,r):e;u?sn.setPath(l,o,t):l[o]=t,d&&delete l[i]}}return this.$meta.fields.initable.length&&this.initInitables(r,l),l}static setupClass(e){super.setupClass(e),e.fields||this.setupFields(this,e)}static setupFields(e,t){var n,r,i,s,o;const a=Li(e,"fields")&&e.fields,l=t.super.fields,c=t.fields={defs:null!==(n=null==l?void 0:l.defs.slice())&&void 0!==n?n:[],exposedData:!1,defaults:l?f({},l.defaults):{},exposed:Object.create(null!==(r=null==l?void 0:l.exposed)&&void 0!==r?r:null),ordinals:Object.create(null!==(i=null==l?void 0:l.ordinals)&&void 0!==i?i:null),map:Object.create(null!==(s=null==l?void 0:l.map)&&void 0!==s?s:null),sources:Object.create(null!==(o=null==l?void 0:l.sources)&&void 0!==o?o:null)};Li(e,"defaults")&&Object.assign(c.defaults,e.defaults),Li(e,"idField")&&(e.addField({name:"id",dataSource:e.idField,internal:!0}),c.exposed[e.idField]=!0),null!=a&&a.length&&a.map(e.addField,e),c.initable=c.defs.filter((e=>e.init)),e.exposeRelations()}static get defaultValues(){return this.$meta.fields.defaults}static get allFields(){return this.$meta.fields.defs}get allFields(){return this.$meta.fields.defs}static get fieldMap(){return this.$meta.fields.map}get fieldMap(){return this.$meta.fields.map}static get fieldDataSourceMap(){return this.$meta.fields.sources}static exposeProperties(e,t=!0){const n=this,r=n.$meta.fields,i=t?"exposed":"map";if(e&&n.autoExposeFields&&!r.exposedData){let t,s,o;for(t in e)r[i][t]||t===n.childrenField||(o=sn.typeOf(e[t]),s={name:t,dataSource:t,fromData:!0},Ni[o]&&(s.type=o),n.addField(s));r.exposedData=!0}n.exposeRelations()}static addField(e){if(null==e)return;"string"==typeof e&&(e={name:e});const t=this.initClass(),n=t.$meta.fields,{ordinals:r}=n,i=n.exposed,{name:s}=e,o=n.map[s],a=e.dataSource||(e.dataSource=s);let l,c;if(!o||e.type&&e.type!==o.type)l=Si.create(e),l.definedBy=o?o.definedBy:t,l.ordinal=o?o.ordinal:r[s]=n.defs.length;else for(c in l=Object.create(o),e)"type"!==c&&(l[c]=e[c]);return l.owner=t,n.defs[l.ordinal]=l,n.map[s]=l,n.sources[a]||(n.sources[a]=l),a.includes(".")&&(l.complexMapping=!0),l.complexMapping?i[a.split(".")[0]]=!0:i[a]=!0,"defaultValue"in l&&(n.defaults[a]=l.defaultValue),$i[s]||l.defineAccessor(t.prototype),t._nonPersistableFields=null,t._alwaysWriteFields=null,l}static removeField(e){const t=this.initClass(),n=t.$meta.fields,r=n.map[e],{ordinals:i}=n,s=i[e];if(r){n.defs.splice(s,1),delete i[e],delete n.defaults[e],delete n.exposed[e],delete n.map[e],delete n.sources[r.dataSource];for(const e in i)i[e]>s&&--i[e];delete t.prototype[e]}}static exposeRelations(){const e=this;Li(e,"relationsExposed")||e.relationConfig&&(e.relationsExposed=!0,e.relations=[],e.relationConfig.forEach((t=>{e.relations.push(t);const n=t.relationName;Reflect.ownKeys(e.prototype).includes(n)||Oi(e.prototype,n,{enumerable:!0,get:function(){return this.getForeign(n)},set:function(e){this.setForeign(n,e,t)}})})))}static initInitables(e,t){const n=e.meta.initableValues=new Map;for(const r of this.$meta.fields.initable){const i=sn.getPath(t,r.dataSource);void 0!==i&&n.set(r,i),!r.lazy&&r.init(t,e)}}assignInitables(){const{initableValues:e}=this.meta;for(const[t,n]of e)!1!==t.set(n,this.data,this)&&e.delete(t)}static get autoExposeFields(){return!0}get fields(){return this.$meta.fields.defs}getFieldDefinition(e){return this.$meta.fields.map[e]}getFieldDefinitionFromDataSource(e){return this.$meta.fields.sources[e]}get fieldNames(){return Object.keys(this.data)}static getFieldDefinition(e){return this.$meta.fields.map[e]}static getFieldDataSource(e){return this.getFieldDefinition(e).dataSource}getDataSource(e){const t=this.constructor.getFieldDefinition(e);return(null==t?void 0:t.dataSource)||(null==t?void 0:t.name)}static processField(e,t,n){const r=this.fieldMap[e];return null!=r&&r.convert?r.convert(t,n):t}initRelations(){const e=this;e.constructor.relations&&e.stores.forEach((t=>{var n;t.modelRelations||t.initRelations();const r=[];null===(n=t.modelRelations)||void 0===n||n.forEach((t=>{r.push({related:e.initRelation(t),config:t})})),t.updateRecordRelationCache(e,r)}))}initRelation(e){const t=this,n=t.get(e.fieldName),r=n!==Pi&&"string"!=typeof e.store&&e.store.getById(n),i={id:n,placeHolder:!0};return t.meta.relationCache||(t.meta.relationCache={}),t.meta.relationCache[e.relationName]=r||(null!=n?i:null),r}removeRelation(e){this.meta.relationCache[e.relationName]&&(delete this.meta.relationCache[e.relationName],e.nullFieldOnRemove&&this.setData(e.fieldName,null))}getForeign(e){var t;return null===(t=this.meta.relationCache)||void 0===t?void 0:t[e]}setForeign(e,t,n){const r=Hi.asId(t);return this.set(n.fieldName,r)}flatGet(e,t){return this.batching&&e in this.meta.batchChanges?this.meta.batchChanges[e]:t in this.data?this.data[t]:this.data[e]}complexGet(e,t){return this.batching&&e in this.meta.batchChanges?this.meta.batchChanges[e]:sn.getPath(this.data,t)}get(e){if(!e)return;const t=this.fieldMap[e];return!t&&e.includes(".")?this.complexGet(e,e):null!=t&&t.complexMapping?this.complexGet(e,t.dataSource):this.flatGet(e,(null==t?void 0:t.dataSource)||e)}setData(e,t){const{data:n,fieldMap:r}=this;if("string"==typeof e){var i;const s=r[e],o=null!==(i=null==s?void 0:s.dataSource)&&void 0!==i?i:e;null!=s&&s.set?s.set(t,this.data,this):null!=s&&s.complexMapping?sn.setPath(n,o,t):n[o]=t}else{const i=Object.keys(e);for(let o=0;o<i.length;o++){var s;const a=i[o],l=r[a],c=null!==(s=null==l?void 0:l.dataSource)&&void 0!==s?s:a;null!=l&&l.set?l.set(t,this.data,this):c&&(null!=l&&l.complexMapping?sn.setPath(n,c,e[a]):n[c]=e[a])}}}getData(e){var t;const n=this.fieldMap[e],r=null!==(t=null==n?void 0:n.dataSource)&&void 0!==t?t:e;if(r)return null!=n&&n.complexMapping?sn.getPath(this.data,r):this.data[r]}syncId(e){const t=this.id;if(t!==e){this.setData("id",e);const n={id:{value:e,oldValue:t}};this.afterChange(n,n)}}set(e,t,n=!1,r=!1,i=!1){const s=this;if(s.isBatchUpdating)return s.inBatchSet(e,t,n||s.$silenceBatch),null;{var o,a;const l=null===(o=s.beforeSet)||void 0===o?void 0:o.call(s,e,t,n,r),c=s.inSet(e,t,n,r,i);return null===(a=s.afterSet)||void 0===a||a.call(s,e,t,n,r,l,c),c}}fieldToKeys(e,t){return"string"!=typeof e?sn.assign({},e):{[e]:t}}inBatchSet(e,t,n){const r=this,{meta:i,constructor:s,fieldMap:o}=r,a={};let l,c=!1;if("string"!=typeof e?Object.keys(r.fieldToKeys(e,t)).forEach((n=>{l=o[n]||sn,t=s.processField(n,e[n],r),l.isEqual(i.batchChanges[n],t)||(a[n]={value:t,oldValue:r.get(n)},i.batchChanges[n]=t,c=!0)})):(l=o[e]||sn,l.isEqual(i.batchChanges[e],t)||(a[e]={value:t,oldValue:r.get(e)},i.batchChanges[e]=t,c=!0)),c&&(r.generation++,!n)){const e={action:"update",record:r,records:[r],changes:a};r.stores.forEach((t=>{t.trigger("batchedUpdate",f({},e))})),r.forEachLinked(((t,n)=>t.trigger("batchedUpdate",f(f({},e),{},{record:n,records:[n]}))))}}inSet(e,t,n,r,i=!1){const s=this,{data:o,meta:a,fieldMap:l,constructor:c}=s,{prototype:d,childrenField:u}=c,h={},g=s.fieldToKeys(e,t),m=Object.keys(g);let p=!1;if(!n&&!s.triggerBeforeUpdate(g))return null;s.inSetting=!0;for(let e=0;e<m.length;e++){var f;const t=m[e];if(t===u)continue;const n=l[t],v=n||sn,y=null==n?void 0:n.readOnly,b=null!==(f=null==n?void 0:n.dataSource)&&void 0!==f?f:t,C=!i&&!n&&t in d,w=C?s[b]:null!=n&&n.complexMapping?sn.getPath(o,b):o[b],S=c.processField(t,g[t],s),D=g[t]={value:S},E=s.getRelationConfig(t);y||v.isEqual(w,S)||(s.generation++,D.oldValue=w,p=!0,v.isEqual(s.meta.modified[t],S)?Reflect.deleteProperty(a.modified,t):s.ignoreBag||(t in a.modified||s.storeFieldChange(t,w),D.oldValue===Pi&&Reflect.deleteProperty(D,"oldValue")),h[t]=D,s.applyValue(C,b,S,i,n),E&&!r&&(s.initRelation(E),s.stores.forEach((e=>e.cacheRelatedRecord(s,S,E.relationName,D.oldValue)))))}return p&&s.afterChange(g,h,n,r,i),s.inSetting=!1,p?h:null}applyValue(e,t,n,r,i){var s,o;let a=null===(s=i)||void 0===s?void 0:s.complexMapping;var l;if(e||t===this.constructor.parentIdField)this[(null===(l=i)||void 0===l?void 0:l.name)||t]=n;else if(null!==(o=i)&&void 0!==o&&o.set)i.set(n,this.data,this);else{if(!i&&t.includes(".")){var c,d;const e=t.split(".")[0];a=(null===(c=i=this.constructor.fieldMap[e])||void 0===c?void 0:c.complexMapping)||"object"===(null===(d=i)||void 0===d?void 0:d.type)}a?sn.setPath(this.data,t,n):this.data[t]=n}}afterChange(e,t,n,r,i){for(const s of this.stores)s.onModelChange(this,e,t,n,r,i);this.forEachLinked(((s,o)=>s.onModelChange(o,e,t,n,r,i)))}forEachLinked(e){for(const t of this.$links)for(const n of t.stores)e(n,t)}get isPersistable(){return!this.isBatchUpdating&&!this.isCreating}get isModified(){return Boolean(this.meta.modified&&Object.keys(this.meta.modified).length>0)}get hasPersistableChanges(){return this.isPersistable&&!sn.isEmpty(this.rawModificationData)}isFieldModified(e){return this.isModified&&e in this.meta.modified}getFieldPersistentValue(e){const t="string"==typeof e?this.getFieldDefinition(e):e,n=(null==t?void 0:t.name)||e;let r;return t&&!t.persist||(r=this[n],null!=t&&t.serialize&&(r=t.serialize(r,this))),r}get modifications(){const e=this.rawModifications;return e&&Object.keys(e).length&&(e[this.constructor.idField]=this.id),e}get rawModifications(){const e=this,t={};if(!e.isModified)return null;let n=!1;return Object.keys(e.meta.modified).forEach((r=>{const i=e.getFieldPersistentValue(r);i!==Pi&&(t[r]=i,n=!0)})),n?t:null}get modificationData(){const e=this.rawModificationData;return e&&Object.keys(e).length&&sn.setPath(e,this.constructor.getFieldDefinition(this.constructor.idField).dataSource,this.id),e}get rawModificationData(){const e=this,{fieldMap:t}=e.constructor,n={};if(!e.isModified)return null;let r=!1;return Object.keys(e.meta.modified).forEach((i=>{const s=t[i];if(null!=s&&s.persist){const t=e.getFieldPersistentValue(i);t!==Pi&&(sn.setPath(n,s.dataSource,t),r=!0)}})),r?n:null}get modificationDataToWrite(){const e=this.constructor.alwaysWriteFields,t=this.modificationData;return e.forEach((e=>{t[this.getFieldDefinition(e).dataSource]=this.getFieldPersistentValue(e)})),t}get persistableData(){const e=this,t={};return e.fields.forEach((n=>{const r=e.getFieldPersistentValue(n);r!==Pi&&(null!=n&&n.complexMapping?sn.setPath(t,n.dataSource,r):t[n.dataSource]=r)})),t}get isCommitting(){return Boolean(this.meta.committing)}clearChanges(e=!0,t=!0,n=null){const r=this,{meta:i}=r;if(n)for(const e in n)delete i.modified[e];else i.modified={};const s=sn.isEmpty(i.modified);i.committing=!1,t&&r.stores.forEach((t=>{if(s&&t.modified.remove(r),t.added.remove(r),e){const e=t.collectDescendants(r).all;t.added.remove(e),s&&t.modified.remove(e)}}))}storeFieldChange(e,t){this.meta.modified[e]=t}revertChanges(e=!1){this.set(this.meta.modified,Pi,e)}applyChangeset(e,t="$PhantomId",n=!0){const r=this,i=r.constructor,{idField:s,fieldDataSourceMap:o}=i,a=sn.pathifyKeys(e),l=sn.pathifyKeys(r.modificationData),c={},d=t in e;for(const e in a){var u;const t=o[e],r=null!==(u=null==t?void 0:t.name)&&void 0!==u?u:e;(n||((null==t?void 0:t.name)===s?d:a[e]===l[e]))&&(c[r]=a[e])}const h=r.set(c);return r.clearChanges(!1,!0,n?null:c),h?Object.entries(h).reduce(((e,[t,n])=>(e[t]=n.value,e)),{}):{}}get internalId(){return this._internalId}get isPhantom(){return""===this.id||null==this.id||this.hasGeneratedId}get isModel(){return!0}get hasGeneratedId(){return"string"==typeof this.id&&this.id.startsWith("_generated")}static generateId(e=this.$$name){return`_generated${e}_${_.generateUUID()}`}generateId(){return this.constructor.generateId()}static asId(e){return null!=e&&e.isModel?e.id:sn.isObject(e)?e[this.fieldMap.id.dataSource]:e}get json(){return _.safeJsonStringify(this)}toJSON(){const{children:e,unfilteredChildren:t}=this,n=this.persistableData;return(t||e)&&(n[this.constructor.childrenField]=(t||e).map((e=>e.toJSON()))),n}toString(){const e=this,t=_i.find((t=>t in e.constructor.fieldMap)),n=t?{[e.constructor.idField]:e.id,[t]:e[t]}:e.data;return _.safeJsonStringify(n)}get isBatchUpdating(){return Boolean(this.batching)}hasBatchedChange(e){var t,n;return null===(t=this.meta)||void 0===t||null===(n=t.batchChanges)||void 0===n?void 0:n[e]}beginBatch(e=!1){const t=this;t.batching||(t.batching=0,t.meta.batchChanges={}),e&&(t.$silenceBatch=(t.$silenceBatch||0)+1),t.batching++}endBatch(e=!1,t=!1){const n=this,{parentIdField:r}=n.constructor;if(n.batching&&(n.batching--,n.$silenceBatch&&n.$silenceBatch--,!(n.batching>0||sn.isEmpty(n.meta.batchChanges)))){const i=f({},n.meta.batchChanges);n.meta.batchChanges=null,i[r]&&(n.parentId=i[r],delete i[r]),n.set(i,Pi,e,!1,t)}}cancelBatch(){if(this.batching){const e=this,{batchChanges:t}=e.meta,n={};if(e.batching=null,e.meta.batchChanges=null,e.generation++,!e.$silenceBatch){Object.entries(t).forEach((([t,r])=>{n[t]={oldValue:r,value:e[t]}}));const r={action:"update",record:e,records:[e],changes:n};e.stores.forEach((e=>{e.trigger("batchedUpdate",f({},r))})),e.forEachLinked(((e,t)=>{e.trigger("batchedUpdate",f(f({},r),{},{record:t,records:[t]}))}))}e.$silenceBatch&&e.$silenceBatch--}}triggerBeforeUpdate(e){var t;return!(null!==(t=this.stores)&&void 0!==t&&t.some((t=>!1===t.trigger("beforeUpdate",{record:this,changes:e}))))}copy(e=null,t){const n=this,r=sn.clone(n.data),i=n.constructor.idField,s=sn.isObject(t)?t.deep:t;let o;e&&"object"==typeof e?(o=e[i],Object.assign(r,e)):o=e,s&&n.children?r.children=n.children.map((e=>e.copy(void 0,t))):(delete r.children,delete r.expanded),!1!==e&&(r[i]=o||n.generateId(n.firstStore));const a=new n.constructor(r,null,null,!1,!0);return a.originalInternalId=n.internalId,a}copyData(e){const t={};e.allFields.forEach((({name:n})=>{n!==e.constructor.idField&&(t[n]=e[n])})),this.set(t)}remove(e=!1){const t=this,{parent:n}=this;n?n.removeChild(t):t.stores.length&&(t.isSpecialRow||t.stores.forEach((n=>n.remove(t,e,!1,!0))))}beforeRemove(e,t){return super.beforeRemove(e,t)}getRelationConfig(e){var t,n;return null===(t=this.firstStore)||void 0===t||null===(n=t.modelRelations)||void 0===n?void 0:n.find((t=>t.fieldName===e))}get isValid(){return!0}get firstStore(){return this.stores.length>0&&this.stores[0]}joinStore(e){const t=this,{stores:n}=t;if(!n.includes(e)){const{unjoinedStores:r}=t;super.joinStore(e),e.register(t),n.push(e),r.includes(e)&&r.splice(r.indexOf(e),1),t.isLoaded&&t.children.forEach((t=>t.joinStore(e))),t.initRelations(),e.tree&&!t.isRoot&&(t.instanceMeta(e.id).collapsed=!t.expanded)}}unjoinStore(e,t=!1){const n=this,{stores:r,unjoinedStores:i}=n;var s,o;r.includes(e)&&(e.isDestroying||(e.unregister(n),i.push(e)),null===(s=n.unfilteredChildren||n.children)||void 0===s||null===(o=s.forEach)||void 0===o||o.call(s,(n=>n.unjoinStore(e,t))),r.splice(r.indexOf(e),1),super.unjoinStore&&super.unjoinStore(e,t),e.uncacheRelatedRecord(n))}isPartOfStore(e){return e?e.includes(this):this.stores.length>0}get isRemoved(){return!this.isPartOfStore()}instanceMeta(e){const{meta:t}=this,n=e.id||e;return t.map||(t.map={}),t.map[n]||(t.map[n]={})}get isGroupHeader(){return"groupRowFor"in this.meta}get isGroupFooter(){return"groupFooterFor"in this.meta}get isSpecialRow(){var e;return Boolean(null===(e=this.meta)||void 0===e?void 0:e.specialRow)}static get nonPersistableFields(){const e=this;return e._nonPersistableFields||(e._nonPersistableFields={},e.allFields.forEach((t=>{t.persist&&!t.calculated||(e._nonPersistableFields[t.name]=1)}))),e._nonPersistableFields}static get alwaysWriteFields(){const e=this;return e._alwaysWriteFields||(e._alwaysWriteFields=[],e.allFields.forEach((t=>{t.alwaysWrite&&e._alwaysWriteFields.push(t.name)}))),e._alwaysWriteFields}get domId(){return"string"==typeof this.id?this.id.replace(/[ .]/g,"-"):this.id}static toJavaScriptValue(e){const{names:t}=this.$meta;return`class ${t[t.length-2]} extends ${t[t.length-3]} { static fields = ${_.toJavaScriptValue(this.fields,e)}; }`}getCurrentConfig(e){const{data:t,children:n}=this,{defaultValues:r,applyConfigs:i}=this.constructor,s=i?super.getCurrentConfig(e):{};if(s){for(const n of this.fields)if(n.persist){const i=sn.getPath(t,n.dataSource);n.isEqual(i,r[n.name])||sn.setPath(s,n.dataSource,Te.processConfigValue(i,e))}if(n)if(Array.isArray(n)){s.children=[];for(const t of n)s.children.push(t.getCurrentConfig(e))}else s.children=n;this.hasGeneratedId&&delete s.id,delete s.parentId,delete s.parentIndex}return s}}Hi._idField="id",Hi._internalIdCounter=1,Hi._assignedIdField=!1,Hi.exposeProperties(),Hi._$name="Model";class Bi{constructor(e,t){"number"==typeof e||null===e?(this._magnitude=e,this._unit=t):("string"==typeof e&&Object.assign(this,en.parseDuration(e)),"object"==typeof e&&Object.assign(this,e))}get magnitude(){return this._magnitude}set magnitude(e){this._magnitude="number"==typeof e&&e}get unit(){return this._unit}set unit(e){this._unit=en.parseTimeUnit(e)}get isValid(){return null!=this._magnitude&&Boolean(en.normalizeUnit(this._unit))}get milliseconds(){return this.isValid?Math.round(en.asMilliseconds(this._magnitude,this._unit)):0}isEqual(e){return Boolean(e)&&null!=this._magnitude&&null!=e._magnitude&&this.milliseconds===e.milliseconds}toString(e){const t=this,n=e?"getShortNameOfUnit":"getLocalizedNameOfUnit";return t.isValid?`${t._magnitude} ${en[n](t._unit,1!==t._magnitude)}`:""}toJSON(){return this.toString()}valueOf(){return this.milliseconds}}Bi._$name="Duration";const ji=(e,t)=>null==e?void 0:e[t],Vi=/^is(this|next|last)(week|month|year)$/i,zi=["isToday","isTomorrow","isYesterday","isThisWeek","isNextWeek","isLastWeek","isThisMonth","isNextMonth","isLastMonth","isThisYear","isNextYear","isLastYear","isYearToDate"];class Wi extends(Te.mixin(ci)){static get defaultConfig(){return{value:null,operator:null,filterBy:null,convert:null,caseSensitive:!0,id:null,type:null,internal:null,disabled:!1}}static get configurable(){return{property:null}}construct(e){"function"==typeof e&&(e={filterBy:e}),e.type?"date"!==e.type||null==e.value||Array.isArray(e.value)?"duration"!==e.type||null==e.value||Array.isArray(e.value)||(e.value=new Bi(e.value)):e.value=new Date(e.value):en.isDate(e.value)||Array.isArray(e.value)&&e.value.every(en.isDate)?e.type="date":e.value instanceof Bi&&(e.type="duration"),super.construct(e)}get id(){return this._id||(this.internal?this._id=Wi.generateId(`b-internal-${this.property}-filter-`):this._id=this.property||Wi.generateId("b-filter-")),this._id}set id(e){this._id=e}onChange(e){const t=this;!t.isConfiguring&&t.owner&&!t.owner.isConfiguring&&t.owner.onFilterChanged&&t.owner.onFilterChanged(t,e)}get filterBy(){return this._filterBy||this.defaultFilterBy}set filterBy(e){this._filterBy=e}defaultFilterBy(e){const t=this;let n;return n=t._propertyItems.length>1?t._propertyItems.reduce(ji,e):e[t.property],t[t.operator](t.convert(n))}updateProperty(e){this._propertyItems=e.split("."),this.onChange("property")}set value(e){const t=this;t._value=e,Array.isArray(e)&&({date:1,duration:1}[t.type]||e.length>0&&"string"==typeof e[0])?t._filterValue=e.map((e=>t.convert(e))):!t.caseSensitive&&Array.isArray(e)&&e.length>0&&"string"==typeof e[0]?t._filterValue=e.map((e=>null==e?void 0:e.toLowerCase())):t.caseSensitive||"string"!=typeof e?t._filterValue=t.convert(e):t._filterValue=e.toLowerCase(),t.onChange("value")}get value(){return this._value}get filterValue(){return this._filterValue}set operator(e){this._operator=e,this.onChange("operator")}get operator(){const e=this;return e._operator?e._operator:Array.isArray(e.filterValue)?"isIncludedIn":"string"==typeof e.filterValue?"*":"="}convert(e){var t,n;return"sameTime"===this.operator||"string"==typeof this.filterValue&&e instanceof Date||("sameDay"===this.operator&&(e=en.clearTime(e)),e=null!==(t=null===(n=e)||void 0===n?void 0:n.valueOf())&&void 0!==t?t:e),this.caseSensitive||"string"!=typeof e?e:e.toLowerCase()}filter(e){return this.filterBy(e)}startsWith(e){return String(e).startsWith(this.filterValue)}endsWith(e){return String(e).endsWith(this.filterValue)}isIncludedIn(e){return 0===this.filterValue.length||this.filterValue.includes(e)}isNotIncludedIn(e){return!this.isIncludedIn(e)}includes(e){return 0===this.filterValue.length||String(e).includes(this.filterValue)}doesNotInclude(e){return!this.includes(e)}sameTime(e){return en.isSameTime(e,this.filterValue)}sameDay(e){return e===this.filterValue}"="(e){return sn.isEqual(e,this.filterValue)}"!="(e){return!sn.isEqual(e,this.filterValue)}">"(e){return sn.isMoreThan(e,this.filterValue)}">="(e){return sn.isMoreThan(e,this.filterValue)||sn.isEqual(e,this.filterValue)}"<"(e){return sn.isLessThan(e,this.filterValue)}"<="(e){return sn.isLessThan(e,this.filterValue)||sn.isEqual(e,this.filterValue)}"*"(e){return sn.isPartial(e,this.filterValue)}between(e){const[t,n]=this._filterValue;return(sn.isMoreThan(e,t)||sn.isEqual(e,t))&&(sn.isLessThan(e,n)||sn.isEqual(e,n))}notBetween(e){return!this.between(e)}empty(e){return null==e||0===String(e).length}notEmpty(e){return!this.empty(e)}isToday(e){return this.between(e)}isTomorrow(e){return this.between(e)}isYesterday(e){return this.between(e)}isThisWeek(e){return this.between(e)}isNextWeek(e){return this.between(e)}isLastWeek(e){return this.between(e)}isThisMonth(e){return this.between(e)}isNextMonth(e){return this.between(e)}isLastMonth(e){return this.between(e)}isThisYear(e){return this.between(e)}isNextYear(e){return this.between(e)}isLastYear(e){return this.between(e)}isYearToDate(e){return this.between(e)}isTrue(e){return!0===e}isFalse(e){return!1===e}setRelativeDateValues(){this._filterValue=Wi.getRelativeDateRange(this._operator).map((e=>e.valueOf()))}static getRelativeDateRange(e,t=new Date){let n,r,i,s,o,a,l;switch(e){case"isYearToDate":return[en.floor(t,"1 year"),t];case"isToday":return n=en.floor(t,"1 day"),[n,en.add(n,1,"day")];case"isYesterday":return n=en.floor(t,"1 day"),[en.add(n,-1,"day"),n];case"isTomorrow":return r=en.getStartOfNextDay(t),[r,en.add(r,1,"day")];case"isThisWeek":case"isNextWeek":case"isLastWeek":case"isThisMonth":case"isNextMonth":case"isLastMonth":case"isThisYear":case"isNextYear":case"isLastYear":if(i=e.toLowerCase().match(Vi),!i)throw new Error(`Unrecognized relative date expression: ${e}`);return[,a,l]=i,s=`1 ${l}`,o=en.floor(t,s),"next"===a?o=en.add(o,1,l):"last"===a&&(o=en.add(o,-1,l)),[o,en.add(o,1,l)]}}static generateFiltersFunction(e){if(!e||!e.length&&!e.count)return $e.returnTrue;for(const t of e)"date"===t.type&&zi.includes(t._operator)&&t.setRelativeDateValues();return function(t){let n=!0;for(const r of e)if(r.disabled||(n=r.filter(t)),!n)break;return n}}}Wi._$name="CollectionFilter";const Ui=sn.getPathDefault(globalThis,"bryntum.idCounts",Object.create(null));class Yi{static generateId(e="generatedId"){return e+(Ui[e]=(Ui[e]||0)+1)}}Yi._$name="IdHelper";class Gi extends Te{static get defaultConfig(){return{property:null,direction:"ASC",sortFn:null,convert:null,id:null,useLocaleSort:null}}construct(e){"function"==typeof e&&(e={sortFn:e}),super.construct(e)}get id(){return this._id||(this._id=this.property||Yi.generateId("b-sorter"))}set id(e){this._id=e}set sortFn(e){this._sortFn=e}get sortFn(){return this._sortFn?this._sortFn:this.defaultSortFn}defaultSortFn(e,t){const{convert:n,property:r,useLocaleSort:i}=this,s="desc"===this.direction.toLowerCase()?-1:1;if(e=e[r],t=t[r],n&&(e=n(e),t=n(t)),i&&null!=e&&null!=t&&"string"==typeof e){if(!0===i)return String(e).localeCompare(t);if("string"==typeof i)return String(e).localeCompare(t,i);if("object"==typeof i)return String(e).localeCompare(t,i.locale,i)}return(e>t?1:e<t?-1:0)*s}static generateSortFunction(e,t){const n=e.isCollection?e.values:e,r=n.length;return(e,i)=>{let s,o;for(o=0;o<r;++o)if(s=n[o].sortFn(e,i),s)return s;return t?t(e,i):0}}}Gi._$name="CollectionSorter";const qi=()=>0,Ki=(e,t)=>t-e,Xi=Symbol("filteredIndicesProperty"),Zi=Object.freeze([]),Ji=Object.freeze({action:"sort",added:Zi,removed:Zi,replaced:Zi}),Qi=Object.freeze({action:"filter",added:Zi,removed:Zi,replaced:Zi}),es={string:1,number:1};function ts(e,t,n){if(!1!==t.unique)t.set(n,e);else{let r=t.get(n);r||(r=new Set,t.set(n,r)),r.add(e)}}function ns(e,t,n,r){for(let i=0;i<e.length;i++){const s=e[i];for(let e=0;e<r;e++){const r=n[e],i=s[r];ts(s,t[r],i)}}}class rs extends(Te.mixin(tt)){static get configurable(){return{idProperty:"id",extraKeys:null,autoFilter:!0,autoSort:!0,sorters:{$config:["lazy"],value:[]}}}get isCollection(){return!0}construct(e){this.generation=0,this._values=[],super.construct(e)}doDestroy(){var e;super.doDestroy();const t=this;t._values.length=0,t.isFiltered&&(t._filteredValues.length=0,t.filters.destroy()),null===(e=t._sorters)||void 0===e||e.destroy()}clear(){const e=this,t=e._values.slice();e.totalCount&&(e._values.length=0,e._filteredValues&&(e._filteredValues.length=0),e._indicesInvalid=!0,e.generation++,e.trigger("change",{action:"clear",removed:t}))}equals(e,t){if(e.isCollection&&(e=e.values),e.length===this.count){let{values:n}=this;return t&&(e=e.map(t),n=n.map(t)),ke.delta(e,n).inBoth.length===this.count}return!1}replaceValues({values:e,filteredValues:t,silent:n=!1,isNewDataset:r=!1}){const i=this;let s,o;i.isFiltered&&!r?(Boolean(t)?e&&(s=i._values,i._values=e.slice()):(t=e.slice(),e=null),o=i._filteredValues,i._filteredValues=t.slice()):(s=i._values,i._values=e.slice(),t=null,i.isFiltered&&r&&i.autoFilter?(i._filterFunction=null,i._filteredValues=i._values.filter(i.filterFunction)):i._filteredValues&&(i._filteredValues.length=0)),i._indicesInvalid=!0,i.generation++,n||i.trigger("change",{action:"replaceValues",replacedValues:s,replacedFilteredValues:o,values:e,filteredValues:t})}set values(e){this.invalidateIndices(),this.splice(0,this._values.length,e)}get values(){return this.isFiltered?this._filteredValues:this._values}[Symbol.iterator](){return this.values[Symbol.iterator]()}forEach(e,t=!1){(this.isFiltered&&!t?this._filteredValues:this._values).forEach(e)}map(e,t=!1){return(this.isFiltered&&!t?this._filteredValues:this._values).map(e)}find(e,t=!1){return(this.isFiltered&&!t?this._filteredValues:this._values).find(e)}get first(){return this.values[0]}get last(){return this.values[this.count-1]}get allValues(){return this._values}add(...e){1===e.length?this.splice(this._values.length,null,...e):this.splice(this._values.length,null,e)}remove(...e){1===e.length?this.splice(0,...e):this.splice(0,e)}move(e,t){for(e=ke.asArray(e);e.length&&e[0]===t;)e.shift();if(!e.length)return;const n=this,{_values:r}=n,i=n.indexOf(e[0],!0);if(1===e.length&&r[i+1]===t)return;n.suspendEvents(),n.remove(e),n.resumeEvents();const s=t?n.indexOf(t,!0):r.length;if(-1===s)throw new Error("Collection move beforeItem parameter must be present in Collection");return r.splice(s,0,...e),n._indicesInvalid=1,n.trigger("change",{action:"move",items:e,from:i,to:s}),s}splice(e=0,t,...n){const r=this,i=r.idProperty,s=r._values,o={},a=[],l=[],c=r.totalCount;let d,u;if(!1!==r.trigger("beforeSplice",{index:e,toRemove:t,toAdd:n})){if(n)if(1===n.length&&Array.isArray(n[0])&&(n=n[0]),c&&n.length){const e=r.indices[i];d=[];for(let t=0;t<n.length;t++){const r=n[t],a=r[i],c=e.get(a),u=c?s.indexOf(c):-1;o[a]=!0,-1!==u?s[u]!==r&&(l.push([s[u],r]),s[u]=r):d.push(r)}}else d=n;if(t){if("number"==typeof t){t=Math.min(t,s.length-e);for(let n=e;t;--t)o[s[n][i]]?(e++,n++):(a.push(s[n]),s.splice(n,1),u=!0)}else{let e,n=0===d.length;const l=(t=ke.asArray(t)).reduce(((t,i)=>{const s="number"==typeof i,o=s?i:r.indexOf(i,!0);return n&&(null!=e&&o!==e+1||s)&&(n=!1),o>=0&&o<c&&t.push(o),e=o,t}),[]).sort(Ki);if(n)l.length&&(a.push.apply(a,t),s.splice(l[l.length-1],l.length),u=!0);else for(let e=0;e<l.length;e++){const t=l[e];-1!==t&&(o[s[t][i]]||(a.unshift(s[t]),s.splice(t,1),u=!0))}}a.length&&!r._indicesInvalid&&a.forEach(r.removeFromIndices,r)}d.length&&(s.splice(Math.min(e,s.length),0,...d),u=!0,r._indicesInvalid||d.forEach(r.addToIndices,r)),l.length&&!r._indicesInvalid&&l.forEach((e=>{r.removeFromIndices(e[0]),r.addToIndices(e[1])})),u||l.length?(r.isSorted?r.onSortersChanged():r.isFiltered&&(r.autoFilter?r.onFiltersChanged({action:"splice",oldCount:1}):r._filteredValues.push(...d)),r.generation++,r.trigger("change",{action:"splice",removed:a,added:d,replaced:l,oldCount:c})):r.trigger("noChange",{index:e,toRemove:t,toAdd:n})}}changeId(e,t){const n=this,{idProperty:r}=n,i=es[typeof e]?e:e[r],s=n.get(i);if(s){const o=n.get(t);if(o&&s!==o)throw new Error(`Attempt to set item ${i} to already existing member's id ${t}`);n.removeIndexEntry(e,r,i),n.addIndexEntry(e,r,t),s[r]=t}}get(e,t=!1){return this.getBy(this.idProperty,e,t)}getAt(e,t=!1){return this.isFiltered&&!t?this._filteredValues[e]:this._values[e]}getBy(e,t,n=!1){return this.findItem(e,t,this.isFiltered&&n)}get count(){return this.values.length}get totalCount(){return this._values.length}updateIdProperty(e){this.addIndex({property:e,unique:!0})}changeSorters(e){return new rs({values:ke.asArray(e),listeners:{change:"onSortersChanged",thisObj:this}})}addSorter(e){const t=e instanceof Gi?e:new Gi(e);return this.sorters.add(t),t}get isSorted(){var e;return Boolean(null===(e=this._sorters)||void 0===e?void 0:e.count)}onSortersChanged(){const e=this;delete e._sortFunction,e._values.sort(e.sortFunction),e.trigger("change",Ji)}get sortFunction(){return this._sortFunction||(this.isSorted?this._sortFunction=Gi.generateSortFunction(this.sorters.values):this._sortFunction=qi),this._sortFunction}get filters(){return this._filters||(this._filters=new rs({listeners:{change:"onFiltersChanged",thisObj:this}})),this._filters}addFilter(e){const t=e instanceof Wi?e:new Wi(e);return this.filters.add(t),t}removeFilter(e){const{filters:t}=this;e.isCollectionFilter||(e=t.get(e)),t.remove(e)}clearFilters(){this.filters.clear()}get isFiltered(){return Boolean(this._filters&&this._filters.count)}onFiltersChanged({action:e,removed:t,oldCount:n}){const r=this,i=n||"clear"===e&&t.length?r._filteredValues:r._values;r._filterFunction=null,r._filteredValues=r._values.filter(r.filterFunction),r._indicesInvalid=!0;const{toAdd:s,toRemove:o}=ke.delta(r._filteredValues,i,!0);r.trigger("change",f(f({},Qi),{},{added:s,removed:o}))}get filterFunction(){return this._filterFunction||(this.isFiltered?this._filterFunction=Wi.generateFiltersFunction(this.filters.values):this._filterFunction=$e.returnTrue),this._filterFunction}changeExtraKeys(e){return ke.asArray(e).map((e=>"string"==typeof e?{property:e,unique:!0}:e))}updateExtraKeys(e){for(let t=0;t<e.length;t++)this.addIndex(e[t])}addIndex(e){const t=this;e&&((t._indices||(t._indices={}))[e.property]=new Map,Object.assign(t._indices[e.property],e),t.invalidateIndices(),e.dependentOn&&(t.hasCompositeIndex=!0))}findIndex(e,t,n=!1){const r=this.findItem(e,t,n);return r?(this.isFiltered&&!n?this._filteredValues:this._values).indexOf(r):-1}findItem(e,t,n=!1){const r=this,{isFiltered:i}=r,s=i&&!n?r.indices[Xi][e]:r.indices[e];if(s){var o;const e=null!==(o=s.get(t))&&void 0!==o?o:"string"==typeof t&&t.length&&!isNaN(t)&&s.get(Number(t))||null;if(null!=e)return e}else{const s=i&&!n?r._filteredValues:r._values,o=s.length;for(let n=0;n<o;n++){const r=s[n];if(r[e]==t)return r}}return null}removeIndex(e){delete this._indices[e],this.hasCompositeIndex=Object.values(this.indices).some((e=>e.dependentOn))}indexOf(e,t=!1){return this.findIndex(this.idProperty,es[typeof e]?e:e[this.idProperty],t)}includes(e,t=!1){return Array.isArray(e)?e.some((e=>this.includes(e))):Boolean(this.findItem(this.idProperty,es[typeof e]?e:e[this.idProperty],t))}get indices(){return this._indicesInvalid&&this.rebuildIndices(),this._indices}invalidateIndices(){this._indicesInvalid=!0}rebuildIndices(){const e=this,t=e.isFiltered,n=e._indices||(e._indices={}),r=Object.keys(n),i=r.length,s=e._values;let o;t&&(o=n[Xi]={});for(let e=0;e<i;e++){const i=n[r[e]];if(i.clear(),t){let t=o[r[e]];t?t.clear():(t=o[r[e]]=new Map,t.unique=i.unique)}}ns(s,n,r,i),t&&ns(e._filteredValues,o,r,i),e._indicesInvalid=!1}getIndices(e){const t=[this.indices[e]];return this.isFiltered&&t.push(this.indices[Xi][e]),t}addToIndices(e){Object.keys(this.indices).forEach((t=>{this.addIndexEntry(e,t,e[t])}))}removeFromIndices(e){Object.keys(this.indices).forEach((t=>{this.removeIndexEntry(e,t,e[t])}))}removeIndexEntry(e,t,n){this.getIndices(t).forEach((t=>function(e,t,n){!1!==t.unique?t.delete(n):t.has(n)&&(t.get(n).delete(e),t.get(n).size||t.delete(n))}(e,t,n)))}addIndexEntry(e,t,n){this.getIndices(t).forEach((t=>ts(e,t,n)))}onItemMutation(e,t){const n=this;!n._indicesInvalid&&Object.keys(n.indices).length>1&&Object.keys(t).forEach((r=>{if(n.indices[r]){const{value:i,oldValue:s}=t[r];n.removeIndexEntry(e,r,s),n.addIndexEntry(e,r,i)}else if(n.hasCompositeIndex){const s=Object.values(n.indices).find((e=>{var t;return null===(t=e.dependentOn)||void 0===t?void 0:t[r]}));if(s){const r={};for(const n in s.dependentOn){var i;r[n]=(null===(i=t[n])||void 0===i?void 0:i.oldValue)||e[n]}const o=e.buildIndexKey(r);n.removeIndexEntry(e,s.property,o),n.addIndexEntry(e,s.property,e[s.property])}}}))}}rs._$name="Collection";const is=new WeakMap,ss=e=>{if(e&&"object"==typeof e){let t=is.get(e);void 0===t&&(t=Symbol("bscik"),is.set(e,t)),e=t}return e};class os{constructor(e){const t=this;t.generation=0,t.items=new Set,t.idMap={},t.idProperty="id",e&&(e.idProperty&&(t.idProperty=e.idProperty),e.values&&(t.values=e.values))}get(e){return this.idMap[ss(e)]}get count(){return this.items.size}add(...e){1===e.length&&Array.isArray(e[0])&&(e=e[0]);const t=this,{items:n,idMap:r,idProperty:i}=t,s=e.length;for(let o=0;o<s;o++){const s=e[o],a=es[typeof s]?s:ss(s[i]),l=r[a];null==l?(r[a]=s,n.add(s),t.generation++):l!==s&&(r[a]=s,n.delete(l),n.add(s))}}at(e){let t,n;for(t of(e<0&&(e+=this.count),this.items))if(!e--){n=t;break}return n}remove(e){e=ke.asArray(e);const{items:t,idMap:n,idProperty:r}=this,i=e.length;for(let s=0;s<i;s++){const i=e[s],o=es[typeof i]?i:ss(i[r]),a=n[o];null!=a&&(t.delete(a),delete n[o],this.generation++)}}clear(){this.items.clear(),this.idMap={},this.generation++}countOf(e){let t,n=0;for(t of this.items)e(t)&&++n;return n}changeId(e,t){const n=this,{idMap:r,idProperty:i}=n,s=es[typeof e]?e:ss(e[i]),o=n.get(s);if(o){const e=n.get(t);if(e&&o!==e)throw new Error(`Attempt to set item ${s} to already existing member's id ${t}`);o[i]=t,delete r[s],r[t]=o}}filter(e,t){const{items:n}=this,r=[];let i=0;return n.forEach((s=>{e.call(t,s,i++,n)&&r.push(s)})),r}includes(e){const t=es[typeof e]?e:ss(e[this.idProperty]);return Boolean(this.idMap[t])}map(e,t){const{items:n}=this,r=new Array(n.size);let i=0;return n.forEach((s=>{r[i]=e.call(t,s,i++,n)})),r}forEach(e,t){return this.items.forEach(e,t)}find(e,t=0){let n,r;for(n of(t<0&&(t+=this.countOf(e)),this.items))if(e(n)&&!t--){r=n;break}return r}[Symbol.iterator](){return this.items[Symbol.iterator]()}indexOf(e,t){let n,r=-1;for(n of this.items)if((!t||t(n))&&(++r,n===e))return r;return-1}get values(){return[...this.items]}set values(e){e=ke.asArray(e),this.clear(),this.add.apply(this,e),this.generation++}sort(e){this.values=this.values.sort(e)}some(e,t){return this.values.some(e,t)}}os._$name="Bag";class as extends os{add(...e){return 1===e.length&&Array.isArray(e[0])&&(e=e[0]),super.add(...e.filter((e=>e.isPersistable)))}}as._$name="StoreBag";var ls=e=>class extends(e||Te){static get $name(){return"StoreCRUD"}static get defaultConfig(){return{autoCommit:!1}}static get properties(){return{isRemoving:!1,suspendCount:0}}remove(e,t=!1){const n=this,{storage:r}=n;if(0===(e=ke.asArray(e).reduce(((e,t)=>((t=n.getById(t))&&e.push(t),e)),[])).length)return e;if(n.isRemoving=!0,n.isGrouped){const t=r.count,i=[],s=new Set;for(const t of e){const{groupParent:e}=t.instanceMeta(n);e.meta.collapsed&&i.push(t),ke.remove(e.groupChildren,t),e.meta.childCount--,s.add(e)}for(const e of s)e.groupChildren.length>0&&n.onModelChange(e,{},{});i.length&&r.trigger("change",{action:"splice",removed:i,added:[],replaced:[],oldCount:t})}else if(n.tree){const i=[],s=e.length>1,o=e[0],a=s?void 0:r.indexOf(o),l=e.reduce(((e,t)=>{const{parent:n}=t;return n&&(e[n.id]||(e[n.id]=[n,[]]),e[n.id][1].push(t)),e}),{});if(!t&&!1===n.trigger("beforeRemove",{records:e,isMove:!1,parent:s?void 0:o.parent}))return n.isRemoving=!1,[];for(const e of Object.values(l)){const t=e[0],n=e[1];i.push(...t.removeChild(n,!1,!0))}return t||(n.trigger("remove",{parent:s?void 0:o.parent,index:a,isChild:!0,allRecords:i,isMove:!1,records:e}),n.trigger("change",{action:"remove",records:e}),n.isRemoving=!1),e}for(const t of e)t.beforeRemove(e);return 0===e.length?e:t||!1!==n.trigger("beforeRemove",{records:e})?(t&&n.suspendEvents(),r.remove(e),t&&n.resumeEvents(),n.autoCommit&&n.doAutoCommit(),n.isRemoving=!1,e):(n.isRemoving=!1,[])}clear(e=!1){var t,n;const r=this,{storage:i}=r;if(r.storage.totalCount||null!==(t=r.rootNode)&&void 0!==t&&null!==(n=t.unfilteredChildren)&&void 0!==n&&n.length){if(!e&&!1===r.trigger("beforeRemove",{records:i.allValues,removingAll:!0}))return null;if(r.rootNode)r.isChained||r.rootNode.clearChildren(e);else if(e){const e=r.registeredRecords;for(let t,n=e.length-1;n>=0;n--)t=e[n],t&&!t.isDestroyed&&t.unjoinStore(r)}e&&(r.removed.clear(),i.suspendEvents()),i.clear(),e&&i.resumeEvents(),r.added.clear(),r.modified.clear()}}removeAll(e=!1){const t=this,n=t.storage;let r;if(t.isRemoving=!0,e){n.suspendEvents();const e=t.registeredRecords;for(let n,r=e.length-1;r>=0;r--)n=e[r],!n||n.isDestroyed||n.isRoot||n.unjoinStore(t)}return r=t.tree?!1!==t.rootNode.clear():null!==t.clear(),e&&n.resumeEvents(),t.isRemoving=!1,r}add(e,t=!1){var n;const r=this,{storage:i}=r;if(null===(n=e=ke.asArray(e))||void 0===n||!n.length)return;if(r.tree=r.tree||Boolean(r.autoTree&&e[0].children),r.tree){const n=new Map,i=r.modelClass.getFieldDataSource("parentIndex"),{parentIdField:s}=r.modelClass,o=[];return e.forEach((e=>{const t=e[s];n.has(t)||n.set(t,{append:[],insert:[]});const r=n.get(t);!e.isModel&&i in e?r.insert.push(e):r.append.push(e)})),n.forEach((({append:e,insert:n},s)=>{const a=null==s?r.rootNode:r.getById(s);if(!a)throw new Error(`Parent node with id ${s} not found, cannot add children.`);if(e.length&&o.push(...a.appendChild(e,t)),n.length)for(const e of n)o.push(a.insertChild(e,e[i],t))})),o}if(!t&&!1===r.trigger("beforeAdd",{records:e}))return null;if(r.tree=r.tree||Boolean(r.autoTree&&e[0].children),r.tree)return r.rootNode.appendChild(e);const s=r.processRecords(e);return t&&r.suspendEvents(),i.add(s),t&&r.resumeEvents(),r.autoCommit&&r.doAutoCommit(),s}processRecords(e,t){return e.map((e=>{const n=this.processRecord(e.isModel?e:this.createRecord(e));return null==t||t.call(this,n),n}))}insert(e,t,n=!1){const r=this,i=r.storage,s=r.getAt(e),o=i.values,a=[];if(t=ke.asArray(t),!n&&!1===r.trigger("beforeAdd",{records:t}))return null;let l,c,d;if(o[c=e]===t[0]||o[c=e-1]===t[0])for(l=!0,d=0;l&&d<t.length;d++)t[d]!==o[c+d]&&(l=!1);if(l)return null;const u=r.processRecords(t,(t=>{const n=i.indexOf(t);t.children&&t.children.length&&r.autoTree&&(r.tree=!0),n>-1&&(n<e&&s&&e--,a.push(n)),t.meta.previousIndex=n}));if(r.tree){var h;const i=r.rootNode;return i.insertChild(t,null===(h=i.children)||void 0===h?void 0:h[e],n)}return r.suspendEvents(),r.storage.remove(a),r.resumeEvents(),n&&r.suspendEvents(),i.splice(e,0,...u),n&&r.resumeEvents(),r.autoCommit&&r.doAutoCommit(),u}move(e,t){this.isTree?t.parent.insertChild(e,t):this.storage.move(e,t)}setMultiple(e,t,n){const r=this,i=[],s=[];r.forEach((r=>{e(r)&&(s.push(r.set(t,n,!0)),i.push(r))})),r.trigger("updateMultiple",{records:i,all:r.records.length===i.length}),r.trigger("change",{action:"updatemultiple",records:i,all:r.records.length===i.length}),r.reapplyFilterOnUpdate&&r.isFiltered&&r.filter()}setAll(e,t){const n=this,r=[];n.forEach((n=>{r.push(n.set(e,t,!0))})),n.trigger("updateMultiple",{records:n.records,all:!0}),n.trigger("change",{action:"updatemultiple",records:n.records,all:!0}),n.reapplyFilterOnUpdate&&n.isFiltered&&n.filter()}acceptChanges(){const e=this;e.added.forEach((e=>e.clearChanges(!0,!1))),e.modified.forEach((e=>e.clearChanges(!0,!1))),e.added.clear(),e.modified.clear(),e.removed.clear()}commit(e=!1){const{changes:t}=this;return!(!e&&!1===this.trigger("beforeCommit",{changes:t}))&&(this.acceptChanges(),e||this.trigger("commit",{changes:t}),t)}revertChanges(){const e=this,{changes:t}=e;if(t){const n={action:"clearchanges",changes:t};e.add(e.removed.values,!0),e.remove(e.added.values,!0),e.modified.forEach((e=>e.revertChanges(!0))),e.added.clear(),e.modified.clear(),e.removed.clear(),e.trigger("change",n),e.trigger("refresh",n)}}get changes(){const e=this,t=e.modified.values.filter((e=>e.rawModifications));return e.added.count||t.length||e.removed.count?{added:e.added.values.slice(),modified:t,removed:e.removed.values.slice()}:null}get autoCommit(){return this._autoCommit}set autoCommit(e){this._autoCommit=e,e&&this.changes&&this.commit()}suspendAutoCommit(){this.suspendCount++}resumeAutoCommit(e=!0){this.suspendCount--,this.autoCommit&&e&&this.doAutoCommit()}doAutoCommit(){this.suspendCount<=0&&this.commit()}},cs=e=>class extends(e||Te){static get $name(){return"StoreChanges"}applyChangesFromStore(e){const t=this,{changes:n}=e;n&&(n.added&&t.add(n.added),n.removed&&t.remove(n.removed.map((e=>e.id))),n.modified&&n.modified.forEach((e=>{t.getById(e.id).set(e.modifications)})))}applyChangeset(e,t=null,n="$PhantomId",r=!0,i=!1){var s,o;const a=this,{added:l,updated:c,modified:d,removed:u}=null!==(s=null==t?void 0:t(e,a))&&void 0!==s?s:e,h=null!==(o=null!=c?c:d)&&void 0!==o?o:[],g=a.modelClass.getFieldDataSource("id"),m=i?new Map:null;if((null==l?void 0:l.length)>0){var p;const e=[],t=[];for(const r of l){var f;a.getById(null!==(f=r[n])&&void 0!==f?f:sn.getPath(r,g))?e.push(r):t.push(r)}h.unshift.apply(h,e);const r=null!==(p=a.add(t))&&void 0!==p?p:[];for(const e of r)null==m||m.set(e.id,e.data),e.clearChanges()}if((null==h?void 0:h.length)>0)for(const e of h){const t=e[n],i=sn.getPath(e,g),s=a.getById(null!=t?t:i);if(s){const t=s.applyChangeset(e,n,r);null==m||m.set(i,t)}}return(null==u?void 0:u.length)>0&&a.applyRemovals(u),m}applyRemovals(e){const t=this,{removed:n}=t,r=t.modelClass.getFieldDataSource(t.modelClass.idField),i=[];for(const t of e){const e=sn.getPath(t,r);n.includes(e)?n.remove(e):i.push(e)}t.remove(i);for(const e of i)n.remove(e)}},ds=e=>class extends(e||Te){static get $name(){return"StoreFilter"}static get defaultConfig(){return{filters:null,reapplyFilterOnAdd:!1,reapplyFilterOnUpdate:!1}}set reapplyFilterOnAdd(e){this.storage.autoFilter=e}get reapplyFilterOnAdd(){return this.storage.autoFilter}set filters(e){const t=this,n=t.filters;if(n.clear(),t._filtersFunction=null,e){if("Object"===e.constructor.name)for(const t of Object.entries(e))"filterBy"===t[0]&&"function"==typeof t[1]?n.add(new Wi({filterBy:t[1]})):n.add(new Wi("Object"===t[1].constructor.name?Object.assign({property:t[0]},t[1]):{property:t[0],value:t[1]}));else Array.isArray(e)?n.add(...e.map((e=>e instanceof Wi?e:new Wi(e)))):e.isCollection?n.add(...e.values):n.add(new Wi({filterBy:e}));n.forEach((e=>e.owner=t))}}get filters(){return this._filters||(this._filters=new rs({extraKeys:["property"]}))}set filtersFunction(e){this._filtersFunction=e}get filtersFunction(){const e=this,{filters:t,isGrouped:n}=e;if(!e._filtersFunction)if(t.count){const r=Wi.generateFiltersFunction(t);e._filtersFunction=e=>n&&e.isSpecialRow?e.groupChildren.some(r):r(e)}else e._filtersFunction=$e.returnTrue;return e._filtersFunction}get isFiltered(){return this.filters.values.some((e=>!e.disabled))}traverseFilter(e){const t=this,n=!e.isRoot&&t.filtersFunction(e),r=e.unfilteredChildren||e.children;return r&&r.length?(e.unfilteredChildren||(e.unfilteredChildren=e.children.slice()),e.children=e.unfilteredChildren.filter((e=>t.traverseFilter(e))),e.updateChildrenIndices(e.unfilteredChildren,!0,!0),e.updateChildrenIndices(e.children,!1,!0),n||Boolean(e.children.length)):n}traverseClearFilter(e){const t=this;e.unfilteredChildren&&(e.children=e.unfilteredChildren.slice(),e.unfilteredChildren=null),e.children&&(e.children.forEach((e=>t.traverseClearFilter(e))),e.updateChildrenIndices(e.children,!1,!0))}get latestFilterField(){return this.filters.last?this.filters.last.property:null}addFilter(e,t=!1){const n=this;if((e=e instanceof Wi?e:new Wi(e)).owner=n,n.filters.add(e),!t){if(n.remoteFilter)return n.filter().then((()=>e));n.filter()}return e}filter(e){const t=this;let n,r=!1;if(e){let i=typeof e;if("object"===i&&("silent"in e||"replace"in e||e.filters)&&(r=e.silent,e.replace&&t.clearFilters(0===e.filters.length),n=e.internal,i=typeof(e=e.filters)),e){const r=t.isFiltered;if(t.isConfiguring=!0,Array.isArray(e))e.forEach((e=>t.addFilter(e,!0)),t);else if("function"===i){const r=new Wi(e);r.internal=n,t.addFilter(r,!0)}else"string"===i?t.addFilter({property:e,value:arguments[1]},!0):t.addFilter(e,!0);if(t.isConfiguring=!1,!t.isFiltered&&!r)return null}}return t.filtersFunction=null,t.performFilter(r)}performFilter(e){const t=this,{storage:n,filters:r,rootNode:i}=t,s=t.count;let o,a;if(t.trigger("beforeFilter",{filters:r}),t.tree){const e=n.values;t.isFiltered?t.traverseFilter(i):t.traverseClearFilter(i);const r=t.collectDescendants(i).visible;n.replaceValues({values:r,silent:!0});const s=ke.delta(r,e,!0);o=s.toAdd,a=s.toRemove}else n.on({change({removed:e,added:t}){a=e,o=t},once:!0}),t.isFiltered?(t.isGrouped&&t.includeCollapsed(),n.addFilter({id:"primary-filter",filterBy:t.filtersFunction}),t.isGrouped&&t.excludeCollapsed()):n.filters.clear();t.afterPerformFilter(e||t.isRemoteDataLoading?null:{action:"filter",filters:r,oldCount:s,added:o,removed:a,records:t.storage.values})}afterPerformFilter(e){this.resetRelationCache(),e&&this.triggerFilterEvent(e)}get filtered(){return this.storage.isFiltered}triggerFilterEvent(e){this.trigger("filter",e),this.remoteFilter||(this.trigger("refresh",e),this.trigger("change",e))}filterBy(e){return this.filter(e)}removeFilter(e,t=!1){const n=this,r=e instanceof Wi?e:n.filters.get(e);if(r){if(n.filters.remove(r),n._filtersFunction=null,!t){if(n.remoteFilter)return n.filter().then((()=>r));n.filter()}return r}}clearFilters(e=!0){if(this.filters.remove(this.filters.values.filter((e=>!e.internal))),e)return this.filter()}convertFilterToString(e){const t=this.filters.getBy("property",e);return t&&!t.filterBy?String(t):""}doDestroy(){var e;null===(e=this._filters)||void 0===e||e.destroy(),super.doDestroy()}};const us={add:1,replace:1};var hs=e=>class extends(e||Te){static get $name(){return"StoreGroup"}static get defaultConfig(){return{groupers:null,useGroupFooters:!1}}static get properties(){return{collapsedGroups:new Set}}construct(e){super.construct(e),this.on("change",this.onDataChanged,this)}get groupers(){return this._groupers}set groupers(e){this.setGroupers(e)}setGroupers(e){const t=this,{storage:n}=t;let r;return null!=e&&e.length?t._groupers=e:t.groupers&&(delete t._groupers,t.includeCollapsed(),n.replaceValues({values:t.removeHeadersAndFooters(n._values),filteredValues:n.isFiltered?t.removeHeadersAndFooters(n._filteredValues):null,silent:!0}),r=t.group(null,null,null,!1)),t._idMap=null,r}get groupRecords(){const e=[];if(this.isGrouped)for(const t of this)t.isSpecialRow&&e.push(t);return e}includeCollapsed(){for(const e of this.collapsedGroups)this.expand(this.getById(e),!1)}excludeCollapsed(){for(const e of this.collapsedGroups)this.collapse(this.getById(e))}onDataChange({source:e,action:t,removed:n}){var r;const i=this,{groupers:s}=i;s&&(s.length?"splice"===t&&null!=n&&n.length&&e.replaceValues({values:i.prepareGroupRecords(),silent:!0}):e.replaceValues({values:i.removeHeadersAndFooters(e.values),silent:!0})),null===(r=super.onDataChange)||void 0===r||r.call(this,...arguments)}move(e,t){const n=this;if(n.isGrouped){if(t.isSpecialRow&&(t=n.getPrev(t,!1,!0)),!t)return;const r=n.groupers[0].field,i=t[r];n.beginBatch(),e.forEach((e=>e[r]=i)),n.endBatch()}super.move(...arguments)}collapse(e){return!(!e||e.meta.collapsed||(this.excludeGroupRecords(e),e.meta.collapsed=!0,this.collapsedGroups.add(e.id),0))}expand(e,t=!0){return!(null==e||!e.meta.collapsed||(this.includeGroupRecords(e),e.meta.collapsed=!1,t&&this.collapsedGroups.delete(e.id),0))}removeHeadersAndFooters(e){return e.filter((e=>!e.isSpecialRow||(this.unregister(e),!1)))}prepareGroupRecords(e){const t=this,n=t.collapsedGroups,r=[];let i=t.storage.values;for(const e of i)e.isGroupHeader&&(e.meta.collapsed||n.has(e.id))&&(n.add(e.id),r.push(e));for(const e of r)t.includeGroupRecords(e);if(i=t.removeHeadersAndFooters(t.storage.values),e&&(i=i.sort(e)),!t.isGrouped)return i;const s=[],o=t.groupers[0].field;let a=null,l=null,c=0;function d(){const e=l.meta.groupRowFor,n=`group-footer-${"number"==typeof e?e:_.createId(e)}`,r=t.getById(n)||new t.modelClass({id:n},t,{specialRow:!0,groupFooterFor:e,groupRecord:l});return r.stores=[t],t.register(r),r.groupChildren=l.groupChildren,l.meta.collapsed||s.push(r),t.allRecords.push(r),l.groupChildren.push(r),c++,r}return i.forEach((e=>{var r;const i=null==e[o]?"__novalue__":e[o],u=`group-header-${"number"==typeof i?i:_.createId(i)}`;0!==(null===(r=e.groupChildren)||void 0===r?void 0:r.length)?(sn.isEqual(i,a)||(l&&(t.useGroupFooters&&d(),l.meta.childCount=c),l=t.getById(u)||new t.modelClass({id:u},t,{specialRow:!0,groupRowFor:i,groupField:o,collapsed:n.has(u)}),l.stores=[t],t.register(l),l.groupChildren=[],s.push(l),t.allRecords.push(l),a=i,c=0),e.instanceMeta(t.id).groupParent=l,n.has(u)||s.push(e),l.groupChildren.push(e),c++):t.unregister(e)})),l&&(t.useGroupFooters&&d(),l.meta.childCount=c),t._idMap=null,s}get isGrouped(){var e;return Boolean(null===(e=this.groupers)||void 0===e?void 0:e.length)}group(e,t,n=!1,r=!0,i=!1){const s=this;let o,a;if(e&&"object"==typeof e&&(t=e.ascending,a=e.fn,e=e.field),n)s.groupers.push(o={field:e,ascending:t,complexMapping:e.includes(".")});else if(e){var l,c;null==t&&(t=(null===(l=s.groupInfo)||void 0===l?void 0:l.field)!==e||(null===(c=s.groupInfo)||void 0===c?void 0:c.fn)!==a||!s.groupInfo.ascending),s.groupInfo=o={field:e,ascending:t,fn:a,complexMapping:e.includes(".")},s.groupers=[s.groupInfo]}if(o){const{prototype:t}=s.modelClass;o.complexMapping&&!Object.prototype.hasOwnProperty.call(t,e)&&Object.defineProperty(t,e,{get(){return sn.getPath(this,e)}})}if(!1!==r){if(s.remoteSort&&!s.isRemoteDataLoading)return s.sort(null,null,!1,!0).then((()=>s.onAfterGrouping(i)));s.sort(null,null,!1,!0)}s.onAfterGrouping(i)}onAfterGrouping(e){if(e)return;const t=this;t.trigger("group",{isGrouped:t.isGrouped,groupers:t.groupers,records:t.storage.values}),t.trigger("refresh",{action:"group",isGrouped:t.isGrouped,groupers:t.groupers,records:t.storage.values})}addGrouper(e,t=!0){return this.group(e,t,!0)}removeGrouper(e){const t=this,{groupers:n}=t,r=n.findIndex((t=>t.field===e));if(r>-1)return n.splice(r,1),n.length?t.group():t.clearGroupers()}clearGroupers(){return this.setGroupers(null)}isRecordInGroup(e,t){var n;return this.isGrouped?e[null===(n=this.groupers[0])||void 0===n?void 0:n.field]===t&&!e.isSpecialRow:null}isInCollapsedGroup(e){const t=e.instanceMeta(this).groupParent;return null==t?void 0:t.meta.collapsed}getGroupRecords(e){return this.isGrouped?this.storage.values.filter((t=>this.isRecordInGroup(t,e))):null}getGroupTitles(){return this.isGrouped?this.getDistinctValues(this.groupers[0].field):null}onDataChanged({changes:e,action:t}){this.isGrouped&&(!e&&us[t]||e&&this.groupers.some((t=>t.field in e)))&&this.sort()}internalIncludeExcludeGroupRecords(e,t){const n=this,r=n.indexOf(e),{id:i,storage:s}=n,{meta:o,groupChildren:a}=e;if(!(-1===r||o.collapsed&&!t||!o.collapsed&&t)){if(a.forEach((e=>e.instanceMeta(i).hiddenByCollapse=!t)),t){const e=a.filter((e=>!n.isAvailable(e)));s.values.splice(r+1,0,...e)}else s.values.splice(r+1,a.length);s._indicesInvalid=!0,n._idMap=null}}excludeGroupRecords(e){this.internalIncludeExcludeGroupRecords(e,!1)}includeGroupRecords(e){this.internalIncludeExcludeGroupRecords(e,!0)}collectGroupRecords(e,t=!0){return(e?this.storage.allValues:this.storage.values).reduce(((e,n)=>(n.isSpecialRow&&(t&&!n.isGroupFooter&&e.push(n),n.isGroupHeader&&e.push.apply(e,n.groupChildren)),e)),[])}},gs=e=>class extends(e||Te){static get configurable(){return{objectify:null}}initProxy(){if(!globalThis.Proxy)throw new Error("Proxy not supported");return new Proxy(this,{get(e,t){if(t in e)return e[t];if("$store"===t)return e;let n=e.getById(t);return n||isNaN(parseInt(t))||(n=e.getAt(parseInt(t))),n},set(e,t,n){return t in e||e.isDestroying?e[t]=n:e.add(f({[e.modelClass.idField]:t},n)),!0},deleteProperty(e,t){return e.isDestroying?(delete e[t],!0):Boolean(e.remove(t).length)},has(e,t){if(t in e)return!0;if(t.startsWith("{")&&t.endsWith("}")){const e=_.safeJsonParse(t);t=null==e?void 0:e.id}return e.includes(t)}})}},ms=e=>class extends(e||Te){static get $name(){return"StoreRelation"}initRelations(e){const t=this,n=t.modelClass.relations;e&&t.modelRelations&&t.modelRelations.forEach((e=>{e.storeDetacher&&e.storeDetacher()})),t.modelRelations&&0!==t.modelRelations.length&&!e||!n||(t.modelRelations=[],n&&n.forEach((n=>{const r=Object.assign({},n),i="string"==typeof r.store?t[r.store]:r.store;if(r.dependentStore=t,t.modelRelations.push(r),i){r.storeProperty=r.store,r.store=i;const n=i.dependentStoreConfigs;if(n.has(t)){const i=n.get(t);if(e){const e=i.find((e=>e.relationName===r.relationName));e&&ke.remove(i,e)}i.push(r)}else n.set(t,[r]);r.collectionName&&i.initRelationCollection(r,t),i.count>0&&i.updateDependentStores("dataset",i.records)}})))}initRelationCollection(e,t){const n=this,r=e.collectionName;n.collectionStores||(n.collectionStores={}),n.collectionStores[r]={store:t,config:e},n[r+"Store"]||(n[r+"Store"]=t),n.count>0&&n.initModelRelationCollection(r,n.records)}initModelRelationCollection(e,t){const n=this;t.forEach((t=>{t.traverse((t=>{const r=e in t?`$related${_.capitalize(e)}`:e;Object.defineProperty(t,r,{enumerable:!0,configurable:!0,get:function(){return n.getCollection(this,e)},set:function(t){return n.setCollection(this,e,t)}})}))}))}resetRelationCache(){this.relationCache={},this.forEach((e=>e.initRelations()))}updateRecordRelationCache(e,t){const n=this;t&&t.forEach((t=>{const r=t.related?t.related.id:e.get(t.config.fieldName);void 0!==r&&n.cacheRelatedRecord(e,r,t.config.relationName,r)}))}getRelationCollection(e,t){const n=Hi.asId(t);return this.relationCache[e]&&this.relationCache[e][n]||[]}getCollection(e,t){const{config:n,store:r}=this.collectionStores[t];return r.relationCache[n.relationName]&&r.relationCache[n.relationName][e.id]||[]}setCollection(e,t,n){const{config:r,store:i}=this.collectionStores[t];i.relationCache[r.relationName]||(i.relationCache[r.relationName]={});const s=(i.relationCache[r.relationName][e.id]||[]).slice(),o=[],a=[];i.suspendEvents(),s.forEach((e=>{n.includes(e)||(e[r.fieldName]=null,i.remove(e),a.push(e))})),n.forEach((t=>{t instanceof Hi?t.stores.includes(i)||(i.add(t),o.push(t)):([t]=i.add(t),o.push(t)),t[r.fieldName]=e.id})),i.resumeEvents(),a.length&&(i.trigger("remove",{records:a}),i.trigger("change",{action:"remove",records:a})),o.length&&(i.trigger("add",{records:o}),i.trigger("change",{action:"add",records:o}))}cacheRelatedRecord(e,t,n,r=null){const i=this,s=i.relationCache[n]||(i.relationCache[n]={});null!==r&&i.uncacheRelatedRecord(e,n,r),null!=t&&ke.include(s[t]||(s[t]=[]),e)}uncacheRelatedRecord(e,t=null,n=null){const r=this;function i(t,n){const i=r.relationCache[t],s=i&&i[n];if(s){const t=s.indexOf(e);t>=0&&s.splice(t,1),0===s.length&&delete i[n]}}null!=n?i(t,n):e.meta.relationCache&&Object.entries(e.meta.relationCache).forEach((([e,t])=>{i(e,t&&t.id)}))}updateDependentStores(e,t){this.dependentStoreConfigs.forEach((n=>{n.forEach((n=>{const r=n.dependentStore,i=r.relationCache[n.relationName];return"dataset"===e?(n.collectionName&&this.initModelRelationCollection(n.collectionName,t),void r.forEach((e=>{const t=e.initRelation(n);t&&r.cacheRelatedRecord(e,t.id,n.relationName,t.id)}))):"removeall"===e?(r.forEach((e=>{e.removeRelation(n)})),void delete r.relationCache[n.relationName]):("add"===e&&n.collectionName&&this.initModelRelationCollection(n.collectionName,t),void("add"!==e&&"remove"!==e||t.forEach((t=>{const s=i&&i[t.id];switch(e){case"remove":s&&s.forEach((e=>e.removeRelation(n)));break;case"add":r.forEach((e=>{e.get(n.fieldName)==t.id&&(e.initRelation(n),r.cacheRelatedRecord(e,t.id,n.relationName))}))}}))))}))}))}updateDependentRecordIds(e,t){this.dependentStoreConfigs&&this.dependentStoreConfigs.forEach((n=>{n.forEach((n=>{const r=n.dependentStore,i=r.relationCache[n.relationName],s=i&&i[e]&&i[e].slice();s&&s.forEach((i=>{r.cacheRelatedRecord(i,t,n.relationName,e),i.set(n.fieldName,t,!1,!0)}))}))}))}},ps=e=>class extends(e||Te){static get $name(){return"StoreSum"}sum(e,t=this.storage.values){return t?t.reduce(((t,n)=>{if(n.isSpecialRow)return t;const r=Number(n[e]);return isNaN(r)?t:t+r}),0):0}min(e,t=this.storage.values){return t&&t.length?t.reduce(((t,n)=>{var r;return"number"==typeof(null===(r=n[e])||void 0===r?void 0:r.valueOf())&&n[e]<t&&(t=n[e]),t}),t[0][e]):0}max(e,t=this.storage.values){return t&&t.length?t.reduce(((t,n)=>{var r;return"number"==typeof(null===(r=n[e])||void 0===r?void 0:r.valueOf())&&n[e]>t&&(t=n[e]),t}),t[0][e]):0}average(e,t=this.storage.values){if(!t||!t.length)return 0;let n=0;const r=t.reduce(((t,r)=>{if(r.isSpecialRow)return t;const i=parseFloat(r[e]);return isNaN(i)?t:(n++,t+i)}),0);return n>0?r/n:0}groupSum(e,t){return this.sum(t,this.getGroupRecords(e))}};const fs=(e,t)=>String(e).toLowerCase().includes(t),vs={string:fs,number:fs,boolean:fs,date:(e,t)=>e instanceof Date&&t instanceof Date?e-t==0:String(e.getMonth()+1).includes(t)||String(e.getDate()).includes(t)||String(e.getFullYear()).includes(t),object:(e,t)=>e===t,undefined:(e,t)=>e===t};var ys=e=>class extends(e||Te){static get $name(){return"StoreSearch"}search(e,t=null,n,r){const i=this.getAllDataRecords(r),s=i.length,o=[];if(null==e)return null;let a,l,c,d,u,h;for("string"==typeof e&&(e=e.toLowerCase()),a=0;a<s;a++){c=i[a],l=0;for(const r of t||c.fieldNames){var g;d=c[r],u=d instanceof Date?"date":typeof d;const t=null==n?void 0:n[l];t&&(d=t(d),u="string"),h=vs[u],d&&null!==(g=h)&&void 0!==g&&g(d,e)&&o.push({index:a,data:c,field:r,id:c.id}),l++}}return o}findByField(e,t,n=!1,r=!1){const i=this.getAllDataRecords(r),s=i.length,o=new Set,a=[];let l,c,d;for(null!=t&&(t=String(t).toLowerCase()),l=0;l<s;l++)if(c=i[l],d=c[e],!n||!o.has(d)){const e=d instanceof Date?"date":typeof d,r=vs[e];(null==t&&d===t||t&&r(d,t))&&(a.push({id:c.id,index:l,data:c}),n&&o.add(d))}return a}find(e,t=!1){return this.getAllDataRecords(t).find(e)}findRecord(e,t,n=!1){const r=n=>sn.isEqual(n[e],t);return this.isTree?this.query(r,n)[0]:this.getAllDataRecords(n).find(r)}query(e,t=!1){if(this.isTree){const n=[];return this.traverse((t=>{e(t)&&n.push(t)}),void 0,void 0,t),n}return this.getAllDataRecords(t).filter(e)}some(e,t=!1){return this.getAllDataRecords(t).some(e)}};const bs=/\./;var Cs=e=>class extends(e||Te){static get $name(){return"StoreSort"}static get defaultConfig(){return{useLocaleSort:null}}static get configurable(){return{sorters:[],reapplySortersOnAdd:!1}}get isSorted(){return Boolean(this.sorters.length)||this.isGrouped}changeSorters(e){return e.map((e=>this.normalizeSorterConfig(e,!0)))}updateReapplySortersOnAdd(e){this.storage.autoSort=e}sort(e,t,n=!1,r=!1){const i=this,s=i.allRecords,o=i.sorters?i.sorters.slice():[];let a,l=null;if(e)if(Array.isArray(e))i.sorters=e.map((e=>i.normalizeSorterConfig(e,"string"==typeof e||t)));else{const r=i.normalizeSorterConfig(e,t);n?(a=i.getCurrentSorterByField(r.field),a?(l=a.ascending,a.ascending=r.ascending):i.sorters.push(r)):i.sorters=[r]}return r||!1!==i.trigger("beforeSort",{sorters:i.sorters,records:s,currentSorters:o})?i.performSort(r):(i.sorters=o,null!==l&&(a.ascending=l),null)}normalizeSorterConfig(e,t){const n=this,r={ascending:t};var i;if("object"==typeof e?(sn.assign(r,e),e.fn&&(delete r.fn,r.sortFn=e.fn),r.ascending=null!==(i=e.ascending)&&void 0!==i?i:t):"function"==typeof e?r.sortFn=e:r.field=e,null==r.ascending){const e=n.getCurrentSorterByField(r.field);r.ascending=!e||!e.ascending}if(null==r.sortFn){var s,o;const e=null===(s=n.modelClass)||void 0===s||null===(o=s.$meta.fields.map[r.field])||void 0===o?void 0:o.compareItems;e&&(r.sortFn=e)}return r}getCurrentSorterByField(e){return"string"==typeof e&&this.sorters.find((t=>t.field===e))||null}addSorter(e,t=!0){return this.sort(e,t,!0)}removeSorter(e){const t=this.sorters.findIndex((t=>t.field===e||t.sortFn===e));if(t>-1)return this.sorters.splice(t,1),this.sort()}clearSorters(){if(this.sorters.length)return this.sorters.length=0,this.sort()}createSorterFn(e){const t=this.useLocaleSort;return(n,r)=>{for(let i=0;i<e.length;i++){const s=e[i],{field:o,ascending:a=!0,useLocaleSort:l=t}=s,c=s.fn||s.sortFn,d=a?1:-1;if(c){const e=c.call(s,n,r);if(null!==e)return e*d}const u=bs.test(o),h=u?n.get(o):n[o],g=u?r.get(o):r[o];if(h!==g){if(null==h)return-d;if(null==g)return d;if(l&&"string"==typeof h){if(!0===l)return String(h).localeCompare(g)*d;if("string"==typeof l)return String(h).localeCompare(g,l)*d;if("object"==typeof l)return String(h).localeCompare(g,l.locale,l)*d}if(h>g)return d;if(h<g)return-d}}return 0}}performSort(e){const t=this,{rootNode:n,storage:r,sorters:i}=t,s=t.createSorterFn(t.remoteSort?[{field:"_remoteSortIndex"}]:t.isGrouped?t.groupers.concat(i):i);t.tree?(n.traverse((e=>{e.isLoaded&&e.isParent&&(e.children.sort(s),e.updateChildrenIndices(e.children,!1,!0))})),r.replaceValues({values:t.collectDescendants(n).visible,silent:!0})):t.isGrouped?r.replaceValues({values:t.prepareGroupRecords(s),silent:!0}):r.replaceValues({values:r.values.sort(s),silent:!0}),t.afterPerformSort(e||t.isRemoteDataLoading)}afterPerformSort(e){if(e)return;const t=this;t._idMap=null;const n={action:"sort",sorters:t.sorters,records:t.allRecords};t.trigger("sort",n),t.trigger("refresh",n)}};const ws=e=>!0;var Ss=e=>class extends(e||Te){static get $name(){return"StoreChained"}static get defaultConfig(){return{chainedFilterFn:null,chainedFields:null,masterStore:null,doRelayToMaster:["add","remove","insert"],dontRelayToMaster:[],keepUncommittedChanges:!1,excludeCollapsedRecords:!0}}static get properties(){return{chainedStores:null}}construct(e){super.construct(e);const t=this,{masterStore:n}=t,r=t.syncOrder?"sort":"";n&&(t.methodNamesToRelay.forEach((e=>t[e]=(...n)=>t.relayToMaster(e,n))),t.removeAll=(...e)=>{n.remove(t.getRange(),...e)},n.on({changePreCommit:t.onMasterDataChangedPreCommit,change:t.onMasterDataChanged,[r]:t.onMasterDataChanged,prio:1,thisObj:t}),n.chainedStores||(n.chainedStores=[]),n.chainedStores.push(t),t.fillFromMaster())}get isChained(){return Boolean(this.masterStore)}set chainedFilterFn(e){this._chainedFilterFn=this.thisObj?e.bind(this.thisObj):e}get chainedFilterFn(){return this._chainedFilterFn||ws}get methodNamesToRelay(){const e=Array.isArray(this.doRelayToMaster),t=Array.isArray(this.dontRelayToMaster);return e&&this.doRelayToMaster.filter((e=>!t||!this.dontRelayToMaster.includes(e)))||[]}updateChainedStores(){this.chainedStores&&this.chainedStores.forEach((e=>e.fillFromMaster()))}fillFromMaster(){const e=this,{masterStore:t,isTree:n}=e,r=e.chainedFilterFn.length>0||e.chainedFilterFn.toString().length<=10;let i;if(!e.isChained)throw new Error("fillFromMaster only allowed on chained store");if(e.keepUncommittedChanges){if(n)throw new Error("Cannot use keepUncommittedChanges on a chained tree store");i=r?t.allRecords.filter((t=>!e.removed.includes(t)&&!e.added.includes(t)&&e.chainedFilterFn(t))):e.chainedFilterFn().filter((t=>!e.removed.includes(t)&&!e.added.includes(t))),i=e.added.values.filter((t=>!e.removed.includes(t))).concat(i)}else if(i=r?t.allRecords.filter(e.chainedFilterFn):e.chainedFilterFn(),n&&(e.idRegister={},e.internalIdRegister={},i.forEach((t=>{t.stores.includes(e)?e.register(t):t.joinStore(e)})),e.excludeCollapsedRecords)){const t=e.getChildren(e.rootNode);i=e.doIncludeExclude(t,!0)}e.data=i}commitToMaster(){const e=this,t=e.masterStore;if(!e.isChained)throw new Error("commitToMaster only allowed on chained store");return t.beginBatch(),t.remove(e.removed.values),t.add(e.added.values),t.endBatch(),e.commit()}relayToMaster(e,t){return this.masterStore[e](...t)}onMasterDataChangedPreCommit(e){this.onMasterDataChanged(e),this.$masterEventhandled=!0}onMasterDataChanged({action:e,changes:t,$handled:n,isMove:r}){var i;this.$masterEventhandled?this.$masterEventhandled=!1:r&&"remove"===e||("update"!==e||null!==(i=this.chainedFields)&&void 0!==i&&i.some((e=>e in t)))&&this.fillFromMaster()}makeChained(e=ws,t,n){return new((null==n?void 0:n.storeClass)||this.constructor)(f(f({},n||{}),{},{tree:!1,autoTree:!1,masterStore:this,modelClass:this.modelClass,chainedFilterFn:e,chainedFields:t}))}chain(){return this.makeChained(...arguments)}doDestroy(){var e;null===(e=this.chainedStores)||void 0===e||e.forEach((e=>e.destroy())),super.doDestroy()}},Ds=e=>class extends(e||Te){static get $name(){return"StoreState"}getState(){const{sorters:e,groupers:t,filters:n}=this,r={};return null!=e&&e.length&&(r.sorters=e.map((e=>{const t=sn.cleanupProperties(sn.clone(e));return delete t.fn,delete t.sortFn,t}))),null!=t&&t.length&&(r.groupers=t.map((e=>{const t=sn.cleanupProperties(sn.clone(e));return delete t.fn,t}))),null!=n&&n.values.length&&(r.filters=n.values.map((e=>{const t=sn.cleanupProperties(sn.clone(e.config));return t.value=e.value,t.caseSensitive&&delete t.caseSensitive,t}))),r}applyState(e){const t=this,{sorters:n=[],groupers:r=[],filters:i=[]}=e;t.sorters=n.slice(),t.groupers=r.slice(),t.sort(),t.filters=i.filter((e=>e.property||e.filterBy)),t.filter()}};const Es=Object.freeze([]);var xs=e=>class extends(e||Te){static get $name(){return"StoreTree"}static get configurable(){return{transformFlatData:null}}get isTree(){return this.tree||this.masterStore&&this.masterStore.tree}get leaves(){const e=this,t=[];return e.isTree?(e.traverse((e=>{e.isLeaf&&t.push(e)})),t):(e.allRecords.forEach((e=>{e.isLeaf&&t.push(e),e.traverse((e=>{e.isLeaf&&t.push(e)}),!0)})),t)}async loadChildren(e){}onNodeAddChild(e,t,n,r,i=!1){const s=this,o=e===s.rootNode&&e.isLoading,{storage:a}=s,l=[],c=[],d=t[0].previousSibling;let u;if(s.collectDescendants(t,l,c,{inCollapsedBranch:!(e.isExpanded(s)&&e.ancestorsExpanded(s))}),!o&&c.length)for(const e of c)s.modified.includes(e)||r[e.id]||(s.removed.includes(e)?s.removed.remove(e):e.isLinked||s.added.add(e));var h;if(o&&s.rootVisible&&(l.unshift(e),c.unshift(e)),l.length&&(u=0!==n&&d?a.indexOf(d)+d.getDescendantCount(!0,s):a.indexOf(e),a.suspendEvents(),s.storage.splice(++u,0,l),a.resumeEvents(),s._idMap=null),s.updateDependentStores("add",t),o&&l.length){if(s.sorters.length&&s.sort(null,null,!1,!0),null===(h=s.afterLoadData)||void 0===h||h.call(s),!i){const e={action:"dataset",data:s._data,records:l};s.trigger("refresh",e),s.trigger("change",e)}}else if(!i){const n={action:"add",parent:e,isChild:!0,isMove:r,records:t,allRecords:c,index:u};if(s.trigger("add",n),s.trigger("change",n),Object.values(r).some((e=>e))){const n={newParent:e,records:t.filter((e=>r[e.id]))};s.trigger("move",n)}}}onNodeRemoveChild(e,t,n,r={isMove:!1,silent:!1,unfiltered:!1}){const i=this,{storage:s}=i,o=[],a=[],{isMove:l,silent:c,unfiltered:d}=r,u=d&&i.isFiltered,h=u&&e.unfilteredChildren?e.unfilteredChildren:t;if(i.collectDescendants(h,o,a,{inCollapsedBranch:!(e.isExpanded(i)&&e.ancestorsExpanded(i)),unfiltered:u}),!l){for(const e of t)e.unjoinStore(i);for(const e of a)e.stores.includes(i)&&e.unjoinStore(i),i.added.includes(e)?i.added.remove(e):e.isLinked||i.removed.add(e);i.modified.remove(a)}if(o.length?(n=s.indexOf(o[0]))>-1&&(s.suspendEvents(),s.splice(n,o.length),s.resumeEvents(),i._idMap=null):n=-1,!c){const r={action:"remove",parent:e,isChild:!0,isMove:l,records:t,allRecords:a,index:n};i.trigger("remove",r),i.trigger("change",r)}return a}collectDescendants(e,t=[],n=[],r={inCollapsedBranch:!1,unfiltered:!1}){const i=this,{inCollapsedBranch:s,unfiltered:o}=r,a=Array.isArray(e)?e:i.getChildren(e,o);if(a)for(let e,r=0,l=a.length;r<l;r++)e=a[r],s||t.push(e),n.push(e),i.collectDescendants(e,t,n,{inCollapsedBranch:s||!e.isExpanded(i),unfiltered:o});return{visible:t,all:n}}getChildren(e,t=!1){const n=(t||this.isChained)&&e.unfilteredChildren||e.children;return n&&n.length?this.isChained?n.filter(this.chainedFilterFn):n:Es}internalToggleTreeSubRecords(e,t){const n=this,{storage:r}=n,i=r.indexOf(e),s=n.doIncludeExclude(n.getChildren(e),t);if(n.isFiltered&&t&&e.unfilteredChildren&&n.updateChildrenHiddenState(e),s.length&&!1!==i){if(r.suspendEvents(),t){r.splice(i+1,0,...s);const e={action:"add",isExpand:!0,records:s,index:i+1};n.trigger("add",e),n.trigger("change",e)}else{r.splice(i+1,s.length);const e={action:"remove",isCollapse:!0,records:s,index:i+1};n.trigger("remove",e),n.trigger("change",e)}r.resumeEvents(),n._idMap=null}}updateChildrenHiddenState(e){var t;null===(t=e.unfilteredChildren)||void 0===t||t.forEach((e=>{e.instanceMeta(this.id).hidden=!1,e.isLeaf||this.updateChildrenHiddenState(e)}))}doIncludeExclude(e,t,n=[]){const r=this,i=(null==e?void 0:e.length)||0;for(let s=0;s<i;s++){const i=e[s];if(!r.isChained||r.chainedFilterFn(i)){const e=i.instanceMeta(r.id);!t&&e.hidden||n.push(i),e.hidden=!t,i.isExpanded(r)&&r.doIncludeExclude(r.getChildren(i),t,n)}}return n}async toggleCollapse(e,t){const n=this,r=n.getById(e),i=r.instanceMeta(n);if(void 0===t&&(t=!i.collapsed),!i.isLoadingChildren&&!r.isLeaf&&r.isExpanded(n)===t){if(n.trigger("beforeToggleNode",{record:r,collapse:t}),i.collapsed=t,i.collapsed)return n.onNodeCollapse(r),!0;{n.onNodeExpand(r);let e=!0;if(!r.isLoaded){i.isLoadingChildren=!0;try{await n.loadChildren(r)}catch(t){i.collapsed=!0,e=!1,n.trigger("loadChildrenException",{record:r,exception:t})}finally{i.isLoadingChildren=!1}}return e}}}onNodeCollapse(e){if(e.ancestorsExpanded(this))return this.internalToggleTreeSubRecords(e,!1)}onNodeExpand(e){if(e.ancestorsExpanded(this))return this.internalToggleTreeSubRecords(e,!0)}transformToTree(e){const{parentIdField:t,idField:n,childrenField:r}=this.modelClass,i=new Map,s=[];for(const a of e){const l=a[t];if(null!=l){let t=i.get(l);var o;void 0===t&&(t=null!==(o=e.find((e=>e[n]===l)))&&void 0!==o?o:null,i.set(l,t)),t&&(t[r]||(t[r]=[]),t[r].push(a))}else s.push(a)}return s}treeify(e,t,n=!1){const{length:r}=e,i=[],s={};let o,a;for(o=0;o<r;o++){if(!e[o].call){const t=e[o];e[o]=e=>e[t]}i[o]=new Map}this.rootNode.traverse((t=>{if(a=null,t.isLeaf){for(o=0;o<r;o++){var n;const r=(null===(n=a)||void 0===n?void 0:n.path)||"",s=i[o],l=e[o](t),c=`${r+l}/`,d=_.makeValidDomId(`generated_${c}`,"_"),u=s.get(d)||s.set(d,{id:d,key:l,path:c,expanded:!0,readOnly:!0,children:[],generatedParent:!0}).get(d);a&&!a.children.includes(u)&&a.children.push(u),a=u}a.children.push(t)}}),!0),i.forEach((e=>e.forEach(((e,r,i)=>{null==t||t(e),n&&(e=this.createRecord(e),i.set(r,e))})))),s.children=[...i[0].values()];const l=t=>{t.children&&(t.children.sort(((t,n)=>{if(t.isLeaf){let i;for(let s=0;!i&&s<r;s++){const r=e[s](t),o=e[s](n);i=r<o?-1:o>r?1:0}return i}return"string"==typeof t.key||"string"==typeof n.key?t.key.localeCompare(n.key,void 0,{numeric:!0}):t.key<n.key?-1:t.key>n.key?1:0})),t.children.forEach(l))};return l(s),s}treeifyFlatData(e){const{childrenField:t,parentIdField:n}=this.modelClass;let r=!1,i=!0;for(const s of e){if(s.isModel||Array.isArray(s[t])){i=!1;break}null!=s[n]&&(r=!0)}return i&&r&&(e=this.transformToTree(e)),e}};class Rs{static preWalk(e,t,n){const r=[e];let i,s;for(;r.length;)i=r.pop(),n(i),s=t(i),s&&r.push.apply(r,s.slice().reverse())}static preWalkWithParent(e,t,n){const r=[{node:e,parent:null}];for(;r.length;){const{parent:e,node:i}=r.pop();n(e,i);const s=t(i);Array.isArray(s)&&r.push(...s.slice().reverse().map((e=>({node:e,parent:i}))))}}static preWalkUnordered(e,t,n){const r=[e];let i,s;for(;r.length;)i=r[r.length-1],n(i),s=t(i),s?r.splice(r.length-1,1,...s):r.length=r.length-1}static postWalk(e,t,n){const r=new Map,i=[e];let s,o;for(;i.length;)s=i[i.length-1],r.has(s)?(n(s),i.pop()):(o=t(s),o&&i.push(...o.slice().reverse()),r.set(s,s))}static prePostWalk(e,t,n,r){const i=new Map,s=[e];let o,a;for(;s.length;)o=s[s.length-1],i.has(o)?(r(o),s.pop()):(n(o),a=t(o),a&&s.push(...a.slice().reverse()),i.set(o,o))}}Rs._$name="WalkHelper";var Ts=e=>class extends(e||Te){static get $name(){return"StoreSync"}static get configurable(){return{syncDataOnLoad:null}}syncDataset(e){const t=this,{storage:n}=t,{toAdd:r,toRemove:i,toMove:s,updated:o}=t.tree?t.syncTreeDataset(e):t.syncFlatDataset(e);let{threshold:a}=t.syncDataOnLoad,l=!1;if(a&&("string"==typeof a&&(a=parseInt(a,10)/100*t.count),l=r.length+i.length+s.length+o.length>a),t.isSyncingDataOnLoad=!0,t.tree){if(r.length&&t.add(r,l).forEach((e=>e.clearParentId())),s.length)for(const{parent:e,node:n,index:r}of s)t.getById(e.id).insertChild(n,r);t.remove(i,l)}else l&&t.suspendEvents(),t.remove(i),t.add(r),l&&t.resumeEvents();a&&!l&&o.forEach((({record:e,toSet:n,wasSet:r})=>t.onModelChange(e,n,r))),t.acceptChanges();const c={added:r,removed:i,updated:o,thresholdSurpassed:l};l&&t.trigger("refresh",{action:"batch",data:e,records:n.values,syncInfo:c}),t.isFiltered&&!t.remoteFilter&&t.filter({silent:t.isRemoteDataLoading}),t.isGrouped?t.group(null,null,!1,!0,t.isRemoteDataLoading):t.isSorted&&(t.remoteSort?n.replaceValues({values:n.values.sort(t.createSorterFn(t.sorters)),silent:!0}):t.sort()),t.isSyncingDataOnLoad=!1,t.trigger("loadSync",c)}syncFlatDataset(e){if(!e)return{toRemove:this.records};const t=this,{idField:n,allFields:r}=t.modelClass,i=[],s=[],o=[],a={},{threshold:l,keepMissingValues:c}=t.syncDataOnLoad;let d=0;return e.forEach((e=>{const i=(e=e.isModel?e.data:e)[n],u=t.getById(i);if(u){if(!1===c)for(const t of r)!(t.dataSource in e)&&t.dataSource in u.data&&(e[t.dataSource]=t.defaultValue);const t=u.set(e,null,Boolean(l));t&&o.push({record:u,wasSet:t,toSet:e}),d++}else s.push(t.processRecord(t.createRecord(e)));a[i]=1})),d<t.allCount&&t.forEach((e=>{a[e.id]||i.push(e)})),{toAdd:s,toRemove:i,toMove:[],updated:o}}syncTreeDataset(e){if(!e)return{toRemove:this.records};const t=this,{idField:n,parentIdField:r,childrenField:i,allFields:s}=t.modelClass,{keepMissingValues:o}=t.syncDataOnLoad,a=[],l=[],c=[],d=[],u={};t.transformFlatData&&(e=t.treeifyFlatData(e));const{threshold:h}=t.syncDataOnLoad;return Rs.preWalkWithParent({isRoot:!0,id:t.rootNode.id,children:e},(e=>e.children),((e,a)=>{if(e){const g=a[n],m=t.getById(g);if(m){let r;const l=m.children;if(!0!==l&&!0===a[i]&&(m.clearChildren(),m.data[i]=m.children=!0,delete a[i],t.toggleCollapse(m,!0),r=!0),m.parent.id!==e[n]&&c.push({node:m,parent:e,index:e[i].indexOf(a)}),!1===o)for(const e of s)"parentId"!==e.name&&!(e.dataSource in a)&&e.dataSource in m.data&&(a[e.dataSource]=e.defaultValue);const u=m.set(a,null,Boolean(h));u?d.push({record:m,wasSet:u,toSet:a}):r&&m.signalNodeChanged({[i]:{value:!0,oldValue:l}})}else a[r]=e[n],l.push(f(f({},a),Array.isArray(a[i])?{children:[]}:void 0));u[g]=1}})),t.traverse((e=>{u[e.id]||a.push(e)})),{toAdd:l,toRemove:a,toMove:c,updated:d}}};const Ms=Symbol("STM_PROP");var ks=e=>class extends(e||Te){static get $name(){return"StoreStm"}static get defaultConfig(){return{stm:null,ignoreRemoteChangesInSTM:!1}}get stm(){return this[Ms]}set stm(e){const t=this;var n;t.stm!==e&&(null!==(n=t.stm)&&void 0!==n&&n.hasStore(t)&&t.stm.removeStore(t),t[Ms]=e,t.stm&&!t.stm.hasStore(t)&&t.stm.addStore(t))}add(e,t=!1){let n;const{stm:r}=this;var i;return!this.tree&&null!=r&&r.enabled?(n=super.add(e,t),null!==(i=n)&&void 0!==i&&i.length&&r.onStoreModelAdd(this,n,t)):n=super.add(e,t),n}insert(e,t,n=!1){let r;const{stm:i}=this;if(!this.tree&&null!=i&&i.enabled){var s;const o=(Array.isArray(t)?t:[t]).reduce(((e,t)=>{const n=t instanceof Hi?this.indexOf(t):void 0;return void 0!==n&&-1!==n&&e.set(t,n),e}),new Map);r=super.insert(e,t),null!==(s=r)&&void 0!==s&&s.length&&(e=this.indexOf(r[0]),i.onStoreModelInsert(this,e,r,o,n))}else r=super.insert(e,t,n);return r}remove(e,t=!1,n){let r;const{stm:i}=this;if(!this.tree&&null!=i&&i.enabled){var s;const o=(Array.isArray(e)?e:[e]).map((e=>this.getById(e))).filter((e=>!!e)).reduce(((e,t)=>{const n=this.indexOf(t);return void 0!==n&&-1!==n&&e.set(t,n),e}),new Map);r=super.remove(e,t,n),null!==(s=r)&&void 0!==s&&s.length&&i.onStoreModelRemove(this,r,o,t)}else r=super.remove(e,t,n);return r}removeAll(e){const{stm:t}=this;let n;if(null!=t&&t.enabled){const{tree:r,rootNode:i,allRecords:s}=this,o=s.length,a=r?i.children.slice():s.slice();n=super.removeAll(e),o&&0===this.count&&t.onStoreRemoveAll(this,a,e)}else n=super.removeAll(e);return n}beforeApplyChangeset(){const{stm:e,crudManager:t}=this;let n=!1;return null!=t&&t.applyingChangeset||null==e||!e.enabled||(n=!0,e.isRecording&&e.stash(),this.ignoreRemoteChangesInSTM?e.disable():e.startTransaction()),n}applyChangeset(e,t,n,r,i){const s=this.beforeApplyChangeset(),o=super.applyChangeset(e,t,n,r,i);return this.afterApplyChangeset(s),o}afterApplyChangeset(e){if(e){const{stm:e}=this;this.ignoreRemoteChangesInSTM?e.enable():e.stopTransaction(),e.applyStash()}}};const Is={splice:1,clear:1};class As extends(Te.mixin(ci,tt,Ur,oi,ds,cs,ls,ms,ps,ys,Cs,hs,Ss,Ds,xs,ks,Ts,gs)){static get $name(){return"Store"}static get properties(){return{relationCache:{},dependentStoreConfigs:new Map}}static get configurable(){return{id:!0,modelClass:Hi,verifyNoGeneratedIds:!0}}static get defaultConfig(){return{fields:null,autoTree:!0,data:null,tree:!1,callOnFunctions:!0,storage:null,useRawData:!1,allowNoId:!0,preventSubClassingModel:null}}static get identifiable(){return{registerGeneratedId:!1}}constructor(...e){if(super(...e),this.objectify)return this.initProxy()}construct(e={}){Object.assign(this,{added:new as,removed:new as,modified:new as,idRegister:{},internalIdRegister:{},oldIdMap:{}}),e.storeId&&(e=sn.assign({id:e.storeId},e)),super.construct(e),this.initRelations()}static from(e,t={},n=null){return e&&!e.isStore&&("string"==typeof e?e=As.getStore(e):(Array.isArray(e)&&(n&&(e=e.map((e=>e.isModel?e:n(e)))),e=sn.assign({},t,{data:e})),e=new As(e))),e}doDestroy(){var e,t,n;const r=this,i=r.registeredRecords;for(let e,t=i.length-1;t>=0;t--){var s;e=i[t],null!==(s=e)&&void 0!==s&&s.isDestroyed||e.unjoinStore(r)}var o;null===(e=r._storage)||void 0===e||e.destroy(),null===(t=r.stm)||void 0===t||null===(n=t.removeStore)||void 0===n||n.call(t,r),r.isChained||null===(o=r.rootNode)||void 0===o||o.destroy(),super.doDestroy()}beginBatch(){this.suspendEvents()}endBatch(){this.resumeEvents()&&this.trigger("refresh",{action:"batch",data:this.storage.values,records:this.storage.values})}set storage(e){const t=this;null!=e&&e.isCollection?t._storage=e:t._storage=new rs(e),t._storage.autoFilter=t.reapplyFilterOnAdd,t._storage.autoSort=t.reapplySortersOnAdd;for(const e of t._storage)e.joinStore(t);t._storage.on({change:"onDataChange",thisObj:t})}get storage(){return this._storage||(this.storage={}),this._storage}get allRecords(){const e=this;if(e.isTree){const t=e.collectDescendants(e.rootNode,void 0,void 0,{unfiltered:!0}).all;return e.rootVisible&&t.unshift(e.rootNode),t}return e.isGrouped?e.collectGroupRecords():e.storage.allValues}getAllDataRecords(e){return this.isGrouped?this.collectGroupRecords(e,!1):e?this.storage.allValues:this.storage.values}onIsCreatingToggle(e,t){const n=this,r=e.isPersistable&&!t;n.added[r?"add":"remove"](e),r&&(n.trigger("addConfirmed",{record:e}),n.autoCommit&&n.doAutoCommit())}joinRecordsToStore(e){const{allCount:t}=this;for(let n=0;n<e.length;n++){const r=e[n];r.setData("parentIndex",t+n-e.length),r.joinStore(this)}}onDataChange({source:e,action:t,added:n,removed:r,replaced:i,oldCount:s,items:o,from:a,to:l}){const c=this,d=Is[t],u=d&&(null==n?void 0:n.length),h=d&&(null==r?void 0:r.length);let g,m;if(c._idMap=null,u&&c.joinRecordsToStore(n),null==i||i.forEach((([e,t])=>{e.unjoinStore(c,!0),t.joinStore(c)})),super.onDataChange(...arguments),!c.isTree){if(u){for(const e of n)c.removed.includes(e)?c.removed.remove(e):e.isLinked||c.added.add(e);g=!c.remoteFilter&&c.filtered&&c.reapplyFilterOnAdd,g&&c.filter({silent:!0}),m=!c.remoteSort&&c.isSorted&&c.reapplySortersOnAdd,m&&c.sort(null,null,!1,!0)}if(h){for(const e of r)e.cancelBatch(),e.unjoinStore(c),c.added.includes(e)?c.added.remove(e):e._undoingInsertion||e.isCreating||e.isLinked||c.removed.add(e);c.modified.remove(r),g=!c.remoteFilter&&c.filtered,g&&c.filter({silent:!0})}}switch(t){case"clear":c.relationCache={},c.updateDependentStores("removeall"),c.trigger("removeAll"),c.trigger("change",{action:"removeall"});break;case"splice":if(u){c.updateDependentStores("add",n);const t=n.reduce(((e,t)=>{const{previousIndex:n}=t.meta;return n>-1&&n<e&&(e=n),e}),n[0].meta.previousIndex),r={records:n,index:e.indexOf(n[0],!e.autoFilter)};t>-1&&(r.oldIndex=t),c.trigger("add",r),c.trigger("change",Object.assign({action:"add"},r)),g&&c.triggerFilterEvent({action:"filter",filters:c.filters,oldCount:s,records:c.storage.allValues}),m&&c.trigger("sort",{action:"sort",sorters:c.sorters,records:c.storage.allValues})}r.length&&(c.updateDependentStores("remove",r),c.trigger("remove",{records:r}),c.trigger("change",{action:"remove",records:r})),i.length&&(c.trigger("replace",{records:i,all:c.records.length===i.length}),c.trigger("change",{action:"replace",replaced:i,all:c.records.length===i.length}));break;case"filter":(c.isGrouped||c.isSorted)&&c.performSort(!0);break;case"move":for(let e=c.storage.allValues,t=Math.min(a,l);t<=Math.max(a,l);t++)e[t].setData("parentIndex",t);c.trigger("move",{record:o[0],records:o,from:a,to:l}),c.isFiltered&&c.performFilter(),c.trigger("change",{action:t,record:o[0],records:o,from:a,to:l})}}onDataReplaced(e,t){var n;const r=this,{storage:i}=r,s=i.allValues,o=Boolean(r.sorters.length>0);for(let e=0;e<s.length;e++)s[e].joinStore(r);const a=r.prepareGroupRecords();if(!r.remoteFilter&&r.isFiltered&&r.filter({silent:!0}),r.remoteSort?r.isGrouped&&i.replaceValues({values:a,silent:!0}):(r.isGrouped&&r.group(null,null,!1,!o,!0),o&&r.sort(null,null,!1,!0)),!r.useRawData.disableDuplicateIdCheck){const{idMap:e}=r;if(Object.keys(e).length<i.values.length){const t=[];throw i.values.forEach((n=>e[n.id]?delete e[n.id]:t.push(n))),new Error(`Id collision on ${t.map((e=>e.id))}`)}}const l={action:e,data:t,records:i.values};r.updateDependentStores(e,l.records),null===(n=r.afterLoadData)||void 0===n||n.call(r),r.isRemoteDataLoading||r.trigger("refresh",l),r.trigger("change",l)}onModelChange(e,t,n,r,i){const s=this,o={record:e,records:[e],changes:n,batch:null!=e.batching,fromRelationUpdate:i},a=!e.ignoreBag&&!e.isLinked&&s.updateModifiedBagForRecord(e);if(s.storage.onItemMutation(e,n),"id"in n){const{oldValue:n,value:r}=t.id;s.updateDependentRecordIds(n,r),s.onRecordIdChange({record:e,oldValue:n,value:r})}if(!r){if("id"in n){const{oldValue:n,value:r}=t.id;s.trigger("idChange",{store:s,record:e,oldValue:n,value:r})}s.onUpdateRecord(e,n),s.trigger("update",o),s.trigger("change",Object.assign({action:"update"},o))}s.autoCommit&&a&&s.doAutoCommit()}updateModifiedBagForRecord(e){const t=this;let n=!1;return e.isModified?t.modified.includes(e)||t.added.includes(e)||!e.isPartOfStore(t)||e.isAutoRoot||(e.isPhantom?t.added.add(e):t.modified.add(e),n=!0):t.modified.remove(e),n}get idMap(){const e=this,t=!e._idMap,n=e._idMap||(e._idMap={});if(t){const t=e.storage.values;for(let e,r=0,i=0;r<t.length;r++)e=t[r],n[e.id]={index:r,visibleIndex:i,record:e},e.isSpecialRow||i++}return n}changeModelClass(e){const{fields:t}=this;this.originalModelClass=e;let n=e;return null!=t&&t.length?n=class extends e{static get fields(){return t}}:this.preventSubClassingModel||(n=class extends e{}),n.initClass(),n}set storeId(e){this.id=e}get storeId(){return this.id}changeId(e,t){return super.changeId(!0!==e&&e,t)}updateId(e,t){const n=As.getById(e);n&&As.unregisterInstance(n),super.updateId(e,t)}generateAutoId(){return As.generateId("store-")}get tree(){return this._tree}set tree(e){this._tree=e,e&&!this.rootNode&&(this.rootNode=this.buildRootNode(),this.rootNode.isAutoRoot=!0)}buildRootNode(){return{}}static getStore(e,t){if(e instanceof As)return e;if(this.getById(e))return this.getById(e);if(Array.isArray(e)){let n;const r=e.map((e=>(e instanceof Hi?n=e.constructor:"string"==typeof e&&(e={text:e}),e)));e={autoCreated:!0,data:r,modelClass:n||class extends Hi{},allowNoId:!0},t||(t=As)}return t?new t(e):void 0}static get stores(){return As.registeredInstances}get rootNode(){return this.masterStore?this.masterStore.rootNode:this._rootNode}set rootNode(e){var t;const n=this,r=n._rootNode;e!==r&&(r&&n.clear(!0),e instanceof Hi?(e.instanceMeta(n).collapsed=!1,n._rootNode=e):n._rootNode=e=new n.modelClass(Object.assign({expanded:!0,[n.modelClass.idField]:`${n.id}-rootNode`},e),n,null,!0),n._tree=!0,e.isRoot=!0,e.joinStore(n),(null!==(t=e.children)&&void 0!==t&&t.length||n.rootVisible)&&(e.isLoading=!0,n.onNodeAddChild(e,e.children||[],0),e.isLoading=!1),n.trigger("rootChange",{oldRoot:r,rootNode:e}))}set data(e){this.setStoreData(e)}setStoreData(e){var t,n;const r=this,{idField:i,childrenField:s}=r.modelClass;if(r.transformFlatData&&(null===(t=e)||void 0===t?void 0:t.length)>0&&!Object.isExtensible(e[0])&&(r.useRawData=r.useRawData||{disableDuplicateIdCheck:!1,disableDefaultValue:!1,disableTypeConversion:!1},e=sn.clone(e)),r.getConfig("plugins"),r.processConfiguredListeners(),e&&!Array.isArray(e)&&(e=sn.transformNamedObjectToArray(e,i)),r.tree=!r.isChained&&(r.tree||Boolean(r.autoTree&&(null===(n=e)||void 0===n?void 0:n.some((e=>e[s]))))),e&&(r.remoteSort||r.remoteFilter))for(let t=0;t<e.length;t++)e[t]._remoteSortIndex=t;if(r.syncDataOnLoad&&r._data)r.syncDataset(e);else{if(r._data=e,r.tree){r.transformFlatData&&(e=r.treeifyFlatData(e));const t=r.rootNode;if(t.isLoading=!0,r._data.forEach((e=>delete e.parentId)),r.clear(!0),t.appendChild(e),r.updateDependentStores("dataset",[t]),t.isLoading=!1,0===e.length){const e={action:"dataset",data:[],records:[]};r.trigger("refresh",e),r.trigger("change",e)}else r.isFiltered&&r.filter()}else r.loadData(e);r.added.clear(),r.removed.clear(),r.modified.clear()}}loadData(e,t="dataset"){const n=this,{storage:r,allowNoId:i}=n,s=n.modelClass.fieldMap.id.dataSource;let o=n.verifyNoGeneratedIds;if(n.removeHeadersAndFooters(n.storage.values),n._idMap=null,n.oldIdMap={},e){if(e[0]instanceof Hi)n.clear(!0),r.replaceValues({values:e.slice(),isNewDataset:!0,silent:!0});else{n.modelClass.exposeProperties(e[0]);const t=e.length,d=new Array(t);for(let r=0;r<t;r++){var a,l,c;const t=e[r];if(!i&&null==t[s])throw new Error(`Id required but not found on row ${r}`);o&&null!==(a=t[s])&&void 0!==a&&null!==(l=(c=a).startsWith)&&void 0!==l&&l.call(c,"_generated")&&(console.warn(`Generated id found in data: ${t[s]}. Generated ids are temporary and should be replaced with real ids by the backend`),o=!1),d[r]=n.processRecord(n.createRecord(t,!0),!0),d[r].setData("parentIndex",r)}n.clear(!0),r.replaceValues({values:d,isNewDataset:!0,silent:!0})}n._data=e,n.onDataReplaced(t,e)}else n.clear(!0),n._data=null;n.isSyncingDataOnLoad=!1}get data(){return this._data}getRange(e,t,n=!0){return(n?this.storage.allValues:this.storage.values).slice(e,t)}createRecord(e,t=!1,n=!1){return new this.modelClass(e,this,null,t,!1,n)}processRecord(e,t=!1){return e}refreshData(){this.filter(),this.sort()}onRecordIdChange({record:e,oldValue:t,value:n}){const r=this,i=r._idMap,{idRegister:s,oldIdMap:o}=r;if(r.storage._indicesInvalid=!0,o[t]=e,i&&!i[n]){const e=i[t];delete i[t],i[n]=e}r.added.changeId(t,n),r.removed.changeId(t,n),r.modified.changeId(t,n),delete s[t],s[n]=e,e.index=r.storage.indexOf(e)}onUpdateRecord(e,t){const n=this,{internalId:r}=t,{internalIdRegister:i}=n;r&&(this.storage._indicesInvalid=!0,delete i[r.oldValue],i[r.value]=e),n.reapplyFilterOnUpdate&&n.isFiltered&&n.filter()}get useRawData(){return this._useRawData}set useRawData(e){this._useRawData=!0===e?{enabled:!0,disableDuplicateIdCheck:!0,disableTypeConversion:!0,disableDefaultValue:!1}:e?Object.assign(e,{enabled:!0}):{enabled:!1}}getCount(e=!0){return e?this.count:this.originalCount}get originalCount(){var e;return this.storage.totalCount-((null===(e=this.groupRecords)||void 0===e?void 0:e.length)||0)}get count(){return this.storage.count}get allCount(){return this.isTree?this.rootNode.descendantCount:this.storage.totalCount}get records(){return this.storage.values}get first(){return this.storage.values[0]}get last(){return this.storage.values[this.storage.values.length-1]}getAt(e,t=!1){return this.storage.getAt(e,t)}register(e){const t=this;if(!t.useRawData.disableDuplicateIdCheck){const n=t.isTree&&t.idRegister[e.id];if(n&&n!==e)throw new Error(`Id collision on ${e.id}`)}t.idRegister[e.id]=e,t.internalIdRegister[e.internalId]=e}unregister(e){delete this.idRegister[e.id],delete this.internalIdRegister[e.internalId]}get registeredRecords(){return Object.values(this.idRegister)}getById(e){if(null!=e&&e.isModel){const t=e;return t.hasLinks&&!this.storage.allValues.includes(t)?t.$links.find((e=>this.storage.allValues.includes(e))):t}return this.idRegister[e]}isAvailable(e){const t=this.getById(e);return t&&this.storage.includes(t)||!1}getByInternalId(e){return this.internalIdRegister[e]}includes(e){return this.isTree?null!=this.idRegister[Hi.asId(e)]:this.indexOf(e)>-1}indexOf(e,t=!1){if(null!=e&&e.isModel&&!e.stores.includes(this.$store||this)){const n=e.$links.find((e=>this.storage.allValues.includes(e)));return n?this.indexOf(n,t):-1}if(this.isTree)return this.storage.values.indexOf(this.getById(e));const n=Hi.asId(e);if(null==n)return-1;const r=this.idMap[n];return r?r[t?"visibleIndex":"index"]:-1}allIndexOf(e){if(this.isTree){const t=this.getById(e);let n=-1;return t&&t.bubble((e=>{e.parent?n+=e.parentIndex+1:e===this.rootNode&&this.rootVisible&&(n+=1)})),n}return this.storage.indexOf(e,!0)}getDistinctValues(e,t=!1){const n=[],r={};let i;return this.forEach((t=>{if(!t.isSpecialRow&&!t.isRoot){i=t.get(e);const s=i instanceof Date?i.getTime():i;r[s]||(n.push(i),r[s]=1)}}),this,t),n}getValueCount(e,t){let n=0;return this.forEach((r=>{sn.isEqual(r.get(e),t)&&n++})),n}set json(e){"string"==typeof e&&(e=_.safeJsonParse(e)),this.data=e}get json(){return _.safeJsonStringify(this)}get formattedJSON(){return _.safeJsonStringify(this,null,4)}toJSON(){return(this.isTree?this.rootNode.unfilteredChildren||this.rootNode.children||[]:this.allRecords).map((e=>e.toJSON()))}preProcessCurrentConfigs(e){super.preProcessCurrentConfigs(e),delete e.project}getInlineData(e){const t=[];var n;return this.tree?null===(n=this.rootNode.children)||void 0===n||n.forEach((n=>t.push(n.getCurrentConfig(e)))):this.forEach((n=>t.push(n.getCurrentConfig(e)))),t}getCurrentConfig(e){const t=super.getCurrentConfig(e),{state:n}=this;var r;return t&&(t.data&&(t.data=this.getInlineData(e)),delete t.project,delete t.stm,delete t.asyncEvents,(null===(r=t.modelClass)||void 0===r?void 0:r.$meta.hierarchy[t.modelClass.$meta.hierarchy.length-2])===this.constructor.defaultConfig.modelClass&&delete t.modelClass,this.tree||delete t.tree,n&&Object.assign(t,n)),t}forEach(e,t=this,n){"boolean"==typeof(n=void 0!==n&&n)&&(n={includeFilteredOutRecords:n,includeCollapsedGroupRecords:!1});const r=(n,r)=>{if(!n.isRoot&&!n.isSpecialRow)return e.call(t,n,r)};if(this.isTree)this.rootNode.traverseWhile(r,!1,n.includeFilteredOutRecords);else{const e=n.includeFilteredOutRecords?this.storage.allValues:this.storage.values;if(this.isGrouped&&n.includeCollapsedGroupRecords)for(let t=0;t<e.length;t++){const n=e[t];if(n.groupChildren&&!0===n.meta.collapsed){for(let e=0;e<n.groupChildren.length;e++)if(!1===r(n.groupChildren[e],e))return}else if(!1===r(n,t))return}else for(let t=0;t<e.length;t++)if(!1===r(e[t],t))return}}map(e,t=this){return this.storage.values.map(e,t)}every(e,t=this,n){return this.storage[n?"allValues":"values"].every(e,t)}reduce(e,t=[],n=this){return n!==this&&(e=e.bind(n)),this.storage.values.reduce(e,t,n)}[Symbol.iterator](){return this.storage.values[Symbol.iterator]()}traverse(e,t=this.rootNode,n=t===this.rootNode,r){"boolean"==typeof(r=void 0!==r&&r)&&(r={includeFilteredOutRecords:r,includeCollapsedGroupRecords:!1});const i=this;if(i.isTree){if("boolean"==typeof t&&(n=t,t=i.rootNode),i.isChained){const t=e;e=e=>{i.chainedFilterFn(e)&&t(e)}}t.traverse(e,n,r.includeFilteredOutRecords)}else i.forEach((t=>t.traverse(e,!1,r.includeFilteredOutRecords)),i,r)}traverseWhile(e,t=this.rootNode,n=t===this.rootNode){const r=this;if(r.isTree){if("boolean"==typeof t&&(n=t,t=r.rootNode),r.isChained){const t=e;e=e=>{r.chainedFilterFn(e)&&t(e)}}t.traverseWhile(e,n)}else for(const t of r.storage)if(!1===t.traverse(e))break}getNext(e,t=!1,n=!1){const r=this,i=r.storage.values;let s=r.indexOf(e);if(s>=i.length-1){if(!t)return null;s=-1}const o=i[s+1];return n&&o&&o.isSpecialRow?r.getNext(i[s+1],t,!0):o}getPrev(e,t=!1,n=!1){const r=this,i=r.storage.values;let s=r.indexOf(e);if(0===s){if(!t)return null;s=i.length}const o=i[s-1];return n&&o&&o.isSpecialRow&&s>0?r.getPrev(i[s-1],t,!0):o}getAdjacent(e,t=!0,n=!1,r=!1){return t?this.getNext(e,n,r):this.getPrev(e,n,r)}getNextLeaf(e,t=!1){const n=this.leaves,r=this.getById(e);let i=n.indexOf(r);if(i>=n.length-1){if(!t)return null;i=-1}return n[i+1]}getPrevLeaf(e,t=!1){const n=this.leaves,r=this.getById(e);let i=n.indexOf(r);if(0===i){if(!t)return null;i=n.length}return n[i-1]}getAdjacentLeaf(e,t=!0,n=!1){return t?this.getNextLeaf(e,n):this.getPrevLeaf(e,n)}}As.initClass(),As._$name="Store";const Fs=(e,t)=>(Array.isArray(t[1])?t[1].forEach((n=>e.push(encodeURIComponent(t[0])+"="+encodeURIComponent(n)))):e.push(encodeURIComponent(t[0])+"="+encodeURIComponent(t[1])),e),Os=Promise.resolve();class Ls extends As{static get defaultConfig(){return{headers:null,fetchOptions:null,sendAsFormData:null,writeAllFields:null,parentIdParamName:"id",responseSuccessProperty:"success",responseDataProperty:"data",responseTotalProperty:"total",filterParamName:null,restfulFilter:!1,sortParamName:null,pageParamName:null,pageStartParamName:null,pageSizeParamName:"pageSize",pageSize:50,useRestfulMethods:null,httpMethods:{create:"POST",read:"GET",update:"PUT",delete:"DELETE"}}}static get configurable(){return{params:null}}afterConstruct(e){super.afterConstruct(e),this.autoLoad&&this.load().catch((()=>{}))}get isLoading(){return this._isLoading}get isCommitting(){return Boolean(this.commitPromise)}set pageParamName(e){if(this.tree)throw new Error("Paging cannot be supported for tree stores");if(this.pageStartParamName)throw new Error("Configs pageStartParamName and pageParamName are mutually exclusive");this._pageParamName=e}get pageParamName(){return this._pageParamName}set pageStartParamName(e){if(this.tree)throw new Error("Paging cannot be supported for tree stores");if(this.pageParamName)throw new Error("Configs pageParamName and pageStartParamName are mutually exclusive");this._pageStartParamName=e}get pageStartParamName(){return this._pageStartParamName}get isPaged(){return this.pageParamName||this.pageStartParamName}get allCount(){return"remoteTotal"in this?this.remoteTotal:super.allCount}get lastPage(){if(this.isPaged)return Math.floor((this.allCount+this.pageSize-1)/this.pageSize)}buildQueryString(e,...t){const n=e.includes("?"),r=Object.entries(Object.assign({},...t)).reduce(Fs,[]).join("&");return r?(n?"&":"?")+r:""}performSort(e){const t=this;if(t.remoteSort&&!t.isRemoteDataLoading)return t.isRemoteDataLoading=!0,t.internalLoad({},"",(n=>{t.data=n.data,t.afterPerformSort(e),t.isRemoteDataLoading=!1}));super.performSort(e)}performFilter(e){const t=this;if(t.remoteFilter&&!t.isRemoteDataLoading){t.isRemoteDataLoading=!0;const n=t.count,{filters:r}=t;return t.currentPage=1,t.internalLoad({},"",(i=>{t.data=i.data,i=e?null:{action:"filter",filters:r,oldCount:n,records:t.storage.values},t.afterPerformFilter(i),t.trigger("refresh",i),t.isRemoteDataLoading=!1}))}super.performFilter(e)}encodeFilterParams(e){const t=[];for(const{property:n,operator:r,value:i,caseSensitive:s}of e)t.push({field:n,operator:r,value:i,caseSensitive:s});return JSON.stringify(t)}encodeSorterParams(e){return JSON.stringify(e.filter((e=>!e.sortFn)).map((e=>e)))}buildReadUrl(){const{readUrl:e}=this;return this.restfulFilter&&this.filters.count?(e.endsWith("/")?e:e+"/")+this.filters.first.value:e}internalLoad(e,t,n){const r=this,i=sn.assign({},r.params,e),s=r.buildReadUrl(),o={action:"read"+t,params:i,url:s};return s?new Promise(((e,s)=>{if(!1===r.trigger("beforeLoad"+t,o))return s(!1);if(r._isLoading=!0,r.trigger(`load${t}Start`,o),r.trigger("beforeRequest",o),r.filterParamName&&r.isFiltered&&(i[r.filterParamName]=r.encodeFilterParams(r.filters.values)),r.remoteSort&&r.isSorted&&(i[r.sortParamName]=r.encodeSorterParams(r.groupers?r.groupers.concat(r.sorters):r.sorters)),r.isPaged){if(!(r.pageParamName in i)&&!(r.pageStartParamName in i)){const e=Math.min(r.currentPage||1,r.allCount?r.lastPage:1/0);r.pageParamName?i[r.pageParamName]=e:i[r.pageStartParamName]=(e-1)*r.pageSize}i[r.pageSizeParamName]=r.pageSize}const a={headers:r.headers,parseJson:!0};r.useRestfulMethods&&(a.method=r.httpMethods.read,o.body&&(a.body=JSON.stringify(o.body))),st.get(o.url+r.buildQueryString(o.url,i),sn.assign(a,r.fetchOptions)).then((async a=>{const l=a.parsedJson,c=Array.isArray(l),d=c||l&&!1!==sn.getPath(l,r.responseSuccessProperty),u=c?null:sn.getPath(l,r.responseTotalProperty);if(r._isLoading=!1,o.response=a,o.json=l,d){if(null!=u&&(r.remoteTotal=parseInt(u,10)),r.isPaged){if(!(r.remoteTotal>=0))throw new Error("A paged store must receive its responseTotalProperty in each data packet");{const e=r.pageParamName?i[r.pageParamName]:i[r.pageStartParamName]/r.pageSize+1;r.currentPage=Math.min(e,r.lastPage)}}o.data=c?l:sn.getPath(l,r.responseDataProperty),await n(o),r.trigger("load"+t,o),e(o)}else Object.assign(o,{exception:!0,exceptionType:"server",error:null==l?void 0:l.error}),r.trigger("exception",o),s(o);r.trigger("afterRequest",o)})).catch((e=>{r._isLoading=!1,o.exception=!0,e instanceof Response?(o.exceptionType=e.ok?"server":"network",o.response=e,o.error=e.error):(o.exceptionType="server",o.error=e),r.trigger("exception",o),s(o),r.trigger("afterRequest",o)}))})):null}async load(e){const t=this;return t.isPaged?t.loadPage(t.currentPage||1,e):t.internalLoad(e,"",(e=>{t.data=e.data}))}async loadChildren(e){return this.internalLoad({[this.parentIdParamName]:e.id},"Children",(t=>{t.parentRecord=e,e.children.length&&e.clearChildren(!0),e.data[e.constructor.childrenField]=t.data,e.processChildren(e.stores)}))}async loadPage(e,t){this.allCount&&(e=Math.min(e,this.lastPage));const n=this,r=n.pageParamName?{[n.pageParamName]:e}:{[n.pageStartParamName]:(e-1)*n.pageSize};return r[n.pageSizeParamName]=n.pageSize,n.internalLoad(sn.assign(r,t),"Page",(e=>{n.loadData(e.data,"pageLoad")}))}async nextPage(e){const t=this;return t.isPaged&&t.currentPage!==t.lastPage?t.loadPage(t.currentPage+1,e):Os}async previousPage(e){return this.isPaged&&1!==this.currentPage?this.loadPage(this.currentPage-1,e):Os}async commit(){const e=this,{changes:t}=e,n=[];if(e.commitPromise)return!1;if(!t)return e.modified.count&&(e.modified.forEach((e=>e.clearChanges(!0,!1))),e.modified.clear()),Os;if(!1!==e.trigger("beforeCommit",{changes:t})){[...t.added,...t.modified,...t.removed].forEach((e=>e.meta.committing=!0)),e.trigger("commitStart",{changes:t});const r={action:"commit",exception:!1,changes:t};let i=e.commitRemoved(r);return i&&n.push(i),i=e.commitAdded(r),i&&n.push(i),i=e.commitModified(r),i&&n.push(i),n.length?(i=1===n.length?n[0]:Promise.all(n),e.commitPromise=new Promise(((n,s)=>{i.then((()=>{e.commitPromise=null,r.exception?(e.trigger("exception",r),s(r)):(e.trigger("commit",{changes:t}),n(r))})).catch((()=>{e.commitPromise=null,s(r)}))}))):(e.modified.forEach((e=>e.clearChanges(!0,!1))),e.modified.clear(),e.added.forEach((e=>e.clearChanges(!0,!1))),e.added.clear(),e.removed.clear(),e.trigger("commit",{changes:t}),Os)}}doAutoCommit(){this.suspendCount<=0&&this.commit().catch((e=>{const{response:t}=e;if(!t||!(t.ok&&t.parsedJson||[500,404].includes(t.status)))throw e}))}commitAdded(e){const t=this,n=t.added,r={action:"create",params:t.params};return n.count&&t.createUrl?new Promise((i=>{const s=n.values.map((e=>e.persistableData));e.create=r,r.body={data:s},t.trigger("beforeRequest",r);let o=r.body;if(t.sendAsFormData){const e=new FormData;e.append("data",JSON.stringify(s)),o=e}const a={headers:t.headers,parseJson:!0},l=t.createUrl+t.buildQueryString(t.createUrl,t.params);t.useRestfulMethods&&(a.method=t.httpMethods.create),st.post(l,o,sn.assign(a,t.fetchOptions)).then((s=>{const o=s.parsedJson,a=Array.isArray(o),l=a||o&&!1!==o.success;e.response=s,r.json=o,r.response=s,l?(t.processReturnedData(n.values,a?o:sn.getPath(o,t.responseDataProperty)),n.clear(),t.trigger("commitAdded"),t.trigger("refresh",r),i(e)):(n.forEach((e=>e.meta.committing=!1)),e.exception=r.exception=!0,e.exceptionType=r.exceptionType="server",t.trigger("exception",r),i(e)),t.trigger("afterRequest",r)})).catch((s=>{n.forEach((e=>e.meta.committing=!1)),e.exception=r.exception=!0,s instanceof Response?(e.response=s,r.exceptionType=s.ok?"server":"network",r.response=s,r.error=s.error):(r.exceptionType="server",r.error=s),t.trigger("exception",r),i(e),t.trigger("afterRequest",r)}))})):null}commitModified(e){const t=this,{modified:n}=t.changes,r={action:"update",params:t.params},i=n.length&&t.updateUrl?new Promise((i=>{const s=n.map((e=>t.writeAllFields?e.persistableData:e.modificationDataToWrite)).filter((e=>!sn.isEmpty(e)));if(0===s.length)return t.modified.clear(),n.forEach((e=>e.meta.committing=!1)),void i();e.update=r,r.body={data:s},t.trigger("beforeRequest",r);let o=r.body;if(t.sendAsFormData){const e=new FormData;e.append("data",JSON.stringify(s)),o=e}const a={headers:t.headers,parseJson:!0};t.useRestfulMethods&&(a.method=t.httpMethods.update),st.post(t.updateUrl+t.buildQueryString(t.updateUrl,t.params),o,sn.assign(a,t.fetchOptions)).then((s=>{const o=s.parsedJson,a=Array.isArray(o),l=a||o&&!1!==o.success;e.response=s,r.json=o,r.response=s,l?(t.processReturnedData(n,a?o:sn.getPath(o,t.responseDataProperty),!0),t.modified.clear(),t.trigger("commitModified"),t.trigger("refresh",r),i(e)):(n.forEach((e=>e.meta.committing=!1)),e.exception=r.exception=!0,r.exceptionType="server",t.trigger("exception",r),i(e)),t.trigger("afterRequest",r)})).catch((s=>{n.forEach((e=>e.meta.committing=!1)),e.exception=r.exception=!0,s instanceof Response?(e.response=s,r.exceptionType=s.ok?"server":"network",r.response=s,r.error=s.error):(r.exceptionType="server",r.error=s),t.trigger("exception",r),i(e),t.trigger("afterRequest",r)}))})):null;return!n.length&&t.modified.count&&t.modified.clear(),i}processReturnedData(e,t,n=!1){const r=this.modelClass,i=r.fieldMap.id.dataSource;t.forEach(((t,s)=>{const o=e[s];o.clearChanges(!0,!1),o.syncId(t[i]),Object.assign(e[s].data,r.processData(t,n))}))}commitRemoved(e){const t=this,n=t.removed,r={action:"delete",params:t.params};return n.count&&t.deleteUrl?new Promise((i=>{e.delete=r,r.body={ids:n.map((e=>e.id))},t.trigger("beforeRequest",r);let s=r.body;if(t.sendAsFormData){const e=new FormData;e.append("id",JSON.stringify(s.ids)),s=e}const o={headers:t.headers,parseJson:!0};t.useRestfulMethods&&(o.method=t.httpMethods.delete),st.post(t.deleteUrl+t.buildQueryString(t.deleteUrl,t.params),s,sn.assign(o,t.fetchOptions)).then((s=>{const o=s.parsedJson,a=Array.isArray(o)||o&&!1!==o.success;e.response=s,r.json=o,r.response=s,a?(n.forEach((e=>e.meta.committing=!1)),n.clear(),t.trigger("commitRemoved"),t.trigger("refresh",r),i(e)):(n.forEach((e=>e.meta.committing=!1)),e.exception=r.exception=!0,r.exceptionType="server",t.trigger("exception",r),i(e)),t.trigger("afterRequest",r)})).catch((s=>{n.forEach((e=>e.meta.committing=!1)),e.exception=r.exception=!0,s instanceof Response?(e.response=s,r.exceptionType=s.ok?"server":"network",r.response=s,r.error=s.error):(r.exceptionType="server",r.error=s),t.trigger("exception",r),i(e),t.trigger("afterRequest",r)}))})):null}get remoteFilter(){return Boolean(this.filterParamName||this.restfulFilter)}get remoteSort(){return Boolean(this.sortParamName)}}v(Ls,"$name","AjaxStore"),Ls._$name="AjaxStore";class Ps{static get(e,t){const n=e._domData||(e._domData={});return null!=t?n[t]:n}static remove(e,t){const{_domData:n}=e,r=null==n?void 0:n[t];return null==n||delete n[t],r}static set(e,t,n){3===arguments.length?(e._domData||(e._domData={}))[t]=n:e._domData=t}static assign(e,t){Object.assign(e._domData||(e._domData={}),t)}}Ps._$name="DomDataStore";const $s=()=>{throw new Error("Abstract method call!")};class _s extends Te{get type(){return this.constructor.name}undo(){$s()}redo(){$s()}}_s._$name="ActionBase";const Ns=()=>{throw new Error("Abstract method call!")},Hs=()=>{throw new Error("Method cannot be called at this state!")};class Bs extends Te{canUndo(e){Ns()}canRedo(e){Ns()}onUndo(e){Ns()}onRedo(e){Ns()}onStartTransaction(e){Ns()}onStopTransaction(e){Ns()}onStopTransactionDelayed(e){Ns()}onRejectTransaction(e){Ns()}onEnable(e){Ns()}onDisable(e){Ns()}onAutoRecordOn(e){Ns()}onAutoRecordOff(e){Ns()}onResetQueue(e){Ns()}onModelUpdate(e){Ns()}onStoreModelAdd(e){Ns()}onStoreModelInsert(e){Ns()}onStoreModelRemove(e){Ns()}onStoreModelRemoveAll(e){Ns()}onModelInsertChild(e){Ns()}onModelRemoveChild(e){Ns()}}Bs._$name="StateBase";const js=Symbol("STATE_PROP"),Vs=Symbol("STORES_PROP"),zs=Symbol("QUEUE_PROP"),Ws=Symbol("POS_PROP"),Us=Symbol("TRANSACTION_PROP"),Ys=Symbol("TRANSACTION_TIMER_PROP"),Gs=Symbol("AUTO_RECORD_PROP");Object.freeze([js,Vs,zs,Ws,Us,Ys,Gs]);const qs=new Map;var Ks=(e,t)=>{qs.set(e,t)},Xs=e=>("string"==typeof e&&(e=qs.get(e)),e);const Zs=(e,t)=>{const{undo:n,redo:r}=t;let i;return i=n&&!r?{[zs]:e[zs].slice(e.position),[Ws]:0}:r&&!n?{[zs]:e[zs].slice(0,e.position)}:{[zs]:[],[Ws]:0},[i,()=>{e.notifyStoresAboutQueueReset(t)}]},Js=new class extends Bs{canUndo(){return!1}canRedo(){return!1}onUndo(){Hs()}onRedo(){Hs()}onEnable(e){return e.autoRecord?"autoreadystate":"readystate"}onDisable(){Hs()}onAutoRecordOn(){return{[Gs]:!0}}onAutoRecordOff(){return{[Gs]:!1}}onStartTransaction(){Hs()}onStopTransaction(){Hs()}onStopTransactionDelayed(){Hs()}onRejectTransaction(){Hs()}onResetQueue(e,t){return Zs(e,t)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}};Ks("disabledstate",Js);const Qs=Symbol("ACTION_QUEUE_PROP");class eo extends Te{get defaultConfig(){return{title:null}}construct(...e){this[Qs]=[],super.construct(...e)}get queue(){return this[Qs].slice(0)}get length(){return this[Qs].length}addAction(e){this[Qs].push(e)}undo(){const e=this[Qs];for(let t=e.length-1;t>=0;--t)e[t].undo()}redo(){const e=this[Qs];for(let t=0,n=e.length;t<n;++t)e[t].redo()}}eo._$name="Transaction";class to extends Bs{canUndo(e){return 0<e.position&&e.position<=e.length}canRedo(e){return 0<=e.position&&e.position<e.length}onUndo(e,t){let n=e.position;const r=e[zs],i=Math.max(0,n-t);return[{[js]:"restoringstate",[Ws]:i},()=>{for(e.notifyStoresAboutStateRestoringStart();n!==i;)r[--n].undo();return[e.autoRecord?"autoreadystate":"readystate",()=>{e.notifyStoresAboutStateRestoringStop()}]}]}onRedo(e,t){let n=e.position;const r=e[zs],i=Math.min(r.length,n+t);return[{[js]:"restoringstate",[Ws]:i},()=>{e.notifyStoresAboutStateRestoringStart();do{r[n++].redo()}while(n!==i);return[e.autoRecord?"autoreadystate":"readystate",()=>{e.notifyStoresAboutStateRestoringStop()}]}]}onEnable(){Hs()}onDisable(){return"disabledstate"}onAutoRecordOn(){return{[js]:"autoreadystate",[Gs]:!0}}onAutoRecordOff(){Hs()}onStartTransaction(e,t){const n=new eo({title:t});return[{[js]:"recordingstate",[Us]:n},()=>{e.notifyStoresAboutStateRecordingStart(n)}]}onStopTransaction(){Hs()}onStopTransactionDelayed(){Hs()}onRejectTransaction(){Hs()}onResetQueue(e,t){return Zs(e,t)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}}const no=new to;Ks("readystate",no);class ro extends Bs{canUndo(){return!1}canRedo(){return!1}onEnable(){}onDisable(e){const t=e[Us];return e.notifyStoresAboutStateRecordingStop(t,{disabled:!0}),{[js]:"disabledstate",[Us]:null}}onAutoRecordOn(e){return[{[js]:"autorecordingstate",[Gs]:!0},()=>{e.stopTransactionDelayed()}]}onAutoRecordOff(){Hs()}onStartTransaction(){Hs()}onStopTransaction(e,t){const n=e[Us],r=e[zs];let i=e[Ws];return n.length&&(n.title||t||!e.getTransactionTitle?t&&(n.title=t):n.title=e.getTransactionTitle(n),r[i]=n,r.length=++i),[{[js]:"readystate",[Ws]:i,[Us]:null},()=>{e.notifyStoresAboutStateRecordingStop(n,{stop:!0})}]}onRejectTransaction(e){const t=e[Us];return[{[js]:"restoringstate",[Us]:null},()=>(t.length&&t.undo(),["readystate",()=>{e.notifyStoresAboutStateRecordingStop(t,{rejected:!0})}])]}onStopTransactionDelayed(){Hs()}onResetQueue(e,t){return Zs(e,t)}onModelUpdate(e,t,n,r){e[Us].addAction(e.makeModelUpdateAction(t,n,r))}onModelInsertChild(e,t,n,r,i,s){e[Us].addAction(e.makeModelInsertChildAction(t,n,r,i,s))}onModelRemoveChild(e,t,n,r){e[Us].addAction(e.makeModelRemoveChildAction(t,n,r))}onStoreModelAdd(e,t,n,r){e[Us].addAction(e.makeStoreModelAddAction(t,n,r))}onStoreModelInsert(e,t,n,r,i,s){e[Us].addAction(e.makeStoreModelInsertAction(t,n,r,i,s))}onStoreModelRemove(e,t,n,r,i){e[Us].addAction(e.makeStoreModelRemoveAction(t,n,r,i))}onStoreRemoveAll(e,t,n,r){e[Us].addAction(e.makeStoreRemoveAllAction(t,n,r))}}const io=new ro;Ks("recordingstate",io);const so=new class extends Bs{static get $name(){return"RestoringStateClass"}canUndo(){return!1}canRedo(){return!1}onUndo(){Hs()}onRedo(){Hs()}onEnable(){Hs()}onDisable(){Hs()}onAutoRecordOn(){return{[Gs]:!0}}onAutoRecordOff(){return{[Gs]:!1}}onStartTransaction(){Hs()}onStopTransaction(){Hs()}onStopTransactionDelayed(){Hs()}onRejectTransaction(){Hs()}onQueueReset(){Hs()}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}};Ks("restoringstate",so);const oo=new class extends to{onAutoRecordOn(){Hs()}onAutoRecordOff(){return{[js]:"readystate",[Gs]:!1}}onStartTransaction(e,t){const n=new eo({title:t});return[{[js]:"autorecordingstate",[Us]:n},()=>{e.notifyStoresAboutStateRecordingStart(n),e.stopTransactionDelayed()}]}onModelUpdate(e,t,n,r){e.startTransaction(),e.onModelUpdate(t,n,r)}onModelInsertChild(e,t,n,r,i){e.startTransaction(),e.onModelInsertChild(t,n,r,i)}onModelRemoveChild(e,t,n,r){e.startTransaction(),e.onModelRemoveChild(t,n,r)}onStoreModelAdd(e,t,n,r){e.startTransaction(),e.onStoreModelAdd(t,n,r)}onStoreModelInsert(e,t,n,r,i,s){e.startTransaction(),e.onStoreModelInsert(t,n,r,s)}onStoreModelRemove(e,t,n,r,i){e.startTransaction(),e.onStoreModelRemove(t,n,r,i)}onStoreRemoveAll(e,t,n,r){e.startTransaction(),e.onStoreRemoveAll(t,n,r)}};Ks("autoreadystate",oo);class ao extends(ro.mixin(Zr)){onDisable(e){const t=e[Us],n=e[Ys];return n&&this.clearTimeout(n),e.notifyStoresAboutStateRecordingStop(t,{disabled:!0}),{[js]:"disabledstate",[Us]:null,[Ys]:null}}onAutoRecordOn(e){Hs()}onAutoRecordOff(e){const t=e[Ys];return t&&this.clearTimeout(t),{[js]:"recordingstate",[Gs]:!1,[Ys]:null}}onStopTransaction(e,t){const n=e[Us],r=e[Ys],i=e[zs];let s=e[Ws];return r&&this.clearTimeout(r),n.length&&(n.title||t||!e.getTransactionTitle?t&&(n.title=t):n.title=e.getTransactionTitle(n),i[s]=n,i.length=++s),[{[js]:"autoreadystate",[Ws]:s,[Us]:null,[Ys]:null},()=>{e.notifyStoresAboutStateRecordingStop(n,{stop:!0})}]}onStopTransactionDelayed(e){let t=e[Ys];return t&&this.clearTimeout(t),t=this.setTimeout((()=>{e.stopTransaction()}),e.autoRecordTransactionStopTimeout),{[js]:lo,[Ys]:t}}onResetQueue(e,t){return Zs(e,t)}onRejectTransaction(e){const t=e[Us],n=e[Ys];return n&&this.clearTimeout(n),[{[js]:"restoringstate",[Us]:null,[Ys]:null},()=>(t.length&&t.undo(),["autoreadystate",()=>{e.notifyStoresAboutStateRecordingStop(t,{rejected:!0})}])]}onModelUpdate(e,...t){super.onModelUpdate(e,...t),e.stopTransactionDelayed()}onModelInsertChild(e,...t){super.onModelInsertChild(e,...t),e.stopTransactionDelayed()}onModelRemoveChild(e,...t){super.onModelRemoveChild(e,...t),e.stopTransactionDelayed()}onStoreModelAdd(e,...t){super.onStoreModelAdd(e,...t),e.stopTransactionDelayed()}onStoreModelInsert(e,...t){super.onStoreModelInsert(e,...t),e.stopTransactionDelayed()}onStoreModelRemove(e,...t){super.onStoreModelRemove(e,...t),e.stopTransactionDelayed()}onStoreRemoveAll(e,...t){super.onStoreRemoveAll(e,...t),e.stopTransactionDelayed()}}const lo=new ao;Ks("autorecordingstate",lo);const co=Symbol("MODEL_PROP"),uo=Symbol("NEW_DATA_PROP"),ho=Symbol("OLD_DATA_PROP");class go extends _s{static get defaultConfig(){return{model:void 0,newData:void 0,oldData:void 0}}get type(){return"UpdateAction"}get model(){return this[co]}set model(e){this[co]=e}get newData(){return this[uo]}set newData(e){this[uo]=f({},e)}get oldData(){return this[ho]}set oldData(e){this[ho]=f({},e)}undo(){const{model:e,oldData:t}=this;e.$&&Object.assign(e,t),e.set(t,null,null,null,!0)}redo(){const{model:e,newData:t}=this;e.$&&Object.assign(e,t),e.set(t,null,null,null,!0)}}go._$name="UpdateAction";const mo=Symbol("PARENT_MODEL_PROP"),po=Symbol("CHILD_MODELS_PROP"),fo=Symbol("INSERT_INDEX_PROP"),vo=Symbol("CONTEXT_PROP");class yo extends _s{static get defaultConfig(){return{parentModel:void 0,childModels:void 0,insertIndex:void 0,context:void 0}}get type(){return"InsertChildAction"}get parentModel(){return this[mo]}set parentModel(e){this[mo]=e}get childModels(){return this[po]}set childModels(e){this[po]=e.slice(0)}get insertIndex(){return this[fo]}set insertIndex(e){this[fo]=e}get context(){return this[vo]}set context(e){this[vo]=e}undo(){const{parentModel:e,context:t,childModels:n}=this;n.sort(((e,n)=>{const{lhsParent:r,lhsIndex:i}=t.get(e)||{},{rhsParent:s,rhsIndex:o}=t.get(n)||{};return r&&r===s?i-o:0})),n.forEach((n=>{const{parent:r,index:i}=t.get(n)||{};if(r)if(r===e){let e;e=i>n.parentIndex?i+1:i,e=i===r.children.length-1?null:e;const t=r.children[e];r.insertChild(n,t)}else r.insertChild(n,r.children[i]);else e.removeChild(n)}))}redo(){const{parentModel:e,insertIndex:t,childModels:n}=this,r=e.children[t];e.insertChild(n,r)}}yo._$name="InsertChildAction";const bo=Symbol("PARENT_MODEL_PROP"),Co=Symbol("CHILD_MODELS_PROP"),wo=Symbol("CONTEXT_PROP");class So extends _s{static get defaultConfig(){return{parentModel:void 0,childModels:void 0,context:void 0}}get type(){return"RemoveChildAction"}get parentModel(){return this[bo]}set parentModel(e){this[bo]=e}get childModels(){return this[Co]}set childModels(e){this[Co]=e.slice(0)}get context(){return this[wo]}set context(e){this[wo]=e}undo(){const{parentModel:e,context:t,childModels:n}=this;n.sort(((e,n)=>t.get(e)-t.get(n))),n.forEach((n=>{e.insertChild(n,t.get(n))}))}redo(){this.parentModel.removeChild(this.childModels)}}So._$name="RemoveChildAction";const Do=Symbol("STORE_PROP"),Eo=Symbol("MODEL_LIST_PROP");class xo extends _s{static get defaultConfig(){return{store:void 0,modelList:void 0,silent:!1}}get type(){return"AddAction"}get store(){return this[Do]}set store(e){this[Do]=e}get modelList(){return this[Eo]}set modelList(e){this[Eo]=e.slice(0)}undo(){this.store.remove(this.modelList,this.silent)}redo(){this.store.add(this.modelList,this.silent)}}xo._$name="AddAction";const Ro=Symbol("STORE_PROP"),To=Symbol("MODEL_LIST_PROP"),Mo=Symbol("INSERT_INDEX_PROP"),ko=Symbol("CONTEXT_PROP");class Io extends _s{static get defaultConfig(){return{store:void 0,modelList:void 0,insertIndex:void 0,context:void 0,silent:!1}}get type(){return"InsertAction"}get store(){return this[Ro]}set store(e){this[Ro]=e}get modelList(){return this[To]}set modelList(e){this[To]=e.slice(0)}get insertIndex(){return this[Mo]}set insertIndex(e){this[Mo]=e}get context(){return this[ko]}set context(e){this[ko]=e}undo(){const{store:e,modelList:t,context:n,silent:r}=this;t.sort(((e,t)=>{const r=n.get(e),i=n.get(t);return void 0!==r&&void 0!==i?r-i:0})),t.forEach((t=>{const i=n.get(t);t._undoingInsertion=!0,void 0!==i?e.insert(i,t,r):e.remove(t,r),t._undoingInsertion=!1}))}redo(){const e=this;e.store.insert(e.insertIndex,e.modelList,e.silent)}}Io._$name="InsertAction";const Ao=Symbol("STORE_PROP"),Fo=Symbol("MODEL_LIST_PROP"),Oo=Symbol("CONTEXT_PROP");class Lo extends _s{static get defaultConfig(){return{store:void 0,modelList:void 0,context:void 0,silent:!1}}get type(){return"RemoveAction"}get store(){return this[Ao]}set store(e){this[Ao]=e}get modelList(){return this[Fo]}set modelList(e){this[Fo]=e.slice(0)}get context(){return this[Oo]}set context(e){this[Oo]=e}undo(){const{store:e,context:t,modelList:n,silent:r}=this;n.sort(((e,n)=>t.get(e)-t.get(n))),n.forEach((n=>{const i=t.get(n);e.insert(i,n,r)}))}redo(){this.store.remove(this.modelList,this.silent)}}Lo._$name="RemoveAction";const Po=Symbol("STORE_PROP"),$o=Symbol("ALL_RECORDS_PROP");class _o extends _s{static get defaultConfig(){return{store:void 0,allRecords:void 0,silent:!1}}get type(){return"RemoveAllAction"}get store(){return this[Po]}set store(e){this[Po]=e}get allRecords(){return this[$o]}set allRecords(e){this[$o]=e.slice(0)}undo(){const{store:e,allRecords:t,silent:n}=this;e.add(t,n)}redo(){this.store.removeAll(this.silent)}}_o._$name="RemoveAllAction";const No=(e,t,n)=>new go({model:e,newData:t,oldData:n}),Ho=(e,t,n,r)=>new yo({parentModel:e,childModels:n,insertIndex:t,context:r}),Bo=(e,t,n)=>new So({parentModel:e,childModels:t,context:n}),jo=(e,t,n)=>new xo({store:e,modelList:t,silent:n}),Vo=(e,t,n,r,i)=>new Io({store:e,insertIndex:t,modelList:n,context:r,silent:i}),zo=(e,t,n,r)=>new Lo({store:e,modelList:t,context:n,silent:r}),Wo=(e,t,n)=>new _o({store:e,allRecords:t,silent:n}),Uo=(e,t,...n)=>{const r=e.state,i=t.call(e[js],e,...n);if("string"==typeof i)e[js]=Xs(i);else if(i instanceof Bs)e[js]=i;else if(Array.isArray(i)){const[t,r]=i;"string"==typeof t?e[js]=Xs(t):t instanceof Bs?e[js]=t:t&&"object"==typeof t&&((e=Object.assign(e,t))[js]=Xs(e[js])),"function"==typeof r&&Uo(e,r,...n)}else i&&"object"==typeof i&&((e=Object.assign(e,i))[js]=Xs(e[js]));r!==no&&r!==oo&&i!==no&&i!==oo&&e.trigger("ready")};class Yo extends(tt(Te)){static get defaultConfig(){return{disabled:!0,autoRecord:!1,autoRecordTransactionStopTimeout:100,makeModelUpdateAction:No,makeModelInsertChildAction:Ho,makeModelRemoveChildAction:Bo,makeStoreModelAddAction:jo,makeStoreModelInsertAction:Vo,makeStoreModelRemoveAction:zo,makeStoreRemoveAllAction:Wo,getTransactionTitle:null}}construct(...e){Object.assign(this,{[js]:no,[Vs]:[],[zs]:[],[Ws]:0,[Us]:null,[Ys]:null,[Gs]:!1}),super.construct(...e)}get state(){return this[js]}get position(){return this[Ws]}get length(){return this[zs].length}get stores(){return Array.from(this[Vs])}hasStore(e){return this[Vs].includes(e)}addStore(e){this.hasStore(e)||(this[Vs].push(e),e.stm=this)}removeStore(e){this.hasStore(e)&&(this[Vs]=this[Vs].filter((t=>t!==e)),e.stm=null)}forEachStore(e){this[Vs].forEach((t=>e(t,t.id)))}get disabled(){return this.state===Js}set disabled(e){const t=this;t.disabled!==e&&(Uo(t,e?t.state.onDisable:t.state.onEnable,t),t.trigger("stmDisabled",{disabled:e}),t.trigger("disabled",{disabled:e}))}get enabled(){return!this.disabled}enable(){this.disabled=!1}disable(){this.disabled=!0}get isReady(){return this.state===no||this.state===oo}waitForReadiness(){return this.await("ready",!1)}get isRecording(){return this.state===io||this.state===lo}get autoRecord(){return this[Gs]}set autoRecord(e){const t=this;t.autoRecord!=e&&Uo(t,e?t.state.onAutoRecordOn:t.state.onAutoRecordOff,t)}startTransaction(e=null){Uo(this,this.state.onStartTransaction,e)}stopTransaction(e=null){Uo(this,this.state.onStopTransaction,e)}stopTransactionDelayed(){Uo(this,this.state.onStopTransactionDelayed)}rejectTransaction(){Uo(this,this.state.onRejectTransaction)}get transaction(){return this[Us]}get queue(){return this[zs].map((e=>e.title))}get isRestoring(){return this.state===so}get canUndo(){return this.state.canUndo(this)}get canRedo(){return this.state.canRedo(this)}async undo(e=1){this.isReady||await this.waitForReadiness(),Uo(this,this.state.onUndo,e)}async undoAll(){this.isReady||await this.waitForReadiness(),this.undo(this.length)}async redo(e=1){this.isReady||await this.waitForReadiness(),Uo(this,this.state.onRedo,e)}async redoAll(){this.isReady||await this.waitForReadiness(),this.redo(this.length)}resetQueue(e={undo:!0,redo:!0}){Uo(this,this.state.onResetQueue,e)}resetUndoQueue(){this.resetQueue({undo:!0})}resetRedoQueue(){this.resetQueue({redo:!0})}notifyStoresAboutStateRecordingStart(e){this.forEachStore((t=>{var n;return null===(n=t.onStmRecordingStart)||void 0===n?void 0:n.call(t,this,e)})),this.trigger("recordingStart",{stm:this,transaction:e})}notifyStoresAboutStateRecordingStop(e,t){this.forEachStore((n=>{var r;return null===(r=n.onStmRecordingStop)||void 0===r?void 0:r.call(n,this,e,t)})),this.trigger("recordingStop",{stm:this,transaction:e,reason:t})}notifyStoresAboutStateRestoringStart(){this.forEachStore((e=>{var t;return null===(t=e.onStmRestoringStart)||void 0===t?void 0:t.call(e,this)})),this.trigger("restoringStart",{stm:this})}notifyStoresAboutStateRestoringStop(){this.forEachStore((e=>{var t;return null===(t=e.onStmRestoringStop)||void 0===t?void 0:t.call(e,this)})),this.trigger("restoringStop",{stm:this})}notifyStoresAboutQueueReset(e){this.forEachStore((t=>{var n;return null===(n=t.onStmQueueReset)||void 0===n?void 0:n.call(t,this,e)})),this.trigger("queueReset",{stm:this,options:e})}onModelUpdate(e,t,n){Uo(this,this.state.onModelUpdate,e,t,n)}onModelInsertChild(e,t,n,r){Uo(this,this.state.onModelInsertChild,e,t,n,r)}onModelRemoveChild(e,t,n){Uo(this,this.state.onModelRemoveChild,e,t,n)}onStoreModelAdd(e,t,n){Uo(this,this.state.onStoreModelAdd,e,t,n)}onStoreModelInsert(e,t,n,r,i){Uo(this,this.state.onStoreModelInsert,e,t,n,r,i)}onStoreModelRemove(e,t,n,r){Uo(this,this.state.onStoreModelRemove,e,t,n,r)}onStoreRemoveAll(e,t,n){Uo(this,this.state.onStoreRemoveAll,e,t,n)}onUndoKeyPress(e){const t=this;t.enabled&&(e.shiftKey?t.canRedo&&(e.preventDefault(),t.redo()):t.canUndo&&(e.preventDefault(),t.undo()))}stash(){this.transaction&&(this.stashedTransaction=this.transaction,this.rejectTransaction())}applyStash(){this.stashedTransaction&&(this.startTransaction(this.stashedTransaction.title),this.stashedTransaction.redo(),delete this.stashedTransaction)}}Yo._$name="StateTrackingManager";const Go=Array.prototype.slice,qo=Object.freeze([]),Ko=Object.freeze({}),Xo=/[&<]/,{getPrototypeOf:Zo}=Object,{toString:Jo}=Object.prototype,{isEqual:Qo,isObject:ea}=sn,ta={parent:1,elementData:1,ns:1,syncOptions:1},na=()=>({ignore:ta,refsFound:new Set}),ra={class:1,className:1,classname:1},ia={bigint:1,boolean:1,function:1,number:1,string:1,symbol:1},sa={tag:1,html:1,text:1,children:1,tooltip:1,parent:1,nextSibling:1,ns:1,reference:1,elementData:1,retainElement:1,compareHtml:1,syncOptions:1,listeners:1,isReleased:1,null:1,"":1,keepChildren:1};class oa{static checkEquality(e,t,n,r){if(e===t)return!0;if(null==e)return null==t;if(!e||!t)return!1;const i=typeof e;if(i!==typeof t||ia[i])return!1;let s,o,a,l,c,d,u,h=n.equalityCache||(n.equalityCache=new Map),g=Boolean(r);if(h=h.get(e)||h.set(e,new Map).get(e),s=h.get(t),void 0===s){if(s=!0,Zo(e)!==Zo(t)||e instanceof Node)s=!1;else if(Array.isArray(e)){if(o=e.length,o!==t.length)s=!1;else for(;o-- >0;)if(!oa.checkEquality(e[o],t[o],n,g)){s=!1;break}}else{var m;for(c in d=e.syncOptions,l=null===(m=d)||void 0===m?void 0:m.ignoreRefs,l&&(g=!0,r="children"!==l),a=n.ignore||Ko,t)if(!(a[c]||c in e||r&&"reference"===c)){s=!1;break}if(s)if("[object Date]"===Jo.call(t))s=e.getTime()===t.getTime();else for(c in e)if(!(a[c]||r&&"reference"===c)){if(!(c in t)){s=!1;break}if(u=e[c],!oa.checkEquality(u,t[c],n,g)){s=!1;break}}}var p;!r&&ea(e)&&e.reference&&(null===(p=n.refsFound)||void 0===p||p.add(e.reference)),h.set(t,s)}return s}static sync(e){const t=e,{refOwner:n}=e,r=null==n?void 0:n.byRef,i=na();let s,o,a,l,c=e.affected;if("string"==typeof c&&(c=[c]),e=f(f({},e),{},{checkEqualityOptions:i}),n){if(n.byRef={},c)for(o in r)c.includes(o)||(n.byRef[o]=r[o]);e.refsWas=r}if(t.changed=oa.performSync(e,e.targetElement),n)for(c||(c=Object.keys(r)),s=0;s<c.length;++s)o=c[s],a=r[o],i.refsFound.has(o)||a.retainElement?n.byRef[o]=a:(l=a.lastDomConfig,a.remove(),n.detachRef(o,a,l));return e.targetElement}static performSync(e,t){const{domConfig:n,callback:r}=e,{lastDomConfig:i}=t;return(e.configEquality||oa.checkEquality)(n,i,e.checkEqualityOptions,e.ignoreRefs)?(null==r||r({action:"none",domConfig:n,targetElement:t}),!1):(n?(n.onlyChildren||(oa.syncAttributes(n,t,e),oa.syncContent(n,t)),n.keepChildren||oa.syncChildren(e,t)):(t.innerHTML=null,t.syncIdMap=null),t.lastDomConfig=null!=n&&n.onlyChildren&&i?f(f({},i),{},{children:n.children}):n,!0)}static syncDataset(e,t){const{lastDomConfig:n}=t,r=e===n,i=Object.keys(e.dataset),s=n&&n.dataset&&Object.keys(n.dataset),o=ke.delta(i,s);let a,l,c,d;for(l=0;l<o.onlyInA.length;l++)a=o.onlyInA[l],d=e.dataset[a],null!=d&&t.setAttribute(`data-${_.hyphenate(a)}`,d);for(l=0;l<o.inBoth.length;l++)a=o.inBoth[l],d=e.dataset[a],(r||d!=n.dataset[a])&&(c=`data-${_.hyphenate(a)}`,null==d?t.removeAttribute(c):t.setAttribute(c,d));for(l=0;l<o.onlyInB.length;l++)t.removeAttribute(`data-${_.hyphenate(o.onlyInB[l])}`)}static addCls(e,t){const{lastDomConfig:n}=t;(e=Mn.normalize(e,"array")).forEach((e=>{t.classList.add(e),((e,t)=>{const n="className"in t?"className":"class",r=t[n];if(r)if("string"==typeof r){const i=r.split(" ");i.includes(e)||(i.push(e),t[n]=i.join(" "))}else Array.isArray(r)?r.includes(e)||r.push(e):r.isDomClassList?r.add(e):sn.isObject(r)&&(r[e]=1)})(e,n)}))}static removeCls(e,t){const{lastDomConfig:n}=t;(e=Mn.normalize(e,"array")).forEach((e=>{t.classList.remove(e),((e,t)=>{const n="className"in t?"className":"class",r=t[n];if(r)if("string"==typeof r){const i=r.split(" ");i.includes(e)&&(i.splice(i.indexOf(e),1),t[n]=i.join(" "))}else Array.isArray(r)?r.includes(e)&&r.splice(r.indexOf(e),1):r.isDomClassList?r.remove(e):sn.isObject(r)&&delete r[e]})(e,n)}))}static syncClassList(e,t,n){let r,i,s,o,a,l,c=e.className||e.class;if(n){for(i=Mn.normalize(t,"array"),c=Mn.normalize(c,"object"),l=Mn.normalize(n.className||n.class,"object"),a=[],s=0,o=i.length;s<o;++s)r=i[s],!c[r]&&r in l||(l[r]=1,a.push(r));for(r in c)l[r]||a.push(r);c=a.join(" ")}else c=Mn.normalize(c);t.setAttribute("class",c)}static getSyncAttributes(e){const t={},n=[];return e&&Object.keys(e).forEach((r=>{if(!sa[r]){const i=r.toLowerCase();t[i]=e[r],n.push(i)}})),{attributes:t,names:n}}static syncAttributes(e,t,n){const{lastDomConfig:r}=t,i=e===r,s=oa.getSyncAttributes(e),{attributes:o,names:a}=s,{attributes:l,names:c}=i?s:oa.getSyncAttributes(r),{onlyInA:d,onlyInB:u,inBoth:h}=i?{onlyInA:qo,onlyInB:qo,inBoth:a}:ke.delta(a,c);let g,m;for(m=0;m<d.length;m++){g=d[m];const n=o[g];"style"===g&&null!=n?Mr.applyStyle(t,n,!0):"dataset"===g?oa.syncDataset(e,t):ra[g]?oa.syncClassList(e,t):null!=n&&t.setAttribute(g,n)}for(m=0;m<u.length;m++)t.removeAttribute(u[m]);for(m=0;m<h.length;m++){g=h[m];const r=o[g],s=l[g];null==r?t.removeAttribute(g):"style"===g?n.strict?i?oa.syncStyles(t,r):Qo(r,s,!0)||oa.syncStyles(t,r,s):!i&&Qo(r,s,!0)||Mr.applyStyle(t,r,!0):"dataset"===g?oa.syncDataset(e,t):ra[g]?oa.syncClassList(e,t,n.strict&&t.lastDomConfig):(i||r!==s)&&t.setAttribute(g,r)}}static syncStyles(e,t,n){let r,i,s;if(n){if(r={},t=Mr.parseStyle(t),n=Mr.parseStyle(n),t)for(i in t)s=t[i],n[i]!==s&&(r[i]=s);for(i in n)i in t||(r[i]="")}else r=t;Mr.applyStyle(e,r)}static syncContent(e,t){const{html:n,text:r}=e,i=null!=r?r:n;if(e.elementData&&(t.elementData=e.elementData),i instanceof DocumentFragment)1===t.childNodes.length&&0===Mr.getChildElementCount(t)&&1===i.childNodes.length&&0===Mr.getChildElementCount(i)?Mr.setInnerText(t,i.firstChild.data):(t.innerHTML="",t.appendChild(i));else if(null!=n&&Xo.test(n))t.innerHTML=String(n);else if(null!=i){var s;const{lastDomConfig:e}=t;null!=e&&null!==(s=e.children)&&void 0!==s&&s.length||null!=e&&e.html&&Xo.test(t.lastDomConfig.html)?t.innerHTML=i:Mr.setInnerText(t,String(i))}}static insertTextNode(e,t,n,r,i=null){const s=document.createTextNode(e);t.insertBefore(s,i),r&&(s.$refOwnerId=r.id),null==n||n({action:"newNode",domConfig:e,targetElement:s})}static insertElement(e,t,n,r,i,s,o){var a;const l=o.ns?document.createElementNS(o.ns,e.tag||"svg"):document.createElement(e.tag||"div");t.insertBefore(l,n),oa.performSync(o,l),null!=s&&(i[s]=l),e.role||e["aria-hidden"]||Mr.isFocusable(l,!0)||l.htmlFor||l.setAttribute("role","presentation"),r&&(l.$refOwnerId=r.id,s&&(l.$reference=s,r.attachRef(s,l,e))),null===(a=o.callback)||void 0===a||a.call(o,{action:"newElement",domConfig:e,targetElement:l,syncId:s})}static syncChildren(e,t){var n,r;let i,s,o,{domConfig:a,syncIdField:l,callback:c,releaseThreshold:d,configEquality:u,ns:h,refOwner:g,refsWas:m,strict:p,checkEqualityOptions:f,ignoreRefs:v}=e,y=a.syncOptions||{},b=null;if(null!==(n=a.html)&&void 0!==n?n:a.text)return;v=Boolean(null!==(r=y.ignoreRefs)&&void 0!==r?r:v),v&&(g=m=null),"strict"in y&&(p=y.strict);const C=g?g.byRef:{},w=Go.call(a.children||[]),S=Go.call(t.childNodes),D=m||t.syncIdMap||{},E=t.releasedIdMap||{},x=e=>{for(;S.length&&S[0].parentNode!==t;)S.shift();return(e?S.shift():S[0])||null};l=y.syncIdField||l,p=y.strict||p,c=y.callback||c,u=y.configEquality||u,d="releaseThreshold"in y?y.releaseThreshold:d,l&&(t.syncIdMap=C);const R={checkEqualityOptions:f||na(),ignoreRefs:v,refOwner:g,refsWas:m,strict:p,syncIdField:l,releaseThreshold:d,callback:c,configEquality:u};for(;w.length;){const e=w.shift();if(o=null,!e)continue;if(e instanceof Node){s=x(),e!==s&&t.insertBefore(e,s),i=S.indexOf(e),i>-1&&S.splice(i,1);continue}const n="string"==typeof e;if(R.domConfig=e,R.ns=e.ns||h,!n){if(g?o=e.reference:l&&e.dataset&&(o=e.dataset[l]),null!=o&&!e.unmatched){const n=D[o]||E[o];if(n){const{lastDomConfig:r}=n;if(n.retainElement);else if(oa.performSync(R,n)){var T;null===(T=c)||void 0===T||T({action:"reuseOwnElement",domConfig:e,targetElement:n,lastDomConfig:r,syncId:o})}e.retainElement&&(n.retainElement=!0),C[o]=n,ke.remove(S,n),delete E[o],n.isReleased=!1,s=x(),(n.parentNode!==t||p&&n.nextSibling!==s)&&t.insertBefore(n,s)}else p?oa.insertElement(e,t,x(),g,C,o,R):(w.push(e),e.unmatched=!0);continue}e.unmatched&&delete e.unmatched}let r,a=null,d=null;for(;!d&&(r=x(!0));){if(g){if(r.$refOwnerId!==g.id)continue;if(r.$reference){if(!p)continue;a=r;break}d=r}else r.retainElement||(d=r);d||(b||(b=[])).push(r)}if(a||!d)n?oa.insertTextNode(e,t,c,g,a):oa.insertElement(e,t,a,g,C,o,R);else if(n||d.nodeType!==Node.ELEMENT_NODE||(e.tag||"div").toLowerCase()!==d.tagName.toLowerCase())n&&d.nodeType===Node.TEXT_NODE?d.data=e:(n?oa.insertTextNode(e,t,c,g,d):oa.insertElement(e,t,d,g,C,o,R),d.remove());else{var M,k;const{lastDomConfig:t}=d,n=oa.performSync(R,d);l&&null!=(null==t||null===(M=t.dataset)||void 0===M?void 0:M[l])&&delete E[t.dataset[l]],null!=o&&(C[o]=d),d.isReleased=!1,n&&(null===(k=c)||void 0===k||k({action:"reuseElement",domConfig:e,targetElement:d,lastDomConfig:t,syncId:o}))}}for(;s=x(!0);)g&&(s.$refOwnerId!==g.id||s.$reference)||(b||(b=[])).push(s);b&&oa.syncChildrenCleanup(t,b,C,c,g,d,l)}static syncChildrenCleanup(e,t,n,r,i,s,o){let a,l=0;for(const c of t){const{lastDomConfig:t}=c;c.retainElement?o&&t&&(n[c.dataset[o]]=c):!i&&o&&(null==s||l<s)?(c.isReleased||(c.className="b-released",c.isReleased=!0,null!=t&&t.dataset&&(e.releasedIdMap||(e.releasedIdMap={}),e.releasedIdMap[t.dataset[o]]=c),null==r||r({action:"releaseElement",domConfig:t,lastDomConfig:t,targetElement:c}),t&&(t.isReleased=!0,t.className&&(t.className="b-released"),t.class&&(t.class="b-released"),t.style&&(t.style=null))),l++):(c.remove(),i&&(a=c.$reference,a&&i.detachRef(a,c,t)),e.releasedIdMap&&o&&null!=t&&t.dataset&&delete e.releasedIdMap[t.dataset[o]],null==r||r({action:"removeElement",domConfig:c.lastDomConfig,lastDomConfig:c.lastDomConfig,targetElement:c}))}}static removeChild(e,t){if(e.contains(t)){const n=e.syncIdMap;if(n){const e=Object.values(n).indexOf(t);e>-1&&delete n[Object.keys(n)[e]]}e.removeChild(t)}}static addChild(e,t,n){e.appendChild(t),e.syncIdMap||(e.syncIdMap={}),e.syncIdMap[n]=t}static getChild(e,t){const n=String(t).split(".");for(const t of n){var r,i;if(!(e=null===(r=e)||void 0===r||null===(i=r.syncIdMap)||void 0===i?void 0:i[t]))return null}return e}}oa._$name="DomSync";class aa{static init(){const e=["fullscreenEnabled","requestFullscreen","exitFullscreen","fullscreenElement"],t=t=>e.map((e=>{let n=t+_.capitalize(e);return"moz"===t&&(n=n.replace("screen","Screen"),"mozCancelFullScreen"in document&&"exitFullscreen"===e&&(n="mozCancelFullScreen")),n}));this.functions="fullscreenEnabled"in document&&e||"webkitFullscreenEnabled"in document&&t("webkit")||"mozFullScreenEnabled"in document&&t("moz")||"msFullscreenEnabled"in document&&t("ms")||[];const n=["fullscreenchange","fullscreenerror"],r=e=>n.map((t=>e+_.capitalize(t)));this.events="fullscreenEnabled"in document&&n||"webkitFullscreenEnabled"in document&&r("webkit")||"mozFullscreenEnabled"in document&&r("moz")||"msFullscreenEnabled"in document&&["MSFullscreenChange","MSFullscreenError"]||[]}static get enabled(){return Boolean(this.functions[0]&&document[this.functions[0]])}static async request(e){return this.functions[1]&&(null==e?void 0:e[this.functions[1]]())}static async exit(){return this.functions[2]&&document[this.functions[2]]()}static get isFullscreen(){return!!this.element}static get element(){return this.functions[3]&&document[this.functions[3]]}static onFullscreenChange(e){this.events[0]&&document.addEventListener(this.events[0],e)}static unFullscreenChange(e){this.events[0]&&document.removeEventListener(this.events[0],e)}}aa.init(),aa._$name="Fullscreen";let la=null;const ca=[],da=e=>{var t;return e.nodeType===e.ELEMENT_NODE&&"absolute"===(null===(t=e.ownerDocument.defaultView)||void 0===t?void 0:t.getComputedStyle(e).getPropertyValue("position"))};class ua{static addResizeListener(e,t){const n=this;if(e!==document&&e!==globalThis||(e=document.body),e.nodeType===e.DOCUMENT_FRAGMENT_NODE&&(e=e.host),e.classList.contains("b-resize-monitored")||(e.classList.add("b-resize-monitored"),e._bResizemonitor={handlers:[]}),e===document.body)n.hasWindowResizeListener||(globalThis.addEventListener("resize",n.onWindowResize),n.hasWindowResizeListener=!0);else if(globalThis.ResizeObserver)n.resizeObserver||(n.resizeObserver=new ResizeObserver(n.onElementResize)),n.resizeObserver.observe(e);else{e.classList.add("b-no-resizeobserver");const[r,i,s]=Mr.createElement({parent:e,className:"b-resize-monitors",children:[{className:"b-resize-monitor-expand"},{className:"b-resize-monitor-shrink"}]},{returnAll:!0});i.scrollLeft=i.scrollTop=s.scrollLeft=s.scrollTop=1e6,i.addEventListener("scroll",n.onSizeMonitorScroll,!0),s.addEventListener("scroll",n.onSizeMonitorScroll,!0),(t.targetMutationMonitor=new MutationObserver((e=>{const t=[],n=[];for(const r of e)"childList"===r.type&&(t.push.apply(t,r.addedNodes),n.push.apply(n,r.removedNodes));const r=[...t.filter((e=>!n.includes(e))),...n.filter((e=>!t.includes(e)))];0!==r.length&&(r.length>0&&r.every(da)||i.dispatchEvent(new CustomEvent("scroll",{bubbles:!1})))}))).observe(e,{childList:!0,subtree:!0}),t.monitorElement=r}e._bResizemonitor.handlers.push(t)}static removeResizeListener(e,t){if(e){e!==document&&e!==globalThis||(e=document.body);const n=e._bResizemonitor;let r=0;n&&n.handlers&&(ke.remove(n.handlers,t),r=n.handlers.length),r||(e.classList.remove("b-resize-monitored"),this.resizeObserver?this.resizeObserver.unobserve(e):(t.monitorElement&&(t.monitorElement.remove(),t.monitorElement=null),t.targetMutationMonitor&&t.targetMutationMonitor.disconnect()))}}static onElementResize(e){for(const t of e){const e=t.target,n=e._bResizemonitor,r=t.contentRect||e.getBoundingClientRect();if(pr(e)&&(!n.rectangle||r.width!==n.rectangle.width||r.height!==n.rectangle.height)){const t=n.rectangle;n.rectangle=r;for(const i of n.handlers)i(e,t,r)}}}static onSizeMonitorScroll(e){var t;if(null!==(t=document.body)&&void 0!==t&&t.contains(e.target)){e.stopImmediatePropagation();const t=e.target.parentNode,n=t.parentNode,r=n._bResizemonitor,i=n.getBoundingClientRect();r.rectangle&&i.width===r.rectangle.width&&i.height===r.rectangle.height||(ca.push([n,r.rectangle,i]),r.rectangle=i,la||(la=requestAnimationFrame(ua.fireResizeEvents))),t.firstChild.scrollLeft=t.firstChild.scrollTop=t.childNodes[1].scrollTop=t.childNodes[1].scrollLeft=1e6}}static onWindowResize(e){const t=document.body,n=t._bResizemonitor,r=n.rectangle;n.rectangle=document.documentElement.getBoundingClientRect();for(const e of n.handlers)e(t,r,n.rectangle)}static fireResizeEvents(){for(const e of ca)for(const t of e[0]._bResizemonitor.handlers)e[0].offsetParent&&t.apply(this,e);la=null,ca.length=0}}ua._$name="ResizeMonitor";const ha={auto:"auto",true:"auto",false:"hidden","hidden-scroll":"auto",clip:y.supportsOverflowClip?"clip":"hidden"},ga="b-widget-scroller",ma={block:"nearest"},pa=Promise.resolve(),fa=e=>new Promise((t=>_n.on({element:e,scroll:t,once:!0}))),va={x:1},ya={auto:1,scroll:1},ba={true:1,auto:1},Ca={overflowX:"auto",overflowY:"auto"};class wa extends(Zr(tt(Te))){static get configurable(){return{widget:null,element:{$config:{nullify:!0},value:null},contentElement:{$config:{nullify:!0},value:null},overflowX:null,overflowY:null,translate:null,x:0,y:0,rtlSource:null}}static get delayable(){return{onScrollEnd:{type:"buffer",delay:100}}}get isRTL(){var e;return Boolean(null===(e=this.rtlSource)||void 0===e?void 0:e.rtl)}syncOverflowState(){const e=this,{element:t}=e,n=new Mn(t.classList),r=e.hasOverflowX=t.scrollWidth>t.clientWidth,i=e.hasOverflowY=t.scrollHeight>t.clientHeight;n.value=t.classList,(n.toggle("b-horizontal-overflow",r)||n.toggle("b-vertical-overflow",i))&&(Mr.syncClassList(t,n),e.isConfiguring||e.trigger("overflowChange",{x:r,y:i}))}hasOverflow(e="y"){const t=this[`overflow${e.toUpperCase()}`],n=this["overflow"+("y"===e?"x":"y")];if(Mr.scrollBarWidth&&ba[t]&&"hidden-scroll"!==n&&!y.isFirefox)return this[`hasOverflow${e.toUpperCase()}`];{const t="y"===e?"Height":"Width";return this[`scroll${t}`]>this[`client${t}`]}}hasScrollbar(e="y"){const{element:t}=this;if(t&&Mr.scrollBarWidth){const n="y"===e,r=n?"Width":"Height",i=t[`client${r}`],s=parseInt(Mr.getStyleValue(t,`border${n?"Left":"Top"}Width`))+parseInt(Mr.getStyleValue(t,`border${n?"Right":"Bottom"}Width`)),o=t[`offset${r}`]-s-i;return Math.abs(o-Mr.scrollBarWidth)<2}}addPartner(e,t=va){const n=this;"string"==typeof t&&(t={[t]:1}),n.partners||(n.partners={}),n.partners[e.id]={scroller:e,axes:t},t.x&&(e.x=n.x),t.y&&(e.y=n.y),e.isPartneredWith(n)||e.addPartner(n,t)}eachPartner(e){const{partners:t}=this;t&&Object.values(t).forEach(e)}removePartner(e){this.isPartneredWith(e)&&(delete this.partners[e.id],e.removePartner(this))}isPartneredWith(e){var t;return Boolean(null===(t=this.partners)||void 0===t?void 0:t[e.id])}clearPartners(){this.partners&&Object.values(this.partners).forEach((e=>e.scroller.removePartner(this)))}async scrollIntoView(e,t=ma){const n=this,{isRectangle:r}=e,i=r?e:xn.from(e),{xDelta:s,yDelta:o}=n.getDeltaTo(e,t),a=n.scrollBy(s,o,t);return(t.highlight||t.focus)&&a.then((()=>{r&&(e=i.translate(-s,-o)),t.highlight&&(isNaN(t.highlight)?(n.widget||n).callback(t.highlight,null,[e]):Mr.highlight(e,n)),t.focus&&Mr.focusWithoutScrolling(e)})),a}static async scrollIntoView(e,t=ma,n=!1){const r=xn.from(e),i="object"==typeof t?t.animate:t,s=wa._globalScroller||(wa._globalScroller=new wa),o=[];s.rtlSource={rtl:n};let a,l=0,c=0;for(let n=e.parentNode;n.nodeType===Node.ELEMENT_NODE;n=n.parentNode){if(n===document.body&&n!==document.scrollingElement)continue;const e=n===document.scrollingElement?Ca:n.ownerDocument.defaultView.getComputedStyle(n);if(!1!==t.y&&ya[e.overflowY]&&n.scrollHeight>n.clientHeight||!1!==t.x&&ya[e.overflowX]&&n.scrollWidth>n.clientWidth){s.element=n,s.positionDirty=!0;const{xDelta:e,yDelta:i}=s.getDeltaTo(r,t);(e||i)&&(o.push({element:n,x:n.scrollLeft,y:n.scrollTop,xDelta:e,yDelta:i}),r.translate(-e,-i),l+=e,c+=i)}}if(o.length){const e=Math.abs(l),t=Math.abs(c);let r=i&&("number"==typeof i?i:"number"==typeof i.duration?i.duration:300);if(r&&(e>10||t>10))Math.max(e,t)<50&&(r=Math.min(r,500)),a=s.scrollAnimation=$e.animate(r,(e=>{const t=1===e;for(const{element:r,x:i,y:a,xDelta:l,yDelta:c}of o)s.element=r,l&&(s.x=Math[n?"min":"max"](i+(t?l:Math.round(l*e)),0)),c&&(s.y=Math.max(a+(t?c:Math.round(c*e)),0))}),null,i.easing),a.then((()=>{s.scrollAnimation=null}));else{for(const{element:e,xDelta:t,yDelta:n}of o)e.scrollTop+=n,e.scrollLeft+=t;a=fa(o[o.length-1].element)}}else a=pa;return(t.highlight||t.focus)&&a.then((()=>{t.highlight&&(isNaN(t.highlight)?s.callback(t.highlight,null,[e]):Mr.highlight(e,s)),t.focus&&e.focus()})),a}async scrollBy(e=0,t=0,n=ma){const r=this,i="object"==typeof n?n.animate:n,s=Math.abs(e),o=Math.abs(t);r.scrollAnimation&&(r.scrollAnimation.cancel(),r.scrollAnimation=null),(e||t)&&(r.silent=n.silent);let a=i&&("number"==typeof i?i:"number"==typeof i.duration?i.duration:300);if(a&&(s>10||o>10)){const{x:l,y:c}=r;let d=l,u=c;return Math.max(s,o)<50&&(a=Math.min(a,500)),r.scrollAnimation=$e.animate(a,(i=>{const s=1===i;if(e){var o;if(r.x!==d&&!n.force)return null===(o=r.scrollAnimation)||void 0===o?void 0:o.cancel();r.x=Math.max(l+(s?e:Math.round(e*i)),0)}if(t){var a;if(r.y!==u&&!n.force)return null===(a=r.scrollAnimation)||void 0===a?void 0:a.cancel();r.y=Math.max(c+(s?t:Math.round(t*i)),0)}d=r.x,u=r.y}),r,i.easing),r.element.classList.add("b-scrolling"),r.scrollAnimation.then((()=>{r.isDestroyed||(r.element.classList.remove("b-scrolling"),r.scrollAnimation=null)})),r.scrollAnimation}if(e|t){const n=r.x,i=r.y;if(r.x+=e,r.y+=t,r.x!==n||r.y!==i)return fa(r.element)}return pa}async scrollTo(e,t,n){const{x:r,y:i}=this,s=null==e?0:e-r,o=null==t?0:t-i;return this.scrollBy(s,o,n)}doDestroy(){var e;const t=this;var n;t._element&&(t._element.removeEventListener("scroll",t.scrollHandler),null===(n=t.wheelListenerRemover)||void 0===n||n.call(t)),null===(e=t.scrollAnimation)||void 0===e||e.cancel(),Object.values(t.partners||{}).forEach((({scroller:e})=>e.removePartner(t))),super.doDestroy()}onElMutation(e){const t=this,[n,r]=Mr.getTranslateXY(t.element);if(t._x!==-n||t.y!==-r){const e=new CustomEvent("scroll",{bubbles:!0});Object.defineProperty(e,"target",{get:()=>t.element}),t.onScroll(e)}}onElResize(){const e=this,{widget:t}=e;null!=t&&t.isAnimating?-1===t.findListener("animationend","onElResize",e)&&t.on({animationEnd:"onElResize",thisObj:e,once:!0}):e.syncOverflowState()}onScroll(e){const t=this,{_x:n,_y:r,element:i}=t;let s=0;"clip"===t.overflowX&&i.scrollLeft!==n&&(i.scrollLeft=n,++s),"clip"===t.overflowY&&i.scrollTop!==r&&(i.scrollTop=r,++s),2!==s&&(t.widget&&t.widget.isDestroyed||(t.positionDirty=!0,i.classList.contains("b-scrolling")||i.classList.add("b-scrolling"),e.widget=t.widget,t.silent||t.trigger("scroll",e),t.syncPartners(),t.controllingPartner=null,t.onScrollEnd(e)))}syncPartners(e,t){const n=this;n.partners&&Object.values(n.partners).forEach((({axes:r,scroller:i})=>{(i!==n.controllingPartner||e)&&i.sync(n,r)&&t&&i.syncPartners(e,t)}))}onScrollEnd(e){const t=this;t.silent&&(t.silent=!1),t.trigger("scrollEnd",e),t.controllingPartner=null,t.element.classList.remove("b-scrolling")}getDeltaTo(e,t){const n=this;if(!n.viewport)return{xDelta:0,yDelta:0};const{x:r,y:i,scrollWidth:s,scrollHeight:o,isRTL:a}=n,l=e instanceof xn?e:xn.from(e),c=t.block||"nearest",d=n.viewport,u=(e=>{let t,n,r,i;if(e)if("number"==typeof e)t=n=r=i=e;else{var s,o,a,l;t=null!==(s=e.top)&&void 0!==s?s:0,n=null!==(o=e.bottom)&&void 0!==o?o:0,r=null!==(a=e.start)&&void 0!==a?a:0,i=null!==(l=e.end)&&void 0!==l?l:0}else t=n=r=i=0;return{top:t,bottom:n,start:r,end:i}})(t.edgeOffset),h=d.width>=l.width+(u.start+u.end)?u:{start:0,end:0},g=d.height>=l.height+(u.top+u.bottom)?u:{top:0,bottom:0},m=new xn(a?d.right- -r-s:d.x-r,d.y-i,s,o),p=l.clone().adjust(-h.start,-g.top,h.end,g.bottom).constrainTo(m),f=p.clone(),v=n.isRTL?-1:1;let y=0,b=0;if("start"===c)f.moveTo(d.x,d.y),y=p.x-f.x,b=p.y-f.y;else if("end"===c)f.translate(d.right-f.right,d.bottom-f.bottom),y=p.x-f.x,b=p.y-f.y;else if("center"===c){const e=d.center;f.moveTo(e.x-f.width/2,e.y-f.height/2),y=y||p.x-f.x,b=b||p.y-f.y}else f.width>d.width?y=f.x-d.x:f.right>d.right?y=f.right-d.right:f.x<d.x&&(y=f.x-d.x),f.height>d.height?b=f.y-d.y:f.bottom>d.bottom?b=f.bottom-d.bottom:f.y<d.y&&(b=f.y-d.y);return y=v*Math.round(y),b=Math.round(b),{xDelta:!1===t.x?0:Math.max(Math.min(y,n.maxX-r),-r),yDelta:!1===t.y?0:Math.max(Math.min(b,n.maxY-i),-i)}}get viewport(){return xn.client(this.element)}updateWidget(e){this.rtlSource=this.owner=e}updateElement(e,t){const n=this;if(n===wa._globalScroller)return n._element=e,void(n.positionDirty=!0);const r=n.scrollHandler||(n.scrollHandler=n.onScroll.bind(n)),i=n.resizeHandler||(n.resizeHandler=n.onElResize.bind(n));var s;t&&(n.translate?null===(s=n.mutationObserver)||void 0===s||s.disconnect(t):(t.removeEventListener("scroll",r),t.classList.remove(ga),t.style.overflowX=t.style.overflowY=""),ua.removeResizeListener(t,i));if(e){if(n.translate){if(n.mutationObserver||(n.mutationObserver=new MutationObserver(n.mutationHandler||(n.mutationHandler=n.onElMutation.bind(n)))),n._x=n._y=0,document.contains(e)){const[t,r]=Mr.getTranslateXY(e);n._x=-t,n._y=-r}n.mutationObserver.observe(e,{attributes:!0})}else e.addEventListener("scroll",r),e.classList.add(ga);ua.addResizeListener(e,i),n.widget||(n.rtlSource={get rtl(){return"rtl"===Mr.getStyleValue(e,"direction")}}),n.isRTL&&e.classList.add("b-rtl"),n.positionDirty&&(n.updateOverflowX(n.overflowX),n.updateOverflowY(n.overflowY)),n.syncOverflowState(),n.isConfiguring&&(n._x&&n.updateX(n._x),n._y&&n.updateY(n._y))}n.positionDirty=!0}get x(){const e=this,{element:t}=e;if(t&&e.positionDirty){if(e.translate){const[n,r]=Mr.getTranslateXY(t);e._x=-n,e._y=-r}else e._x=Math.abs(t.scrollLeft),e._y=t.scrollTop;e.positionDirty=!1}return e._x}get scrollLeft(){return this.element.scrollLeft}changeX(e){if(e=Math.max(e,0),!this.isConfiguring||e)return e;this._x=e}updateContentElement(e){e&&(e="string"==typeof e?this.element.querySelector(e):e,ua.addResizeListener(e,this.resizeHandler))}updateX(e){var t;const{element:n}=this;!n||null!==(t=this.widget)&&void 0!==t&&t.isConfiguring||(this.trigger("scrollStart",{x:e}),this.translate?Mr.setTranslateX(n,-e):n.scrollLeft=this.isRTL?-e:e),this.positionDirty=!0}sync(e,t){const n=this,{x:r,y:i}=t;let s=!1;return null!=r&&n.x!==e.x&&(n.controllingPartner=e,n.x=e.x,s=!0),null!=i&&n.y!==e.y&&(n.controllingPartner=e,n.y=e.y,s=!0),s}get y(){const e=this,{element:t}=e;if(t&&e.positionDirty){if(e.translate){const[n,r]=Mr.getTranslateXY(t);e._x=-n,e._y=-r}else e._x=t.scrollLeft,e._y=t.scrollTop;e.positionDirty=!1}return e._y}changeY(e){if(!this.isConfiguring||e)return e;this._y=e}updateY(e){const{element:t,widget:n}=this;!t||null!=n&&n.isConfiguring||(this.trigger("scrollStart",{y:e}),this.translate?Mr.setTranslateY(t,-e):t.scrollTop=e),this.positionDirty=!0}get maxX(){return this.scrollWidth-this.clientWidth}get maxY(){return this.scrollHeight-this.clientHeight}get lastScrollLeft(){return(this.scrollWidth-this.clientWidth)*(this.isRTL?-1:1)}updateOverflowX(e,t){const n=this,{element:r,translate:i}=n,{style:s,classList:o}=r;"hidden-scroll"===t&&o.remove("b-hide-scroll"),"hidden-scroll"!==e||i||(ya[s.overflowY]?(e="hidden",n.enableWheel()):o.add("b-hide-scroll")),i||(s.overflowX=ha[e]||e),n.isConfiguring||(n.positionDirty=!0,n.syncOverflowState())}updateOverflowY(e,t){const n=this,{element:r,translate:i}=n,{style:s,classList:o}=r;"hidden-scroll"===t&&o.remove("b-hide-scroll"),"hidden-scroll"!==e||i||(ya[s.overflowX]?(e="hidden",n.enableWheel()):o.add("b-hide-scroll")),i||(s.overflowY=ha[e]||e),n.isConfiguring||(n.positionDirty=!0,n.syncOverflowState())}enableWheel(){this.wheelListenerRemover||(this.wheelListenerRemover=_n.on({element:this.element,wheel:"onWheel",thisObj:this}))}onWheel(e){Math.abs(e.deltaX)>Math.abs(e.deltaY)&&"hidden-scroll"===this.overflowX?this.x+=e.deltaX:"hidden-scroll"===this.overflowY&&(this.y+=e.deltaY)}get scrollWidth(){var e,t;return null!==(e=null===(t=this.element)||void 0===t?void 0:t.scrollWidth)&&void 0!==e?e:0}set scrollWidth(e){const t=this,{element:n,isRTL:r}=t;let i=t.widthStretcher;i&&null==e?(i.remove(),t.widthStretcher=null):e&&(e=Math.abs(e),i||(i=t.widthStretcher=Mr.createElement({className:"b-scroller-stretcher b-horizontal-stretcher",retainElement:!0})),i.style.transform=`translateX(${(e-1)*(r?-1:1)}px)`,n&&!n.contains(i)&&n.insertBefore(i,n.firstElementChild)),!1!==t.propagate&&t.eachPartner((({scroller:t})=>{t.propagate=!1,t.scrollWidth=e,delete t.propagate})),t.positionDirty=!0,t.syncOverflowState()}get scrollHeight(){var e,t;return null!==(e=null===(t=this.element)||void 0===t?void 0:t.scrollHeight)&&void 0!==e?e:0}set scrollHeight(e){const t=this,n=t.stretcher||(t.stretcher=Mr.createElement({className:"b-scroller-stretcher"}));n.style.transform=`translateY(${e-1}px)`,t.element&&t.element.lastChild!==n&&t.element.appendChild(n),t.positionDirty=!0,t.syncOverflowState()}get clientWidth(){var e;return(null===(e=this.element)||void 0===e?void 0:e.clientWidth)||0}get clientHeight(){var e;return(null===(e=this.element)||void 0===e?void 0:e.clientHeight)||0}get id(){return this._id||(this.widget?this._id=`${this.widget.id}-scroller`:this._id=Yi.generateId("scroller-")),this._id}preProcessCurrentConfigs(e){super.preProcessCurrentConfigs(),delete e.widget,delete e.element}}wa._$name="Scroller";const Sa="English",Da={localeName:"En",localeDesc:Sa,Object:{Yes:"Yes",No:"No",Cancel:"Cancel",Ok:"OK",Week:"Week"},Combo:{noResults:"No results",recordNotCommitted:"Record could not be addded",addNewValue:e=>`Add ${e}`},FilePicker:{file:"File"},Field:{badInput:"Invalid field value",patternMismatch:"Value should match a specific pattern",rangeOverflow:e=>`Value must be less than or equal to ${e.max}`,rangeUnderflow:e=>`Value must be greater than or equal to ${e.min}`,stepMismatch:"Value should fit the step",tooLong:"Value should be shorter",tooShort:"Value should be longer",typeMismatch:"Value is required to be in a special format",valueMissing:"This field is required",invalidValue:"Invalid field value",minimumValueViolation:"Minimum value violation",maximumValueViolation:"Maximum value violation",fieldRequired:"This field is required",validateFilter:"Value must be selected from the list"},DateField:{invalidDate:"Invalid date input"},DatePicker:{gotoPrevYear:"Go to previous year",gotoPrevMonth:"Go to previous month",gotoNextMonth:"Go to next month",gotoNextYear:"Go to next year"},NumberFormat:{locale:"en-US",currency:"USD"},DurationField:{invalidUnit:"Invalid unit"},TimeField:{invalidTime:"Invalid time input"},TimePicker:{hour:"Hour",minute:"Minute",second:"Second"},List:{loading:"Loading..."},GridBase:{loadMask:"Loading...",syncMask:"Saving changes, please wait..."},PagingToolbar:{firstPage:"Go to first page",prevPage:"Go to previous page",page:"Page",nextPage:"Go to next page",lastPage:"Go to last page",reload:"Reload current page",noRecords:"No records to display",pageCountTemplate:e=>`of ${e.lastPage}`,summaryTemplate:e=>`Displaying records ${e.start} - ${e.end} of ${e.allCount}`},PanelCollapser:{Collapse:"Collapse",Expand:"Expand"},Popup:{close:"Close"},UndoRedo:{Undo:"Undo",Redo:"Redo",UndoLastAction:"Undo last action",RedoLastAction:"Redo last undone action",NoActions:"No items in the undo queue"},FieldFilterPicker:{equals:"equals",doesNotEqual:"does not equal",isEmpty:"is empty",isNotEmpty:"is not empty",contains:"contains",doesNotContain:"does not contain",startsWith:"starts with",endsWith:"ends with",isOneOf:"is one of",isNotOneOf:"is not one of",isGreaterThan:"is greater than",isLessThan:"is less than",isGreaterThanOrEqualTo:"is greater than or equal to",isLessThanOrEqualTo:"is less than or equal to",isBetween:"is between",isNotBetween:"is not between",isBefore:"is before",isAfter:"is after",isToday:"is today",isTomorrow:"is tomorrow",isYesterday:"is yesterday",isThisWeek:"is this week",isNextWeek:"is next week",isLastWeek:"is last week",isThisMonth:"is this month",isNextMonth:"is next month",isLastMonth:"is last month",isThisYear:"is this year",isNextYear:"is next year",isLastYear:"is last year",isYearToDate:"is year to date",isTrue:"is true",isFalse:"is false",selectAProperty:"Select a property",selectAnOperator:"Select an operator",caseSensitive:"Case-sensitive",and:"and",dateFormat:"D/M/YY",selectOneOrMoreValues:"Select one or more values",enterAValue:"Enter a value",enterANumber:"Enter a number",selectADate:"Select a date"},FieldFilterPickerGroup:{addFilter:"Add filter"},DateHelper:{locale:"en-US",weekStartDay:0,nonWorkingDays:{0:!0,6:!0},weekends:{0:!0,6:!0},unitNames:[{single:"millisecond",plural:"ms",abbrev:"ms"},{single:"second",plural:"seconds",abbrev:"s"},{single:"minute",plural:"minutes",abbrev:"min"},{single:"hour",plural:"hours",abbrev:"h"},{single:"day",plural:"days",abbrev:"d"},{single:"week",plural:"weeks",abbrev:"w"},{single:"month",plural:"months",abbrev:"mon"},{single:"quarter",plural:"quarters",abbrev:"q"},{single:"year",plural:"years",abbrev:"yr"},{single:"decade",plural:"decades",abbrev:"dec"}],unitAbbreviations:[["mil"],["s","sec"],["m","min"],["h","hr"],["d"],["w","wk"],["mo","mon","mnt"],["q","quar","qrt"],["y","yr"],["dec"]],parsers:{L:"MM/DD/YYYY",LT:"HH:mm A",LTS:"HH:mm:ss A"},ordinalSuffix:e=>{let t="th";return["11","12","13"].find((t=>e.endsWith(t)))||(t={1:"st",2:"nd",3:"rd"}[e[e.length-1]]||"th"),e+t}}};lt.registerLocale("En",{desc:Sa,locale:Da});class Ea{constructor(e){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t})),e&&e(this)}}Ea._$name="Promissory";const{defineProperty:xa}=Reflect;class Ra extends(Te.mixin(pt,tt,Zr,ci)){static get configurable(){return{element:null}}static get delayable(){return{refreshDom:"raf"}}static get identifiable(){return{}}static get renderConfigs(){const e=this,t=e.$meta;let n,r,i=t.renderConfigs;if(void 0===i){for(r in i=null,n=t.configs,n)n[r].render&&(i||(i=new Set)).add(r);t.renderConfigs=e.prototype.$renderConfigs=i}return i}construct(...e){this.$iid=++Ra.$idSeed,this.byRef={},super.construct(...e),this.onDraw!==Ra.prototype.onDraw&&this.initDrawable()}startConfigure(e){this.element=this.renderContext.renderDom(),super.startConfigure(e)}get element(){return this.refreshDom.flush(),this._element}changeElement(e,t){return t&&t.remove(),e&&(e.id=this.id,e=Mr.createElement(e,{refOwner:this})),e}updateId(e,t){const n=this;if(t){const r=n.element;r.id=e,n.fixRefOwnerId(r,e,t)}}get classes(){return this.element.classList}fixRefOwnerId(e,t,n){if(e.$refOwnerId===n){e.$refOwnerId=t;const r=e.$reference;r&&(e.id=`${t}-${r}`);for(const r of e.childNodes)this.fixRefOwnerId(r,t,n)}}onConfigChange({name:e}){!this.isConfiguring&&this.$renderConfigs.has(e)&&this.refreshDom()}attachRef(e,t,n){const r=this,i="_"+e,{listeners:s}=n;i in r||xa(r,e,{get(){return r.refreshDom.flush(),r[i]},set(e){r[i]=e}}),t.id=`${r.id}-${e}`,r.byRef[e]=t,r[e]=t,s&&(n.listeners={on:s,un:_n.on(Object.assign({element:t,thisObj:r},s))})}detachRef(e,t,n){n.listeners&&(n.listeners.un(),n.listeners=null),this[e]=null,delete this.byRef[e]}renderDom(){return{}}get renderContext(){const e=this,t=e.$meta,n=e.constructor;let r=t.renderConfigs||n.renderConfigs,i=e;if(!r){i=Object.create(e),r=new Set;for(const n in t.configs)xa(i,n,{get(){return r.add(n),e[n]}});i.renderDom=()=>e.renderDom.call(i),e.$renderConfigs=r}return xa(e,"renderContext",{value:i}),i}refreshDom(){oa.sync({targetElement:this.element,domConfig:this.renderContext.renderDom(),refOwner:this,strict:!0})}onListen(e){"draw"===e&&this.initDrawable()}initDrawable(){const e=this;if(!e.intersector){let t=Object.values(e.byRef).find((e=>e.classList.contains("b-drawable")));t||(t=e.element,t.classList.add("b-drawable")),e.intersector=new IntersectionObserver((t=>{e.isDestroyed||t.forEach((t=>{t.isIntersecting&&e.onDraw({count:++e.drawCounter})}))})),e.intersector.observe(t)}}onDraw(e){this.trigger("draw",e)}}Ra.$idSeed=0,Object.assign(Ra.prototype,{drawCounter:0,hasGeneratedId:!1,intersector:null}),Ra._$name="Renderable";class Ta extends Ra{static get $name(){return"Mask"}static get type(){return"mask"}static get configurable(){return{autoClose:null,cover:null,icon:"b-icon b-icon-spinner",errorDefaults:{icon:"b-icon b-icon-warning",autoClose:3e3,showDelay:0},maxProgress:null,mode:"dark",progress:null,owner:{$config:"nullify",value:null},target:null,text:null,type:null,showDelay:null,useTransition:!1}}static get delayable(){return{deferredClose:0,delayedShow:0,syncCover:{type:"throttle",delay:100}}}construct(e){if(e){let t,n=e.element;n&&(K.deprecate("Core","4.0.0",'Mask "element" config has been renamed to "target"'),e=t=Object.assign({},e),delete t.element,t.target=n),n=e.target,"string"==typeof n&&(e=t=t||Object.assign({},e),t.target=e.owner[n])}super.construct(e),this.target||(this.target=document.body),this.show()}doDestroy(){const e=this,{element:t}=e;if("trial"===e.type)return!1;t&&(e.element=null,e.mode.endsWith("blur")&&Mr.forEachChild(t,(t=>{t.classList.remove(`b-masked-${e.mode}`)})),e.target.classList.remove("b-masked"),e.target[e.maskName]=null),super.doDestroy()}get maskElement(){return this.element}get maskName(){const e=this.type;return`mask${"string"==typeof e?e.trim():""}`}set error(e){this.setConfig(this.errorDefaults),this.text=e}renderDom(){const e=this,{maxProgress:t}=e;return{class:{"b-mask":1,"b-delayed-show":e.showDelay,"b-widget":1,[`b-mask-${e.mode}`]:1,"b-progress":t,"b-prevent-transitions":!e.useTransition},children:[{reference:"maskContent",class:"b-mask-content b-drawable",children:[t?{reference:"progressElement",class:"b-mask-progress-bar",style:{width:`${Math.max(0,Math.min(100,Math.round(e.progress/t*100)))}%`}}:null,{reference:"maskText",class:"b-mask-text",html:(e.icon?`<i class="b-mask-icon ${e.icon}"></i>`:"")+e.text}]}]}}static mergeConfigs(...e){const t={};for(const n of e)"string"==typeof n?t.text=n:sn.assign(t,n);return t}static mask(e,t=document.body){return Ta.new({target:t},"string"!=typeof e?f({},e):{text:e})}static unmask(e=document.body){var t;return null===(t=e.mask)||void 0===t?void 0:t.close()}updateAutoClose(e){const t=this;t.deferredClose.cancel(),e&&(t.deferredClose.delay=e,t.deferredClose())}updateCover(){this.syncCover()}syncCover(){var e,t;null===(e=this.owner)||void 0===e||null===(t=e.syncMaskCover)||void 0===t||t.call(e,this)}onOwnerResize(){this.syncCover()}updateOwner(e){this.detachListeners("cover"),null==e||e.on({name:"cover",recompose:"onOwnerResize",resize:"onOwnerResize",thisObj:this})}updateShowDelay(e){const{delayedShow:t}=this;t.delay=e,e||t.flush()}deferredClose(){var e;const{owner:t}=this;this.close().then((()=>{var e;null==t||null===(e=t.onMaskAutoClose)||void 0===e||e.call(t,this)})),null==t||null===(e=t.onMaskAutoClosing)||void 0===e||e.call(t,this)}delayedShow(){this.classes.remove("b-delayed-show")}show(){const e=this,{element:t,target:n,hiding:r,maskName:i}=e;r&&(r.resolve(),e.hiding=null,e.clearTimeout("hide")),e.showDelay&&(t.classList.add("b-delayed-show"),e.delayedShow()),t.classList.add("b-visible"),t.classList.remove("b-hidden"),n.classList.add("b-masked"),n[i]||(n[i]=e,n.appendChild(t)),e.shown=!0,e.trigger("show"),e.mode.endsWith("blur")&&Mr.forEachChild(n,(n=>{n!==t&&n.classList.add(`b-masked-${e.mode}`)}))}hide(){const e=this,{target:t,element:n}=e;let{hiding:r}=e;if(!r){if(!e.shown)return Promise.resolve();e.hiding=r=new Ea,e.shown=!1,n.classList.remove("b-visible"),n.classList.add("b-hidden"),t.classList.remove("b-masked"),e.mode.endsWith("blur")&&Mr.forEachChild(t,(t=>{t!==n&&t.classList.remove(`b-masked-${e.mode}`)})),r.promise=r.promise.then((()=>{e.hiding===r&&(e.hiding=null)})),e.setTimeout((()=>r.resolve()),500,"hide")}return r.promise}async close(){await this.hide(),this.destroy()}}Ta._$name="Mask";var Ma=e=>{var t;return t=class extends(e||Te){get widgetClass(){}get keyMapElement(){return this.element}get keyMapSubComponents(){return this.features}performKeyMapAction(e){const{keyMap:t}=this;let n=!1;if(t&&!e.handled){const i=sn.keys(t).find((t=>{const n=t.split("+"),r=n.includes("Alt"),i=n.includes("Shift"),s=n.includes("Ctrl");let o=n[n.length-1].toLowerCase();return"space"===o&&(o=" "),o===e.key.toLowerCase()&&(!e.altKey&&!r||e.altKey&&r)&&(!e.ctrlKey&&!s||e.ctrlKey&&s)&&(!e.shiftKey&&!i||e.shiftKey&&i)}));if(t[i]){const s=ke.asArray(t[i]);let o;for(let t of s){if(o=!0,sn.isObject(t)){if(!t.handler)continue;!1===t.preventDefault&&(o=!1),t=t.handler}if("string"==typeof t){var r;const{thisObj:s,handler:o}=this.resolveKeyMapAction(t);if(!1!==(null===(r=s.isActionAvailable)||void 0===r?void 0:r.call(s,i,t,e))&&!1!==o.call(s,e)){n=!0;break}}else if(!1!==t.call(this)){n=!0;break}}n&&(o&&e.preventDefault(),e.handled=!0)}}return n}resolveKeyMapAction(e){const{keyMapSubComponents:t}=this;if(t&&e.includes(".")){const[n,r]=e.split(".");if(n&&r)return{thisObj:t[n],handler:t[n][r]}}return{thisObj:this,handler:this[e]}}updateKeyMap(e){var t;null===(t=this.keyMapDetacher)||void 0===t||t.call(this),sn.isEmpty(e)||(this.keyMapDetacher=_n.on({element:this.keyMapElement,keydown:"keyMapOnKeyDown",thisObj:this}))}keyMapOnKeyDown(e){this.performKeyMapAction(e)}mergeKeyMaps(e,t,n=null){const r={};e&&sn.assign(r,e);for(const s in t){if(!t[s])continue;let o;o=sn.isObject(t[s])&&t[s].handler?sn.assignIf({handler:(n?n+".":"")+t[s].handler},t[s]):(n?n+".":"")+t[s];const a=null==e?void 0:e[s];if(a){var i;const e=ke.asArray(a),t=sn.isObject(o)&&null!==(i=o.weight)&&void 0!==i?i:0;if(t){let n=e.findIndex((e=>(null==e?void 0:e.weight)>t));n<0&&(n=e.length),e.splice(n,0,o)}else null==e||e.unshift(o);r[s]=e}else r[s]=o}return r}},v(t,"$name","KeyMap"),v(t,"configurable",{keyMap:{value:null,$config:{merge:"objects",nullify:!0}}}),t},ka=e=>{var t;return t=class extends(e||Te){get widgetClass(){}updateRtl(e){const{element:t}=this;t&&(t.classList.toggle("b-rtl",!0===e),t.classList.toggle("b-ltr",!1===e))}startConfigure(e){var t;if(null===(t=super.startConfigure)||void 0===t||t.call(this,arguments),null==e.rtl){const t=this,n=t.changeElementRef(t.getRenderContext(e)[0]||e.adopt||document.body),r=e.owner||e.parent||t.constructor.fromElement(n);(null!=r&&r[r.isConfiguring?"peekConfig":"getConfig"]("rtl")||1===(null==n?void 0:n.nodeType)&&"rtl"===getComputedStyle(n).getPropertyValue("direction"))&&(t.rtl=!0)}}render(...e){var t;super.render&&super.render(...e),(y.isChrome&&y.chromeVersion<87||y.isFirefox&&y.firefoxVersion<66||y.isSafari&&y.safariVersion<14.1)&&this.element.classList.add("b-legacy-inset"),("rtl"===getComputedStyle(this.element).direction||null!==(t=this.owner)&&void 0!==t&&t.rtl)&&(this.rtl=!0)}},v(t,"$name","RTL"),v(t,"configurable",{rtl:null}),t};const Ia=Object.freeze({highlight:!1,onlyName:!1}),Aa=[],Fa=/transparent|rgba\(0,\s*0,\s*0,\s*0\)/,Oa={INPUT:1,TEXTAREA:1},La=(e,t,n,r)=>{var i;let s=null==n?void 0:n.listeners;if(s=(null===(i=s)||void 0===i?void 0:i.on)||s,s){const i=_n.on(sn.assign({element:t,thisObj:e},s));r?(e._refListeners||(e._refListeners=Object.create(null)))[r]=i:n.listeners={on:s,un:i}}},Pa=(e,t)=>e&&t&&t[sn.keys(e)[0]]?ae.merge(e,t):e,$a=e=>{e.isVisible&&e.triggerPaint()},_a=/^:not\((.+)\)$/,Na=/absolute|fixed/i,Ha=e=>null!=e.scale,{hasOwnProperty:Ba}=Object.prototype,{defineProperty:ja}=Reflect,Va=e=>parseFloat(e)*(e.endsWith("ms")?1:1e3),za=["b-aligned-above","b-aligned-right","b-aligned-below","b-aligned-left"],Wa={configurable:!0,get(){return!1}},Ua=/(?:L\{([^}.]+)\})/,Ya=(e,t)=>"L{Tooltip."+t+"}",Ga=/^([trblc])(\d*)-([trblc])(\d*)$/i,qa=(e,t)=>(Ga.test(e)&&(e={align:e}),Ga.test(t)&&(t={align:t}),ae.merge(e,t));class Ka extends(Te.mixin(pt,tt,Zr,ci,Ci,Ma,ka)){static mergeCls(e,t){return t&&e?e=new Mn(t).assign("string"==typeof e?new Mn(e):e):e&&!e.isDomClassList&&(e=new Mn(e)),e}static get $name(){return"Widget"}static get type(){return"widget"}static get configurable(){return{element:!0,callOnFunctions:!0,id:"",html:null,content:null,cls:{$config:{merge:"classList"},value:null},ui:{$config:{merge:"classList"},value:null},collapsify:null,contentElementCls:{$config:{merge:"classList"},value:null},defaultCls:{$config:{merge:"classList"},value:null},dock:null,forwardTwinEvents:{$config:{merge:"classList"},value:null},parent:null,tab:null,elementAttributes:null,htmlCls:{$config:{merge:"classList"},value:{"b-html":1}},style:null,disabled:null,readOnly:{value:null,default:!1,$config:null},ignoreParentReadOnly:null,adopt:null,appendTo:null,insertBefore:null,insertFirst:null,dataset:null,tooltip:{$config:["lazy","nullify"],value:null},showTooltipWhenDisabled:!0,preventTooltipOnTouch:null,monitorResize:{$config:["lazy","nullify"],value:null},masked:{$config:"nullify",value:null},maskDefaults:{target:"element"},cache:{},floating:null,positioned:null,draggable:null,align:{$config:{merge:qa},value:"t-b"},centered:null,constrainTo:void 0,anchor:null,owner:null,scrollAction:null,hideAnimation:{$config:{merge:Pa},value:null},showAnimation:{$config:{merge:Pa},value:null},x:null,y:null,scrollable:{$config:["lazy","nullify"],value:null},scrollerClass:wa,defaultBindProperty:"html",defaultAction:null,overflowable:{value:null,default:!0,$config:null},width:null,height:null,maxHeight:null,maxWidth:null,minWidth:null,minHeight:null,scaleToFitWidth:null,allowGrowWidth:!0,margin:null,flex:null,weight:null,alignSelf:null,ripple:null,title:null,localizableProperties:["title","ariaLabel","ariaDescription"],requireSize:!1,ref:null,hidden:null,textAlign:null,ignoreScrollDuration:500,tag:"div",recomposeAsync:null,rootElement:null,htmlMutationObserver:{$config:["lazy","nullify"],value:{childList:!0,subtree:!0}},role:{$config:"lazy",value:"presentation"},ariaLabel:{$config:"lazy",value:null},ariaDescription:{$config:"lazy",value:null},ariaElement:"element",ariaHasPopup:null,realignTimeout:300,testConfig:{ignoreScrollDuration:100,realignTimeout:50}}}static get prototypeProperties(){return{hasGeneratedId:!1,innerItem:!0}}static get declarable(){return["renderConfigs"]}static get delayable(){return{recompose:"raf",doHideOrRealign:"raf"}}static get factoryable(){return{defaultType:"widget"}}static get identifiable(){return{}}static get all(){return super.all}static get recomposeAsync(){return Ka._recomposeAsync}static set recomposeAsync(e){if(Ka._recomposeAsync=e,null!=e){const{all:t}=Ka;for(let n=0;n<t.length;++n)t[n].isComposable&&(t[n].recomposeAsync=e)}}isType(e,t){return Ka.isType(this,e,t)}static setupRenderConfigs(e,t){let n,{renderConfigs:r}=e;if(r){const e=t.getInherited("renderConfigs",!1)||Object.create(null);if(Array.isArray(r)){for(n=0;n<r.length;++n)e[r[n]]=!0;r=e}else r=Object.assign(e,r)}t.renderConfigs=r}construct(e={},...t){const n=this,{domSyncCallback:r}=n;n.configureAriaDescription=e.ariaDescription,n._isAnimatingCounter=0,n.alignConstrained=0,n.byRef=Object.create(null),n.callRealign=n.realign.bind(n),n.onTargetResize=n.onTargetResize.bind(n),n.onFullscreenChange=n.onFullscreenChange.bind(n),n.domSyncCallback=r.$nullFn?null:r.bind(n),n._isUserAction=!1,super.construct(e,...t);const{recomposeAsync:i}=Ka;null!=i&&null==n.recomposeAsync&&(n.recomposeAsync=i),n.finalizeInit()}startConfigure(e){super.startConfigure(e);const t=this,{adopt:n,element:r}=t;n&&(t.adoptElement(r,n,e.id),t.updateElement(t._element,r))}finalizeInit(){const e=this;(e.insertBefore||e.appendTo||e.insertFirst||e.adopt)&&e.render()}doDestroy(){const e=this,{preExistingElements:t,element:n,_refListeners:r}=e;if(r&&(Object.values(r,(e=>e())),e._refListeners=null),n){var i,s,o;const r=!e._tooltip&&e._rootElement&&(null===(i=Ka.Tooltip)||void 0===i?void 0:i.getSharedTooltip(e._rootElement,!0));if((null==r?void 0:r.owner)===e&&(r.owner=null,r.hide()),e.onExitFullscreen(),e.clearTimeout(e.scrollListenerTimeout),e.clearTimeout(e.resizeListenerTimeout),e.removeTransientListeners(),e.floating||e.positioned?e.hide(!1):e.revertFocus(),ua.removeResizeListener(n.parentElement,e.onParentElementResize),ua.removeResizeListener(n,e.onElementResize),e.adopt){for(let r=Array.from(n.childNodes),i=0,{length:s}=r;i<s;i++){const n=r[i];t.includes(n)||n===e.floatRoot||n.remove()}n.className=e.adoptedElementClassName,n.style.cssText=e.adoptedElementCssText}else n.remove();null===(s=e.dragEventDetacher)||void 0===s||s.call(e),null===(o=e.dragOverEventDetacher)||void 0===o||o.call(e),e.dragGhost.remove()}super.doDestroy()}get assignValueDefaults(){return Ia}get valueName(){return this.name||this.ref||this.id}getValueName(e){return(e=e&&"object"==typeof e?e.onlyName:e)?this.name:this.valueName}assignFieldValue(e,t,n){const r=this,i=r.defaultBindProperty;i in r&&(r[i]=n)}assignValue(e,t){t=t||Ia;const n=this,r=n.highlightExternalChange,i=n.getValueName(t);!i||e&&!(i in e)||(!1===t.highlight&&(n.highlightExternalChange=!1),n.assignFieldValue(e,i,e?e[i]:null),n.highlightExternalChange=r)}gatherValue(e){const t=this,n=t.defaultBindProperty;t.constructor!==Ka&&n in t&&(e[t.name||t.ref||t.id]=t[n])}gatherValues(e){this.eachWidget((t=>t.gatherValue(e)),!1)}get forwardTwinEvents(){const e=this._forwardTwinEvents;return e&&sn.getTruthyKeys(e)}configureOverflowTwin(e){var t;const n=this;let r=sn.clone(n.initialConfig);return delete r.id,r.hidden=!1,r.type=n.type,r._overflowTwinOrigin=n,r.disabled=n.disabled,"value"in n&&(r.value=n.value),null===(t=n.forwardTwinEvents)||void 0===t||t.forEach((e=>{delete r[`on${_.capitalize(e)}`]})),e&&(r="function"==typeof e?e(r)||r:sn.assign(r,e)),r}createOverflowTwin(e){var t;const n=this,r=n.configureOverflowTwin(e),i=Ka.create(r);return null===(t=n.forwardTwinEvents)||void 0===t||t.forEach((e=>{i.on({[e]:e=>{n.overflowTwin===e.source&&(delete(e=sn.assign({},e)).source,n.trigger(e.type,e))}})})),i}ensureOverflowTwin(e,t){let{overflowTwin:n}=this;return n||(this.overflowTwin=n=this.createOverflowTwin(e),null==t||t(n)),n}get isComposable(){return!this.compose.$nullFn}adoptElement(e,t,n){const r=this,i="string"==typeof t?document.getElementById(t):t,s=Ka.fromElement(i);s&&s.adopt&&s!==r&&("string"==typeof s.adopt?document.getElementById(s.adopt):s.adopt)===i&&s.destroy(),r.preExistingElements=Array.from(i.childNodes),r.adoptedElementClassName=i.className,r.adoptedElementCssText=i.style.cssText,i.id&&!n&&(r.id=e.id=i.id),Mr.syncAttributes(e,i);for(let t=0,{length:n}=e.childNodes;t<n;t++)i.appendChild(e.childNodes[0]);delete r._contentRange,r._element=i;const o=e.lastDomConfig,a=null==o?void 0:o.listeners;var l;a&&r.isComposable&&(null===(l=a.un)||void 0===l||l.call(a),La(r,i,o)),i.lastDomConfig=o||i.lastDomConfig,i.$refOwnerId=r.id,r.scaleToFitWidth||r.getConfig("monitorResize")}addRefAccessor(e,t){const{prototype:n}=this.constructor;ja(n,t,{writable:!0,value:null}),ja(n,e,{get(){return this.recompose.flush(),this[t]},set(e){this[t]=e}})}attachRef(e,t,n){const r=this,i="_"+e;t.dataset&&(t.dataset.ownerCmp=r.id),r.isComposable&&(i in r||r.addRefAccessor(e,i),La(r,t,n,e)),r.byRef[e]=t,r[e]=t}detachRef(e,t,n){const r=this,i=r._refListeners;null!=i&&i[e]&&(i[e](),delete i[e]),r[e]=null,delete r.byRef[e]}afterRecompose(){}compose(){return{class:Mn.normalize(this.widgetClassList,"object")}}doCompose(){const e=this,{$meta:t}=e,n=t.hierarchy;let r,i,s,o,a,l,{composers:c}=t,d=null;if(e.recompose.suspend(),!c){for(s=!0,t.composers=c=[],o=n.indexOf(Ka);o<n.length;++o)a=n[o].prototype,Ba.call(a,"compose")&&c.push(a);(l=t.getInherited("renderConfigs",!1))||(l=Object.create(null),e.configObserver={get(e){l[e]=!0}}),t.$renderConfigs=l}for(o=0;o<c.length;++o)r=c[o].compose.call(e,d),d=d?Mr.merge(d,r):r;return Ba.call(e,"compose")&&(r=e.compose)&&(r=r.call(e,d),Mr.merge(d,r)),s&&delete e.configObserver,Mr.normalizeChildren(d,((t,n)=>{n&&(i="_"+t,i in e||e.addRefAccessor(t,i))}))}get element(){return this.isComposable&&!this.isDestroying&&this.recompose.flush(),this._element}domSyncCallback(e){}changeElement(e){const t=this,n=t.isComposable;return n&&(e=t.doCompose()),"string"==typeof e?e=Mr.createElementFromTemplate(e):sn.isObject(e)?(e=Mr.createElement(e,{refOwner:t,callback:t.domSyncCallback}),t.recompose.resume(),n&&La(t,e,e.lastDomConfig)):1!==e.nodeType&&(e=Mr.createElementFromTemplate(t.template(t))),e.id=t.id,t.elementAttributes&&Mr.setAttributes(e,t.elementAttributes),e}updateElement(e){const t=this,{className:n}=e,{contentElement:r,contentElementCls:i,isComposable:s}=t,o=r!==e,a=!s&&e.querySelectorAll("[data-reference]"),l=s?[]:t.widgetClassList;let c=(o||!s)&&t.uiClasses;if(n&&l.unshift(n),t._hidden&&l.push("b-hidden"),t._readOnly&&l.push("b-readonly"),$e.noThrow(e,"remove"),c?(null!=i&&i.value&&(c=c.slice(),c.push(i.value)),c=c.join(" ")):c=null==i?void 0:i.value,c&&(o?r.className+=" "+c:l.push(c)),!t.parent){const{defaultCls:e}=t,{outerCls:n}=Ka;l.push(...e?n.filter((t=>!(t in e)||e[t])):n)}if(e.className=l.join(" "),a)for(let e,n=0;n<a.length;++n)e=a[n],t.attachRef(e.getAttribute("data-reference"),e),e.removeAttribute("data-reference");t.adopt||t.scaleToFitWidth||t.getConfig("monitorResize"),t.getConfig("role"),t.getConfig("ariaLabel"),t.getConfig("ariaDescription"),t._html&&t.getConfig("htmlMutationObserver")}updateAriaDescription(e){const{ariaElement:t}=this,n=`${this.id}-aria-desc-el`;if(e){const r=this._ariaDescEl||(this._ariaDescEl=Mr.createElement({className:"b-aria-desc-element",id:n,parent:t}));r.innerText=e.match(Ua)?this.L(e,this):e,t.setAttribute("aria-describedBy",r.id)}else t.getAttribute("aria-describedby")===n&&t.removeAttribute("aria-describedBy")}updateAriaLabel(e){Mr.setAttributes(this.ariaElement,{"aria-label":null!=e&&e.match(Ua)?this.L(e,this):e})}updateAriaHasPopup(e){Mr.setAttributes(this.ariaElement,{"aria-haspopup":e})}updateRole(e){var t,n;e?null===(t=this.ariaElement)||void 0===t||t.setAttribute("role",e):null===(n=this.ariaElement)||void 0===n||n.removeAttribute("role")}get ariaElement(){this.getConfig("element");const{_ariaElement:e}=this;return e.nodeType===Node.ELEMENT_NODE?e:sn.getPath(this,e)}isCollapsified(e,t){const{collapsify:n}=this;let r=!t;return null==n?r=t?e:!e:"overlay"===n&&(r=t),Boolean(r)}async recompose(){const e=this,t={targetElement:e.element,domConfig:e.doCompose(),refOwner:e,callback:e.domSyncCallback,strict:!0};if(e.transitionRecompose){if(e.isTransitioningDom=!0,await Mr.transition(sn.assign({element:e.element,action(){oa.sync(t)}},e.transitionRecompose)),e.isDestroyed)return;e.isTransitioningDom=!1,e.trigger("transitionedRecompose")}else oa.sync(t);t.changed&&(e.afterRecompose(),e.trigger("recompose")),e.recompose.resume()}changeElementRef(e){if("string"==typeof e){const t=e;if(!(e=document.getElementById(t)))throw new Error(`No element found with id '${t}'`)}return e}changeAppendTo(e){return this.changeElementRef(e)}updateAppendTo(e){!this.isConfiguring&&e&&this.render()}changeInsertBefore(e){return this.changeElementRef(e)}updateInsertBefore(e){!this.isConfiguring&&e&&this.render()}changeInsertFirst(e){return this.changeElementRef(e)}updateInsertFirst(e){!this.isConfiguring&&e&&this.render()}getRenderContext(e=this,t){let n=t||e.appendTo,{insertFirst:r,insertBefore:i}=e;return r&&(n=r,i=n.firstChild),i&&(n||(n=i.parentElement)),[n,i||void 0]}render(e,t=!0){const n=this,{element:r}=n,[i,s]=n.getRenderContext(n,e);n.emptyCache(),n.syncElement&&n.currentElement?Mr.sync(r,n.currentElement):(null==i||i.insertBefore(r,s),n.currentElement=r),Ka.fromElement(r.parentElement)&&r.classList.remove(...Ka.outerCls),super.render(i,t),n.rendered=!0,n.getConfig("role"),t&&(n.getConfig("contentRange"),n.triggerPaint()),n.setupFocusListeners()}template({tag:e,html:t,htmlCls:n,name:r}){const i=null!=t&&t.call?t.call(this):t;return`<${e} class="${i?n:""}" ${r?`data-name="${r}"`:""}>${i||""}</${e}>`}updateRecomposeAsync(e){this.recompose.immediate=!e}onConfigChange({name:e}){var t;this._element&&!this.isDestroying&&null!==(t=this.$meta.$renderConfigs)&&void 0!==t&&t[e]&&this.recompose()}preProcessCurrentConfigs(e){super.preProcessCurrentConfigs(e),delete e.parent}getConfigValue(e,t){return"style"===e?this._style:super.getConfigValue(e,t)}getCurrentConfig(e){const t=super.getCurrentConfig(e);return(null==e?void 0:e.depth)>0&&(t.type=this.type),t}get dataset(){return this.element.dataset}changeDataset(e){Object.assign(this.dataset,e)}get dragGhost(){return this.constructor._dragGhost||(this.constructor._dragGhost=Mr.createElement({html:" ",style:"position:absolute;top:-10000em;left:-10000em"}))}updateParent(e){const{_element:t}=this;t&&t.classList[e?"remove":"add"](...Ka.outerCls)}get constrainTo(){const e=this._constrainTo;return void 0===e?globalThis:(null==e?void 0:e.nodeType)===Node.DOCUMENT_FRAGMENT_NODE?e.host||e.ownerDocument:e}updateCentered(e){const{element:t,_anchorElement:n}=this;if(e&&!this.floating&&!this.positioned)throw new Error("`centered` is only relevant when a Widget is `floating` or `positioned`");e?(t.classList.add("b-centered"),t.style.transform=t.style.left=t.style.top="",null==n||n.classList.add("b-hide-display"),t.classList.remove("b-anchored")):t.classList.remove("b-centered")}get contentElement(){return this.element}get contentRange(){const e=this,{contentElement:t}=e,n=e._contentRange||(e._contentRange=new Range);return n.collapsed&&(n.setStart(t,e.contentRangeStartOffset||0),n.setEnd(t,e.contentRangeEndOffset||t.childNodes.length)),n}fixRefOwnerId(e,t,n){if(e.$refOwnerId===n){e.$refOwnerId=t;for(let{childNodes:r}=e,i=r.length;i-- >0;)this.fixRefOwnerId(r[i],t,n)}}get placement(){const{element:e}=this;let t,n,r;if(null!=e&&e.offsetParent&&!Na.test(Mr.getStyleValue(e,"position"))){const s=e.nextElementSibling,o=e.previousElementSibling,a=!s&&o;var i;n=Mr.getStyleValue(e.parentElement,"flex-direction"),n?n=n.startsWith("row")?"h":"v":(t=null===(i=s||o)||void 0===i?void 0:i.getBoundingClientRect(),r=t&&e.getBoundingClientRect(),n=t&&Math.abs(t.top-r.top)<Math.abs(t.left-r.left)?"h":"v"),n+="h"===n?a?"r":"l":a?"b":"t"}return n}updateId(e,t){if(super.updateId(e,t),t){const{byRef:n,element:r}=this;for(const t in n)n[t].dataset&&(n[t].dataset.ownerCmp=e);r.id=e,this.fixRefOwnerId(r,e,t)}}get style(){const{element:e}=this;return(null==e?void 0:e.ownerDocument.defaultView.getComputedStyle(e))||this._style}updateStyle(e){this.element&&Mr.applyStyle(this.element,e)}updateTitle(e){this.titleElement&&(this.titleElement.innerHTML=e)}beforeAlignTo(e){}alignTo(e){var t;const n=this,{lastAlignSpec:r,element:i}=n,{offsetParent:s,style:o,classList:a}=i;if(n.beforeAlignTo(e),r&&(r.monitorIntersection&&n.intersectionObserver.unobserve(r.target),isFinite(r.zone)&&i.classList.remove(za[r.zone])),!e)return n.removeTransientListeners(),void(n.anchor=n.lastAlignSpec=null);(e.nodeType===Element.ELEMENT_NODE||e.isWidget||"Point"===e.$$name)&&(e={target:e}),n.releaseSizeConstraints();const{scrollable:l,constrainTo:c}=n,d=n.positioned&&"fixed"!==Mr.getStyleValue(i,"position"),u=n.scale||1,h=e.target,g=h&&(h.isRectangle?h:h.element||h),m=xn.from(i,d?s:null,!0),{width:p,height:f}=m,v=g&&g.nodeType===Element.ELEMENT_NODE,b=(e=e.realignTarget?e:sn.assign({aligningToElement:v,constrainTo:c,align:"b-t",axisLock:n.axisLock,anchor:n.anchor},n.align,e)).minWidth||n.minWidth,C=e.minHeight||n.minHeight;if(m.isAlignRectangle=!0,b&&(m.minWidth=b*u),C&&(m.minHeight=C*u),n.lastAlignSpec=e,v&&(n.lastAlignSpec.target=g),v&&pr(g.offsetParent)){if((e=Object.setPrototypeOf({},e)).target=n.lastAlignSpec.targetRect=e.realignTarget||(e.allowTargetOut?xn.from(g,d?s:null,!d):Mr.isInView(g,!1,n)),!e.target){const e=n.hide();return n.isDestroyed||(n.lastAlignSpec.targetOutOfView=!0),e}e.target.height=Math.max(e.target.height,1),e.target.width=Math.max(e.target.width,1),n.lastAlignSpec.anchoredTo=g}if(e.anchor&&(e.anchorSize=n.anchorSize,i.contains(n.anchorPathElement)||i.appendChild(n.anchorElement)),d)if(s&&"hidden"===Mr.getStyleValue(s,"overflow"))e.constrainTo=xn.from(s).moveTo(0,0);else if(c&&!c.isRectangle){const t=c===document||c===globalThis;e.constrainTo=xn.from(e.constrainTo,s),t&&e.constrainTo.translate(globalThis.pageXOffset,globalThis.pageYOffset)}n.isAligning=!0,n.trigger("beforeAlign",e),n.isAligning=!1,e.rtl=n.rtl,(e.align.includes("s")||e.align.includes("e"))&&(n.rtl?e.align=e.align.replace(/s/g,"r").replace(/e/g,"l"):e.align=e.align.replace(/s/g,"l").replace(/e/g,"r"));const w=m.alignTo(e);let{align:S,anchor:D,x:E,y:x,width:R,height:T,overlap:M}=w;if(n.lastAlignSpec.zone=w.zone,T!=f&&("configuredHeight"in n||(n.configuredHeight=o.height),n.height=T/u,n.alignConstrained=1|n.alignConstrained,l&&(l.overflowY=!0)),R!=p&&("configuredWidth"in n||(n.configuredWidth=o.width),n.width=R/u,n.alignConstrained=2|n.alignConstrained,l&&(l.overflowX=l.clientWidth>l.scrollWidth)),S&&n.alignConstrained){e.align=S;const t=xn.from(i,d?s:null,!0).alignTo(e);D=t.anchor,E=t.x,x=t.y,R=t.width,T=t.height}if(n.setXY(E,x),!w.overlap&&isFinite(w.zone)&&a.add(za[w.zone]),null!==(t=D)&&void 0!==t&&t.edge){var k;const{edge:e}=D,{anchorElement:t}=n,r=xn.from(i),s=[];"top"===e||"bottom"===e?(s[0]=D.x,s[1]="top"===e?1:r.height-1):(s[0]="left"===e?1:r.width-1,s[1]=D.y);let o=Mr.childFromPoint(i,...s);if(null!==(k=o)&&void 0!==k&&k.matches(":hover,:focus")&&i.compareDocumentPosition(o)&Node.DOCUMENT_POSITION_CONTAINED_BY&&(o=o.parentNode),o&&o!==document){let e=Mr.getStyleValue(o,"background-color");for(;e.match(Fa)&&"absolute"!==Mr.getStyleValue(o,"position")&&(o=o.parentNode,o!==document);)e=Mr.getStyleValue(o,"background-color");e.match(Fa)?n.anchorPathElement.setAttribute("fill",n.defaultAnchorBackgroundColor):n.anchorPathElement.setAttribute("fill",e)}t.classList.remove("b-hide-display"),t.style.transform="",t.className=`b-anchor b-anchor-${e}`,D.x&&(D.x/=u),D.y&&(D.y/=u),Mr.setTranslateXY(t,D.x,D.y),a.add("b-anchored")}else n._anchorElement&&(n.anchorElement.classList.add("b-hide-display"),a.remove("b-anchored"));if(!v){o.pointerEvents="none";const e=Mr.elementFromPoint(E,x);n.owns(e)||(n.lastAlignSpec.anchoredTo=e),o.pointerEvents=""}if(("realign"===n.scrollAction&&v||"hide"===n.scrollAction)&&!n.documentScrollListener){var I;if(n.clearTimeout(n.scrollListenerTimeout),e.monitorTargetMutation&&(null===(I=n.targetObserver)||void 0===I||!I.isActive)){const e=n.targetObserver||(n.targetObserver=new MutationObserver(n.onTargetParentMutation.bind(n)));e.observe(Mr.getRootElement(g),{childList:!0,attributes:!0,subtree:!0}),e.isActive=!0}n.scrollListenerTimeout=n.setTimeout((()=>{const e=Mr.isElement(g)?Mr.getRootElement(g):null;n.documentScrollListener=_n.addListener(document,"scroll","doHideOrRealign",{capture:!0,thisObj:n}),e&&e!==document&&(n.targetRootScrollListener=_n.addListener(e,"scroll","doHideOrRealign",{capture:!0,thisObj:n}))}),"hide"===n.scrollAction?n.ignoreScrollDuration:0)}v&&(e.monitorResize&&!n.targetResizeListener&&(ua.addResizeListener(g,n.onTargetResize),n.targetResizeListener=!0),e.monitorIntersection&&!(M||g.contains(i)||g.ownerSVGElement)&&n.intersectionObserver.observe(g)),y.isAndroid||n.constrainListeners||c instanceof xn||(n.clearTimeout(n.resizeListenerTimeout),n.resizeListenerTimeout=n.setTimeout((()=>{n.constrainListeners=!0,ua.addResizeListener(c||globalThis,n.callRealign)}),n.ignoreScrollDuration))}onTargetParentMutation(e){const{element:t,lastAlignSpec:n}=this;null!=n&&n.aligningToElement&&(fr(n.target)?e.some((({target:e})=>e.contains(n.target)&&!t.contains(e)))&&this.realign():this.hide())}get intersectionObserver(){return this._intersectionObserver||(this._intersectionObserver=new IntersectionObserver(this.onTargetIntersectionchange.bind(this),{root:y.isSafari?this.rootElement:this.rootElement.ownerDocument}))}onTargetIntersectionchange(e){if(!this.isDestroyed){const t=e[e.length-1];t.isIntersecting||this.onAlignTargetOutOfView(t.target)}}onTargetResize(){const{lastAlignSpec:e}=this;if(e){const{width:t,height:n}=e.targetRect,{width:r,height:i}=e.target.getBoundingClientRect();r===t&&i===n||this.realign()}}onAlignTargetOutOfView(e){this.hide(),this.lastAlignSpec&&(this.lastAlignSpec.targetOutOfView=!0)}realign(){const e=this,{lastAlignSpec:t}=e;if(e.isVisible&&(e.floating||e.positioned)&&t){if(t.aligningToElement){const n=t.target.contains(this.element),r=Mr.isInView(t.target,!1,e);if(!(t.allowTargetOut||pr(t.target)&&r))return e.hide(),void(e.isDestroyed||(e.lastAlignSpec.targetOutOfView=!0));t.realignTarget=n?null:r}Mr.addTemporaryClass(e.element,"b-realigning",e.realignTimout,e),e.alignTo(t)}}rectangle(e,t,n){return this.rectangleOf("element",e,t,n)}rectangleOf(e,t,n,r){var i;return"string"!=typeof t?(r=n,n=t,t=""):"border"===t&&(t=""),"boolean"==typeof n&&(r=n,n=void 0),"element"!==e&&void 0===n&&(n=this.element),n=null!==(i=n)&&void 0!==i&&i.isWidget?n.element:n,xn[t||"from"](this[e],n,r)}releaseSizeConstraints(){const e=this,t=e.scrollable;1&e.alignConstrained&&(e.height=e.configuredHeight,t&&(t.overflowY=t.config.overflowY)),2&e.alignConstrained&&(e.width=e.configuredWidth,t&&(t.overflowX=t.config.overflowX)),e.alignConstrained=0}toFront(){const{element:e}=this,t=this.floating?this.floatRoot:this.positioned?null==e?void 0:e.parentNode:null;if(null!=e&&e.nextSibling){const n=this._toFrontRange||(this._toFrontRange=document.createRange());n.setStartBefore(e.nextSibling),n.setEndAfter(t.lastElementChild),t.insertBefore(n.extractContents(),e)}}updateRef(e){this.element.dataset.ref=e}get overflowElement(){return this.contentElement}get maxHeightElement(){return this.element}changeAlign(e){return"string"==typeof e?{align:e}:e}changeScrollable(e,t){return"boolean"==typeof e&&(e={overflowX:e,overflowY:e}),e?(e.element=this.overflowElement,e.widget=this,e.isScroller||(e=t?t.setConfig(e):new this.scrollerClass(e)),e.syncOverflowState()):null==t||t.destroy(),e}get html(){return this.initializingElement||!this.element?this.content||this._html:this.contentElement.innerHTML}updateHtml(e){const t=this,n=null==e,{element:r,contentElement:i,htmlCls:s}=t;if(r){t.updatingHtml=!0;const o=i===r&&t._anchorElement;s&&s.values.forEach((e=>r.classList[n?"remove":"add"](e))),o&&t.element.removeChild(o),e&&"object"==typeof e?oa.sync({domConfig:f(f({},e),{},{onlyChildren:!0}),targetElement:t.contentElement}):t.contentElement.innerHTML=n?"":e,t.getConfig("htmlMutationObserver"),o&&r.appendChild(o),t.isComposable?t.recompose():(t.floating||t.positioned)&&(t.isAligning||t.realign())}}changeHtmlMutationObserver(e,t){const n=this,{contentElement:r}=n;if(null==t||t.disconnect(r),e){const t=new MutationObserver((()=>{n.updatingHtml?n.updatingHtml=!1:n._html=r.innerHTML}));return t.observe(r,e),t}}updateContent(e){const t=this,n=null==e,{element:r,htmlCls:i}=t;if(r){const{contentRange:s}=t;i&&i.values.forEach((e=>r.classList[n?"remove":"add"](e))),fr(r)?(s.deleteContents(),n||s.insertNode(Mr.createElementFromTemplate(e,{fragment:!0}))):t.contentElement.innerHTML=e,t.contentRangeStartOffset=s.startOffset,t.contentRangeEndOffset=s.endOffset,!t.floating&&!t.positioned||t.isAligning||t.realign()}}onThemeChange(){var e;null!==(e=this.anchorElement)&&void 0!==e&&e.offsetParent&&(this._anchorSize=null,this.realign())}get anchorSize(){const e=this;let t=this._anchorSize;if(!t){const n=parseFloat(Mr.getStyleValue(e.element,"border-top-width")),r=Mr.getStyleValue(e.element,"border-top-color"),i=e.anchorElement,{className:s}=i,o=i.firstElementChild,a=e.anchorPathElement=o.lastElementChild,l=e._hidden;i.className="b-anchor b-anchor-top";let c=Mr.getStyleValue(e.contentElement,"background-color");c.match(Fa)&&(c=Mr.getStyleValue(e.element,"background-color")),e.defaultAnchorBackgroundColor=c,t=i.getBoundingClientRect();const[d,u]=t=e._anchorSize=[t.width,t.height];i.className=s,o.setAttribute("height",u+n),o.setAttribute("width",d),a.setAttribute("d",`M0,${u}L${d/2},0.5L${d},${u}`),n&&(a.setAttribute("stroke-width",n),a.setAttribute("stroke",r)),t[1]-=n,l&&e.element.classList.add("b-hidden"),e.themeChangeListener||(e.themeChangeListener=zr.on({theme:"onThemeChange",thisObj:e})),e.anchorPathElement.setAttribute("fill",e.defaultAnchorBackgroundColor)}return t}get anchorElement(){const e=this;if(!e._anchorElement){const t=e.floating,n=`${e.id}-shadow-filter`;e._anchorElement=Mr.createElement({parent:e.element,className:"b-anchor b-anchor-top",children:[{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",class:"b-pointer-el",children:[t?{tag:"defs",children:[{tag:"filter",id:n,children:[{tag:"feDropShadow",dx:0,dy:-1,stdDeviation:1,"flood-opacity":.2}]}]}:null,{tag:"path",[t?"filter":""]:`url(#${n})`}]}]})}return e._anchorElement}updateAnchor(e){this._anchorElement&&this._anchorElement.classList[e?"remove":"add"]("b-hide-display")}updateDraggable(e){const t=this,{element:n}=t;var r,i,s;e?(t.dragEventDetacher=_n.addListener({element:n,dragstart:"onWidgetDragStart",dragend:"onWidgetDragEnd",thisObj:t}),t.dragDetacher=_n.on({element:n,mousedown(e){const{target:t}=e,r=Ka.fromElement(t);(!e.target.closest(".b-field-inner")&&r===this||this.strips&&Object.values(this.strips).includes(r))&&n.setAttribute("draggable","true")},thisObj:t})):(null===(r=t.dragEventDetacher)||void 0===r||r.call(t),null===(i=t.dragOverEventDetacher)||void 0===i||i.call(t),null===(s=t.dragDetacher)||void 0===s||s.call(t))}onWidgetDragStart(e){var t;const n=this;if(!n.validateDragStartEvent(e))return;n.removeTransientListeners();const{element:r,align:i,constrainTo:s}=n,o=n.positioned&&"fixed"!==Mr.getStyleValue(r,"position"),a=o?r.parentElement:n.rootElement,l=xn.from(r,o?a:null),c=e.clientX,d=e.clientY,u=document.scrollingElement||document.body,[h,g]=Mr.getOffsetXY(r,a),m=null===(t=o?xn.content(a).moveTo(0,0):s&&(null!=s&&s.isRectangle?s:xn.from(s)))||void 0===t?void 0:t.deflate(i.constrainPadding||0),p={element:a,dragover:e=>{r.classList.remove("b-centered"),l.moveTo(h+e.clientX-c-(o?0:u.scrollLeft),g+e.clientY-d-(o?0:u.scrollTop)),m&&l.constrainTo(m),Mr.setTranslateXY(r,l.x,l.y)}};y.isTouchDevice&&(p.touchmove=e=>e.preventDefault()),n.floatRoot.appendChild(n.dragGhost),n.setDragImage(e),e.dataTransfer.effectAllowed="none",n.dragOverEventDetacher=_n.addListener(p),n.alignTo()}validateDragStartEvent(e){const{element:t}=this,n=Mr.elementFromPoint(e.clientX,e.clientY),{handleSelector:r}=this.draggable;if(r){var i;const s=null===(i=_a.exec(r))||void 0===i?void 0:i[1];if(s){if(n.closest(`#${t.id} ${s}`))return e.preventDefault(),!1}else if(!n.closest(`#${t.id} ${r}`))return e.preventDefault(),!1}return!0}setDragImage(e){e.dataTransfer.setDragImage&&(e.dataTransfer.setData("application/node type",""),e.dataTransfer.setDragImage(this.dragGhost,-9999,-9999))}onWidgetDragEnd(){this.dragGhost.remove(),this.dragOverEventDetacher(),this.element.removeAttribute("draggable")}changeFloating(e){return Boolean(e)}changePositioned(e){return Boolean(e)}updatePositioned(e){this.element.classList[e?"add":"remove"]("b-positioned")}getXY(){return[Mr.getPageX(this.element),Mr.getPageY(this.element)]}setXY(e,t){const n=this,{element:r}=n;if(n.floating||n.positioned)if(null!=e&&(n._x=e,n.centered=!1),null!=t&&(n._y=t,n.centered=!1),"fixed"===Mr.getStyleValue(r,"position")){const n=r.getBoundingClientRect(),[i,s]=Mr.getTranslateXY(r),o=e-n.x,a=t-n.y;Mr.setTranslateXY(r,i+o,s+a)}else Mr.setTranslateXY(r,n._x||0,n._y||0)}get x(){return this.getXY()[0]}changeX(e){this.setXY(e)}get y(){return this.getXY()[1]}changeY(e){this.setXY(null,e)}get width(){const e=this,t=e.element;return e.monitorResize?(null==e._width&&(e._width=t.offsetWidth),e._width):t.offsetWidth}changeWidth(e){const t=this;Mr.setLength(t.element,"width",e),t._lastWidth=e,t._width=null,t._flex=null,t.element.style.flex=""}get maxWidth(){return Mr.measureSize(this.element.style.maxWidth,this.element)}updateMaxWidth(e){Mr.setLength(this.element,"maxWidth",e)}get minWidth(){return Mr.measureSize(this.element.style.minWidth,this.element)}updateMinWidth(e){Mr.setLength(this.element,"minWidth",e)}updateFlex(e){this.getConfig("width"),"number"!=typeof e&&isNaN(e)||(e=`${e} ${e}`),this.element.style.flex=e,this.element.style.width=""}updateAlignSelf(e){this.element.style.alignSelf=e}updateMargin(e){this.element.style.margin=this.parseTRBL(e).join(" ")}updateTextAlign(e,t){t&&this.element.classList.remove(`b-text-align-${t}`),this.element.classList.add(`b-text-align-${e}`)}updatePlaceholder(e){this.input&&(null==e?this.input.removeAttribute("placeholder"):this.input.placeholder=e)}get height(){const e=this,t=e.element;return e.monitorResize?(null==e._height&&(e._height=t.offsetHeight),e._height):t.offsetHeight}changeHeight(e){Mr.setLength(this.element,"height",e),this._lastHeight=e,this._height=null}get maxHeight(){return Mr.measureSize(this.maxHeightElement.style.maxHeight,this.element)}updateMaxHeight(e){Mr.setLength(this.maxHeightElement,"maxHeight",e)}get minHeight(){return Mr.measureSize(this.element.style.minHeight,this.element)}updateMinHeight(e){Mr.setLength(this.element,"minHeight",e)}updateDisabled(e=!1){const{element:t,focusElement:n,ariaElement:r}=this;this.trigger("beforeUpdateDisabled",{disabled:e}),e&&this.revertFocus(),t&&(t.classList[e?"add":"remove"]("b-disabled"),n&&(n.disabled=e),r&&r.setAttribute("aria-disabled",e)),this.onDisabled(e)}onDisabled(e){}disable(){this.disabled=!0}enable(){this.disabled=!1}requestFullscreen(){const e=this,t=aa.request(e.floating?e.floatRoot:e.element);return aa.onFullscreenChange(e.onFullscreenChange),e.floating||(e.floatRoot._oldParent=e.floatRoot.parentElement,e.element.appendChild(e.floatRoot)),e.element.classList.add("b-fullscreen"),t}exitFullscreen(){return aa.exit()}onFullscreenChange(){aa.isFullscreen||this.onExitFullscreen()}onExitFullscreen(){var e;const t=this,n=null===(e=t._rootElement)||void 0===e?void 0:e.floatRoot;aa.unFullscreenChange(t.onFullscreenChange),t.element.classList.remove("b-fullscreen"),t.element.contains(n)&&null!=n&&n._oldParent&&(n._oldParent.appendChild(n),n._oldParent=null)}get tooltip(){if(this._tooltip)return this._tooltip;{var e;const t=null===(e=Ka.Tooltip)||void 0===e?void 0:e.getSharedTooltip(this.rootElement);if(t&&t.activeTarget===this._element&&t.isVisible)return t}}changeTooltip(e,t){const n=this,{element:r}=n;if(e){if(!n.preventTooltipOnTouch||!y.isTouchDevice){var i;if(e.isTooltip||"Object"===e.constructor.name||(e={html:"string"==typeof e?e:n.placeholder,textContent:!0}),n.configureAriaDescription||(n.ariaDescription=null!==(i=e.html)&&void 0!==i&&i.match(Ua)?e.html.replace(Ua,Ya):e.html),!(null!=t&&t.isTooltip||e.newInstance))return r.dataset.btip=!0,void(n.tipConfig=e);e.type="tooltip",e.forElement||(e.forElement=r),"showOnHover"in e||e.forSelector||(e.showOnHover=!0),"autoClose"in e||(e.autoClose=!0),e=Ka.reconfigure(t,e,n),n.detachListeners("tooltipValueListener"),n.configureAriaDescription||e.on({name:"tooltipValueListener",innerHtmlUpdate:"onTooltipValueChange",thisObj:n})}}else if(t){if(null!=e||!t.isTooltip)return void(t.html=null);t.destroy()}else delete r.dataset.btip;return e}onTooltipValueChange({value:e}){this.ariaDescription=e}get tooltipText(){const e=this._tooltip;return e?e.isTooltip?e.contentElement.innerText:"string"==typeof e?e:e.html:this.tipConfig?this.tipConfig.html:void 0}get isVisible(){const e=this,{element:t}=e;let n;return Boolean(t&&!e._hidden&&!e.isDestroying&&fr(t)&&(!e.requireSize||pr(t))&&(!(n=e.containingWidget)||n.isVisible))}whenVisible(e,t=this,n,r=e){const i=this;i.isVisible?i.callback(e,t,n):(i.toCallWhenVisible||(i.toCallWhenVisible=new Map)).has(r)||i.toCallWhenVisible.set(r,{callback:e,thisObj:t,args:n})}focus(){this.isFocusable&&Mr.focusWithoutScrolling(this.focusElement)}get focusElement(){}get isFocusable(){const e=!this.isDestroying&&this.isVisible&&!this.disabled&&this.focusElement;return e&&(e===document.body||e.offsetParent)}async show({align:e,animate:t=!0}={}){const n=this,{element:r,floating:i}=n,{style:s}=r,o=t&&n.showAnimation;let a,l,c=!n.isVisible;return c&&(c=n.trigger("beforeShow"),sn.isPromise(c)&&(c=await c)),!1===c||n.internalBeforeShow&&!1===n.internalBeforeShow()?Promise.resolve():new Promise((t=>{if(n.cancelHideShowAnimation(),n.updateCentered(n._centered),i){const e=n.floatRoot;e.contains(r)||(n.rendered?e.appendChild(n.element):n.render(e,!1)),s.transform.includes("scale")&&(n.scale=null,s.transform=s.transformOrigin="");const t=n.closest(Ha);if(t){const{scale:e}=t;n.scale=e,s.transform=`scale(${e})`,s.transformOrigin="0 0"}}if(n._hidden=!1,r.classList.remove("b-hidden"),i&&!gr(n.element)&&(n.hide(!1),t()),n.onConfigChange({name:"hidden",value:!1,was:!0,config:n.$meta.configs.hidden}),o){a=Object.keys(o)[0],l=o[a];const e=n.currentAnimation={showing:!0,styleProp:a,resolve:t};n.isAnimating=!0,n.currentAnimation.detacher=_n.onTransitionEnd({element:r,property:a,duration:Va(l.duration)+20,handler:()=>n.afterHideShowAnimate(e),thisObj:n}),s[a]=l.from,Mr.getStyleValue(r,a),s.transition=`${a} ${l.duration} ease ${l.delay}`,s[a]=l.to}n.afterShow(e,o?null:t)}))}async showBy(e,t,n){const r=this,i=Array.isArray(e);if(i||"number"==typeof e){const r=i?e:[e,t];e=Object.assign({target:new kn(r[0]+1,r[1]+1),matchSize:!1,align:"t0-b0"},i?t:n)}if(r.requireSize=!0,!r.isVisible)return r.show({align:e});Mr.addTemporaryClass(r.element,"b-realigning",300,r),r.alignTo(e)}async showByPoint(){return K.deprecate("Core","6.0.0","Widget.showByPoint() replaced by Widget.showBy() with the same signature"),this.showBy(...arguments)}afterShow(e,t){var n,r;const i=this;i.trigger("show"),i._configuredAnchorState=i.anchor,null===(n=i.owner)||void 0===n||null===(r=n.onChildShow)||void 0===r||r.call(n,i),i.triggerPaint(),(i.floating||i.positioned)&&(e?i.alignTo(e):i.forElement&&!i.centered&&i.alignTo(i.forElement)),null==t||t()}onChildHide(e){e.floating&&this.ariaElement.removeAttribute("aria-owns")}onChildShow(e){e.floating&&(this.ariaHasPopup=e.role,this.ariaElement.setAttribute("aria-owns",e.id))}triggerPaint(){const e=this,{element:t}=e,n=!e.isPainted;if(e.isVisible){var r;if(n&&(e.getConfig("scrollable"),e.scaleToFitWidth&&!e.monitorResize&&(e.onParentElementResize=e.onParentElementResize.bind(e),ua.addResizeListener(t.parentElement,e.onParentElementResize),e.updateScale()),!e.hideBryntumDomMessage&&(e.isTaskBoardBase||e.isGridBase||e.isCalendar)&&t.insertBefore(new Comment("POWERED BY BRYNTUM (https://bryntum.com)"),t.firstChild)),e.eachWidget($a,!1),n&&(e.rootElement=Mr.getRootElement(t),e.getConfig("tooltip"),!Ka.Ripple&&Ka.RippleClass&&(Ka.Ripple=new Ka.RippleClass({rootElement:e.rootElement}))),e.isPainted=!0,n&&e.triggerConfigs("paint"),e.trigger("paint",{firstPaint:n}),null!==(r=e.toCallWhenVisible)&&void 0!==r&&r.size){for(const{callback:t,thisObj:n,args:r}of e.toCallWhenVisible.values())e.callback(t,n,r);e.toCallWhenVisible.clear()}n&&e.monitorResize&&!e.scaleToFitWidth&&ua.onElementResize([{target:t}])}}cancelHideShowAnimation(){const e=this,{currentAnimation:t,element:n}=e;t&&(e.isAnimating=!1,n.classList.contains("b-hiding")&&(n.classList.remove("b-hiding"),e._hidden=!1),t.detacher(),t.resolve(),n.style.transition=n.style[t.styleProp]="",e.currentAnimation=null,e.trigger("hideAnimationEnd"))}afterHideShowAnimate(e){const t=this;e===t.currentAnimation&&(t.element.classList.remove("b-hiding"),t.cancelHideShowAnimation(),t._hidden&&t.afterHideAnimation())}suspendVisibility(){this._visibilitySuspended=(this._visibilitySuspended||0)+1,Object.defineProperty(this,"isVisible",Wa)}resumeVisibility(e=!0){--this._visibilitySuspended||(delete this.isVisible,e&&this.triggerPaint())}hide(e=!0){return new Promise((t=>{const n=this,{element:r,lastAlignSpec:i}=n,{style:s}=r,o=e&&n.hideAnimation;if(n.clearTimeout(n.scrollListenerTimeout),n.clearTimeout(n.resizeListenerTimeout),!n._hidden&&!1!==n.trigger("beforeHide")){if(n._hidden=!0,i&&(i.targetOutOfView=null,i.monitorIntersection&&(n.intersectionObserver.takeRecords(),n.intersectionObserver.unobserve(i.target))),n.onConfigChange({name:"hidden",value:!0,was:!1,config:n.$meta.configs.hidden}),!r)return void t();if(r.contains(Mr.getActiveElement(r))&&n.revertFocus(!0),n.isDestroyed)return void t();if(n.cancelHideShowAnimation(),o){const e=Object.keys(o)[0],i=o[e];if(Number(getComputedStyle(n.element)[e])!==i.to){const o=n.currentAnimation={hiding:!0,styleProp:e,resolve:t};r.classList.add("b-hiding"),n.isAnimating=!0,n.currentAnimation.detacher=_n.onTransitionEnd({element:r,property:e,duration:Va(i.duration)+20,handler:()=>n.afterHideShowAnimate(o),thisObj:n}),s[e]=i.from,Mr.getStyleValue(r,e),s.transition=`${e} ${i.duration} ease ${i.delay}`,s[e]=i.to}else r.classList.add("b-hidden")}else r.classList.add("b-hidden");n.afterHide(!o&&t,o)}}))}doHideOrRealign({target:e,isTrusted:t}){const n=this,{lastAlignSpec:r,element:i}=n,s=null==r?void 0:r.anchoredTo,o=null==r?void 0:r.target,a=null==r?void 0:r.position,l=Mr.getActiveElement(n);if(!t||!pr(i)||e&&(i.contains(e)||e.nodeType===Element.DOCUMENT_NODE&&i.contains(l)&&Oa[l]&&globalThis.innerHeight<document.body.offsetHeight))return;if(r.aligningToElement){const e=Mr.isInView(o,!1,n);if(e&&e.equals(r.targetRect))return}const c="hide"===n.scrollAction&&n.getXY();if(n.realign(),!n.isDestroyed&&"hide"===n.scrollAction){const[t,r]=n.getXY();(t!==c[0]||r!==c[1]||"Point"===(null==o?void 0:o.$$name)||a)&&(!s||!pr(s)||e&&Mr.isDescendant(e,s))&&n.hide()}}afterHide(e=null,t=this.hideAnimation){var n,r;const i=this;i._anchor=i._configuredAnchorState,i.removeTransientListeners(),t||i.afterHideAnimation(),i.trigger("hide"),null===(n=i.owner)||void 0===n||null===(r=n.onChildHide)||void 0===r||r.call(n,i),e&&e()}removeTransientListeners(){var e,t;const n=this,{targetObserver:r}=n;n.clearTimeout(n.resizeListenerTimeout),n.clearTimeout(n.scrollListenerTimeout),r&&(r.disconnect(),r.isActive=!1),n.documentScrollListener=null===(e=n.documentScrollListener)||void 0===e?void 0:e.call(n),n.rootScrollListener=null===(t=n.rootScrollListener)||void 0===t?void 0:t.call(n),n.targetResizeListener&&(ua.removeResizeListener(n.lastAlignSpec.target,n.onTargetResize),n.targetResizeListener=!1),n.constrainListeners&&(ua.removeResizeListener(n.lastAlignSpec.constrainTo||globalThis,n.callRealign),n.constrainMutationMonitor&&n.constrainMutationMonitor.disconnect(),n.constrainListeners=!1)}afterHideAnimation(){const e=this,{element:t}=e;e.floating&&e.floatRoot.contains(t)?t.remove():t.classList.add("b-hidden"),e.defaultAnchorBackgroundColor&&e.anchorPathElement.setAttribute("fill",e.defaultAnchorBackgroundColor)}changeHidden(e){const t=this;let n;return t.isConfiguring?(n=Boolean(e),t.element.classList[e?"add":"remove"]("b-hidden")):(t.trigger("beforeChangeHidden",{hidden:e}),e?t.hide():t.show()),n}get assignedId(){return this.hasGeneratedId?null:this.id}get owner(){return this.parent||this._owner||this.containingWidget}get containingWidget(){let e=this.parent;if(!e){var t,n;const r=(null===(t=this.forElement)||void 0===t?void 0:t.nodeType)===Element.ELEMENT_NODE?this.forElement:null===(n=this.element)||void 0===n?void 0:n.parentNode;e=(null==r?void 0:r.closest(".b-widget"))&&Ka.fromElement(r)}return e}get previousSibling(){return this.getSibling(-1)}get nextSibling(){return this.getSibling(1)}getSibling(e){const t=this,{parent:n}=t,r=n?n.childItems:Array.from(t.element.parentElement.querySelectorAll(".b-widget"));return n?r[r.indexOf(t)+e]:Ka.fromElement(r[r.indexOf(t.element)+e])}up(e,t,n){const{owner:r}=this;return e?null==r?void 0:r.closest(e,t,n):r}closest(e,t,n){const r=typeof n,i="number"===r,s="string"===r;for(let r=this,o=1;r;r=r.owner,o++){if(Ka.widgetMatches(r,e,t))return r;if(i&&o>=n)return;if(s&&Ka.widgetMatches(r,n,t))return;if(r===n)return}}owns(e){if(e){if("eventPhase"in e&&(e=e.target),e.nodeType===Element.ELEMENT_NODE){if(this.element.contains(e))return!0;e=Ka.fromElement(e)}for(;e;){if(e===this)return!0;e=e.owner}}return!1}eachAncestor(e){let t=this.owner;for(;t;){if(!1===e(t))return!1;t=t.owner}return!0}changeMonitorResize(e,t){const n=!this.scaleToFitWidth&&Boolean(e);if(n!==Boolean(t))return n}updateMonitorResize(e){const t=this;Ba.call(t,"onElementResize")||(t.onElementResize=t.onElementResize.bind(t)),ua[e?"addResizeListener":"removeResizeListener"](t.element,t.onElementResize)}changeReadOnly(e){if(e=Boolean(e),Boolean(this._readOnly)!==e)return e}updateReadOnly(e){var t;null===(t=this.element)||void 0===t||t.classList[e?"add":"remove"]("b-readonly"),this.isConfiguring||(this.eachWidget((t=>{t.ignoreParentReadOnly||("_originalReadOnly"in t||(t._originalReadOnly=t.config.readOnly||!1),t.readOnly=e||t._originalReadOnly)}),!1),this.trigger("readOnly",{readOnly:e}))}eachWidget(e,t=!0){const n=this.childItems,r=(null==n?void 0:n.length)||0,i={};for(let s=0;s<r;s++){const r=n[s];if(i.down=t,!1===e(r,i))return!1;if(i.down&&r.eachWidget&&!1===r.eachWidget(e,t))return!1}return!0}queryAll(e){const t=[];return this.eachWidget((n=>{e(n)&&t.push(n)})),t}query(e){let t=null;return this.eachWidget((n=>{if(e(n))return t=n,!1})),t}getWidgetByRef(e){var t,n;return e instanceof Ka?e:(null==this||null===(t=this.widgetMap)||void 0===t?void 0:t[e])||(null==this||null===(n=this.owner)||void 0===n?void 0:n.getWidgetByRef(e))}onFocusIn(e){const t=this,{element:n}=t;t.containsFocus=!0,t.focusInEvent=e,n.classList.add("b-contains-focus"),t.updateAriaLabel(t.localizeProperty("ariaLabel")),t.updateAriaDescription(t.localizeProperty("ariaDescription")),n.contains(e._target)&&t.onInternalKeyDown&&!t.keyDownListenerRemover&&(t.keyDownListenerRemover=_n.on({element:n,keydown:"onInternalKeyDown",thisObj:t})),t.trigger("focusin",e)}onFocusOut(e){const t=this;t.keyDownListenerRemover&&(t.keyDownListenerRemover(),t.keyDownListenerRemover=null),t.isDestroyed||(e.relatedTarget||t.revertFocus(!t.isVisible),t.containsFocus=!1,t.element.classList.remove("b-contains-focus"),t.updateAriaLabel(t.localizeProperty("ariaLabel")),t.updateAriaDescription(t.localizeProperty("ariaDescription")),t.trigger("focusout",e))}captureFocus(){const e=this,t=Mr.getActiveElement(e),n=e.contains(t)&&e.captureFocusItem(t);return(r,i)=>{n&&!e.isDestroying&&(Mr.getActiveElement(e)!==t||i)&&n(r)}}captureFocusItem(e){return(t=!0)=>{this.contains(e)&&(t?e.focus():Mr.focusWithoutScrolling(e))}}contains(e,t){const{element:n}=this;if(e&&n)return e.isWidget&&(e=e.element),n.contains(e)&&(!t||n!==e)}revertFocus(e){var t,n;const r=this,i=Mr.getActiveElement(r);let s=null===(t=r.focusInEvent)||void 0===t?void 0:t.relatedTarget;(e||r.containsFocus&&(null===(n=s)||void 0===n?void 0:n.nodeType)===Element.ELEMENT_NODE&&r.element.contains(i))&&(s&&Mr.isFocusable(s)||(s=r.getFocusRevertTarget()),r._isRevertingFocus=!0,s&&Mr.isFocusable(s)?Mr.focusWithoutScrolling(s):null==i||i.blur(),r._isRevertingFocus=!1)}getFocusRevertTarget(){const e=this,{owner:t,focusInEvent:n}=e,r=n&&n.backwards?1:-1;let i=n&&n.relatedTarget;const s=i&&Ka.fromElement(i);if(t&&!t.isDestroyed&&(!i||!Mr.isFocusable(i)||s&&!s.isFocusable)){var o;if(i=null,t.eachWidget){const n=[];if(t.eachWidget((t=>{(t===e||t.isFocusable)&&n.push(t)}),!1),n.length>1){const t=n.indexOf(e);i=n[t+r]||n[t-r]}}!i&&t.isFocusable&&(i=t),i=i?i.focusElement:null===(o=t.getFocusRevertTarget)||void 0===o?void 0:o.call(t)}return i}getStaticWidgetClasses(e,t){const n=new Mn,r=this.$meta.hierarchy;let i,s,o,a,l;for(s=r.indexOf(e);s<r.length;++s){var c;i=r[s],l=Reflect.getOwnPropertyDescriptor(i.prototype,"widgetClass"),null!==(c=l)&&void 0!==c&&c.get?a=l.get.call(this):(o=Ba.call(i,"$$name")||Ba.call(i,"$name")||Ba.call(i,"_$name")?i.$$name:i.name,(o.length<3||o.includes("$"))&&console.warn(`Class "${o}" extending "${i.$name}" should have "$name" static getter with no less than 3 chars.`),a=`b-${o.toLowerCase()}`),a&&n.add(t?a+t:a)}return n}get rootUiClass(){return Ka}get staticClassList(){const{$meta:e}=this;let t=e.staticClassList;return t||(e.staticClassList=t=this.getStaticWidgetClasses(Ka),y.isTouchDevice&&t.add("b-touch")),t}get uiClasses(){return this.getConfig("ui"),this._uiClasses}get uiClassList(){return this.getConfig("ui"),this._uiClassList}get widgetClassList(){const e=this,{cls:t,defaultCls:n,uiClasses:r}=e;let{staticClassList:i}=e;(n||t)&&(i=i.clone(),n&&i.assign(n),t&&i.assign(t));const s=i.values;return r&&s.push(...r),e.floating&&s.push("b-floating"),"hide"===e.collapsify&&s.push("b-collapsify-hide"),s}changeCls(e){return Mn.from(e)}changeContentElementCls(e){return Mn.from(e)}changeHtmlCls(e){return Mn.from(e)}changeDefaultCls(e){return Mn.from(e,!0)}changeUi(e){return Mn.from(e)}updateUi(e){var t;let n,r,i=null;if(e){const t=this.getStaticWidgetClasses(this.rootUiClass);for(r in e)if(e[r])for(n in t)t[n]&&((i||(i=new Mn))[`${n}-ui-${r}`]=1)}this._uiClasses=null===(t=i)||void 0===t?void 0:t.values,this._uiClassList=i}fromCache(e,t=!1,n=this.element){if(!n)return null;const r=this;return r.cache[e]||(r.cache[e]=t?Mr.children(n,e):Mr.down(n,e)),r.cache[e]}emptyCache(){this.cache={}}changeMasked(e,t){var n;if("trial"!==(null===(n=this.masked)||void 0===n?void 0:n.type)){if(!0!==e&&""!==e||(e=" "),t&&!t.isDestroyed)"string"==typeof e?(t.text=e,e=t):e?(t.setConfig(e),e=t):t.destroy();else if(e){const t=Ka.resolveType("mask");e=t.mergeConfigs(this.maskDefaults,e),e.owner=this,e=t.mask(e)}return e||null}}onMaskAutoClose(e){e.isDestroyed&&e===this.masked&&(this.masked=null)}mask(e){return this.masked=e,this.masked}unmask(){this.masked=null}onInternalResize(e,t,n,r,i){this._width=e.offsetWidth,this._height=e.offsetHeight}onElementResize(e,t){const n=this,{element:r}=n,i=n._width,s=n._height,o=r.offsetWidth,a=r.offsetHeight;n.floating&&t&&n.onFloatingWidgetResize(...arguments),n.suspendResizeMonitor||i===o&&s===a||(n.onInternalResize(r,o,a,i,s),n.trigger("resize",{width:o,height:a,oldWidth:i,oldHeight:s}))}onFloatingWidgetResize(e,t,n){const r=this,{lastAlignSpec:i,constrainTo:s}=r;if(r.isVisible&&i&&i.target){const e=!t||n.height!==t.height,o=!t||n.width!==t.width,a=s&&!xn.from(s).contains(xn.from(r.element,null,!0));(e&&2!==i.zone||o&&1!==i.zone||a)&&r.requestAnimationFrame((()=>r.realign()))}}updateScale(){const e=this,t=e.element,n=t.parentElement;e.configuredWidth||(e.configuredWidth=e.width),t.style.display="none";const r=xn.client(n).width/e.configuredWidth,i=e.scale=e.allowGrowWidth?Math.min(r,1):r;t.style.transform=`scale(${i})`,t.style.transformOrigin="top left",t.style.display="",e.allowGrowWidth&&r>1&&(e.width=e.configuredWidth*r)}onParentElementResize(e){this.updateScale()}parseTRBL(e,t="px"){if("number"==typeof(e=e||0))return[`${e}${t}`,`${e}${t}`,`${e}${t}`,`${e}${t}`];const n=e.split(" "),r=n.length;return 1===r?n[1]=n[2]=n[3]=n[0]:2===r?(n[2]=n[0],n[3]=n[1]):3===r&&(n[3]=n[1]),[isFinite(n[0])?`${n[0]}${t}`:n[0],isFinite(n[1])?`${n[1]}${t}`:n[2],isFinite(n[2])?`${n[2]}${t}`:n[3],isFinite(n[3])?`${n[3]}${t}`:n[4]]}get documentRoot(){var e;return(null===(e=this.owner)||void 0===e?void 0:e.documentRoot)||this.element.getRootNode()}get rootElement(){const e=this;if(!e._rootElement){var t;let n=(null===(t=e.owner)||void 0===t?void 0:t.rootElement)||Mr.getRootElement(e.forElement||(fr(e.element)?e.element:e.getRenderContext()[0]||e.element));n||(n=document.body),e._rootElement=n}return e._rootElement}get floatRoot(){var e;const t=this.rootElement||(null===(e=this.owner)||void 0===e?void 0:e.rootElement);let{floatRoot:n}=t;if(n)t.contains(n)||t.appendChild(n);else{var r;const{outerCls:e}=Ka,i=null===(r=Mr.getThemeInfo(null,t))||void 0===r?void 0:r.name;if(!Mr.isValidFloatRootParent(t))throw new Error("Attaching float root to wrong root");i&&e.push(`b-theme-${i.toLowerCase()}`),n=t.floatRoot=Mr.createElement({className:`b-float-root ${e.join(" ")}`,parent:t}),Aa.push(n),y.isAndroid&&(n.style.height=`${screen.height}px`,_n.on({element:globalThis,orientationchange:()=>n.style.height=`${screen.height}px`})),!y.isHoverableDevice&&globalThis.visualViewport&&_n.on({element:globalThis.visualViewport,resize:({target:e})=>n.style.height=`${e.height}px`}),zr.on({theme:({theme:e,prev:t})=>{n.classList.add(`b-theme-${e.toLowerCase()}`),n.classList.remove(`b-theme-${t.toLowerCase()}`)}})}return n}get floatRootMaxZIndex(){let e=1;return Array.from(this.floatRoot.children).forEach((t=>{const n=parseInt(getComputedStyle(t).zIndex||0,10);n>e&&(e=n)})),e}static resetFloatRootScroll(){Aa.forEach((e=>e.scrollTop=e.scrollLeft=0))}static get floatRoots(){return Aa}static removeFloatRoot(e){Aa.splice(Aa.indexOf(e),1)}static get outerCls(){const e=["b-outer"],{platform:t}=y;return t&&e.push(`b-${t}`),y.isTouchDevice&&e.push("b-touch-events"),Mr.scrollBarWidth?e.push("b-visible-scrollbar"):e.push("b-overlay-scrollbar"),y.isChrome?e.push("b-chrome"):y.isSafari?e.push("b-safari"):y.isFirefox&&e.push("b-firefox"),globalThis.ResizeObserver||e.push("b-no-resizeobserver"),e}get isAnimating(){return this._isAnimatingCounter>0}set isAnimating(e){const t=this,{_isAnimatingCounter:n}=t;t._isAnimatingCounter=Math.max(0,n+(e?1:-1)),0===n&&e?(t.element.classList.add("b-animating"),t.trigger("animationStart")):1!==n||e||(t.element.classList.remove("b-animating"),t.trigger("animationEnd"))}async waitForAnimations(){this.isAnimating&&await this.await("animationend",{checkLog:!1})}static query(e,t=!1){const{idMap:n}=Ka.identifiable;for(const r in n)if(Ka.widgetMatches(n[r],e,t))return n[r];return null}static queryAll(e,t=!1){const{idMap:n}=Ka.identifiable,r=[];for(const i in n)Ka.widgetMatches(n[i],e,t)&&r.push(n[i]);return r}static fromElement(e,t,n){const r=typeof t;e&&!e.nodeType&&(e=e.target),("number"===r||t&&t.nodeType===Element.ELEMENT_NODE)&&(n=t,t=null);let i,s,o,a=e,l=0;for("number"!=typeof n&&(i=n,n=Number.MAX_VALUE),"string"===r&&(t=t.toLowerCase());a&&a.nodeType===Element.ELEMENT_NODE&&l<n&&a!==i;){if(s=a.dataset&&a.dataset.ownerCmp||a.id,s){if(o=Ka.getById(s),o){if(!t)return o;if("function"===r){if(t(o))return o}else if(Ka.widgetMatches(o,t,!0))return o}l++}a=a.parentNode}return null}triggerFieldChange(e,t=!0){t&&this.trigger("change",e),this.eachAncestor((t=>{var n,r;if(null===(n=t.onFieldChange)||void 0===n||n.call(t,e),null!==(r=t.isolateFieldChange)&&void 0!==r&&r.call(t,this))return!1}))}isolateFieldChange(e){return this.isolateFields}setupFocusListeners(){zr.setupFocusListenersOnce(this._rootElement,_n)}static widgetMatches(e,t,n){return"*"===t||("function"==typeof t?t(e):Ka.isType(e,t,n))}static attachTooltip(e,t){return"string"==typeof t&&(t={html:t}),Ka.create(Object.assign({forElement:e},t),"tooltip"),e}changeDock(e){return"start"===e?"left":"end"===e?"right":e}updateRtl(e){super.updateRtl(e),this.eachWidget((t=>{"rtl"in t.initialConfig||(t.rtl=e)}))}}const Xa=Ka.prototype;["compose","domSyncCallback"].forEach((e=>Xa[e].$nullFn=!0)),Ka.initClass(),Ka.register("mask",Ta),Mr.Widget=Ka,zr.Widget=Ka,Ta.identifiable.idMap=Ka.identifiable.idMap,Object.assign(globalThis.bryntum||(globalThis.bryntum={}),{get:Ka.getById.bind(Ka),query:Ka.query,queryAll:Ka.queryAll,fromElement:Ka.fromElement}),Ka._$name="Widget";class Za extends(Te.mixin(tt,Ci)){static get type(){return"default"}static get configurable(){return{owner:null,containerCls:"b-auto-container",itemCls:null}}static get factoryable(){return{defaultType:"default"}}get contentElement(){var e;return null===(e=this.owner)||void 0===e?void 0:e.contentElement}onChildAdd(e){}onChildRemove(e){}renderChildren(){const e=this,{owner:t,itemCls:n}=e,{contentElement:r,items:i}=t,s=t.itemCls,o=null==i?void 0:i.length;if(o){t.textContent=!1;for(let e=0;e<o;e++){const o=i[e],{element:a}=o,{classList:l}=a;a.dataset.itemIndex=e,l.contains("b-outer")&&l.remove(...Ka.outerCls),n&&l.add(n),s&&l.add(s),o.render(r,Boolean(t.isPainted))}}e.syncPendingConfigs(),e.syncChildCount()}removeChild(e){const t=this,{element:n}=e,{owner:r,itemCls:i}=t,{contentElement:s}=r,o=r.itemCls;s.contains(n)&&n.remove(),delete n.dataset.itemIndex,i&&n.classList.remove(i),o&&n.classList.remove(o),t.fixChildIndices(),t.syncChildCount()}appendChild(e){const{element:t}=e,{owner:n,itemCls:r}=this,{contentElement:i}=n,s=n.itemCls;t.dataset.itemIndex=n.indexOfChild(e),n.textContent=!1,r&&t.classList.add(r),s&&t.classList.add(s),e.render(i,Boolean(n.isPainted)),this.syncChildCount()}insertChild(e,t){const n=this,{element:r}=e,{owner:i,itemCls:s}=n,{contentElement:o}=i,a=Mr.getChild(o,`[data-item-index="${t}"]`),l=i.itemCls;i.textContent=!1,s&&r.classList.add(s),l&&r.classList.add(l),o.insertBefore(r,a),e.render(null,Boolean(i.isPainted)),n.fixChildIndices(),n.syncChildCount()}fixChildIndices(){this.owner.items.forEach(((e,t)=>{e.element.dataset.itemIndex=t}))}syncChildCount(){var e;const{owner:t}=this,{length:n}=t.items;null===(e=t.contentElement)||void 0===e||e.classList[1===n?"add":"remove"]("b-single-child")}syncConfigLater(e){const t=this.pendingConfigs||(this.pendingConfigs=[]);t.includes(e)||t.push(e)}syncConfigStyle({name:e,style:t,classes:n,map:r}){const i=this,s=`b-box-${e}-`,{contentElement:o}=i,a=i[e];let l=(null==r?void 0:r[a])||a;if(o){if(n){const{classList:e}=o;n.forEach((t=>{t!==l&&e.remove(s+t)})),n.includes(l)&&(e.add(s+l),l="")}o.style[t]=l}else i.syncConfigLater(e)}syncPendingConfigs(){const e=this,{pendingConfigs:t}=e;let n;if(t)for(e.pendingConfigs=null;n=t.pop();)e[e.$meta.configs[n].updater](e[n])}}Za.initClass(),Za._$name="Layout";let Ja=0;const Qa=e=>e.ripple;class el extends Ka{static get defaultConfig(){return{old_element:{children:[{className:"b-ripple-inner",reference:"rippleElement"}]},element:{children:[{tag:"svg",class:"b-ripple-inner",reference:"rippleElement",ns:"http://www.w3.org/2000/svg",version:"1.1",viewBox:"0 0 100 100",children:[{reference:"circleElement",tag:"circle",cx:"0",cy:"0",r:10}]}]},floating:!0,hideAnimation:!1,showAnimation:!1,scrollAction:"realign",color:"rgba(0,0,0,.3)",startRadius:10,radius:100}}static get $name(){return"Ripple"}afterConstruct(){super.afterConstruct(),_n.on({element:this.rootElement,mousedown:"onRippleControllingEvent",thisObj:this,capture:!0,once:!0})}onRippleControllingEvent(e){var t;const n=this;n.show();const r=Mr.getStyleValue(n.circleElement,"animationName");n.hide(),null===(t=n.listenerDetacher)||void 0===t||t.call(n),r&&"none"!==r&&(n.listenerDetacher=_n.on({mousedown:{element:n.rootElement,capture:!0,handler:"onMousedown"},touchstart:{element:n.rootElement,capture:!0,handler:"onTouchStart"},animationend:{element:n.circleElement,handler:"onAnimationEnd"},thisObj:n}),"mousedown"===e.type&&(n.onMousedown(e),zr.on({theme:"onRippleControllingEvent",thisObj:this})))}onTouchStart(e){Ja=performance.now(),this.handleTriggerEvent(e)}onMousedown(e){performance.now()-Ja>200&&this.handleTriggerEvent(e)}handleTriggerEvent(e){const t=Ka.fromElement(e.target,Qa);if(t){const n=t.ripple,r=n.delegate?e.target.closest(n.delegate):t.focusElement||t.element;if(r){const i=sn.assign({event:e,target:r,radius:this.radius},n);if("string"==typeof i.clip&&(i.clip=t[i.clip]||e.target.closest(i.clip),!i.clip))return;this.ripple(i)}}}ripple({event:e,point:t=_n.getClientPoint(e),target:n=e.target,clip:r=n,radius:i=this.radius,color:s=this.color}){this.clip=r;const o=this,a=(r=xn.from(r,null,!0)).getDelta(t),l=o.rippleElement.style,c=o.circleElement,d=Mr.getStyleValue(n,"border-radius");o.hide(),l.transform=`translateX(${a[0]}px) translateY(${a[1]}px)`,l.height=l.width=`${i}px`,o.element.style.borderRadius=d,c.setAttribute("r",i),c.setAttribute("fill",s),o.showBy({target:r,align:"c-c",matchSize:!0})}onAnimationEnd(e){"b-ripple-expand"===e.animationName&&this.hide()}}Ka.RippleClass=el,el._$name="Ripple";const tl=Object.freeze({}),{isArray:nl}=Array,rl=e=>e.weight,il=({weight:e},{weight:t})=>"string"==typeof e||"string"==typeof t?String(e).localeCompare(String(t)):(null!=e?e:Number.MAX_SAFE_INTEGER)-(null!=t?t:Number.MAX_SAFE_INTEGER),sl=e=>e&&!e.hidden,ol=["display","flex-direction"],al={default:1,box:1};class ll extends Ka{static get $name(){return"Container"}static get type(){return"container"}static get configurable(){return{items:null,lazyItems:{$config:["lazy"],value:null},defaults:null,defaultType:"widget",layoutStyle:null,itemCls:null,layout:{type:"default"},namedItems:null,overflowable:{value:null,default:!1,$config:null},textContent:!0,record:null,autoUpdateRecord:null,autoUpdateFields:null,hideWhenEmpty:null,contentElMutationObserver:{$config:["lazy","nullify"],value:!0},isolateFields:!1,focusDescendant:!1,defaultBindProperty:null,defaultFocus:null}}static get prototypeProperties(){return{flexRowCls:"b-flex-row",flexColCls:"b-flex-column",initialItems:!0}}startConfigure(e){const t=e.items||e.lazyItems;(this.hasItems=Boolean(t&&(nl(t)?t:Object.keys(t)).length))||(this.initialItems=!1),super.startConfigure(e)}get firstItem(){return this.getAt(0)}get lastItem(){return this.getAt(-1)}getAt(e){return this.ensureItems().at(e)}remove(...e){let t=!0;1===e.length&&(nl(e[0])?e=e[0]:t=!1);const n=this,{_items:r}=n,i=[];for(let t=0;t<e.length;t++){const s=e[t];r.includes(s)&&(r.remove(s),n.layout.removeChild(s),i.push(s),n.onChildRemove(s))}return t?i:i[0]}removeAll(){return this.remove(this.items)}add(...e){const t=this,n=t.ensureItems(),r=[];let i,s,o,a=!0;for(1===e.length&&(nl(e[0])?e=e[0]:a=!1),s=0;s<e.length;s++){var l;i=e[s],i.isWidget?i.parent=t:i=t.createWidget(i),null!=(null===(l=i)||void 0===l?void 0:l.weight)?(o=ke.findInsertionIndex(i,n.values,il),r.push(t.insert(i,o))):i&&(n.includes(i)||(n.add(i),t.onChildAdd(i),t.layout.appendChild(i),r.push(i)))}return a?r:r[0]}ensureItems(){const e=this;return e.getConfig("items"),e.getConfig("lazyItems"),e._items||(e.items=[]),e._items}insert(e,t){const n=this,r=n.ensureItems();e instanceof Ka?e.parent=n:e=n.createWidget(e),r.includes(t)&&(t=n.indexOfChild(t)),t=Math.min(t,r.count);const i=r.values;return i.splice(t,0,e),r.values=i,n.onChildAdd(e),n.layout.insertChild(e,t),e}indexOfChild(e){return this.items.indexOf(e)}changeLazyItems(e){this.items=e,this.layout.renderChildren()}changeItems(e,t){const n=this,r=[],i=new os;return nl(e)?n.processItemsArray(e,r):e&&n.processItemsObject(e,n.namedItems,r),r.some(rl)&&r.sort(il),i.add(r),t&&t.forEach((e=>{n.remove(e),i.includes(e)||e._createdBy!==n||e.destroy()})),i}afterConstruct(){const{rtl:e}=this,{classList:t}=this.contentElement;t.toggle("b-rtl",!0===e),t.toggle("b-ltr",!1===e)}updateRtl(e){super.updateRtl(e);const{contentElement:t}=this;t&&(t.classList.toggle("b-rtl",!0===e),t.classList.toggle("b-ltr",!1===e))}updateItems(e,t){let n=0;e.forEach((e=>{this.onChildAdd(e),t&&!t.temporary&&this.layout.insertChild(e,n),++n})),this.initialItems=!1}updateHideWhenEmpty(){this.syncChildCount(this.rendered)}get items(){const e=this;if(e.getConfig("lazyItems"),!e._items){if(e.initializingItems)return[];e._items=new os,e._items.temporary=!0}return e._items.values}processItemsArray(e,t){const n=e.length;let r,i;for(r=0;r<n;r++)i=e[r],i instanceof Ka?(i.parent=this,i.element.classList.remove(...Ka.outerCls)):i=this.createWidget(i),i&&((i.ref||i.id)&&this.addDescendant(i),t.push(i))}processItemsObject(e,t,n){let r,i;for(i in e)r=e[i],r&&(t&&i in t&&(r="object"==typeof r?sn.merge(sn.clone(t[i]),r):t[i]),r&&(r instanceof Ka?r.parent=this:(r instanceof Object&&(r.ref=i),r=this.createWidget(r)),r&&(r.ref=i,this.addDescendant(r),n.push(r))))}onChildAdd(e){if(e.innerItem&&this.readOnly&&!e.ignoreParentReadOnly&&(e.readOnly=!0),this.onChildAddLayout(e),e.ref||e.id)for(let t=this;t;t=t.parent)t.addDescendant(e);this.syncChildCount(!0)}onChildAddLayout(e){e.innerItem&&this.layout.onChildAdd(e)}onChildHide(e){var t;super.onChildHide(e),null!==(t=this._items)&&void 0!==t&&t.includes(e)&&this.syncChildCount(!0)}onChildShow(e){var t;super.onChildShow(e),null!==(t=this._items)&&void 0!==t&&t.includes(e)&&this.syncChildCount(!0)}syncChildCount(e){if(!this.isConfiguring){const t=this,{items:n,hasItems:r}=t,i=n.filter(sl),{length:s}=i;if(t.visibleChildCount=s,t.hideWhenEmpty&&e){const e=Boolean(!s);Boolean(t._hidden)!==e&&(t.hidden=e)}n.forEach((e=>e.element.classList.remove("b-last-visible-child","b-first-visible-child"))),s&&(i[0].element.classList.add("b-first-visible-child"),i[s-1].element.classList.add("b-last-visible-child")),t.hasItems=Boolean(t.childItems.length),t.contentElement.classList[s?"remove":"add"]("b-no-visible-children"),t.isComposable?r!==t.hasItems&&t.recompose():t.updateTextContent(t._textContent)}}syncFlexDirection(){const{contentElement:e,flexColCls:t,flexRowCls:n}=this,r=new Mn(e.className),i=Mr.getStyleValue(e,ol);r[n]=r[t]=0,"flex"===i.display&&(r["row"===i["flex-direction"]?n:t]=1),Mr.syncClassList(e,r)}addDescendant(e){const t=e.ref||e.id,n=this._widgetMap||(this._widgetMap={});n[t]||(n[t]=e)}onChildRemove(e){const t=this,n=e.ref||e.id;if(n)for(let r=t;r;r=r.parent)r.widgetMap[n]===e&&delete r.widgetMap[n];t.layout.onChildRemove(e),t.syncChildCount(!0)}get widgetMap(){return this._widgetMap||(this._widgetMap={}),this.initializingItems||this.getConfig("items"),this._widgetMap}changeRecord(e){return this._record=null==e?tl:null,e}updateRecord(e){var t;const n=this;null===(t=n.recordUpdateDetacher)||void 0===t||t.call(n),n.trigger("beforeSetRecord",{record:e}),n.setValues(e,{onlyName:!0,highlight:Boolean(n.$highlight)}),n.autoUpdateFields&&null!=e&&e.firstStore&&(n.recordUpdateDetacher=e.firstStore.on({update:n.onRecordUpdated,thisObj:n}))}setRecord(e,t){this.$highlight=t,this.record=e,this.$highlight=!1}onRecordUpdated({record:e}){e===this.record&&this.setValues(this.record,!0,!0)}onFieldChange({source:e,userAction:t}){if(this.autoUpdateRecord&&t){const{record:t}=this,{name:n,isValid:r,value:i}=e;t&&n&&r&&(t[n]=i)}}getValues(e){const t={};return this.eachWidget(((n,r)=>{n.isolateFields?r.down=!1:!("name"in n)||e&&!e(n)||(t[n.name]=n.value)}),!0),t}get hasNoChildren(){const e=this,{items:t,lazyItems:n}=e.initialConfig,r=t&&(nl(t)?t:sn.values(t)),i=n&&(nl(n)?n:sn.values(n)),s=e.isConfiguring?i||r:e.items;return!(null!=s&&s.filter(sl).length)}afterRecompose(){super.afterRecompose(),this.realign()}updateTextContent(e){const t=this;t.isComposable||(t.contentElement.classList[e&&t.hasNoChildren?"add":"remove"]("b-text-content"),t.rendered&&t.realign())}updateLayoutStyle(e){Mr.applyStyle(this.contentElement,e)}updateElement(e){if(super.updateElement(...arguments),e){const{classList:e}=this.contentElement,{containerCls:t}=this.layout;e.add("b-content-element"),t&&e.add(t)}}onPaint(){var e;null===(e=super.onPaint)||void 0===e||e.call(this,...arguments),this.getConfig("contentElMutationObserver")}changeContentElMutationObserver(e,t){if(t&&(t.takeRecords(),t.disconnect()),e){const t=this,{element:n,contentElement:r}=t;(e=new MutationObserver((e=>t.onContentElMutation(e)))).observe(r,{attributes:!0}),r!==n&&e.observe(n,{attributes:!0}),t.syncFlexDirection()}return e}onContentElMutation(){al[this.layout.type]&&this.isVisible&&this.syncFlexDirection()}changeLayout(e,t){return Za.reconfigure(t,e,{owner:this,defaults:{owner:this}})}get childItems(){return this.items}getWidgetById(e){return this.widgetMap[e]}processWidgetConfig(e){}setupWidgetConfig(e,t){const n=this;"string"==typeof e?e={html:e}:e.nodeType===Element.ELEMENT_NODE&&(e={element:e,id:e.id}),("string"==typeof t||!t&&(t=e.type))&&(t=Ka.resolveType(t,!0));for(let r=(e=(t||Ka).mergeConfigs(n.defaults,e,{parent:n})).parent;r;r=r.parent)if(!1===r.processWidgetConfig(e))return null;return!1===n.trigger("beforeWidgetCreate",{widgetConfig:e})?null:e}createWidget(e){const t=Ka.create(this.setupWidgetConfig(e),this.defaultType);return t&&(t._createdBy=this),t}updateDefaults(e,t){if(!this.isConfiguring&&e){const n=Object.entries(e);this.eachWidget((e=>{n.forEach((([n,r])=>{t&&e[n]!==t[n]||(e[n]=r)}))}),!1)}}render(){this.getConfig("lazyItems"),this.layout.renderChildren(),this.syncChildCount(),super.render(...arguments)}get focusElement(){const e=this.query(this.defaultFocus||(e=>e.isFocusable&&"close"!==e.ref));return e?e.focusElement:super.focusElement}doDestroy(){var e;null===(e=this._items)||void 0===e||e.forEach((e=>{var t;return null===(t=e.destroy)||void 0===t?void 0:t.call(e)})),this.layout.destroy(),super.doDestroy()}get isValid(){let e=!0;return this.eachWidget((t=>{t.isVisible&&"isValid"in t&&!t.isValid&&(e=!1)}),!0),e}get values(){const e={};return this.gatherValue(e),e}set values(e){this.assignValue(e)}get isSettingValues(){return Boolean(this.assigningValues)}get assigningValues(){var e;return this._assigningValues||(null===(e=this.parent)||void 0===e?void 0:e.assigningValues)}set assigningValues(e){this._assigningValues=e}assignValue(e,t){super.assignValue(e,t),this.isolateFields||this.setValues(e,t)}gatherValue(e){super.gatherValue(e),this.isolateFields||this.gatherValues(e)}setValues(e,t){t=t||this.assignValueDefaults,this.assigningValues=t,this.eachWidget((n=>n.assignValue(e,t)),!1),this.assigningValues=!1}}ll.initClass(),ll._$name="Container";const{assign:cl}=sn,dl=()=>performance.now(),ul={start:!1},hl=/^[.\d]+([^\d].*)?$/,gl=e=>{const t=e.$bryntum||(e.$bryntum={});return t.transitions||(t.transitions=Object.create(null))},ml=(e,t)=>{var n;return"string"==typeof e&&(t=null===(n=hl.exec(e))||void 0===n?void 0:n[1],e=parseFloat(e)),e&&e*("s"===t||!t&&e<10?1e3:1)},pl=e=>{const t=sn.values(gl(e)).filter((e=>null==e.completed)).map((e=>e.toString()));e.style.transition=t.join(", ")},fl=e=>class extends e{static get prototypeProperties(){return{_delay:null,_duration:null,_retain:null,_timing:null,_unit:null,owner:null,reverting:null}}constructor(...e){super(...e),this.id=++vl}start(){this.startTime=dl()}get delay(){var e,t,n;return ml(null!==(e=null!==(t=this._delay)&&void 0!==t?t:null===(n=this.owner)||void 0===n?void 0:n.delay)&&void 0!==e?e:0,this.unit)}set delay(e){this._delay=e}get duration(){var e;const{owner:t,unit:n}=this;return ml(null!==(e=this._duration)&&void 0!==e?e:t?t.duration:bl.defaultDuration,n)}set duration(e){this._duration=e}get elapsed(){return dl()-this.startTime}get remaining(){return this.duration-this.elapsed}get retain(){var e,t;return null!==(e=this._retain)&&void 0!==e?e:null===(t=this.owner)||void 0===t?void 0:t.retain}set retain(e){this._retain=e}get timing(){var e,t;return null!==(e=this._timing)&&void 0!==e?e:null===(t=this.owner)||void 0===t?void 0:t.timing}set timing(e){this._timing=e}get unit(){var e,t;return null!==(e=this._unit)&&void 0!==e?e:null===(t=this.owner)||void 0===t?void 0:t.unit}set unit(e){this._unit=e}};let vl=0;class yl extends(Te.mixin(fl)){static get $name(){return"AnimatorTransition"}static get prototypeProperties(){return{element:null,property:null,from:null,to:null,completed:null,promissory:null,reverting:null}}afterConstruct(){super.afterConstruct();const e=this,{element:t,transitions:n}=e;let{property:r}=e;[r,e.to]=Mr.unitize(r,e.to),e.from=Mr.unitize(r,e.from)[1],e.promissory=new Ea,e.property=r;const i=n[r];n[r]=e;let{from:s}=e;i&&(e.from=i.to,s=null,i.destroy()),null===s&&(s=e.getCurrentStyleValue(),i||(e.from=s)),t.style[r]=s,e.getCurrentStyleValue()}doDestroy(){const e=this;e.finish(!1),e.completed&&!e.retain&&e.clearStyle(),super.doDestroy()}get promise(){var e;return null===(e=this.promissory)||void 0===e?void 0:e.promise}get transitions(){return gl(this.element)}clearStyle(){this.setStyle("")}finish(e){const t=this,{transitions:n,promissory:r,property:i}=t;r&&(t.completed=e,t.promissory=null,r.resolve(e),n[i]===t?(delete n[i],e||(pl(t.element),t.clearStyle())):t.completed=!1)}getCurrentStyleValue(){return Mr.getStyleValue(this.element,this.property)}revert(){const{duration:e,elapsed:t,element:n,from:r,property:i,_retain:s,_timing:o}=this;return new yl({element:n,property:i,retain:s,timing:o,duration:Math.round(Math.min(e,t)),reverting:this,to:r,unit:"ms"})}setStyle(e){this.element.style[this.property]=e}start(){const e=this,{delay:t,duration:n,element:r,property:i}=e;_n.onTransitionEnd({element:r,property:i,duration:t+n+20,thisObj:e.owner,handler:()=>{var t;return null===(t=e.finish)||void 0===t?void 0:t.call(e,!0)}}),super.start(),e.setStyle(e.to)}toString(){const{delay:e,duration:t,property:n,timing:r}=this;return`${n} ${t}ms ${r||"ease-in-out"}${e?` ${e}ms`:""}`}}yl.initClass();class bl extends(Te.mixin(fl)){static get $name(){return"Animator"}static get prototypeProperties(){return{element:null,finalize:null,prefinalize:null,completed:null,items:null}}static register(e,t){sn.isObject(e)?sn.entries(e).forEach((e=>bl.register(...e))):(bl.fx[e]=t,bl[e]=t=>(Mr.isElement(t)?t={element:t,[e]:{}}:delete(t={element:t.element,[e]:t})[e].element,bl.run(t)))}static run(e){return new bl(e).start()}constructor(e){var t;super(null);const n=this,r=[],i={};let s,o,a,l;if(Array.isArray(e))n.items=e;else for(a in e)(bl.specialPropsRe.test(a)?n:i)[a]=e[a];sn.keys(i).forEach((e=>{l=i[e],null!=l&&!1!==l&&l==l&&((o=bl.fx[e])?(l=cl(n.defaults,o(l,n,e)),l.owner=n,s=new bl(l)):(l=cl(n.defaults,"object"==typeof l?l:{to:l}),l.owner=n,l.property=e,s=new yl(l)),r.push(s))})),null===(t=n.items)||void 0===t||t.forEach((e=>{sn.isInstantiated(e)?e.owner=n:((e=cl(n.defaults,e)).owner=n,e=new bl(e)),r.push(e)})),n.items=r,n.promise=(1===r.length?r[0].promise:Promise.all(r.map((e=>e.promise)))).then((e=>{var t;return null===(t=n.finish)||void 0===t||t.call(n,e),n.completed||!1}))}doDestroy(){this.items.forEach((e=>e.destroy())),super.doDestroy()}get defaults(){return{element:this.element}}get retain(){const{_retain:e,finalize:t,owner:n}=this;return null!=e?e:!t&&(!n||n.retain)}set retain(e){super.retain=e}done(){return this.promise}finish(e){var t,n;const r=this,{items:i}=r;for(pl(r.element),r.completed="boolean"==typeof e?e:!e.some((e=>!e)),null===(t=r.prefinalize)||void 0===t||t.call(r,r.completed,r);i.length;)i.pop().destroy();null===(n=r.finalize)||void 0===n||n.call(r,r.completed,r)}revert(e){var t;const n=this,{reverting:r}=n,i=!e||null===(t=e.start)||void 0===t||t;let s=n.defaults;return r&&(r.finalize&&(s.finalize=r.finalize),r.prefinalize&&(s.prefinalize=r.prefinalize),s.retain=r._retain),s=cl(s,e,{items:n.items.map((e=>e.revert(ul))),reverting:n}),s=new bl(s),i&&s.start(),s}start(){const{element:e,items:t}=this;return super.start(),t.length&&(pl(e),t.forEach((e=>e.start()))),this}}bl.initClass().Transition=yl,bl.specialPropsRe=new RegExp(`^(?:${Object.keys(bl.prototypeProperties).concat(Object.keys(bl.superclass.prototypeProperties)).map((e=>"_"===e[0]?e.substr(1):e)).join("|")})$`),bl.defaultDuration=200,bl.fx={},bl.register({puff(e){return!0===e?e={}:"object"!=typeof e?e={transform:`scale(${e})`}:e.scale&&((e=sn.clone(e)).transform=`scale(${e.scale})`,delete e.scale),cl({opacity:0,transform:"scale(8)"},e)}}),bl._$name="Animator";class Cl extends(Te.mixin(Zr)){static get configurable(){return{element:null,delegate:null,delay:500,startRate:2,endRate:20,accelerateDuration:4e3,pressedCls:"b-pressed"}}doDestroy(){var e;null===(e=this.mousedownRemover)||void 0===e||e.call(this),this.cancel(),super.doDestroy()}cancel(){var e,t,n;const r=this;null===(e=r.activeElement)||void 0===e||e.classList.remove(r.pressedCls),r.activeElement=null,null===(t=r.acceleration)||void 0===t||t.cancel(),r.activeListenerRemover=null===(n=r.activeListenerRemover)||void 0===n?void 0:n.call(r),r.clearTimeout(r.autoRepeatTimer),r.clearTimeout(r.repeatTimer)}updateElement(e){var t;null===(t=this.mousedownRemover)||void 0===t||t.call(this),this.mousedownRemover=_n.on({element:e,mousedown:"onMouseDown",thisObj:this})}onMouseDown(e){const t=this,n=t.delegate?e.target.closest(t.delegate):t.element;t.cancel(),n&&(t.activeElement=n,t.triggerEvent=e,n.classList.add(t.pressedCls),t.activeListenerRemover=_n.on({mouseup:{element:document,capture:!0,handler:"onMouseUp"},mousemove:{element:n,handler:"onTargetMouseMove"},mouseleave:{element:n,handler:"onTargetMouseLeave"},mouseenter:{element:n,handler:"onTargetMouseEnter"},thisObj:t}),t.autoRepeatTimer=t.setTimeout("startAutoRepeat",t.delay))}onMouseUp(){this.cancel()}onTargetMouseLeave(){this.activeElement.classList.remove(this.pressedCls),this.clearTimeout(this.repeatTimer)}onTargetMouseEnter(e){const t=this;e.buttons?(t.activeElement.classList.add(t.pressedCls),t.triggerEvent=e,t.fireClick()):t.cancel()}onTargetMouseMove(e){this.triggerEvent=e}startAutoRepeat(){const e=this;e.interval=e.startInterval=1e3/e.startRate,e.accelerationDelta=e.startInterval-1e3/e.endRate,e.fireClick(),e.acceleration=$e.animate(e.accelerateDuration,e.nextTick,e,"easeOutQuad")}nextTick(e){this.interval=this.startInterval-this.accelerationDelta*e}fireClick(){const e=this,t=new MouseEvent("click",e.triggerEvent);e.triggerEvent.target.dispatchEvent(t),e.repeatTimer=e.setTimeout(e.fireClick,e.interval)}}Cl._$name="ClickRepeater";const wl=/^(?:undefined|null|LEFT|RIGHT)$/,Sl={TOP:"BOTTOM",RIGHT:"LEFT",BOTTOM:"TOP",LEFT:"RIGHT"},Dl=e=>{const t=null==e?void 0:e.toUpperCase();return[t,"LEFT"===t||"RIGHT"===t]};var El=e=>class extends(e||Te){static get $name(){return"Rotatable"}static get configurable(){return{rotate:null,invertRotate:null}}compose(){const{rotate:e}=this;return{class:{[`b-rotate-${(e||"").toLowerCase()}`]:e,"b-rotate-vertical":e}}}syncRotationToDock(e){if(wl.test(String(this.rotate))){const[t,n]=Dl(e);this.rotate=n?this.invertRotate?Sl[t]:t:null}}get widgetClass(){return null}};class xl extends(Ka.mixin(El)){compose(){const{align:e,href:t}=this;return{tag:null!=t?"a":"button",class:{[`b-align-${e||"end"}`]:1,"b-icon":1},listeners:{click:"onInternalClick"}}}get focusElement(){return this.element}get panel(){var e,t;if(null!==(e=this.parent)&&void 0!==e&&e.isPanel&&(null===(t=this.element)||void 0===t?void 0:t.parentNode)===this.parent.headerElement)return this.parent}changeAlign(e){return e}onInternalClick(e){const t=this,{handler:n,panel:r}=t,i={domEvent:e,tool:t};t.disabled||(t.trigger("click",i),t.isDestroyed||(t.trigger("action",i),t.isDestroyed||!1===(null==r?void 0:r.trigger("toolClick",i))||n&&t.callback(n,r,[e,r,t])))}onInternalKeyDown(e){"Enter"===(e.key.trim()||e.code)&&(e.cancelBubble=!0,e.stopPropagation())}updateDisabled(e,t){var n;super.updateDisabled(e,t),e&&(null===(n=this.repeat)||void 0===n||n.cancel())}changeRepeat(e,t){return null==t||t.destroy(),e&&Cl.new({element:this.element},e)}}v(xl,"$name","Tool"),v(xl,"type","tool"),v(xl,"configurable",{align:{value:null,$config:{merge:"replace"}},href:null,repeat:null,defaultBindProperty:null}),xl.initClass(),xl._$name="Tool";const Rl=/right/i,Tl=e=>(e.collapsed||e.collapsing)&&e.owner.collapsible.direction.match(Rl)?"start":"end";class Ml extends xl{static get $name(){return"CollapseTool"}static get type(){return"collapsetool"}static get configurable(){return{autoAlign:!0,collapsed:null,collapsing:null,collapsify:!1,direction:"up",defaultBindProperty:null}}compose(){const{collapsed:e,direction:t}=this;return{class:{[`b-icon-collapse-${t}`]:1,"b-collapsed":e}}}changeAutoAlign(e){return!0===e?Tl:e}syncAutoAlign(){const{autoAlign:e}=this;e&&(this.align=e(this))}updateAutoAlign(){this.syncAutoAlign()}updateCollapsed(){this.syncAutoAlign()}updateCollapsing(){this.syncAutoAlign()}updateDirection(){this.syncAutoAlign()}}Ml.initClass(),Ml._$name="CollapseTool";const kl=/^(?:UP|DOWN|LEFT|RIGHT)$/,Il=[],Al=[Il,Il],Fl="b-panel-collapse-revealer",Ol=/^(?:left|right)$/i,{round:Ll}=Math,Pl=["up","down","left","right"].reduce(((e,t)=>(e[t.toUpperCase()]=e[t]=t,e)),{}),$l={top:["top","bottom"],right:["right","left"],bottom:["bottom","top"],left:["left","right"]},_l={hl:"LEFT",hr:"RIGHT",vb:"DOWN",vt:"UP"},Nl={h:"w",w:"h"},Hl={up:"top",right:"right",down:"bottom",left:"left"},Bl={top:!1,right:!0,bottom:!1,left:!0},jl={top:"UP",right:"RIGHT",bottom:"DOWN",left:"LEFT"};let Vl=0;class zl extends(Te.mixin(Ci)){static get $name(){return"PanelCollapser"}static get type(){return"inline"}static get configurable(){return{animation:{duration:200},collapsed:{value:null,$config:null,default:!1},direction:null,collapseTooltip:"L{Collapse}",expandTooltip:"L{Expand}",panel:{value:null,$config:"nullify"},supportAxis:null,tool:{type:"collapsetool",handler(e){var t;null===(t=this.collapsible)||void 0===t||t.onCollapseClick(e)}}}}static get factoryable(){return{defaultType:"inline"}}get collapsing(){return"collapsing"===this.collapsingExpanding}get collapsingExpanding(){var e;const t=null===(e=this.currentOperation)||void 0===e?void 0:e.collapsing;return null==t?null:t?"collapsing":"expanding"}get currentDock(){var e,t,n,r;return null!==(e=null===(t=this.panel)||void 0===t||null===(n=t.header)||void 0===n||null===(r=n.dock)||void 0===r?void 0:r.toLowerCase())&&void 0!==e?e:"top"}get expanding(){return"expanding"===this.collapsingExpanding}get collapseTool(){var e,t;return null===(e=this.panel)||void 0===e||null===(t=e.tools)||void 0===t?void 0:t.collapse}get collapseDim(){return Ol.test(this.collapseDir)?"width":"height"}getCollapseDir(e){let{direction:t,panel:n}=this;if(!t||kl.test(t)){const e=null==n?void 0:n.placement;var r;t=e?_l[e]:jl[(null==n||null===(r=n.header)||void 0===r?void 0:r.dock)||"top"]}return e?Pl[t]:t}get collapseDir(){return this.getCollapseDir(!0)}get collapseDock(){const{panel:e}=this,t=e.hasHeader&&e.expandedHeaderDock,n=Hl[this.collapseDir];return t&&Bl[n]===Bl[t]?t:n}get toolsConfig(){const{direction:e,tool:t}=this;return t&&{collapse:sn.assign({direction:e.toLowerCase()},t)}}beforeCollapse(e){}changeTool(e){const t=this,{panel:n}=t;if(t.isConfiguring||t.isDestroying||!n||n.isDestroying)return e;n.tools={collapse:e}}collapse(e){var t,n,r,i,s;const o=this,{panel:a}=o,l={id:++Vl,completed:!1,panel:a};let{currentOperation:c}=o;return e=null===(t=e)||void 0===t||t,sn.isObject(e)&&(l.collapsed=!0,sn.assign(l,e),e=l.collapsed,delete l.collapsed),l.collapsing=e,l.previous=null!==(n=c)&&void 0!==n?n:null,e!==o.collapsed?c?c.collapsing!==e&&(l.animation=c.animation.revert({finalize(){var e;null===(e=o.collapseFinalize)||void 0===e||e.call(o,l,!0)}}),l.collapsing=e,c=l):(l.animation=sn.clone(("animation"in l?l:o).animation),!1!==o.beforeCollapse(l)&&(l.animation&&(l.animation.finalize=e=>{var t;return null===(t=o.collapseFinalize)||void 0===t?void 0:t.call(o,l,e)}),a.changingCollapse=!0,o[e?"collapseBegin":"expandBegin"](l),l.animation?c=l:(l.completed=!0,o[e?"collapseEnd":"expandEnd"](l)),a.changingCollapse=!1,l.animation||o.onComplete(e?"collapse":"expand"))):c&&c.collapsing!==e&&(o[e?"expandRevert":"collapseRevert"](l),l.animation=c.animation.revert({finalize(){var e;null===(e=o.collapseFinalize)||void 0===e||e.call(o,l,!1)}}),c=l),o.currentOperation=c,null!==(r=null===(i=c)||void 0===i||null===(s=i.animation)||void 0===s?void 0:s.done())&&void 0!==r?r:Promise.resolve(e===o.collapsed)}collapseFinalize(e,t){const n=this,{currentOperation:r,panel:i}=n,s=i.collapsed?"expand":"collapse";r===e&&(n.currentOperation=null,e.completed=t,i.changingCollapse=!0,n[s+"End"](e),i.changingCollapse=!1,t&&n.onComplete(s))}applyHeaderDock(e,t=!0){const{currentDock:n,panel:r}=this,i=e?this.collapseDock:r.expandedHeaderDock;i!==n&&r.hasHeader&&(r.header={dock:i},t&&r.recompose.flush())}composeHeader(e){return e.class[Fl]=1,e}composeTitle(e){return e.class[Fl]=1,e}collapseBegin(e){var t;const n=this,{animation:r}=e,{collapseDim:i,collapseTool:s,panel:o}=n,{element:a}=o,l=null==s?void 0:s.element.classList;n.configuredWidth=o._lastWidth,n.configuredHeight=o._lastHeight,n.applyHeaderDock(!0);const c=o.rectangle(),d=n.lockInnerSize().moveTo(0,0),u=d.clone(),h=$l[n.collapseDock],g=null===(t=o.headerElement)||void 0===t?void 0:t.getBoundingClientRect(),m=Ll((null==g?void 0:g[i])||0);r?(u[h[0]]=u[h[1]],a.classList.add("b-collapsing"),null==l||l.add("b-collapsed","b-collapsing"),s&&(s.collapsing=!0),l&&(l.remove("b-collapsed"),o.rectangle(),l.remove("b-collapsing"),l.add("b-collapsed")),r.element=a,r.retain=!0,r[i]={from:Ll(c[i]),to:m},r.items=[{element:o.bodyWrapElement,retain:!1,clip:{from:`rect(${d})`,to:`rect(${u})`}}],e.animation=bl.run(r)):(a.style[i]=`${m}px`,s&&(l.add("b-collapsing","b-collapsed"),s.rectangle(),l.remove("b-collapsing")))}collapseEnd(e){const t=this,{collapseTool:n}=t;t.panel.element.classList.remove("b-collapsing"),n&&(n.collapsing=!1),e.completed?t.collapsed=!0:(t.applyHeaderDock(!1),t.restoreConfiguredSize(),t.lockInnerSize(!1))}collapseRevert(e){var t;null===(t=this.collapseTool)||void 0===t||t.element.classList.remove("b-collapsed")}expandBegin(e){const t=this,{animation:n}=e,{collapseDim:r,collapseTool:i,panel:s}=t,{element:o}=s,a=s.rectangle();o.classList.remove("b-collapsed","b-collapsing"),s.element.style[r]="",t.restoreConfiguredSize(),t.lockInnerSize(!1);const l=s.rectangle(),c=t.lockInnerSize().moveTo(0,0),d=c.clone(),u=$l[t.collapseDock];null==i||i.element.classList.remove("b-collapsed"),n&&(d[u[0]]=d[u[1]],o.classList.add("b-collapsed","b-expanding"),n.element=o,n[r]={from:Ll(a[r]),to:Ll(l[r])},n.items=[{element:s.bodyWrapElement,retain:!1,clip:{from:`rect(${d})`,to:`rect(${c})`}}],e.animation=bl.run(n))}expandEnd(e){const t=this;t.panel.element.classList.remove("b-expanding"),e.completed&&(t.collapsed=!1,t.applyHeaderDock(!1),t.restoreConfiguredSize(),t.lockInnerSize(!1))}expandRevert(e){var t;null===(t=this.collapseTool)||void 0===t||t.element.classList.add("b-collapsed")}get innerElement(){return this.panel.bodyWrapElement}get innerSizeElement(){return this.innerElement}get supportAxis(){let{_supportAxis:e}=this;const t=!0===e;return(t||null==e)&&(e=this.collapseDim[0],(t||"absolute"===Mr.getStyleValue(this.panel.element,"position"))&&(e+=Nl[e])),e||""}lockInnerSize(e=!0){const t=this,{innerElement:n,panel:r}=t,i=e?t.supportAxis:"",s=r.element,o=r.headerElement,a=e&&o&&xn.from(o,s),l=e&&xn.from(t.innerSizeElement,s),c=n.style;return o&&(o.style.minWidth=i.includes("w")?`${a.width}px`:"",o.style.minHeight=i.includes("h")?`${a.height}px`:""),c.width=e?`${l.width}px`:"",c.height=e?`${l.height}px`:"",n.classList[e?"add":"remove"]("b-panel-collapse-size-locker"),l}onCollapseClick(e){let t=!(this.collapsing||!this.expanding&&this.collapsed);e.altKey&&(t={animation:null,collapsed:t}),this.collapse(t)}onComplete(e){var t;null===(t=this.panel)||void 0===t||t.trigger(e)}onHeaderClick({event:e}){0===e.button&&this.panel.collapsed&&e.target.classList.contains(Fl)&&this.onRevealerClick()}onPanelConfigChange({name:e,value:t}){const n=this,{panel:r}=n;"collapsed"===e?r.isPainted&&(n.collapsed=t):"header"!==e||r.changingCollapse||n.syncDirection()}onPanelPaint(){this.syncDirection(),this.panel.collapsed&&!this.collapsed&&this.collapse({animation:null,collapsed:!0})}onRevealerClick(){this.panel._collapse({collapsed:!1})}restoreConfiguredSize(e){var t;const{configuredHeight:n,configuredWidth:r,panel:i}=this;e=null!==(t=e)&&void 0!==t?t:"wh",null!=r&&e.includes("w")&&(i.width=r),null!=n&&e.includes("h")&&(i.height=n)}splitHeaderItems(){return Al}syncDirection(){const e=this,{direction:t}=e;t&&!kl.test(t)||(e.direction=e.getCollapseDir())}updateCollapsed(e){const{collapseTool:t,panel:n}=this;n&&(n.collapsed=e,n.element.classList[e?"add":"remove"]("b-collapsed")),t&&(t.collapsed=e)}updateDirection(e){const{collapseTool:t,panel:n}=this;t&&(t.direction=Pl[e]),null!=n&&n.rendered&&n.recompose()}updatePanel(e){var t;const n=this;n.syncDirection(),null===(t=n.panelChangeDetacher)||void 0===t||t.call(n),n.panelChangeDetacher=e&&$e.after(e,"onConfigChange","onPanelConfigChange",n,{return:!1})}wrapCollapser(e,t){return[e,t]}}zl.maps={clipByDock:$l,dockByDirection:Hl,dockIsHorz:Bl},zl.initClass(),zl._$name="PanelCollapser";const Wl=Symbol("pendingCreate");class Ul extends Te{static get prototypeProperties(){return{cleanup:null,configName:null,created:null,factory:null,inferType:"name",owner:null,ownerName:null,proxyable:"undefined"!=typeof Proxy,setup:null,transform:null}}static get properties(){return{defaults:{},instances:{},object:Object.create({})}}get proxy(){const e=this;let t=null;return e.proxyable&&(t=new Proxy(e.instances,{get(t,n){return e.get(n)},set(t,n,r){return e.set(n,r),!0},deleteProperty(t,n){return e.set(n,null),!0}})),Reflect.defineProperty(e,"proxy",{configurable:!0,value:t}),t}get target(){return this.proxy||this.object}define(e,t){const n=this,{transform:r}=n,i=r?r(t,e):t,s=sn.isInstantiated(i);n.instances[e]=Wl,s||n.setDefaults(e,i),n.defineProp(e,!0),s&&n.set(e,i)}defineProp(e,t){const n=this,{object:r}=n;n.proxy||Reflect.defineProperty(t?Object.getPrototypeOf(r):r,e,{configurable:!t,enumerable:!0,get(){return n.get(e)},set(t){return n.set(e,t)}})}flush(){const e=this;try{var t;e.updating=!0;for(const t in e.defaults)e.get(t);e.afterConfigureOwner=null===(t=e.afterConfigureOwner)||void 0===t?void 0:t.call(e)}finally{e.updating=!1}}get(e){const{defaults:t,instances:n}=this;return n[e]===Wl&&this.set(e,Wl),n[e]||t[e]&&null}set(e,t){const n=this,{cleanup:r,configName:i,defaults:s,factory:o,instances:a,owner:l,setup:c,transform:d,updating:u}=n,h=l&&i&&!u,g=a[e]===Wl?null:a[e],m=o.reconfigure(g,t===Wl?{}:t||null,{cleanup:r&&(t=>r(t,e)),defaults:s[e]||n.setDefaults(e,{}),owner:n.owner,setup:c&&((t,n,r)=>c(t,e,n,r)),transform:d&&(t=>d(t,e))});if(m!==g){const t=h&&f({},a);var p;a[e]=m,m?(n.defineProp(e),null===(p=n.created)||void 0===p||p.call(n,m,e)):(delete n.object[e],delete a[e]),h&&l.onConfigChange({name:i,config:l.$meta.configs[i],value:n.target,was:t})}}setDefaults(e,t){const{defaults:n,factory:r,inferType:i,instances:s,owner:o,ownerName:a}=this,{typeKey:l}=r.factoryable;return t=!0===t?{}:sn.assign({},t),("name"===i||!0===i&&!t[l])&&(t[l]=e),a&&(t[a]=o),t.beforeConfigure=t=>{s[e]=t},n[e]=t}update(e){const t=this,{owner:n}=t;let r,i;try{if(t.updating=!0,e)for(r in e)i=e[r],t.defaults[r]?t.set(r,i):i&&t.define(r,i);else for(r in t.instances)t.set(r,null)}finally{t.updating=!1}n&&(n.isConfiguring?t.afterConfigureOwner||(t.afterConfigureOwner=$e.before(n,"afterConfigure","flush",t)):t.flush())}}Ul.initClass(),Ul._$name="DynamicObject";const Yl=[],Gl={},ql={align:1,weight:1};var Kl=e=>class extends(e||Ka){static get $name(){return"Toolable"}static get configurable(){return{tools:{value:null,$config:{nullify:!0}},toolDefaults:{"*":{type:"tool",align:"end"}}}}byWeightSortFn(e,t){return(e.weight||0)-(t.weight||0)}byWeightReverseSortFn(e,t){return(t.weight||0)-(e.weight||0)}gatherTools({align:e,overlay:t,refs:n}=Gl){const{collapsed:r,tools:i}=this;let s,o,a,l,c,d=[];for(o in i){var u,h,g,m,p;c=i[o],s=null!==(u=null!==(h=null===(g=c)||void 0===g||null===(m=g.align)||void 0===m?void 0:m.align)&&void 0!==h?h:null===(p=c)||void 0===p?void 0:p.align)&&void 0!==u?u:"end",s===e&&c.isCollapsified(r,t)&&d.push(c)}if(d.sort(this["end"===e?"byWeightReverseSortFn":"byWeightSortFn"]),n){const e="widget"===n,t={};for(a=0;a<d.length;++a)l=d[a],t[l.ref]=e?l:l.element;d=t}return d}getEndTools({overlay:e,refs:t}=Gl){return this.gatherTools({align:"end",overlay:e,refs:t})}getStartTools({overlay:e,refs:t}=Gl){return this.gatherTools({align:"start",overlay:e,refs:t})}get childItems(){return[...this.getStartTools(),...this._items||Yl,...this.getEndTools()]}changeTools(e,t){const n=this,r=n.$tools||(n.$tools=new Ul({configName:"tools",factory:Ka,inferType:!1,owner:n,created(e){var t,i;e.innerItem=!1,null===(t=e.syncRotationToDock)||void 0===t||t.call(e,null===(i=n.header)||void 0===i?void 0:i.dock),$e.after(e,"onConfigChange",((e,{name:t})=>{ql[t]&&n.onConfigChange({name:"tools",value:r.target})})),n.onChildAdd(e)},setup(e,t){return(e=sn.merge({},n.toolDefaults["*"],n.toolDefaults[t],e)).parent=n,e.ref=t,e}}));if(r.update(e),!t)return r.target}get widgetClass(){}};const Xl=["b-hbox","b-vbox"],Zl={name:"align",style:"alignItems"},Jl={name:"contentAlign",style:"alignContent"},Ql={name:"direction",style:"flexDirection"},ec={name:"justify",style:"justifyContent",classes:["stretch"]},tc={name:"wrap",style:"flexWrap",map:{false:"nowrap",true:"wrap",reverse:"wrap-reverse"}};class nc extends Za{static get $name(){return"Box"}static get type(){return"box"}static get alias(){return"hbox"}static get configurable(){return{itemCls:"b-box-item",align:null,contentAlign:null,direction:null,horizontal:!0,justify:null,reverse:null,wrap:null}}get vertical(){return!1===this.horizontal}set vertical(e){return this.horizontal=!e}updateAlign(){this.syncConfigStyle(Zl)}updateContentAlign(){this.syncConfigStyle(Jl)}updateDirection(){this.syncConfigStyle(Ql)}updateHorizontal(){var e;const t=this,n=null===(e=t.contentElement)||void 0===e?void 0:e.classList,r=Number(t.vertical);n?(n.remove(Xl[1-r]),n.add(Xl[r])):t.syncConfigLater("horizontal"),t.syncDirection()}updateJustify(){this.syncConfigStyle(ec)}updateReverse(){this.syncDirection()}updateWrap(){this.syncConfigStyle(tc)}syncDirection(){const e=this,{reverse:t}=e;e.direction=t?`${e.vertical?"column":"row"}${t?"-reverse":""}`:null}}nc.initClass(),nc._$name="Box";class rc extends nc{static get $name(){return"VBox"}static get type(){return"vbox"}static get configurable(){return{horizontal:!1}}}rc.initClass(),rc._$name="VBox";var ic=e=>class extends(e||Te){static get $name(){return"Badge"}static get configurable(){return{badge:null}}compose(){const{badge:e}=this;return{dataset:{badge:e},class:{"b-badge":null!=e&&""!==e}}}};const sc=/(?:^|\s)b-icon-/,oc=/(?:^|\s)b-fa-/,ac=Symbol("defaultToggleable"),lc=["items","type","widgets","html","listeners"];class cc extends(Ka.mixin(ic,El)){static get $name(){return"Button"}static get type(){return"button"}static get configurable(){return{icon:null,menuIcon:"b-icon-picker",pressedIcon:null,iconAlign:"start",text:{value:null,$config:null,default:""},color:null,toggleable:ac,pressed:!1,toggleGroup:null,ripple:{radius:75},forwardTwinEvents:["action","toggle"],localizableProperties:["text"],menu:{$config:["lazy","nullify"],value:null},menuDefaults:{type:"menu",autoShow:!1,autoClose:!0,floating:!0,scrollAction:"realign",align:"t0-b0"},href:null,target:null,defaultBindProperty:null}}updateElement(e,t){var n,r,i;const s=this,{constructor:o}=s,a=super.updateElement(e,t),l=s.peekConfig("menu"),c=!!l&&(l.isWidget?l.role:(null===(n=o.resolveType(l.type))||void 0===n||null===(r=n.configurable)||void 0===r?void 0:r.role)||(null===(i=o.configurable.menuDefaults)||void 0===i?void 0:i.type)||"menu");return s.ariaHasPopup=c,a}compose(){const{color:e,href:t,icon:n,iconAlign:r,pressed:i,pressedIcon:s,target:o,text:a,toggleable:l,toggleGroup:c,menuIcon:d}=this,u=this.hasConfig("menu"),h=i&&s?s:n;return{tag:t?"a":"button",href:t,target:o,class:{[`b-icon-align-${r}`]:n,[e]:Boolean(e),"b-pressed":i&&l,"b-text":Boolean(a),"b-has-menu":u},"aria-pressed":i,dataset:{group:c},listeners:{click:"onInternalClick",mousedown:"onInternalMousedown"},children:{iconElement:(n||s)&&{"aria-hidden":!0,tag:"i",class:f(f({},Mn.normalize(h,"object")),{},{"b-icon":sc.test(h),"b-fa":oc.test(h)})},label:a&&{tag:"label",text:a},menuIconElement:u&&d&&{tag:"i",class:{"b-icon":sc.test(d),"b-fa":oc.test(d),"b-button-menu-icon":1,[d]:1}}}}}configureOverflowTwin(e){const t=super.configureOverflowTwin(e);return t.text||(t.text=this.tooltipText),t}onHide(){var e;null===(e=this._menu)||void 0===e||e.hide()}get childItems(){return this._menu&&[this.menu]}onFocusOut(e){var t;super.onFocusOut(e),null===(t=this.menu)||void 0===t||t.hide()}get focusElement(){return this.element}changeText(e){return null==e?"":e}changeToggleable(e){return e===ac?this.toggleGroup||this.config.menu:e}changeMenu(e,t){const n=this,{element:r}=n;return e?(e.isWidget?(e.forElement=r,e.owner=n,e.constrainTo=n.rootElement):("object"!=typeof e||lc.some((t=>t in e))||(e={lazyItems:e}),e=Ka.reconfigure(t,e?sn.merge({owner:n,constrainTo:n.rootElement,forElement:r},n.menuDefaults,e):null,n)),e.align.constrainPadding=10,e.on({beforeShow:"onMenuBeforeShow",hide:"onMenuHide",show:"onMenuShow",thisObj:this})):null==t||t.destroy(),e}onMenuBeforeShow({source:e}){return this.trigger("beforeShowMenu",{menu:e})}onMenuShow(){this.ariaElement.setAttribute("aria-expanded",!0)}onMenuHide(){this.ariaElement.setAttribute("aria-expanded",!1),this.toggle(!1)}updateMenu(e){this.toggleable=Boolean(e)}updatePressed(e){const t=this;if(!t.toggleable||t.isConfiguring)return;const{menu:n}=t;var r,i;e&&Mr.forEachSelector(t.rootElement,`button[data-group=${t.toggleGroup}]`,(e=>{e!==t.element&&(Ka.getById(e.id).pressed=!1)})),n&&(n.initialConfig.minWidth||(n.minWidth=t.width),n.align.minHeight=null!==(r=n._minHeight)&&void 0!==r?r:100,n.align.minWidth=null!==(i=n._minWidth)&&void 0!==i?i:100,n[e?"show":"hide"]()),t.trigger("toggle",{pressed:e})}onInternalMousedown(e){var t;null!==(t=this._menu)&&void 0!==t&&t.containsFocus&&this.pressed&&e.preventDefault()}onInternalClick(e){const t=this,n={event:e};if(!t.disabled){if(t.toggleable){if(t.toggleGroup&&t.pressed)return;if(t.toggle(!t.pressed),t.isDestroyed)return}t.trigger("click",n),t.isDestroyed||t.trigger("action",n),t.href||(e.preventDefault(),e.stopPropagation())}}toggle(e=!this.pressed){this.pressed=e}}cc.initClass(),cc._$name="Button";const dc={refs:"element"},uc=e=>e.element.style.margin="",hc=e=>e.isToolbar,gc=e=>e[0]+(e[1].minifiable?0:9e9),mc={hidden:!1,width:""},pc=f(f({},mc),{},{flex:""}),fc=[{box:"hbox",clientSizeProp:"clientWidth",edgeProp:"right",flexDir:"row",horizontal:!0,max:"maxX",overflow:"overflowX",pos:"x",scrollSize:"scrollWidth",sizeProp:"width"},{box:"vbox",clientSizeProp:"clientHeight",edgeProp:"bottom",flexDir:"column",horizontal:!1,max:"maxY",overflow:"overflowY",pos:"y",scrollSize:"scrollHeight",sizeProp:"height"}],vc={delay:0,startRate:40,endRate:200,accelerateDuration:500},yc={menu:1,pressed:1};class bc extends(ll.mixin(Kl)){static get $name(){return"Toolbar"}static get type(){return"toolbar"}static get delayable(){return{syncOverflowVisibility:{type:"raf",cancelOutstanding:!0}}}static get configurable(){return{defaultType:"button",dock:"top",layout:{type:"box"},overflow:{$config:["lazy","nullify"],value:{type:"menu"}},toolDefaults:{overflowMenuButton:{type:"button",hidden:!0,icon:"b-icon-menu",menuIcon:null,defaultCls:{"b-overflow-button":1}},overflowScrollEnd:{handler:"up.onEndScrollClick",hidden:!0,defaultCls:{"b-icon-angle-right":1,"b-overflow-button":1,"b-icon":1}},overflowScrollStart:{align:"start",handler:"up.onStartScrollClick",hidden:!0,defaultCls:{"b-icon-angle-left":1,"b-overflow-button":1,"b-icon":1}}},widgetCls:null,ignoreParentReadOnly:!0}}static get prototypeProperties(){return{flexRowCls:"b-hbox",flexColCls:"b-vbox"}}static getEvictionList(e){const t=e.filter((e=>"none"!==e.overflowable));return t.forEach(((e,n)=>t[n]=[n,e])),t.sort(((e,t)=>gc(t)-gc(e))),t}compose(){const e=this,{axisProps:t,dock:n}=e,r=e.getEndTools(dc),i=e.getStartTools(dc);return{class:{[`b-dock-${n}`]:1,[`b-${n}-toolbar`]:1,[`b-${t.box}`]:1},children:f(f({},i),{},{toolbarContent:{class:{"b-box-center":1,"b-toolbar-content":1}}},r)}}get axisProps(){return fc[this.layout.horizontal?0:1]}get contentElement(){return this.toolbarContent}get overflowMenuButton(){var e;return null===(e=this.tools)||void 0===e?void 0:e.overflowMenuButton}get overflowType(){const{overflow:e}=this;return"string"==typeof e?e:null==e?void 0:e.type}onChildAdd(e){var t;super.onChildAdd(e),this.processAddedLeafItem(e),null===(t=e.syncRotationToDock)||void 0===t||t.call(e,this.dock)}onChildRemove(e){super.onChildRemove(e),this.syncOverflowVisibility()}processAddedLeafItem(e){$e.after(e,"onConfigChange",this.onLeafItemConfigChange,e),e.isContainer&&e.eachWidget((e=>this.processAddedLeafItem(e)))}onPaint({firstPaint:e}){var t;null===(t=super.onPaint)||void 0===t||t.call(this,...arguments),e&&this.getConfig("overflow")}updateDock(e){const t=this,{layout:n}=t,{vertical:r}=n;if(n.vertical=Dl(e)[1],!t.initialItems){r!==n.vertical&&t.updateOverflow(t.overflow);for(const n of t.childItems){var i;null===(i=n.syncRotationToDock)||void 0===i||i.call(n,e)}}}updateOverflow(e,t){var n;const r=this,{axisProps:i,contentElement:s,overflowType:o}=r,{flexDir:a}=i,l=null===(n=r.overflowMenuButton)||void 0===n?void 0:n._menu,c={};var d;if(l&&(e?null==l||l.removeAll():l.eachWidget((e=>{e._overflowTwinOrigin.overflowTwin=null}))),"menu"===t?c.overflowMenuButton=null:"scroll"===t&&(c.overflowScrollStart=c.overflowScrollEnd=null),"menu"===o)null===(d=r.scrollable)||void 0===d||d.destroy(),s.style.overflow=s.style.overflowX=s.style.overflowY="",c.overflowMenuButton={cls:{[`b-${a}-menu`]:1}};else if("scroll"===o){const t="object"==typeof e&&(null==e?void 0:e.repeat)||vc;r.scrollable={[i.overflow]:"hidden-scroll",element:s,listeners:{scroll:"onContentScroll",thisObj:r}},c.overflowScrollStart={repeat:t,invertRotate:!0,cls:{[`b-${a}-start-scroller`]:1}},c.overflowScrollEnd={repeat:t,invertRotate:!0,cls:{[`b-${a}-end-scroller`]:1}}}r.tools=c,o?(s.classList.add("b-overflow"),r.monitorResize=!0,r.syncOverflowVisibility()):(s.classList.remove("b-overflow"),r.monitorResize=!1)}onContentScroll(){this.syncScrollerState()}onStartScrollClick(){this.scrollable[this.axisProps.pos]-=2}onEndScrollClick(){this.scrollable[this.axisProps.pos]+=2}onInternalResize(){super.onInternalResize(...arguments),this.isPainted&&this.syncOverflowVisibility()}syncOverflowVisibility(){const e=this,{overflowType:t,contentElement:n,isVisible:r}=e,{clientSizeProp:i,edgeProp:s,sizeProp:o}=e.axisProps,{overflowMenuButton:a,overflowScrollStart:l,overflowScrollEnd:c}=e.tools,d=e.rtl&&e.layout.horizontal,u="menu"===t,h=()=>Math.ceil(n[i]+(!l||l.hidden?0:l.rectangle("outer")[o])+(!c||c.hidden?0:c.rectangle("outer")[o])),g=()=>{if(0===x.length)return 0;const e=x[x.length-1].rectangle(n);return Math.floor(d?n[i]-e.left:e[s])};let m,p,f,v,y,b,C,w,S,D,E,x;if(r&&t&&0!==e.items.length){if(e.inSyncOverflowVisibility=!0,null==a||a.hide(),e.eachWidget(((e,t)=>{C=e.minifiable,D=e.overflowable,D=C?D||C:D,e.floating?t.down=!1:(t.down=!D,e.innerItem&&(e._toolbarOverflow&&(e.hidden=e._toolbarOverflow=!1),e._toolbarMinified&&(e.minified=e._toolbarMinified=!1),e.isVisible&&(C&&(w||(w=[])).push(e),D&&(x||(x=[])).push(e))))})),x&&(m=h(),p=g()),x&&p>m)if(u){for(;p>m&&(y=null===(R=w)||void 0===R?void 0:R.pop());){var R;b=p,y._toolbarMinified=!0,y.minified=!0,p=g(),b-=p,(S||(S=[])).push([y,b])}if(p>m){for(f of(a.show(),m=h(),v=bc.getEvictionList(x),v))p>m&&(y=f[1],y._toolbarOverflowWidth=y.width,y._toolbarOverflow=!0,y.hidden=!0,x.splice(x.indexOf(y),1),(E||(E=[])).push(f),p=g());if(E){for(E.sort(((e,t)=>e[0]-t[0])).forEach(((e,t)=>E[t]=e[1]));null!==(T=S)&&void 0!==T&&T.length;){var T;[y,b]=S.pop(),p+b<=m&&!y._toolbarOverflow&&(p+=b,y.minified=y._toolbarMinified=!1)}e.syncOverflowMenuButton(E)}else a.hide()}}else c.show(),l.show(),e.syncScrollerState();else u||(null==c||c.hide(),null==l||l.hide());e.inSyncOverflowVisibility=!1}}syncOverflowMenuButton(e){var t;const n=this,{axisProps:r,overflowMenuButton:i}=n,s={cls:"b-toolbar-overflow-menu",minWidth:280,items:[],align:{align:r.horizontal?"t100-b100":"r100-l100",axisLock:"flexible"}};if(n.addToMenu(s,e.filter((e=>n.overflowItemFilter(e)))),null!==(t=i._menu)&&void 0!==t&&t.isMenu){const e=i.menu,{toAdd:t,toRemove:n}=ke.delta(s.items,e.items,1);if(e.remove(n),e.items.length)for(let n=t.length-1;n>=0;n--)e.insert(t[n],0);else e.add(t)}else i.menu=s}syncScrollerState(){const{axisProps:e,scrollable:t}=this,{overflowScrollStart:n,overflowScrollEnd:r}=this.tools,i=t[e.pos],s=t[e.max];n.disabled=!i,r.disabled=Math.abs(Math.ceil(i))>=Math.abs(s)}overflowItemFilter(e){const{filter:t}=this.overflow;return Boolean(t?t.call(this,e):Mr.getChildElementCount(e.element))}addToMenu(e,t){const n=this.horizontal?pc:mc;for(const r of t){const t=r.ensureOverflowTwin(n,uc);e.items.push(t)}}onLeafItemConfigChange(e,{name:t,value:n}){const r=this,i=r.up(hc),s=i.hasConfig("overflow"),{overflowTwin:o}=r;!s||null!=i&&i.inSyncOverflowVisibility||"hidden"===t&&n===r._toolbarOverflow||(o&&!yc[t]&&(o[t]=n),null!=i&&i.isPainted&&"overflowMenuButton"!==r.ref&&(r.isTextField&&"value"===t&&(r.containsFocus||null!=o&&o.containsFocus)||i.syncOverflowVisibility()))}createWidget(e){"->"===e?e={type:"widget",cls:"b-toolbar-fill"}:"|"===e?e={type:"widget",cls:"b-toolbar-separator"}:"string"==typeof e&&(e={type:"widget",cls:"b-toolbar-text",html:e});const t=super.createWidget(e);return this.widgetCls&&t.element.classList.add(this.widgetCls),t}}bc.initClass(),bc._$name="Toolbar";const Cc=e=>!e.classList.contains("b-focus-trap")&&Mr.isFocusable(e)?Mr.NodeFilter.FILTER_ACCEPT:Mr.NodeFilter.FILTER_SKIP,wc=[],Sc={},Dc=[wc,wc],Ec=(e,t,n)=>{const{vertical:r}=e;return delete e.vertical,f(f({},e),{},{class:f(f({},t),{},{[`b-${r?"v":"h"}box`]:1,"b-box-center":1,"b-panel-bar-wrap":!n})})},xc=(e,t,n=!1)=>{const r={vertical:n,children:e?[e]:[]};return t&&(r.tag=t),r},Rc={dock:1,hidden:1,weight:1},Tc={top:[!0,!0],bottom:[!0,!1],left:[!1,!0],right:[!1,!1]},Mc={header:1,"pre-header":1};class kc extends(ll.mixin(oi,Kl)){static get $name(){return"Panel"}static get type(){return"panel"}static get configurable(){return{localizableProperties:["title"],collapsed:{value:null,$config:null,default:!1},collapsible:{value:null,$config:"nullify"},bodyCls:{$config:{merge:"classList"},value:null},bodyTag:null,bodyWrapTag:null,trapFocus:null,title:null,header:null,stateful:["collapsed"],stripDefaults:{"*":{type:"toolbar",dock:"top"},bbar:{dock:"bottom",weight:-1e3},tbar:{weight:-1e3}},strips:{value:null,$config:"nullify"},toolDefaults:{close:{weight:-1e3},collapse:{weight:-990}},footer:null,revealed:null,tbar:null,bbar:null,role:"region"}}updateElement(e,t){const n=super.updateElement(e,t);return this.titleElement&&Mr.setAttributes(this.ariaElement,{"aria-describedby":this.titleElement.id}),n}compose(){const e=this,{collapsible:t,focusable:n,hasItems:r,revealed:i}=e,s=e.composeHeader(),o=(null==s?void 0:s.class["b-dock-left"])||(null==s?void 0:s.class["b-dock-right"]);let a=e.composeBody(),l="bodyWrapElement";return t&&([l,a]=t.wrapCollapser(l,a)),{tabIndex:r&&!1!==n||n?0:null,class:{[`b-panel-collapsible-${null==t?void 0:t.type}`]:t,[`b-panel-collapse-${null==t?void 0:t.collapseDir}`]:t,[`b-${o?"h":"v"}box`]:1,"b-panel-collapsible":t,"b-panel-has-header":s,"b-panel-overlay-revealed":i},children:{topFocusTrap:{"aria-hidden":!0,tabIndex:0,class:{"b-focus-trap":1}},headerElement:s,[l]:a,bottomFocusTrap:{"aria-hidden":!0,tabIndex:0,class:{"b-focus-trap":1,"b-end-focus-trap":1}}}}}composeBody(){const e=this,{bodyCls:t,bodyConfig:n,bodyWrapTag:r,footer:i,uiClassList:s}=e,o=sn.values(e.strips,((e,t)=>!Tc[null==t?void 0:t.dock])).sort(e.byWeightSortFn);let a,l,c,d,u,h,g;for(i&&(c=i.dock||"bottom",o.unshift({dock:c,element:{tag:"footer",reference:"footerElement",html:"string"==typeof i?i:i.html,class:f(f({},s),{},{[`b-dock-${c}`]:1,[`${i.cls||""}`]:1})}})),t&&(n[u="className"]||(u="class"),n[u]=new Mn(n[u]).assign(t)),d=o.length;d-- >0;)a=o[d],[h,l]=Tc[a.dock],g?g.vertical!==h&&(g=xc(Ec(g,s),"",h)):g=xc(n,r,h),g.children[l?"unshift":"push"](a.element);const m=Ec(g||xc(n,r),s,!0);return m.class["b-panel-body-wrap"]=1,m.class[`b-${e.$$name.toLowerCase()}-body-wrap`]=1,m}get hasHeader(){if(!1===this.header)return!1;const{header:e,title:t,tools:n,parent:r}=this,i=this.maximizable||Object.values(n||{}).some((e=>!e.hidden));return e||!(null!=r&&r.suppressChildHeaders)&&(t||i)}get rootUiClass(){return kc}composeHeader(e){var t;const n=this;if(!e&&!n.hasHeader)return;const r=n.header||{},i=r.dock||"top",[s,o]=n.splitHeaderItems({dock:i,as:"element"}),a=n.$meta.hierarchy,l=n.composeTitle(r),c=new Mn(f({[`b-dock-${i}`]:1},n.uiClassList),r.cls);let d,u;for(d=a.indexOf(kc);d<a.length;++d)u=a[d].$$name,"Grid"!==u&&(c[`b-${u.toLowerCase()}-header`]=1);const h={tag:"header",class:c,children:[...s,l,...o]};return(null===(t=n.collapsible)||void 0===t?void 0:t.composeHeader(h))||h}composeTitle(e){var t;const n="string"==typeof e?e:this.title||e.title,r={reference:"titleElement",id:`${this.id}-panel-title`,html:null!=n?n:" ",class:f({[`b-align-${e.titleAlign||"start"}`]:1,"b-header-title":1},this.uiClassList)};return sn.isObject(n)&&(delete r.html,sn.merge(r,n)),(null===(t=this.collapsible)||void 0===t?void 0:t.composeTitle(r))||r}updateTitle(){}afterRecompose(){var e;super.afterRecompose();const t=this,{headerElement:n}=t;null===(e=t._headerClickDetacher)||void 0===e||e.call(t),t._headerClickDetacher=n&&_n.on({element:n,click:e=>{var n;return null===(n=t.trigger)||void 0===n?void 0:n.call(t,"headerClick",{event:e})}})}onHeaderClick(e){var t;null===(t=this.collapsible)||void 0===t||t.onHeaderClick(e)}onPaint(){var e;super.onPaint(...arguments),null===(e=this.collapsible)||void 0===e||e.onPanelPaint(this)}splitHeaderItems({as:e,overlay:t,dock:n}=Sc){const r=this,i="element"===e,{collapsed:s}=r,o=r.getEndTools({overlay:t}),a=r.getStartTools({overlay:t}),l=sn.values(r.strips,((e,n)=>!Mc[null==n?void 0:n.dock]&&n.isCollapsified(s,t)));let c,d,u,h=Dc;if(l.length+o.length+a.length){for(h=[d=[...a,...l.filter((e=>"pre-header"===e.dock)).sort(r.byWeightSortFn)],c=[...l.filter((e=>"header"===e.dock)).sort(r.byWeightReverseSortFn),...o]],u=0;u<d.length;++u){var g,m;n&&(null===(g=(m=d[u]).syncRotationToDock)||void 0===g||g.call(m,n)),i&&(d[u]=d[u].element)}for(u=0;u<c.length;++u){var p,f;n&&(null===(p=(f=c[u]).syncRotationToDock)||void 0===p||p.call(f,n)),i&&(c[u]=c[u].element)}}return h}set bodyConfig(e){this._bodyConfig=e}get bodyConfig(){const e=this,{bodyTag:t}=e,n=sn.merge({reference:"bodyElement",className:f(f({},e.getStaticWidgetClasses(kc,"-content")),{},{"b-box-center":1,"b-text-content":e.textContent&&e.hasNoChildren})},e._bodyConfig);return t&&(n.tag=t),!e.initializingElement&&e._element||(n.html=e.content||e._html),n}changeBodyCls(e){return Mn.from(e)}changeTbar(e){return this.getConfig("strips"),this.strips={tbar:e},this.strips.tbar}changeBbar(e){return this.getConfig("strips"),this.strips={bbar:e},this.strips.bbar}get childItems(){var e;const t=this,n=sn.values(t.strips,((e,t)=>!Tc[null==t?void 0:t.dock])).sort(t.byWeightSortFn),[r,i]=t.splitHeaderItems(),[s,o]=(null===(e=t.collapsible)||void 0===e?void 0:e.splitHeaderItems())||Dc;return[...r,...s,...i,...o,...n.filter((e=>Tc[e.dock][1])),...t._items||wc,...n.filter((e=>!Tc[e.dock][1])).reverse()]}changeStrips(e,t){const n=this,r=n.$strips||(n.$strips=new Ul({configName:"strips",factory:Ka,inferType:!1,owner:n,created(e){var t;const{dock:i}=e;if(!Mc[i]&&!Tc[i])throw new Error(`Invalid dock value "${i}"; must be: top, left, right, bottom, header, or pre-header`);$e.after(e,"onConfigChange",((e,{name:t})=>{Rc[t]&&n.onConfigChange({name:"strips",value:r.target})})),e.innerItem=!1,n.onChildAdd(e),e.parent=n,null===(t=e.layout)||void 0===t||t.renderChildren(),e.hasItems&&(n.hasItems=!0)},setup(e,t){return(e=sn.merge(sn.clone(n.stripDefaults["*"]),n.stripDefaults[t],e)).parent=n,e.ref=t,e},transform(e){return Array.isArray(e)&&(e={items:e}),e||null}}));if(r.update(e),!t)return r.target}get collapsing(){var e;return null===(e=this.collapsible)||void 0===e?void 0:e.collapsing}get collapsingExpanding(){var e;return null===(e=this.collapsible)||void 0===e?void 0:e.collapsingExpanding}get expanding(){var e;return null===(e=this.collapsible)||void 0===e?void 0:e.expanding}changeCollapsed(e){const t=this,{collapsible:n}=t;if(t.recompose.flush(),e=Boolean(e),!n||t.changingCollapse||!t.isPainted)return e;null==n||n.collapse({animation:null,collapsed:e})}changeCollapsible(e,t){const n=this;return n.getConfig("tools"),e&&(!0===e?e={}:"string"==typeof e&&(e={[Tc[e]?"direction":"type"]:e})),zl.reconfigure(t,e,{owner:n,defaults:{panel:n},cleanup(){n.collapsed&&(t.collapse({animation:null,collapsed:!1}),n._collapsed=1)}})}updateCollapsible(e){const t=this,n=null==e?void 0:e.toolsConfig;t.tools={collapse:(null==n?void 0:n.collapse)||null,recollapse:(null==n?void 0:n.recollapse)||null},e&&t.isPainted&&t.collapsed&&(t._collapsed=1),1===t.collapsed&&(t.collapsed=!0)}_collapse(e,t){var n;return!0!==t&&void 0!==t&&(!1===t?e.collapsed=!e.collapsed:"number"==typeof t?e.animation={duration:t}:null===t?e.animation=t:!0===t||("animation"in t?sn.merge(e,t):e.animation=t)),null===(n=this.collapsible)||void 0===n?void 0:n.collapse(e)}collapse(e){return this._collapse({collapsed:!0},e)}expand(e){return this._collapse({collapsed:!1},e)}toggleCollapsed(e){return this.collapsed?this.expand(e):this.collapse(e)}get expandedHeaderDock(){var e,t,n;return null!==(e=null!==(t=this._expandedHeaderDock)&&void 0!==t?t:null===(n=this.initialConfig.header)||void 0===n?void 0:n.dock)&&void 0!==e?e:"top"}set expandedHeaderDock(e){this._expandedHeaderDock=null==e?void 0:e.toLowerCase()}updateHeader(e){this.changingCollapse||(this.expandedHeaderDock=null==e?void 0:e.dock)}updateTrapFocus(e){var t;const n=this;n.element.classList[e?"add":"remove"]("b-focus-trapped"),n.focusTrapListener=null===(t=n.focusTrapListener)||void 0===t?void 0:t.call(n),e&&(n.focusTrapListener=_n.on({element:n.element,focusin:"onFocusTrapped",delegate:".b-focus-trap",thisObj:n}),n.treeWalker||(n.treeWalker=this.setupTreeWalker(n.element,Mr.NodeFilter.SHOW_ELEMENT,Cc)))}setupTreeWalker(e,t,n){return document.createTreeWalker(e,t,n)}onFocusTrapped(e){const t=this,n=t.treeWalker;if(e.target===t.bottomFocusTrap)n.currentNode=t.topFocusTrap,n.nextNode();else{if(e.target!==t.topFocusTrap)return;n.currentNode=t.bottomFocusTrap,n.previousNode()}t.requestAnimationFrame((()=>n.currentNode.focus()))}get focusElement(){return this.hasItems&&(super.focusElement||this.element)}get contentElement(){return this.element&&this.bodyElement}get widgetClassList(){const e=this,t=super.widgetClassList;var n;return e.hasHeader&&t.push("b-panel-has-header",`b-header-dock-${(null===(n=e.header)||void 0===n?void 0:n.dock)||"top"}`),e.tbar&&t.push("b-panel-has-top-toolbar"),e.bbar&&t.push("b-panel-has-bottom-toolbar"),t}}kc.initClass(),kc._$name="Panel";class Ic extends kc{static get $name(){return"Popup"}static get type(){return"popup"}static get configurable(){return{autoShow:!0,autoClose:!0,showOnClick:!1,forElement:null,monitorResize:!0,floating:!0,hidden:!0,axisLock:!0,hideAnimation:{opacity:{from:1,to:0,duration:".3s",delay:"0s"}},showAnimation:{opacity:{from:0,to:1,duration:".4s",delay:"0s"}},stripDefaults:{bbar:{layout:{justify:"flex-end"}}},testConfig:{hideAnimation:null,showAnimation:null},closeAction:"hide",trapFocus:!0,focusOnToFront:!0,closable:null,maximizable:null,modal:null,maximized:null,tools:{close:{cls:"b-popup-close",handler:"close",weight:-1e3,ariaLabel:"L{Popup.close}",hidden:!0},maximize:{cls:"b-popup-expand",handler:"toggleMaximized",weight:-999,hidden:!0}},highlightReturnedFocus:!0,role:"dialog"}}finalizeInit(){const e=this;e.anchoredTo=e.forElement,e.initialAnchor=e.anchor,e.forElement&&e.showOnClick&&(e.initialConfig.autoShow||(e.autoShow=!1),_n.on({element:e.forElement,click:"onElementUserAction",thisObj:e})),super.finalizeInit(),e.autoShow&&(!0===e.autoShow?e.show():e.setTimeout((()=>e.show()),e.autoShow))}onPaint({firstPaint:e}){var t;null===(t=super.onPaint)||void 0===t||t.call(this,...arguments);const n=this;e&&n.headerElement&&_n.on({element:n.headerElement,dblclick:n.onHeaderDblClick,thisObj:n})}doDestroy(){this.syncModalMask(),super.doDestroy()}compose(){const{hasNoChildren:e,textContent:t}=this;return{class:{"b-text-popup":Boolean(t&&e)}}}close(){const e=this;if(!e._hidden&&!1!==e.trigger("beforeClose")||e._hidden&&"destroy"===e.closeAction)return e.modal&&"destroy"===e.closeAction&&e.revertFocus(),e.unmask(),e.containsFocus&&e.highlightReturnedFocus&&e.setTimeout((()=>e.element.classList.add("b-using-keyboard")),0),e[e.closeAction]()}toggleMaximized(){this.maximized=!this.maximized}updateMaximized(e){Mr.toggleClasses(this.element,["b-maximized"],e)}onInternalKeyDown(e){"Escape"===e.key&&(e.stopImmediatePropagation(),this.close(!0))}onDocumentMouseDown({event:e}){const t=this,{owner:n}=t,{target:r}=e;if("touchend"!==e.type&&null!=n&&n.isButton&&n._menu===t&&n.element.contains(r))return e.preventDefault(),!1;t.modal&&r===Ic.modalMask?(e.preventDefault(),t.modal.closeOnMaskTap?t.close():t.containsFocus||t.focus()):t.owns(r)||!t.autoClose||t.containsFocus||t.close()}get isTopModal(){return Mr.isVisible(Ic.modalMask)&&this.element.previousElementSibling===Ic.modalMask}onFocusIn(e){const t=Mr.getActiveElement(this);super.onFocusIn(e),Mr.getActiveElement(this)===t&&e.target===this.element&&this.focus()}onFocusOut(e){globalThis.visualViewport&&globalThis.visualViewport.height<document.documentElement.clientHeight-1||this.modal||!this.autoClose||this.close(),super.onFocusOut(e)}onShow(){var e;const t=this;t.autoClose&&t.addDocumentMouseDownListener(),t.focusOnToFront&&t.focus(),null===(e=super.onShow)||void 0===e||e.call(this),t.syncModalMask()}addDocumentMouseDownListener(){this.mouseDownRemover||(this.mouseDownRemover=zr.on({globaltap:"onDocumentMouseDown",thisObj:this}))}updateModal(e){e&&(this.floating=!0)}syncModalMask(){const e=this,{modal:t,element:n}=e;if(n.setAttribute("aria-modal",Boolean(t)),t&&e.isVisible)"number"!=typeof e._x&&"number"!=typeof e._y&&(e.centered=!0),e.modalMask.classList.remove("b-hide-display"),n.classList.add("b-modal");else if(e.isPainted){n.classList.remove("b-modal");const t=e.floatRoot.querySelectorAll(".b-modal"),r=t.length?Ic.fromElement(t[t.length-1],"popup"):null;r?r.syncModalMask():Ic.modalMask.classList.add("b-hide-display")}}onHide(){var e,t;const n=this;null===(e=n.mouseDownRemover)||void 0===e||e.call(n),n.mouseDownRemover=null,null===(t=super.onHide)||void 0===t||t.call(this),n.syncModalMask()}onElementUserAction(){this.show()}onHeaderDblClick(){this.maximizable&&this.toggleMaximized()}updateClosable(e){this.tools.close.hidden=!e}updateMaximizable(e){this.tools.maximize.hidden=!e}get modalMask(){const{modalMask:e}=Ic;return e.nextElementSibling!==this.element&&this.floatRoot.insertBefore(e,this.element),e}static get modalMask(){return this._modalMask||(this._modalMask=Mr.createElement({className:"b-modal-mask b-hide-display"}),_n.on({element:this._modalMask,wheel:e=>e.preventDefault()})),this._modalMask}}Ic.initClass(),Ic._$name="Popup";const Ac=/^b-icon-/,Fc=/^b-fa-/;class Oc extends Ka{static get $name(){return"MenuItem"}static get type(){return"menuitem"}static get configurable(){return{checked:null,separator:null,toggleGroup:null,menu:{value:null,$config:["lazy","nullify"]},icon:null,closeParent:null,href:null,target:null,localizableProperties:["text"],role:"menuitem",closeMenuDelay:200}}updateElement(e,t){const n=super.updateElement(e,t);return"boolean"==typeof this.checked&&(this.role="menuitemcheckbox"),this.ariaHasPopup=!!this.hasMenu&&"menu",n}compose(){var e;const t=this,{checked:n,href:r,hasMenu:i,separator:s,target:o,text:a,toggleGroup:l}=t,c="boolean"==typeof n,d=t.icon||(c?"b-fw-icon":""),u="b-icon-"+(l?"radio-":""),h="object"==typeof a;return{tag:r?"a":"div",tabIndex:-1,href:r,target:o,class:{"b-has-submenu":i,"b-checked":n,"b-separator":s||(null===(e=t.cls)||void 0===e?void 0:e["b-separator"])},dataset:{group:t.toggleGroup},[c?"aria-checked":""]:n,[i?"aria-expanded":""]:!1,children:{iconElement:d&&{"aria-hidden":!0,tag:"i",class:f({"b-fa":Fc.test(d),"b-icon":Ac.test(d),"b-menuitem-icon":1,[`${u}checked`]:!0===n,[`${u}unchecked`]:!1===n},Mn.normalize(d,"object"))},textElement:{tag:"span",html:h?null:a,class:{"b-menu-text":1,"b-menu-custom-content":h},children:h?[a]:null},subMenuIcon:i&&{"aria-hidden":!0,tag:"i",class:{"b-fw-icon":1,"b-icon-sub-menu":1}}}}}doAction(e){const t=this,n=this.parent,r={menu:n,item:t,element:t.element,bubbles:!0};if("boolean"==typeof t.checked){const e=!t.checked;t.toggleGroup&&!e||(t.checked=!t.checked)}t.trigger("beforeItem",r),t.trigger("item",r),t.closeParent&&n&&(n.rootMenu.close(),e&&!t.href&&e.preventDefault())}get focusElement(){return this.element}get contentElement(){return this.textElement}get isFocusable(){const{focusElement:e}=this;return e&&this.isVisible&&(e===document.body||e.offsetParent)}get hasMenu(){return this.hasConfig("menu")}get childItems(){const{_menu:e}=this;return e?[e]:[]}get text(){return this.html}set text(e){this.html=e}onFocusIn(e){super.onFocusIn(e),!this.disabled&&this.menu&&this.delay("openMenu",200)}onFocusOut(e){this.clearTimeout("openMenu"),super.onFocusOut(e),this._menu&&(this.menu.closeTimer=this.menu.setTimeout((()=>this.closeMenu()),this.closeMenuDelay))}openMenu(e){const{menu:t}=this;!this.disabled&&t&&(t.focusOnToFront=e,t.show())}onChildShow(e){super.onChildShow(e),this.ariaElement.setAttribute("aria-expanded",!0)}closeMenu(){this._menu instanceof Ka&&this.menu.close()}onChildHide(e){super.onChildHide(e),this.ariaElement.setAttribute("aria-expanded",!1)}changeToggleGroup(e){return e&&"boolean"!=typeof this.checked&&(this.checked=!1),e}changeChecked(e,t){if(this.isConfiguring||"boolean"==typeof t)return Boolean(e)}updateChecked(e){const t=this;t.isConfiguring||(t.toggleGroup&&t.uncheckToggleGroupMembers(),t.element.setAttribute("aria-checked",e),t.trigger("toggle",{menu:t.owner,item:t,element:t.element,bubbles:!0,checked:e}))}getToggleGroupMembers(){const{checked:e,toggleGroup:t,element:n}=this,r=[];return e&&t&&Mr.forEachSelector(this.rootElement,`[data-group=${t}]`,(e=>{if(e!==n){const t=Ka.fromElement(e);t&&r.push(t)}})),r}uncheckToggleGroupMembers(){this.checked&&this.toggleGroup&&this.getToggleGroupMembers().forEach((e=>e.checked=!1))}get closeParent(){return("boolean"==typeof this.checked?this._closeParent:!1!==this._closeParent)&&!this.hasMenu}changeMenu(e,t){const n=this,{constrainTo:r,scrollAction:i}=n.owner;return!e||"object"!=typeof e||"items"in e||"widgets"in e||"html"in e||(e={lazyItems:e}),Pc.reconfigure(t,e,{owner:n,defaults:{type:"menu",align:"s0-e0",anchor:!0,autoClose:!0,autoShow:!1,cls:"b-sub-menu",forElement:n.element,owner:n,ariaLabel:n.text,constrainTo:r,scrollAction:i}})}}Oc.initClass(),Oc._$name="MenuItem";const Lc={ArrowUp:1,ArrowDown:1,ArrowRight:1,ArrowLeft:1,Enter:1,Escape:1};class Pc extends Ic{static get $name(){return"Menu"}static get type(){return"menu"}static get configurable(){return{focusable:!0,align:"t-b",scrollAction:"hide",focusOnHover:null,scrollable:!1,defaultType:"menuitem",tools:{close:!1},role:"menu",ariaElement:"bodyElement"}}construct(e){Array.isArray(e)&&(e={lazyItems:e}),super.construct(e),_n.on({element:this.element,click:"onMouseClick",mouseover:"onMouseOver",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",thisObj:this})}afterShow(e){const{items:t,element:n}=this;t.some((e=>Boolean(e._menu)))&&n.classList.add("b-menu-with-submenu"),t.some((e=>e.icon))&&n.classList.add("b-menu-with-icon"),super.afterShow(e)}createWidget(e){return"string"==typeof e&&(e={text:e}),super.createWidget(e)}get focusElement(){var e;const t=this,n=null===(e=t.parentMenu)||void 0===e?void 0:e.element.contains(Mr.getActiveElement(t.parentMenu)),r=t.items[0];return!n&&!Mr.usingKeyboard&&r instanceof Oc?t.element:super.focusElement}onDocumentMouseDown({event:e}){if(!this.parentMenu||!this.parentMenu.owns(e.target))return super.onDocumentMouseDown(...arguments)}hide(e){const t=this;var n,r;super.hide(e),t.isVisible||(null===(n=t.currentSubMenu)||void 0===n||null===(r=n.hide)||void 0===r||r.call(n,e),t.parentMenu&&(t.parentMenu.currentSubMenu=null))}show(){super.show(...arguments);const{parentMenu:e}=this;this.isVisible&&e&&(e.currentSubMenu=this)}onMouseClick(e){const t=e.target.closest(".b-menuitem");t&&this.triggerElement(t,e)}onMouseOver(e){if(!1!==this.focusOnHover){var t;const n=null===(t=e.relatedTarget)||void 0===t?void 0:t.closest(".b-widget"),r=e.target.closest(".b-widget"),i=Ka.fromElement(r);!Mr.isTouchEvent&&r&&r!==n&&i.parent===this&&this.setTimeout({fn:"handleMouseOver",delay:30,args:[i],cancelOutstanding:!0})}}handleMouseOver(e){e.focus()}onMouseEnter(){this.clearTimeout(this.closeTimer)}onMouseLeave(e){const t=this,{relatedTarget:n}=e,r=n&&t.owns(n);let i=n instanceof HTMLElement&&Ka.fromElement(n),s=!r;if(i){for(;i.ownerCmp;)i=i.ownerCmp;s&=!Mr.getAncestor(i.element,[e.target])}!r&&s&&(t.currentSubMenu&&!t.currentSubMenu.closeTimer&&t.currentSubMenu.hide(),t.element.contains(Mr.getActiveElement(t))&&Mr.getActiveElement(t).matches(".b-menuitem")&&t.focusElement.focus())}onInternalKeyDown(e){const t=Ka.fromElement(e),n=t&&t!==this&&!(t instanceof Oc);if("Escape"===e.key)return void(n?this:this.rootMenu).close();if(super.onInternalKeyDown(e),n)return;Lc[e.key]&&e.preventDefault();const r=this.element,i=Mr.getActiveElement(r);this.navigateFrom(i!==r&&r.contains(i)?i:null,e.key,e)}navigateFrom(e,t,n){const r=this,{treeWalker:i}=r,s=e&&r.getItem(e),o=r.rtl?"ArrowLeft":"ArrowRight",a=r.rtl?"ArrowRight":"ArrowLeft";let l;switch(t){case"ArrowUp":i.currentNode=e||(e=r.bottomFocusTrap),i.previousNode(),l=i.currentNode;break;case"ArrowDown":i.currentNode=e||(e=r.topFocusTrap),i.nextNode(),l=i.currentNode;break;case" ":e&&!e.classList.contains("b-disabled")&&(null!=s&&s.menu?r.openSubMenu(e,s):r.triggerElement(e,n));break;case o:if(e&&null!=s&&s.menu&&!e.classList.contains("b-disabled")){const t=r.openSubMenu(e,s);null==t||t.focus()}else i.currentNode=e||(e=r.topFocusTrap),i.nextNode(),l=i.currentNode;break;case a:r.isSubMenu?r.hide():e||(i.currentNode=e||(e=r.topFocusTrap),i.nextNode(),l=i.currentNode);break;case"Enter":e&&!e.classList.contains("b-disabled")&&r.triggerElement(e,n)}l&&(l===r.element?r.navigateFrom(r.bottomFocusTrap,"ArrowUp",n):l===e?r.navigateFrom(r.topFocusTrap,"ArrowDown",n):l.focus())}getItem(e){if(null!=e)return"number"==typeof e?this.items[e]:e.nodeType===Element.ELEMENT_NODE?Ka.fromElement(e,"menuitem",this.contentElement):this.items.find((t=>t.id==e))}triggerElement(e,t){const n=this.getItem(e);n&&!n.disabled&&n.doAction(t)}get isSubMenu(){var e;return this===(null===(e=this.owner)||void 0===e?void 0:e.menu)}openSubMenu(e,t){const n=this,r=t.menu;if(r){if(!r.isVisible){var i;const s={item:t,element:e};if(!1===n.trigger("beforeSubMenu",s))return;if(!1===(null===(i=t.onBeforeSubMenu)||void 0===i?void 0:i.call(t,s)))return;r.show()}return n.currentSubMenu=r}}set selectedElement(e){const t=this,n=t._selectedElement;if(n){const e=t.getItem(n),r=null==e?void 0:e.menu;null==r||r.hide(),n.classList.remove("b-active")}if(t._selectedElement=e,e){const n=Mr.isFocusable(e);e.classList.add("b-active"),t.scrollable.scrollIntoView(e,{animate:!n,focus:n})}}get selectedElement(){return this._selectedElement}selectFirst(){const e=this.treeWalker;e.currentNode=this.topFocusTrap,e.nextNode(),this.requestAnimationFrame((()=>e.currentNode.focus()))}get parentMenu(){var e;const t=this.owner;return t&&(t.isMenu?t:null===(e=t.up)||void 0===e?void 0:e.call(t,"menu"))}get rootMenu(){let e=this;for(;e.parentMenu instanceof this.constructor;)e=e.parentMenu;return e}}let $c;Pc.initClass(),Pc._$name="Menu";class _c extends Wr{static get $name(){return"ContextMenuBase"}static get configurable(){return{type:null,menu:{$config:["lazy","nullify"],value:{type:"menu",autoShow:!1,closeAction:"hide",scrollAction:"hide",constrainTo:globalThis}},items:{},triggerEvent:!1,keyMap:{" ":{handler:"showContextMenuByKey",weight:100},"Ctrl+Space":"showContextMenuByKey"}}}static get pluginConfig(){return{assign:["showContextMenu"],chain:["onElementContextMenu","onElementClick","onElementDblClick"]}}construct(...e){var t;if(super.construct(...e),null===(t=this.type)||void 0===t||!t.length)throw new Error("Config 'type' is required to be specified for context menu")}onElementContextMenu(e){this.onElementEvent(e)}onElementClick(e){this.onElementEvent(e)}onElementDblClick(e){this.onElementEvent(e)}onElementEvent(e){if(!e.handled&&this.triggerEvent===e.type){const t=e;if($c){const{target:n}=$c;e=_n.fixEvent(new MouseEvent(e.type,e)),Object.defineProperty(e,"target",{get:()=>n,configurable:!0}),e.preventDefault=function(){t.preventDefault(),t.handled=!0}}this.internalShowContextMenu(e)}}showContextMenuByKey(e){if(!Mr.isEditable(e.target)){const t=this.getKeyboardContextMenuTarget(e.target);if(t)return $c=e,Mr.triggerMouseEvent(t,this.triggerEvent),e.handled=!0,e.preventDefault(),e.stopImmediatePropagation(),$c=null,!0}return!1}getKeyboardContextMenuTarget(e){const t=Mr.isInView(e);return e.children.length?Mr.childFromPoint(e,t.width/2,t.height/2):e}internalShowContextMenu(e){const t=this;if(t.disabled)return;const n=t.getDataFromEvent(e);!e.handled&&n&&t.shouldShowMenu(n)&&(n.domEvent=e,t.showContextMenu(n))}getDataFromEvent(e){return{event:e,targetElement:this.getTargetElementFromEvent(e)}}getTargetElementFromEvent(e){return e.target}showContextMenu(e,t){var n;const r=this,i=Mr.isDOMEvent(e),s=i?r.getDataFromEvent(e):e,o=i?e:s.domEvent;if(null===(n=r._menu)||void 0===n||n.hide(),r.disabled)return;r.menuContext=s;const{type:a,client:l,processItems:c}=r,d=Mr.isInView(s.targetElement).center;if(Y.assign(s,{feature:r,point:null!=o&&o.clientX?[o.clientX+1,o.clientY+1]:[d.x,d.y],menu:r,items:{},selection:l.selectedRecords}),r.callChainablePopulateMenuMethod(s),Y.merge(s.items,r.baseItems),r.preventDefaultEvent(s),(!c||!1!==r.callback(c,l,[s]))&&r.hasActiveMenuItems(s)&&(r.populateItemsWithData(s),!1!==r.beforeContextMenuShow(s))){const{menu:e}=r;var u;!1!==l.trigger(`${a}MenuBeforeShow`,s)&&(e.items=s.items,e.showBy(t||s.point),null===(u=r.touchMoveDetacher)||void 0===u||u.call(r),r.touchMoveDetacher=_n.on({element:l.element,touchmove:()=>e.hide(),once:!0}),o&&(o.preventDefault(),o.handled=!0))}}get baseItems(){if(!this._baseItems){const e=this,{namedItems:t}=e,n=e._baseItems=Y.assign({},e.items);for(const e in n){const r=n[e];r&&(t&&e in t?n[e]="object"==typeof r?Y.merge(Y.clone(t[e]),r):t[e]:!0===r&&delete n[e])}}return this._baseItems}hideContextMenu(e){var t;null===(t=this.menu)||void 0===t||t.hide(e)}callChainablePopulateMenuMethod(e){var t,n;null===(t=(n=this.client)[`populate${_.capitalize(this.type)}Menu`])||void 0===t||t.call(n,e)}hasActiveMenuItems(e){return Object.values(e.items).some((e=>e&&!e.hidden))}shouldShowMenu(){return!0}beforeContextMenuShow(e){}populateItemsWithData(e){}preventDefaultEvent(e){var t;null===(t=e.event)||void 0===t||t.preventDefault()}changeTriggerEvent(e){return e||this.client.contextMenuTriggerEvent}changeMenu(e,t){const n=this,{client:r,type:i}=n;if(e)return Pc.reconfigure(t,e?Pc.mergeConfigs({owner:r,rootElement:r.rootElement,onItem(e){r.trigger(`${i}MenuItem`,e)},onToggle(e){r.trigger(`${i}MenuToggleItem`,e)},onDestroy(){n.menu=null},onBeforeItem(e){Object.assign(e,n.menuContext)},onShow({source:e}){n.menuContext.menu=e,r.trigger(`${i}MenuShow`,n.menuContext)}},e):null,n);null!=t&&t.isWidget&&t.destroy()}}_c._$name="ContextMenuBase";var Nc=e=>class extends(e||Te){static get $name(){return"DragHelperContainer"}initContainerDrag(){const e=this;if(e.mode||(e.mode="container"),"container"===e.mode&&!e.containers)throw new Error("Container drag mode must specify containers")}grabContainerDrag(e){const t=this;if(!t.ignoreSelector||!e.target.closest(t.ignoreSelector)){const n=Mr.getAncestor(e.target,t.containers,t.outerElement);if(n){const r=n.getBoundingClientRect();t.context={element:n,valid:!0,action:"container",offsetX:e.pageX-r.left,offsetY:e.pageY-r.top,originalPosition:{parent:n.parentElement,prev:n.previousElementSibling,next:n.nextElementSibling}}}return!0}return!1}startContainerDrag(e){var t;const n=this,{context:r,floatRootOwner:i}=n,{element:s}=r,o=s.cloneNode(!0),a=s.getBoundingClientRect(),l=null==i?void 0:i.element.closest(".b-outer");o.classList.add(n.dragProxyCls),o.classList.add(n.draggingCls),((null==i?void 0:i.floatRoot)||Mr.getRootElement(s)).appendChild(o),r.dragProxy=o,o.style.width=a.width+"px",o.style.height=a.height+"px",Mr.setTranslateXY(r.dragProxy,a.left,a.top),r.dragging=s,s.classList.add(n.dropPlaceholderCls),null!=l&&null!==(t=l.parentElement)&&void 0!==t&&t.matches(".b-float-root")&&(o.style.zIndex=i.floatRootMaxZIndex+1)}updateContainerDrag(e){var t;const n=this,{context:r}=n;if(!r.started||!r.targetElement)return;const i=Mr.getAncestor(r.targetElement,n.containers,"b-gridbase"),s=null===(t=r.dragging)||void 0===t?void 0:t.contains(Mr.getActiveElement(r.dragging));i&&Mr.isDescendant(r.element,i)||(s&&zr.suspendFocusEvents(),i&&r.valid?n.moveNextTo(i,e):n.revertPosition(),s&&zr.resumeFocusEvents(),e.preventDefault())}finishContainerDrag(e){const t=this,{context:n}=t,{dragging:r,dragProxy:i,valid:s,draggedTo:o,insertBefore:a,originalPosition:l}=n;r&&(n.valid=s&&o&&(r!==a||l.parent!==o),n.finalize=(e=n.valid)=>{!e&&t.context&&t.revertPosition(),r.classList.remove(t.dropPlaceholderCls),i.remove(),t.reset()},n.async=!1,t.trigger("drop",{context:n,event:e}),n.async||n.finalize())}abortContainerDrag(e=!1,t=null,n=!1){const r=this,{context:i}=r;i.dragging&&(i.dragging.classList.remove(r.dropPlaceholderCls),i.dragProxy.remove(),r.revertPosition()),n||r.trigger(e?"drop":"abort",{context:i,event:t}),r.reset()}updateContainerProxy(e){const t=this,{context:n}=t,r=n.dragProxy;let i,s=e.pageX-n.offsetX,o=e.pageY-n.offsetY;if("number"==typeof t.minX&&(s=Math.max(t.minX,s)),"number"==typeof t.maxX&&(s=Math.min(t.maxX-r.offsetWidth,s)),"number"==typeof t.minY&&(o=Math.max(t.minY,o)),"number"==typeof t.maxY&&(o=Math.min(t.maxY-r.offsetHeight,o)),t.lockX?Mr.setTranslateY(r,o):t.lockY?Mr.setTranslateX(r,s):Mr.setTranslateXY(r,s,o),"touchmove"===e.type){const t=e.changedTouches[0];i=Mr.elementFromPoint(t.clientX,t.clientY)}else i=e.target;n.targetElement=i}moveNextTo(e,t){const{context:n}=this,r=n.dragging,i=e.parentElement;if(e!==r){const s=xn.from(e).center.x;this.isRTL&&t.pageX>s||!this.isRTL&&t.pageX<s?(i.insertBefore(r,e),n.insertBefore=e):e.nextElementSibling?e.nextElementSibling!==r?(n.insertBefore=e.nextElementSibling,i.insertBefore(r,e.nextElementSibling)):n.insertBefore||r.parentElement.lastElementChild===r||(n.insertBefore=e.nextElementSibling):(i.appendChild(r),n.insertBefore=null),n.draggedTo=i}}revertPosition(){const{context:e}=this,{dragging:t}=e,{parent:n,next:r}=e.originalPosition;r?r.previousSibling===t||!r&&t===n.lastChild||n.insertBefore(t,r):n.appendChild(t),e.draggedTo=null}};const Hc={pageXOffset:0,pageYOffset:0};var Bc=e=>class extends(Zr(e||Te)){static get $name(){return"DragHelperTranslate"}static get configurable(){return{positioning:null,skipUpdatingElement:null}}initTranslateDrag(){const e=this;!e.isElementDraggable&&e.targetSelector&&(e.isElementDraggable=t=>t.closest(e.targetSelector))}grabTranslateDrag(e){const t=this.getTarget(e);return!!t&&(this.context={valid:!0,element:t,startPageX:e.pageX,startPageY:e.pageY,startClientX:e.clientX,startClientY:e.clientY},!0)}getTarget(e){return e.target.closest(this.targetSelector)}getX(e){return"absolute"===this.positioning?parseFloat(e.style.left,10):Mr.getTranslateX(e)}getY(e){return"absolute"===this.positioning?parseFloat(e.style.top,10):Mr.getTranslateY(e)}getXY(e){return"absolute"===this.positioning?[e.offsetLeft,e.offsetTop]:Mr.getTranslateXY(e)}setXY(e,t,n){this.skipUpdatingElement||("absolute"===this.positioning?(e.style.left=t+"px",e.style.top=n+"px"):Mr.setTranslateXY(e,t,n))}startTranslateDrag(e){const t=this,{context:n,outerElement:r,proxySelector:i}=t,s=t.dragWithin=t.dragWithin||t.cloneTarget&&document.body;let o=n.dragProxy||n.element;const a=o,l=o.parentElement;if(t.cloneTarget){const r=i?o.querySelector(i):o,{width:l,height:c,x:d,y:u}=xn.from(r,s);let h=d,g=u;if(o=t.createProxy(o),t.autoSizeClonedTarget&&(o.style.width=`${l}px`,o.style.height=`${c}px`),o.classList.add(t.dragProxyCls,t.draggingCls),o.classList.remove("b-hover","b-selected","b-focused"),s.appendChild(o),!t.autoSizeClonedTarget||i){const t=o.getBoundingClientRect(),{x:r,y:i}=s.getBoundingClientRect(),a=e.clientX-r,l=e.clientY-i+(s!==document.body?document.body.getBoundingClientRect().y:0);h=a-t.width/2,g=l-t.height/2,n.startPageX=e.pageX,n.startPageY=e.pageY}t.setXY(o,h,g),a.classList.add("b-drag-original"),t.hideOriginalElement&&a.classList.add("b-hidden")}o.classList.add(t.draggingCls),Object.assign(n,{element:o,grabbed:a,grabbedParent:l,grabbedNextSibling:o.nextElementSibling,elementStartX:t.getX(o),elementStartY:t.getY(o),elementX:Mr.getOffsetX(o,s||r),elementY:Mr.getOffsetY(o,s||r),scrollX:0,scrollY:0,scrollManagerElementContainsDragProxy:!t.cloneTarget||s===r}),s&&(n.parentElement=o.parentElement,s!==o.parentElement&&s.appendChild(o),t.updateTranslateProxy(e))}onDragStarted(){var e;const t=this,{context:n}=t;let{relatedElements:r}=n;if(t.unifiedProxy&&n.element.classList.add("b-drag-main","b-drag-unified-proxy"),(null===(e=r)||void 0===e?void 0:e.length)>0){n.relatedElStartPos=[],n.relatedElDragFromPos=[];const{proxySelector:e}=t;let[i,s]=[n.elementStartX,n.elementStartY];n.originalRelatedElements=r,r=n.relatedElements=r.map(((r,o)=>{const a=e?r.querySelector(e):r,{x:l,y:c,width:d,height:u}=xn.from(a,t.dragWithin),h=t.cloneTarget?t.createProxy(r):r;return h.classList.add(t.draggingCls),h.classList.remove("b-hover","b-selected","b-focused"),t.cloneTarget&&(t.setXY(h,l,c),t.dragWithin.appendChild(h),h.classList.add(t.dragProxyCls),t.autoSizeClonedTarget&&(h.style.width=`${d}px`,h.style.height=`${u}px`),t.hideOriginalElement&&r.classList.add("b-hidden"),r.classList.add("b-drag-original")),n.relatedElStartPos[o]=n.relatedElDragFromPos[o]=t.getXY(h),t.unifiedProxy&&(h.classList.add("b-drag-unified-animation","b-drag-unified-proxy"),i+=t.unifiedOffset,s+=t.unifiedOffset,t.setXY(h,i,s),n.relatedElDragFromPos[o]=[i,s],h.style.zIndex=100-o),h})),t.unifiedProxy&&r&&r.length>0&&_n.onTransitionEnd({element:r[0],property:"transform",handler(){r.forEach((e=>e.classList.remove("b-drag-unified-animation")))},thisObj:t,once:!0})}}applyConstraints(e,t,n){const r=this,{constrain:i,dragWithin:s}=r,{pageXOffset:o,pageYOffset:a}=s===document.body?globalThis:Hc;return s&&i&&(t<0&&(t=0),t+e.offsetWidth>s.scrollWidth&&(t=s.scrollWidth-e.offsetWidth),n<0&&(n=0),n+e.offsetHeight>s.scrollHeight&&(n=s.scrollHeight-e.offsetHeight)),"number"==typeof r.minX&&(t=Math.max(r.minX+o,t)),"number"==typeof r.maxX&&(t=Math.min(r.maxX+o,t)),"number"==typeof r.minY&&(n=Math.max(r.minY+a,n)),"number"==typeof r.maxY&&(n=Math.min(r.maxY+a,n)),{constrainedX:t,constrainedY:n}}updateTranslateProxy(e,t){const n=this,{lockX:r,lockY:i,context:s}=n,o=s.dragProxy||s.element,{relatedElements:a,relatedElDragFromPos:l}=s;s.scrollManagerElementContainsDragProxy&&t&&(s.scrollX=t.getRelativeLeftScroll(o),s.scrollY=t.getRelativeTopScroll(o)),s.pageX=e.pageX,s.pageY=e.pageY,s.clientX=e.clientX,s.clientY=e.clientY;let c=s.elementStartX+e.pageX-s.startPageX+s.scrollX,d=s.elementStartY+e.pageY-s.startPageY+s.scrollY;if(n.snapCoordinates){const e=n.snapCoordinates({element:o,newX:c,newY:d});c=e.x,d=e.y}const{constrainedX:u,constrainedY:h}=n.applyConstraints(o,c,d);if(n.setXY(o,r?void 0:u,i?void 0:h),a){const e=r?0:u-s.elementStartX,t=i?0:h-s.elementStartY;a.forEach(((r,i)=>{const[s,o]=l[i];n.setXY(r,s+e,o+t)}))}s.newX=u,s.newY=h}async finishTranslateDrag(e){const t=this,n=t.context,{target:r}=e,i=!t.lockX&&Math.round(n.newX)!==Math.round(n.elementStartX),s=!t.lockY&&Math.round(n.newY)!==Math.round(n.elementStartY),o=n.dragProxy||n.element,{relatedElements:a}=n;if(!t.ignoreSamePositionDrop||i||s)if(!1===n.valid)await t.abortTranslateDrag(!0,e);else{const i=xn.from(t.dragWithin||t.outerElement);"number"!=typeof t.minX&&!0!==t.minX&&e.pageX<i.left||"number"!=typeof t.maxX&&!0!==t.maxX&&e.pageX>i.right||"number"!=typeof t.minY&&!0!==t.minY&&e.pageY<i.top||"number"!=typeof t.maxY&&!0!==t.maxY&&e.pageY>i.bottom?(n.valid=!1,await t.abortTranslateDrag(!0,e)):(n.finalize=async(i=n.valid)=>{n.finalized?console.warn("DragHelper: Finalizing already finalized drag"):(n.finalized=!0,!i&&t.context&&await t.abortTranslateDrag(!0,null,!0),t.isDestroyed||(t.trigger("dropFinalized",{context:n,event:e,target:r}),t.reset()),t.cloneTarget||o.parentElement===n.grabbedParent||[o,...a||[]].forEach((e=>e.style.transform="")))},n.async=!1,await t.trigger("drop",{context:n,event:e,target:r}),n.async||await n.finalize())}else t.abortTranslateDrag(!1,e)}async abortTranslateDrag(e=!1,t=null,n=!1){var r,i;const s=this,{cloneTarget:o,context:a,proxySelector:l,dragWithin:c}=s,{relatedElements:d,relatedElStartPos:u,grabbed:h}=a,g=a.dragProxy||a.element;if(null===(r=s.scrollManager)||void 0===r||r.stopMonitoring(),a.aborted)return void console.warn("DragHelper: Aborting already aborted drag");let{elementStartX:m,elementStartY:p}=a;if(g&&a.started){if(!o&&c&&c!==a.grabbedParent&&a.grabbedParent.insertBefore(g,a.grabbedNextSibling),o&&l){const e=h.querySelector(l)||h,{x:t,y:n}=xn.from(e);m=t,p=n}g.classList.add("b-aborting"),s.setXY(g,m,p),null==d||d.forEach(((e,t)=>{e.classList.remove("b-dragging"),e.classList.add("b-aborting"),s.setXY(e,u[t][0],u[t][1])})),n||s.trigger(e?"drop":"abort",{context:a,event:t}),s.isDestroying||await _n.waitForTransitionEnd({element:g,property:Mr.getPropertyTransitionDuration(g,"transform")?"transform":"all",thisObj:s,once:!0,runOnDestroy:!0}),s.isDestroyed||s.trigger("abortFinalized",{context:a,event:t})}null!==(i=s.context)&&void 0!==i&&i.started&&s.reset()}cleanUp(){const{context:e,cloneTarget:t,draggingCls:n}=this,r=e.dragProxy||e.element,{relatedElements:i,originalRelatedElements:s,grabbed:o}=e,a=t&&(this.removeProxyAfterDrop||!e.valid),l=[n,"b-aborting","b-drag-proxy","b-drag-main","b-drag-unified-proxy"];r.classList.remove(...l),a&&r.remove(),null==i||i.forEach((e=>{a?e.remove():e.classList.remove(...l)})),o.classList.remove("b-drag-original","b-hidden"),null==s||s.forEach((e=>e.classList.remove("b-hidden","b-drag-original")))}};class jc extends(Te.mixin(tt,Nc,Bc)){static get defaultConfig(){return{dragProxyCls:"b-drag-proxy",invalidCls:"b-drag-invalid",draggingCls:"b-dragging",dropPlaceholderCls:"b-drop-placeholder",dragThreshold:5,outerElement:document.body,dragWithin:null,unifiedProxy:null,monitoringConfig:null,constrain:!0,minX:null,maxX:null,minY:null,maxY:null,mode:"translateXY",isElementDraggable:null,targetSelector:null,dropTargetSelector:null,dropTargetCls:null,proxySelector:null,cloneTarget:!1,autoSizeClonedTarget:!0,hideOriginalElement:!1,containers:null,ignoreSelector:null,startEvent:null,lockX:!1,lockY:!1,touchStartDelay:300,scrollManager:null,snapCoordinates:null,unifiedOffset:5,removeProxyAfterDrop:!0,clickSwallowDuration:50,ignoreSamePositionDrop:!0,floatRootOwner:null,mouseMoveListenerElement:document,testConfig:{transitionDuration:10,clickSwallowDuration:50,touchStartDelay:100},rtlSource:null}}construct(e){const t=this;super.construct(e),t.initListeners(),t.isContainerDrag?t.initContainerDrag():t.initTranslateDrag(),t.onScrollManagerScrollCallback=t.onScrollManagerScrollCallback.bind(t)}doDestroy(){this.reset(!0),super.doDestroy()}initListeners(){const e=this,{outerElement:t}=e,n={element:t,pointerdown:"onPointerDown",thisObj:e};e.mouseMoveListenerElement=e.getMouseMoveListenerTarget(t),_n.on(n),_n.on({element:globalThis,blur:"onWindowBlur",thisObj:e})}getMouseMoveListenerTarget(e){const t=e.getRootNode();let n=this.mouseMoveListenerElement;return t.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&"closed"===t.mode&&(n=e.closest(".b-outer")||n),n}get isRTL(){var e;return Boolean(null===(e=this.rtlSource)||void 0===e?void 0:e.rtl)}onPointerDown(e){const t=this;if(0===e.button&&Mr.isVisible(e.target)&&!t.context&&(!t.isElementDraggable||t.isElementDraggable(e.target,e))&&(t.startEvent=e,t.isContainerDrag?t.grabContainerDrag(e):t.grabTranslateDrag(e))){const n={element:t.mouseMoveListenerElement,thisObj:t,capture:!0,keydown:"onKeyDown"};if("touch"===e.pointerType?(t.touchStartTimer=t.setTimeout((()=>t.touchStartTimer=null),t.touchStartDelay,"touchStartDelay"),n.touchmove={handler:"onTouchMove",passive:!1},n.touchend=n.pointerup="onTouchEnd"):(n.pointermove="onMouseMove",n.pointerup="onMouseUp"),t.removeListeners=_n.on(n),t.dragWithin&&t.dragWithin!==t.outerElement&&t.outerElement.contains(t.dragWithin)){const e=xn.from(t.dragWithin,t.outerElement);t.minY=e.top,t.maxY=e.bottom,t.minX=e.left,t.maxX=e.right}}}internalMove(e){var t;if(e.scrollInitiated)return;const n=this,{context:r}=n,i=_n.getDistanceBetween(n.startEvent,e);if(n.touchStartTimer&&i>n.dragThreshold)n.abort(!0);else if(!n.touchStartTimer&&null!=r&&r.element&&(r.started||i>=n.dragThreshold)&&(null===(t=e.target)||void 0===t?void 0:t.nodeType)===Node.ELEMENT_NODE){if(!r.started){var s,o;if(!1===n.trigger("beforeDragStart",{context:r,event:e}))return n.abort();n.isContainerDrag?n.startContainerDrag(e):n.startTranslateDrag(e),r.started=!0,null===(s=n.scrollManager)||void 0===s||s.startMonitoring(sn.merge({scrollables:[{element:n.dragWithin||n.outerElement}],callback:n.onScrollManagerScrollCallback},n.monitoringConfig)),r.outermostEl=Mr.getOutermostElement(e.target),r.outermostEl.classList.add("b-draghelper-active"),n.dropTargetSelector&&n.dropTargetCls&&Mr.getRootElement(n.outerElement).querySelectorAll(n.dropTargetSelector).forEach((e=>e.classList.add(n.dropTargetCls))),n.trigger("dragStart",{context:r,event:e}),null===(o=n.onDragStarted)||void 0===o||o.call(n)}n.update(e),"touchmove"===e.type&&(e.preventDefault(),e.stopImmediatePropagation())}}onScrollManagerScrollCallback(e){var t;const{lastMouseMoveEvent:n}=this;null!==(t=this.context)&&void 0!==t&&t.element&&n&&(n.isScroll=!0,this.update(n,e))}onTouchMove(e){this.internalMove(e)}onMouseMove(e){this.internalMove(e)}update(e,t){const n=this,{context:r}=n,i=document.scrollingElement||document.body;let s=n.getMouseMoveEventTarget(e);if("touchmove"===e.type){const t=e.changedTouches[0];s=Mr.elementFromPoint(t.clientX+i.scrollLeft,t.clientY+i.scrollTop)}r.target=s;let o=!n.dragWithin||n.dragWithin.contains(e.target);var a;o&&n.dropTargetSelector&&(o=o&&Boolean(null===(a=s)||void 0===a?void 0:a.closest(n.dropTargetSelector))),n.isContainerDrag?n.updateContainerProxy(e,t):n.updateTranslateProxy(e,t),r.valid=o,n.trigger("drag",{context:r,event:e}),n.isContainerDrag&&n.updateContainerDrag(e,t),r.valid=r.valid&&o;for(const e of n.draggedElements)e.classList.toggle(n.invalidCls,!r.valid);e&&(n.lastMouseMoveEvent=e)}get draggedElements(){var e;const{context:t}=this;return[t.dragProxy||t.element,...null!==(e=t.relatedElements)&&void 0!==e?e:[]]}async abort(e=!1){var t,n;const r=this,{context:i}=r;null===(t=r.scrollManager)||void 0===t||null===(n=t.stopMonitoring)||void 0===n||n.call(t),r.removeListeners(),null!=i&&i.started&&!i.aborted?(i.element.getBoundingClientRect(),i.valid=!1,r.isContainerDrag?r.abortContainerDrag(void 0,void 0,e):r.abortTranslateDrag(void 0,void 0,e),i.aborted=!0):r.reset(!0)}removeListeners(){}reset(e){const t=this,{context:n}=t;if(null!=n&&n.started){for(const e of t.draggedElements)e.classList.remove(t.invalidCls);n.outermostEl.classList.remove("b-draghelper-active"),t.isContainerDrag?n.dragProxy.remove():t.cleanUp(),t.dropTargetSelector&&t.dropTargetCls&&Mr.getRootElement(t.outerElement).querySelectorAll(t.dropTargetSelector).forEach((e=>e.classList.remove(t.dropTargetCls)))}t.removeListeners(),e||t.trigger("reset"),t.context=t.lastMouseMoveEvent=null}onTouchEnd(e){this.onMouseUp(e)}onDocumentClick(e){e.stopPropagation()}onMouseUp(e){const t=this,{context:n}=t;var r;t.removeListeners(),n&&(null===(r=t.scrollManager)||void 0===r||r.stopMonitoring(),n.started?(e.stopImmediatePropagation(),n.finalizing=!0,t.isContainerDrag?t.finishContainerDrag(e):t.finishTranslateDrag(e),_n.on({element:document,thisObj:t,click:"onDocumentClick",capture:!0,expires:t.clickSwallowDuration,once:!0})):t.reset(!0))}onKeyDown(e){var t;null!==(t=this.context)&&void 0!==t&&t.started&&"Escape"===e.key&&(e.stopImmediatePropagation(),this.abort())}onWindowBlur(){this.context&&!this.context.finalizing&&this.abort()}createProxy(e){this.proxySelector&&(e=e.querySelector(this.proxySelector)||e);const t=e.cloneNode(!0);return t.removeAttribute("id"),t}get isContainerDrag(){return"container"===this.mode}async animateProxyTo(e,t={align:"c-c"}){const{context:n,draggedElements:r}=this,{element:i}=n,s=e.isRectangle?e:xn.from(e);r.forEach((e=>{e.classList.add("b-drag-final-transition"),Mr.alignTo(e,s,t)})),await _n.waitForTransitionEnd({element:i,property:"all",thisObj:this,once:!0}),r.forEach((e=>e.classList.remove("b-drag-final-transition")))}get isDragging(){var e;return Boolean(null===(e=this.context)||void 0===e?void 0:e.started)}getMouseMoveEventTarget(e){return e.isScroll?Mr.elementFromPoint(e.clientX,e.clientY):e.target}}jc._$name="DragHelper";const Vc={down:"onMouseDown",move:"onMouseMove",up:"onMouseUp",docclick:"onDocumentClick",touchstart:{handler:"onTouchStart",passive:!1},touchmove:"onTouchMove",touchend:"onTouchEnd",keydown:"onKeyDown"};class zc extends(tt(Te)){static get defaultConfig(){return{resizingCls:"b-resizing",dragThreshold:5,handleSize:10,dynamicHandleSize:null,reservedSpace:10,touchHandleSize:30,minWidth:1,maxWidth:0,minHeight:1,maxHeight:0,outerElement:document.body,scroller:null,allowResize:null,dragWithin:null,isElementResizable:null,targetSelector:null,leftHandle:!0,rightHandle:!0,topHandle:!0,bottomHandle:!0,handleSelector:null,handleContainerSelector:null,startEvent:null,grab:null,invalidCls:"b-resize-invalid",handleVisibilityThreshold:null,skipTranslate:!1,direction:"horizontal",clickSwallowDuration:50,rtlSource:null}}construct(e){const t=this;super.construct(e),t.handleSelector||y.isHoverableDevice||(t.handleSize=t.touchHandleSize),t.handleVisibilityThreshold=t.handleVisibilityThreshold||2*t.handleSize,t.initListeners(),t.initResize()}doDestroy(){this.abort(!0),super.doDestroy()}updateSkipUpdatingElement(e){e&&(this.skipTranslate=!0)}initResize(){const e=this;if(!e.isElementResizable&&e.targetSelector&&(e.isElementResizable=t=>t.closest(e.targetSelector)),e.grab){const{edge:t,element:n,event:r}=e.grab;e.startEvent=r;const i=e.getCursorOffsetToElementEdge(r,n,t);e.context={element:n,edge:t,valid:!0,async:!1,elementStartX:Mr.getTranslateX(n)||n.offsetLeft,elementStartY:Mr.getTranslateY(n)||n.offsetTop,newX:Mr.getTranslateX(n)||n.offsetLeft,newY:Mr.getTranslateY(n)||n.offsetTop,elementWidth:n.offsetWidth,elementHeight:n.offsetHeight,cursorOffset:i,startX:r.clientX+i.x+e.scrollLeft,startY:r.clientY+i.y+e.scrollTop,finalize:()=>{var t;return null===(t=e.reset)||void 0===t?void 0:t.call(e)}},n.classList.add(e.resizingCls),e.internalStartResize(e.isTouch)}}initListeners(){const e=this,t={element:e.outerElement,mousedown:Vc.down,touchstart:Vc.touchstart,thisObj:e};!e.handleSelector&&y.isHoverableDevice&&(t.mousemove={handler:Vc.move,delegate:e.targetSelector},t.mouseleave={handler:"onMouseLeaveTarget",delegate:e.targetSelector,capture:!0}),e.removeListeners=_n.on(t)}removeListeners(){}get isRTL(){var e;return Boolean(null===(e=this.rtlSource)||void 0===e?void 0:e.rtl)}get scrollLeft(){return this.scroller?this.scroller.x:this.outerElement.scrollLeft}get scrollTop(){return this.scroller?this.scroller.y:this.outerElement.scrollTop}internalStartResize(e){const t={element:document,keydown:Vc.keydown,thisObj:this};e?(t.touchmove=Vc.touchmove,t.touchend=t.pointerup=Vc.touchend):(t.mousemove=Vc.move,t.mouseup=Vc.up),this.removeDragListeners=_n.on(t)}removeDragListeners(){}reset(){var e;null===(e=this.removeDragListeners)||void 0===e||e.call(this),this.context=null,this.trigger("reset")}canResize(e,t){return!this.isElementResizable||this.isElementResizable(e,t)}onPointerDown(e,t){const n=this;n.startEvent=t,n.canResize(t.target,t)&&n.grabResizeHandle(e,t)&&(t.stopImmediatePropagation(),"touchstart"===t.type&&t.preventDefault(),n.internalStartResize(e))}onTouchStart(e){e.touches.length>1||this.onPointerDown(!0,e)}onMouseDown(e){0===e.button&&this.onPointerDown(!1,e)}internalMove(e,t){const n=this,{context:r,direction:i}=n;var s;null!=r&&r.element&&(r.started||_n.getDistanceBetween(n.startEvent,t)>=n.dragThreshold)?(r.started||(null===(s=n.scrollManager)||void 0===s||s.startMonitoring(sn.merge({scrollables:[{element:n.dragWithin||n.outerElement,direction:i}],callback:e=>{var t;return(null===(t=n.context)||void 0===t?void 0:t.element)&&n.lastMouseMoveEvent&&n.update(n.lastMouseMoveEvent,e)}},n.monitoringConfig)),n.trigger("resizeStart",{context:r,event:t}),r.started=!0),n.update(t)):e||n.handleSelector||n.checkResizeHandles(t)}onTouchMove(e){this.internalMove(!0,e)}onMouseMove(e){this.internalMove(!1,e)}onPointerUp(e,t){var n;const r=this,i=r.context;var s,o;null===(n=r.removeDragListeners)||void 0===n||n.call(r),i?(null===(s=r.scrollManager)||void 0===s||s.stopMonitoring(),i.started&&_n.on({element:document,thisObj:r,click:Vc.docclick,expires:r.clickSwallowDuration,capture:!0,once:!0}),r.finishResize(t)):null===(o=r.reset)||void 0===o||o.call(r)}onTouchEnd(e){this.onPointerUp(!0,e)}onMouseUp(e){this.onPointerUp(!1,e)}onDocumentClick(e){e.stopPropagation()}onKeyDown(e){"Escape"===e.key&&this.abort()}update(e){const t=this,n=t.context,r=xn.from(t.outerElement);n.currentX=Math.max(Math.min(e.clientX+n.cursorOffset.x,r.right),r.x)+t.scrollLeft,n.currentY=Math.max(Math.min(e.clientY+n.cursorOffset.y,r.bottom),r.y)+t.scrollTop,e&&(t.updateResize(e)&&(t.trigger("resizing",{context:n,event:e}),n.element.classList.toggle(t.invalidCls,!1===n.valid)),t.lastMouseMoveEvent=e)}abort(e=!1){var t,n;const r=this;null===(t=r.scrollManager)||void 0===t||null===(n=t.stopMonitoring)||void 0===n||n.call(t),r.context?r.abortResize(null,e):r.isDestroyed||r.reset()}grabResizeHandle(e,t){const n=this;if(n.allowResize&&!n.allowResize(t.target,t))return!1;const r=n.handleSelector,i="touchstart"===t.type?t.changedTouches[0]:t,s=i.clientX,o=i.clientY,a=n.targetSelector?t.target.closest(n.targetSelector):t.target;if(a){let l;if(r){if(!t.target.matches(r))return!1;l="horizontal"===n.direction?t.pageX<Mr.getPageX(a)+a.offsetWidth/2?n.isRTL?"right":"left":n.isRTL?"left":"right":t.pageY<Mr.getPageY(a)+a.offsetHeight/2?"top":"bottom"}else if("horizontal"===n.direction?n.overLeftHandle(t,a)?l=n.isRTL?"right":"left":n.overRightHandle(t,a)&&(l=n.isRTL?"left":"right"):n.overTopHandle(t,a)?l="top":n.overBottomHandle(t,a)&&(l="bottom"),!l)return n.context=null,!1;"touchstart"===t.type&&t.preventDefault();const c=n.getCursorOffsetToElementEdge(i,a,l);if(!1!==n.trigger("beforeResizeStart",{element:a,event:t}))return n.context={element:a,edge:l,isTouch:e,valid:!0,async:!1,direction:n.direction,elementStartX:Mr.getTranslateX(a)||a.offsetLeft,elementStartY:Mr.getTranslateY(a)||a.offsetTop,newX:Mr.getTranslateX(a)||a.offsetLeft,newY:Mr.getTranslateY(a)||a.offsetTop,elementWidth:a.offsetWidth,elementHeight:a.offsetHeight,cursorOffset:c,startX:s+c.x+n.scrollLeft,startY:o+c.y+n.scrollTop,finalize:()=>{var e;return null===(e=n.reset)||void 0===e?void 0:e.call(n)}},a.classList.add(n.resizingCls),!0}return!1}getCursorOffsetToElementEdge(e,t,n){const r=xn.from(t);let i=0,s=0;switch(n){case"left":i=r.x-(this.isRTL?r.width:0)-e.clientX;break;case"right":i=r.x+(this.isRTL?0:r.width)-e.clientX;break;case"top":s=r.y-e.clientY;break;case"bottom":s=r.y+r.height-e.clientY}return{x:i,y:s}}checkResizeHandles(e){const t=this,n=t.targetSelector?e.target.closest(t.targetSelector):e.target;if(!n||t.allowResize&&!t.allowResize(e.target,e))t.currentElement&&t.unHighlightHandle();else if(t.currentElement=t.handleContainerSelector?e.target.closest(t.handleContainerSelector):e.target,t.currentElement){let r;r="horizontal"===t.direction?t.overLeftHandle(e,n)||t.overRightHandle(e,n):t.overTopHandle(e,n)||t.overBottomHandle(e,n),r?t.highlightHandle():t.unHighlightHandle()}}onMouseLeaveTarget(e){const t=this;t.currentElement=t.handleContainerSelector?e.target.closest(t.handleContainerSelector):e.target,t.currentElement&&t.unHighlightHandle()}updateResize(e){const t=this,{context:n,allowEdgeSwitch:r,skipTranslate:i,skipUpdatingElement:s}=t;let o;r&&("horizontal"===t.direction?n.edge=n.currentX>n.startX?"right":"left":n.edge=n.currentY>n.startY?"bottom":"top");const{element:a,elementStartX:l,elementStartY:c,elementWidth:d,elementHeight:u,edge:h}=n,{style:g}=a,m=n.currentX-n.startX,p=n.currentY-n.startY,f=Mr.getExtremalSizePX(a,"minWidth")||t.minWidth,v=Mr.getExtremalSizePX(a,"maxWidth")||t.maxWidth,y=Mr.getExtremalSizePX(a,"minHeight")||t.minHeight,b=Mr.getExtremalSizePX(a,"maxHeight")||t.maxHeight,C="right"===h&&!t.isRTL||"bottom"===h?1:-1,w=d+m*C,S=u+p*C;let D=Math.max(f,w),E=Math.max(y,S);if(v>0&&(D=Math.min(D,v)),b>0&&(E=Math.min(E,b)),g.flex&&(g.flex=""),"horizontal"===t.direction&&d!==D){if(s||(g.width=Math.abs(D)+"px"),n.newWidth=D,"left"===h||D<0){const e=Math.max(Math.min(l+d-t.minWidth,l+m),0);i||Mr.setTranslateX(a,Math.round(e)),n.newX=e}else"right"===h&&r&&!i&&Mr.setTranslateX(a,l);o=!0}else"vertical"===t.direction&&u!==S&&(s||(g.height=Math.abs(E)+"px"),n.newHeight=E,"top"===h||E<0?(n.newY=Math.max(Math.min(c+u-t.minHeight,c+p),0),i||Mr.setTranslateY(a,n.newY)):"bottom"===h&&r&&!i&&Mr.setTranslateY(a,c),o=!0);return o}finishResize(e){const t=this,n=t.context,r={context:n,event:e};if(n.element.classList.remove(t.resizingCls),n.started){let e=!1;e="horizontal"===t.direction?n.newWidth&&n.newWidth!==n.elementWidth:n.newHeight&&n.newHeight!==n.elementHeight,t.trigger(e?"resize":"cancel",r),n.async||n.finalize()}else{var i;null===(i=t.reset)||void 0===i||i.call(t)}}abortResize(e=null,t=!1){const n=this,r=n.context;r.element.classList.remove(n.resizingCls),"horizontal"===n.direction?(Mr.setTranslateX(r.element,r.elementStartX),r.element.style.width=r.elementWidth+"px"):(Mr.setTranslateY(r.element,r.elementStartY),r.element.style.height=r.elementHeight+"px"),!t&&n.trigger("cancel",{context:r,event:e}),n.isDestroyed||n.reset()}highlightHandle(){const e=this,t=e.targetSelector?e.currentElement.closest(e.targetSelector):e.currentElement;e.currentElement.classList.add("b-resize-handle"),t.classList.add("b-over-resize-handle")}unHighlightHandle(){const e=this,t=e.targetSelector?e.currentElement.closest(e.targetSelector):e.currentElement;t&&t.classList.remove("b-over-resize-handle"),e.currentElement.classList.remove("b-resize-handle"),e.currentElement=null}overAnyHandle(e,t){return this.overStartHandle(e,t)||this.overEndHandle(e,t)}overStartHandle(e,t){return"horizontal"===this.direction?this.overLeftHandle(e,t):this.overTopHandle(e,t)}overEndHandle(e,t){return"horizontal"===this.direction?this.overRightHandle(e,t):this.overBottomHandle(e,t)}getDynamicHandleSize(e,t){const n=e?2:1,{handleSize:r}=this;return this.dynamicHandleSize&&r*n>t-this.reservedSpace?Math.max(Math.floor((t-this.reservedSpace)/n),0):r}overLeftHandle(e,t){const n=this,{offsetWidth:r}=t;if(n.leftHandle&&n.canResize(t,e)&&(r>=n.handleVisibilityThreshold||n.dynamicHandleSize)){const i=xn.from(t);return i.width=n.getDynamicHandleSize(n.rightHandle,r),i.width>0&&i.contains(_n.getPagePoint(e))}return!1}overRightHandle(e,t){const n=this,{offsetWidth:r}=t;if(n.rightHandle&&n.canResize(t,e)&&(r>=n.handleVisibilityThreshold||n.dynamicHandleSize)){const i=xn.from(t);return i.x=i.right-n.getDynamicHandleSize(n.leftHandle,r),i.width>0&&i.contains(_n.getPagePoint(e))}return!1}overTopHandle(e,t){const n=this,{offsetHeight:r}=t;if(n.topHandle&&n.canResize(t,e)&&(r>=n.handleVisibilityThreshold||n.dynamicHandleSize)){const i=xn.from(t);return i.height=n.getDynamicHandleSize(n.bottomHandle,r),i.height>0&&i.contains(_n.getPagePoint(e))}return!1}overBottomHandle(e,t){const n=this,{offsetHeight:r}=t;if(n.bottomHandle&&n.canResize(t,e)&&(r>=n.handleVisibilityThreshold||n.dynamicHandleSize)){const i=xn.from(t);return i.y=i.bottom-n.getDynamicHandleSize(n.bottomHandle,r),i.height>0&&i.contains(_n.getPagePoint(e))}return!1}}v(zc,"configurable",{skipUpdatingElement:null}),zc._$name="ResizeHelper";const Wc=/>[ \t\r\n]+</g,Uc=/\s\s+/g;class Yc{static tpl(e,...t){let n=0,r=t.map(((t,r)=>{let i=e[r];return Array.isArray(t)?i+=t.reduce(((e,t)=>e+(("string"==typeof t?t.trim():t)+"\n")),""):(void 0===t&&(t=""),i+="string"==typeof t?t.trim():t),n++,i})).join("");return n<=e.length&&(r+=e[e.length-1]),r.replace(Wc,"><").replace(Uc," ").trim()}static docsTpl(e,...t){let n=0,r=t.map(((t,r)=>{let i=e[r];return Array.isArray(t)?i+=t.reduce(((e,t)=>e+(("string"==typeof t?t.trim():t)+"\n")),""):(void 0===t&&(t=""),i+="string"==typeof t?t.trim():t),n++,i})).join("");return n<=e.length&&(r+=e[e.length-1]),r.replace(Wc,"><").trim()}static repeat(e){return function(...t){return Yc.tpl(...t).repeat(e)}}static loop(e){}}Yc._$name="TemplateHelper";class Gc extends Ka{static get $name(){return"Toast"}static get type(){return"toast"}static get configurable(){return{testConfig:{destroyTimeout:1,timeout:100},floating:!0,timeout:2500,autoDestroy:null,destroyTimeout:200,showProgress:!0,color:null,bottomMargin:20}}compose(){const{appendTo:e,color:t,html:n,showProgress:r,style:i,timeout:s}=this;return{parent:e||this.floatRoot,class:f(f({},Mn.normalize(t,"object")),{},{"b-toast-hide":1}),html:n,style:i,children:{progressElement:r&&{style:`animation-duration:${s/1e3}s;`,class:{"b-toast-progress":1}}},listeners:{click:"hide"}}}doDestroy(){this.untoast(),super.doDestroy()}get nextBottom(){const{bottomMargin:e,element:t}=this;return parseInt(t.style.bottom,10)+t.offsetHeight+e}async show(){await super.show(...arguments);const e=this,{element:t}=e,{toasts:n}=Gc;var r,i;n.includes(e)||(t.style.bottom=(null!==(r=null===(i=n[0])||void 0===i?void 0:i.nextBottom)&&void 0!==r?r:e.bottomMargin)+"px",n.unshift(e),t.getBoundingClientRect(),t.classList.remove("b-toast-hide"),e.timeout>0&&(e.hideTimeout=e.setTimeout("hide",e.timeout)))}async hide(){const e=this;e.untoast(),e.element.classList.add("b-toast-hide"),e.autoDestroy&&!e.destroyTimer&&(e.destroyTimer=e.setTimeout("destroy",e.destroyTimeout))}untoast(){const{toasts:e}=Gc;e.includes(this)&&e.splice(e.indexOf(this),1)}static hideAll(){Gc.toasts.slice().reverse().forEach((e=>e.hide()))}static show(e){const t=Gc.new({autoDestroy:!0,rootElement:document.body},"string"==typeof e?{html:e}:e);return t.show(),t}}Gc.toasts=[],Gc.initClass(),Gc._$name="Toast";class qc{static getById(e){return Ka.getById(e)}static fromElement(e,t,n){return Ka.fromElement(e,t,n)}static createWidget(e={}){return e.isWidget?e:Ka.create(e)}static append(e,t){if(e=Array.isArray(e)&&e||[e],(t instanceof HTMLElement||"string"==typeof t)&&(t={appendTo:t}),t.insertFirst){const e="string"==typeof t.insertFirst?document.getElementById(t.insertFirst):t.insertFirst;e.firstChild?t.insertBefore=e.firstChild:t.appendTo=e}return e.map((e=>Ka.create(sn.assign({},t||{},e))))}static openPopup(e,t){return Ka.create(sn.assign({forElement:e},"string"==typeof t?{html:t}:t),"popup")}static showContextMenu(e,t){const n=this;return n.currentContextMenu&&n.currentContextMenu.destroy(),e instanceof HTMLElement?t.forElement=e:Array.isArray(e)?t.forElement={target:new kn(...e)}:e instanceof kn&&(t.forElement={target:e}),n.currentContextMenu=Ka.create(t,"menu"),n.currentContextMenu.on("destroy",(()=>{n.currentContextMenu=null})),n.currentContextMenu}static attachTooltip(e,t){return Ka.attachTooltip(e,t)}static hasTooltipAttached(e){return Ka.resolveType("tooltip").hasTooltipAttached(e)}static destroyTooltipAttached(e){return Ka.resolveType("tooltip").destroyTooltipAttached(e)}static mask(e,t="Loading"){if(e)return e instanceof HTMLElement&&(e={target:e,text:t}),Ta.mask(e,e.target)}static unmask(e,t=!0){e.mask&&(t?e.mask.close():e.mask.hide())}static toast(e){return Gc.show(e)}}qc._$name="WidgetHelper";class Kc{constructor(){this.random100=[46,2,36,46,54,59,18,20,71,55,88,98,13,61,61,40,2,15,3,32,51,45,64,25,81,85,54,13,57,49,64,22,81,94,0,62,17,7,11,2,33,99,85,26,83,83,96,26,20,89,91,38,26,13,11,79,32,30,5,51,70,7,5,56,58,77,37,89,40,80,78,59,26,36,8,51,60,23,86,5,11,96,64,94,87,64,4,78,17,85,35,0,90,86,23,55,53,9,35,59,29,2,64,42,8,49,43,73,6,53,38,9,39,31,32,40,49,13,78,68,20,99,24,78,35,91,73,46,67,76,89,69,30,69,25,3,4,55,1,65,66,76,83,19,67,1,95,24,54,45,56,40,67,92,72,4,69,8,47,50,27,2,38,9,14,83,12,14,62,95,22,47,35,18,38,14,86,64,68,61,52,69,39,93,20,73,32,52,74,6,56,68,99,29,24,92,40,67,6,72,31,41,91,53,80,55,33,97,97,99,18,20,5,27,82,84,61,78,27,67,7,42,75,95,91,25,63,21,70,36,46,0,1,45,84,6,86,15,10,62,96,94,10,23,93,83,94,47,5,29,29,52,51,37,77,96,43,72,43,14,54,14,72,52,4,39,15,26,68,28,25,76,60,50,22,40,72,74,68,58,8,48,40,62,52,24,9,26,47,44,49,96,7,77,90,45,76,47,5,86,1,36,18,42,19,90,34,23,70,32,69,79,0,99,57,80,72,21,19,72,85,68,4,40,86,62,0,63,4,11,69,31,78,31,21,78,29,84,13,53,57,10,26,50,24,30,90,42,51,96,93,21,99,23,81,0,89,43,86,63,93,19,54,71,92,36,4,95,37,99,60,29,23,50,68,95,57,95,77,53,99,78,75,12,92,47,23,14,0,41,98,11,34,64,26,90,50,23,38,31,74,76,16,76,66,23,22,72,48,50,20,36,37,58,5,43,49,64,81,30,8,21,98,75,60,17,50,42,27,38,90,74,45,68,67,27,31,15,58,76,41,99,23,98,53,98,56,19,79,2,4,38,96,24,65,51,43,42,41,60,46,7,90,65,3,27,63,99,51,44,86,1,54,40,15,74,3,81,51,63,87,79,84,72,22,38,96,95,33,41,21,99,21,69,7,49,40,52,41,6,91,19,76,40,54,17,33,11,11,0,1,32,94,33,13,18,45,7,85,61,42,54,45,72,78,96,17,9,80,87,41,96,66,0,8,59,18,21,2,28,64,75,97,32,80,86,97,97,55,2,73,75,11,89,67,58,70,76,12,46,64,17,22,97,25,35,93,57,82,46,57,61,31,74,27,4,32,85,53,86,53,53,42,5,28,50,65,63,70,61,73,37,13,80,7,34,22,3,26,6,62,78,12,56,87,41,58,64,31,27,45,35,18,66,62,43,89,69,94,93,33,74,2,43,85,37,82,41,74,9,15,44,33,42,65,19,1,49,78,12,29,9,78,7,55,12,45,40,33,16,86,14,52,16,73,76,0,98,75,91,78,46,99,95,90,69,78,45,62,55,37,88,49,77,27,83,38,73,39,1,75,40,65,83,54,95,7,73,4,30,26,36,89,21,5,95,11,14,87,45,36,21,77,55,5,66,51,98,48,62,74,58,23,82,30,28,19,53,89,76,98,8,34,70,28,54,16,52,35,93,54,54,72,49,18,93,72,90,71,73,15,60,38,80,76,53,70,39,69,25,5,31,61,46,6,54,34,31,52,33,36,79,76,44,29,28,38,1,66,2,90,91,1,76,78,31,55,37,71,2,3,38,85,0,95,42,2,39,57,87,61,77,98,2,24,80,48,27,47,71,15,7,49,60,86,3,2,29,38,54,36,59,83,27,47,9,36,42,8,73,85,9,16,73,60,39,12,43,25,23,29,28,47,40,77,20,89,22,30,41,59,96,19,56,20,76,73,39,46,72,40,47,37,52,29,79,37,39,50,41,87,66,17,75,31,45,26,88,70,11,90,40,74,9,32,65,72,61,6,93,54,15,84,22,99,47,10,96,4,84,19,85,73,45,25,16,8,94,99,39,28,26,68,87,48,1,65,86,46,86,7,60,82,45,75,38,56,41,35,30,86,91,97,85,45,5,14,69,85,96,37,18,26,16,38,16,1,44,94,85,58,60,20,5,47,52,41,50,71,43,42,67,64,38,65,83,99,78,96,33,20,98,24,6,2,25,16,16,44,63,24,68,56,49,91,15,59,99,27,43,34,28,36,45,1,10,19,54,26,75,17,88,96,63,24,71,93,72,97,66,87,18,86],this.randomCache={},this.rndIndex=0}nextRandom(e){const{randomCache:t}=this;let n;return t[e]?n=t[e]:(n=this.random100.filter((t=>t<e)),t[e]=n),n[this.rndIndex++%n.length]}reset(){this.rndIndex=0}fromArray(e){return e[this.nextRandom(e.length)]}randomArray(e,t){const n=[],r=this.nextRandom(t+1),i={};for(let t=0,s=this.nextRandom(e.length);t<r;t++){for(;i[s];)s=this.nextRandom(e.length);i[s]=!0,n.push(e[s])}return n}}Kc._$name="RandomGenerator";const Xc=["Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.","Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.","Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.","Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.","Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui atione voluptatem sequi nesciunt.","Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem.","Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur?","Quis autem vel eum iure reprehenderit qui in ea voluptate velit esse quam nihil molestiae consequatur, vel illum qui dolorem eum fugiat quo voluptas nulla pariatur?"];class Zc{static reset(){this.rnd.reset(),this.rndTime.reset(),this.rndRating.reset()}static*generate(e,t=!1,n=1){let r,i;var s;"object"==typeof e&&(t=e.randomHeight,n=null!==(s=e.initialId)&&void 0!==s?s:1,r=e.addSkills,i=e.rowCallback,e=e.count);const{rnd:o,rndTime:a,rndRating:l,rndText:c,firstNames:d,surNames:u,teams:h,foods:g,colors:m,cities:p,skills:f}=this;for(let s=0;s<e;s++){var v;const y=o.fromArray(d),b=o.fromArray(u),C=`${y} ${String.fromCharCode(65+s%25)} ${b}`,w=o.nextRandom(60)+1,S=new Date(2019,0,w),D=new Date(2019,0,w+o.nextRandom(30)+2),E={id:n>-1?s+n:void 0,title:"Row "+s,name:C,firstName:y,surName:b,city:o.fromArray(p),team:o.fromArray(p)+" "+o.fromArray(h),age:10+o.nextRandom(80),food:o.fromArray(g),color:o.fromArray(m),score:10*o.nextRandom(100),rank:o.nextRandom(100)+1,start:S,finish:D,time:en.getTime(a.nextRandom(24),5*a.nextRandom(12)),percent:o.nextRandom(100),done:o.nextRandom(100)<50,rating:l.nextRandom(5),relatedTo:Math.min(e-1,s+n+o.nextRandom(10)),notes:Xc[c.nextRandom(7)+1]};r&&(E.skills=o.randomArray(f,7));const x=null===(v=i)||void 0===v?void 0:v(E);x&&Object.assign(E,x),t&&(E.rowHeight=5*o.nextRandom(!0===t?20:t)+20),yield E}}static generateData(e,t=!1,n=1,r=!0){let i=e;"object"!=typeof e&&(i={count:e,randomHeight:t,initialId:n,reset:r}),!1!==i.reset&&this.reset(),Zc.overrideRowCount&&(i.count=Zc.overrideRowCount);const s=[],o=this.generate(i);for(let e=0;e<i.count;e++)s.push(o.next().value);return s}static generateRow(){return Zc.generateData(1,!1,-1,!1)[0]}}Object.assign(Zc,{rnd:new Kc,rndTime:new Kc,rndRating:new Kc,rndText:new Kc,cities:["Stockholm","Barcelona","Paris","Dubai","New York","San Francisco","Washington","Moscow"],firstNames:["Mike","Linda","Don","Karen","Doug","Jenny","Daniel","Melissa","John","Jane","Theo","Lisa","Adam","Mary","Barbara","James","David"],surNames:["McGregor","Ewans","Scott","Smith","Johnson","Adams","Williams","Brown","Jones","Miller","Davis","More","Wilson","Taylor","Anderson","Thomas","Jackson"],teams:["Lions","Eagles","Tigers","Horses","Dogs","Cats","Panthers","Rats","Ducks","Cougars","Hens","Roosters"],foods:["Pancake","Burger","Fish n chips","Carbonara","Taco","Salad","Bolognese","Mac n cheese","Waffles"],colors:["Blue","Green","Red","Yellow","Pink","Purple","Orange","Teal","Black"],skills:["JavaScript","CSS","TypeScript","React","Vue","Angular","Java","PHP","Python","C#","C++","BASIC","COBOL","FORTRAN","PASCAL","SQL"]}),Zc._$name="DataGenerator";const Jc=["action","target","to","deltaX","deltaY","x","y","text"];class Qc extends(tt(Zr())){static get defaultConfig(){return{repeat:!0,outerElement:document.body,callOnFunctions:!0}}construct(e){super.construct(e);const t=this;t.widget&&(t.outerElement=t.widget.element,t.widget.playingDemo=!0),_n.playingDemo=!0,Object.assign(t,{prevTarget:null,currentStep:0,mouse:Mr.createElement({parent:t.outerElement,tag:"div",className:"simulated-mouse"}),timeoutId:null,innerIntervalId:null,mouseOutElements:[]}),t.intervalId=t.setInterval(t.nextStep.bind(t),1e3),t.outerElement.classList.add("b-playing-demo"),t.outerElement.addEventListener("click",(e=>{e.isTrusted&&t.abort()}))}doDestroy(){this.abort()}abort(e=!1){const t=this;t.mouse.style.top="-100px",t.clearInterval(t.intervalId),t.timeoutId&&t.clearTimeout(t.timeoutId),t.innerIntervalId&&t.clearInterval(t.innerIntervalId),t.outerElement.classList.remove("b-playing-demo"),t.widget&&(t.widget.playingDemo=!1),_n.playingDemo=!1,t.trigger(e?"done":"abort")}triggerEvent(e,t,n){if(!e)return null;let r;if(t.startsWith("mouse")){const e=this.mouse.getBoundingClientRect();r=new MouseEvent(t,Object.assign({view:globalThis,bubbles:!0,cancelable:!0,clientX:e.left,clientY:e.top},n||{}))}else r=document.createEvent("Event"),r.initEvent(t,!0,!1);return e.dispatchEvent(r),r}handleMouseMove(e,t){const n=this,r=n.mouse;r.classList.add("quick"),n.mouseDown&&r.classList.add("drag");const i=xn.from(r,n.outerElement),s=i.x,o=i.y;let a=0,l=0;if(e.to)if("string"==typeof e.to){const t=n.outerElement.querySelector(e.to);if(t){const e=xn.from(t,n.outerElement),r=e.x+e.width/2,i=e.y+e.height/2;a=(r-s)/10,l=(i-o)/10}}else e.to.x?a=(e.to.x-s)/10:(a=e.to[0]/10,l=e.to[1]/10);else e.deltaX?a=e.deltaX/10:e.x&&(a=(e.x-s)/10);e.deltaY&&(l=e.deltaY/10);let c=0;n.innerIntervalId=n.setInterval((()=>{if(n.shouldPause)return;9==c++&&(clearInterval(n.innerIntervalId),e.then&&e.then());const t=s+a*c,i=o+l*c;r.style.left=t+"px",r.style.top=i+"px";const d=r.getBoundingClientRect(),u=d.left,h=d.top,g=Mr.elementFromPoint(u,h);g!==n.prevTarget&&(n.prevTarget&&(n.mouseOutElements.push(n.prevTarget),Mr.isDescendant(n.mouseOutElements[0],g)||(n.mouseOutElements.forEach((e=>n.triggerEvent(e,"mouseout"))),n.mouseOutElements.length=0)),n.prevTarget=g,n.triggerEvent(g,"mouseover")),n.triggerEvent(g,e.action,{clientX:u,clientY:h})}),50)}getTarget(e){const t=e.target;return t?"function"==typeof t?t(e):document.querySelector(t):this.prevTarget||this.outerElement}normalizeStep(e){if(e.action)return"function"==typeof e.action?e.action(e):e;if("function"==typeof e)return e(),e;for(const t in e)Object.hasOwnProperty.call(e,t)&&!Jc.includes(t)&&(e.action=t.toLowerCase(),e.to=e[t]);return e.target||"string"!=typeof e.to&&"function"!=typeof e.to||(e.target=e.to),e}get isScrolling(){const e=this,t=e.outerElement.getBoundingClientRect(),n=e.lastTop&&t.top!==e.lastTop;return e.lastTop=t.top,n}get isInView(){const e=this.outerElement.getBoundingClientRect();return e.top<globalThis.innerHeight&&e.bottom>0}get shouldPause(){return!this.isInView||this.isScrolling||document.hidden||!document.hasFocus()}nextStep(){const e=this;if(e.shouldPause)return;if(e.currentStep===e.steps.length){if(!e.repeat)return e.abort(!0);e.currentStep=0}0===e.currentStep&&e.trigger("initialize");const t=e.mouse,n=e.normalizeStep(e.steps[e.currentStep++]),r=e.getTarget(n),i=n.action;if(r&&i)if(t.className="simulated-mouse","mousemove"===i)e.handleMouseMove(n,r);else{if(r!==e.prevTarget){const n=xn.from(r,e.outerElement);t.style.left=n.x+n.width/2+"px",t.style.top=n.y+n.height/2+"px"}"mousedown"===i&&(e.mouseDown=!0),"mouseup"===i&&(e.mouseDown=!1),e.timeoutId=e.setTimeout((()=>{if(e.prevTarget=r,t.classList.add(i),"type"===i){const e=Ka.fromElement(r),t=n.text.split("|");e.value=t[1===t.length||e.value!=t[0]?0:1]}else e.triggerEvent(r,i)}),"type"===i?100:550)}}}Qc._$name="DemoBot";const ed=Object.prototype.hasOwnProperty;let td=null;class nd{constructor(e){this.formatter=e}format(e){return this.formatter.defaultFormat(e)}parse(e,t){return this.formatter.defaultParse(e,t)}resolvedOptions(){return null}}class rd{static get(e){if(null==e)return this.NULL;if(e instanceof this)return e;const t="string"==typeof e?e:JSON.stringify(e),n=this.cache;let r=n.get(t);return r||(td=t,r=new this(e),n.set(t,r)),r}static get cache(){return ed.call(this,"_cache")&&this._cache||(this._cache=new Map)}static get NULL(){return ed.call(this,"_null")?this._null:this._null=new this(null)}constructor(e){const t=this;if(t.cacheKey=td,td=null,t.initialize(),null===e)t.formatter=new nd(t);else{t.configure(e);for(const[e,n]of Object.entries(t.resolvedOptions()))null!=n&&e in t.defaults&&(t[e]=n)}}get parser(){return function(e,t){return Object.defineProperty(e,"parser",{value:t}),t}(this,new this.constructor.Parser(this))}defaultFormat(e){return null==e?e:String(e)}defaultParse(e){return e}format(e){return null==e?e:this.formatter.format(e)}parse(e,t){return null==e?e:this.parser.parse(e,t)}parseStrict(e){return this.parse(e,!0)}resolvedOptions(){return this.formatter.resolvedOptions()}}rd._$name="Formatter";class id extends(Te.mixin(tt,Ci)){static get $name(){return"Navigator"}static get type(){return"navigator"}static get configurable(){return{ownerCmp:null,itemsTabbable:null,target:null,keyEventTarget:null,processEvent:null,itemSelector:null,activeItem:null,focusCls:"b-active",keys:null,allowCtrlKey:null,allowShiftKey:null,scrollDuration:50,disabled:null,datasetIdProperty:"id",testConfig:{scrollDuration:1}}}static get factoryable(){return{defaultType:"navigator"}}get activeItem(){const{_activeItem:e}=this;if(this.target.contains(e))return e;this._activeItem=null}updateOwnerCmp(e){this.itemSelector||(this.itemSelector=`.${this.ownerCmp.itemCls}`),Mr.setAttributes(this.keyEventTarget,{"aria-activedescendant":`${this.owner.id}-active-descendant`})}set navigationEvent(e){const{owner:t}=this;this._navigationEvent=t.navigationEvent=e,e&&Promise.resolve(1).then((()=>this.navigationEvent=null))}get navigationEvent(){return this._navigationEvent}static getComposedKeyName(e){const t=(e.key||"").trim()||e.code;return`${e.ctrlKey?"CTRL+":""}${e.shiftKey?"SHIFT+":""}${e.altKey?"ALT+":""}${t}`}onKeyDown(e){const t=this,{ownerCmp:n,itemSelector:r,activeItem:i,itemsTabbable:s}=t,{target:o}=e,a=t.target.querySelector(r),l=(e.key||"").trim()||e.code,c=t.constructor.getComposedKeyName(e),d=o.matches(r)||o===t.keyEventTarget;if(!t.disabled&&t.processEvent&&(e=t.processEvent.call(n,e)),e&&!t.disabled&&a&&t.target.offsetParent&&d){if(!s){if(null==t.inlineFlow){const e=a.parentNode,n=Mr.getStyleValue(a,"position"),r=Mr.getStyleValue(a,"display"),i=Mr.getStyleValue(a,"float");t.inlineFlow="absolute"===n||"inline"===r||"inline-block"===r||"left"===i||"right"===i||"flex"===Mr.getStyleValue(e,"display")&&"row"===Mr.getStyleValue(e,"flex-direction")}t.prevKey||(t.inlineFlow?(t.prevKey="ArrowLeft",t.nextKey="ArrowRight"):(t.prevKey="ArrowUp",t.nextKey="ArrowDown"))}if(t.navigationEvent=e,i)switch(l){case t.prevKey:if(t.disabled||e.ctrlKey&&!t.allowCtrlKey)return;if(e.shiftKey&&!t.allowShiftKey)return;e.preventDefault(),e.handled=!0,t.navigatePrevious(e);break;case t.nextKey:if(t.disabled||e.ctrlKey&&!t.allowCtrlKey)return;if(e.shiftKey&&!t.allowShiftKey)return;e.preventDefault(),e.handled=!0,t.navigateNext(e);break;default:{var u;const r=null===(u=t.keys)||void 0===u?void 0:u[c];if(r&&!t.disabled){if(!1===t.callback(r,t.thisObj||n,[e]))return}else n.onInternalKeyDown&&n.onInternalKeyDown(e);if(Mr.getActiveElement(o)!==o&&e.preventDefault(),s)return}}else{if(s)return;l!==t.nextKey&&l!==t.prevKey||(t.activeItem=t.getDefaultNavigationItem(e))}t.activeItem!==i&&t.triggerNavigate(e)}}getDefaultNavigationItem(e){const{target:t,itemSelector:n,prevKey:r,nextKey:i}=this;return 4&t.compareDocumentPosition(e.target)&&e.key===r?t.querySelector(`${n}:last-of-type`):2&t.compareDocumentPosition(e.target)&&e.key===i?t.querySelector(`${n}`):void 0}navigatePrevious(e){const t=this,n=t.previous;e.preventDefault(),n&&t.ownerCmp.scrollable.scrollIntoView(n,{animate:t.scrollDuration}).then((()=>{t.activeItem=n,t.triggerNavigate(e)}))}navigateNext(e){const t=this,n=t.next;e.preventDefault(),n&&t.ownerCmp.scrollable.scrollIntoView(n,{animate:t.scrollDuration}).then((()=>{t.activeItem=n,t.triggerNavigate(e)}))}get owner(){return this.ownerCmp}get previous(){return this.getAdjacent(-1)}get next(){return this.getAdjacent(1)}getAdjacent(e=1,t=this.activeItem){const n=this.treeWalker;if(n.currentNode=t,n[e<0?"previousNode":"nextNode"](),n.currentNode!==this.activeItem)return n.currentNode}onTargetFocusIn(e){const t=this,{target:n,relatedTarget:r}=e,{owner:i,itemsTabbable:s,skipScrollIntoView:o,previousActiveItem:a}=t;if(!n.matches(".b-focus-trap"))if(n.matches(t.itemSelector))t.skipScrollIntoView=!0,t.activeItem=n,t.skipScrollIntoView=o,t.activeItem&&s&&t.triggerNavigate(e);else if(n===t.target){var l;(r?n.compareDocumentPosition(r):0)&Node.DOCUMENT_POSITION_CONTAINED_BY?null===(l=i.previousSibling)||void 0===l||l.focus():t.activeItem=a&&t.target.contains(a)?a:0}}onTargetFocusOut(e){const t=this,{relatedTarget:n}=e;null!=n&&n.matches(".b-focus-trap")||n&&t.target.contains(n)&&n.matches(t.itemSelector)||t.activeItem&&(t.activeItem=null,t.itemsTabbable&&t.triggerNavigate(e))}onTargetMouseDown(e){const t=this,n=e.target.closest(t.itemSelector);t.navigationEvent=e,t.itemsTabbable?n===t.activeItem&&t.triggerNavigate(e):!1===t.ownerCmp.itemsFocusable?t.onFocusGesture(e):n&&(e.preventDefault(),Mr.focusWithoutScrolling(n))}onTargetClick(e){var t;const n=this,{skipScrollIntoView:r}=n;n.skipNextClick||null!==(t=n.navigationEvent)&&void 0!==t&&t.ignoreNavigation?n.skipNextClick=!1:n.disabled||(n.skipScrollIntoView=!0,n.processEvent&&(e=n.processEvent.call(n.ownerCmp,e)),e&&(n.activeItem=e.target.closest(n.itemSelector),n.triggerNavigate(e)),n.skipScrollIntoView=r)}onFocusGesture(e){(e.target===this.ownerCmp.contentElement||e.target.closest(this.itemSelector)&&!1===this.ownerCmp.itemsFocusable)&&e.preventDefault()}acceptNode(e){return e.offsetParent&&e.matches&&e.matches(this.itemSelector)?Mr.NodeFilter.FILTER_ACCEPT:Mr.NodeFilter.FILTER_SKIP}changeActiveItem(e){return null!=e&&this.ownerCmp.getItem&&(e=this.ownerCmp.getItem(e)),e}updateActiveItem(e,t){const n=this,{ownerCmp:r}=n,i=t&&n.target.contains(t),s=e&&Mr.isFocusable(e)&&e!==Mr.getActiveElement(e);if(i&&(n.previousActiveItem=t),t&&(t.classList.remove(n.focusCls),t.removeAttribute("id")),null!=e){var o;if(n.skipScrollIntoView?s&&Mr.focusWithoutScrolling(e):null===(o=r.scrollable)||void 0===o||o.scrollIntoView(e,{block:"nearest",focus:s,silent:n.scrollSilently}),e===t&&i)return;e.classList.add(n.focusCls),e.id=`${n.owner.id}-active-descendant`,n._activeItem=e}else n._activeItem=null,t===Mr.getActiveElement(t)&&r.revertFocus()}updateTarget(e,t){const n=this,r={element:e,thisObj:n,focusin:"onTargetFocusIn",focusout:"onTargetFocusOut",mousedown:{handler:"onTargetMouseDown",delegate:n.itemSelector}};n.itemsTabbable||n.itemsFocusable||(r.click="onTargetClick"),Object.prototype.hasOwnProperty.call(n,"acceptNode")||(n.acceptNode=n.acceptNode.bind(n),n.acceptNode.acceptNode=n.acceptNode),_n.on(r),n.treeWalker=n.setupTreeWalker(e,Mr.NodeFilter.SHOW_ELEMENT,n.acceptNode),n.keyEventTarget||(n.keyEventTarget=e),(n.targetMutationMonitor=new MutationObserver(n.onTargetChildListChange.bind(n))).observe(e,{childList:!0,subtree:!0})}setupTreeWalker(e,t,n){return document.createTreeWalker(e,t,n)}onTargetChildListChange(){const e=this,{activeItem:t,datasetIdProperty:n}=e;var r;t&&(e.target.contains(t)?t.classList.contains(e.focusCls)||t.classList.add(e.focusCls):e.activeItem=e.target.querySelector(`${e.itemSelector}.${e.focusCls}[data-${_.hyphenate(n)}="${t.dataset[n]}"]`)||(null===(r=e.target.querySelector(`${e.itemSelector}.${e.focusCls}`))||void 0===r?void 0:r[t.dataset.index])||null)}changeKeyEventTarget(e){this._keyEventTarget=e,_n.on({element:e,keydown:"onKeyDown",thisObj:this})}triggerNavigate(e,t=this.activeItem){var n;const r={event:e,item:t,oldItem:this.previousActiveItem};this.trigger("navigate",r),null===(n=this.ownerCmp)||void 0===n||n.trigger("navigate",r)}}id._$name="Navigator";const sd=_.escapeRegExp,od=/[\d+-]/g,ad=(e,t)=>new Intl.NumberFormat(e||void 0,t),ld=/^(?:([$])\s*)?(?:(\d+)>)?\d+(,\d+)?(?:\.((\d*)(?:#*)|[*]))?(?:\s*([%])?)?$/;class cd extends rd{static get $name(){return"NumberFormat"}initialize(){this._as={},this.is={decimal:!1,currency:!1,percent:!1,null:!0,from:null}}get truncator(){const e=this.maximumFractionDigits;return null==e?null:this.as({style:"decimal",maximumFractionDigits:Math.min(20,e+1)},"truncator")}configure(e){const t=this;"string"!=typeof e?Object.assign(t,e):t.template=e;const n={},r=t.locale?lt.locales[t.locale]:lt.locale,i=r&&r.NumberFormat,s=t.template;if(i)for(const e in i)null==t[e]&&"function"!=typeof i[e]&&(t[e]=i[e]);if(s){const e=ld.exec(s),n=e[2],r=e[4];t.useGrouping=!!e[3],t.style=e[1]?"currency":e[6]?"percent":"decimal",n&&(t.integer=+n),"*"===r?t.fraction=[0,20]:null!=r&&(t.fraction=[e[5].length,r.length])}t._minMax("fraction",!0,!0),t._minMax("integer",!0,!1),t._minMax("significant",!1,!0);for(const e in t.defaults)null!=t[e]&&(n[e]=t[e]);t.is.from=t.from&&t.from.is,t.is[t.style]=!(t.is.null=!1),t.formatter=ad(t.locale,n)}as(e,t=null){const n=this.resolvedOptions()||{template:"9.*"},r=this._as;let i=t&&r[t];return i||("string"==typeof e?n.style=e:Object.assign(n,e),n.from=this,i=new cd(n)),t&&(r[t]=i),i}defaultParse(e,t){return null==e?e:t?Number(e):parseFloat(e)}format(e){if("string"==typeof e){const t=Number(e);e=isNaN(t)?this.parse(e):t}return super.format(e)}round(e){return this.parse(this.format(e))}truncate(e){const t=this,n=t.maximumFractionDigits,{truncator:r}=t;let i,s=t.parse(e);return r&&(s=r.format(s),i=s.indexOf(r.parser.decimal),i>-1&&s.length-i-1>n&&(s=s.substr(0,i+n+1)),s=r.parse(s)),s}resolvedOptions(){const e=super.resolvedOptions();for(const t in e)void 0===e[t]&&(e[t]=this[t]);return e}_minMax(e,t,n){const r=this,i=r[e];if(null!=i){const s=_.capitalize(e),o=`maximum${s}Digits`,a=`minimum${s}Digits`;"number"==typeof i?(t&&(r[a]=i),n&&(r[o]=i)):(r[a]=i[0],r[o]=i[1])}}}cd.Parser=class{constructor(e){const t=this,n=e.locale,r=ad(n,{maximumFractionDigits:3}),i=e.is.currency?t._decodeStyle(n,{style:"currency",currency:e.currency,currencyDisplay:e.currencyDisplay}):null,s=e.is.percent?t._decodeStyle(n,{style:"percent"}):null,o=r.format(1.2).replace(od,"")[0],a=r.format(1e9).replace(od,"")[0]||"";Object.assign(t,{currency:i,decimal:o,formatter:e,grouper:a,percent:s}),t.decimal=o,t.decimalRe=sd(o,"g"),t.grouper=a,t.stripRe=new RegExp(`(?:\\s+|${sd(a)})`+(i?`|(?:${sd(i.text)})`:"")+(s?`|(?:${sd(s.text)})`:""),"g")}decimalPlaces(e){const t=(e=e.replace(this.stripRe,"")).indexOf(this.decimal)+1;return t&&e.length-t}parse(e,t){return"string"==typeof e&&(e=e.replace(this.stripRe,"").replace(this.decimalRe,".").replace("−","-"),e=t?Number(e):parseFloat(e),this.formatter.is.percent&&(e/=100)),e}_decodeStyle(e,t){const n=ad(e,t),r=ad(e,Object.assign(n.resolvedOptions(),{style:"decimal"})),i=n.format(0),s=r.format(0);return{suffix:i.startsWith(s),text:i.replace(s,"").trim()}}},Object.assign(cd.prototype,{defaults:{style:"decimal",currency:null,currencyDisplay:"symbol",locale:null,maximumFractionDigits:null,minimumFractionDigits:null,minimumIntegerDigits:null,maximumSignificantDigits:null,minimumSignificantDigits:null,useGrouping:!0},fraction:null,from:null,integer:null,significant:null,template:null}),Object.assign(cd.prototype,cd.prototype.defaults),rd.number=(e,t)=>cd.format(e,t),cd._$name="NumberFormat";class dd extends(tt(Te)){construct(e={}){const t=this;super.construct(e),t.onWsOpen=t.onWsOpen.bind(t),t.onWsClose=t.onWsClose.bind(t),t.onWsMessage=t.onWsMessage.bind(t),t.onWsError=t.onWsError.bind(t),t.autoConnect&&t.address&&t.open()}doDestroy(){const e=this;e.connector&&(e.detachSocketListeners(e.connector),e.connector.close(),e.connector=null),super.doDestroy()}get isConnecting(){var e;return(null===(e=this.connector)||void 0===e?void 0:e.readyState)===this.constructor.webSocketImplementation.CONNECTING}get isOpened(){var e;return(null===(e=this.connector)||void 0===e?void 0:e.readyState)===this.constructor.webSocketImplementation.OPEN}get isClosing(){var e;return(null===(e=this.connector)||void 0===e?void 0:e.readyState)===this.constructor.webSocketImplementation.CLOSING}get isClosed(){var e;return(null===(e=this.connector)||void 0===e?void 0:e.readyState)===this.constructor.webSocketImplementation.CLOSED}createWebSocketConnector(){const e=this.connector=new this.constructor.webSocketImplementation(this.address);this.attachSocketListeners(e)}destroyWebSocketConnector(){this.detachSocketListeners(this.connector),this.connector.close(),this.connector=null}attachSocketListeners(e){const t=this;e.addEventListener("open",t.onWsOpen),e.addEventListener("close",t.onWsClose),e.addEventListener("message",t.onWsMessage),e.addEventListener("error",t.onWsError)}detachSocketListeners(e){const t=this;e.removeEventListener("open",t.onWsOpen),e.removeEventListener("close",t.onWsClose),e.removeEventListener("message",t.onWsMessage),e.removeEventListener("error",t.onWsError)}async open(){const e=this;if(e._openPromise)return e._openPromise;if(!e.address)return void console.warn("Server me.address cannot be empty");if(e.isOpened)return!0;let t;return e.createWebSocketConnector(),e._openPromise=new Promise((n=>{t=e.on({open(){n(!0)},error(){n(!1)}})})).then((n=>(t(),e._openPromise=null,n||e.destroyWebSocketConnector(),n))).catch((()=>{e._openPromise=null,e.destroyWebSocketConnector()})),e._openPromise}close(){this.connector&&(this.destroyWebSocketConnector(),this.trigger("close"))}send(e,t={}){var n;null===(n=this.connector)||void 0===n||n.send(JSON.stringify(f({command:e},t)))}onWsOpen(e){this.trigger("open",{event:e})}onWsClose(e){this.trigger("close",{event:e})}onWsMessage(e){try{const t=JSON.parse(e.data);this.trigger("message",{data:t})}catch(e){this.trigger("error",{error:e})}}onWsError(e){this.trigger("error",{error:e})}}v(dd,"webSocketImplementation","undefined"==typeof WebSocket?null:WebSocket),v(dd,"configurable",{address:"",userName:"User",autoConnect:!0}),dd._$name="WebSocketManager";var ud=e=>class extends(e||Te){static get $name(){return"Finalizable"}construct(...e){super.construct(...e),this.finalizer=null,this.finalizing=null,this.isFinalized=!1,this.isFinalizing=!1}doFinalize(){this.destroy()}finalize(){const e=this;let t=e.finalizing;return t||e.isFinalized||(e.isFinalizing=!0,e.finalizing=t=e._awaitFinalizer()),t}async _awaitFinalizer(){const e=this;try{await e.finalizer}finally{e.finalizing=null,e.isFinalized=!0,e.doFinalize()}}};const hd=Symbol("dragAbort"),gd=Symbol("dragInit"),md=Symbol("dragDrag"),pd=Symbol("dragDrop"),fd={x:"horizontal",y:"vertical"};class vd extends(Te.mixin(ud,Zr,ci)){static get configurable(){return{itemElement:null,scrollManager:null,monitoringConfig:null,source:null,target:null,targetElement:null,threshold:5,touchStartDelay:300}}static get identifiable(){return{}}construct(...e){super.construct(...e);const t=this,{event:n}=t;Object.assign(t,{altKey:null,cleaners:[],ctrlKey:null,data:new Map,element:n.target,endEvent:null,lastMoveEvent:null,metaKey:null,previousTarget:null,scrollerAction:null,shiftKey:null,state:gd,startEvent:n,touchStartTimer:null,_valid:!0}),"touches"in n&&t.touchStartDelay&&(t.touchStartTimer=t.setTimeout((()=>t.touchStartTimer=null),t.touchStartDelay,"touchStartDelay")),_n.on({element:globalThis,blur:"onWindowBlur",thisObj:t})}doDestroy(){const e=this,{source:t,target:n}=e;e.cleanup(),(null==n?void 0:n.dropping)===e&&(n.dropping=null),(null==t?void 0:t.dragging)===e&&(t.dragging=null),super.doDestroy()}onWindowBlur(){this.started&&this.abort()}get aborted(){return this.state===hd}get completed(){return this.isDestroying||this.aborted||null!==this.endEvent}get pending(){return this.state===gd}get started(){return this.state!==gd&&!this.aborted}get valid(){return this.started&&null!=this.targetElement&&this._valid}set valid(e){this._valid=e}async get(e){if(this.aborted)throw new Error("Data is not available on aborted drag");if(!this.completed)throw new Error("Data is not available until drag completion");if(Array.isArray(e))return Promise.all(e.map((e=>this.get(e))));let t=this.data.get(e);return"function"==typeof t&&(t=await t(),this.data.set(e,t)),t}has(e){return this.data.has(e)}peek(e){if(this.aborted)throw new Error("Data is not available on aborted drag");if(Array.isArray(e))return e.map((e=>this.peek(e)));let t=this.data.get(e);return"function"==typeof t&&(t=!0),t}set(e,t){this.data.set(e,t)}changeTarget(e,t){if(e!==t){const n=this;n._target=e,n.previousTarget=t,t&&(t.dropping=null),e&&(e.dropping=n,e.dropping!==n&&(e=null,n.valid=!1)),n._target=t}return e}updateTarget(e,t){const n=this;t&&n.source.dragLeaveTarget(n,t),e&&(n.valid=!0,e.dragMove(n),n.source.dragEnterTarget(n))}updateTargetElement(e){let t,n,r,i,s;for(s=e;s;s=s.parentElement)if(n=Ps.get(s,"droppables"),n)for(i=0;i<n.length;++i)if(t=n[i],t.dropRootElement.contains(e)&&(r=t.droppableSelector,(!r||e.closest(`#${Mr.getId(t.dropRootElement)} ${r}`))&&(this.target=t,this.target===t)))return}abort(){const e=this,{element:t,source:n}=e;null==t||t.getBoundingClientRect(),e.state!==pd&&(e.state=hd,e.cleanup()),null==n||n.endDrag(e)}begin(){const e=this,{source:t}=e,n=t.beforeDrag(e);return!1!==n&&(t.dragging=e),n}cleanup(){let e;for(;e=this.cleaners.pop();)e()}end(e){const t=this,{lastMoveEvent:n,target:r}=t,{dragSwallowClickTime:i}=t.source;t.event=t.endEvent=e,t.syncFlags(),t.started&&((null==n?void 0:n.clientX)===e.clientX&&(null==n?void 0:n.clientY)===e.clientY&&(null==n?void 0:n.target)===e.target||t.track(),i&&_n.on({element:document,capture:!0,expires:i,once:!0,click(e){e.stopPropagation()}}),t.state=pd,r!==t.source&&(null==r||r.dragDrop(t)))}fakeKey(e,t){const n=this,{lastMoveEvent:r}=n;if(r&&n.element){let i;r.isKey=!0,"Alt"===e.key?n.altKey!==t&&(n.altKey=t,i=!0):"Control"===e.key&&n.ctrlKey!==t&&(n.ctrlKey=t,i=!0),i&&(n.event=r,n.track())}}keyDown(e){this.completed||("Escape"===e.key?this.abort():this.isDragToggleKey(e.key)&&this.fakeKey(e,!0))}keyUp(e){!this.completed&&this.isDragToggleKey(e.key)&&this.fakeKey(e,!1)}getDistance(e){return _n.getDistanceBetween(this.startEvent,e)}isDragToggleKey(e){return"Control"===e||"Alt"===e}move(e){const t=this,{target:n}=e,r=t.getDistance(e)>=t.threshold;if(t.syncFlags(),t.touchStartTimer)r&&t.abort();else if(n&&n.nodeType===Node.ELEMENT_NODE){if(r&&!t.started&&(t.event=e,!1===t.start()))return void t.abort();t.started&&!t.completed&&(t.lastMoveEvent=t.event=e,"touchmove"===e.type&&(e.preventDefault(),e.stopImmediatePropagation()),t.track())}}start(){const e=this,{scrollManager:t,monitoringConfig:n,source:r}=e,{draggingBodyCls:i,dragLock:s}=r,o=r.dragRootElement;if(e.state=md,t){const r=t.startMonitoring(Y.merge({scrollables:[{element:o}],direction:fd[s]||s||"both",callback(t){const{lastMoveEvent:n}=e;n&&e.element&&(n.isScroll=!0,e.event=n,e.scrollerAction=t,e.track(),e.scrollerAction=null)}},n));e.cleaners.push(r)}const a=r.dragRootElement.closest(".b-outer")||document.body;if(a.classList.add(i),e.cleaners.push((()=>a.classList.remove(i))),!1===r.startDrag(e))return e.cleanup(),!1}syncFlags(){const e=this,{event:t}=e;e.altKey=t.altKey,e.ctrlKey=t.ctrlKey||t.metaKey,e.metaKey=t.metaKey,e.shiftKey=t.shiftKey}track(){const e=this,{event:t,source:n,target:r}=e;let i,s=t.target;"touchmove"===t.type&&(i=t.changedTouches[0],s=Mr.elementFromPoint(i.clientX,i.clientY)),e.targetElement=s,r===e.target&&(null==r||r.dragMove(e)),n.trackDrag(e)}}v(vd,"$name","DragContext"),vd.prototype.STATE=vd.STATE=Object.freeze({ABORTED:hd,INIT:gd,DRAGGING:md,DROPPED:pd}),vd._$name="DragContext";class yd extends(Te.mixin(Ci)){static get type(){return"default"}static get configurable(){return{dragging:null}}static get factoryable(){return{defaultType:yd}}updateDragging(e,t){t&&this.close(t),e&&this.open(e)}close(e){}open(e){}dragStart(e){this.dragging=e}dragMove(e){}dragEnd(e){this.dragging=null}}yd.initClass(),yd._$name="DragProxy";var bd=e=>class extends(e||Te){static get $name(){return"Draggable"}static get configurable(){return{dragging:{$config:"nullify",value:null},draggingClsSelector:null,dragDocumentListeners:{element:document,keydown:"onDragKeyDown",keyup:"onDragKeyUp",contextmenu:"onDragContextMenu",mousemove:"onDragPointerMove",mouseup:"onDragPointerUp",pointerup:"onDragPointerUp",touchend:"onDragPointerUp",touchmove:{handler:"onDragPointerMove",passive:!1}},dragItemSelector:null,dragItemOverCls:null,dragLock:null,dragMinDistance:1,dragProxy:{$config:["lazy","nullify"],value:null},dragRootElement:{$config:"nullify",value:null},dragSameTargetDrop:!1,dragSelector:null,ignoreSelector:null,dragSwallowClickTime:50,dragThreshold:5,dragTouchStartDelay:300,dropTargetSelector:null,overItem:null,testConfig:{dragSwallowClickTime:50}}}static get properties(){return{draggingCls:"b-draggable-active",draggingBodyCls:"b-draghelper-active",draggingItemCls:"b-dragging-item",draggingStartedCls:"b-draggable-started",draggableCls:"b-draggable"}}beforeDrag(e){const{dragRootElement:t,dragSelector:n,ignoreSelector:r}=this,i=n&&e.element.closest(n);return!n||Boolean(i&&i===t||t.contains(i)&&(!r||!e.element.matches(r)))}dragStart(e){}dragOver(e){}dragEnterTarget(e){}dragLeaveTarget(e,t){}dragDrop(e){}dragEnd(e){}get activeDrag(){const{dragging:e}=this;return null!=e&&e.started&&!e.completed?e:null}get dragEventer(){return this.trigger?this:null}get draggingClassElement(){const{draggingClsSelector:e,dragRootElement:t}=this;return e?null==t?void 0:t.closest(e):t}beginDrag(e){const{draggingCls:t,draggingClassElement:n}=this;t&&n&&(n.classList.add(t),e.cleaners.push((()=>n.classList.remove(t))))}async endDrag(e){const t=this,{dragEventer:n,dragProxy:r}=t;e.valid&&await t.dragDrop(e),t.isDestroyed||(e.pending?e.destroy():(t.dragEnd(e),null==r||r.dragEnd(e),null==n||n.trigger(e.valid?"drop":"dragCancel",{drag:e,event:e.event}),t.finalizeDrag(e)))}async finalizeDrag(e){await e.finalize()}moveDrag(e){if(!1!==this.dragOver(e)){const{dragEventer:t,dragProxy:n}=this;null==n||n.dragMove(e),null==t||t.trigger("drag",{drag:e,event:e.event})}}setupDragContext(e){const t=this,{dragItemSelector:n,id:r}=t,{target:i}=e;return{event:e,id:r?`${r}-drag-${t._nextDragId=(t._nextDragId||0)+1}`:null,itemElement:n?i.closest(n):i,touchStartDelay:t.dragTouchStartDelay,source:t,threshold:t.dragThreshold}}startDrag(e){const{draggingStartedCls:t,draggingClassElement:n,draggingItemCls:r,dragEventer:i,dragProxy:s}=this,{itemElement:o}=e;if(!1===(null==i?void 0:i.trigger("beforeDragStart",{drag:e,event:e.event})))return!1;t&&n&&(n.classList.add(t),e.cleaners.push((()=>n.classList.remove(t)))),r&&o&&(o.classList.add(r),e.cleaners.push((()=>o.classList.remove(r)))),null==s||s.dragStart(e);const a=this.dragStart(e);return!1!==a&&(null==i||i.trigger("dragStart",{drag:e,event:e.event})),a}trackDrag(e){var t;const{dropTargetSelector:n}=this;e.valid=!(n&&(null===(t=e.targetElement)||void 0===t||!t.closest(n))),this.moveDrag(e)}configureListeners(e){const t=sn.assign({thisObj:this},this.dragDocumentListeners);return"touches"in e.startEvent?(delete t.mousemove,delete t.mouseup):(delete t.contextmenu,delete t.touchmove,delete t.touchend,delete t.pointerup),t}updateDragging(e,t){const n=this;if(e){const t=n.configureListeners(e);e.cleaners.push(_n.on(t)),n.beginDrag(e)}else t&&t.destroy()}changeDragProxy(e,t){return yd.reconfigure(t,e,{owner:this,defaults:{owner:this}})}updateDragRootElement(e,t){var n;const r=this,{draggableCls:i,dragItemSelector:s,onDragItemMouseMove:o}=r;if(null==t||t.classList.remove(i),null===(n=r._dragRootDetacher)||void 0===n||n.call(r),e){const t={thisObj:r,element:e,mousedown:"onDragMouseDown",touchstart:"onDragTouchStart",pointerdown:e=>{var t,n;return e.pointerId&&(null===(t=(n=e.target).releasePointerCapture)||void 0===t?void 0:t.call(n,e.pointerId))}};o&&(t.mousemove={delegate:s,handler:"onDragItemMouseMove"}),(r.dragItemOverCls||o||r.onDragItemMouseEnter||r.onDragItemMouseLeave)&&Object.assign(t,{mouseover:{delegate:s,handler:"onDragItemMouseOver"},mouseout:{delegate:s,handler:"onDragItemMouseOut"}}),e.classList.add(i),r._dragRootDetacher=_n.on(t)}}onDragItemMouseOver(e){this.overItem=e}onDragItemMouseOut(e){this.dragging||(this.overItem=e)}changeOverItem(e){var t;return this.enterLeaveEvent=e,"mouseout"===e.type?(null===(t=e.relatedTarget)||void 0===t?void 0:t.closest(this.dragItemSelector))||null:e.target.closest(this.dragItemSelector)}updateOverItem(e,t){const n=this,{dragItemOverCls:r}=n;var i,s;t&&(r&&t.classList.remove(r),null===(i=n.onDragItemMouseLeave)||void 0===i||i.call(n,n.enterLeaveEvent,t)),e&&(r&&e.classList.add(r),null===(s=n.onDragItemMouseEnter)||void 0===s||s.call(n,n.enterLeaveEvent,e))}onDragContextMenu(e){e.preventDefault()}onDragKeyDown(e){this.dragging.keyDown(e)}onDragKeyUp(e){this.dragging.keyUp(e)}onDragMouseDown(e){0===e.button&&this.onDragPointerDown(e)}onDragPointerDown(e){let{dragging:t}=this;t?t.isFinalizing||t.abort():(t=this.setupDragContext(e),t&&(t=new vd(t),!1===t.begin()&&t.destroy()))}changeDragging(e,t){return null==t||t.destroy(),e}onDragPointerMove(e){const{dragging:t}=this;t&&!t.completed&&(null==t||t.move(e))}onDragPointerUp(e){const{dragging:t}=this;t&&!t.completed&&(t.end(e),this.endDrag(t))}onDragTouchStart(e){1===e.touches.length&&this.onDragPointerDown(e)}},Cd=e=>class extends(e||Te){static get $name(){return"Droppable"}static get configurable(){return{droppableSelector:null,dropping:null,dropRootElement:{$config:"nullify",value:null}}}get dropEventer(){return this.trigger?this:null}get droppableCls(){return"b-droppable"}dragEnter(e){var t;return null===(t=this.dropEventer)||void 0===t?void 0:t.trigger("dragEnter",{drag:e,event:e.event})}dragMove(e){var t;return null===(t=this.dropEventer)||void 0===t?void 0:t.trigger("dragMove",{drag:e,event:e.event})}dragDrop(e){var t;return null===(t=this.dropEventer)||void 0===t?void 0:t.trigger("drop",{drag:e,event:e.event})}dragLeave(e){var t;return null===(t=this.dropEventer)||void 0===t?void 0:t.trigger("dragLeave",{drag:e,event:e.event})}changeDropping(e,t){if(e!==t){const n=this;t&&(!t.aborted&&t.completed||n.dragLeave(t)),e&&(n._dropping=e,!1===n.dragEnter(e)&&(e=null),n._dropping=t)}return e}updateDropRootElement(e,t){const n=this,{droppableCls:r}=n;let i,s,o;t&&(i=Ps.get(t,"droppables"),o=!0,Array.isArray(i)&&(s=i.indexOf(n))>-1&&(i.length<2?Ps.remove(t,"droppables"):(i.splice(s,1),i.forEach((e=>{r===e.droppableCls&&(o=!1)})))),o&&t.classList.remove(r)),e&&(i=Ps.get(e,"droppables"),i?i.push(n):Ps.set(e,"droppables",[n]),e.classList.add(r))}},wd=e=>class extends(e||Te){static get $name(){return"Featureable"}static get configurable(){return{features:null}}static get declarable(){return["featureable"]}static setupFeatureable(e){const t=f({ownerName:"client"},e.featureable);t.factory.initClass(),Reflect.defineProperty(e,"featureable",{get(){return t}})}doDestroy(){const e=this.features;super.doDestroy();for(const n in e){var t;const r=e[n];null===(t=r.destroy)||void 0===t||t.call(r)}}hasFeature(e){var t;return Boolean(null===(t=this.features)||void 0===t?void 0:t[e])}changeFeatures(e,t){if(this.isDestroying)return;const n=this,{featureable:r}=n.constructor,i=n.$features||(n.$features=new Ul({configName:"features",factory:r.factory,owner:n,ownerName:r.ownerName}));return i.update(e),t?void 0:i.target}get widgetClass(){}getCurrentConfig(e){const t=super.getCurrentConfig(e),{features:n}=t;if(n)for(const e in n)0===Object.keys(n[e]).length&&(n[e]=!0);return t}};const Sd="b-hover-edge",Dd="b-hover-top",Ed="b-hover-right",xd="b-hover-bottom",Rd="b-hover-left",Td={[Sd]:1,[Dd]:1,[Ed]:1,[xd]:1,[Rd]:1},Md={t:[Sd,Dd],r:[Sd,Ed],b:[Sd,xd],l:[Sd,Rd],tr:[Sd,Dd,Ed],bl:[Sd,xd,Rd],tl:[Sd,Dd,Rd],br:[Sd,xd,Ed]};var kd=e=>class extends(e.mixin(Zr)){static get $name(){return"Hoverable"}static get configurable(){return{hoverCls:null,hoverAnimationCls:null,hoverRootCls:null,hoverRootActiveCls:null,hoverDelay:null,hoverElement:null,hoverIgnoreElement:null,hoverEdges:null,hoverEdgeSize:10,hoverRootElement:{$config:"nullify",value:null},hoverSelector:null,hoverTarget:{$config:"nullify",value:null},hoverTrack:null,hoverZone:null}}static get delayable(){return{setHoverTarget:0}}hoverEnter(e){}hoverIgnore(e){var t;return null===(t=this.hoverIgnoreElement)||void 0===t?void 0:t.contains(e)}hoverLeave(e){}hoverMove(e){}onHoverMouseMove(e){const t=this,{hoverEdges:n,hoverEdgeSize:r,hoverTarget:i}=t;if(i){if(n){const{top:s,left:o,width:a,height:l,right:c,bottom:d}=i.getBoundingClientRect(),{clientX:u,clientY:h}=e,g=o+a/2,m=s+l/2,p=h<(r?s+r:m),f=u>=(r?c-r:g),v=h>=(r?d-r:m),y=u<(r?o+r:g),b=p||v?p?"t":"b":"",C=f||y?f?"r":"l":"";t.hoverZone=(n.includes(b)?b:"")+(n.includes(C)?C:"")}t.hoverEvent=e,t.hoverTrack&&t.hoverMove(e)}}onHoverMouseOver(e){this.hoverEvent=e,this.hoverElement=e.target}onHoverMouseOut(e){this.hoverEvent=e,this.hoverElement=e.relatedTarget}updateHoverDelay(e){this.setHoverTarget.delay=e}changeHoverEdges(e){return!0===e?"trbl":(e||"").replace("v","tb").replace("h","lr")}updateHoverEdges(){this.syncHoverListeners()}changeHoverElement(e){if(!this.hoverIgnore(e))return e}updateHoverElement(e){const{hoverSelector:t}=this;var n;t&&(e=null===(n=e)||void 0===n?void 0:n.closest(t)),this.setHoverTarget(e)}updateHoverRootElement(e,t){const{hoverRootCls:n}=this;n&&(null==t||t.classList.remove(n),null==e||e.classList.add(n)),this.syncHoverListeners()}changeHoverTarget(e,t){return t&&(this.hoverZone=null),e}updateHoverTarget(e,t){const n=this,{hoverCls:r,hoverAnimationCls:i,hoverRootActiveCls:s,hoverRootElement:o}=n;s&&(null==o||o.classList[e?"add":"remove"](s)),t&&(r&&t.classList.remove(r),i&&t.classList.remove(i),n.hoverLeave(t)),e&&(r&&e.classList.add(r),n.hoverEnter(t),n.hoverTrack&&n.hoverMove(n.hoverEvent),i&&(e.getBoundingClientRect(),e.classList.add(i)))}updateHoverTrack(){this.syncHoverListeners()}updateHoverZone(e){const{hoverAnimationCls:t,hoverTarget:n}=this;if(n){const{className:r}=n,i=Mn.change(r,e?Md[e]:null,Td);r!==i&&(n.className=i,e&&t&&(n.classList.remove(t),n.getBoundingClientRect(),n.classList.add(t)))}}setHoverTarget(e){this.hoverTarget=e}syncHoverListeners(){var e;const t=this,n=t.hoverRootElement,r={element:n,thisObj:t,mouseover:"onHoverMouseOver",mouseout:"onHoverMouseOut"};(t.hoverTrack||t.hoverEdges)&&(r.mousemove="onHoverMouseMove"),null===(e=t._hoverRootDetacher)||void 0===e||e.call(t),t._hoverRootDetacher=n&&_n.on(r)}},Id=e=>class extends e{static get $name(){return"LoadMaskable"}static get configurable(){return{loadMaskDefaults:{useTransition:!0,showDelay:1e3},loadMaskError:{icon:"b-icon b-icon-warning",autoClose:3e3,showDelay:0},loadMask:{text:"L{GridBase.loadMask}"},syncMask:{text:"L{GridBase.syncMask}"},localizableProperties:["loadMask.text","syncMask.text"]}}applyLoadMask(){const e=this,{loadMask:t}=e;return t&&(e.masked=Ta.mergeConfigs(e.loadMaskDefaults,t)),e.masked}applyMaskError(e){const{loadMaskError:t,masked:n}=this;return!1===t?n.hide():n&&(sn.assign(n.errorDefaults,t),n.error=e),n}get widgetClass(){}};const{defineProperty:Ad}=Object,{hasOwn:Fd}=sn,Od=Symbol("fencible"),Ld=[],Pd=e=>Array.from(new Set(e)),$d=e=>e?Pd(_.split(e)):Ld,_d=(e,t,n)=>{!0===n&&(n=t),sn.isObject(n)||(n={all:n});let r=$d(n.any);const i=$d(n.all),s=n.lock?$d(n.lock):Pd(i.concat(r)),o=t+"Impl";r=r.length?r:null,!e[o]&&Ad(e,o,{configurable:!0,value:e[t]}),Ad(e,t,{configurable:!0,value:function(...e){const t=this,n=Fd(t,Od)?t[Od]:t[Od]={},a=e=>!n[e];if(i.every(a)&&(!r||r.some(a)))try{return s.forEach((e=>n[e]=(n[e]||0)+1)),t[o](...e)}finally{s.forEach((e=>--n[e]))}}})};var Nd=e=>{var t;return v(t=class extends(e||Te){static setupFenced(e){let{fenced:t}=e;const n=t.static,r=[];n&&(t=f({},t),delete t.static,r.push([n,e])),r.push([t,e.prototype]);for(const[e,t]of r)for(const n in e)_d(t,n,e[n])}get widgetClass(){}},"$name","Fencible"),v(t,"declarable",["fenced"]),t};const Hd=6e4,Bd=36e5,jd=864e5,Vd=/(\d+)?:?(\d*)/;class zd{static format(e){const t=Math.floor(e/Bd),n=Math.floor(e/Hd)%60;return`${t}:${n<10?"0":""}${n}`}static parse(e){const t=typeof e;if("string"===t){const t=Vd.exec(e);e=Number(t[1]||0)*Bd+Number(t[2]||0)*Hd}else"number"!==t?e=en.getTimeOfDay(e):e<=24&&(e*=Bd);return Math.min(Math.max(Math.floor(e),0),jd)}constructor(e){let t,n,r=0;null!=e&&e.isDayView?(r=e.dayStartShift,t=e.dayStartTime,n=e.dayEndTime):"number"==typeof e?r=t=n=e:e&&(r=e.startShift,t=e.timeStart,n=e.timeEnd),this.startShift=r=zd.parse(r||0),this.timeEnd=(null==n?(r+jd)%jd:zd.parse(n))||jd,this.timeStart=null==t?r:zd.parse(t)}get startHour(){return Math.floor(this.timeStart/Bd)}get startTimeOffsetMs(){const{startShift:e,timeStart:t}=this;return t<e?jd-e+t:t-e}get today(){return this.startOfDay(new Date)}ceil(e){const t=this.startOfDay(e);return t<e&&t.setDate(t.getDate()+1),t}contains(e){return!this.outside(e)}dateKey(e){return e=this.shiftDate(e,-1),en.makeKey(e)}dayOfDate(e){return this.shiftDate(en.clearTime(e))}dayOfWeek(e){return(e=this.shiftDate(e,-1)).getDay()}delta(e,t="ms"){const{timeStart:n}=this,r=zd.parse(e),i=(this.startShift&&r<n?r+jd:r)-n;return"ms"===t?i:en.as(t,i,"ms")}duration(e="ms"){const{timeStart:t,timeEnd:n}=this,r=t<n?n-t:jd-t+n;return"ms"===e?r:en.as(e,r,"ms")}equals(e){return this.startShift===(null==e?void 0:e.startShift)&&this.timeStart===e.timeStart&&this.timeEnd===e.timeEnd}intersects(e,t){const n=this,{timeStart:r,timeEnd:i}=n,[s,o]=n._dateRangeArgs(e,t),[a,l]=n.timeRange(s,o);return r<i?a<l?a<i&&r<=l:a<i||r<=l:!(a<l)||a<i||r<=l}isIntraDay(e,t){const[n,r]=this._dateRangeArgs(e,t),i=this.startOfDay(n),s=jd-en.diff(i,r,"ms");return!(s<0)&&(s>0||i<n)}outside(e){const{startShift:t,timeStart:n,timeEnd:r}=this,i=zd.parse(e);return n<r?i<n?i<t?1:-1:i<r?0:i<t?-1:1:i<r||i>=n?0:i<t?1:-1}shiftDate(e,t=1){const{startShift:n}=this,r=typeof e;return e="number"===r?new Date(e):"string"===r?en.parse(e):new Date(e.getTime()),t&&n&&e.setMilliseconds(t>0?n:-n),e}sortEvents(e,t){const n=this.startOfDay(e);return null==t?void 0:t.sort(((e,t)=>{e=e.eventRecord||e,t=t.eventRecord||t;let{startDate:r}=e,{startDate:i}=t;return r?i?(r=r<n?n:r,i=i<n?n:i,r-i||t.endDate-i-(e.endDate-r)):1:-1}))}startOfDay(e){return e=this.shiftDate(e,-1),e=en.clearTime(e),this.shiftDate(e)}timeRange(e,t){const[n,r]=this._dateRangeArgs(e,t);return[en.getTimeOfDay(n),en.getTimeOfDay(r)]}toString(){const{startShift:e,timeEnd:t,timeStart:n}=this,r=e?`@${zd.format(e)}`:"",i=zd.format(n);return n===t?e?r:i:`${i}-${zd.format(t)}${r}`}_dateRangeArgs(e,t){return e.isModel?[e.startDate,e.endingDate]:[e,t]}}zd.MIDNIGHT=new zd({startShift:0,timeStart:0,timeEnd:24}),zd.MILLIS_PER_MINUTE=Hd,zd.MILLIS_PER_HOUR=Bd,zd.MILLIS_PER_DAY=jd,zd._$name="DayTime";class Wd extends(tt(Te)){static get configurable(){return{date:{$config:{equal:"date"},value:en.clearTime(new Date)},month:null,year:null,weekStartDay:null,hideNonWorkingDays:null,nonWorkingDays:null,sixWeeks:null}}configure(e){super.configure(e),this.updateDayNumbers(),e.date&&(this.date=e.date),this.generation=0}changeDate(e){if(!this.isConfiguring){if(e="string"==typeof e?en.parse(e,"YYYY-MM-DD"):new Date(e),isNaN(e))throw new Error("Month date ingestion must be passed a Date, or a valid YYYY-MM-DD date string");return e}}updateDate(e,t){const n=this,{dayColumnIndex:r,weekCount:i}=n,s=en.getFirstDateOfMonth(e),o=en.getLastDateOfMonth(s),a=r[s.getDay()],l=r[o.getDay()],c=!t||e.getFullYear()!==t.getFullYear(),d=!t||e.getMonth()!==t.getMonth(),u=n.eventListeners&&(t?e.getDate()!==t.getDate()|(n.getWeekId(e)!==n.getWeekId(t))<<1|d<<2|c<<3:15);if(n._year=e.getFullYear(),n._month=e.getMonth(),n.startDayOfMonth=1-a,n.endDayOfMonth=o.getDate()+(6-l),n.sixWeeks&&(n.endDayOfMonth+=7*(6-n.weekCount)),n.weekBase&&!c||n.calculateWeekBase(),(d||c)&&n.generation++,u){const r={newDate:e,oldDate:t,changes:{d:!0,w:Boolean(2&u),m:Boolean(12&u),y:Boolean(8&u),r:n.weekCount!==i}};n.trigger("dateChange",r),2&u&&n.trigger("weekChange",r),12&u&&n.trigger("monthChange",r),8&u&&n.trigger("yearChange",r)}}calculateWeekBase(){const e=this,{dayColumnIndex:t}=e,n=new Date(e.year,0,1),r=new Date(e.year,11,31),i=e.month?e.getOtherMonth(n):e;e.dayColumnIndex[n.getDay()]>3?e.weekBase=i.startDate:e.weekBase=new Date(e.year,0,i.startDayOfMonth-7);const s=Math.floor(en.diff(e.weekBase,r,"day")/7);e.has53weeks=53===s&&t[r.getDay()]>2}getWeekStart(e){if("number"==typeof e)return en.add(this.weekBase,7*Math.max(e,1),"day");const t=this,[n,r]=e;return n===t.year?t.getWeekStart(r):t.getOtherMonth(new Date(n,0,1)).getWeekStart(r)}getOtherMonth(e){const t=this,n=t===Ud?new Wd(null):Ud;return n.configure({weekBase:null,weekStartDay:t.weekStartDay,nonWorkingDays:t.nonWorkingDays,hideNonWorkingDays:t.hideNonWorkingDays,sixWeeks:t.sixWeeks,date:new Date(e.getFullYear(),0,1)}),n.date=e,n.updateDate(n.date,n.date),n}changeYear(e){const t=new Date(this.date);t.setFullYear(e),this.date=t}changeMonth(e){const t=new Date(this.date);t.setMonth(e),this.date=t}get weekStartDay(){return"number"==typeof this._weekStartDay?this._weekStartDay:en.weekStartDay}updateWeekStartDay(){const e=this;e.updateDayNumbers(),!e.isConfiguring&&e.date&&(e.weekBase=null,e.updateDate(e.date,e.date))}get nonWorkingDays(){return this._nonWorkingDays||en.nonWorkingDays}changeNonWorkingDays(e){return sn.assign({},e)}updateNonWorkingDays(){this.updateDayNumbers()}updateHideNonWorkingDays(){this.updateDayNumbers()}updateSixWeeks(){this.isConfiguring||this.updateDate(this.date,this.date)}get dayCount(){return this.endDayOfMonth+1-this.startDayOfMonth}get weekCount(){return this.dayCount/7}get startDate(){const e=this;if(null!=e.year&&null!=e.month&&null!=e.startDayOfMonth)return new Date(e.year,e.month,e.startDayOfMonth)}get endDate(){const e=this;if(null!=e.year&&null!=e.month&&null!=e.startDayOfMonth)return new Date(e.year,e.month,e.endDayOfMonth)}eachDay(e){for(let t=this.startDayOfMonth;t<=this.endDayOfMonth;t++)e(new Date(this.year,this.month,t))}eachWeek(e){const t=this,{weekCount:n}=t;for(let r=t.startDayOfMonth,i=0;i<n;i++){const n=[],i=t.getWeekNumber(new Date(t.year,t.month,r));for(let e=0;e<7;e++,r++)n.push(new Date(t.year,t.month,r));e(i,n)}}getWeekNumber(e){const t=this;if((e=en.clearTime(e)).getFullYear()!==t.year)return t.getOtherMonth(new Date(e.getFullYear(),0,1)).getWeekNumber(e);let n=Math.floor(en.diff(t.weekBase,e,"day")/7),r=e.getFullYear();return n?(53!==n||t.has53weeks?n>53&&(n%=52):(n=1,r++),[r,n]):t.getOtherMonth(new Date(t.year-1,0,1)).getWeekNumber(new Date(t.year,0,0))}getWeekId(e){const t=this.getWeekNumber(e);return 100*t[0]+t[1]}getCellData(e,t,n=zd.MIDNIGHT){const r=this,i=e.getDay(),s=r.visibleDayColumnIndex[i],o=r.nonWorkingDays[i],a=r.hideNonWorkingDays&&o;return(e<r.startDate||e>r.endDate)&&(r.month=e.getMonth()),{day:i,dayTime:n,visibleColumnIndex:s,isNonWorking:o,week:r.getOtherMonth(e).getWeekNumber(e),key:en.format(e,"YYYY-MM-DD"),columnIndex:r.dayColumnIndex[i],date:new Date(e),isOtherMonth:Math.sign(e.getMonth()+12*e.getFullYear()-(t.month+12*t.year)),visible:!a&&e>=t.startDate&&e<en.add(t.endDate,1,"day"),tomorrow:n.dayOfDate(en.add(e,1,"day")),isRowStart:0===s,isRowEnd:s===r.visibleColumnCount-1}}updateDayNumbers(){const e=this,{weekStartDay:t,nonWorkingDays:n,hideNonWorkingDays:r}=e,i=e.dayColumnIndex=[],s=e.canonicalDayNumbers=[],o=e.visibleDayColumnIndex=[];let a=0;for(let e=0;e<7;e++){const l=(t+e)%7;s[e]=l,i[l]=e,r&&n[l]||(o[l]=a++)}e.visibleColumnCount=a,e.weekLength=r?7-sn.keys(n).length:7}}v(Wd,"$name","Month");const Ud=new Wd(null);Wd._$name="Month";let Yd=0;const Gd=new WeakMap,qd=e=>{const t=new Map;return(...n)=>{const r=((...e)=>e.map((e=>{let t;return e&&"object"==typeof e||"function"==typeof e?(t=Gd.get(e),void 0===t&&(t=++Yd,Gd.set(e,t))):t=String(e),t})).join("-"))(n);let i=t.get(r);return void 0===i&&(i=e(...n),t.set(r,i)),i}},Kd=e=>{const t=new Map,n=e=>e[0],r=e=>e[1],i=(e,t)=>n(e).push(t);return(s,o)=>{const a=(e=>{let n=t.get(e);return void 0===n&&(n=[[],[]],t.set(e,n)),n})(s);(e=>!r(e).length&&!n(e).length)(a)?(i(a,o),e(s,(e=>{((e,t)=>r(e).some((e=>sn.isEqual(e,t))))(a,e)||(((e,t)=>{r(e).push(t)})(a,e),n(a).forEach((t=>t(e))))}))):(i(a,o),r(a).forEach((e=>o(e))))}},Xd=Symbol("success"),Zd=Symbol("failure"),Jd=(e,t)=>[Xd,e,t],Qd=e=>[Zd,e],eu=e=>"function"!=typeof e||e.length?e:e(),tu=qd((e=>Kd(((t,n)=>n(Jd(e,t)))))),nu=(qd((e=>Kd(((t,n)=>{const r=Math.min(e.length,t.length),i=t.substr(0,r),s=t.substr(r);n(i===e?Jd(i,s):Qd(s))})))),(e,t)=>(n,r)=>eu(e)(n,(e=>{if((e=>e.length&&e[0]===Xd)(e)){const[,n,i]=e;t(n)(i,r)}else r(e)})));qd(((...e)=>{const t=qd(((e,t)=>Kd(nu(e,(e=>nu(t,(t=>tu([].concat(e,t)))))))));return e.reduce(t,tu([]))})),qd(((...e)=>Kd(((t,n)=>e.forEach((e=>eu(e)(t,n))))))),qd((e=>(t,n)=>{const r=new RegExp(`^${e}`).exec(t);if(r){const e=r[0],i=t.substr(e.length);n(Jd(e,i))}else n(Qd(t))})),qd(((e,t)=>nu(e,((...e)=>tu(t(...[].concat.apply([],e)))))));class ru extends(Zr(Te)){static get configurable(){return{element:null,zoneWidth:50,scrollSpeed:5,direction:"both",startScrollDelay:500,stopScrollWhenPointerOut:!1,testConfig:{scrollSpeed:2,startScrollDelay:100},activeScroll:{$config:["lazy"],value:{}},monitoring:{$config:["lazy","nullify"],value:!0},owner:null}}changeMonitoring(e,t){return null==t||t.clear(),new Map}doDestroy(){this.stopMonitoring(),super.doDestroy()}get isScrolling(){return 0!==Object.keys(this.activeScroll).length}get rtl(){var e;return null===(e=this.owner)||void 0===e?void 0:e.rtl}startMonitoring(e={}){const t=this,{element:n,direction:r}=t,{scrollables:i=[],direction:s=r,callback:o}=e,a=[];return i.length||i.push({element:n}),i.forEach((e=>{const r=e.element;"string"==typeof r?Mr.forEachSelector(n,r,(n=>{t.createMonitor(n,e.direction||s,e.callback||o),a.push(n)})):(t.createMonitor(r,e.direction||s,e.callback||o),a.push(r))})),function(){var e;null===(e=t.stopMonitoring)||void 0===e||e.call(t,a)}}createMonitor(e,t,n){const{monitoring:r}=this;r.has(e)||r.set(e,new iu({scrollManager:this,element:e,direction:t,callback:n}))}stopMonitoring(e){const t=this,{monitoring:n}=t;if(e=ke.asArray(e),n){if(!e)return void n.forEach((e=>t.stopMonitoring(e.element)));e.forEach((e=>{const t=n.get(e);e.classList.remove("b-scrolling"),t&&(t.destroy(),n.delete(e))}))}}requestScroll(e,t){const{activeScroll:n}=this;return!(e in n&&n[e]!==t||(n[e]=t,0))}releaseScroll(e){const{activeScroll:t={}}=this;Object.keys(t).forEach((n=>{t[n]===e&&delete t[n]}))}getRelativeScroll(e,t="left"){let n=0;return this.monitoring.forEach(((r,i)=>{Mr.isDescendant(i,e)&&(n+="left"===t?r.scrollRelativeLeft:r.scrollRelativeTop)})),n}}class iu extends Te{construct(e){const{element:t}=e,n=t.scrollLeft,r=t.scrollTop;Object.assign(e,{startScrollLeft:n,startScrollTop:r}),super.construct(e),_n.on({element:t,scroll:"onElementScroll",mousemove:"onMouseMove",touchmove:"onMouseMove",capture:!0,thisObj:this}),_n.on({element:t,pointerleave:"onPointerLeave",thisObj:this})}doDestroy(){this.stopScroll(),super.doDestroy()}startScroll(){this.scrolling=!0,this.performScroll()}stopScroll(){const e=this;e.scrolling=!1,e.scrollRequested&&(e.scrollManager.cancelAnimationFrame(e.frameId),e.scrollRequested=!1),e.scrollManager.clearTimeout(e.scrollTimeout),e.scrollManager.releaseScroll(e),e.scrollTimeout=null}onPointerLeave(){this.scrollManager.stopScrollWhenPointerOut&&this.stopScroll()}onMouseMove(e){const t=this,{scrollManager:n}=t,r=t.element.getBoundingClientRect(),i=n.zoneWidth,s=n.scrollSpeed;if(t.scrollDeltaX=t.scrollDeltaY=0,"vertical"!==t.direction){const{scrollLeft:o,scrollWidth:a,clientWidth:l}=t.element;n.rtl?e.clientX<r.left+i&&a+o-l>=1?t.scrollDeltaX=-Math.round((i+(r.left-e.clientX))/s)-1:e.clientX>r.right-i&&o<0&&(t.scrollDeltaX=Math.round((i-(r.right-e.clientX))/s)+1):e.clientX>r.right-i&&a-o-l>=1?t.scrollDeltaX=Math.round((i-(r.right-e.clientX))/s)+1:e.clientX<r.left+i&&o>0&&(t.scrollDeltaX=-Math.round((i+(r.left-e.clientX))/s)-1)}if("horizontal"!==t.direction){const{scrollTop:n,scrollHeight:o,clientHeight:a}=t.element;e.clientY>r.bottom-i&&o-n-a>=1?t.scrollDeltaY=Math.round((i-(r.bottom-e.clientY))/s)+1:e.clientY<r.top+i&&n>0&&(t.scrollDeltaY=-Math.round((i+(r.top-e.clientY))/s)-1)}0===t.scrollDeltaX||n.requestScroll("horizontal",t)||(t.scrollDeltaX=0),0===t.scrollDeltaY||n.requestScroll("vertical",t)||(t.scrollDeltaY=0),0===t.scrollDeltaX&&0===t.scrollDeltaY?t.stopScroll():t.scrollTimeout||(t.scrollTimeout=n.setTimeout((()=>t.startScroll()),n.startScrollDelay))}performScroll(){const e=this,{element:t}=e;if(e.scrolling&&!e.scrollRequested){if(0!==e.scrollDeltaX){const n=t.scrollLeft,r=Math.min(n+e.scrollDeltaX,t.scrollWidth-t.clientWidth);r!==n&&(t.scrollLeft=r)}if(0!==e.scrollDeltaY){const n=t.scrollTop,r=Math.min(n+e.scrollDeltaY,t.scrollHeight-t.clientHeight);r!==n&&(t.scrollTop=r)}e.scrollRequested=!0,e.frameId=e.scrollManager.requestAnimationFrame((()=>{e.scrollRequested=!1,e.performScroll(e)}))}}onElementScroll(){var e,t;null===(e=this.config)||void 0===e||null===(t=e.callback)||void 0===t||t.call(this.thisObj||this.scrollManager,this)}get scrollLeft(){return this.element.scrollLeft}get scrollTop(){return this.verticalElement?this.verticalElement.scrollTop:this.element.scrollTop}get scrollRelativeLeft(){return this.scrollLeft-this.startScrollLeft}get scrollRelativeTop(){return this.scrollTop-this.startScrollTop}getRelativeLeftScroll(e){return this.scrollManager.getRelativeScroll(e,"left")}getRelativeTopScroll(e){return this.scrollManager.getRelativeScroll(e,"top")}}ru._$name="ScrollManager";const su={left:!0,right:!0,top:!0,bottom:!0,transform:!0},ou={true:1,false:1},au=Promise.resolve();class lu extends Ic{static get $name(){return"Tooltip"}static get type(){return"tooltip"}static get configurable(){return{mouseOffsetX:15,mouseOffsetY:15,html:{$config:{equals:()=>!1}},getHtml:null,forElement:null,trackMouse:null,updateContentOnMouseMove:!1,forSelector:null,hideOnDelegateChange:null,anchorToTarget:!0,showOnHover:!1,hoverDelay:500,autoShow:!1,dismissDelay:0,hideDelay:500,loadingMsg:"Loading...",allowOver:null,anchor:!0,align:{align:"b-t",minHeight:300},axisLock:!0,testConfig:{hideDelay:100,hoverDelay:100,showAnimation:null,hideAnimation:null}}}afterConfigure(){const e=this,{forSelector:t}=e;t&&(e.showOnHover=!0,e.forElement||(e.anchorToTarget||(e.trackMouse=!0),e.forElement=e.rootElement.host||e.rootElement)),super.afterConfigure(),e.forElement&&e.showOnHover&&(e.pointerOverOutDetacher=_n.on({element:e.forElement,pointerover:"internalOnPointerOver",pointerout:"internalOnPointerOut",thisObj:e}))}doDestroy(){var e;null===(e=this.pointerOverOutDetacher)||void 0===e||e.call(this),super.doDestroy()}set focusOnToFront(e){super.focusOnToFront=e}get focusOnToFront(){return super.focusOnToFront&&Mr.usingKeyboard}get focusElement(){const e=super.focusElement;if(e!==this.element)return e}get anchorToTarget(){return this._anchorToTarget&&!this.trackMouse}get anchor(){return super.anchor&&!this.trackMouse}set anchor(e){super.anchor=e}onDocumentMouseDown({event:e}){const t=this,{triggeredByEvent:n}=t;n&&Mr.isTouchEvent&&e.pageX===n.pageX&&e.pageY===n.pageY&&t.activeTarget.contains(e.target)&&performance.now()-n.timeStamp<500||(t.abortDelayedShow(),super.onDocumentMouseDown({event:e}))}internalOnPointerOver(e){const t=this,{target:n,relatedTarget:r}=e,{forElement:i,forSelector:s,activeTarget:o}=t;let a;if(!(t.disabled||t.owner&&!t.owner.showTooltipWhenDisabled&&t.owner.disabled||t.allowOver&&t.element.contains(n))){if(s){if(a=n.closest(s),null!=o&&o.contains(n)&&o.contains(r)&&a===o)return;if(a&&(null==r?void 0:r.closest(s))===a)return}else{if(i.contains(r))return;a=i}a?t.handleForElementOver(e,a):o&&t.handleForElementOut()}}onTransitionEnd(e){const t=this,{currentOverElement:n}=lu;if(su[e.propertyName]){var r;if(t.allowOver&&t.element.contains(n))return;null!==(r=t.activeTarget)&&void 0!==r&&r.contains(n)&&!t.trackMouse&&t.realign()}}async handleForElementOver(e,t){const n=this,{activeTarget:r,hideOnDelegateChange:i,anchorToTarget:s}=n,o=t!==r,a=o&&i;if(!1===n.trigger("pointerOver",{event:e,target:t}))n.internalOnPointerOut(e);else{if(n.triggeredByEvent=e,n.hasTimeout("hide")&&(n.abortDelayedHide(),!o))return;if(!i&&n.element.classList.contains("b-hiding")&&n.cancelHideShowAnimation(),!n._hidden&&a&&n.hide(!1),n.updateActiveTarget(t),n.isVisible){const e=n.updateContent();if(Y.isPromise(e)&&!n.loadingMsg&&await e,!1===n.trigger("beforeShow"))return n.hide();n.alignTo({[s?"target":"position"]:s?t:"mouse",overlap:!(s&&n.anchor)}),n.trigger("show"),n.afterShowByTarget()}else n.delayShow(t)}}async delayShow(e){var t;const n=this;if(null!==(t=n.currentAnimation)&&void 0!==t&&t.showing&&n.cancelHideShowAnimation(),n.isVisible||n.hasTimeout("show"))n.isVisible&&n.showByTarget(e);else if(!n.hoverDelay||n.forSelector&&Date.now()-n.lastHidden<n.quickShowInterval){const t=n.updateContent();Y.isPromise(t)&&!n.loadingMsg&&await t,n.showByTarget(e)}else n.addDocumentMouseDownListener(),n.listeningForMouseMove||n.anchorToTarget||(n.mouseMoveRemover=_n.on({element:n.rootElement,mousemove:"onMouseMove",thisObj:n})),n.setTimeout((async()=>{if(!Mr.isOrphaned(e)){const t=n.updateContent();Y.isPromise(t)&&!n.loadingMsg&&await t,n.showByTarget(e)}}),n.triggeredByEvent&&"pointerover"!==n.triggeredByEvent.type?0:n.hoverDelay,"show")}changeAllowOver(e){return this.inAfterShow||(this.configuredAllowOver=e),e}updateAllowOver(e){const t=this,{element:n}=t;var r;n.classList.toggle("b-allow-over",Boolean(e)),e?t.allowOverlisteners=_n.on({element:n,mouseenter:"onOwnElementMouseEnter",mouseleave:"internalOnPointerOut",thisObj:t}):null===(r=t.allowOverlisteners)||void 0===r||r.call(t)}updateContent(){const e=this;if(e.getHtml){const t=e.callback(e.getHtml,e,[{tip:e,element:e.element,activeTarget:e.activeTarget,event:e.triggeredByEvent}]);return e.html=t,t}}get hasContent(){return Boolean(""!==this._html&&"string"==typeof this.html&&this.html.length||this.items.length)}internalBeforeShow(){return(this.updateContentOnMouseMove||this.hasContent)&&!this.disabled}showAsyncMessage(e=this.optionalL(this.loadingMsg)){e&&(this.html=`\n                <div class="b-tooltip-loading">\n                    <i class="b-icon b-icon-spinner"></i>\n                    ${e}\n                </div>\n            `)}beforeAlignTo(e){super.beforeAlignTo(e);const t=this;t.anchorToTarget||"mouse"!==e.position||(e.position=new kn(t.triggeredByEvent.pageX-globalThis.pageXOffset+t.mouseOffsetX*(t.rtl?-1:1),t.triggeredByEvent.pageY-globalThis.pageYOffset+t.mouseOffsetY))}showByTarget(e){var t;const n=this,{anchorToTarget:r}=n;n.mouseMoveRemover=null===(t=n.mouseMoveRemover)||void 0===t?void 0:t.call(n),n.showBy({[r?"target":"position"]:r?e:"mouse",overlap:!(r&&n.anchor)})}afterShowByTarget(){const e=this,{dismissDelay:t}=e;e.abortDelayedShow(),t&&e.setTimeout("hide",t),e.toFront(),e.mouseMoveRemover||!e.trackMouse&&!e.updateContentOnMouseMove||(e.mouseMoveRemover=_n.on({element:e.rootElement,pointermove:"onMouseMove",thisObj:e})),e.inAfterShow=!0,e.allowOver=e.allowOver||0!=e.configuredAllowOver&&e.childItems.some((e=>e.isVisible&&!e.disabled&&e.focusElement)),e.inAfterShow=!1}updateActiveTarget(e){const t=this,n=t.activeTarget;t.activeTarget=e,t.isConfiguring||t.trigger("overTarget",{newTarget:e,lastTarget:n})}internalOnPointerOut(e){var t;const n=this,r=e.relatedTarget;n.allowOver&&n.element.contains(r)||n.element.contains(e.target)&&null!==(t=n.activeTarget)&&void 0!==t&&t.contains(r)||n.activeTarget&&!n.activeTarget.contains(r)&&n.handleForElementOut()}handleForElementOut(){const e=this,{hideDelay:t}=e;!1!==e.trigger("pointerOut")?(e.abortDelayedShow(),e.isVisible&&!1!==t&&(e.abortDelayedHide(),t>0?e.setTimeout("hide",t):e.hide())):e.activeTarget=null}show(e){const t=this;!e&&t.forElement&&t.anchorToTarget&&!t.forSelector?t.showByTarget(t.forElement):super.show(...arguments),t.afterShowByTarget(),!t.forElement||t.transitionEndDetacher||t._hidden||(t.transitionEndDetacher=_n.on({element:t.forElement,transitionend:"onTransitionEnd",thisObj:t}))}hide(){const e=this;if(e.abortDelayedShow(),e._hidden)return au;{var t,n;e.abortDelayedHide();const r=super.hide(...arguments);return e.lastHidden=Date.now(),e.activeTarget=null,null===(t=e.mouseMoveRemover)||void 0===t||t.call(e),e.mouseMoveRemover=null,null===(n=e.transitionEndDetacher)||void 0===n||n.call(e),e.transitionEndDetacher=null,r}}abortDelayedShow(){const e=this;var t,n,r;e.hasTimeout("show")&&(null===(t=e.mouseDownRemover)||void 0===t||t.call(e),e.mouseDownRemover=null,e.clearTimeout("show"),null===(n=e.mouseMoveRemover)||void 0===n||n.call(e),e.mouseMoveRemover=null,null===(r=e.transitionEndDetacher)||void 0===r||r.call(e),e.transitionEndDetacher=null)}abortDelayedHide(){this.clearTimeout("hide")}realign(){const e=this,t=e.lastAlignSpec;e.isConfiguring||e.isVisible||null==t||!t.targetOutOfView||(t.allowTargetOut||Mr.isInView(t.target,!1,e))&&(e.show(),t.targetOutOfView=!1),super.realign()}alignTo(e){const t=this;t.isVisible&&(!e||t.triggeredByEvent&&t.element.contains(t.triggeredByEvent.target)||e.nodeType===Node.ELEMENT_NODE&&(e={target:e}),super.alignTo(e))}changeHtml(e){const t=this;return Y.isPromise(e)?(t.showAsyncMessage(),e.target=t.activeTarget,void e.then((n=>{e.target===t.activeTarget&&(t.html=n)}))):("object"!=typeof e&&(e=null!=e?t.optionalL(String(e)):""),e)}updateHtml(e,t){const n=this;let r=""===e;r||(super.updateHtml(e,t),n.hasContent?(n.isVisible&&n.realign(),Y.isPromise(e)||n.trigger("innerHtmlUpdate",{value:e})):r=!0),r&&n.hide()}onMouseMove(e){const t=this,{forElement:n,activeTarget:r}=t,i=t.hasTimeout("hide"),s=e.target;if(t.triggeredByEvent=e,!t._hidden){let o;const a=!(null==r?void 0:r.contains(s))&&t.forSelector&&r&&!i&&s.nodeType===Node.ELEMENT_NODE&&!s.matches(t.forSelector)&&!(t.allowOver&&t.element.contains(s)),l=null!=n&&n.document?n.document.documentElement:n,c=l&&(l.contains?l.contains(s):16&l.compareDocumentPosition(s));if(a&&(o=t.handleForElementOut()),o||!i||c){if(t.dismissDelay&&!i&&t.setTimeout("hide",t.dismissDelay),t.updateContentOnMouseMove&&t.getHtml&&(t.html=t.callback(t.getHtml,t,[{tip:t,element:t.element,forElement:r,event:e}]),!t.html))return void t.hide();t.trackMouse&&t.alignTo({position:"mouse",ignorePageScroll:!0})}}}onOwnElementMouseEnter(e){this.abortDelayedHide()}static getSharedTooltip(e,t){var n,r;let i=null===(n=e.bryntum)||void 0===n||null===(r=n.tooltip)||void 0===r?void 0:r.get(lu);if(!i&&!t){var s;null!==(s=e.bryntum)&&void 0!==s&&s.tooltip||sn.setPath(e,"bryntum.tooltip",new Map);const t=e.bryntum.tooltip;t.set(lu,!0),i=new lu({forElement:e,rootElement:e,forSelector:"[data-btip]",resetCfg:{},isShared:!0,cls:"b-tooltip-shared",listeners:{pointerOver({source:e,target:t}){for(const t in e.resetCfg)"listeners"===t?e.un(e.resetCfg[t].set):"html"!==t&&(e[t]=e.resetCfg[t].was);e.resetCfg={};const n=Ka.getById(t.id),r=(null==n?void 0:n.tipConfig)||e.gatherDataConfigs(t.dataset);if(n&&n.element!==t||!n&&t.matches(".b-widget")||null!=n&&n.disabled&&!n.showTooltipWhenDisabled)return!1;e.owner=n;for(const t in r)e.resetCfg[t]={set:r[t],was:e[t]},"listeners"===t?e.on(r[t]):e[t]=r[t]},hide({source:e}){e.owner=null}},gatherDataConfigs(e){const t=this,n={};for(const r in e)if(r.startsWith("btip"))if(r.length>4){const i=_.uncapitalize(r.substr(4));if(i in t.getDefaultConfiguration()){const t=e[r];n[i]=ou[t]?"true"===t:isNaN(t)?t:parseInt(t,10)}}else n.html=e[r];return n}}),_n.on({element:e,mouseenter:e=>lu.currentOverElement=e.target,keydown:e=>lu.currentOverElement=e.target,capture:!0}),t.set(lu,i)}return i}static encodeConfig(e){const t={};if("string"==typeof e)t.btip=e;else for(const n in e)t[`btip${"html"===n?"":_.capitalize(n)}`]=e[n];return t}}lu.initClass(),Object.defineProperty(Ka,"tooltip",{get(){return lu.getSharedTooltip(document.body)}}),Ka.Tooltip=lu,lu._$name="Tooltip";class cu extends yd{static get type(){return"tip"}static get configurable(){return{align:"t10-b50",offset:20,tooltip:{$config:["lazy","nullify"],value:{type:"tooltip"}}}}open(){this.getConfig("tooltip")}close(){var e;null===(e=this.tooltip)||void 0===e||e.hide()}dragMove(e){const{offset:t,tooltip:n}=this,{event:r}=e;n&&(n.isVisible||n.show(),n.alignTo({align:this.align,target:new xn(r.clientX-t,r.clientY-t,2*t,2*t)}))}changeTooltip(e,t){return Ka.reconfigure(t,e,this)}}cu.initClass(),cu._$name="DragTipProxy";var du=e=>class extends(e||Te){static get $name(){return"Labelable"}static get configurable(){return{label:null,labelPosition:"before",labelCls:null,labelWidth:{value:null,$config:{localeKey:"L{labelWidth}"}}}}get hasLabel(){return Boolean(this.label)}compose(){const{hasLabel:e,labelPosition:t}=this;return{class:{[`b-label-${t}`]:e,"b-has-label":e}}}changeLabel(e){return e||""}setupLabel(e){return sn.assign({tag:"label",for:`${this.id}-input`,class:`b-label b-align-${e.align||"start"}`},e)}updateLabelWidth(e){this.labelElement&&(this.labelElement.style.flex=`0 0 ${Mr.setLength(e)}`,this.inputWrap.style.flexBasis=null==e?"":"auto")}get widgetClass(){}};class uu extends ll{static get $name(){return"FieldContainer"}static get type(){return"fieldcontainer"}static get configurable(){return{animation:{duration:300},collapsed:null,collapser:{value:null,$config:"nullify"},syncableConfigs:null,syncConfigTriggers:{$config:{merge:"classList"},value:null},testConfig:{animation:{duration:10}}}}static get delayable(){return{syncChildConfigs:"raf"}}get inline(){var e;return null!==(e=this.owner.inline)&&void 0!==e?e:1===this.ensureItems().count}changeCollapsed(e){if(this.togglingCollapse)return this.togglingCollapse=!1,e;this.toggleCollapse(Boolean(e))}updateCollapsed(e){var t;this.collapser=null===(t=this.collapser)||void 0===t?void 0:t.destroy(),this.setCollapsedCls(e)}updateCollapser(e,t){t&&null==t.completed&&(t.reverting&&e||t.destroy()),this.setOwnerCls("b-collapsing",e)}get collapsing(){const{collapser:e}=this;return null!=e&&e.collapsed}get collapsingExpanding(){return null!=this.collapser}get expanding(){const{collapser:e}=this;return null!=e&&!e.collapsed}collapse(e){this.toggleCollapse(!0,e)}expand(e){this.toggleCollapse(!1,e)}setCollapsedCls(e){this.setOwnerCls("b-collapsed",e)}setOwnerCls(e,t){var n,r;null===(n=this.owner)||void 0===n||null===(r=n.element)||void 0===r||r.classList[t?"add":"remove"](e)}syncChildConfigs(){const e=this,{owner:t,syncableConfigs:n}=e;if(n){let r,i;for(r in n)i=n[r](t),e.eachWidget((e=>{e[r]=i}),!1)}t.afterSyncChildConfigs(e)}syncContainer(){const{inline:e,layout:t}=this;this.autoLayout&&(t.horizontal=e,t.justify=e?"center":"stretch")}toggleCollapse(e,t){const n=this,{animation:r,collapser:i,inline:s}=n,{containerWrapElement:o}=n.owner,a=t=>{t&&(n.element.style.height="",n.togglingCollapse=!0,n.collapsed=e,n.collapser=null)};if(null==e&&(e=!n.collapsed),!1!==t&&null!==t&&(o&&n.isVisible?(!0===t?t={}:"number"==typeof t&&(t={duration:t}),t=r||t?sn.merge({},r,t):null):t=null),t){if(i&&e!==i.collapsed)n.collapser=i.revert({finalize:a}),n.collapser.collapsed=e;else if(!i&&e!==n.collapsed){!e&&n.setCollapsedCls(!1);const{element:r}=n,{height:i}=r.getBoundingClientRect(),l=s?1:i;!e&&n.setCollapsedCls(!0),r.style.height=`${i}px`,n.collapser=bl.run(sn.merge({finalize:a,element:o,[s?"opacity":"height"]:{from:e?l:0,to:e?0:l}},t)),n.collapser.collapsed=e}}else n.togglingCollapse=!0,n.collapsed=e}}uu.initClass(),uu._$name="FieldContainer";const hu=(e,t)=>(e.weight||0)-(t.weight||0),gu=(e,t)=>(t.weight||0)-(e.weight||0),mu=[],pu={align:!0,weight:!0};class fu extends(Ka.mixin(ic,du)){static get $name(){return"Field"}static get type(){return"field"}static get configurable(){return{defaultBindProperty:"value",placeholder:null,value:"",name:null,labels:null,required:null,clearable:null,revertOnEscape:null,hint:null,hintHtml:null,inputWidth:null,keyStrokeChangeDelay:0,readOnly:null,editable:!0,defaultAction:"change",triggers:null,highlightExternalChange:!0,localizableProperties:["label","title","placeholder","labelWidth"],autoSelect:!1,autoComplete:"off",spellCheck:null,validateOnInput:!0,inputAttributes:null,inputType:"text",inputAlign:null,attributes:{value:["placeholder","autoComplete","spellCheck","minLength","maxLength","pattern","tabIndex","min","max"],$config:{merge:"distinct"}},nullValue:{$config:null,value:null,default:null},updatedClsDuration:500,inputReadOnly:!1,ariaElement:"input",container:{$config:"nullify",value:null},containerDefaults:{type:"fieldcontainer",syncableConfigs:{disabled:e=>e.disabled},syncConfigTriggers:{disabled:1}},containValues:null,inline:null,testConfig:{updatedClsDuration:10},keyMap:{}}}static get delayable(){return{highlightChanged:"raf"}}doDestroy(){var e,t,n;const r=this,{triggers:i}=r,s=r.isPainted&&fu.getSharedErrorTooltip(r.rootElement,!0);if(null===(e=r.inputListenerRemover)||void 0===e||e.call(r),null===(t=r.keyListenerRemover)||void 0===t||t.call(r),null===(n=r.container)||void 0===n||n.destroy(),super.doDestroy(),i)for(const e of Object.values(i))e.destroy();(null==s?void 0:s.field)===r&&s.hide()}get childItems(){const{container:e,triggers:t}=this,n=t?Object.values(t):[];return e?[...n,...e.childItems]:n}get invalidValueError(){return"L{invalidValue}"}get errorTip(){return this.constructor.getSharedErrorTooltip(this.rootElement)}static getSharedErrorTooltip(e,t){var n;let r=null===(n=e.bryntum)||void 0===n?void 0:n.errorTooltip;return r||t||(e.bryntum=e.bryntum||{},r=new lu({cls:"b-field-error-tip",forSelector:".b-field.b-invalid .b-field-inner",align:{align:"l-r",monitorTargetMutation:!0},scrollAction:"realign",trapFocus:!1,rootElement:e,onBeforeShow(){const e=this,t=Ka.fromElement(e.activeTarget);if(t){const n=t.getErrors();if(n)return e.html=n.join("<br>"),e.field=t,!0}return!1}}),e.bryntum.errorTooltip=r),r}static get errorTip(){return this.getSharedErrorTooltip(document.body)}construct(e){super.construct(e);const t=this;t.keyStrokeChangeDelay&&(t.changeOnKeyStroke=t.buffer(t.internalOnChange,t.keyStrokeChangeDelay))}changeKeyMap(e){const t=this;let n={};e&&(t._fieldKeyMap?sn.assign(n,t._fieldKeyMap):(t._fieldKeyMap=e,sn.assign(n,e)));for(const e in t.triggers){var r;null!==(r=t.triggers[e])&&void 0!==r&&r.keyMap&&(n=t.mergeKeyMaps(n,t.triggers[e].keyMap,e))}return n}get keyMapSubComponents(){return this.triggers}onFocusIn(e){const t=this;t.valueOnFocus=sn.clone(t.value),t.validOnFocus=!(t.errors&&Object.keys(t.errors).length),super.onFocusIn(e),t.focusing=!0,t.syncInvalid(),t.focusing=!1}onFocusOut(e){super.onFocusOut(e),this.syncRequired(),this.onEditComplete()}onEditComplete(){}get rootUiClass(){return fu}compose(){this.getConfig("clearable");const e=this,{container:t,innerElements:n,label:r,labels:i,labelCls:s,readOnly:o,triggers:a}=e,l=sn.values(a,((e,t)=>!t)),c=l.filter((e=>"start"===e.align)).sort(hu),d=l.filter((e=>"start"!==e.align)).sort(gu),u=e.setupLabel.bind(e),h=[...c.map((e=>e.element)),...n,...d.map((e=>e.element))];return{class:{"b-has-start-trigger":c.length,"b-no-input":!n.length,"b-readonly":o,"b-field-container":Boolean(t),"b-field-container-inline":null==t?void 0:t.inline},children:[...(i||mu).filter((e=>e&&"end"!==e.align)).map(u),r?u({reference:"labelElement",class:`b-label b-align-start ${s||""}`,html:r}):null,h.length?{class:"b-field-inner",reference:"inputWrap",children:h}:null,...(i||mu).filter((e=>"end"===(null==e?void 0:e.align))).map(u),...t?[{reference:"containerWrapElement",children:[t.element],class:{"b-field-container-wrap":1}}]:mu]}}updateElement(e,t){var n;const r=this,i=r.initialConfig.value,{input:s}=r;super.updateElement(e,t),null!=i&&(r.value=i),r.syncEmpty(),r.updateInputReadOnly(r.inputReadOnly),r.syncInvalid();const o=s||r.focusElement;null===(n=r.keyListenerRemover)||void 0===n||n.call(r),r.keyListenerRemover=o&&_n.on({element:o,thisObj:r,keydown:"internalOnKeyEvent",keypress:"internalOnKeyEvent",keyup:"internalOnKeyEvent"})}get innerElements(){return[this.inputElement]}get inputElement(){const{attributes:e,inputAttributes:t,id:n,inputCls:r,inputType:i,name:s}=this,o=sn.assign({reference:"input",tag:"input",type:i,name:s||n,id:`${n}-input`,retainElement:!0},t);r&&(o.class=r);for(let t,n,r=e.length;r-- >0;)t=e[r],n=this[t],null!=n&&(o[t]=n);return o}get caretPos(){return this.textSelection[0]}set caretPos(e){this.textSelection=e}get focusElement(){return this.input}get textSelection(){const e=this.input;let t;try{t=[e.selectionStart,e.selectionEnd,e.selectionDirection]}catch(r){var n;t=(null===(n=e.value)||void 0===n?void 0:n.length)||0,t=[t,t]}return t}set textSelection(e){"number"==typeof e?this.select(e,e):this.select(...e)}get hasTextSelection(){const[e,t]=this.textSelection;return e&&t-e>0}getAfterValue(e){const[t,n]=this.textSelection,r=this.input.value;return`${r.substr(0,t)}${e}${r.substr(n||t)}`}select(e,t){const n=this.focusElement;if(n.value.length){if(0===arguments.length)return void this.selectAll();if(!this.supportsTextSelection)return;n.setSelectionRange(e,t)}}moveCaretToEnd(){const e=this.input;if(e.createTextRange){const t=e.createTextRange();t.collapse(!1),t.select()}else this.supportsTextSelection&&this.select(e.value.length,e.value.length)}selectAll(){this.focusElement.select()}syncEmpty(){var e;const{isEmptyInput:t,isEmpty:n,element:r}=this,i=null===(e=this.triggers)||void 0===e?void 0:e.clear,s=t&&n;r&&(i&&i[s?"hide":"show"](),r.classList.toggle("b-empty",s))}updateHint(){this.syncHint()}updateHintHtml(){this.syncHint()}syncHint(){const e=this,{input:t,hint:n,hintHtml:r}=e,i=null==t?void 0:t.parentElement;if(t){let s=r||n;const o=e.hintElement||s&&(e.hintElement=Mr.createElement({parent:i,className:"b-field-hint",nextSibling:t.nextSibling,children:[{className:"b-field-hint-content"}]}));o&&("function"==typeof s&&(s=s({source:e,value:e.value})),o.firstChild[r?"innerHTML":"textContent"]=s||""),e.element.classList[s?"remove":"add"]("b-field-no-hint")}}syncInvalid(){const e=this,{isPainted:t}=e;if(e.updatingInvalid=!0,t){const{isValid:t,element:n,inputWrap:r}=e;if(n.classList[t?"remove":"add"]("b-invalid"),t){const t=e.constructor.getSharedErrorTooltip(e.rootElement,!0);null!=t&&t.isVisible&&t.field===e&&t.hide()}else{const t=e.errorTip;t&&(e.containsFocus||e.isVisible&&r.contains(lu.currentOverElement))&&(t.activeTarget===r&&t.isVisible?t.onBeforeShow():(t.activeTarget=r,t.showBy(r)))}}e.updatingInvalid=!1}updateEditable(){this.syncInputReadOnly()}syncInputReadOnly(){this.getConfig("readOnly"),this.inputReadOnly=this._readOnly||!1===this.editable}updateInputReadOnly(e){const t=this,{input:n,inputListenerRemover:r}=t;n&&(n.readOnly=e?"readOnly":null,e?t.inputListenerRemover=null==r?void 0:r():r||(t.inputListenerRemover=_n.on({element:n,thisObj:t,focus:"internalOnInputFocus",change:"internalOnChange",input:"internalOnInput"})))}changeReadOnly(e){return Boolean(e)}updateReadOnly(e){this.syncInputReadOnly()}updateClearable(e){const t=this;t.getConfig("triggers"),t.triggers={clear:e&&sn.assign({cls:"b-icon-remove",weight:1e3,key:"Shift+backspace",handler(){t._isUserAction=!0,t.clear(...arguments),t._isUserAction=!1}},e)||null}}changeTriggers(e,t){const n=this,r=n.$triggers||(n.$triggers=new Ul({configName:"triggers",factory:fu.Trigger,inferType:!1,owner:n,created(e){$e.after(e,"onConfigChange",((e,{name:t})=>{pu[t]&&n.onConfigChange({name:"triggers",value:r.target})}))},setup(e,t){e.reference=e.ref=t,e.parent=n}}));if(!1===n.stepTriggers&&(e.back||e.forward)&&(delete(e=sn.assign({},e)).back,delete e.forward),r.update(e),n.element&&(n.keyMap=n.keyMap),!t)return r.target}updateInputWidth(e){this.input.style.width=Mr.setLength(e),this.element.classList.add("b-has-width")}updateInputAlign(e){this.input.style.textAlign=e}get isValid(){const e=this;if(!e.disabled){if(e.syncRequired(),e.errors&&Object.keys(e.errors).length)return!1;const t=e.validity;if(t)return t.valid}return!0}get isEmpty(){return null==this.value||""===this.value}get isEmptyInput(){return!this.input||null==this.input.value||""===this.input.value}get validity(){const e=this.input;return null==e?void 0:e.validity}changeValue(e,t){return null==e&&(e=this.nullValue),this.hasChanged(t,e)?e:(""===e&&this.syncRequired(),t)}updateValue(e,t){const n=this;n.isConfiguring||(n.syncRequired(),n.inputting||n.triggerChange()),n.inputting||(n._lastValue=e),n.syncInputFieldValue(),n.overflowTwin&&!n._overflowTwinSync&&(n._overflowTwinSync=!0,n.overflowTwin.value=e,n._overflowTwinSync=!1)}hasChanged(e,t){return t!==e}syncInputFieldValue(e=!1){const t=this,{input:n,parent:r,inputValueAttr:i,inputValue:s}=t;if(n&&!t.inputting&&n[i]!==s&&(n[i]=s,!t.isConfiguring&&!t.containsFocus&&t.highlightExternalChange)){if(n.classList.remove("b-field-updated"),t.clearTimeout("removeUpdatedCls"),r){const{assigningValues:t}=r;!0!==t&&!1!==(null==t?void 0:t.highlight)||(e=!0)}e||t.highlightChanged()}t.syncEmpty(),t.syncInvalid()}highlightChanged(){this.input.classList.add("b-field-updated"),this.setTimeout("removeUpdatedCls",this.updatedClsDuration)}removeUpdatedCls(){this.input.classList.remove("b-field-updated")}get inputValue(){return null==this.value?"":this.value}get inputValueAttr(){return"value"}get supportsTextSelection(){const e=this.focusElement;return e&&("textarea"===e.tagName.toLowerCase()||e.type&&/text|search|password|tel|url/.test(e.type))}internalOnInputFocus(){this.autoSelect&&this.selectAll()}internalOnChange(e){const t=this;t.hasChanged(t._lastValue,t.value)&&t.isValid&&(t.triggerChange(e,!0),t._lastValue=t.value)}triggerChange(e,t=Boolean(this._isUserAction)){const n=this,{value:r,_lastValue:i,isValid:s}=n;n.syncHint(),n.triggerFieldChange({value:r,oldValue:i,event:e,userAction:t,valid:s}),"change"===n.defaultAction&&n.trigger("action",{value:r,oldValue:i,event:e,userAction:t,valid:s})}fetchInputValue(){this.value=this.input[this.inputValueAttr]}internalOnInput(e){var t;const n=this;n.validateOnInput||n.errorTip.hide(),n.inputting=!0,n.fetchInputValue(),n.inputting=!1,n.trigger("input",{value:n.value,event:e}),null===(t=n.changeOnKeyStroke)||void 0===t||t.call(n,e)}get needsInputSync(){var e;return this.input[this.inputValueAttr]!==String(null!==(e=this.inputValue)&&void 0!==e?e:"")}internalOnKeyEvent(e){const t=this,{value:n}=t;let r=!1;if("keydown"===e.type&&"Escape"===e.key&&!t.readOnly&&!t.disabled){const e=t.isValid,i="initialValue"in t?t.initialValue:t.valueOnFocus,s=t.hasChanged(i,n),{needsInputSync:o}=t;t.revertOnEscape&&(!e||s||o)&&(s&&(t.value=i),o&&t.syncInputFieldValue(!0),t.clearError(),r=(s||o)&&t.isValid||e!==t.validOnFocus)}t.isDestroyed||(r&&e.stopImmediatePropagation(),t.trigger(e.type,{event:e}))}clear(e){this.value=this.nullValue,this.trigger("clear",{event:e})}onDisabled(){this.syncInvalid()}syncRequired(){var e;const t=this;t.isConfiguring||t.focusing||!t.required||!t.isEmpty||null!==(e=t.parent)&&void 0!==e&&e.isSettingValues?t.clearError("L{fieldRequired}",t.updatingInvalid):t.setError("L{fieldRequired}",t.updatingInvalid)}setError(e,t,n){const r=this;if((r.errors||(r.errors={}))[r.optionalL(e)]=1,t||r.syncInvalid(),n){const t=()=>{r.clearError(e),n()},n=r.on({keydown:t,focusOut:t})}}clearError(e,t){const n=this;n.errors&&(e?delete this.errors[this.optionalL(e)]:n.errors={}),t||n.syncInvalid()}getErrors(){const e=this;if(!e.isValid){var t;const n=e.validity,r=sn.keys(n).find((e=>"valid"!==e&&"customError"!==e&&n[e])),i=e.errors&&Object.keys(e.errors);let s;if(s=null!=i&&i.length?i:n.customError?[e.input.validationMessage]:r?[e.L(r,{min:e.min,max:e.max})]:[e.L(e.invalidValueError)],(null===(t=s)||void 0===t?void 0:t.length)>0)return s}}createOverflowTwin(e){const t=this,n=super.createOverflowTwin(e);return n.on({change({value:e}){t._overflowTwinSync=!0,t.value=e,t._overflowTwinSync=!1}}),n}get containerCollapsed(){var e;return null===(e=this.container)||void 0===e?void 0:e.collapsed}set containerCollapsed(e){const{container:t}=this;t&&(t.collapsed=e)}afterSyncChildConfigs(e){}changeContainer(e,t){e&&(Array.isArray(e)||!("type"in e)&&!("items"in e))&&(e={items:e});const n=this,r=e&&sn.merge({owner:n,layout:"box"},n.containerDefaults),i=Ka.reconfigure(t,e,{owner:n,defaults:r});if(!i||(i.autoLayout="box"===(null==r?void 0:r.layout),i!==t))return i;i.syncContainer()}onConfigChange(e){var t,n;super.onConfigChange(e),null!==(t=this.container)&&void 0!==t&&null!==(n=t.syncConfigTriggers)&&void 0!==n&&n[e.name]&&this.container.syncChildConfigs()}assignValue(e,t){const{container:n,containValues:r}=this,i=this.getValueName(t);n&&!1!==r?e&&"nested"===r?e&&i in e&&(e=sn.clone(e[i]),super.assignValue({[i]:e&&!("value"in e)||e.value},t),e&&delete e.value,n.assignValue(e,t)):(super.assignValue(e,t),n.assignValue(e,t)):super.assignValue(e,t)}gatherValue(e){super.gatherValue(e),this.gatherValues(e)}gatherValues(e,t){var n;const r=this,{container:i,containValues:s,valueName:o}=r,a=typeof s;t=null!==(n=t)&&void 0!==n?n:o in e,i&&!1!==s&&("nested"===s?t&&(e[o]=f({value:e[o]},i.values)):(!0===s||null==s&&t||"string"===a&&r[s]||"function"===a&&s(r))&&i.gatherValues(e))}updateContainer(e,t){t&&this.detachListeners(t.id),e&&(e.rendered||e.render(),e.syncContainer(),e.syncChildConfigs())}}fu.Trigger=class extends Ka{static get $name(){return"FieldTrigger"}static get factoryable(){return{defaultType:fu.Trigger,extends:null}}static get type(){return"trigger"}static get configurable(){return{align:null,weight:null,role:void 0}}get field(){return this.parent}construct(){super.construct(...arguments),this.key&&(this.keyMap={[this.key]:"onClick"})}compose(){return{"aria-hidden":!0,class:{[`b-align-${this.align||"end"}`]:1,"b-icon":1},listeners:{click:"onClick",mousedown:"onMousedown"}}}changeAlign(e){return e}onClick(e){const t=this,{field:n}=t;n.disabled||n.readOnly||(e.key&&e.preventDefault(),!1!==n.trigger("trigger",{trigger:t})&&t.handler&&n.callback(t.handler,n,[e,t]))}onMousedown(e){const t=this.field;!("key"in e)&&Mr.isTouchEvent&&t.editable&&(t.editable=!1,t.setTimeout((()=>t.editable=!0),500)),e.preventDefault(),Mr.getActiveElement(t.input)!==t.input&&t.focus()}},fu.SpinTrigger=class extends fu.Trigger{static get $name(){return"SpinTrigger"}static get type(){return"spintrigger"}static get configurable(){return{repeat:{$config:["nullify"],value:!0}}}compose(){return{children:{upButton:{class:{"b-icon":1,"b-spin-up":1}},downButton:{class:{"b-icon":1,"b-spin-down":1}}}}}updateRepeat(e){var t;null===(t=this.clickRepeater)||void 0===t||t.destroy(),this.clickRepeater=e?Cl.new({element:this.element},e):null}onClick(e){const t=this,{field:n}=t;n.disabled||n.readOnly||(e.target===t.upButton?n.doSpinUp(e.shiftKey):e.target===t.downButton&&n.doSpinDown(e.shiftKey))}},fu.Trigger.initClass(),fu.SpinTrigger.initClass(),Ka.register(fu.Trigger,"trigger"),Ka.register(fu.SpinTrigger,"spintrigger"),fu._$name="Field";class vu extends fu{static get type(){return"textfield"}static get alias(){return"text"}static get configurable(){return{nullValue:""}}static get $name(){return"TextField"}construct(e){"hidden"===(null==e?void 0:e.inputType)&&(e.hidden=!0),super.construct(...arguments)}}vu.initClass(),vu._$name="TextField";class yu extends vu{static get $name(){return"PickerField"}static get type(){return"pickerfield"}static get configurable(){return{editable:!0,pickerAlignElement:"inputWrap",value:null,triggers:{expand:{cls:"bars"}},autoClose:!0,autoExpand:null,picker:{value:{floating:!0},$config:["lazy","nullify"]},inputType:"text",monitorResize:!0,nullValue:null}}doDestroy(){var e;null===(e=this.globalTapListener)||void 0===e||e.call(this),super.doDestroy()}updateEditable(e){const t=this,{element:n,ariaElement:r}=t;var i;super.updateEditable(...arguments),!1===e?(r.removeAttribute("aria-autocomplete"),null===(i=t.globalTapListener)||void 0===i||i.call(t),n.classList.add("b-not-editable"),_n.on({element:t.nonEditableClickTarget,click:e=>{e.target===t.nonEditableClickTarget&&t.onTriggerClick(e)},thisObj:t})):(r.setAttribute("aria-autocomplete","list"),t.globalTapListener=zr.on({globaltap:"showKeyboard",thisObj:t}))}get nonEditableClickTarget(){return this.input}updateElement(e,t){var n;const r=super.updateElement(e,t),i=this.peekConfig("picker"),s=!!i&&(i.isWidget?i.role:null===(n=this.constructor.resolveType(i.type))||void 0===n?void 0:n.$meta.config.role);return this.ariaHasPopup=s,r}changePicker(e,t){throw new Error("changePicker(oldPicker, newPicker) must be implemented in PickerField subclass implementations")}get childItems(){const e=super.childItems;return this._picker&&e.push(this.picker),e}onEditComplete(){super.onEditComplete(),this.autoClosePicker()}onElementResize(e){const t=this;t.pickerVisible&&t.picker.requestAnimationFrame(t.picker.realign,null,t.picker),super.onElementResize(e)}internalOnKeyEvent(e){const t=this;let n=!0;if("keydown"===e.type&&!t.disabled&&!e.shiftKey&&!e.ctrlKey)if(t.pickerVisible){const{picker:r}=t;"Escape"===e.key?(e.preventDefault(),e.stopImmediatePropagation(),t.hidePicker(),n=!1):r.onInternalKeyDown?r.onInternalKeyDown(e):"ArrowDown"===e.key&&r.focusable&&r.focus()}else"ArrowDown"===e.key&&(e.stopImmediatePropagation(),e.preventDefault(),t.onTriggerClick(e));n&&super.internalOnKeyEvent(e)}onFocusIn(e){const t=this;super.onFocusIn(e),t.autoExpand&&(t.minChars=0,t.onTriggerClick(e),t.ignoreTriggerClick=!0,t.setTimeout((()=>t.ignoreTriggerClick=!1),100))}onTriggerClick(e){this.disabled||this.togglePicker("key"in e)}showKeyboard({event:e}){const t=this.input;Mr.isTouchEvent&&Mr.getActiveElement(t)===t&&e.target===t&&(zr.suspendFocusEvents(),t.blur(),t.focus(),zr.resumeFocusEvents())}togglePicker(e){this.pickerVisible?this.hidePicker():this.showPicker(e)}showPicker(e){const t=this,{picker:n}=t;t.pickerHideShowListenersAdded||(n.on({show:"onPickerShow",hide:"onPickerHide",thisObj:t}),t.pickerHideShowListenersAdded=!0),Mr.setAttributes(t.ariaElement,{"aria-controls":n.id,"aria-expanded":!0}),n.autoClose=t.autoClose,n.show(),n.isVisible&&e&&t.focusPicker()}onPickerShow(){const e=this;e.pickerVisible=!0,e.element.classList.add("b-open"),e.trigger("togglePicker",{show:!0}),e.pickerTapOutRemover=zr.on({globaltap:"onPickerTapOut",thisObj:e}),e.pickerKeyDownRemover=_n.on({element:e.picker.element,keydown:"onPickerKeyDown",thisObj:e})}onPickerHide(){var e,t;const n=this;n.ariaElement.setAttribute("aria-expanded",!1),n.pickerVisible=!1,n.element.classList.remove("b-open"),n.trigger("togglePicker",{show:!1}),null===(e=n.pickerTapOutRemover)||void 0===e||e.call(n),null===(t=n.pickerKeyDownRemover)||void 0===t||t.call(n)}onPickerTapOut({event:e}){this.containsFocus||this.owns(e.target)||this.autoClosePicker()}onPickerKeyDown(e){if("Tab"===e.key&&!this.picker.trapFocus){const t=Mr.getActiveElement(this.input),n=new KeyboardEvent("keydown",e);this.input.dispatchEvent(n),n.defaultPrevented&&e.preventDefault(),Mr.getActiveElement(this.input)===t?this.input.focus():e.preventDefault(),this.isDestroyed||this.hidePicker()}}autoClosePicker(){this.autoClose&&this.hidePicker()}hidePicker(){this.pickerVisible&&this.picker.hide()}focusPicker(){}focus(){const e=this.input;Mr.isTouchEvent&&this.editable&&(e.readOnly=!0,this.setTimeout((()=>e.readOnly=!1),500)),super.focus()}}yu._$name="PickerField";const bu=document.createRange();class Cu extends Ka{static get $name(){return"List"}static get type(){return"list"}static get configurable(){return{itemCls:"b-list-item",selectedCls:"b-selected",selectIconCls:"b-icon-check",tag:"ul",items:null,displayField:"text",store:null,navigator:!0,scrollable:{overflowX:!1,overflowY:!0},itemsFocusable:!0,multiSelect:!1,toggleAllIfCtrlPressed:!1,selectAllItem:!1,itemTpl(e){let t=_.encodeHtml(e[this.displayField]);return null!=t&&""!==t||(t="&nbsp;"),t},getItemStyle:null,getItemCls:null,groupHeaderTpl:(e,t)=>{let n=_.encodeHtml(t);return null!=n&&""!==n||(n="&nbsp;"),n},allowGroupSelect:!0,selected:{$config:"nullify",value:{}},activateOnMouseover:null,role:"listbox",keyMap:{"Ctrl+a":"selectAll"}}}construct(e,...t){var n;const r=this;Array.isArray(e)&&(e={items:e}),super.construct(e,...t);const{element:i}=r,{classList:s}=i;r.multiSelect&&s.add("b-multiselect"),null!==(n=r.store)&&void 0!==n&&n.count?r.refresh():s.add("b-empty"),_n.on({element:i,delegate:r.itemSelector,mouseover:"onMouseOver",click:"onClick",thisObj:r})}doDestroy(){var e;this.detachListeners("store"),null===(e=this.navigator)||void 0===e||e.destroy(),super.doDestroy()}onFocusIn(e){var t;this.restoreActiveItem(null===(t=e._target)||void 0===t?void 0:t.closest(this.itemSelector)),super.onFocusIn(e)}contentTpl(){const e=this,t=e.store.records.map(((t,n)=>e.itemWrapperTpl(t,n)));return e.multiSelect&&!1!==e.selectAllItem&&t.unshift(e.selectAllItemTpl()),Yc.tpl`${t}`}itemWrapperTpl(e,t){const{selected:n,getItemStyle:r}=this,i=r?`style="${this.callback(r,this,[e])}"`:"";return Yc.tpl`<li ${i} class="${this.getItemClasses(e,t)}" role="option" aria-selected="${n.includes(e)}" data-index="${t}" data-id="${_.encodeHtml(e.id)}" ${this.itemsFocusable?'tabindex="-1"':""}>${this.itemContentTpl(e,t)}</li>`}itemContentTpl(e,t){return"groupRowFor"in e.meta?this.groupHeaderTpl(e,_.capitalize(e.groupChildren[0][e.meta.groupField])):`${this.itemIconTpl(e,t)}${this.itemTpl(e,t)}`}itemIconTpl(e,t){return this.multiSelect?`<i class="b-selected-icon b-icon ${this.selectIconCls}"></i>`:""}selectAllItemTpl(){const e=this.allSelected?"b-selected":"";return`<li class="${this.itemCls} b-select-all-item ${e}" data-noselect data-select-all data-id="select-all">${this.itemIconTpl({})}<div>${this.optionalL("Select All")}</div></li>`}getItemClasses(e){var t;const n=this,{getItemCls:r}=n,i=null===(t=n._navigator)||void 0===t?void 0:t.activeItem,s=(null==i?void 0:i.dataset.id)==e.id,o="groupRowFor"in e.meta?"b-list-item-group-header":"",a=n.selected.includes(e),l=r?this.callback(r,this,[e]):"";return`${n.itemCls} ${e.cls||""} ${l} ${a?n.selectedCls:""} ${s?n.navigator.focusCls:""} ${o}`}onBeforeStoreLoad(){this.mask(this.L("L{loading}"))}onAfterStoreRequest(){this.unmask()}onStoreChange({source:e,action:t,records:n,record:r,changes:i}){const s=this,{selected:o,_externallyOwnedSelection:a}=s;switch(t){case"dataset":{const t=[];let n=!0;return o.forEach((r=>{const i=e.getById(r.id);i&&(n=!1,i!==r&&t.push(i))})),void(t.length?o.replaceValues({values:t,silent:a}):n&&!a&&o.clear())}case"remove":o.remove(n);break;case"clear":s.deselectAll();break;case"update":{const{id:e}=i;return e&&Mr.setAttributes(s.contentElement.querySelector(_.encodeAttributeSelector("data-id",e.oldValue)),{"data-id":e.value}),void s.refreshItem(r)}}s.refresh()}onStoreRefresh(){this.refresh()}refresh(){const e=this;if(e.isVisible){var t;const n=null===(t=e.navigator)||void 0===t?void 0:t.activeItem;e.paintListener=null;const r=Mr.createElementFromTemplate(e.contentTpl(),{fragment:!0});e.clearItems().insertNode(r),n&&e.restoreActiveItem(n),e.refreshCount=(e.refreshCount||0)+1,e.element.classList[e.store.count>0?"remove":"add"]("b-empty"),e.updateSelectAllState()}else e.paintListener||(e.paintListener=e.on({paint:"refresh",thisObj:e,once:!0}))}clearItems(){const e=this,t=e.contentElement.querySelector(e.itemSelector),n=e.contentElement.lastChild;if(t){const n=e.contentElement.querySelectorAll(`${e.itemSelector}:not(.b-mask)`);bu.setStartBefore(t),bu.setEndAfter(n[n.length-1]),bu.deleteContents()}else n?(bu.setStartAfter(n),bu.setEndAfter(n)):(bu.setStart(e.contentElement,0),bu.setEnd(e.contentElement,0));return bu}refreshItem(...e){for(const t of e){const e=this.getItem(t);if(e){const n=this.store.indexOf(t),r=Mr.createElementFromTemplate(this.itemWrapperTpl(t,n));Mr.sync(r,e)}}}getItem(e){var t;if(null!=e)return"number"==typeof e?this.contentElement.querySelector(`[data-index="${e<0?this.store.count+e:e}"]`):(e.nodeType===Element.ELEMENT_NODE&&(e=e.dataset.id),null!=(null===(t=e)||void 0===t?void 0:t.id)&&(e=e.id),this.contentElement.querySelector(_.encodeAttributeSelector("data-id",e)))}getRecordFromElement(e){return e.target&&(e=e.target),e=e.closest(this.itemSelector),this.store.getAt(parseInt(e.dataset.index))}updateItems(e){const t=this;t.store&&t.store.autoCreated&&t.store.destroy(),t.store=As.getStore(e)}updateDisabled(e){super.updateDisabled(...arguments),this.navigator&&(this.navigator.disabled=e)}changeSelected(e,t){if(e){let t;e.isCollection?this._externallyOwnedSelection=!0:(Array.isArray(e)?(t=e,e={}):e.values&&(t=e.values,e=f(f({},e),{},{values:[]})),e=new rs(e)),e.on({change:"onSelectionChange",thisObj:this}),this.initialSelection=t}else null==t||t.destroy();return e}get itemSelector(){return`.${this.itemCls}`}get selected(){return this._selected}get store(){return this.getConfig("items"),this._store}changeStore(e){const t=this;if(e instanceof As||(Array.isArray(e)&&(e={data:e}),e=new As(e)),t.detachListeners("store"),e){const n={name:"store",change:"onStoreChange",refresh:"onStoreRefresh",thisObj:t};e.readUrl&&(n.beforeLoad="onBeforeStoreLoad",n.afterRequest="onAfterStoreRequest"),e.isGrouped&&(t.element.classList.add("b-grouped"),n.groupchange="onStoreRefresh"),e.on(n)}return e}updateStore(e){const{initialSelection:t}=this;null!=t&&t.length&&(e.count?this.select(t):e.on({refresh:()=>this.select(t),once:!0})),this.refresh()}changeNavigator(e,t){const n=this,{element:r}=n;var i;return r&&((null===(i=e=id.reconfigure(t,e?id.mergeConfigs({ownerCmp:n,disabled:n.disabled,target:r,keyEventTarget:r},e):null,n))||void 0===i?void 0:i.keyEventTarget)!==r||n.itemsTabbable||(r.tabIndex=0)),e}get minAlignHeight(){const e=this.element.lastElementChild,t=this.minHeight;if(null!=t)return e?Math.min(e.offsetTop+e.offsetHeight,t):0}alignTo(...e){super.minHeight=this.minAlignHeight,super.alignTo(...e)}hide(...e){return this.navigator&&(this.navigator.activeItem=null),super.hide(...e)}show(){const{refreshCount:e}=this,{previousActiveItem:t}=this.navigator;super.minHeight=this._minHeight;const n=super.show(...arguments);return this.refreshCount===e&&this.restoreActiveItem(t,!0),n}restoreActiveItem(e=this.navigator.previousActiveItem,t="nearest"){const n=this,{navigator:r,lastAlignSpec:i}=n;if(null!=e){if("string"!=typeof t){const e=i?i.zone:1;t=1&e?"nearest":e?"start":"end"}(e=n.getItem(e))&&!n.disabled&&(n.scrollable.scrollIntoView(e,{block:t}),r.activeItem=e)}}onMouseOver(e){const t=this,n=e.currentTarget;!Mr.isTouchEvent&&n&&t.navigator&&t.activateOnMouseover&&t.setTimeout({fn:"handleMouseOver",delay:30,args:[n],cancelOutstanding:!0})}handleMouseOver(e){this.navigator.activeItem=e}onClick(e){const t=e.target.closest(this.itemSelector);t&&this.onItemClick(t,e)}onInternalKeyDown(e){const t=this.navigator.activeItem;if(!this.disabled)switch(e.key){case" ":if("INPUT"===e.target.nodeName.toUpperCase()&&!e.target.readOnly)break;case"Enter":t&&(this.onItemClick(t,e),e.stopImmediatePropagation(),e.preventDefault())}}onItemClick(e,t){const n=this,r=parseInt(e.dataset.index);let i=n.store.getAt(r);if(!n.disabled&&!1!==n.trigger("beforeItem",{item:e,record:i,index:r,event:t,userAction:!0})){if(n._isUserAction=!0,n.allowGroupSelect||i&&!i.isSpecialRow)if(e.contains(t.target.closest("[data-noselect]")))e.contains(t.target.closest("[data-select-all]"))&&n.onSelectAllClick(e,t);else{const e=n.selected;let r=e.includes(i);n.multiSelect?(n.toggleAllIfCtrlPressed&&t.ctrlKey?i=n.store.records:n.allowGroupSelect&&i.isSpecialRow&&(r=!i.groupChildren.some((t=>!e.includes(t))),i=i.groupChildren),e[r?"remove":"add"](i)):e.splice(0,e.count,i)}n.lastClicked=i,n.trigger("item",{item:e,record:i,index:r,event:t,userAction:!0}),n._isUserAction=!1}}onSelectionChange({action:e,removed:t,added:n,replaced:r}){const i=this,{selectedCls:s,unselectedCls:o}=i;let a,l;if("clear"===e)for(l of i.element.querySelectorAll(`.${s}`))l.classList.remove(s),l.setAttribute("aria-selected",!1),o&&l.classList.remove(o);else if("replaceValues"!==e){for(a of t)l=i.getItem(a),l&&(l.classList.remove(s),l.setAttribute("aria-selected",!1));for(a of n)l=i.getItem(a),l&&(l.classList.add(s),l.setAttribute("aria-selected",!0))}i.selectAllItem&&i.updateSelectAllState()}onSelectAllClick(e){e.classList.contains(this.selectedCls)?this.deselectAll():this.selectAll()}updateSelectAllState(){var e;null===(e=this.element.querySelector(".b-select-all-item"))||void 0===e||e.classList.toggle(this.selectedCls,this.allSelected)}get allSelected(){const{selected:e,store:t}=this;return e.count&&(t.isFiltered?t.records.every((t=>e.includes(t))):t.count===e.count)}selectAll(e){const t=this;!t.multiSelect&&e||(t.selected.add(t.store.records),e&&!t.navigator.activeItem&&(t.navigator.activeItem=t.getItem(-1)))}deselectAll(){this.selected.clear()}select(e){const{store:t}=this,{modelClass:n}=t;e=ke.asArray(e).reduce(((e,r)=>((r=t.getById(n.asId(r)))&&e.push(r),e)),[]),this.selected.add(e)}deselect(e){const{modelClass:t}=this.store;e=ke.asArray(e).reduce(((e,n)=>((n=this.selected.get(t.asId(n)))&&e.push(n),e)),[]),this.selected.remove(e)}}Cu.initClass(),Cu.prototype.navigatorClass=id,Cu._$name="List";class wu extends Cu{static get $name(){return"ChipView"}static get type(){return"chipview"}static get configurable(){return{itemCls:"b-chip",multiSelect:!1,closable:!0,iconTpl:null,closeHandler:null}}itemContentTpl(e,t){const n=this;return Yc.tpl`${n.iconTpl?this.iconTpl(e):""}
            ${n.itemTpl(e,t)}
            ${n.closable?'<div class="b-icon b-close-icon b-icon-clear" data-noselect></div>':""}`}onInternalKeyDown(e){const t=this;t.closable&&t.selected.count&&("Delete"===e.key||"Backspace"===e.key)?t.callback(t.closeHandler,t.owner,[t.selected.values,{isKeyEvent:!0}]):super.onInternalKeyDown(e)}updateClosable(e){this.element.classList[e?"add":"remove"]("b-chips-closable"),this.navigator&&(this.navigator.disabled=!e),this.isConfiguring||this.refresh()}onClick(e){const t=this,n=e.target.closest(`.${t.itemCls}`);if(t.closable&&e.target.classList.contains("b-close-icon")){const e=t.store.getAt(parseInt(n.dataset.index));t.callback(t.closeHandler,t.owner,[[e]])}else super.onClick(e)}}wu.initClass(),wu._$name="ChipView";const Su="L{Field.fieldRequired}",Du="L{Field.validateFilter}";class Eu extends yu{static get $name(){return"Combo"}static get type(){return"combo"}static get alias(){return"combobox,dropdown"}static get configurable(){return{primaryFilter:{},picker:{type:"list",floating:!0,scrollAction:"realign",itemsFocusable:!1,activateOnMouseover:!0,align:{align:"t0-b0",axisLock:!0},maxHeight:324,scrollable:{overflowY:!0},autoShow:!1,focusOnHover:!1},multiSelect:null,items:null,store:null,valueField:void 0,displayField:"text",pickerWidth:null,minChars:null,selected:null,listItemTpl:null,displayValueRenderer:null,listCls:null,triggers:{expand:{cls:"b-icon-picker",handler:"onTriggerClick"}},filterParamName:null,encodeFilterParams:e=>e.map((e=>e.value)),filterOnEnter:!1,hideTrigger:null,overlayAnchor:null,keyStrokeFilterDelay:null,defaultAction:"select",triggerAction:"all",filterOperator:"startsWith",caseSensitive:!1,hidePickerOnSelect:null,chipView:{$config:["lazy","nullify"],value:{type:"combochipview"}},chipStore:{$config:["lazy","nullify"],value:{}},filterSelected:null,emptyText:null,value:null,valueCollection:{$config:["nullify","lazy"],value:{}},validateFilter:!0,clearTextOnPickerHide:!0,destroyStore:!1,multiValueSeparator:",",createOnUnmatched:null,role:"combobox",inlinePicker:null,testConfig:{keyStrokeFilterDelay:0},localizeDisplayFields:!1,buildItems:null}}static get queryLast(){return"last"}construct(e){super.construct(...arguments),this.store||(this.items=[]),this.filterOnEnter&&(this.hideTrigger=!0)}startConfigure(e){this.usingRecordAsValue=null===e.valueField,super.startConfigure(...arguments)}afterConfigure(){super.afterConfigure();const e=this;sn.hasOwn(e,"_value")||(e._value=e.valueField===e.displayField?"":null,e._lastValue=e._lastValue||e._value)}get childItems(){const{_chipView:e,_picker:t}=this,n=super.childItems;return e&&n.push(e),t&&n.push(t),n}get innerElements(){var e;const t=null===(e=this._chipView)||void 0===e?void 0:e.element,{input:n,inputElement:r}=this;return t&&oa.sync({targetElement:n,domConfig:r}),[t||r]}updateInlinePicker(e){e&&(this.element.classList.add("b-inline-picker"),this.getConfig("picker"),this.triggers.expand=null,this.pickerVisible=!0)}hidePicker(){if(!this.inlinePicker)return super.hidePicker(...arguments)}changeChipStore(e){return!e||e instanceof As||(e=new As(As.mergeConfigs({storage:this.valueCollection},e))),e}updateChipStore(e,t){null==t||t.destroy()}changeChipView(e,t){const n=this;if(n.element.classList[e?"add":"remove"]("b-uses-chipview"),e){const{input:r}=n;return n.chipStore||(n.chipStore={}),xu.reconfigure(t,e,{defaults:{parent:n,insertBefore:r,store:n.chipStore,closable:!n.readOnly,navigator:{type:"combochipnavigator",keyEventTarget:r}}})}null==t||t.destroy()}updateChipView(e){var t;const n=this;n._chipViewEventDetacher=null===(t=n._chipViewEventDetacher)||void 0===t?void 0:t.call(n),n.chipStore=null==e?void 0:e.store,e&&(e.element.appendChild(n.input),n._chipViewEventDetacher=_n.on({element:e.element,mousedown:"onChipViewMousedown",thisObj:n}))}updateMultiSelect(e,t){const n=this,{input:r,element:i}=n,s=!n.isConfiguring;let{value:o}=n;if(i.classList[e?"add":"remove"]("b-multiselect"),e){const{chipView:e}=n,{parentNode:t}=r,i=null==e?void 0:e.element;i&&i!==t&&(t.insertBefore(i,r),i.appendChild(r),n.chipView.refresh()),r.value="",s&&(o=ke.asArray(o))}else{const e=n._chipView,{parentNode:t}=r,l=null==e?void 0:e.element;var a;l===t&&(l.parentNode.insertBefore(r,l),l.remove(),i.classList.remove("b-uses-chipview")),s&&"string"!=typeof o&&(o=null!==(a=o)&&void 0!==a&&a.length?o[0]:null)}s&&(n.value=o)}onChipViewMousedown(e){e.preventDefault(),this.containsFocus||this.focus()}onChipClose(e,t={}){(t.isKeyEvent&&""===this.input.value||!t.isKeyEvent)&&(this._isUserAction=!0,this.valueCollection.remove(e),this._isUserAction=!1)}updateFilterParamName(e){!1!==this.hideTrigger&&(this.hideTrigger=Boolean(e))}updateHideTrigger(e){this.element.classList[e?"add":"remove"]("b-hide-trigger")}updateKeyStrokeFilterDelay(e){const t=this;e&&(t.filterOnInput=t.buffer(t.filterOnInput,e))}updateReadOnly(e){super.updateReadOnly(...arguments),this._chipView&&(this._chipView.closable=!e)}updateDisabled(e){super.updateDisabled(...arguments),this._chipView&&(this._chipView.closable=!e)}updateFilterOperator(e){this.primaryFilter&&(this.primaryFilter.operator=e)}get minChars(){const e=this._minChars;return null!=e?e:this.remoteFilter?4:1}get validateFilter(){return this._validateFilter&&!this.createOnUnmatched}get items(){return this.store.allRecords}updateBuildItems(e){e&&(this.items=e.call(this))}changeItems(e){var t;const n=this;if(null==e){if(n.store&&!n.store.isItemStore)return;e=[]}if(!n.buildItems||null!==(t=e)&&void 0!==t&&t.length||(e=n.buildItems()),e instanceof As)return void(n.store=e);const r=n.displayField;let i,s,o=n.valueField;if(Array.isArray(e)?s=e.map((e=>{let t=e;return e instanceof Hi?(i=e.constructor,o||(n.valueField=o=i.idField)):"string"==typeof e||"number"==typeof e?(o||(n.valueField=o=n.displayField),t={[o]:e,[r]:e}):(o||(n.valueField=o="value"),Array.isArray(e)&&(t={[o]:e[0],[r]:e[1]})),e.selected&&(n.value=t),t})):(o||(n.valueField=o="value"),s=[],Object.entries(e).forEach((([e,t])=>{s.push({[o]:e,[r]:t})}))),n.store)n.store.data=s;else{const e=o===r?{name:"value",dataSource:r}:o;n.store=new As({isItemStore:!0,data:s,idField:o,verifyNoGeneratedIds:!1,modelClass:i||class extends Hi{static get idField(){return n.valueField}static set idField(e){super.idField=e}static get fields(){return[e,r]}}})}}get value(){const e=this,{valueCollection:t,valueField:n}=e;if(null==n)return e.multiSelect?t.values.slice():t.first;let r;return r=e.multiSelect?t.count?t.map((e=>e[n])):e._lastValue||[]:t.count?t.first[n]:e._lastValue,r}set value(e){super.value=e}get needsInputSync(){return!this.usesChipView&&!this.editable}changeValue(e,t){var n;const r=this;if(e===t)return void r.syncInputFieldValue(!0);if(!r.multiSelect&&Array.isArray(e)&&e.length>1)throw new Error("Multiple values cannot be set to a non-multiSelect Combo");var i;r.triggerConfig("items"),r.inputting||null===(i=r._chipView)||void 0===i||i.selected.clear(),r.store||(r.items=[]);const{valueField:s,displayField:o,store:a,valueCollection:l,_picker:c}=r,{storage:d}=a,u=null!==(n=r.hidePickerOnSelect)&&void 0!==n?n:!r.multiSelect,h=r._isUserAction||(null==c?void 0:c._isUserAction)||u&&r.pickerVisible||!1;if(!r.remoteFilter&&a.isAjaxStore&&!a.count)return a.on("load",(()=>r.value=e),{once:!0,thisObj:r}),void(r._lastValue=e);if(r.remoteFilter){if(null!=e){if(sn.isObject(e)||e.isModel)this.store.data=[e],this.valueCollection.splice(0,this.valueCollection.count,this.store.first);else{const t=r.isConfiguring;r.primaryFilter.setConfig({value:e,disabled:!1}),a.performFilter(!0).then((()=>{const{isConfiguring:e}=r;r.isConfiguring=t,l.splice(0,l.count,a.allRecords),r.isConfiguring=e}))}return}}else a.filtered&&(r.primaryFilter.disabled=!0,a.filter());let g;if(null!=e){const n=Array.isArray(e),i=n?e.slice():[e];for(let e=0,t=i.length;e<t;e++){let n=i[e];if(n instanceof Hi)d.includes(n,!0)||a.add(n);else{const r=sn.isObject(n);r&&(n=n[s]),g=d.getBy(o,n)||d.getBy(s,n)||l.getBy(o,n)||l.getBy(s,n),g instanceof Set&&(g=[...g][0]),g?(r&&g.set(i[e]),i[e]=g):(i.splice(e,1),t--,e--)}}const c=!i.length,u=l.generation;l.splice(0,l.count,i),c&&(r._value=n&&0===e.length?null:e,r._lastValue=r._value),(c||l.generation===u)&&r.syncInputFieldValue(),r.syncEmpty(),c&&!r.isConfiguring&&r.triggerFieldChange({value:e,oldValue:t,userAction:h,valid:r.isValid})}else if(l.count)l.clear();else{const t=r._value;r._value=null,r.syncInputFieldValue(),r.syncEmpty(),r.isConfiguring||r.triggerFieldChange({value:e,oldValue:t,userAction:h,valid:r.isValid})}r._lastValue=r._value}hasChanged(e,t){return this.multiSelect?!sn.isEqual(e,t):super.hasChanged(...arguments)}onComboStoreChange({action:e}){"filter"!==e&&this.syncInputFieldValue(!0)}syncInputFieldValue(e){this.usesChipView||super.syncInputFieldValue(e)}get usesChipView(){return Boolean(this.multiSelect&&this._chipView)}get isEmpty(){return 0===this.valueCollection.count}get inputValue(){const e=this;let t=e.selected?e.selected[e.displayField]:e.value;return e.displayValueRenderer&&(t=e.callback(e.displayValueRenderer,e,[e.selected,e])),null==t?"":t}get nonEditableClickTarget(){var e;return this.multiSelect&&(null===(e=this.chipView)||void 0===e?void 0:e.element)||super.nonEditableClickTarget}changeValueCollection(e,t){if(null==t||t.destroy(),e)return e.isCollection||(e=new rs({listeners:{noChange:"onValueCollectionNoChange",change:"onValueCollectionChange",prio:-1e3,thisObj:this}})),e}changePrimaryFilter(e){return e instanceof Wi||("function"==typeof e&&(e={filterBy:e}),e=new Wi(f({id:"primary",disabled:!0,property:this.displayField,operator:this.filterOperator,caseSensitive:this.caseSensitive},e))),e}changeStore(e){const t=this;if(!Array.isArray(e)){if(e){"string"==typeof e?e=As.getStore(e):sn.isObject(e)&&(e=new(e.readUrl?Ls:As)(e),t.destroyStore=!0);const n=t.remoteFilter||e.restfulFilter,{filterParamName:r,valueCollection:i,keyStrokeFilterDelay:s}=t,o=[];n&&r&&(e.filterParamName=r,t.encodeFilterParams&&(e.encodeFilterParams=t.encodeFilterParams)),t.valueField||t.usingRecordAsValue||(t.valueField=e.modelClass.idField),o.push(t.primaryFilter),n?t.filterSelected&&(e.storage.autoFilter=!0,e.storage.addFilter({id:`${t.id}-selected-filter`,filterBy:e=>!i.includes(e)})):t.filterSelected&&(t.selectedItemsFilter=e=>!i.includes(e),o.push(t.selectedItemsFilter),e.reapplyFilterOnAdd=!0),i.addIndex({property:t.displayField,unique:!1}),i.addIndex({property:t.valueField,unique:!0}),o.forEach((t=>e.addFilter(t,!0))),t.keyStrokeFilterDelay=n?Math.max(300,s||0):null!=s?s:10}return e}t.items=e}updateStore(e,t){const n=this,{_picker:r}=n;let i;if(this.destroyStore&&t&&t.destroy(),r&&(r.store=e),e.storage.addIndex({property:n.displayField,unique:!1}),e.storage.addIndex({property:n.valueField,unique:!0}),i={filter:"onStoreFilter"},n.displayValueRenderer&&((i||(i={})).change="onComboStoreChange",n.syncInputFieldValue()),n.detachListeners("store"),t){const e=n.value;n.isConfiguring=!0,n.value=null,n.isConfiguring=!1,n.value=e}i&&(i.name="store",i.thisObj=n,e.on(i))}get remoteFilter(){var e;return Boolean(this.filterParamName||(null===(e=this._store)||void 0===e?void 0:e.restfulFilter))}get record(){return this.selected}get records(){return this.valueCollection.values.slice()}get selected(){const{store:e}=this;return this.multiSelect?this.valueCollection.values.slice().sort(((t,n)=>e.indexOf(t)-e.indexOf(n)))[0]:this.valueCollection.first}onEditComplete(){const e=this,t=e.valueCollection.count;super.onEditComplete(),t&&(e.clearError(Du),e.syncInputFieldValue()),e.required&&!t&&e.setError(Su)}onTriggerClick(e){var t;const n=this,r="key"in e;if(!(n.ignoreTriggerClick||n.remoteFilter&&n.filterOnEnter))if(n.pickerVisible)n.hidePicker();else if(!n.readOnly&&!n.disabled)switch(null===(t=n.triggerAction)||void 0===t?void 0:t.toLowerCase()){case"all":n.doFilter(null,r);break;case"last":n.doFilter(n.lastQuery,r);break;default:n.doFilter(n.input.value,r)}}internalOnInput(e){const t=this;t.syncEmpty(),t.syncInputWidth(),t.filterOnInput(e),t.trigger("input",{value:t.input.value,event:e})}filterOnInput(e){const t=this,n=e.target.value,r=n.length;t.inputting=!0,t.inlinePicker||r>=t.minChars&&(!t.filterOnEnter||"Enter"===e.key)?t.doFilter(n):(t.validateFilter&&!t.remoteFilter&&t[r?"setError":"clearError"](Du),t.hidePicker()),t.inputting=!1}syncInputWidth(){const e=this;if(e.usesChipView){const t=e.input,n=e._inputPadding||(e._inputPadding=Mr.getEdgeSize(t,"padding","lr")),r=t.value||"",i=Mr.measureText(r+"W",t,!1,e.element)+n.width;t.style.flex=`1 1 ${Math.ceil(i)}px`}}doFilter(e,t){var n;const r=this,{store:i,picker:s}=r,o=null==e||""===e;r.lastQuery=e,r.primaryFilter.setConfig({value:e,disabled:o}),r.remoteFilter&&i.clear(!0);const a=()=>{const{navigator:e,isVisible:t}=s;i.count?!o&&e&&(e.activeItem=0):r.remoteFilter||o||(e&&(e.activeItem=null),r.validateFilter&&r.setError(Du)),t&&s.realign()};null===(n=r.filterPromise=i.filter())||void 0===n||n.then((()=>{r.filterPromise=null,a()})),r.inlinePicker||(null!=s&&s.isVisible?0===s.lastAlignSpec.zone&&s.realign():r.showPicker(t)),r.filterPromise||a()}onStoreFilter({source:e}){const t=this,n=t._picker,r=null==n?void 0:n.element.dataset,{count:i}=e;t.remoteFilter&&(i?n&&(n.navigator.activeItem=0):t.validateFilter&&t.setError(Du),t.filterSelected&&t.valueCollection.count&&(e.storage.onFiltersChanged({action:"splice",oldCount:1}),n&&n.refresh())),t.createOnUnmatched&&!i?r.addNewValue=t.L("L{addNewValue}")(t.primaryFilter.value):null==r||delete r.addNewValue}onValueCollectionChange({source:e}){var t;const n=this,{multiSelect:r,_picker:i}=n,s=null!==(t=n.hidePickerOnSelect)&&void 0!==t?t:!r,o=r?e.values.slice():e.first,a=e.values.slice(),l=n._isUserAction||(null==i?void 0:i._isUserAction)||s&&n.pickerVisible||!1,c=n._value;s&&n.hidePicker(),!e.count&&n.required?n.setError(Su):(n.clearError(Su),n.clearError(Du)),n.validateFilter&&o&&n.clearError(Du),n.filterSelected&&(n.remoteFilter?(n.store.storage.onFiltersChanged({action:"splice",oldCount:1}),n._picker&&n._picker.refresh()):n.store.filter()),n._value=null,n._lastValue=null;const d=n.cacheCurrentValue(n.value);n.syncInputFieldValue(),n.syncEmpty(),n.isConfiguring||(n.triggerFieldChange({value:d,oldValue:c,userAction:l,valid:n.isValid}),n.trigger("select",{record:o,records:a,userAction:l}),"select"===n.defaultAction&&n.trigger("action",{value:d,record:o,records:a,userAction:l}))}cacheCurrentValue(e){return this._value=e}onValueCollectionNoChange({toAdd:e}){!this.inlinePicker&&!this.multiSelect&&e.length&&this.pickerVisible&&this.picker.hide()}showPicker(){const e=this,{picker:t}=e;var n;e.readOnly||e.inlinePicker||(t.multiSelect=e.multiSelect,super.showPicker(...arguments),e.overlayAnchor&&!t.align.offset&&(t.align.offset=-t.anchorSize[1],t.realign()),t.restoreActiveItem&&(e.multiSelect?t.restoreActiveItem((null===(n=t.navigator)||void 0===n?void 0:n.previousActiveItem)||e.selected||0,!0):t.restoreActiveItem(e.selected||0,!0)),e.input.focus())}changePicker(e,t){var n;const r=this,i=r.pickerWidth||(null===(n=e)||void 0===n?void 0:n.width),s=Cu.mergeConfigs({owner:r,store:r.store,selected:r.valueCollection,multiSelect:r.multiSelect,cls:r.listCls,displayField:r.displayField,forElement:r[r.pickerAlignElement],align:{matchSize:null==i,anchor:r.overlayAnchor,target:r[r.pickerAlignElement],minHeight:r.inlinePicker?null:40*Math.min(3,r.store.count)},[r.listItemTpl?"itemTpl":void 0]:r.listItemTpl,width:i,navigator:{keyEventTarget:r.input}},e);return r.inlinePicker&&Object.assign(s,{floating:!1,align:null,activateOnMouseover:!1,maxHeight:null,appendTo:r.element}),(e=Cu.reconfigure(t,e?s:null,r))&&(e.element.classList.add("b-combo-picker"),e.element.dataset.emptyText=r.emptyText?r.L(r.emptyText):r.L("L{noResults}"),e.on({navigate:"onPickerNavigate",thisObj:r})),e}onPickerNavigate({event:e}){e.target.matches("[data-add-new-value]")&&this.addNewRecord(this.primaryFilter.value)}onPickerHide(){const e=this;super.onPickerHide(),e.multiSelect&&e.clearTextOnPickerHide&&(e.input.value="")}async internalOnKeyEvent(e){const t=this,n=t.input[t.inputValueAttr],r=n.length,{key:i}=e,{store:s,_picker:o,multiSelect:a}=t;if("keydown"===e.type&&null!=o&&o.isVisible&&o.navigator){const{activeItem:r}=o.navigator;if(r&&a&&i===t.multiValueSeparator)return t.input.value="",t.primaryFilter.setConfig({value:"",disabled:!0}),s.filter(),o.onItemClick(r,e),o.hide(),void e.preventDefault();if(!r&&t.createOnUnmatched&&(a&&i===t.multiValueSeparator||"Enter"===i))return e.preventDefault(),void await t.addNewRecord(n)}super.internalOnKeyEvent(...arguments),"keydown"===e.type&&"Enter"===i&&t.filterOnEnter&&r>=t.minChars&&(e.stopPropagation(),t.filterOnInput(e))}async addNewRecord(e){const t=this,{store:n,_picker:r,valueCollection:i,multiSelect:s,primaryFilter:o}=t,a=n.remoteFilter&&n.autoCommit;t.filterPromise&&await t.filterPromise,a||(o.setConfig({value:"",disabled:!0}),n.filter());const[l]=n.add(t.callback(t.createOnUnmatched,t,[e,t]));if(n.isCommitting){let e;try{await n.commitPromise}catch(t){var c,d;e=null===(c=t.response)||void 0===c||null===(d=c.parsedJson)||void 0===d?void 0:d.error}l.isPhantom&&(t.clearError(),t.setError(e||"L{Combo.recordNotCommitted}",!1,!0),n.remove(l),n.removed.remove(l))}a&&(o.setConfig({value:"",disabled:!0}),n.filter()),t.input.value="",n.includes(l)&&i.splice(s?i.count:0,s?0:i.count,l),null==r||r.hide()}changeCreateOnUnmatched(e){return!0===e&&(e=this.defaultRecordCreater),e}defaultRecordCreater(e){return this.store.createRecord({[this.displayField]:e})}updateLocalization(){super.updateLocalization();const e=this,{displayField:t}=e;let{localizedDisplayFieldsMap:n}=e;if(!0===e.localizeDisplayFields){n||(e.localizedDisplayFieldsMap=n=new Map),!e.store&&e.buildItems&&(e.items=e.buildItems());for(const i of e.items)if(i.id){var r;let s=n.get(i.id);!s&&null!==(r=i[t])&&void 0!==r&&r.startsWith("L{")&&(s=i[t],n.set(i.id,s)),s&&(i[t]=e.L(s))}e.syncInputFieldValue()}}}class xu extends wu{static get $name(){return"ComboChipView"}static get type(){return"combochipview"}static get defaultConfig(){return{closeHandler:"up.onChipClose",itemsFocusable:!1,multiSelect:!0,itemTpl(e){return _.encodeHtml(e[this.owner.displayField])},scrollable:{overflowY:"auto"}}}}Eu.initClass(),xu.initClass(),class extends id{static get $name(){return"ComboChipNavigator"}static get type(){return"combochipnavigator"}static get configurable(){return{allowShiftKey:!0}}onTargetClick(e){const t=this,n=e.target.closest(t.itemSelector);n&&!e.target.classList.contains("b-close-icon")&&(e.shiftKey||n.contains(e.target.closest("[data-noselect]"))||t.ownerCmp.selected.clear(),t.inClickHandler=!0,t.activeItem=n,t.inClickHandler=!1)}onKeyDown(e){"Enter"!==e.key&&super.onKeyDown(e)}updateActiveItem(e,t){const n=this.ownerCmp;super.updateActiveItem(e,t),e&&!this.inClickHandler&&n.selected.add(n.getRecordFromElement(e))}navigatePrevious(e){const t=this.ownerCmp;t.navigator.activeItem&&!e.shiftKey&&t.selected.clear(),this.previous?super.navigatePrevious(e):this.activeItem=null}navigateNext(e){const t=this.ownerCmp;t.navigator.activeItem&&!e.shiftKey&&t.selected.clear(),this.next?super.navigateNext(e):this.activeItem=null}}.initClass(),Eu._$name="Combo";class Ru extends ll{static get $name(){return"UndoRedoBase"}static get type(){return"undoredobase"}static get configurable(){return{project:null,stm:null,text:null,color:null,showZeroActionBadge:null,cls:"b-undo-controls b-toolbar",layoutStyle:{alignItems:"stretch",flexFlow:"row nowrap",overflow:"visible"},items:{undoBtn:{type:"button",icon:"b-icon-undo",tooltip:"L{UndoRedo.UndoLastAction}",onAction:"up.onUndo"},transactionsCombo:{type:"combo",valueField:"idx",editable:!1,store:{},emptyText:"L{UndoRedo.NoActions}",onAction:"up.onTransactionSelected",displayValueRenderer:"up.transactionsDisplayValueRenderer"},redoBtn:{type:"button",icon:"b-icon-redo",tooltip:"L{UndoRedo.RedoLastAction}",onAction:"up.onRedo"}}}}afterConstruct(){this.updateUndoRedoControls()}changeStm(e){return e.on({recordingstop:"updateUndoRedoControls",restoringstop:"updateUndoRedoControls",queueReset:"updateUndoRedoControls",disabled:"updateUndoRedoControls",thisObj:this}),e}changeItems(e){const{undoBtn:t,redoBtn:n}=e;return this.color&&(t&&(t.color=this.color),n&&(n.color=this.color)),this.text&&(t&&(t.text="L{UndoRedo.Undo}"),n&&(n.text="L{UndoRedo.Redo}")),super.changeItems(e)}updateProject(e){this.stm=e.stm}fillUndoRedoCombo(){const{transactionsCombo:e}=this.widgetMap;e&&(e.items=this.stm.queue.map(((e,t)=>[t,e||`Transaction ${t}`])))}updateUndoRedoControls(){const{stm:e,showZeroActionBadge:t}=this,{undoBtn:n,redoBtn:r}=this.widgetMap;n.badge=e.position||(t?"0":""),r.badge=e.length-e.position||(t?"0":""),n.disabled=!e.canUndo,r.disabled=!e.canRedo,this.fillUndoRedoCombo()}transactionsDisplayValueRenderer(e,t){var n;const r=(null===(n=this.stm)||void 0===n?void 0:n.position)||0;return`${r} undo actions / ${t.store.count-r} redo actions`}onUndo(){this.stm.canUndo&&this.stm.undo()}onRedo(){this.stm.canRedo&&this.stm.redo()}onTransactionSelected(e){const t=this.stm,n=e.value;n>=0&&(t.canUndo&&n<t.position?t.undo(t.position-n):t.canRedo&&n>=t.position&&t.redo(n-t.position+1))}}Ru._$name="UndoRedoBase";class Tu extends Eu{static get $name(){return"BooleanCombo"}static get type(){return"booleancombo"}static get configurable(){return{positiveValue:!0,positiveText:null,negativeValue:!1,negativeText:null,store:{value:[],$config:"lazy"},value:!1}}changeStore(e,t){const n=this;return super.changeStore(new As({data:[{id:n.positiveValue,text:n.positiveText||n.L("L{Object.Yes}")},{id:n.negativeValue,text:n.negativeText||n.L("L{Object.No}")}]}),t)}}Tu.initClass(),Tu._$name="BooleanCombo";class Mu extends(ll.mixin(El)){onChildAdd(e){super.onChildAdd(e),e.on({click:"resetValueCache",toggle:"onItemToggle",thisObj:this,prio:1e4})}onChildRemove(e){e.un({toggle:"resetValueCache",click:"resetValueCache",thisObj:this}),super.onChildRemove(e)}onItemToggle(e){const t=this;t.resetValueCache(),t.isSettingValue||t.toggleGroup&&!e.pressed||t.triggerFieldChange({value:t.value,userAction:!0,event:e})}resetValueCache(){this._value=null}createWidget(e){const t=this;return t.constructor.resolveType(e.type||"button").isButton&&(t.color&&!e.color&&(e.color=t.color),t.toggleGroup&&!e.toggleGroup&&("boolean"==typeof t.toggleGroup&&(t.toggleGroup=Mu.generateId("toggleGroup")),e.toggleGroup=t.toggleGroup)),t.columns&&(e.width=100/t.columns+"%"),e=super.createWidget(e),t.relayEvents(e,["click","action","toggle"]),e}updateRotate(e){this.eachWidget((t=>{!1!==t.rotate&&(t.rotate=e)}))}get value(){if(!this._value){const e=[];this.items.forEach((t=>{t.pressed&&void 0!==t.value&&e.push(t.value)})),this._value=e.join(this.valueSeparator)}return this._value}set value(e){const t=this,n=t.value;Array.isArray(e)||(e=null==e?[]:"string"==typeof e?e.split(t.valueSeparator):[e]),t._value=e.join(t.valueSeparator),t.isSettingValue=!0,t.items.forEach((t=>{void 0!==t.value&&(t.pressed=e.includes(t.value))})),t.isSettingValue=!1,t.isConfiguring||n===t.value||t.triggerFieldChange({value:t.value,userAction:!1})}updateDisabled(e){this.items.forEach((t=>t.disabled=e))}updateReadOnly(e){super.updateReadOnly(e),this.items.forEach((t=>{t.ignoreParentReadOnly||(t.disabled=e)}))}changeDisabled(e){return!!this.readOnly||e}get widgetClassList(){const e=super.widgetClassList;return this.columns&&e.push("b-columned"),e}}v(Mu,"$name","ButtonGroup"),v(Mu,"type","buttongroup"),v(Mu,"configurable",{defaultType:"button",cls:null,items:null,color:null,toggleGroup:null,valueSeparator:",",columns:null,hideWhenEmpty:!0,defaultBindProperty:"value"}),Mu.initClass(),Mu._$name="ButtonGroup";class ku extends kc{static get $name(){return"CalendarPanel"}static get type(){return"calendarpanel"}static get configurable(){return{textContent:!1,date:{$config:{equal:"date"},value:null},month:{},year:null,weekStartDay:null,sixWeeks:!0,showWeekNumber:null,showWeekColumn:null,disabledDates:null,headerRenderer:null,weekRenderer:null,cellRenderer:null,disableWeekends:null,hideNonWorkingDays:null,hideNonWorkingDaysCls:"b-hide-nonworking-days",nonWorkingDays:null,tip:null,dayCellCls:"b-calendar-cell",dayHeaderCls:"b-calendar-day-header",disabledCls:"b-disabled-date",otherMonthCls:"b-other-month",weekendCls:"b-weekend",todayCls:"b-today",nonWorkingDayCls:"b-nonworking-day",dayNameFormat:"ddd",minRowHeight:{$config:["lazy"],value:null},minColumnWidth:{$config:["lazy"],value:null},disableOtherMonthCells:null,disableOtherMonthCellsCls:"b-disable-othermonth-cells",hideOtherMonthCells:null,hideOtherMonthCellsCls:"b-hide-othermonth-cells",animateTimeShift:!0}}construct(e){super.construct(e),this.refreshCount||this.refresh()}onPaint({firstPaint:e}){var t;null===(t=super.onPaint)||void 0===t||t.call(this,...arguments),e&&(this.refreshCount||this.refresh(),this.getConfig("minColumnWidth"),this.getConfig("minRowHeight"))}get overflowElement(){return this.weeksElement}doDestroy(){var e;null===(e=this.tip)||void 0===e||e.destroy(),super.doDestroy()}changeMinRowHeight(e){const t=parseInt(Mr.getStyleValue(this.element,"--min-row-height"),10)||75;return isNaN(e)?e:Math.max(parseInt(e)||0,t)}updateMinRowHeight(e){this.weekElements.forEach((t=>Mr.setLength(t,"minHeight",e))),this.scrollable={overflowY:!!e&&"auto"}}changeMinColumnWidth(e){const t=parseInt(Mr.getStyleValue(this.element,"--min-column-width"),10)||75;return null==e?e:Math.max(parseInt(e)||0,t)}updateMinColumnWidth(e){const t=this;t.weekdayCells.forEach((t=>Mr.setLength(t,"minWidth",e))),t.cellElements.forEach((n=>n.matches(`.${t.dayCellCls}`)&&Mr.setLength(n,"minWidth",e))),t.scrollable={overflowX:!!e&&"auto"},t.overflowElement.classList[e?"add":"remove"]("b-min-columnwidth")}getDateFromDomEvent(e){const t=(e.nodeType===Element.ELEMENT_NODE?e:e.target).closest(`#${this.id} [data-date]`);if(t)return en.parseKey(t.dataset.date)}changeTip(e,t){const n=this;return lu.reconfigure(t,e,{owner:n,defaults:{type:"tooltip",owner:n,id:`${n.id}-cell-tip`,forElement:n.bodyElement,forSelector:`.${n.dayCellCls}`}})}updateTip(e){this.detachListeners("tip"),null==e||e.on({pointerOver:"onTipOverCell",name:"tip",thisObj:this})}updateElement(e,t){const n=this;super.updateElement(e,t),n.updateHideNonWorkingDays(n.hideNonWorkingDays),n.weekdayCells=Array.from(e.querySelectorAll(".b-calendar-day-header")),n.weekElements=Array.from(e.querySelectorAll(".b-calendar-week")),n.weekDayElements=Array.from(e.querySelectorAll(".b-calendar-days")),n.cellElements=[];for(let e=0,{length:t}=n.weekDayElements;e<t;e++)n.cellElements.push(n.weekDayElements[e].previousSibling,...n.weekDayElements[e].children)}changeDate(e){if(e="string"==typeof e?en.parse(e):new Date(e),isNaN(e))throw new Error("CalendarPanel date ingestion must be passed a Date, or a YYYY-MM-DD date string");return en.clearTime(e)}updateDate(e){this.month.date=e}updateDayNameFormat(){const e=new Date("2000-06-04T12:00:00");this.shortDayNames=[];for(let t=4;t<11;t++)e.setDate(t),this.shortDayNames.push(en.format(e,this.dayNameFormat))}get weekStartDay(){return"number"==typeof this._weekStartDay?this._weekStartDay:en.weekStartDay}updateWeekStartDay(e){const t=this;if(t._month){t.month.weekStartDay=e,t.dayNames=[];for(let e=0;e<7;e++)t.dayNames[e]=t.shortDayNames[t.canonicalDayNumbers[e]];t.refreshCount&&t.refresh()}}updateHideNonWorkingDays(e){var t;this.contentElement.classList.toggle(this.hideNonWorkingDaysCls,Boolean(e)),null===(t=this.scrollable)||void 0===t||t.syncOverflowState(),this._month&&(this.month.hideNonWorkingDays=e),this.isConfiguring||this.refresh()}updateHideOtherMonthCells(e){var t;this.element.classList.toggle(this.hideOtherMonthCellsCls,Boolean(e)),null===(t=this.scrollable)||void 0===t||t.syncOverflowState()}updateDisableOtherMonthCells(e){var t;this.element.classList.toggle(this.disableOtherMonthCellsCls,Boolean(e)),null===(t=this.scrollable)||void 0===t||t.syncOverflowState()}get nonWorkingDays(){return this._nonWorkingDays||this._localeNonWorkingDays||(this._localeNonWorkingDays=en.nonWorkingDays)}get weekends(){return this._localeWeekends||(this._localeWeekends=en.weekends)}changeNonWorkingDays(e){return sn.assign({},e)}updateNonWorkingDays(e){var t;this._month&&(this.month.nonWorkingDays=e,this.refresh(),null===(t=this.scrollable)||void 0===t||t.syncOverflowState())}get visibleDayColumnIndex(){return this.month.visibleDayColumnIndex}get dayColumnIndex(){return this.month.dayColumnIndex}get canonicalDayNumbers(){return this.month.canonicalDayNumbers}get visibleColumnCount(){return this.month.visibleColumnCount}get weekLength(){return this.month.weekLength}get startDate(){return this.month.startDate}get duration(){return en.diff(this.month.startDate,this.month.endDate,"day")+1}get endDate(){const{endDate:e}=this.month;if(e)return en.add(e,1,"day")}changeMonth(e,t){const n=this;if(!(e instanceof Wd)){if("number"==typeof e){if(t)return void(t.month=e);const r=n.date||en.clearTime(new Date);r.setMonth(e),e={date:r}}e=Wd.new({weekStartDay:n.weekStartDay,nonWorkingDays:n.nonWorkingDays,hideNonWorkingDays:n.hideNonWorkingDays,sixWeeks:n.sixWeeks},e)}return e.on({dateChange:"onMonthDateChange",thisObj:n}),e}onMonthDateChange({source:e,newDate:t,oldDate:n,changes:r}){const i=this;i.year=e.year,i.isConfiguring||((!i.getCell(t)||r.m||r.y)&&(i.refresh(),i.animateTimeShift&&!i.hidden&&Mr.slideIn(i.contentElement,t>n?1:-1)),i.trigger("dateChange",{changes:r,value:t,oldValue:n}))}updateYear(e){this.month.year=e}updateShowWeekNumber(e){this.updateShowWeekColumn(e)}updateShowWeekColumn(e){const t=this;t.element.classList[e?"add":"remove"]("b-show-week-column"),t.floating&&(t.isAligning||t.realign())}updateSixWeeks(e){this.month&&(this.month.sixWeeks=e,this.refresh())}refresh(){this.doRefresh()}doRefresh(){this.getConfig("element");const e=this,t=en.clearTime(new Date),{weekElements:n,weekDayElements:r,date:i,month:s,dayCellCls:o,dayHeaderCls:a,disabledCls:l,otherMonthCls:c,weekendCls:d,todayCls:u,nonWorkingDayCls:h,nonWorkingDays:g,canonicalDayNumbers:m,sixWeeks:p}=e;if(!i)return void(e.date=t);e.trigger("beforeRefresh"),e.getConfig("dayNameFormat");for(let t=0;t<7;t++){const n=e.weekdayCells[t],r=e.canonicalDayNumbers[t],i={[a]:1,[d]:en.weekends[r],[h]:g[r]};e.headerRenderer?(n.innerHTML="",e.callback(e.headerRenderer,e,[n,t,r])):Mr.setInnerText(n,e.shortDayNames[r]),Mr.syncClassList(n,i),n.dataset.columnIndex=t,n.dataset.cellDay=r}let f=0,v=0,y=6;for(let e=6;e>=0;e--)if(!g[m[e]]){y=e;break}n[4].classList.toggle("b-hide-display",s.weekCount<5&&!p),n[5].classList.toggle("b-hide-display",s.weekCount<6&&!p),s.eachWeek(((i,a)=>{const m=r[f],p=[m.previousSibling,...m.children];n[f].dataset.week=`${i[0]},${i[1]}`,e.weekRenderer?e.callback(e.weekRenderer,e,[p[0],i]):p[0].innerText=i[1];for(let r=0;r<7;r++){const m=a[r],b=m.getDay(),C=g[b],w=p[r+1],S={[o]:1,[l]:e.isDisabledDate(m),[c]:m.getMonth()!==s.month,[d]:en.weekends[b],[u]:m.getTime()===t.getTime(),[h]:C,"b-last-working-day":r===y,"b-first-visible-cell":!(m-(e.firstVisibleDate||-1)),"b-last-visible-cell":!(m-(e.lastVisibleDate||-1)),[`b-day-of-week-${b}`]:1};Mr.syncClassList(w,S),w.dataset.date=en.makeKey(m),w.dataset.cellIndex=v,w.dataset.columnIndex=r,w.lastDomConfig&&(delete w.lastDomConfig.class,delete w.lastDomConfig.className),e.cellRenderer?e.callback(e.cellRenderer,e,[{cell:w,date:m,day:b,row:n[f],rowIndex:f,cellIndex:v,columnIndex:r,visibleColumnIndex:e.visibleDayColumnIndex[b],week:i}]):w.innerHTML=m.getDate(),v++}f++})),e.visibleWeekCount=f,e.floating&&(e.isAligning||e.realign()),e.refreshCount=(e.refreshCount||0)+1,e.trigger("refresh")}isDisabledDate(e){const t=e.getDay(),{disabledDates:n,nonWorkingDays:r}=this;return!(!this.disableWeekends||!r[t])||(n?Array.isArray(n)?(e=en.clearTime(e,!0),n.some((t=>!(en.clearTime(t,!0)-e)))):this.callback(this.disabledDates,this,[e]):void 0)}get bodyConfig(){const e=super.bodyConfig,t=[];e.children=[{tag:"div",className:"b-calendar-row b-calendar-weekdays",reference:"weekdaysHeader",children:[{class:"b-week-number-cell"},...ke.fill(7,{class:this.dayHeaderCls}),Mr.scrollBarPadElement]},{className:"b-weeks-container notranslate",reference:"weeksElement",children:t}];for(let e=0;e<6;e++){const n={className:"b-calendar-row b-calendar-week",dataset:{rowIndex:e},children:[{className:"b-week-number-cell"},{className:"b-calendar-days",children:[{},{},{},{},{},{},{}],syncOptions:{ignoreRefs:!0,strict:!1}}]};t.push(n)}return e}get firstVisibleDate(){if(this.hideOtherMonthCells){const{year:e,month:t}=this.month;return new Date(e,t,1)}for(const e=this,t=e.month.startDate;;t.setDate(t.getDate()+1))if(!e.hideNonWorkingDays||!e.nonWorkingDays[t.getDay()])return t}get lastVisibleDate(){const e=en.add(this.endDate,-1,"d");if(this.hideOtherMonthCells)return e;for(const t=this,n=e;;n.setDate(n.getDate()-1))if(!t.hideNonWorkingDays||!t.nonWorkingDays[n.getDay()])return n}getCell(e,t){"string"!=typeof e&&(e=en.makeKey(e));const n=this.weeksElement.querySelector(`[data-date="${e}"]`);if(n&&(!t||!n.classList.contains(this.otherMonthCls)))return n}onTipOverCell({source:e,target:t}){e.date=en.parseKey(t.dataset.date)}updateLocalization(){this._localeNonWorkingDays=this._localeWeekends=null,this.updateDayNameFormat(),this.updateWeekStartDay(this.weekStartDay),super.updateLocalization()}}ku.initClass(),ku._$name="CalendarPanel";const Iu=e=>!e.value;class Au extends fu{static get $name(){return"Checkbox"}static get type(){return"checkbox"}static get alias(){return"check"}static get configurable(){return{inputType:"checkbox",autoCollapse:null,containerDefaults:{syncableConfigs:{disabled:e=>e.disabled||!e.value},syncConfigTriggers:{autoCollapse:1,value:1}},text:"",checkedValue:!0,uncheckedValue:!1,color:null,value:"",toggleGroup:null,localizableProperties:["label","text"]}}construct(e){"checked"in e&&((e=sn.assign({},e)).value=e.checked,delete e.checked),super.construct(e),this.syncHasText()}get textLabelCls(){return"b-checkbox-label"}get innerElements(){return[this.inputElement,{tag:"label",class:this.textLabelCls,for:`${this.id}-input`,reference:"textLabel",html:this.text||""}]}get inputElement(){const e=super.inputElement;return this.toggleGroup&&(e.dataset={group:this.toggleGroup}),e.listeners={click:"internalOnClick",change:"internalOnChange",input:"internalOnInput"},e}get checked(){return this.value}set checked(e){this.value=e}syncHasText(){this.element.classList[this.text?"add":"remove"]("b-text")}updateText(e){this.textLabel&&(this.syncHasText(),this.textLabel.innerHTML=e)}afterSyncChildConfigs(e){super.afterSyncChildConfigs(e);let{autoCollapse:t}=this;t&&(t=!0===t?Iu:t,e.collapsed=t(this))}assignFieldValue(e,t,n){this.value=n===this.checkedValue||n!==this.uncheckedValue&&null}fetchInputValue(){this.readOnly||(this.value=this.input.checked)}gatherValue(e){var t;const n=this,r=n.value?n.checkedValue:n.uncheckedValue,i=void 0!==r,{valueName:s}=n;i&&(e[s]=r),n.gatherValues(e,i),!0===r&&(null===(t=e[s])||void 0===t?void 0:t.value)===r&&delete e[s].value}changeValue(e){return"false"!==e&&Boolean(e)}updateValue(e){var t;const n=this,r=n.input.checked!==e;n.input.checked=e,null===(t=n.container)||void 0===t||t.syncChildConfigs(),!r||n.inputting||n.isConfiguring||(n.uncheckToggleGroupMembers(),n.triggerChange(!1))}get inputValueAttr(){return"checked"}updateColor(e,t){const n=this.element.classList;t&&n.remove(t),e&&n.add(e)}getToggleGroupMembers(){const{checked:e,toggleGroup:t,input:n,type:r}=this,i=[];return e&&t&&Mr.forEachSelector(this.rootElement,`input[type=${r}][data-group=${t}]`,(e=>{if(e!==n){const t=Ka.fromElement(e);t&&i.push(t)}})),i}uncheckToggleGroupMembers(){this.checked&&this.toggleGroup&&this.getToggleGroupMembers().forEach((e=>e.checked=!1))}check(){this.checked=!0}uncheck(){this.checked=!1}toggle(){this.checked=!this.checked}internalOnClick(e){return this.readOnly?(e.preventDefault(),!1):this.trigger("click",{event:e})}internalOnChange(e){const t=this;t.readOnly&&t.value!==t.input.checked?t.input.checked=t.value:(t.value=t.input.checked,t.inputting||(t.inputting=!0,t.triggerChange(!0),t.inputting=!1))}updateInputReadOnly(e){}triggerChange(e){const t=this,{checked:n}=t.input,r={checked:n,value:n,userAction:e,valid:!0};if(!(!n&&e&&t.toggleGroup&&t.getToggleGroupMembers().filter((e=>e.isVisible&&!e.disabled)).length||!1===t.trigger("beforeChange",r)))return t.triggerFieldChange(r,!1),e&&t.uncheckToggleGroupMembers(),t.trigger("action",r),t.trigger("change",r),!0;t.input.checked=t._value=!n}}Au.initClass(),Au._$name="Checkbox";class Fu extends kc{construct(e){super.construct(f({year:(new Date).getFullYear()},e)),_n.on({element:this.contentElement,click:"onYearClick",delegate:".b-yearpicker-year",thisObj:this})}get focusElement(){return this.getYearButton(this.year)||this.getYearButton(this.startYear)}getYearButton(e){return this.contentElement.querySelector(`.b-yearpicker-year[data-year="${e}"]`)}get value(){return this.year}set value(e){this.year=e}onYearClick({target:e}){const t=Math.min(Math.max(parseInt(e.innerText),this.minYear||1),this.maxYear||9999);this.year===t?this.trigger("select",{oldValue:t,value:t}):this.year=t}handleTitleClick(e){this.trigger("titleClick",e)}previous(){this.startYear=this.startYear-this.yearButtonCount}next(){this.startYear=this.endYear+1}ingestYear(e){if(!isNaN(e))return sn.isDate(e)?e.getFullYear():e}changeYear(e){if(e=this.ingestYear(e))return Math.min(Math.max(e,this.minYear||1),this.maxYear||9999)}updateYear(e,t){const n=this;!n.startYear||e>n.endYear?n.startYear=e:e<n.startYear&&(n.startYear=e-(n.yearButtonCount-1)),n.isConfiguring||n.trigger("select",{oldValue:t,value:e})}get endYear(){return this.startYear+this.yearButtonCount-1}changeStartYear(e){if(e=this.ingestYear(e))return e=this.minYear?Math.max(e,this.minYear):e,this.maxYear?Math.min(e,this.maxYear-(this.yearButtonCount-1)):e}async updateStartYear(e,t){this.isVisible&&Mr.slideIn(this.contentElement,Math.sign(e-t))}composeBody(){this.getConfig("year");const{startYear:e}=this,t=super.composeBody(),n=t.children[this.tbar?1:0].children=[];this.widgetMap.title.text=`${`000${e}`.slice(-4)} - ${`000${this.endYear}`.slice(-4)}`;for(let t=0,r=e;t<this.yearButtonCount;t++,r++)n.push({tag:"button",dataset:{year:r},class:{"b-yearpicker-year":1,"b-selected":r===this.year},text:`000${r}`.slice(-4)});return t}}v(Fu,"$name","YearPicker"),v(Fu,"type","yearpicker"),v(Fu,"configurable",{textContent:!1,tbar:{overflow:null,items:{previous:{type:"tool",cls:"b-icon b-icon-previous",onAction:"up.previous",weight:100},title:{type:"button",cls:"b-yearpicker-title",weight:200,onAction:"up.handleTitleClick"},next:{type:"tool",cls:"b-icon b-icon-next",onAction:"up.next",weight:300}}},itemCls:"b-year-container",yearButtonCount:12,year:null,minYear:null,maxYear:null,startYear:null}),Fu.initClass(),Fu._$name="YearPicker";class Ou extends vu{static get $name(){return"DisplayField"}static get type(){return"displayfield"}static get alias(){return"display"}static get configurable(){return{readOnly:!0,editable:!1,cls:"b-display-field",template:null,ariaElement:"displayElement"}}get focusElement(){}changeReadOnly(){return!0}changeEditable(){return!1}get inputElement(){return{tag:"span",id:`${this.id}-input`,reference:"displayElement",html:this.template?this.template(this.value):_.encodeHtml(this.value)}}}Ou.initClass(),Ou._$name="DisplayField";const Lu=()=>en.getMonthNames().map(((e,t)=>[t,e])),Pu=(e,t)=>e.valueOf()-t.valueOf();(class extends Eu{static get $name(){return"ReadOnlyCombo"}static get type(){return"readonlycombo"}static get configurable(){return{editable:!1,inputAttributes:{tag:"div",tabIndex:-1},inputValueAttr:"innerHTML",highlightExternalChange:!1,triggers:{expand:!1},picker:{align:{align:"t-b",axisLock:!0,matchSize:!1},cls:"b-readonly-combo-list",scrollable:{overflowX:!1}}}}}).initClass();class $u extends ku{static get $name(){return"DatePicker"}static get type(){return"datepicker"}static get delayable(){return{refresh:"raf"}}static get configurable(){return{activeDate:{value:new Date,$config:{equal:"date"}},focusable:!0,textContent:!1,tbar:{overflow:null,items:{prevYear:{cls:"b-icon b-icon-first",onAction:"up.gotoPrevYear",tooltip:"L{DatePicker.gotoPrevYear}"},prevMonth:{cls:"b-icon b-icon-previous",onAction:"up.gotoPrevMonth",tooltip:"L{DatePicker.gotoPrevMonth}"},fields:{type:"container",cls:"b-datepicker-title",items:{monthField:{type:"readonlycombo",cls:"b-datepicker-monthfield",items:Lu(),listeners:{select:"up.onMonthPicked"}},yearButton:{type:"button",cls:"b-datepicker-yearbutton",listeners:{click:"up.onYearPickerRequested"}}}},nextMonth:{cls:"b-icon b-icon-next",onAction:"up.gotoNextMonth",tooltip:"L{DatePicker.gotoNextMonth}"},nextYear:{cls:"b-icon b-icon-last",onAction:"up.gotoNextYear",tooltip:"L{DatePicker.gotoNextYear}"}}},yearPicker:{value:{type:"YearPicker",yearButtonCount:16,trapFocus:!0,positioned:!0,hidden:!0,listeners:{titleClick:"up.onYearPickerTitleClick",select:"up.onYearPicked"}},$config:"lazy"},date:null,minDate:{value:null,$config:{equal:"date"}},maxDate:{value:null,$config:{equal:"date"}},focusDisabledDates:null,multiSelect:!1,selection:[],editMonth:!0,dayNameFormat:"dd",trapFocus:!0,role:"grid",focusDescendant:!0,alwaysRefreshOnMonthChange:null}}static get prototypeProperties(){return{outOfRangeCls:"b-out-of-range",activeCls:"b-active-date",selectedCls:"b-selected-date"}}construct(e){const t=this;super.construct(e),t.externalCellRenderer=t.cellRenderer,t.cellRenderer=t.internalCellRenderer,t.element.setAttribute("aria-activedescendant",`${t.id}-active-day`),t.weeksElement.setAttribute("role","grid"),t.weekElements.forEach((e=>e.setAttribute("role","row"))),t.element.setAttribute("ariaLabelledBy",t.widgetMap.fields.id),_n.on({element:t.weeksElement,click:{handler:"onCellClick",delegate:`.${t.dayCellCls}:not(.${t.disabledCls}):not(.${t.outOfRangeCls})`},mousedown:{handler:"onCellMousedown",delegate:`.${t.dayCellCls}`},thisObj:t}),t.widgetMap.monthField.readOnly=t.widgetMap.yearButton.disabled=!t.editMonth,t.refresh.flush()}startConfigure(e){const t=e.date||e.value;t?(this.selection=t,this.configDone.activeDate=Boolean(this._activeDate)):(e.date=en.clamp(e.activeDate,e.minDate,e.maxDate),this.configDone.date=!1),super.startConfigure(...arguments)}afterHide(){var e;null===(e=this._yearPicker)||void 0===e||e.hide(),super.afterHide(...arguments)}doDestroy(){var e,t;null===(e=this.yearButton)||void 0===e||e.destroy(),null===(t=this.monthField)||void 0===t||t.destroy(),super.doDestroy()}get focusElement(){return this.weeksElement.querySelector(`.${this.dayCellCls}[tabIndex="0"]`)}doRefresh(){const e=this,{activeDate:t}=e,n=e.getCell(t);super.doRefresh(...arguments),e.updateActiveDate(e.activeDate,en.parseKey(null==n?void 0:n.dataset.date))}internalCellRenderer({cell:e,date:t}){const n=this,{activeCls:r,selectedCls:i,externalCellRenderer:s}=n,o=n.isSelectedDate(t),a={[r]:r&&n.isActiveDate(t),[i]:o,[n.outOfRangeCls]:n.minDate&&t<n.minDate||n.maxDate&&t>n.maxDate};if(o&&n.multiSelect){const e=!n.isSelectedDate(en.add(t,-1,"d")),r=!n.isSelectedDate(en.add(t,1,"d"));a["b-range-start"]=e,a["b-range-end"]=r,a["b-in-range"]=!e&&!r}Mr.updateClassList(e,a),e.innerHTML=`<div class="b-datepicker-cell-inner">${t.getDate()}</div>`,e.setAttribute("role","gridcell"),e.setAttribute("aria-label",en.format(t,"MMMM D, YYYY")),n.isActiveDate(t)?e.id=`${n.id}-active-day`:e.removeAttribute("id"),s&&(arguments[0].cell=e.firstChild,n.callback(s,this,arguments))}onCellMousedown(e){const t=e.target.closest("[data-date]");e.preventDefault(),t.focus(),this.activeDate=en.parseKey(t.dataset.date)}onCellClick(e){const t=e.target.closest("[data-date]");this.onUIDateSelect(en.parseKey(t.dataset.date),e)}onMonthDateChange({newDate:e,changes:t}){this.getConfig("tbar"),(t.m||t.y)&&(this.widgetMap.monthField.value=e.getMonth(),this.widgetMap.yearButton.text=e.getFullYear()),super.onMonthDateChange(...arguments)}onUIDateSelect(e,t){const n=this,{lastClickedDate:r,multiSelect:i}=n;n.lastClickedDate=e,n.isDisabledDate(e)||(n.activatingEvent=t,i?n.handleMultiSelect(r,e,t)&&(n.refresh(),n.trigger("selectionChange",{selection:n.selection,userAction:Boolean(t)})):n.value&&n.value.getTime()===e.getTime()?n.floating&&n.hide():n.value=e,n.activatingEvent=null)}handleMultiSelect(e,t,n){const r=this,{multiSelect:i,_selection:s}=r,o=s.dates,a="range"===i,{size:l,generation:c}=s,d=l&&{[en.makeKey(en.add(o[0],-1,"d"))]:1,[en.makeKey(o[0])]:1,[en.makeKey(o[o.length-1])]:1,[en.makeKey(en.add(o[o.length-1],1,"d"))]:1},u=s.has(t)?"delete":"add",h=a&&(null==d?void 0:d[en.makeKey(t)]);if(n.ctrlKey)!0!==i&&l&&!h||(s[u](t),a&&!s.has(r.rangeStartDate)&&r.rangeStartDate.setDate(r.rangeStartDate.getDate()+(t<o[1]?1:-1)));else if(n.shiftKey&&l){const[n,i]=[new Date(a?r.rangeStartDate||(r.rangeStartDate=o[0]):e),t].sort(Pu);a&&s.clear();for(const e=n;e<=i;e.setDate(e.getDate()+1))s.add(e)}else s.has(t)&&1===s.size||(s.clear(),s.add(t));const g=s.size;return 1===g?r.rangeStartDate=t:g||(r.rangeStartDate=null),s.generation!==c}changeSelection(e,t){const n=t||new _u,{generation:r}=n;let i;var s,o;if(null==t||t.clear(),e)if(e.forEach)if(i=e[0],e=e.sort(Pu),"range"===this.multiSelect&&2===e.length)for(const t=new Date(e[0]);t<=e[1];t.setDate(t.getDate()+1))n.add(t);else i=e[0],null===(s=e)||void 0===s||null===(o=s.forEach)||void 0===o||o.call(s,(e=>n.add(e)));else i=e,n.add(e);return i&&(this.activeDate=this.rangeStartDate=en.clearTime(i)),n.generation!==r&&this.refresh(),n}updateSelection(){this.isConfiguring||this.refresh()}get selection(){const{dates:e}=this._selection;return"range"===this.multiSelect&&e.length?[e[0],e[e.length-1]]:e}onInternalKeyDown(e){const t=this,n=e.key.trim()||e.code,r=t.activeDate;let i=new Date(r);if("Escape"===n&&t.floating)return t.hide();if(r&&t.weeksElement.contains(e.target)){do{switch(n){case"ArrowLeft":e.preventDefault(),e.ctrlKey?i=t.gotoPrevMonth():i.setDate(i.getDate()-1);break;case"ArrowUp":e.preventDefault(),i.setDate(i.getDate()-7);break;case"ArrowRight":e.preventDefault(),e.ctrlKey?i=t.gotoNextMonth():i.setDate(i.getDate()+1);break;case"ArrowDown":e.preventDefault(),i.setDate(i.getDate()+7);break;case"Enter":return t.onUIDateSelect(r,e)}}while(t.isDisabledDate(i)&&!t.focusDisabledDates);if(t.minDate&&i<t.minDate)return;if(t.maxDate&&i>t.maxDate)return;t.activeDate=i}}changeMinDate(e){return e?this.changeDate(e):null}updateMinDate(e){this._yearpicker&&(this._yearpicker.minYear=null==e?void 0:e.getFullYear()),this.refresh()}changeMaxDate(e){return e?this.changeDate(e):null}updateMaxDate(e){this._yearpicker&&(this._yearpicker.maxYear=null==e?void 0:e.getFullYear()),this.refresh()}updateDate(e){this.activeDate=e,this.getCell(e)&&!this.isNavigating||super.updateDate(e)}changeActiveDate(e,t){if(!1!==this.trigger("beforeActiveDateChange",{activeDate:e,oldActiveDate:t})){if(e=e?this.changeDate(e):this.date||(this.date=en.clearTime(new Date)),isNaN(e))throw new Error("DatePicker date ingestion must be passed a Date, or a YYYY-MM-DD date string");return en.clamp(e,this.minDate,this.maxDate)}}updateActiveDate(e,t){const n=this,{activeCls:r,refreshCount:i,month:s}=n,o=t&&n.getCell(t);if(i){const i=s.month,a=Mr.getActiveElement(n.element);e.getMonth()!==i&&n.getCell(e)&&!n.alwaysRefreshOnMonthChange||(s.date=e),s.month!==i&&n.animateTimeShift&&!n.hidden&&Mr.slideIn(n.contentElement,e>t?1:-1),n.refresh.flush();const l=n.getCell(e);l.setAttribute("tabIndex",0),r&&l.classList.add(r),l.id=`${n.id}-active-day`,n.weeksElement.contains(a)&&l.focus(),o&&o!==l&&(o.removeAttribute("tabIndex"),r&&o.classList.remove(r),o.removeAttribute("id"))}else n.month.date=e,n.on({refresh:()=>n.updateActiveDate(e),once:!0})}set value(e){const t=this,{generation:n}=t._selection;if(e){if(void 0===(e=t.changeDate(e,t.value)))return;t.value&&e.getTime()===t.value.getTime()||(t.selection=e),t.date=e}else t._selection.clear(),t.date=new Date;t.isConfiguring||t._selection.generation===n||(t.refresh(),t.trigger("selectionChange",{selection:t.selection,userAction:Boolean(t.activatingEvent)}))}get value(){return this.selection[this.selection.length-1]}gotoPrevYear(){return this.goto(-1,"year")}gotoPrevMonth(){return this.goto(-1,"month")}gotoNextMonth(){return this.goto(1,"month")}gotoNextYear(){return this.goto(1,"year")}goto(e,t){const n=this,{activeDate:r}=n,i=r&&n.getCell(r);let s;s="month"===t&&i&&(null==r?void 0:r.getMonth())===n.month.month+e?r:en.add(i?r:n.date,e,t);const o=new Date(s);o.setDate(1);const a=en.add(en.add(o,1,"month"),-1,"day");if(n.minDate&&e<0&&a<n.minDate||n.maxDate&&e>0&&o>n.maxDate)return;n.isNavigating=!0;const l=n.date=s;return i&&(n.activeDate=s),n.isNavigating=!1,l}isActiveDate(e){return this.activeDate&&this.changeDate(e).getTime()===this.activeDate.getTime()}isSelectedDate(e){return this._selection.has(e)}onMonthPicked({record:e,userAction:t}){var n;this.activeDate=en.add(this.activeDate,e.value-this.activeDate.getMonth(),"month"),t&&(null===(n=this.focusElement)||void 0===n||n.focus())}onYearPickerRequested(){const{yearPicker:e}=this;e.isVisible?e.hide():(e.year=e.startYear=this.activeDate.getFullYear(),e.show(),e.focus())}onYearPickerTitleClick(){this.yearPicker.hide()}onYearPicked({value:e,source:t}){const n=new Date(this.activeDate);n.setFullYear(e),this.activeDate=n,this.focusElement&&Mr.focusWithoutScrolling(this.focusElement),t.hide()}changeYearPicker(e,t){var n,r;return Fu.reconfigure(t,e?Fu.mergeConfigs({owner:this,appendTo:this.element,minYear:null===(n=this.minDate)||void 0===n?void 0:n.getFullYear(),maxYear:null===(r=this.maxDate)||void 0===r?void 0:r.getFullYear()},e):null,this)}get childItems(){const{_yearPicker:e}=this,t=super.childItems;return e&&t.push(e),t}updateLocalization(){const{monthField:e}=this.widgetMap,t=Lu();this.longestMonth=Math.max(...t.map((e=>e[1].length))),this.isConfiguring||this.isConstructing||(t[e.value].selected=!0,e.items=t),super.updateLocalization()}}class _u extends Set{add(e){return e=en.makeKey(e),this.has(e)||(this.generation=(this.generation||0)+1),super.add(e)}delete(e){return e=en.makeKey(e),this.has(e)&&this.generation++,super.delete(e)}has(e){return super.has(en.makeKey(e))}clear(){return this.size&&this.generation++,super.clear()}get dates(){return[...this].sort().map((e=>en.parseKey(e)))}}$u.initClass(),$u._$name="DatePicker";class Nu extends yu{static get $name(){return"DateField"}static get type(){return"datefield"}static get alias(){return"date"}static get configurable(){return{format:"L",fallbackFormat:"YYYY-MM-DD",timeFormat:"HH:mm:ss:SSS",keepTime:!1,pickerFormat:null,validateDateOnly:null,triggers:{expand:{cls:"b-icon-calendar",handler:"onTriggerClick",weight:200},back:{cls:"b-icon b-icon-angle-left b-step-trigger",key:"Shift+ArrowDown",handler:"onBackClick",align:"start",weight:100},forward:{cls:"b-icon b-icon-angle-right b-step-trigger",key:"Shift+ArrowUp",handler:"onForwardClick",align:"end",weight:100}},calendarContainerCls:"",min:null,max:null,step:!1,stepTriggers:null,weekStartDay:null,picker:{type:"datepicker",role:"dialog",floating:!0,scrollAction:"realign",align:{align:"t0-b0",axisLock:!0}},value:null}}changePicker(e,t){const n=this,r={owner:n,forElement:n[n.pickerAlignElement],minDate:n.min,maxDate:n.max,weekStartDay:n._weekStartDay,align:{anchor:n.overlayAnchor,target:n[n.pickerAlignElement]},onSelectionChange:({selection:e,source:t})=>{t.isVisible&&(n._isUserAction=n._isPickerInput=!0,n.value=e[0],n._isPickerInput=n._isUserAction=!1,t.hide())}};n.calendarContainerCls&&(r.cls=n.calendarContainerCls),n.value?r.value=n.value:r.activeDate=new Date;const i=$u.reconfigure(t,e,{owner:n,defaults:r});return null==i||i.refresh.flush(),i}get backShiftDate(){return en.add(this.value,-1*this._step.magnitude,this._step.unit)}onBackClick(){const e=this,{min:t}=e;if(!e.readOnly&&e.value){const n=e.backShiftDate;(!t||t.getTime()<=n)&&(e._isUserAction=!0,e.value=n,e._isUserAction=!1)}}get forwardShiftDate(){return en.add(this.value,this._step.magnitude,this._step.unit)}onForwardClick(){const e=this,{max:t}=e;if(!e.readOnly&&e.value){const n=e.forwardShiftDate;(!t||t.getTime()>=n)&&(e._isUserAction=!0,e.value=n,e._isUserAction=!1)}}showPicker(e){if(this.readOnly)return;const t=this,{_picker:n}=t;if(n){const e={minDate:t.min,maxDate:t.max};t.value?e.value=t.value:e.activeDate=new Date,n.setConfig(e)}super.showPicker(e)}focusPicker(){this.picker.focus()}get isValid(){const e=this;e.clearError("L{Field.minimumValueViolation}",!0),e.clearError("L{Field.maximumValueViolation}",!0);let t=e.value;if(t){const{min:n,max:r,validateDateOnly:i}=e;if(i&&(t=en.clearTime(t,!1)),n&&t<n)return e.setError("L{Field.minimumValueViolation}",!0),!1;if(r&&t>r)return e.setError("L{Field.maximumValueViolation}",!0),!1}return super.isValid}transformDateValue(e){const t=this;return null!=e&&(en.isDate(e)||(e="string"==typeof e?en.parse(e,t.format)||en.parse(e,t.fallbackFormat):new Date(e)),en.isValidDate(e))?(!t.min||e-t.min>-en.MS_PER_DAY)&&(!t.max||e<=t.max)?t.transformTimeValue(e):e:null}transformTimeValue(e){const t=this,{keepTime:n}=t;if(e=en.clone(e),n)if("entered"!==n){const r=en.parse(n,t.timeFormat);en.isValidDate(r)?en.copyTimeValues(e,r):en.isValidDate(t.value)&&en.copyTimeValues(e,t.value)}else t._isPickerInput&&en.isValidDate(t.value)&&en.copyTimeValues(e,t.value);else en.clearTime(e,!1);return e}changeMin(e){return this.transformDateValue(e)}updateMin(e){const{input:t,_picker:n}=this;t&&(null==e?t.removeAttribute("min"):t.min=e),n&&(n.minDate=e),this.syncInvalid()}changeMax(e){return this.transformDateValue(e)}updateMax(e){const{input:t,_picker:n}=this;t&&(null==e?t.removeAttribute("max"):t.max=e),n&&(n.maxDate=e),this.syncInvalid()}get weekStartDay(){return"number"==typeof this._weekStartDay?this._weekStartDay:en.weekStartDay}updateWeekStartDay(e){this._picker&&(this._picker.weekStartDay=e)}changeValue(e,t){const n=this,r=n.transformDateValue(e);if(!e||r){if(n.clearError("L{invalidDate}"),n.hasChanged(t,r))return super.changeValue(r,t);n.inputting||n.syncInputFieldValue()}else n.setError("L{invalidDate}")}updateValue(e,t){const n=this._picker;n&&!this.inputting&&(n.value=e),super.updateValue(e,t)}changeStep(e,t){const n=typeof e;return e?("number"===n?e={magnitude:Math.abs(e),unit:t?t.unit:"day"}:"string"===n&&(e=en.parseDuration(e)),e&&e.unit&&e.magnitude?(e.magnitude<0&&(e={magnitude:-e.magnitude,unit:e.unit}),e):void 0):null}updateStep(e){this.element.classList[e?"remove":"add"]("b-no-steppers"),this.syncInvalid()}hasChanged(e,t){return null!=e&&e.getTime&&null!=t&&t.getTime&&"entered"!==this.keepTime?!en.isEqual(en.clearTime(e),en.clearTime(t)):super.hasChanged(e&&e.getTime(),t&&t.getTime())}get inputValue(){const e=this.value;return e?en.format(e,this.format):""}updateFormat(){this.isConfiguring||this.syncInputFieldValue(!0)}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue(!0)}internalOnKeyEvent(e){super.internalOnKeyEvent(e),"Enter"===e.key&&this.isValid&&this.picker.hide()}}Nu.initClass(),Nu._$name="DateField";class Hu extends fu{static get $name(){return"NumberField"}static get type(){return"numberfield"}static get alias(){return"number"}static get configurable(){return{min:null,max:null,step:1,largeStep:0,value:null,format:"",decimalPrecision:null,leadingZeroes:null,triggers:{spin:{type:"spintrigger"}},changeOnSpin:!0,inputType:null}}construct(e){super.construct(e);const t=this;t.input.addEventListener("dblclick",(()=>{t.select()})),"number"==typeof t.changeOnSpin&&(t.bufferedSpinChange=t.buffer(t.triggerChange,t.changeOnSpin))}acceptValue(e,t){let n=!isNaN(e);if(n&&!this.hasTextSelection){n=!1;const e=this.input.value,r=parseFloat(e);e!==t&&(n=!this.acceptValue(r,e))}return n}okMax(e){return isNaN(this.max)||e<=this.max}okMin(e){return isNaN(this.min)||e>=this.min}internalOnKeyEvent(e){if("keydown"===e.type){const t=this,n=e.key;let r;if("ArrowUp"===n)t.doSpinUp(e.shiftKey),r=!0;else if("ArrowDown"===n)t.doSpinDown(e.shiftKey),r=!0;else if(!e.altKey&&!e.ctrlKey&&n&&1===n.length){const e=t.getAfterValue(n),i=t.formatter.parseStrict(e);r=!(i===t.value||"-"===e&&(isNaN(t.min)||t.min<0)||t.acceptValue(i,e))}"Enter"===n&&t._changedBySilentSpin&&(t.triggerChange(e,!0),t._changedBySilentSpin=!1),r&&e.preventDefault()}super.internalOnKeyEvent(e)}doSpinUp(e=!1){const t=this;if(t.readOnly)return;let n=(t.value||0)+(e?t.largeStep:t.step);t.okMin(n)||(n=t.min),t.okMax(n)&&t.applySpinChange(n)}doSpinDown(e=!1){const t=this;if(t.readOnly)return;let n=(t.value||0)-(e?t.largeStep:t.step);t.okMax(n)||(n=t.max),t.okMin(n)&&t.applySpinChange(n)}applySpinChange(e){const t=this;t._isUserAction=!0,!0!==t.changeOnSpin&&(t._changedBySilentSpin=!0,t.silenceChange=!0,t.bufferedSpinChange&&t.bufferedSpinChange(null,!0)),t.value=e,t._isUserAction=!1,t.silenceChange=!1}triggerChange(){this.silenceChange||super.triggerChange(...arguments)}onFocusOut(e){var t,n,r;super.onFocusOut(...arguments);const i=this,{input:s}=i,o=s.value,a=i.formatter.truncate(o),l=isNaN(a)?o:i.formatValue(a);null===(t=i.triggers)||void 0===t||null===(n=t.spin)||void 0===n||null===(r=n.clickRepeater)||void 0===r||r.cancel(),o!==l&&(s.value=l),i._changedBySilentSpin&&(i.triggerChange(e,!0),i._changedBySilentSpin=!1)}internalOnInput(e){const t=this,{formatter:n,input:r}=t,{parser:i}=n,s=r.value,o=i.decimalPlaces(s);if(n.truncator&&o){let e=s;const a=n.truncate(s);if(!isNaN(a)&&(e=t.formatValue(a),i.decimalPlaces(e)<o)){const n=s.length-t.caretPos;r.value=e,t.caretPos=e.length-n}}super.internalOnInput(e)}formatValue(e){return this.formatter.format(e)}changeFormat(e){const t=this;if(""===e){const{leadingZeroes:n,decimalPrecision:r}=t;e=n?`${n}>9`:null,null!=r?e=`${e||""}9.${"#".repeat(r)}`:e&&(e+=".*")}return e}get formatter(){const e=this,t=e.format;let n=e._formatter;return n&&e._lastFormat===t||(n=cd.get(e._lastFormat=t),e._formatter=n),n}updateStep(e){this.element.classList[e?"remove":"add"]("b-hide-spinner"),this._step=e}changeLargeStep(e){return e||10*this.step}get validity(){const e=this.value,t={};return null!=e&&(t.rangeUnderflow=!this.okMin(e),t.rangeOverflow=!this.okMax(e)),t.valid=!t.rangeUnderflow&&!t.rangeOverflow,t}changeValue(e,t){const n=this;if(e||0===e){let t;"number"!=typeof e&&(e="string"==typeof e?n.formatter.parse(e):Number(e),t=isNaN(e),t&&(e="")),!t&&n.format&&(e=n.formatter.round(e))}else e=void 0;return super.changeValue(e,t)}get inputValue(){let e=this.value;return null!=e&&this.format&&(e=this.formatValue(e)),e}}Hu.initClass(),Hu._$name="NumberField";class Bu extends ll{static get $name(){return"TimePicker"}static get type(){return"timepicker"}construct(e){super.construct(e),this.refresh()}updateSeconds(e){this.widgetMap.second[e?"show":"hide"]()}onFieldChange(){this.isConfiguring||this.isRefreshing||(this.value=this.pickerToTime())}onAmPmButtonClick({source:e}){this._pm="pmButton"===e.ref,this._value&&(this.value=this.pickerToTime())}onInternalKeyDown(e){var t;const n=this;switch(e.key){case"Escape":return n.triggerTimeChange(n._initialValue),n.hide(),void e.preventDefault();case"Enter":return n.value=n.pickerToTime(),n.hide(),void e.preventDefault()}null===(t=super.onInternalKeyDown)||void 0===t||t.call(this,e)}pickerToTime(){const e=this,t=e._pm,{hour:n,minute:r,second:i}=e.widgetMap;n.format=e._is24Hour?"2>9":null;let s=n.value,o=new Date(e.value);return e._is24Hour||(t&&s<12&&(s+=12),t||12!==s||(s=0)),o.setHours(s),o.setMinutes(r.value),e.seconds&&o.setSeconds(i.value),e._min&&(o=en.max(e._min,o)),e._max&&(o=en.min(e._max,o)),o}triggerTimeChange(e){this.trigger("timeChange",{time:e})}updateInitialValue(e){this.value=e}changeValue(e){var t;return e&&(e="string"==typeof e?en.parse(e,this.format):e),this.isVisible||(this._initialValue=e),null!==(t=e)&&void 0!==t?t:en.getTime(0)}updateValue(e){this.isVisible&&this.triggerTimeChange(e),this.refresh()}updateFormat(e){this._is24Hour=en.is24HourFormat(e),this.refresh()}changeMin(e){return"string"==typeof e?en.parse(e,this.format):e}changeMax(e){return"string"==typeof e?en.parse(e,this.format):e}refresh(){const e=this;if(!e.isConfiguring&&e.value){e.isRefreshing=!0;const{hour:t,minute:n,second:r,amButton:i,pmButton:s}=e.widgetMap,o=e.value,a=e._is24Hour,l=o.getHours(),c=e._pm=l>=12;e.element.classList[a?"add":"remove"]("b-24h"),t.min=a?0:1,t.max=a?23:12,t.value=a?l:l%12||12,n.value=o.getMinutes(),r.value=o.getSeconds(),i.pressed=!c,s.pressed=c,i.hidden=s.hidden=a,e.isRefreshing=!1}}}v(Bu,"configurable",{floating:!0,items:{hour:{label:"L{TimePicker.hour}",type:"number",min:0,max:23,highlightExternalChange:!1,format:"2>9"},minute:{label:"L{TimePicker.minute}",type:"number",min:0,max:59,highlightExternalChange:!1,format:"2>9"},second:{hidden:!0,label:"L{TimePicker.second}",type:"number",min:0,max:59,highlightExternalChange:!1,format:"2>9"},amButton:{type:"button",text:"AM",toggleGroup:"am-pm",cls:"b-blue",onClick:"up.onAmPmButtonClick"},pmButton:{type:"button",text:"PM",toggleGroup:"am-pm",cls:"b-blue",onClick:"up.onAmPmButtonClick"}},autoShow:!1,trapFocus:!0,seconds:null,value:{$config:{equal:"date"},value:null},format:null,max:null,min:null,initialValue:null}),Bu.initClass(),Bu._$name="TimePicker";class ju extends yu{static get $name(){return"TimeField"}static get type(){return"timefield"}static get alias(){return"time"}static get configurable(){return{picker:{type:"timepicker",align:{align:"t0-b0",axisLock:!0}},format:"LT",triggers:{expand:{align:"end",handler:"onTriggerClick",compose:()=>({children:[{class:{"b-icon-clock-live":1}}]})},back:{align:"start",cls:"b-icon b-icon-angle-left b-step-trigger",key:"Shift+ArrowDown",handler:"onBackClick"},forward:{align:"end",cls:"b-icon b-icon-angle-right b-step-trigger",key:"Shift+ArrowUp",handler:"onForwardClick"}},min:null,max:null,step:"5m",stepTriggers:null,value:null,keepDate:!1}}changePicker(e,t){const n=this;return Bu.reconfigure(t,e,{owner:n,defaults:{value:n.value,forElement:n[n.pickerAlignElement],owner:n,align:{anchor:n.overlayAnchor,target:n[n.pickerAlignElement]},onTimeChange({time:e}){n._isUserAction=!0,n.value=e,n._isUserAction=!1}}})}onBackClick(){const e=this,{min:t}=e;if(!e.readOnly&&e.value){const n=en.add(e.value,-1*e.step.magnitude,e.step.unit);(!t||t.getTime()<=n)&&(e._isUserAction=!0,e.value=n,e._isUserAction=!1)}}onForwardClick(){const e=this,{max:t}=e;if(!e.readOnly&&e.value){const n=en.add(e.value,e.step.magnitude,e.step.unit);(!t||t.getTime()>=n)&&(e._isUserAction=!0,e.value=n,e._isUserAction=!1)}}get isValid(){const e=this;e.clearError("L{Field.minimumValueViolation}",!0),e.clearError("L{Field.maximumValueViolation}",!0);let t=e.value;if(t){if(t=t.getTime(),e._min&&e._min.getTime()>t)return e.setError("L{Field.minimumValueViolation}",!0),!1;if(e._max&&e._max.getTime()<t)return e.setError("L{Field.maximumValueViolation}",!0),!1}return super.isValid}hasChanged(e,t){return null!=e&&e.getTime&&null!=t&&t.getTime?e.getHours()!==t.getHours()||e.getMinutes()!==t.getMinutes()||e.getSeconds()!==t.getSeconds()||e.getMilliseconds()!==t.getMilliseconds():super.hasChanged(e,t)}showPicker(){const e=this,{picker:t,value:n}=e;e.readOnly||(t.value=n,t.format=e.format,t.maxTime=e.max,t.minTime=e.min,n||(e.value=t.value),super.showPicker(!0))}onPickerShow(){var e;super.onPickerShow(),this.pickerKeyDownRemover=null===(e=this.pickerKeyDownRemover)||void 0===e?void 0:e.call(this)}focusPicker(){this.picker.focus()}transformTimeValue(e){return null!=e&&("string"==typeof e?(e=en.parse(e,this.format),this.keepDate&&(e=en.copyTimeValues(new Date(this.value),e))):e=new Date(e),en.isValidDate(e))?this.keepDate?e:en.getTime(e):null}changeMin(e){return this.transformTimeValue(e)}updateMin(e){const{input:t}=this;t&&(null==e?t.removeAttribute("min"):t.min=e),this.syncInvalid()}changeMax(e){return this.transformTimeValue(e)}updateMax(e){const{input:t}=this;t&&(null==e?t.removeAttribute("max"):t.max=e),this.syncInvalid()}changeValue(e,t){const n=this,r=n.transformTimeValue(e);if(e&&!r||n.isRequired&&""===e)n.setError("L{invalidTime}");else{if(n.clearError("L{invalidTime}"),n.hasChanged(t,r))return super.changeValue(r,t);n.inputting||n.syncInputFieldValue(!0)}}updateValue(e,t){const{expand:n}=this.triggers;n&&e&&(n.element.firstElementChild.style.animationDelay=-(60*e.getHours()+e.getMinutes())/10+"s"),super.updateValue(e,t)}changeStep(e,t){var n,r;const i=typeof e;return e?("number"===i?e={magnitude:Math.abs(e),unit:t?t.unit:"hour"}:"string"===i&&(e=en.parseDuration(e)),null!==(n=e)&&void 0!==n&&n.unit&&null!==(r=e)&&void 0!==r&&r.magnitude?(e.magnitude<0&&(e={magnitude:-e.magnitude,unit:e.unit}),e):void 0):null}updateStep(e){this.element.classList[e?"remove":"add"]("b-no-steppers"),this.syncInvalid()}updateFormat(){this.syncInputFieldValue(!0)}get inputValue(){return en.format(this.value,this.format)}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue(!0)}}ju.initClass(),ju._$name="TimeField";class Vu extends fu{doDestroy(){this.dateField.destroy(),this.timeField.destroy(),super.doDestroy()}get focusElement(){return this.dateField.input}get innerElements(){return[this.dateField.element,this.timeField.element]}internalOnKeyEvent(){}updateRevertOnEscape(e){this.timeField.revertOnEscape=e,this.dateField.revertOnEscape=e}changeTimeField(e){const t=this,n=ju.new({revertOnEscape:t.revertOnEscape,syncInvalid(...e){const n=t.updatingInvalid;ju.prototype.syncInvalid.apply(this,e),t.timeField&&!n&&t.syncInvalid()}},e);return _n.on({element:n.element,keydown:"onTimeFieldKeyDown",thisObj:t}),t.readOnly&&(n.readOnly=!0),n}updateTimeField(e){const t=this;e.on({change({userAction:e,value:n}){if(e&&!t.$settingValue){const e=t.dateField.value;t._isUserAction=!0,t.value=e?en.copyTimeValues(e,n):null,t._isUserAction=!1}},thisObj:t})}changeDateField(e){const t=this,n=(null==e?void 0:e.type)||"datefield",r=Ka.resolveType(e.type||"datefield"),i=Ka.create(sn.assign({type:n,revertOnEscape:t.revertOnEscape,syncInvalid(...e){const n=t.updatingInvalid;r.prototype.syncInvalid.apply(this,e),t.dateField&&!n&&t.syncInvalid()}},e));return _n.on({element:i.element,keydown:"onDateFieldKeyDown",thisObj:t}),t.readOnly&&(i.readOnly=!0),i.on({keydown:({event:e})=>{var t;"Tab"===e.key&&!e.shiftKey&&null!==(t=this.timeField)&&void 0!==t&&t.isVisible&&(e.stopPropagation(),e.cancelBubble=!0)}}),i}get childItems(){return[this.dateField,this.timeField]}updateDateField(e){const t=this;e.on({change({userAction:e,value:n}){e&&!t.$isInternalChange&&(t._isUserAction=!0,t.timeField.value?n&&en.copyTimeValues(n,t.timeField.value):t.timeField.value=n,t.value=n,t._isUserAction=!1)},thisObj:t})}updateWeekStartDay(e){this.dateField&&(this.dateField.weekStartDay=e)}changeWeekStartDay(e){var t,n;return"number"==typeof e?e:null!==(t=null===(n=this.dateField)||void 0===n?void 0:n.weekStartDay)&&void 0!==t?t:en.weekStartDay}syncInputFieldValue(e=this.isConfiguring){super.syncInputFieldValue(!0);const t=this,{dateField:n,timeField:r}=t,i=n.highlightExternalChange,s=r.highlightExternalChange;e||t.highlightExternalChange||(e=!0),t.$isInternalChange=!0,n.highlightExternalChange=!1,n.value=null,n.highlightExternalChange=i,e&&(r.highlightExternalChange=n.highlightExternalChange=!1),r.value=n.value=t.inputValue,n.highlightExternalChange=i,r.highlightExternalChange=s,t.$isInternalChange=!1,t.syncInvalid()}onTimeFieldKeyDown(e){const t=this;if("Enter"===e.key||"Tab"===e.key){const e=t.dateField.value;t._isUserAction=!0,t.value=e?en.copyTimeValues(e,t.timeField.value):null,t._isUserAction=!1}}onDateFieldKeyDown(e){const t=this;"Tab"!==e.key||e.shiftKey?"Enter"===e.key&&(t.value=t.dateField.value):(e.stopPropagation(),e.preventDefault(),t.timeField.focus())}updateRequired(e,t){this.timeField.required=this.dateField.required=e}updateReadOnly(e,t){super.updateReadOnly(e,t),this.isConfiguring||(this.timeField.readOnly=this.dateField.readOnly=e)}onDisabled(e){this.timeField.disabled=this.dateField.disabled=e}focus(){this.dateField.focus()}hasChanged(e,t){return!en.isEqual(e,t)}get isValid(){return this.timeField.isValid&&this.dateField.isValid}setError(e,t){[this.dateField,this.timeField].forEach((n=>n.setError(e,t)))}getErrors(){const e=[...this.dateField.getErrors()||[],...this.timeField.getErrors()||[]];return e.length?e:null}clearError(e,t){[this.dateField,this.timeField].forEach((n=>n.clearError(e,t)))}updateInvalid(){this.updatingInvalid=!0,[this.dateField,this.timeField].forEach((e=>e.updateInvalid())),this.updatingInvalid=!1}}v(Vu,"configurable",{timeField:{},dateField:{keepTime:!0,step:"1 d"},weekStartDay:null,inputTemplate:()=>"",ariaElement:"element"}),v(Vu,"$name","DateTimeField"),v(Vu,"type","datetimefield"),v(Vu,"alias","datetime"),Vu.initClass(),Vu._$name="DateTimeField";class zu extends vu{static get $name(){return"DurationField"}static get type(){return"durationfield"}static get alias(){return"duration"}static get defaultConfig(){return{value:null,step:1,unit:null,defaultUnit:"day",magnitude:null,useAbbreviation:!1,allowNegative:!1,decimalPrecision:null,triggers:{spin:{type:"spintrigger"}},nullValue:null}}static get configurable(){return{min:null,max:null,allowedUnits:null}}changeMin(e){return"string"==typeof e?new Bi(e):e}changeMax(e){return"string"==typeof e?new Bi(e):e}changeAllowedUnits(e){return"string"==typeof e&&(e=e.split(",")),e}updateAllowedUnits(e){this.allowedUnitsRe=new RegExp(`(${e.join("|")})`,"i")}get inputValue(){return null==this.value?"":this.calcValue(!0).toString(this.useAbbreviation)}set unit(e){this._unit=e,this.value=this.calcValue()}get unit(){return this._unit}get unitWithDefault(){return this._unit||zu.defaultConfig.defaultUnit}set magnitude(e){this.clearError("L{invalidUnit}"),this._magnitude=e,super.value=this.calcValue()}get magnitude(){return this._magnitude}roundMagnitude(e){return e&&null!=this.decimalPrecision?sn.round(e,this.decimalPrecision):e}get allowDecimals(){return 0!==this.decimalPrecision}get isValid(){const e=this,t=null==e.value||e.value&&null==e.value.magnitude;return super.isValid&&(t&&!e.required||!t&&(e.allowNegative||e.value.magnitude>=0))}internalOnChange(e){const t=this,n=t.value,r=t._lastValue;t.hasChanged(r,n)&&(t._lastValue=n,t.triggerFieldChange({value:n,event:e,userAction:!0,valid:t.isValid}))}onFocusOut(e){var t,n,r;return this.syncInputFieldValue(!0),null===(t=this.triggers)||void 0===t||null===(n=t.spin)||void 0===n||null===(r=n.clickRepeater)||void 0===r||r.cancel(),super.onFocusOut(e)}set value(e){const t=this;let n,r;if(this.clearError("L{invalidUnit}"),"number"==typeof e)n=e,r=t._unit;else if("string"==typeof e)if(/^\s*$/.test(e))n=null;else{const i=en.parseDuration(e,t.allowDecimals,t.unitWithDefault);i&&(!t.allowedUnitsRe||t.allowedUnitsRe.test(i.unit)?(r=i.unit,n=i.magnitude):t.setError("L{invalidUnit}"))}else e&&"unit"in e&&"magnitude"in e?(r=e.unit,n=e.magnitude):(r=null,n=null);t._magnitude===n&&t._unit===r||(t._magnitude=n,r&&(t._unit=r),super.value=t.calcValue())}okMax(e){return"number"==typeof e&&(e=new Bi({unit:this.unitWithDefault,magnitude:e})),null==this.max||e<=this.max}okMin(e){return"number"==typeof e&&(e=new Bi({unit:this.unitWithDefault,magnitude:e})),null==this.min||e>=this.min}get validity(){const e=this.value,t={};return null!=e&&(t.rangeUnderflow=!this.okMin(e),t.rangeOverflow=!this.okMax(e)),t.valid=!t.rangeUnderflow&&!t.rangeOverflow,t}get value(){return super.value}calcValue(e=!1){const t=this;return t._unit&&null!=t._magnitude||!t.clearable?new Bi(e?this.roundMagnitude(t._magnitude):this._magnitude,t.unitWithDefault):null}hasChanged(e,t){return t&&!e||!t&&e||t&&e&&!e.isEqual(t)}get milliseconds(){return this.value?this.value.milliseconds:0}onInternalKeyDown(e){"ArrowUp"===e.key?this.doSpinUp():"ArrowDown"===e.key&&this.doSpinDown()}doSpinUp(){const e=this;if(e.readOnly)return;let t=(e.magnitude||0)+e.step;e._isUserAction=!0,e.okMin(t)||(t=e.min),e.okMax(t)&&(e.value=t),e._isUserAction=!1}doSpinDown(){const e=this;if(e.readOnly)return;let t=(e.magnitude||0)-e.step;e.okMax(t)||(t=e.max),e.okMin(t)&&(e.allowNegative||(e.magnitude||0)>0)&&(e._isUserAction=!0,e.value=t,e._isUserAction=!1)}}zu.initClass(),zu._$name="DurationField";class Wu extends Za{static get $name(){return"Fit"}static get type(){return"fit"}static get configurable(){return{containerCls:"b-fit-container",itemCls:"b-fit-item"}}}Wu.initClass(),Wu._$name="Fit";class Uu extends ll{static get $name(){return"Editor"}static get type(){return"editor"}static get configurable(){return{positioned:!0,hidden:!0,layout:"fit",align:{align:"t0-t0",offset:[0,0]},hideTarget:!1,matchSize:!0,matchFont:!0,fitTargetContent:!1,inputField:"textfield",blurAction:"complete",completeKey:"Enter",cancelKey:"Escape",invalidAction:"block",completeOnChange:null,isolateFields:!0}}afterConfigure(){const e=this;super.afterConfigure(),e.onTargetSizeChange=e.onTargetSizeChange.bind(e),_n.on({element:e.element,keydown:"onKeyDown",contextmenu:"stopMouseEvents",mousedown:"stopMouseEvents",mouseover:"stopMouseEvents",mouseout:"stopMouseEvents",mouseup:"stopMouseEvents",click:"stopMouseEvents",dblclick:"stopMouseEvents",thisObj:e}),e.on({beforeHide:"beforeEditorHide",hide:"afterEditorHide",thisObj:e}),lt.on({locale:"onLocaleChange",thisObj:e})}onLocaleChange(){const{inputField:e}=this;e&&!e.isDestroyed&&e.syncInputFieldValue&&e.syncInputFieldValue(!0)}render(e){const t=this.element.parentNode,[n]=this.getRenderContext(this,e);n.classList.add("b-editing"),super.render(...arguments),null!=t&&t.classList&&n!==t&&t.classList.remove("b-editing")}async startEdit(e){const t=this;if(e=sn.assignIf(e,{align:t.align,hideTarget:t.hideTarget,matchSize:t.matchSize,matchFont:t.matchFont,fitTargetContent:t.fitTargetContent,focus:!0}),!1!==t.trigger("beforeStart",e)){var n,r,i;const{target:s,hideTarget:o,matchSize:a,matchFont:l,fitTargetContent:c,record:d,field:u=t.inputField.name,focus:h}=e,{inputField:g}=t,{input:m}=g,p=Mr.getStyleValue(s,"font-size"),v=Mr.getStyleValue(s,"font-family");let{value:y,align:b}=e;if(d&&u&&(t.record=d,t.dataField=u,void 0===y&&(y=d[u])),a&&(s instanceof HTMLElement&&t.updateSize(s,a),s instanceof HTMLElement&&ua.addResizeListener(s,t.onTargetSizeChange)),m&&(l?(m.style.fontSize=p,m.style.fontFamily=v):m.style.fontSize=m.style.fontFamily=""),t.assigningValues=!0,null===(n=g.clearError)||void 0===n||n.call(g),g.value=y,t.assigningValues=!1,"string"==typeof b&&(b={align:b}),await t.showBy(f({target:s,allowTargetOut:!0},b)),c){const e=m.scrollWidth-m.clientWidth;e>0&&(t.width+=e+Mr.scrollBarWidth)}return h&&(null===(r=g.focus)||void 0===r||r.call(g)),s.nodeType===Element.ELEMENT_NODE&&o&&s.classList.add("b-hide-visibility"),t.editing=!0,t.trigger("start",{value:g.value}),Array.isArray(g.value)&&g.editingRecords&&null!==(i=g.value[0])&&void 0!==i&&i.isModel?t.oldValue=g.value.map((e=>e.copy(e.id))):(t.oldValue=g.value,Array.isArray(t.oldValue)&&(t.oldValue=t.oldValue.slice())),g.initialValue=t.oldValue,!0}return!1}refreshEdit(){if(this.isVisible){const{record:e,dataField:t,inputField:n}=this;if(e&&t){const r=e[t];sn.isEqual(n.value,r)||(n.value=r)}}}finishEdit(){const{target:e,aligningToElement:t}=this.lastAlignSpec;t&&(e.classList.remove("b-editing"),e.classList.remove("b-hide-visibility")),this.editing=!1,this.trigger("finishEdit")}onKeyDown(e){var t;const n=this;switch(e.key){case n.completeKey:n.completeEdit(null,e),e.stopImmediatePropagation();break;case n.cancelKey:n.cancelEdit(e),e.stopImmediatePropagation()}null===(t=n.trigger)||void 0===t||t.call(n,"keydown",{event:e})}stopMouseEvents(e){this.allowMouseEvents||e.stopPropagation()}onFocusOut(e){super.onFocusOut(e);const t=this;if(!t.isFinishing&&t.editing)switch(t.blurAction){case"cancel":t.cancelEdit(e);break;case"complete":t.completeEdit(null,e)}}async completeEdit(e,t){const n=this,{inputField:r,oldValue:i,record:s}=n,o=r.invalidAction||(!1===r.allowInvalid?"block":n.invalidAction),{value:a}=r;if(n.isVisible){if(r.isValid||"allow"===o){if(sn.isEqual(a,i))return n.cancelEdit(t),!0;{const t={inputField:r,record:s,value:a,oldValue:i};if(!1!==n.trigger("beforeComplete",t)){var l;if(e||(e=t.finalize||(null===(l=t.editorContext)||void 0===l?void 0:l.finalize)),e){let s=await e(t);if(!0===s)n.onEditComplete();else{if(r.setError){const e=s||r.invalidValueError,t=()=>{n(),r.clearError(e)},n=r.on({change:t,input:t});r.setError(e)}var c;"block"===o?null===(c=r.focus)||void 0===c||c.call(r):"revert"===o&&(r.value=i,s=!0),s=!1}return s}return n.onEditComplete(),!0}var d;null===(d=r.focus)||void 0===d||d.call(r)}}else{var u;if("block"===o)return null===(u=r.focus)||void 0===u||u.call(r),!1;if("revert"===o)return n.cancelEdit(t),!0}return!1}}cancelEdit(e){const t=this,{inputField:n,oldValue:r}=t,{value:i}=n;t.editing&&!t.isFinishing&&!1!==t.trigger("beforeCancel",{value:i,oldValue:r,event:e})&&(t.isFinishing=!0,t.hide(),t.trigger("cancel",{value:i,oldValue:r,event:e}),t.finishEdit(),t.isFinishing=!1)}onEditComplete(){const e=this,{record:t,dataField:n,inputField:r,oldValue:i}=e,{value:s}=r;if(!e.isFinishing){if(e.isFinishing=!0,e.hide(),t){const e=`set${_.capitalize(n)}`;t[e]?t[e](s):n.includes(".")?t.set(n,s):t[n]=s}e.trigger("complete",{value:s,oldValue:i}),e.finishEdit(),e.isFinishing=!1}}doDestroy(){this.createdInputField&&this.inputField.destroy(),super.doDestroy()}set owner(e){this._owner=e}get owner(){return this._owner||Ka.fromElement(this.element.parentNode)}changeInputField(e,t){const n=this;return t&&t.destroy(),"string"==typeof e&&(e={type:e}),e instanceof Ka||(e=Ka.create(e),n.createdInputField=!0),n.completeOnChange&&e.on({change:"onInputFieldChange",thisObj:n}),e.parent=n,e}updateInputField(e){this.removeAll(),this.add(e)}get inputField(){return this.items[0]}onInputFieldChange(){this.containsFocus&&this.completeEdit()}onTargetSizeChange(e,t,n){t&&n&&this.updateSize(e)}updateSize(e,t=this.lastMatchSize){const n=this,r=xn.inner(e);n.width=!1===t.width?"auto":r.width-n.align.offset[0],n.height=!1===t.height?"auto":r.height,n.lastMatchSize=t}beforeEditorHide(){if(this.editing&&!this.isFinishing)return this.cancelEdit(),!1}afterEditorHide(){this.positioned&&this.element.remove(),ua.removeResizeListener(this.lastAlignSpec.target,this.onTargetSizeChange)}}Uu.initClass(),Uu._$name="Editor";const Yu=["number","boolean","string","date","duration"],Gu=e=>{var t;return"duration"===(null===(t=e.column)||void 0===t?void 0:t.type)};class qu extends ll{static get $name(){return"FieldFilterPicker"}static get type(){return"fieldfilterpicker"}static get defaultValueFieldPlaceholders(){return{string:"L{enterAValue}",number:"L{enterANumber}",date:"L{selectADate}",list:"L{selectOneOrMoreValues}",duration:"L{enterAValue}"}}afterConstruct(){const e=this;if(!e._fields)throw new Error(`${qu.name} requires 'fields' to be configured.`);if(!e._filter)throw new Error(`${qu.name} requires 'filter' to be configured.`);super.afterConstruct();const{widgetMap:{propertyPicker:t,operatorPicker:n,caseSensitive:r}}=e;t.on("select",e.onPropertySelect,e),n.on("select",e.onOperatorSelect,e),r.on("change",e.onCaseSensitiveChange,e),e.propertyFieldConfig&&t.setConfig(e.propertyFieldConfig),e.operatorFieldConfig&&n.setConfig(e.operatorFieldConfig),t.cls=e.allPropertyPickerClasses,n.cls=e.allOperatorPickerClasses,e.populateUIFromFilter()}changeDateFormat(e){return this.L(e)}get allChildInputs(){const{propertyPicker:e,operatorPicker:t,caseSensitive:n}=this.widgetMap;return[e,t,...this.valueFields,n]}updateDisabled(e){this.allChildInputs.forEach((t=>t.disabled=e))}updateReadOnly(e){const{propertyPicker:t,operatorPicker:n}=this.widgetMap;this.allChildInputs.forEach((t=>t.readOnly=e)),t.readOnly=t.readOnly||e,n.readOnly=n.readOnly||e}updatePropertyLocked(e){this.widgetMap.propertyPicker.readOnly=e||this.readOnly,this.widgetMap.propertyPicker.cls=this.allPropertyPickerClasses}updateOperatorLocked(e){this.widgetMap.operatorPicker.readOnly=e||this.readOnly,this.widgetMap.operatorPicker.cls=this.allOperatorPickerClasses}changeOperators(e){const t=null!=e?e:qu.defaultOperators;return Object.keys(t).reduce(((e,n)=>f(f({},e),{},{[n]:t[n].map((e=>f(f({},e),{},{text:this.L(e.text)})))})),{})}get isMultiSelectValueField(){var e;return["isIncludedIn","isNotIncludedIn"].includes(null===(e=this._filter)||void 0===e?void 0:e.operator)}get allPropertyPickerClasses(){var e;return new Mn(`b-${qu.type}-property`,null===(e=this.propertyFieldConfig)||void 0===e?void 0:e.cls,{[`b-${qu.type}-combo-locked`]:this.propertyLocked})}get allOperatorPickerClasses(){var e;return new Mn(`b-${qu.type}-operator`,null===(e=this.operatorFieldConfig)||void 0===e?void 0:e.cls,{[`b-${qu.type}-combo-locked`]:this.operatorLocked})}getValueFieldConfigs(){const e=this,{valueFieldCls:t,fieldType:n,_filter:{operator:r},onValueChange:i,filterValues:s,isMultiSelectValueField:o,operatorArgCount:a,getValueFieldConfig:l}=e,c=sn.merge({},qu.defaultValueFieldPlaceholders,e.valueFieldPlaceholders);if(!n||!r||0===a)return[];let d={type:"textfield",listeners:{change:i,input:i,thisObj:e},cls:t,dataset:{type:n},placeholder:e.L(c[o?"list":n])};return o?d=f(f({},d),{},{type:"combo",multiSelect:!0,createOnUnmatched:!0,items:this.getUniqueDataValues(s),value:null!=s?s:[]}):["number","date","boolean"].includes(n)?d.type=`${n}field`:"duration"===n&&(d.type="durationfield"),l&&(d=e.callback(l,e,[e.filter,d])),o?[d]:ke.populate(a,(t=>[{type:"widget",tag:"div",cls:`b-${qu.type}-value-separator`,content:e.L("L{FieldFilterPicker.and}")},f(f({},d),{},{value:s[t]})])).flat().slice(1)}getUniqueDataValues(e=[]){var t;const n=this,{fieldType:r}=n;if(!n.store||null===(t=n._filter)||void 0===t||!t.property)return[];let i=n.store.allRecords.map((e=>e[n._filter.property])).concat(e).filter((e=>null!=e));"date"===r?i=i.map((e=>e.valueOf())):"duration"===r&&(i=i.map((e=>e.toString())));const s=ke.unique(i).filter((e=>null!=e&&""!==String(e).trim()));let o;return o="string"===r?s.sort(n.sortStrings):"duration"===r?s.map((e=>new Bi(e))).filter((e=>e.isValid)).sort(n.sortDurations):s.sort(n.sortNumerics),"date"===r?o=o.map((e=>{const t=new Date(e);return{text:en.format(t,n.dateFormat),value:e}})):"duration"===r&&(o=o.map((e=>e.toString()))),o}sortStrings(e,t){return(null!=e?e:"").localeCompare(null!=t?t:"")}sortNumerics(e,t){return e-t}sortDurations(e,t){return e.valueOf()-t.valueOf()}get fieldType(){var e,t,n;const r=null===(e=this._filter)||void 0===e?void 0:e.property;return null===(t=this.fields)||void 0===t||null===(n=t.find((({name:e})=>e===r)))||void 0===n?void 0:n.type}get propertyOptions(){return this.fields.filter((e=>Yu.includes(e.type)||Gu(e))).map((({name:e,title:t})=>({value:e,text:null!=t?t:e}))).sort(((e,t)=>e.text.localeCompare(t.text)))}get operatorOptions(){return this.operators[this.fieldType]}updateOperators(){delete this._operatorArgCountLookup}get operatorArgCountLookup(){return this._operatorArgCountLookup||(this._operatorArgCountLookup=qu.buildOperatorArgCountLookup(this.operators))}updateFilter(){this._filter&&this.onFilterChange()}updateStore(e){var t;const n=this;null===(t=n._store)||void 0===t||t.un(n),null==e||e.on("refresh",n.onStoreRefresh,n)}onStoreRefresh({action:e}){this.isMultiSelectValueField&&["dataset","create","update","delete"].includes(e)&&(this.valueFields[0].items=this.getUniqueDataValues(this.filterValues))}refreshValueFields(){const e=this,{valueFieldRow:t}=e.widgetMap;t.removeAll(),t.add(e.getValueFieldConfigs()),delete e._valueFields,e.refreshCaseSensitive()}refreshCaseSensitive(){var e,t;const n=this,{fieldType:r,operatorArgCount:i,isMultiSelectValueField:s}=n,o=null===(e=n._filter)||void 0===e?void 0:e.operator,{caseSensitive:a}=n.widgetMap;a.hidden="string"!==r||!o||s||0===i,a.checked=!1!==(null===(t=n._filter)||void 0===t?void 0:t.caseSensitive)}onPropertySelect(e){var t;const n=this,{_filter:r}=n;r.property=(null===(t=e.record)||void 0===t?void 0:t.data.value)||null,n.fieldType!==n._fieldType&&(r.operator=null,r.value=null),n._fieldType=r.type=n.fieldType,n.refreshOperatorPicker(),n.refreshValueFields(),n.triggerChange()}onCaseSensitiveChange({checked:e}){this._filter.caseSensitive=e,this.triggerChange()}onOperatorSelect(e){var t;const n=this,r=n.isMultiSelectValueField,i=this.operatorArgCount;n._filter.operator=(null===(t=e.record)||void 0===t?void 0:t.data.value)||null,n.operatorArgCount!==i&&(n._filter.value=null),n.isMultiSelectValueField&&!r&&(n._filter.value=[]),n.refreshValueFields(),n.triggerChange()}triggerChange(){const{filter:e,isValid:t}=this;this.trigger("change",{filter:e,isValid:t})}onValueChange(){const{isMultiSelectValueField:e,fieldType:t,_filter:n}=this,r=this.valueFields.map((e=>e.value));e&&"date"===t?n.value=r[0].map((e=>new Date(e))):e&&"duration"===t?n.value=r[0].map((e=>new Bi(e))):("date"===t&&"between"===n.operator&&en.isValidDate(r[1])&&r[1].setHours(23,59,59,999),n.value=1===r.length?r[0]:r),this.triggerChange()}refreshOperatorPicker(){const{operatorPicker:e}=this.widgetMap,{_filter:{operator:t,property:n},operatorOptions:r}=this;e.items=r,e.value=t,e.hidden=null===n}populateUIFromFilter(e=!1){const t=this,{filterValues:n,widgetMap:{propertyPicker:r,operatorPicker:i},_filter:{property:s,operator:o,disabled:a},propertyOptions:l,operatorOptions:c,isMultiSelectValueField:d}=t;r.items=l,i.items=c,i.hidden=null===s;let u=e;r.value!==s&&(r.value=s,t.refreshOperatorPicker(),u=!0),i.value!==o&&(null===o?i.clear():i.value=o,u=!0),u&&t.refreshValueFields(),t.refreshCaseSensitive(),t.valueFields.forEach(((e,r)=>{d&&(e.value.length>0||n.length>0)?"date"===t.fieldType?e.value=n.map((e=>null==e?void 0:e.valueOf())):"duration"===t.fieldType?e.value=n.map((e=>null==e?void 0:e.toString())):e.value=n:r>=n.length?e.clear():e.value=n[r]})),t.allChildInputs.forEach((e=>e.disabled=t.disabled||a))}get valueFields(){return this._valueFields||(this._valueFields=this.widgetMap.valueFieldRow.queryAll((e=>["textfield","datefield","numberfield","durationfield","combo"].includes(e.type))))}get filterValues(){var e;return null==(null===(e=this._filter)||void 0===e?void 0:e.value)?[]:ke.asArray(this._filter.value)}onFilterChange(){const e=this,t=e.fieldType,n=t!==e._fieldType;e._fieldType=e._filter.type=t,e.populateUIFromFilter(n)}get operatorArgCount(){const{fieldType:e,filter:{operator:t},operatorArgCountLookup:n}=this;return e&&t?n[e][t]:1}get isValid(){const{filter:e,fieldType:t,filterValues:n,isMultiSelectValueField:r,operatorArgCount:i}=this,{operator:s}=e,o=i>0&&null==(null==e?void 0:e.value);return t&&s&&!o&&(r&&n.length>0||n.length===i)&&n.every((e=>null!=e&&("duration"!==t||e.isValid)))}}v(qu,"operators",{empty:{value:"empty",text:"L{isEmpty}",argCount:0},notEmpty:{value:"notEmpty",text:"L{isNotEmpty}",argCount:0},"=":{value:"=",text:"L{equals}"},"!=":{value:"!=",text:"L{doesNotEqual}"},">":{value:">",text:"L{isGreaterThan}"},"<":{value:"<",text:"L{isLessThan}"},">=":{value:">=",text:"L{isGreaterThanOrEqualTo}"},"<=":{value:"<=",text:"L{isLessThanOrEqualTo}"},between:{value:"between",text:"L{isBetween}",argCount:2},notBetween:{value:"notBetween",text:"L{isNotBetween}",argCount:2},isIncludedIn:{value:"isIncludedIn",text:"L{isOneOf}"},isNotIncludedIn:{value:"isNotIncludedIn",text:"L{isNotOneOf}"}}),v(qu,"defaultOperators",{string:[qu.operators.empty,qu.operators.notEmpty,qu.operators["="],qu.operators["!="],{value:"includes",text:"L{contains}"},{value:"doesNotInclude",text:"L{doesNotContain}"},{value:"startsWith",text:"L{startsWith}"},{value:"endsWith",text:"L{endsWith}"},qu.operators.isIncludedIn,qu.operators.isNotIncludedIn],number:[qu.operators.empty,qu.operators.notEmpty,qu.operators["="],qu.operators["!="],qu.operators[">"],qu.operators["<"],qu.operators[">="],qu.operators["<="],qu.operators.between,qu.operators.notBetween,qu.operators.isIncludedIn,qu.operators.isNotIncludedIn],date:[qu.operators.empty,qu.operators.notEmpty,qu.operators["="],qu.operators["!="],{value:"<",text:"L{isBefore}"},{value:">",text:"L{isAfter}"},qu.operators.between,{value:"isToday",text:"L{isToday}",argCount:0},{value:"isTomorrow",text:"L{isTomorrow}",argCount:0},{value:"isYesterday",text:"L{isYesterday}",argCount:0},{value:"isThisWeek",text:"L{isThisWeek}",argCount:0},{value:"isNextWeek",text:"L{isNextWeek}",argCount:0},{value:"isLastWeek",text:"L{isLastWeek}",argCount:0},{value:"isThisMonth",text:"L{isThisMonth}",argCount:0},{value:"isNextMonth",text:"L{isNextMonth}",argCount:0},{value:"isLastMonth",text:"L{isLastMonth}",argCount:0},{value:"isThisYear",text:"L{isThisYear}",argCount:0},{value:"isNextYear",text:"L{isNextYear}",argCount:0},{value:"isLastYear",text:"L{isLastYear}",argCount:0},{value:"isYearToDate",text:"L{isYearToDate}",argCount:0},qu.operators.isIncludedIn,qu.operators.isNotIncludedIn],boolean:[{value:"isTrue",text:"L{isTrue}",argCount:0},{value:"isFalse",text:"L{isFalse}",argCount:0}],duration:[qu.operators.empty,qu.operators.notEmpty,qu.operators["="],qu.operators["!="],qu.operators[">"],qu.operators["<"],qu.operators[">="],qu.operators["<="],qu.operators.between,qu.operators.notBetween,qu.operators.isIncludedIn,qu.operators.isNotIncludedIn]}),v(qu,"configurable",{fields:null,disabled:!1,readOnly:!1,layout:"vbox",propertyLocked:!1,operatorLocked:!1,filter:null,propertyFieldConfig:null,operatorFieldConfig:null,valueFieldCls:null,items:{propertyAndOperator:{type:"container",layout:"box",items:{propertyPicker:{type:"combo",items:{},cls:`b-${qu.type}-property`,placeholder:"L{FieldFilterPicker.selectAProperty}"},operatorPicker:{type:"combo",items:{},cls:`b-${qu.type}-operator`,placeholder:"L{FieldFilterPicker.selectAnOperator}"}}},valueFieldRow:{type:"container",cls:`b-${qu.type}-values`,items:{}},caseSensitive:{type:"checkbox",text:"L{FieldFilterPicker.caseSensitive}",cls:`b-${qu.type}-case-sensitive`}},operators:qu.defaultOperators,dateFormat:"L{FieldFilterPicker.dateFormat}",store:null,valueFieldPlaceholders:null,getValueFieldConfig:null}),v(qu,"buildOperatorArgCountLookup",(e=>ke.keyBy(Object.entries(e),(([e])=>e),(([,e])=>ke.keyBy(e,(({value:e})=>e),(({argCount:e})=>void 0===e?1:e)))))),qu.initClass(),qu._$name="FieldFilterPicker";class Ku extends Ka{compose(){const{text:e,html:t}=this;return{tag:"label",text:e,html:t}}}v(Ku,"$name","Label"),v(Ku,"type","label"),v(Ku,"configurable",{text:null,localizableProperties:["text"]}),Ku.initClass(),Ku._$name="Label";class Xu extends ll{static get $name(){return"FieldFilterPickerGroup"}static get type(){return"fieldfilterpickergroup"}afterConstruct(){const e=this;e.validateConfig();const{addFilterButton:t}=e.widgetMap;t.on("click",e.addFilter,e),t.text=e.L(t.text),e.store&&e.updateStore(e.store),super.afterConstruct()}changeDateFormat(e){return this.L(e)}validateConfig(){if(!this.fields&&!this.store)throw new Error("FieldFilterPickerGroup requires either a 'fields' or 'store' config property.")}get someFiltersNotShown(){return this.store&&this.store.filters.count>this.filters.length}updateFields(e){this.widgetMap.pickers.childItems.forEach((t=>t.fields=e))}updateFilters(e,t){const n=this;t&&t.filter((t=>!e.find((e=>e.id===t.id)))).forEach((e=>{var t;return null===(t=n.store)||void 0===t?void 0:t.removeFilter(e.id)})),e.forEach((e=>e.id=e.id||n.nextFilterId)),n.widgetMap.pickers.items=(null==e?void 0:e.map((e=>n.getPickerRowConfig(e))))||[]}changeFilters(e){const{canManageFilter:t}=this;return e&&t?e.filter((e=>this.callback(t,this,[e]))):e}updateStore(e){const t=this;t.detachListeners("store"),e&&(t.widgetMap.pickers.childItems.forEach((({widgetMap:{filterPicker:{filter:t,isValid:n}}})=>{e.removeFilter(t.id,!0),n&&e.addFilter(t,!0)})),e.filter(),t.appendFiltersFromStore(),e.on({name:"store",filter:"onStoreFilter",thisObj:t})),t.widgetMap.pickers.childItems.forEach((t=>t.store=e))}updateShowAddFilterButton(e){this.widgetMap.addFilterButton.hidden=!e}updateAddFilterButtonText(e){this.widgetMap.addFilterButton.text=null!=e?e:Xu.addFilterButtonDefaultText}appendFiltersFromStore(){const e=this;e.store.filters.forEach((t=>{var n;const r=e.canManage(t),{property:i,operator:s,value:o,id:a,disabled:l=!1,caseSensitive:c}=t;r&&i&&s&&(null===(n=e.filters)||void 0===n||!n.find((e=>e.id===a)))&&e.appendFilter({id:a,property:i,operator:s,value:o,disabled:l,caseSensitive:c})}))}canManage(e){const t=this;return!t.canManageFilter||!0===t.callback(t.canManageFilter,t,[e])}getFilterPickerConfig(e){const t=this,{fields:n,store:r,disabled:i,readOnly:s,valueFieldCls:o,operators:a,limitToProperty:l,dateFormat:c,getFieldFilterPickerConfig:d}=t;return f({type:t.constructor.childPickerType,fields:null!=n?n:r.fields,filter:e,store:r,disabled:i,readOnly:s,propertyLocked:Boolean(l),valueFieldCls:o,operators:a,dateFormat:c,listeners:{change:"onFilterPickerChange",thisObj:t},flex:1},d?t.callback(d,t,[e]):void 0)}getPickerRowConfig(e){const t=this,{disabled:n,readOnly:r,canDeleteFilter:i}=t;return{type:"container",layout:"box",layoutStyle:{alignItems:"start"},cls:`b-${Xu.type}-row`,dataset:{separatorText:t.L("L{FieldFilterPicker.and}")},items:{activeCheckbox:{type:"checkbox",disabled:n,readOnly:r,checked:!Boolean(e.disabled),listeners:{change:"onFilterActiveChange",thisObj:t},cls:`b-${Xu.type}-filter-active`},filterPicker:t.getFilterPickerConfig(e),removeButton:{type:"button",ref:"removeButton",disabled:n,readOnly:r,hidden:i&&!1===t.callback(i,t,[e]),cls:`b-transparent b-${Xu.type}-remove`,icon:"b-fa-trash",listeners:{click:"removeFilter",thisObj:t}}}}}get allInputs(){const e=[this.constructor.childPickerType,"button","checkbox"];return this.queryAll((t=>e.includes(t.type)))}updateDisabled(e){this.allInputs.forEach((t=>t.disabled=e))}updateReadOnly(e){this.allInputs.forEach((t=>t.readOnly=e))}onFilterActiveChange({source:e,checked:t}){const n=this,r=n.getFilterIndex(e),i=n.filters[r],s=n.getFilterPicker(r);i.disabled=!t,s.onFilterChange(),n.store&&s.isValid&&n.store.addFilter(i,!0),n.updateStoreFilter(),n.triggerChange()}onFilterPickerChange({source:e,filter:t,isValid:n}){const r=this,{store:i}=r,s=r.getFilterIndex(e);i&&(i.removeFilter(t.id,!0),n&&i.addFilter(t,!0),r.updateStoreFilter()),Object.assign(r.filters[s],t),r.triggerChange()}getFilterIndex(e){return this.widgetMap.pickers.childItems.indexOf(e.containingWidget)}getPickerRow(e){return this.widgetMap.pickers.childItems[e]}getFilterPicker(e){return this.getPickerRow(e).widgetMap.filterPicker}get nextFilterId(){return this._nextId=(this._nextId||0)+1,`${this.id}-filter-${this._nextId}`}removeFilter({source:e}){const t=this,n=t.getFilterIndex(e),r=t.filters[n],i=t.getPickerRow(n),s=t.query((e=>e.isFocusable&&"container"!==e.type&&!i.contains(e)));s&&s.focus(),t.removeFilterAt(n),t.store&&(t.store.removeFilter(r.id,!0),t.updateStoreFilter()),t.trigger("remove",{filter:r}),t.triggerChange()}addFilter({property:e=null,operator:t=null,value:n=null}={}){const r=this,{filters:i}=r,s={property:r.limitToProperty||e,operator:t,value:n,disabled:!1,id:r.nextFilterId,caseSensitive:!1};var o;r.appendFilter(s),r.getFilterPicker(i.length-1).isValid&&(null===(o=r.store)||void 0===o||o.addFilter(s,!0),r.store&&r.updateStoreFilter()),r.trigger("add",{filter:s}),r.triggerChange()}appendFilter(e){const t=this;t.limitToProperty&&e.property!==t.limitToProperty||(t.filters.push(e),t.widgetMap.pickers.add(t.getPickerRowConfig(e,t.filters.length-1)))}onStoreFilter(e){const t=this;if(t._isUpdatingStore)return;const{filters:n}=e,r=n.values.reduce(((e,t)=>f(f({},e),{},{[t.id]:t})),{});for(let e=t.filters.length-1;e>=0;e--){const n=t.filters[e],i=r[n.id],s=t.getPickerRow(e);if(s){const{filterPicker:r,activeCheckbox:o}=s.widgetMap;if(!i&&r.isValid)t.removeFilterAt(e);else if(void 0!==i){const{operator:e,value:t,property:s,disabled:a,caseSensitive:l}=i;n!==i&&Object.assign(n,{operator:e,value:t,property:s,disabled:a,caseSensitive:l}),r.filter=n,r.onFilterChange(),o.checked=!a}}}t.appendFiltersFromStore(),t.triggerChange()}removeFilterAt(e){const{widgetMap:{pickers:t},filters:n}=this;t.remove(t.childItems[e]),n.splice(e,1),this.triggerChange()}updateStoreFilter(){this._isUpdatingStore=!0,this.store.filter(),this._isUpdatingStore=!1}get value(){return this.filters}triggerChange(){this.trigger("change",{filters:this.value})}activateAll(){this.setAllActiveStatus(!0)}deactivateAll(){this.setAllActiveStatus(!1)}setAllActiveStatus(e){const t=this,{_filters:n,store:r}=t;n.forEach(((n,i)=>{if(e===n.disabled){const{filterPicker:s,activeCheckbox:o}=t.getPickerRow(i).widgetMap;n.disabled=!e,s.onFilterChange(),o.checked=e,e&&r&&s.isValid&&r.addFilter(n,!0)}})),t.updateStoreFilter()}}v(Xu,"addFilterButtonDefaultText","L{FieldFilterPickerGroup.addFilter}"),v(Xu,"configurable",{filters:[],fields:null,disabled:!1,readOnly:!1,layout:"vbox",store:null,limitToProperty:null,valueFieldCls:null,showAddFilterButton:!0,canDeleteFilter:null,getFieldFilterPickerConfig:null,canManageFilter:null,addFilterButtonText:null,items:{pickers:{type:"container",layout:"vbox",scrollable:!0,items:{}},addFilterButton:{type:"button",text:Xu.addFilterButtonDefaultText,cls:`b-${Xu.type}-add-button`,hidden:!0}},operators:null,dateFormat:"L{FieldFilterPicker.dateFormat}"}),v(Xu,"childPickerType","fieldfilterpicker"),Xu.initClass(),Xu._$name="FieldFilterPickerGroup";class Zu extends(kc.mixin(du)){static get $name(){return"FieldSet"}static get type(){return"fieldset"}static get configurable(){return{bodyTag:"fieldset",focusable:!1,inline:null,inlineInternal:null,layout:{type:"box",horizontal:!1}}}static get prototypeProperties(){return{flexRowCls:"b-hbox",flexColCls:"b-vbox"}}get bodyConfig(){const e=super.bodyConfig,{className:t}=e,{inlineInternal:n,hasLabel:r,title:i}=this;return delete e.html,t["b-inline"]=n,t["b-fieldset-has-label"]=r,i&&(e.children={legendElement:{tag:"legend",text:i,class:{"b-fieldset-legend":1}}}),e}compose(){const{inlineInternal:e,label:t,labelCls:n,labelWidth:r}=this;return{class:{"b-field":t,"b-vbox":!e},children:{"labelElement > headerElement":t?{tag:"label",html:t,class:{"b-label":1,"b-align-start":1,[n]:n},style:{width:Mr.unitize("width",r)[1]}}:null}}}syncInlineInternal(){var e;this.inlineInternal=null!==(e=this.inline)&&void 0!==e?e:null!=this.label&&"before"===this.labelPosition}updateDisabled(e,t){super.updateDisabled(e,t),this.eachWidget((t=>{t.disabled=e}),!1)}updateInline(){this.syncInlineInternal()}updateInlineInternal(e){this.layout.horizontal=e}updateLabel(){this.syncInlineInternal()}updateLabelPosition(){this.syncInlineInternal()}}Zu.initClass(),Zu._$name="FieldSet";class Ju extends fu{static get $name(){return"FileField"}static get type(){return"filefield"}static get configurable(){return{multiple:null,accept:null,inputType:"file",attributes:["multiple","accept"]}}get files(){return this.input.files}pickFile(){this.input.click()}get multiple(){return this._multiple?"":null}clear(){this.input.value=null}triggerChange(e){this.triggerFieldChange({event:e,value:this.input.value,oldValue:this._lastValue,userAction:!0,valid:!0})}}Ju.initClass(),Ju._$name="FileField";class Qu extends ll{static get $name(){return"FilePicker"}static get type(){return"filepicker"}static get defaultConfig(){return{defaultBindProperty:"value",buttonConfig:null,fileFieldConfig:null}}construct(e={}){const t=this;e.items=[Object.assign({type:"button",ref:"fileButton",text:"L{FilePicker.file}",localeClass:this},e.buttonConfig),Object.assign({type:"filefield",ref:"fileField",style:"display: none"},e.fileFieldConfig)].concat(e.items||[]),super.construct(e),t.button.on({click:t.onButtonClick,thisObj:t}),t.fileField.on({change:t.onFileFieldChange,thisObj:t}),t._thisIsAUsedExpression(t.fileTip)}get button(){return this.widgetMap.fileButton}get fileField(){return this.widgetMap.fileField}get files(){return this.fileField.files}get fileTip(){const e=this;return e._fileTip||(e._fileTip=new lu({cls:"b-file-tip",forElement:e.button.element,showOnHover:!0,align:"b-t",scrollAction:"realign",listeners:{beforeshow(){const t=e.files;return!(!t||!t.length||(this.html=`${Array.from(t).map((e=>e.name)).join("<br>")}`,0))}}}))}clear(){const e=this;e.fileField.clear(),e.button.badge="",e.trigger("clear")}onButtonClick({event:e}){this.fileField.pickFile(),e.preventDefault()}onFileFieldChange({valid:e}){const t=this;t.button.badge=t.files.length||"",t.triggerFieldChange({files:t.files,valid:e})}}Qu.initClass(),Qu._$name="FilePicker";class eh extends vu{static get $name(){return"FilterField"}static get type(){return"filterfield"}static get configurable(){return{field:null,store:null,filterFunction:null,clearable:!0,keyStrokeChangeDelay:100,onChange({value:e}){const{store:t,field:n,filterFunction:r}=this;if(t){const i=`${n||this.id}-Filter`;if(0===e.length)t.removeFilter(i);else{let s;r?s=t=>r(t,e):(e=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),s=t=>t.get(n).match(new RegExp(e,"i"))),t.filter({id:i,filterBy:s})}}}}}updateValue(e,t){super.updateValue(e,t),e&&this.isConfiguring&&this.onChange({value:e})}}eh.initClass(),eh._$name="FilterField";const th=[{ref:"cancelButton",cls:"b-messagedialog-cancelbutton b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelClick"},{ref:"okButton",cls:"b-messagedialog-okbutton b-raised b-blue",text:"L{Object.Ok}",onClick:"up.onOkClick"}];y.isWindows&&th.reverse();class nh extends Ic{static get $name(){return"MessageDialog"}static get type(){return"messagedialog"}static get configurable(){return{centered:!0,modal:!0,hidden:!0,autoShow:!1,closeAction:"hide",title:" ",lazyItems:{$config:["lazy"],value:[{cls:"b-messagedialog-message",ref:"message"},{type:"textfield",cls:"b-messagedialog-input",ref:"input"}]},showClass:null,bbar:{overflow:null,items:th}}}construct(){this.okButton=this.yesButton=1,this.cancelButton=3,super.construct(...arguments)}destroy(){}async confirm(){return this.showDialog("confirm",...arguments)}async alert(){return this.showDialog("alert",...arguments)}async prompt({textField:e}){const t=this.widgetMap.input;return Ka.reconfigure(t,e),t.value="",this.showDialog("prompt",...arguments)}showDialog(e,{message:t="",title:n=" ",cancelButton:r,okButton:i,rootElement:s=document.body}){const o=this;return o.rootElement=s,o.getConfig("lazyItems"),o.title=o.optionalL(n),o.widgetMap.message.html=o.optionalL(t),o.showClass=`b-messagedialog-${e}`,i&&(i="string"==typeof i?{text:i}:i),r&&(r="string"==typeof r?{text:r}:r),i=Object.assign({},o.widgetMap.okButton.initialConfig,i),r=Object.assign({},o.widgetMap.cancelButton.initialConfig,r),i.text=o.optionalL(i.text),r.text=o.optionalL(r.text),Ka.reconfigure(o.widgetMap.okButton,i),Ka.reconfigure(o.widgetMap.cancelButton,r),o.show(),o.promise=new Promise((e=>{o.resolve=e}))}show(){const e=Mr.getActiveElement(this.element);return this.owner=this.element.contains(e)?null:nh.fromElement(document.activeElement),super.show(...arguments)}updateShowClass(e,t){const{classList:n}=this.element;t&&n.remove(t),e&&n.add(e)}doResolve(e){const t=this,{resolve:n}=t;if(n){const r="b-messagedialog-prompt"===t.showClass;if(r&&e===t.okButton&&!t.widgetMap.input.isValid)return;t.resolve=t.reject=t.promise=null,n(r?{button:e,text:t.widgetMap.input.value}:e),t.hide()}}onInternalKeyDown(e){"Escape"===e.key&&(e.stopImmediatePropagation(),this.onCancelClick()),"Enter"===e.key&&(e.stopImmediatePropagation(),e.preventDefault(),this.onOkClick()),super.onInternalKeyDown(e)}onOkClick(){this.doResolve(rh.okButton)}onCancelClick(){this.doResolve(rh.cancelButton)}}nh.initClass();const rh=new nh;class ih extends bc{static get $name(){return"PagingToolbar"}static get type(){return"pagingtoolbar"}static get defaultConfig(){return{store:null,defaults:{localeClass:this},items:{firstPageButton:{onClick:"up.onFirstPageClick",icon:"b-icon-first",weight:100,tooltip:"L{PagingToolbar.firstPage}"},previousPageButton:{onClick:"up.onPreviousPageClick",icon:"b-icon-previous",weight:110,tooltip:"L{PagingToolbar.prevPage}"},pageNumber:{type:"numberfield",label:"L{page}",min:1,max:1,triggers:null,onChange:"up.onPageNumberChange",highlightExternalChange:!1,weight:120},pageCount:{type:"widget",cls:"b-pagecount b-toolbar-text",weight:130},nextPageButton:{onClick:"up.onNextPageClick",icon:"b-icon-next",weight:140,tooltip:"L{PagingToolbar.nextPage}"},lastPageButton:{onClick:"up.onLastPageClick",icon:"b-icon-last",weight:150,tooltip:"L{PagingToolbar.lastPage}"},separator:{type:"widget",cls:"b-toolbar-separator",weight:151},reloadButton:{onClick:"up.onReloadClick",icon:"b-icon-reload",weight:160,tooltip:"L{PagingToolbar.reload}"},spacer:{type:"widget",cls:"b-toolbar-fill",weight:161},dataSummary:{type:"widget",cls:"b-toolbar-text",weight:170}}}}set parent(e){super.parent=e,this.store||(this.store=e.store)}get parent(){return super.parent}set store(e){const t=this;t.detachListeners("store"),t._store=e,e&&(e.on({name:"store",beforerequest:"onStoreBeforeRequest",afterrequest:"onStoreChange",change:"onStoreChange",thisObj:t}),e.isLoading&&t.onStoreBeforeRequest())}get store(){return this._store}onStoreBeforeRequest(){this.eachWidget((e=>e.disable()))}updateLocalization(){this.updateSummary(),super.updateLocalization()}updateSummary(){const e=this,{pageCount:t,dataSummary:n}=e.widgetMap;let r=0,i=0,s=0,o=0,a=0;if(e.store){const{store:t}=e,{pageSize:n,currentPage:l}=t;r=t.count,i=t.lastPage,a=t.allCount,s=Math.max(0,(l-1)*n+1),o=Math.min(a,s+n-1)}t.html=e.L("L{pageCountTemplate}")({lastPage:i}),n.html=r?e.L("L{summaryTemplate}")({start:s,end:o,allCount:a}):e.L("L{noRecords}")}onStoreChange(){const e=this,{widgetMap:t,store:n}=e,{count:r,lastPage:i,currentPage:s}=n,{pageNumber:o,pageCount:a,firstPageButton:l,previousPageButton:c,nextPageButton:d,lastPageButton:u,dataSummary:h}=t;e.eachWidget((e=>e.enable())),o.value=s,o.max=i,h.disabled=o.disabled=a.disabled=!r,l.disabled=c.disabled=s<=1||!r,d.disabled=u.disabled=s>=i||!r,e.updateSummary()}onPageNumberChange({value:e}){this.store.currentPage!==e&&this.store.loadPage(e)}onFirstPageClick(){this.store.loadPage(1)}onPreviousPageClick(){this.store.previousPage()}onNextPageClick(){this.store.nextPage()}onLastPageClick(){this.store.loadPage(this.store.lastPage)}onReloadClick(){this.store.loadPage(this.store.currentPage)}}ih.initClass(),ih._$name="PagingToolbar";const{dockIsHorz:sh}=zl.maps,oh={up:["top","bottom"],right:["right","left"],down:["bottom","top"],left:["left","right"]},ah={top:0,down:0,left:1,bottom:2,up:2,right:3},lh={},ch={up:{from:"translate(0,0)",to:"translate(0,-100%)"},down:{from:"translate(0,0)",to:"translate(0,100%)"},left:{from:"translate(0,0)",to:"translate(-100%,0)"},right:{from:"translate(0,0)",to:"translate(100%,0)"}};class dh extends(zl.mixin(Zr)){static get $name(){return"PanelCollapserOverlay"}static get type(){return"overlay"}static get configurable(){return{autoCloseDelay:1e3,autoClose:!0,revealing:{value:null,$config:null,default:!1},recollapseTool:{type:"collapsetool",cls:"b-recollapse",collapsify:"overlay",handler(){var e;null===(e=this.collapsible)||void 0===e||e.toggleReveal()}}}}static get delayable(){return{doAutoClose:0}}doAutoClose(){this.toggleReveal(!1)}updateAutoCloseDelay(e){const{doAutoClose:t}=this;(t.suspended=null==e||e<0)||(t.delay=e,t.immediate=!e)}changeRecollapseTool(e){const t=this,{panel:n}=t;if(t.isConfiguring||t.isDestroying||!n||n.isDestroying)return e;n.tools={recollapse:e}}beforeCollapse(e){if(!1===super.beforeCollapse(e))return!1;this.panel.revealed&&(e.animation=null)}applyHeaderDock(e,t=!0){var n;null===(n=this.panel)||void 0===n||n.recompose(),super.applyHeaderDock(e,t)}collapseBegin(e){const t=this,{collapseDir:n,innerElement:r}=t,{animation:i}=e,{collapseTool:s,panel:o}=t;t.configuredWidth=o._lastWidth,t.configuredHeight=o._lastHeight,t.applyHeaderDock(!0);const a=t.lockInnerSize();if(null==s||s.element.classList.add("b-collapsed"),i){o.element.classList.add("b-collapsing"),a.moveTo(0,0);const s=a.clone(),l=oh[n];s[l[0]]=s[l[1]],i.element=t.innerElement,i.transform=ch[n],i.items=[{element:r,clip:{from:`rect(${a})`,to:`rect(${s})`}}],e.animation=bl.run(i)}}onComplete(e){var t,n;super.onComplete(e);const r=this,{panel:i}=r,{element:s}=i;r.autoCloseLeaveDetacher=null===(t=r.autoCloseLeaveDetacher)||void 0===t?void 0:t.call(r),r.autoCloseClickDetacher=null===(n=r.autoCloseClickDetacher)||void 0===n?void 0:n.call(r),r.doAutoClose.cancel(),"reveal"===e&&r.autoClose&&(i.containsFocus&&(r.autoCloseLeaveDetacher=_n.on({element:s,mouseenter:e=>{r.doAutoClose.cancel()},mouseleave:e=>{r.doAutoClose()}})),r.autoCloseClickDetacher=_n.on({element:document.body,mousedown:e=>{if(e.target!==s&&!s.contains(e.target)&&null!=r.autoCloseDelay){var t;const n=i.containsFocus&&(null===(t=i.focusInEvent)||void 0===t?void 0:t.relatedTarget)||Mr.getActiveElement(s);null!=n&&n.contains(e.target)||r.doAutoClose.now()}}}))}expandBegin(e){const t=this,{animation:n}=e,{collapseDir:r,collapseTool:i,innerElement:s,panel:o}=t,{element:a}=o;a.classList.remove("b-collapsed","b-collapsing"),t.restoreConfiguredSize(),t.lockInnerSize(!1);const l=t.lockInnerSize().moveTo(0,0),c=l.clone(),d=oh[r];null==i||i.element.classList.remove("b-collapsed"),n&&(a.classList.add("b-collapsed","b-expanding"),c[d[0]]=c[d[1]],n.element=s,n.transform={from:ch[r].to,to:ch[r].from},n.clip={from:`rect(${c})`,to:`rect(${l})`},e.animation=bl.run(n))}expandEnd(e){super.expandEnd(e);const{panel:t}=this;e.completed&&(t.revealed=!1),t.element.classList.remove("b-expanding")}expandRevert(e){super.expandRevert(e),this.panel.element.classList.add("b-expanding")}get innerElement(){return this.panel.overlayElement}get innerSizeElement(){return this.panel.element}get toolsConfig(){const{direction:e}=this,t=super.toolsConfig,n=this.recollapseTool;return n?f(f({},t),{},{recollapse:n&&sn.assign({direction:e.toLowerCase()},n)}):t}lockInnerSize(e=!0){const t=this,{panel:n}=t,r=e&&n.rectangle(),i=e?[0,0,0,0]:"",s=super.lockInnerSize(e);return e&&(i[ah[t.collapseDir]]=`-${r[t.collapseDim]+10}px`),n.element.style.clipPath=e?`inset(${i.join(" ")}`:"",s}onOverlayTransitionDone(e){const t=this,{panel:n}=t;e.srcElement===n.overlayElement&&t.revealing&&(t.revealing=!1,t.onComplete(n.revealed?"reveal":"unreveal"))}onRevealerClick(){this.toggleReveal()}splitHeaderItems({as:e,dock:t}=lh){var n;return null===(n=this.panel)||void 0===n?void 0:n.splitHeaderItems({as:e,dock:t,overlay:!0})}toggleReveal(e){const{panel:t}=this;t.collapsed&&(null==e&&(e=!t.revealed),t.revealed!==e&&(this.revealing=!0,t.revealed=!t.revealed))}updateRevealing(e){const t=this,{panel:n}=t,r=/left|right/i.test(t.collapseDir)?"height":"width";n&&(t.innerElement.style[r]=n.rectangle()[r]+"px",n.element.classList[e?"add":"remove"]("b-panel-overlay-revealing"))}wrapCollapser(e,t){var n;const r=this,{collapseDir:i,panel:s}=r,{expandedHeaderDock:o,header:a,uiClassList:l}=s,c=null===(n=s.tools)||void 0===n?void 0:n.recollapse,[d,u]=r.splitHeaderItems({dock:r.collapseDock,as:"element"}),h=sh[o],g=s.hasHeader?s.title||(null==a?void 0:a.title)||" ":null;return c&&(c.direction=i),["overlayElement",{class:f(f({},l),{},{[`b-panel-overlay-header-${o}`]:1,[`b-panel-overlay-${i}`]:1,[`b-${h?"h":"v"}box`]:1,"b-panel-overlay":1,"b-box-center":1}),listeners:{transitionend:e=>r.onOverlayTransitionDone(e)},children:{overlayHeaderElement:g&&{tag:"header",class:new Mn(f(f({},l),{},{[`b-dock-${o}`]:1,"b-panel-header":1,"b-panel-overlay-header":1}),null==a?void 0:a.cls),children:[...d,{reference:"overlayTitleElement",html:g,class:f(f({},l),{},{[`b-align-${(null==a?void 0:a.titleAlign)||"start"}`]:1,"b-header-title":1})},...u]},[e]:t}}]}}dh.initClass(),dh._$name="PanelCollapserOverlay";class uh extends fu{static get type(){return"passwordfield"}static get alias(){return"password"}static get $name(){return"PasswordField"}construct(e={}){e.inputType="password",super.construct(...arguments),this.element.classList.add("b-textfield")}}uh.initClass(),uh._$name="PasswordField";class hh extends Au{static get $name(){return"Radio"}static get type(){return"radio"}static get alias(){return"radiobutton"}static get configurable(){return{inputType:"radio",clearable:null,uncheckedValue:void 0}}get textLabelCls(){return super.textLabelCls+" b-radio-label"}internalOnClick(e){!1!==super.internalOnClick(e)&&this.checked&&this.clearable&&(this.checked=!1)}updateName(e){this.toggleGroup=e}updateClearable(){}}hh.initClass(),hh._$name="Radio";class gh extends Zu{static get $name(){return"RadioGroup"}static get type(){return"radiogroup"}static get configurable(){return{defaultType:"radio",clearable:null,name:null,options:{value:null,$config:{merge:"items"}},defaultBindProperty:"value"}}get existingOptions(){const{name:e}=this;return this.ensureItems().filter((t=>t.name===e))}get refPrefix(){return`${this.name||this.ref||this.id}_`}get selected(){return this.existingOptions.filter((e=>e.input.checked))[0]||null}get value(){const{selected:e}=this;return e?e.checkedValue:null}set value(e){this.existingOptions.forEach((t=>{t.isConfiguring=this.isConfiguring,t.checked=t.checkedValue===e,t.isConfiguring=!1}))}ensureItems(){return this.getConfig("options"),super.ensureItems()}changeOptions(e,t){if(!(e&&t&&sn.isDeeplyEqual(t,e)))return e}convertOption(e,t,n){const r=this,{name:i}=r,s={name:i,type:"radio",value:e===r.value,ref:`${r.refPrefix}${e}`,checkedValue:e};return"string"==typeof t?s.text=t:sn.assign(s,t),n?Ka.reconfigure(n,s):s}isOurRadio(e){return e.isRadio&&e.name===this.name}isolateFieldChange(e){return this.isOurRadio(e)}onChildAdd(e){super.onChildAdd(e),this.isOurRadio(e)&&e.on({name:e.id,beforeChange:"onRadioItemBeforeChange",change:"onRadioItemChange",click:"onRadioClick",thisObj:this})}onChildRemove(e){this.isOurRadio(e)&&this.detachListeners(e.id),super.onChildRemove(e)}onRadioClick(e){const{source:t}=e;t.checked&&this.clearable&&null==t.clearable&&(t.checked=!1)}onRadioItemBeforeChange(e){if(e.checked){const t=this,{lastValue:n}=t;if(!t.reverting&&!1===t.trigger("beforeChange",t.wrapRadioEvent(e))&&null!=n&&n!==t.value)return t.reverting=!0,e.source.uncheckToggleGroupMembers(),t.value=n,t.lastValue=n,t.reverting=!1,!1}}onRadioItemChange(e){const t=this;e.checked&&!t.reverting&&(t.triggerFieldChange(t.wrapRadioEvent(e)),t.lastValue=t.value)}wrapRadioEvent(e){return{from:e,item:e.source,userAction:e.userAction,lastValue:this.lastValue,value:this.value}}updateOptions(){const e=this,{options:t,refPrefix:n}=e,r=e.existingOptions.reduce(((e,t)=>(e[t.ref.substring(n.length)]=t,e)),{});let i,s,o=0;if(t)for(i in t)s=e.convertOption(i,t[i],r[i]),delete r[i],e.insert(s,o++);const a=Object.values(r);null!=a&&a.length&&(e.remove(a),a.forEach((e=>e.destroy())))}}gh.initClass(),gh._$name="RadioGroup";const mh={ArrowUp:1,ArrowDown:1,ArrowLeft:1,ArrowRight:1};class ph extends Ka{static get $name(){return"Slider"}static get type(){return"slider"}static get configurable(){return{text:null,showValue:!0,showTooltip:!1,min:0,max:100,step:1,value:50,unit:null,thumbSize:20,tooltip:{$config:["lazy","nullify"],value:{type:"tooltip",align:"b-t",anchor:!1,axisLock:!0}},localizableProperties:["text"],triggerChangeOnInput:null}}compose(){const{id:e,min:t,max:n,showValue:r,step:i,text:s,value:o,unit:a="",disabled:l}=this,c=`${e}-input`,d=Boolean(s||r);return{class:{"b-has-label":d,"b-text":d,"b-disabled":l},children:{input:{tag:"input",type:"range",id:c,reference:"input",disabled:l,min:t,max:n,step:i,value:o,listeners:{input:"onInternalInput",change:"onInternalChange",mouseover:"onInternalMouseOver",mouseout:"onInternalMouseOut"}},label:{tag:"label",for:c,html:r?s?`${s} (${o}${a})`:o+a:s}}}}get focusElement(){return this.input}get percentProgress(){return(this.value-this.min)/(this.max-this.min)*100}onInternalKeyDown(e){!this.readOnly&&mh[e.key]&&e.stopImmediatePropagation()}onInternalChange(){this.updateUI(),this.triggerChange(!0),this.trigger("action",{value:this.value})}onInternalInput(){const e=this;e.readOnly?e.input.value=e.value:(e.value=parseInt(e.input.value,10),e.trigger("input",{value:e.value}),e.triggerChangeOnInput&&e.triggerChange(e))}onInternalMouseOver(){var e;const t=this,n=t.rtl?100-t.percentProgress:t.percentProgress;null===(e=t.tooltip)||void 0===e||e.showBy({target:xn.from(t.input).inflate(t.thumbSize/2,-t.thumbSize/2),align:`b-t${Math.round(n)}`})}onInternalMouseOut(){var e;null===(e=this.tooltip)||void 0===e||e.hide()}triggerChange(e){this.triggerFieldChange({value:this.value,valid:!0,userAction:e})}updateMax(e){const t=this;t.input&&t._value>e&&(t.value=e,t.trigger("input",{value:t.value}))}updateMin(e){const t=this;t.input&&t._value<e&&(t.value=e,t.trigger("input",{value:t.value}))}changeTooltip(e,t){var n;return e&&(e.owner=this),this.showTooltip?lu.reconfigure(t,e,{owner:this,defaults:{forElement:this.input,html:String(this.value)+(null!==(n=this.unit)&&void 0!==n?n:"")}}):null}changeValue(e){const{min:t,step:n}=this;return(e=Math.min(Math.max(e,t),this.max))>t?t+sn.roundTo(e-t,n):sn.roundTo(e,n)}updateValue(e){const t=this,{input:n,_tooltip:r}=t;var i;r&&(r.html=t.value+(null!==(i=t.unit)&&void 0!==i?i:"")),n&&n.value!==String(e)&&(n.value=e,t.triggerChange(!1)),t.updateUI()}updateUI(){var e,t;const n=this;(null===(e=n._tooltip)||void 0===e?void 0:e.isVisible)&&(null===(t=n._tooltip)||void 0===t||t.alignTo({target:xn.from(n.input).inflate(n.thumbSize/2,-n.thumbSize/2),align:`b-t${Math.round(n.percentProgress)}`}))}}ph.initClass(),ph._$name="Slider";class fh extends Au{static get $name(){return"SlideToggle"}static get type(){return"slidetoggle"}static get properties(){return{toggledCls:"b-slidetoggle-checked"}}construct(e){null!=e&&e.checked&&(e.cls=(e.cls||"")+" "+this.constructor.properties.toggledCls),super.construct(e)}get innerElements(){const e=super.innerElements;return e.splice(1,0,this.toggleElement),this.text?e[e.length-1].class="b-slidetoggle-label":e.pop(),e}get toggleElement(){return{class:"b-slidetoggle-toggle",reference:"slideToggle",children:[{class:"b-slidetoggle-thumb",reference:"slideThumb"}]}}internalOnChange(){super.internalOnChange(),this.element.classList[this.value?"add":"remove"](this.toggledCls)}}fh.initClass(),fh._$name="SlideToggle";const vh=["b-horizontal","b-vertical"],yh=e=>"flex"===Mr.getStyleValue(e.parentElement,"display")&&(parseInt(Mr.getStyleValue(e,"flex-basis"),10)||parseInt(Mr.getStyleValue(e,"flex-grow"),10)),bh={horizontal:!1,vertical:!0};class Ch extends Ka{static get $name(){return"Splitter"}static get type(){return"splitter"}static get configurable(){return{orientation:"auto",vertical:null,containerElement:{$config:"nullify",value:null},nextNeighbor:{$config:"nullify",value:null},previousNeighbor:{$config:"nullify",value:null}}}static get delayable(){return{syncState:"raf"}}doDestroy(){var e;null===(e=this.mouseDetacher)||void 0===e||e.call(this),super.doDestroy()}compose(){return{class:{"b-splitter":1},listeners:f({pointerdown:"onMouseDown",mouseenter:"syncState"},!y.supportsPointerEvents&&{mousedown:"onMouseDown",touchstart:"onMouseDown"})}}get currentOrientation(){return this.vertical?"vertical":"horizontal"}get nextWidget(){return Ka.fromElement(this.element.nextElementSibling,1)}get previousWidget(){return Ka.fromElement(this.element.previousElementSibling,1)}updateContainerElement(e){var t;const n=this;n.stateDetector=null===(t=n.stateDetector)||void 0===t?void 0:t.disconnect(),e&&(n.stateDetector=new MutationObserver((()=>n.syncState())),n.stateDetector.observe(e,{attributes:!0,childList:!0}))}updateNextNeighbor(e){this.watchNeighbor(e,"next")}updatePreviousNeighbor(e){this.watchNeighbor(e,"previous")}watchNeighbor(e,t){this.detachListeners(t),null==e||e.on({name:t,thisObj:this,collapse:"syncState",expand:"syncState",hide:"syncState",show:"syncState"})}updateOrientation(){this.syncState.now()}updateVertical(e){var t;const n=null===(t=this.element)||void 0===t?void 0:t.classList;null==n||n.add(vh[e?1:0]),null==n||n.remove(vh[e?0:1])}syncState(){var e;const t=this,{element:n,nextWidget:r,previousWidget:i}=t;let s=null!==(e=bh[t.orientation])&&void 0!==e?e:null;if(t.nextNeighbor=r,t.previousNeighbor=i,t.disabled=r&&(r.collapsible&&r.collapsed||r.hidden)||i&&(i.collapsible&&i.collapsed||i.hidden),null!==s&&r&&i)t.containerElement=null;else if(t.containerElement=n.parentElement,t.rendered&&n.offsetParent){const e=Mr.getStyleValue(n.parentElement,"flex-direction");if(e)s=!e.startsWith("column");else{const e=n.previousElementSibling,t=n.nextElementSibling;if(!e||!t)return;const r=e.getBoundingClientRect(),i=t.getBoundingClientRect(),o=r.top<i.top?r:i,a=o===i?r:i;s=o.top===a.top}}t.vertical=s}onMouseDown(e){var t;e.preventDefault(),e.touches&&(e=e.touches[0]);const n=this,{element:r}=n,i=r.previousElementSibling,s=r.nextElementSibling,o=yh(i),a=yh(s),l=[];null===(t=n.mouseDetacher)||void 0===t||t.call(n);for(const e of r.parentElement.children)yh(e)&&e!==r&&l.push({element:e,width:e.offsetWidth,height:e.offsetHeight});n.context={startX:e.pageX,startY:e.pageY,prevWidth:i.offsetWidth,prevHeight:i.offsetHeight,nextWidth:s.offsetWidth,nextHeight:s.offsetHeight,prevHasFlex:o,nextHasFlex:a,flexed:l,prev:i,next:s};const c={element:document,pointermove:"onMouseMove",pointerup:"onMouseUp",thisObj:n};y.supportsPointerEvents||(c.mousemove=c.touchmove="onMouseMove",c.mouseup=c.touchend="onMouseUp"),r.classList.add("b-moving"),n.mouseDetacher=_n.on(c)}onMouseMove(e){const t=this,{context:n,nextWidget:r,previousWidget:i}=t,s=n.prev.style,o=n.next.style,a=(e.pageX-n.startX)*(t.rtl?-1:1),l=e.pageY-n.startY;if(e.preventDefault(),Object.assign(n,{deltaX:a,deltaY:l}),n.started||(n.started=!0,t.trigger("dragStart",{context:n,event:e}),n.flexed.forEach((e=>{e.element.style.flexGrow=t.vertical?e.width:e.height,e.element.style.flexBasis="0"}))),t.vertical){const e=n.prevWidth+a,t=n.nextWidth-a;n.prevHasFlex?s.flexGrow=e:i?i.width=e:s.width=`${e}px`,n.nextHasFlex?o.flexGrow=t:r?r.width=t:o.width=`${t}px`}else{const e=n.prevHeight+l,t=n.nextHeight-l;n.prevHasFlex?s.flexGrow=e:i?i.height=e:s.height=`${e}px`,n.nextHasFlex?o.flexGrow=t:r?r.height=t:o.height=`${t}px`}t.trigger("drag",{context:n,event:e})}onMouseUp(e){var t;const n=this;null===(t=n.mouseDetacher)||void 0===t||t.call(n),n.mouseDetacher=null,n.element.classList.remove("b-moving"),n.context.started&&n.trigger("drop",{context:n.context,event:e}),n.context=null}render(){super.render(...arguments),this.syncState.now(),null===this.vertical&&this.syncState()}}Ch.initClass(),Ch._$name="Splitter";class wh extends cc{static get $name(){return"Tab"}static get type(){return"tab"}static get configurable(){return{active:null,index:null,isFirst:null,isLast:null,item:{value:null,$config:"nullify"},itemCls:null,tabPanel:null,titleProperty:"text",titleSource:"title",role:"tab"}}compose(){const{active:e,cls:t,index:n,isFirst:r,isLast:i}=this;return{tabindex:0,"aria-selected":e,"aria-setsize":this.owner.visibleChildCount,"aria-posinset":n+1,class:f({"b-tabpanel-tab":1,"b-active":e,"b-tab-first":r,"b-tab-last":i},t),dataset:{index:n}}}updateIndex(e){this.isFirst=!e}updateItem(e,t){var n,r;const i=this;(null==t?void 0:t.tab)===i&&(t.tab=null),e&&(e.tab=i,i[i.titleProperty]=e[i.titleSource],i.itemCls=e.cls,i.ariaElement.setAttribute("aria-controls",e.id),e.role="tabpanel"),null===(n=i.itemChangeDetacher)||void 0===n||n.call(i),i.itemChangeDetacher=e&&$e.after(e,"onConfigChange","onItemConfigChange",i,{return:!1}),null===(r=i.itemHideDetacher)||void 0===r||r.call(i),i.itemHideDetacher=null==e?void 0:e.on({beforeChangeHidden:"onItemBeforeChangeHidden",beforeHide:"onItemBeforeHide",beforeUpdateDisabled:"onItemBeforeUpdateDisabled",thisObj:i,prio:1e3}),i.syncMinMax()}updateItemCls(e,t){const{element:n}=this,r=n&&Mn.from(null==n?void 0:n.classList,!0);n&&(r.remove(t).add(e),n.className=r.value)}updateRotate(e,t){!e!=!t&&this.syncMinMax()}syncMinMax(){const e=this,{rotate:t,tabPanel:n}=e;let{_minWidth:r,_minHeight:i,_maxWidth:s,_maxHeight:o}=e;if(n){const{tabMinWidth:a,tabMaxWidth:l}=n;null!=a&&(t?(r===a&&(r=null),i=a):(i===a&&(i=null),r=a)),null!=l&&(t?(s===l&&(s=null),o=l):(o===l&&(o=null),s=l)),e.minWidth=r,e.minHeight=i,e.maxWidth=s,e.maxHeight=o}}onItemBeforeChangeHidden({source:e,hidden:t}){if(!e.$isDeactivating&&!e.$isActivating){const{tabPanel:n}=this;this.hidden=t,t&&e===n.activeItem&&n.activateAvailableTab(e)}}onItemBeforeHide(){this.item.$isDeactivating||this.hide()}onItemBeforeUpdateDisabled({source:e,disabled:t}){const{tabPanel:n}=this;this.disabled=t,e===n.activeItem&&n.activateAvailableTab(e)}onItemConfigChange({name:e,value:t}){e===this.titleSource&&(this[this.titleProperty]=t)}}wh.initClass(),wh._$name="Tab";const Sh=e=>e.isTab;class Dh extends bc{static get $name(){return"TabBar"}static get type(){return"tabbar"}static get configurable(){return{defaultType:"tab",overflow:"scroll",role:"tablist",ignoreParentReadOnly:!0}}get firstTab(){return this.tabAt(0)}get lastTab(){return this.tabAt(-1)}get tabCount(){return this._items.countOf(Sh)}get tabs(){return ke.from(this._items,Sh)}compose(){return{children:{toolbarContent:{class:{"b-tabpanel-tabs":1}}}}}indexOfTab(e){return this._items.indexOf(e,Sh)}onChildAdd(e){super.onChildAdd(e),null==e.index&&this.syncTabs()}onChildRemove(e){super.onChildRemove(e),this.syncTabs()}onFocusIn(){const{activeIndex:e}=this.owner;isNaN(e)||this.tabs[e].focus()}syncTabs(){const{tabs:e}=this;for(let t=0,n=e.length;t<n;++t)e[t].index=t,e[t].isFirst=!t,e[t].isLast=t===n-1}tabAt(e){return this._items.find(Sh,e)||null}}Dh.initClass(),Dh._$name="TabBar";const Eh=["b-slide-out-left","b-slide-out-right","b-slide-in-left","b-slide-in-right"];class xh extends Za{static get $name(){return"Card"}static get type(){return"card"}static get configurable(){return{containerCls:"b-card-container",itemCls:"b-card-item",hideChildHeaderCls:"b-hide-child-headers",animateCardChange:!0,activeItem:null,activeIndex:null}}onChildAdd(e){super.onChildAdd(e);const t=this,{activeItem:n,owner:r}=t,i=null!=r.activeIndex?r.activeIndex:t.activeIndex||0,s=r.items.indexOf(e),o=null!=n?e===n:s===i;e.on({beforeHide:"onBeforeChildHide",beforeShow:"onBeforeChildShow",thisObj:t}),o?(t._activeIndex=s,t._activeItem=e,e.show()):(e.$isDeactivating=!0,e.hide(),e.$isDeactivating=!1)}onChildRemove(e){super.onChildRemove(e),this._activeItem===e&&this.activateSiblingOf(e),this._activeIndex=this.owner.items.indexOf(this._activeItem),e.un({beforeHide:"onBeforeChildHide",beforeShow:"onBeforeChildShow",thisObj:this})}onBeforeChildShow({source:e}){if(!this.owner.isConfiguring&&!e.$isActivating)return this.activeItem=e,!1}onBeforeChildHide({source:e}){if(!this.owner.isConfiguring&&!e.$isDeactivating)return this.activateSiblingOf(e),!1}activateSiblingOf(e){const{owner:t}=this,n=t.items.slice(),r=n.indexOf(e);n.splice(r,1),this.activeIndex=Math.min(r,n.length-1)}setActiveItem(e,t=this.activeIndex,n){const r=this,{owner:i}=r,{items:s}=i,o=e instanceof Ka,a=s[t],l=i.items[e=o?s.indexOf(e):parseInt(e,10)],c=!1!==(null==n?void 0:n.animation),d=!(null!=n&&n.silent),u={prevActiveIndex:t,prevActiveItem:a};if(l&&!l.$isActivating&&l!==a){var h;const s=a&&a.element,o=l&&l.element;if(r.animateDetacher){const e=r.animateDetacher.event;if(e.activeItem===l)return e.promise;r.animateDetacher(),e.prevActiveItem.element.classList.remove(...Eh),e.activeItem.element.classList.remove(...Eh),r.animateDetacher=null}if(u.activeIndex=e,u.activeItem=l,d&&!1===i.trigger("beforeActiveItemChange",u))return null;const g=r._activeIndex!==u.activeIndex;g&&(r._activeIndex=u.activeIndex),d&&(null===(h=i.onBeginActiveItemChange)||void 0===h||h.call(i,u)),g&&(r._activeIndex=u.prevActiveIndex),c&&s&&i.isVisible&&r.animateCardChange?u.promise=r.cardChangeAnimation=new Promise(((c,h)=>{const g=a.monitorResize;a.monitorResize=!1,r.contentElement.style.overflowX="hidden",a._hidden=!0,l.$isActivating=!0,l.show(),l.$isActivating=!1,s.classList.add(e>t?"b-slide-out-left":"b-slide-out-right"),o.classList.add(e<t?"b-slide-in-left":"b-slide-in-right"),i.isAnimating=!0,r.animateDetacher=_n.onTransitionEnd({mode:"animation",element:o,thisObj:a,handler(){i.isAnimating=r.cardChangeAnimation=!1,r.animateDetacher?(r.animateDetacher=null,o.classList.remove(...Eh),s&&(s.classList.remove(...Eh),a.$isDeactivating=!0,a._hidden=!1,a.hide(),a.monitorResize=g,a.$isDeactivating=!1),r.contentElement.style.overflowX="",r.onActiveItemChange(u,c,!d)):r.setActiveItem(e,t,n)}}),r.animateDetacher.reject=h,r.animateDetacher.event=u})):(l.$isActivating=!0,l.show(),l.focus(),l.$isActivating=!1,a&&(a.$isDeactivating=!0,a.hide(),a.$isDeactivating=!1),r.onActiveItemChange(u,null,!d))}return u}onActiveItemChange(e,t,n){const r=this;r._activeItem=e.activeItem,r._activeIndex=e.activeIndex,!n&&r.owner.trigger("activeItemChange",e),e.activeItem.focus(),null==t||t(e)}renderChildren(){const{owner:e}=this;e.contentElement.classList.toggle(this.hideChildHeaderCls,e.suppressChildHeaders),super.renderChildren()}changeActiveIndex(e){const{owner:t}=this;return t.isConfiguring&&!t._items?e:Math.min(e,t.items.length-1)}updateActiveIndex(e,t){this.owner.isConfiguring||this.setActiveItem(e,t)}updateActiveItem(e){this.owner.isConfiguring||this.setActiveItem(e,this.activeIndex)}}xh.initClass(),xh._$name="Card";class Rh extends kc{static get $name(){return"TabPanel"}static get type(){return"tabpanel"}static get alias(){return"tabs"}static get configurable(){return{activeTab:0,animateTabChange:!0,autoHeight:!1,defaultType:"container",focusable:!1,itemCls:"b-tabpanel-item",layout:{type:"card"},suppressChildHeaders:!0,tabBar:{type:"tabbar",weight:-2e3},tabMinWidth:null,tabMaxWidth:null}}get activeIndex(){return this.layout.activeIndex}get activeItem(){return this.layout.activeItem}get activeTabItemIndex(){var e;const{activeTab:t,items:n,tabBar:r}=this;return n.indexOf(null===(e=r.tabs[t])||void 0===e?void 0:e.item)}get bodyConfig(){return sn.merge({className:{"b-tabpanel-body":1}},super.bodyConfig)}get focusElement(){var e;const t=this.items[this.activeTab||0];return(null==t?void 0:t.focusElement)||(null==t||null===(e=t.tab)||void 0===e?void 0:e.focusElement)}get tabPanelBody(){return this.bodyElement}finalizeInit(){super.finalizeInit();const e=this,{activeTab:t,layout:n}=e,{activeIndex:r}=n,{tabs:i}=e.tabBar,s=t>=0&&t<i.length&&e.items.indexOf(i[t].item);if(i.length>0&&(!1===s||s<0))throw new Error(`Invalid activeTab ${t} (${i.length} tabs)`);s!==r&&n.setActiveItem(s,r,{animation:!1,silent:!0}),n.animateCardChange=e.animateTabChange}onChildAdd(e){if(super.onChildAdd(e),!this.initialItems){const t=this,{tabBar:n}=t,r=t.makeTabConfig(e),i=r&&(null==n?void 0:n.firstTab),s=i&&n._items,o=i&&ke.from(t._items,(t=>t.tab||t===e)),a=i?o.indexOf(e)+s.indexOf(i):0;r&&n&&(i&&null==e.weight&&a<s.count-1?n.insert(r,a):n.add(r))}}onChildRemove(e){const{tab:t}=e,{items:n}=this;t&&(this.tabBar.remove(t),t.destroy()),e===this.activeItem&&(this._activeTab=null,n.length&&(this.activeTab=n[Math.min(this.activeIndex,n.length-1)])),super.onChildRemove(e)}isDisabledOrHiddenTab(e){const{tabs:t}=this.tabBar,n=null==t?void 0:t[e];return n&&(n.disabled||n.hidden)}findAvailableTab(e,t=1){const{tabs:n}=this.tabBar,r=n.length,i=Math.max(0,n.indexOf(e.tab));let s;i&&(t=-t);for(let e=1;e<=r&&(s=(i+(t<0?r:0)+e*t)%r,this.isDisabledOrHiddenTab(s));++e);return s}activateAvailableTab(e,t=1){this.activeTab=this.findAvailableTab(e,t)}changeActiveTab(e,t){const n=this,{tabBar:r,layout:i}=n,{tabCount:s}=r;if(e.isWidget||sn.isObject(e)?(-1===n.items.indexOf(e)&&(e=n.add(e)),e=r.indexOfTab(e.tab)):e=parseInt(e,10),!n.initialItems&&s>0&&(e<-1||e>=s))throw new Error(`Invalid activeTab ${e} (${s} tabs)`);if(n.isDisabledOrHiddenTab(e)&&(e=n.findAvailableTab(e)),!i.animateCardChange||!i.cardChangeAnimation)return e;i.cardChangeAnimation.then((r=>{(null==r?void 0:r.activeIndex)!==e&&(n._activeTab=e,n.updateActiveTab(e,t))}))}async updateActiveTab(){if(!this.initialItems){const{activeTabItemIndex:t,layout:n}=this;var e;t>-1&&(n.animateCardChange&&await this.tabSelectionPromise,this.tabSelectionPromise=null===(e=n.setActiveItem(this.items[t]))||void 0===e?void 0:e.promise)}}changeTabBar(e){return this.getConfig("strips"),this.strips={tabBar:e},this.strips.tabBar}makeTabConfig(e){const{tab:t}=e,n={item:e,type:"tab",tabPanel:this,disabled:Boolean(e.disabled),hidden:e.initialConfig.hidden,weight:e.weight||0,listeners:{click:"onTabClick",thisObj:this},localizableProperties:{text:!1}};return!1===t?null:sn.isObject(t)?wh.mergeConfigs(n,t):n}updateItems(e,t){const n=this,{activeTab:r,initialItems:i}=n;let s,o=0;super.updateItems(e,t),i&&(s=Array.from(e,(e=>n.makeTabConfig(e))).filter((e=>{if(e)return e.index=o++,!0})),o&&(s[0].isFirst=!0,s[o-1].isLast=!0,s[r].active=!0,n.tabBar.add(s),n.activeTab=r))}updateTabMinWidth(e){var t;null===(t=this.tabBar)||void 0===t||t.items.forEach((t=>{t.isTab&&(t.minWidth=e)}))}updateTabMaxWidth(e){var t;null===(t=this.tabBar)||void 0===t||t.items.forEach((t=>{t.isTab&&(t.maxWidth=e)}))}updateAutoHeight(e){this.detachListeners("themeAutoHeight"),e&&zr.on({name:"themeAutoHeight",theme:"internalOnThemeChange",thisObj:this}),this.$measureHeight=e}applyAutoHeight(){const e=this,{layout:t,activeTab:n,element:r}=e,{animateCardChange:i}=t;t.animateCardChange=!1,e.height=null,e.height=Math.max(...e.items.map((t=>(e.activeTab=t,r.clientHeight))))+1,e.activeTab=n,t.animateCardChange=i,e.$measureHeight=!1}internalOnThemeChange(){this.isVisible?this.applyAutoHeight():this.$measureHeight=!0}onBeginActiveItemChange(e){const t=this.tabBar.tabs,{activeItem:n,prevActiveItem:r}=e;this.activeTab=t.indexOf(null==n?void 0:n.tab),null!=r&&r.tab&&(r.tab.active=!1),null!=n&&n.tab&&(n.tab.active=!0,n.tab.show())}onBeforeActiveItemChange(e){return this.trigger("beforeTabChange",e)}onActiveItemChange(e){this.trigger("tabChange",e)}onTabClick(e){this.activeTab=e.source.item}onPaint(){super.onPaint(...arguments),this.$measureHeight&&this.applyAutoHeight()}}Rh.initClass(),Rh._$name="TabPanel";class Th extends fu{static get $name(){return"TextAreaField"}static get type(){return"textareafield"}static get alias(){return"textarea"}static get configurable(){return{resize:"none",inputAttributes:{tag:"textarea"}}}updateResize(e){this.input.style.resize=e}}Th.initClass(),Th._$name="TextAreaField";class Mh extends yu{static get $name(){return"TextAreaPickerField"}static get type(){return"textareapickerfield"}static get configurable(){return{picker:{type:"widget",tag:"textarea",cls:"b-textareapickerfield-picker",scrollAction:"realign",align:{align:"t-b",axisLock:!0},autoShow:!1},triggers:{expand:{cls:"b-icon-picker",handler:"onTriggerClick"}},resize:"none",inputType:null}}startConfigure(e){"boolean"==typeof e.inline&&K.deprecate("Core","6.0.0","TextAreaPickerField.inline config is no longer supported"),super.startConfigure(e)}get inputElement(){const e=super.inputElement;return e.readOnly="readonly",e.reference="displayElement",this.ariaElement="displayElement",e}get focusElement(){var e;return null!==(e=this._picker)&&void 0!==e&&e.isVisible?this.input:this.displayElement}get needsInputSync(){var e;return this.displayElement[this.inputValueAttr]!==String(null!==(e=this.inputValue)&&void 0!==e?e:"")}showPicker(){const e=this,{picker:t}=e;e.inline||(t.width=e.pickerWidth||e[e.pickerAlignElement].offsetWidth,super.showPicker(!0))}focusPicker(){this.input.focus()}onPickerKeyDown(e){const t=this,n=t.input;switch(e.key.trim()||e.code){case"Escape":return void t.picker.hide();case"Enter":e.ctrlKey&&(t.syncInputFieldValue(),t.picker.hide())}t.input=t.displayElement;const r=super.onPickerKeyDown(e);return t.input=n,r}syncInputFieldValue(e){this.displayElement&&(this.displayElement.value=this.inputValue),super.syncInputFieldValue(e)}changeValue(e){return null==e?"":e}changePicker(e,t){var n,r;const i=this,s=i.pickerWidth||(null===(n=e)||void 0===n?void 0:n.width);if(e=Mh.reconfigure(t,e?Y.merge({owner:i,forElement:i[i.pickerAlignElement],align:{matchSize:null==s,anchor:i.overlayAnchor,target:i[i.pickerAlignElement]},id:i.id+"-input",style:{resize:i.resize},html:null!==(r=i.value)&&void 0!==r?r:""},e):null,i)){const t=i.input=e.element;i.inputListenerRemover=_n.on({element:t,thisObj:i,focus:"internalOnInputFocus",change:"internalOnChange",input:"internalOnInput",keydown:"internalOnKeyEvent",keypress:"internalOnKeyEvent",keyup:"internalOnKeyEvent"})}return e}}Mh.initClass(),Mh._$name="TextAreaPickerField";var kh=e=>{var t;return v(t=class extends(e||Te){compose(){const{minified:e}=this;return{class:{"b-minified":e}}}get widgetClass(){}},"$name","Minifiable"),v(t,"configurable",{minifiable:!0,minified:null}),t};const Ih=[],Ah=e=>"*"!==e[0],Fh=(e,t)=>{const n=e[t]||null;return delete e[t],n},Oh=e=>e.responsiveRoot,Lh={number:e=>({width:t})=>t<=e&&e},Ph=e=>(delete e.once,{callback:Fh(e,"callback"),configs:e,when:Fh(e,"when")}),$h=(e,...t)=>{const n=t.flatMap((e=>(null==e?void 0:e.once)||Ih)),r=e.mergeConfigs(...t),i=Ph(r);return i.once=n.length?Ph(e.mergeConfigs(...n)):null,i};var _h=e=>{var t;return t=class extends((e||Te).mixin(Zr,Nd)){get isResponsivePending(){return 0===this.responsiveUpdateCount&&this.hasConfig("responsive")}get isResponsiveUpdating(){var e;return this._responsiveUpdating||(null===(e=this.responsiveWidget)||void 0===e?void 0:e._responsiveUpdating)}updateResponsive(e){const t=this,n=t.constructor,{responsiveDefaults:r}=t,i=Array.from(new Set(sn.keys(e).concat(sn.keys(r)))).filter(Ah);let s,o,a,l,c=null;if(e)for(o of(c={"*":$h(n,r["*"],e["*"])},i)){var d;a=e[o],null!==a&&!1!==a&&(s=s||a&&"when"in a,c[o]=$h(n,r["*"],r[o],e["*"],a),l=c[o].when,c[o].when=(null===(d=Lh[typeof l])||void 0===d?void 0:d.call(Lh,l))||l)}t.$responsiveStates=c,t.$responsiveWhen=s,t.syncResponsiveWidget()}updateResponsiveState(e,t){var n;const r=this,{$responsiveStates:i}=r,s=1==++r.responsiveStateChanges,o=null===(n=r.element)||void 0===n?void 0:n.classList,a=i["*"],l=i[e]||a,c=s&&(l.once||a.once),d=s&&r.isStateful,u=r.responsiveWidget;let h=l.configs,g=null==c?void 0:c.configs;g&&(h=h?r.constructor.mergeConfigs(h,g):g),t&&(null==o||o.remove(`b-responsive-${t.toLowerCase()}`)),e&&(null==o||o.add(`b-responsive-${e.toLowerCase()}`)),d&&(g=r.loadStatefulData(),g&&(h=h?r.constructor.mergeConfigs(h,g):g),r.suspendStateful()),r._responsiveUpdating=!0;try{var m,p,f,v;null===(m=r.trigger)||void 0===m||m.call(r,"beforeResponsiveStateChange",{state:e,oldState:t,target:u}),h&&r.setConfig(h),null===(p=l.callback)||void 0===p||p.call(l,{source:r,state:e,oldState:t,target:u,initial:s}),null==c||null===(f=c.callback)||void 0===f||f.call(c,{source:r,state:e,oldState:t,target:u,initial:s}),null===(v=r.trigger)||void 0===v||v.call(r,"responsiveStateChange",{state:e,oldState:t,target:u})}finally{r._responsiveUpdating=!1,d&&r.resumeStateful()}}get responsiveTarget(){return this.responsiveWidget||this._responsiveTarget}updateResponsiveTarget(){this.syncResponsiveWidget()}updateResponsiveWidget(e){var t;const n=this,r=e&&n.responsiveUpdate;null===(t=n.$responsiveWrapper)||void 0===t||t.destroy(),n.$responsiveWrapper=e&&((e,t)=>{let n,r=Proxy.revocable(e,{get(t,r){return n&&(n[r]=!0),e[r]}}),i=$e.after(e,"onConfigChange",((e,{name:r})=>{var i;null!==(i=n)&&void 0!==i&&i[r]&&t()})),s=e.on({resize:()=>{t()}});return e.monitorResize=!0,{widget:e,get object(){var e;return null===(e=r)||void 0===e?void 0:e.proxy},destroy(){r&&(r.revoke(),i(),s(),r=i=s=null)},reset(){n=Object.create(null)}}})(e,r),null==r||r.now()}responsiveUpdate(){const e=this,{$responsiveStates:t,$responsiveWrapper:n}=e,r=null==n?void 0:n.widget;if(t&&n){let i,s,o=null,a=0,l=t;for(s in r&&r!==e&&!e.$responsiveWhen&&(r.getConfig("responsive"),l=r.$responsiveStates||l),n.reset(),t)"*"!==s&&(i=l[s].when(n.object,y),null!=i&&!1!==i&&(!o||i<a)&&(o=s,a=i));++e.responsiveUpdateCount,e.responsiveState=o}}syncResponsiveWidget(){const e=this;let t,n=null;if(!e.isDestroying&&e.responsive){var r;if(t=e.responsiveTarget,n=t){if("string"==typeof t&&(n="@"===t?e:"@"===t[0]?e[t.substring(1)]:e.up(t),!n))throw new Error(`No match for responsiveTarget="${t}"`)}else n=!e.responsiveRoot&&(null===(r=e.up)||void 0===r?void 0:r.call(e,Oh))||e;if(!n.isWidget)throw new Error(`${n.constructor.$$name} is not a widget and cannot be a responsiveTarget`)}return e.responsiveWidget=n,n}changeBreakpoints(e){return sn.assertObject(e,"breakpoints"),null!=e&&e.width&&Object.keys(e.width).forEach((t=>{e.width[t].maxWidth=t})),null!=e&&e.height&&Object.keys(e.height).forEach((t=>{e.height[t].maxHeight=t})),e}updateBreakpoints(e){e&&(this.monitorResize=!0)}getBreakpoint(e,t){const n=Object.keys(e).map((e=>parseInt(e))).sort().find((e=>t<=e));return e[null!=n?n:e["*"]&&"*"]}activateBreakpoint(e,t){const n=this,r=n[`current${e}Breakpoint`];var i,s;t!==r&&(n[`current${e}Breakpoint`]=t,n.setConfig(t.configs),r&&n.element.classList.remove(`b-breakpoint-${r.name.toLowerCase()}`),n.element.classList.add(`b-breakpoint-${t.name.toLowerCase()}`),n.trigger(`responsive${e}Change`,{breakpoint:t,prevBreakpoint:r}),null===(i=t.callback)||void 0===i||i.call(t,{source:n,breakpoint:t,prevBreakpoint:r}),null===(s=n.recompose)||void 0===s||s.call(n))}applyResponsiveBreakpoints(e,t){var n;const r=this,{width:i,height:s}=null!==(n=r.breakpoints)&&void 0!==n?n:{};if(i){const t=r.getBreakpoint(i,e);r.activateBreakpoint("Width",t)}if(s){const e=r.getBreakpoint(s,t);r.activateBreakpoint("Height",e)}}onInternalResize(e,t,n,r,i){super.onInternalResize(e,t,n,r,i),this.applyResponsiveBreakpoints(t,n)}},v(t,"$name","Responsive"),v(t,"configurable",{responsive:{$config:{lazy:"paint"},value:null},responsiveDefaults:{small:{when:400},medium:{when:800},large:{when:()=>1/0},"*":{}},responsiveRoot:null,responsiveState:null,responsiveTarget:{value:null,$config:{lazy:"paint"}},responsiveWidget:{value:null,$config:{nullify:!0}},breakpoints:null}),v(t,"delayable",{responsiveUpdate:"raf"}),v(t,"fenced",{syncResponsiveWidget:!0}),v(t,"prototypeProperties",{responsiveStateChanges:0,responsiveUpdateCount:0}),t};const Nh="http://www.w3.org/2000/svg",Hh={bar:1,outline:2,text:3},Bh=(e,t)=>parseInt(e.dataset.order,10)-parseInt(t.dataset.order,10),jh=e=>e.field,Vh=()=>!1;class zh extends Ka{static get type(){return"histogram"}static get $name(){return"Histogram"}static get defaultConfig(){return{data:null,values:null,series:null,topValue:null,element:{children:[{ns:Nh,tag:"svg",reference:"svgElement",width:"100%",height:"100%",preserveAspectRatio:"none",children:[{ns:Nh,tag:"g",reference:"scaledSvgGroup"},{ns:Nh,tag:"g",reference:"unscaledSvgGroup"}]}]},omitZeroHeightBars:null,monitorResize:!0,getRectClass:null,getBarTip:null,getBarText:null,getBarTextRenderData:null,getBarTextTip:null}}construct(e){super.construct(e),this.scheduleRefresh=this.createOnFrame(this.refresh,[],this,!0),this.refresh()}set tip(e){var t;const n=this;null===(t=n.tip)||void 0===t||t.destroy(),n._tip=e?lu.new({owner:n,forElement:n.svgElement,forSelector:"rect",listeners:{beforeShow:"up.onBeforeTipShow"}},e):null}onElementResize(){super.onElementResize(...arguments);const e=this.svgElement.getBoundingClientRect();this.scaledSvgGroup.setAttribute("transform",`scale(${e.width} ${e.height})`)}onBeforeTipShow({source:e}){const t=parseInt(e.activeTarget.dataset.index);e.html=e.contentTemplate({histogram:this,index:t})}set series(e){const t=this._series={};for(const n in e)if(!1!==e[n]){const r=t[n]=Object.assign({},e[n]);!r.type&&e[n].type&&(r.type=e[n].type),!r.field&&e[n].field&&(r.field=e[n].field),"order"in t||(r.order=Hh[r.type]),r.id=n}this.scheduleRefresh()}get series(){return this._series}set data(e){const t=this;if(t._data=e,!t.topValue){const n=Object.values(t.series).map(jh);for(let r=0,{length:i}=e;r<i;r++)for(let i=0,{length:s}=n;i<s;i++)t.topValue=Math.max(t.topValue||0,e[r][n[i]])}t.scheduleRefresh()}get data(){return this._data}set topValue(e){this._topValue=e,this.scheduleRefresh()}get topValue(){return this._topValue}scheduleRefresh(){}refresh(){const e=this,{series:t,_tip:n}=e,r=[];for(const n in t){const i=t[n],s=e[`draw${_.capitalize(i.type)}`](i);Array.isArray(s)?r.push.apply(r,s):r.push(s)}r.sort(Bh),oa.syncChildren({domConfig:{children:r},configEquality:Vh},e.scaledSvgGroup),oa.syncChildren({domConfig:{children:e.drawText()}},e.unscaledSvgGroup),n&&n.isVisible&&e.onBeforeTipShow({source:n})}drawBar(e){const t=this,{topValue:n,data:r,omitZeroHeightBars:i,barStyle:s}=t,{field:o,order:a}=e,l=1/r.length,c=[];let d;for(let u=0,h=0,{length:g}=r;u<g;u++,h+=d){const g=r[u],m=g[o],p=g.height||(m>n?n:m)/n,f=1-p,v=g.rectConfig={ns:Nh,tag:"rect",dataset:{}},y=t.callback("getBarTip",t,[e,v,g,u]);d=g.width||l,s?v.style=s:delete v.style,Object.assign(v.dataset,{index:u,order:a}),Object.assign(v,{x:h,y:f,width:d,height:p,class:t.callback("getRectClass",t,[e,v,g,u])}),y?v.dataset.btip=y:delete v.dataset.btip,!p&&i||c.push(v)}return c}drawOutline(e){const{topValue:t,data:n}=this,{field:r,order:i}=e,s=1/n.length,o=["M 0,1"],a=e.outlineElement||(e.outlineElement={ns:Nh,tag:"path",dataset:{order:i}});let l,c="M",d="L";for(let e=0,i=0,{length:a}=n;e<a;e++){const a=1-n[e][r]/t;l=n[e].width||s,o.push(`${c} ${i},${a} ${d} ${i+=l},${a}`),c=d=""}return a.d=o.join(" "),a}drawText(){const e=this,{data:t}=e,n=1/t.length,r=[];for(let i,s=0,o=0,{length:a}=t;s<a;s++,o+=i){i=t[s].width||n;const a=e.callback("getBarText",e,[t[s],s]);if(a){const n=e.callback("getBarTextRenderData",e,[{ns:Nh,tag:"text",className:"b-bar-legend",html:a,x:100*(o+i/2)+"%",y:void 0!==t[s].y?t[s].y:"100%",dataset:{index:s}},t[s],s]),l=e.callback("getBarTextTip",e,[n,t[s],s]);l?n.dataset.btip=l:delete n.dataset.btip,r.push(n)}}return r}getBarText(e,t){return""}getBarTextRenderData(e,t,n){return e}getBarTip(e,t,n,r){}getBarTextTip(e,t,n){}getRectClass(e,t,n,r){return""}}zh.initClass(),zh._$name="Histogram";const Wh="http://www.w3.org/2000/svg";class Uh extends Ka{static get type(){return"scale"}static get $name(){return"Scale"}static get configurable(){return{scalePoints:null,scaleMaxPadding:.1,horizontal:!1,align:{value:!1,$config:{merge:"replace"}},element:{children:[{ns:Wh,tag:"svg",reference:"svgElement",width:"100%",height:"100%",preserveAspectRatio:"none",children:[{ns:Wh,tag:"g",reference:"scaledSvgGroup",children:[{ns:Wh,tag:"path",reference:"pathElement"}]},{ns:Wh,tag:"g",reference:"unscaledSvgGroup"}]}]},monitorResize:!0}}construct(e){super.construct(e),this.scheduleRefresh=this.createOnFrame(this.refresh,[],this,!0),this.refresh()}changeAlign(e){return e||(e=this.horizontal?"bottom":"right"),e}updateAlign(e,t){this.element.classList.remove(`b-align-${t}`),this.element.classList.add(`b-align-${e}`)}updateHorizontal(e,t){this.element.classList.remove("b-scale-"+(t?"horizontal":"vertical")),this.element.classList.add("b-scale-"+(e?"horizontal":"vertical"))}onElementResize(){super.onElementResize(...arguments),this.scheduleRefresh()}scheduleRefresh(){}refresh(){const e=this,{horizontal:t,width:n,height:r,align:i,scalePoints:s,scaleMaxPadding:o}=e,a=s[s.length-1].value,l=[],c=[],d=1/(a+o*a);e.scaledSvgGroup.setAttribute("transform",`scale(${t?n:1} ${t?1:r})`);for(const e of s){const s=Boolean(e.text),o=d*e.value;if(s){const s={ns:Wh,tag:"text",className:"b-scale-tick-label",html:e.text,dataset:{tick:e.value}};t?(s.x=100*o+"%",s.y="top"===i?"1.6em":r-12):(s.x="left"===i?"12":""+(n-12),s.y=100*(1-o)+"%"),c.push(s)}t?"top"===i?l.push(`M${o},0 L${o},${s?10:5}`):l.push(`M${o},${r} L${o},${r-(s?10:5)}`):"left"===i?l.push(`M0,${1-o} L${s?10:5},${1-o}`):l.push(`M${n},${1-o} L${n-(s?10:5)},${1-o}`)}e.pathElement.setAttribute("d",l.join("")),oa.syncChildren({domConfig:{children:c}},e.unscaledSvgGroup)}}Uh.initClass(),Uh._$name="Scale";class Yh extends Te{static get $name(){return"AvatarRendering"}static get configurable(){return{element:null,colorPrefix:"b-sch-",tooltip:null,size:null}}doDestroy(){var e;null===(e=this.tooltip)||void 0===e||e.destroy(),super.doDestroy()}updateElement(e){_n.on({element:e,delegate:".b-resource-image",error:"onImageErrorEvent",thisObj:this,capture:!0})}changeTooltip(e){return lu.new({forElement:this.element,forSelector:".b-resource-avatar",cls:"b-resource-avatar-tooltip"},e)}static get failedUrls(){return this._failedUrls||(this._failedUrls=new Set),this._failedUrls}getResourceAvatar({initials:e,color:t,iconCls:n,imageUrl:r,defaultImageUrl:i,dataset:s={},resourceRecord:o,alt:a=_.encodeHtml(null==o?void 0:o.name)}){return this.getImageConfig(e,t,r,i,s,a)||this.getIconConfig(n,s)||this.getResourceInitialsConfig(e,t,s)}getImageConfig(e,t,n,r,i,s){const{size:o}=this;if(n=Yh.failedUrls.has(n)?r:n||r)return f(f({tag:"img",draggable:"false",loading:"lazy",class:{"b-resource-avatar":1,"b-resource-image":1}},o?{style:{height:o+"px",width:o+"px"}}:void 0),{},{alt:s,elementData:{defaultImageUrl:r,imageUrl:n,initials:e,color:t,dataset:i},src:n,dataset:i})}getIconConfig(e,t){if(e)return e&&{tag:"i",class:{"b-resource-avatar":1,"b-resource-icon":1,[e]:1},dataset:t}}getResourceInitialsConfig(e,t,n){const{size:r}=this,i=Mr.isNamedColor(t)&&t,s=!i&&t;return{tag:"div",class:{"b-resource-avatar":1,"b-resource-initials":1,[`${this.colorPrefix}${i}`]:i},style:f({backgroundColor:s||null},r?{height:r+"px",width:r+"px"}:void 0),children:[e],dataset:n}}onImageErrorEvent({target:e}){if(!e.matches(".b-resource-avatar"))return;const{defaultImageUrl:t,initials:n,color:r,imageUrl:i,dataset:s}=e.elementData;if(t&&!e.src.endsWith(t.replace(/^[./]*/gm,"")))e.src=t;else{const t=Mr.createElement(this.getResourceInitialsConfig(n,r,s));t.elementData=e.elementData,e.parentElement.replaceChild(t,e)}Yh.failedUrls.add(i)}}Yh._$name="AvatarRendering",window&&!window.bryntum&&(window.bryntum={});class Gh{constructor(e){if(e){if(e.isLocation)return e;if(e.nodeType===Node.ELEMENT_NODE){const t=Ka.fromElement(e,"gridbase"),n=t&&e.closest(t.focusableSelector);if(n){const{dataset:e}=n.parentNode;this.init({grid:t,rowIndex:t.store.includes(e.id)?t.store.indexOf(e.id):e.index||-1,columnId:n.dataset.columnId})}}else this.init(e)}}init(e){var t;const n=this,r=n.grid=e.grid,{store:i,columns:s}=r,{visibleColumns:o}=s;if(e.target&&(n.actionTargets=[n._target=e.target]),e.record)n._id=e.record.id;else if("id"in e)n._id=e.id,null==e.id&&(n._rowIndex=-1);else{var a;const t=isNaN(e.row)?isNaN(e.rowIndex)?NaN:e.rowIndex:e.row;n._rowIndex=Math.max(Math.min(Number(t),i.count-1),r.hideHeaders?0:-1),n._id=null===(a=i.getAt(n._rowIndex))||void 0===a?void 0:a.id}if("_rowIndex"in n||(n._rowIndex=i.indexOf(n.id)),n.isSpecialRow=null===(t=n.record)||void 0===t?void 0:t.isSpecialRow,"columnId"in e)n._column=s.getById(e.columnId);else if("field"in e)n._column=s.get(e.field);else{const t=isNaN(e.column)?isNaN(e.columnIndex)?NaN:e.columnIndex:e.column;isNaN(t)?n._column="column"in e?isNaN(e.column)?e.column:o[e.column]:o[0]:(n._columnIndex=Math.min(Number(t),o.length-1),n._column=o[n._columnIndex])}"_columnIndex"in n||(n._columnIndex=o.indexOf(n._column))}get isLocation(){return!0}equals(e){return(null==e?void 0:e.isLocation)&&e.grid===this.grid&&e.record===this.record&&e.column===this.column&&e.target===this.target}get rowIndex(){const{_id:e}=this,{store:t}=this.grid;return t.includes(e)?t.indexOf(e):Math.min(this._rowIndex,t.count-1)}get visibleRowIndex(){const{rowManager:e}=this.grid,{rowIndex:t}=this;return-1===t?t:Math.max(Math.min(t,e.lastFullyVisibleTow.dataIndex),e.firstFullyVisibleTow.dataIndex)}get isSelectable(){return this.grid.store.includes(this._id)&&!this.isSpecialRow}get record(){if(this._rowIndex>-1){const{store:e}=this.grid;return e.includes(this._id)?e.getById(this._id):e.getAt(this._rowIndex)}}get id(){return this._id}get column(){const{visibleColumns:e}=this.grid.columns;return null!=e&&e.includes(this._column)?this._column:null==e?void 0:e[this.columnIndex]}get columnId(){var e;return null===(e=this.column)||void 0===e?void 0:e.id}get columnIndex(){var e;return Math.min(this._columnIndex,(null===(e=this.grid.columns.visibleColumns)||void 0===e?void 0:e.length)-1)}move(e){const t=this,{record:n,column:r,grid:i}=t,{store:s}=i,o=i.columns.visibleColumns,a=new Gh;let l=s.includes(n)?s.indexOf(n):t.rowIndex,c=o.includes(r)?o.indexOf(r):t.columnIndex;const d=i.hideHeaders?0:-1,u=s.count-1,h=o.length-1,g=l===d,m=l===u,p=0===c,f=c===h;switch(e){case Gh.PREV_CELL:p?g||(c=h,l--):c--;break;case Gh.NEXT_CELL:f?m||(c=0,l++):c++;break;case Gh.UP:g||l--;break;case Gh.DOWN:m||(-1===l?l=i.rowManager.firstFullyVisibleRow.dataIndex:l++);break;case Gh.FIRST_COLUMN:c=0;break;case Gh.LAST_COLUMN:c=h;break;case Gh.FIRST_CELL:l=d,c=0;break;case Gh.LAST_CELL:l=u,c=h;break;case Gh.PREV_PAGE:l=Math.max(d,l-Math.floor(i.scrollable.clientHeight/i.rowHeight));break;case Gh.NEXT_PAGE:l=Math.min(u,l+Math.floor(i.scrollable.clientHeight/i.rowHeight))}return a.init({grid:i,rowIndex:l,columnIndex:c}),a}get cell(){const e=this,{grid:t,id:n,_cell:r}=e;if(r)return r;var i;if(null==n)return null===(i=t.columns.getById(e.columnId))||void 0===i?void 0:i.element;{const{row:n}=e;var s;if(n)return n.getCell(e.columnId)||n.getCell(null===(s=t.columns.getAt(e.columnIndex))||void 0===s?void 0:s.id)}}get row(){return this.grid.getRowById(this.id)||this.grid.getRow(this.rowIndex)}get target(){const{cell:e,_target:t}=this,{focusableFinder:n}=this.grid;if(e)return t||(n.currentNode=this.grid.focusableFinderCell=e,n.nextNode()||e)}get isActionable(){const{cell:e,_target:t}=this,n=e.compareDocumentPosition(Mr.getActiveElement(e))&Node.DOCUMENT_POSITION_CONTAINED_BY;return Boolean(n||t&&t!==this.cell)}get isColumnHeader(){return this.cell&&-1===this.rowIndex}get isCell(){return this.cell&&this.record}}Gh.UP=1,Gh.NEXT_CELL=2,Gh.DOWN=3,Gh.PREV_CELL=4,Gh.FIRST_COLUMN=5,Gh.LAST_COLUMN=6,Gh.FIRST_CELL=7,Gh.LAST_CELL=8,Gh.PREV_PAGE=9,Gh.NEXT_PAGE=10,Gh._$name="Location";const qh=e=>"number"==typeof e||(null==e?void 0:e.endsWith("px"));class Kh extends(Hi.mixin(tt,pt)){static get $name(){return"Column"}static get type(){return"column"}static get fields(){return["type","text","field","renderer","width","flex","autoWidth","autoHeight",{name:"fitMode",defaultValue:"exact"},{name:"editor",defaultValue:{}},"cellEditor","finalizeCellEdit",{name:"revertOnEscape",defaultValue:!0},{name:"invalidAction",defaultValue:"block"},{name:"sortable",defaultValue:!0,convert(e,t){if(!e)return!1;if(!0===e)return!0;const n={};return"function"==typeof e?(n.originalSortFn=e,n.sortFn=e.bind(t)):"object"==typeof e&&(Object.assign(n,e),n.fn&&(n.sortFn=n.fn,delete n.fn)),n}},{name:"searchable",defaultValue:!0},{name:"collapsible",defaultValue:!1},{name:"collapsed",defaultValue:!1},{name:"collapseMode"},{name:"filterable",defaultValue:!0,convert(e){if(!e)return!1;if(!0===e)return!0;const t={columnOwned:!0};return"function"==typeof e?t.filterFn=e:"object"==typeof e&&Object.assign(t,e),t}},{name:"sealed"},{name:"hideable",defaultValue:!0},{name:"draggable",defaultValue:!0},{name:"groupable",defaultValue:!0},{name:"resizable",defaultValue:!0},"groupRenderer","headerRenderer","tooltip","tooltipRenderer","cellCls","cls","icon","align",{name:"minWidth",defaultValue:60},"maxWidth",{name:"hidden",defaultValue:!1},{name:"locked"},{name:"region"},{name:"mergeCells",type:"boolean"},{name:"mergeable",type:"boolean",defaultValue:!0},"mergedRenderer",{name:"showColumnPicker",defaultValue:!0},{name:"enableHeaderContextMenu",defaultValue:!0},{name:"enableCellContextMenu",defaultValue:!0},"headerMenuItems","cellMenuItems","sum","summaries","summaryRenderer","responsiveLevels","tags","touchConfig","tree","filterType",{name:"htmlEncode",defaultValue:!0},{name:"htmlEncodeHeaderText",defaultValue:!0},{name:"autoSyncHtml",defaultValue:!1},{name:"headerWidgets"},{name:"instantUpdate",defaultValue:!1},{name:"repaintOnResize",defaultValue:!1},"editTargetSelector",{name:"exportable",defaultValue:!0},{name:"exportedType"},{name:"ariaLabel",defaultValue:"L{Column.columnLabel}"},{name:"cellAriaLabel",defaultValue:"L{cellLabel}"}]}static get autoExposeFields(){return!1}construct(e,t){var n;const r=this;r.masterStore=t,t&&(r._grid=Array.isArray(t)?t[0].grid:t.grid),r.localizableProperties=ae.mergeMethods.distinct(e.localizableProperties,["text","ariaLabel","cellAriaLabel"]),e.localeClass&&(r.localeClass=e.localeClass),super.construct(...arguments),r.isLeaf&&!("field"in r.data)&&(r.field="_"+(r.type||"")+ ++Kh.emptyCount,r.noFieldSpecified=!0),r.hasComplexMapping=null===(n=r.field)||void 0===n?void 0:n.includes("."),r.width||r.flex||r.children||r.set({width:Kh.defaultWidth,flex:null},null,!0),r.headerWidgets&&r.initHeaderWidgets(r.headerWidgets),r.isParent&&(r.meta.visibleChildren=new Set,r.collapsible&&(r.collapsible=!0))}get isCollapsible(){var e;return(null===(e=this.children)||void 0===e?void 0:e.length)>1&&this.collapsible}get collapsed(){return this.get("collapsed")}set collapsed(e){this.set("collapsed",e,!0),this.onCollapseChange(!e),this.trigger("toggleCollapse",{collapsed:e})}onCellFocus(e){this.location=e,this.updateHeaderAriaLabel(this.localizeProperty("ariaLabel")),-1!==e.rowIndex&&this.updateCellAriaLabel(this.localizeProperty("cellAriaLabel"))}updateHeaderAriaLabel(e){Mr.setAttributes(this.element,{"aria-label":e})}updateCellAriaLabel(e){var t,n,r;null!==(t=this.location)&&void 0!==t&&t.isSpecialRow||null===(n=this.location)||void 0===n||!n.cell||(null!==(r=e)&&void 0!==r&&r.length||(e=this.location.column.text),Mr.setAttributes(this.location.cell,{"aria-label":e}))}doDestroy(){var e,t,n;null===(e=this.data)||void 0===e||null===(t=e.editor)||void 0===t||null===(n=t.destroy)||void 0===n||n.call(t),this.destroyHeaderWidgets(),super.doDestroy()}set headerWidgets(e){this.initHeaderWidgets(e),this.set("headerWidgets",e)}get headerWidgets(){return this.get("headerWidgets")}initHeaderWidgets(e){this.destroyHeaderWidgets();const t=this.headerWidgetMap={};for(const n of e){const e=Ka.create(f({owner:this},n));t[e.ref||e.id]=e}}destroyHeaderWidgets(){for(const t of Object.values(this.headerWidgetMap||{})){var e;null===(e=t.destroy)||void 0===e||e.call(t)}}static generateAutoCls(){let e="";for(let t=this;t!==Kh;t=t.superclass)t.type&&(e+=`b-${t.type.toLowerCase()}-cell `);return(Kh.autoClsMap||(Kh.autoClsMap=new Map)).set(this,e),e}getCellClass(e){var t;const{record:n,column:r}=e,{cellCls:i,internalCellCls:s,grid:o,constructor:a,align:l}=r,c=(null===(t=Kh.autoClsMap)||void 0===t?void 0:t.get(a))||a.generateAutoCls(),d=e.cell.classList.contains("b-editing"),u={[o.cellCls]:o.cellCls,[c]:c,[i]:i,[s]:s,"b-cell-dirty":n.isFieldModified(r.field),[`b-grid-cell-align-${l}`]:l,"b-selected":o.isSelected(e),"b-focused":o.isFocused(e),"b-auto-height":r.autoHeight,"b-editing":d};return n.isSpecialRow&&u["b-checkbox-selection"]&&(u["b-checkbox-selection"]=!1),u}get locked(){return"locked"===this.data.region}set locked(e){this.region=e?"locked":"normal"}get region(){return this.parent.isRoot?this.get("region"):this.parent.region}set region(e){this.set("region",e)}get sortable(){return this.isLeaf&&this.data.sortable}set sortable(e){this.set("sortable",e)}get groupable(){return this.isLeaf&&this.data.groupable}set groupable(e){this.set("groupable",e)}get editor(){const e=this;let{editor:t}=e.data;if(t&&!t.isWidget){const n=e.grid.processCellEditor({editor:t,field:e.field});n?t=e.data.editor=n.editor:("string"==typeof t&&(t={type:t}),t=e.data.editor=Ka.create(sn.merge(e.defaultEditor,{owner:e.grid,label:_.encodeHtml(e.text)},t)))}return t}set editor(e){this.data.editor=e}get defaultEditor(){return{type:"textfield",name:this.field}}getFilterableValue(e){return this.getRawValue(e)}get owner(){return this._owner||this.subGrid}set owner(e){this._owner=e}get grid(){var e;return this._grid||(null===(e=this.parent)||void 0===e?void 0:e.grid)}set subGrid(e){this._subGrid=e}get subGrid(){var e;return this._subGrid||(null===(e=this.grid)||void 0===e?void 0:e.getSubGridFromColumn(this))}get subGridElement(){return this.subGrid.element}get element(){return this.grid.getHeaderElement(this)}get nextVisibleSibling(){const e=this.region;let t=this.nextSibling;for(;t&&(t.hidden||t.region!==e);)t=t.nextSibling;return t}get isLastInSubGrid(){return!this.nextVisibleSibling&&(this.parent.isRoot||this.parent.isLastInSubGrid)}get textWrapper(){return Mr.getChild(this.element,".b-grid-header-text")}get textElement(){return Mr.down(this.element,".b-grid-header-text-content")}get contentElement(){return Mr.down(this.element,".b-grid-header-children")}get isSorted(){return this.grid.store.sorters.some((e=>e.field===this.field))}get isFocusable(){return this.isLeaf}static get text(){return this.$meta.fields.defaults.text}get headerText(){return this.htmlEncodeHeaderText?_.encodeHtml(this.text):this.text}get isVisible(){return!this.hidden&&(!this.parent||this.parent.isVisible)}hide(e=!1,t=!1){const n=this,{parent:r}=n;n.hidden||(n.hidden=!0,!r||r.isRoot||r.isTogglingAll||r.children.some((e=>!0!==e.hidden))||r.hidden||(e=!0,r.hide()),n.isParent?n.children.forEach((e=>e.hide(!0,!0))):r.isRoot||r.meta.visibleChildren[t?"add":"delete"](n),e||n.stores.forEach((e=>e.trigger("columnHide",{column:n}))))}show(e=!1){const t=this,{parent:n}=t;var r;t.hidden&&(t.hidden=!1,null!=n&&n.hidden&&n.show(),t.isParent&&(null===(r=t.meta.visibleChildren)||void 0===r||r.forEach((e=>e.show(!0)))),e||t.stores.forEach((e=>e.trigger("columnShow",{column:t}))))}toggle(e){return this.hidden&&void 0===e||!0===e?this.show():!this.hidden&&void 0===e||!1===e?this.hide():void 0}toggleChildren(e=this.children,t){var n,r;const i=this;null===(n=i.grid.columns)||void 0===n||n.beginBatch(),i.isTogglingAll=!0,e.forEach((e=>e.toggle(t))),i.isTogglingAll=!1,null===(r=i.grid.columns)||void 0===r||r.endBatch()}onCollapseChange(e){const t=this;if("toggleAll"===t.collapseMode)t.toggleChildren();else{var n,r;const{firstChild:i}=t;null!=i.flex&&t.collapsed?(i.oldFlex=i.flex,i.width=i.element.offsetWidth):!t.collapsed&&i.oldFlex&&(i.flex=i.oldFlex,i.oldFlex=null),null===(n=t.grid.columns)||void 0===n||n.beginBatch(),t.isTogglingAll=!0,t.children.slice(1).forEach((t=>t.toggle(e))),t.isTogglingAll=!1,null===(r=t.grid.columns)||void 0===r||r.endBatch()}}set collapsible(e){const t=this;if(t.set("collapsible",e),t.isParent){const{headerWidgets:n=[]}=t;if(e)n.push({type:"button",ref:"collapseExpand",toggleable:!0,pressed:t.collapsed,icon:"b-icon-collapse-"+(t.grid.rtl?"right":"left"),pressedIcon:"b-icon-collapse-"+(t.grid.rtl?"left":"right"),cls:"b-grid-header-collapse-button b-transparent",onToggle:({pressed:e})=>t.collapsed=e});else{const e=n.findIndex((e=>"collapseExpand"===e.ref));e>-1&&n.splice(e,1)}t.headerWidgets=n,t.collapsed&&t.onCollapseChange(!1)}}get collapsible(){return this.get("collapsible")}generateId(){return Kh.generatedIdIndex||(Kh.generatedIdIndex=0),(this.field?this.field.replace(/\./g,"-"):"col")+ ++Kh.generatedIdIndex}get allIndex(){return this.masterStore.indexOf(this)}measureSize(e){var t;return Mr.measureSize(e,null===(t=this.subGrid)||void 0===t?void 0:t.element)}get calcMinWidth(){const{width:e,minWidth:t}=this.data;return qh(e)&&qh(t)?Math.max(parseInt(e)||0,parseInt(t)||0):e}get width(){return this.data.width}set width(e){const t={width:e};e&&"flex"in this.data&&(t.flex=null),this.set(t)}set flex(e){const t={flex:e};e&&"width"in this.data&&(t.width=null),this.set(t)}get flex(){return this.data.flex}calculateMinWidth(){const e=this,t=e.measureSize(e.width),n=e.measureSize(e.minWidth);let r=0;return e.children&&(r=e.children.reduce(((e,t)=>e+t.calculateMinWidth()),0)),Math.max(t,n,r)}resizeToFitContent(e,t,n=!1){const r=this,{grid:i,element:s,fitMode:o}=r,{rowManager:a,store:l}=i,{count:c}=l;if(c<=0||"none"===r.fitMode||!r.fitMode)return;const[d]=a.rows,{rowElement:u,cellElement:h}=i.beginGridMeasuring(),g=new Gh({grid:i,column:r,id:null});let m,p,f,v,y,b,C=0,w={length:0,record:null};if(h._domData={columnId:r.id,row:d,rowElement:u},g._cell=h,g.updatingSingleRow=!0,g.isMeasuring=!0,h.innerHTML="",i.resizeToFitIncludesHeader){if(!i.$headerPadding){const e=globalThis.getComputedStyle(s);i.$headerPadding=parseInt(e.paddingLeft)}const e=s.querySelector(".b-grid-header-text-content");e.style.cssText="flex: none; width: auto",C=e.offsetWidth+2*i.$headerPadding+2,e.style.cssText=""}for(c>1e3?(m=Math.max(Math.min(a.topIndex+Math.round(a.rowCount/2)-500,c-1e3),0),p=m+1e3):(m=0,p=c),f=m;f<p;f++){if(v=l.getAt(f),y=r.getRawValue(v),"value"===o)b=String(y).length;else if(g._record=w.record,g._id=v.id,g._rowIndex=f,d.renderCell(g),"textContent"===o)b=h.textContent.length;else{const e=h.offsetWidth;e>C&&(C=e)}b>w.length&&(w={record:v,length:b,rowIndex:f})}return"value"!==o&&"textContent"!==o||(g._record=w.record,g._id=w.record.id,g._rowIndex=w.rowIndex,d.renderCell(g),C=Math.max(C,h.offsetWidth)),Array.isArray(e)&&([e,t]=e),C=Math.max(C,e||0),C=Math.min(C,t||1e6),n||i.endGridMeasuring(),r.width=r.maxWidth?C=Math.min(C,r.maxWidth):C,C}getState(){const e=this,t={id:e.id,hidden:e.hidden,region:e.region,locked:e.locked};return e.children||(t[e.flex?"flex":"width"]=e.flex||e.width),e.isCollapsible&&(t.collapsed=e.collapsed),t}applyState(e){const t=this;t.beginBatch(),"locked"in e&&(t.locked=e.locked),"width"in e&&(t.width=e.width),"flex"in e&&(t.flex=e.flex),"width"in e&&t.flex?t.flex=void 0:"flex"in e&&t.width&&(t.width=void 0),"region"in e&&(t.region=e.region),t.endBatch(),"hidden"in e&&t.toggle(!0!==e.hidden),"collapsed"in e&&(t.collapsed=e.collapsed)}remove(){const{subGrid:e,grid:t}=this,n=e&&(null==t?void 0:t.focusedCell);(null==n?void 0:n.columnId)===this.id&&(t.owns(Mr.getActiveElement(t))?t.navigateRight():t._focusedCell=new Gh({grid:t,rowIndex:n.rowIndex,column:e.columns.getAdjacentVisibleLeafColumn(this.id,!0,!0)})),super.remove()}getRawValue(e){return this.hasComplexMapping?sn.getPath(e,this.field):e[this.field]}refreshCell(e){this.grid.rowManager.refreshCell(e,this.id)}clearCell(e){e.innerHTML="",delete e._content}canEdit(e){if(e.isEditable){const t=e.isEditable(this.field);if(void 0!==t)return t}return!0}insertChild(e,t=null,n=!1){return this.sealed&&!this.inProcessChildren?null:super.insertChild(...arguments)}getCurrentConfig(e){var t;const n=super.getCurrentConfig(e);return null!==(t=this.sortable)&&void 0!==t&&t.originalSortFn&&(n.sortable=this.sortable.originalSortFn),n.renderer===this.internalRenderer&&delete n.renderer,n.headerRenderer===this.internalHeaderRenderer&&delete n.headerRenderer,delete n.ariaLabel,delete n.cellAriaLabel,n}}Kh.emptyCount=0,Kh.defaultWidth=100,Kh.exposeProperties(),Kh._$name="Column";const Xh={boolean:{type:"check"},date:{type:"date"},integer:{type:"number",format:{maximumFractionDigits:0}},number:{type:"number"}},Zh=[{field:"region"}];class Jh extends(pt(As)){static get defaultConfig(){return{modelClass:Kh,tree:!0,autoAddField:!1,sorters:Zh}}construct(e){const t=this;e.grid&&(e.grid._columnStore=t,t.id=`${e.grid.id}-columns`,e.grid.on({subGridCollapse:"clearSubGridCaches",subGridExpand:"clearSubGridCaches",thisObj:t})),super.construct(e),t.on({change:t.onStoreChange,sort:()=>t.updateChainedStores(),thisObj:t,prio:1})}get modelClass(){return this._modelClass}set modelClass(e){this._modelClass=e}doDestroy(){const e=[];this.isChained||this.traverse((t=>e.push(t))),super.doDestroy(),this.isChained||e.forEach((e=>e.destroy()))}getById(e){return super.getById(e)||this.idRegister[e]}forEach(e,t=this){this.traverseWhile(((n,r)=>e.call(t,n,r)),!0)}get totalFixedWidth(){let e=0;for(const t of this)t.hidden||(t.children?t.children.forEach((t=>e+=this.calculateFixedWidth(t))):e+=this.calculateFixedWidth(t));return e}get hasFlex(){return this.visibleColumns.some((e=>e.flex))}calculateFixedWidth(e){return e.flex?e.measureSize(Kh.defaultWidth):Math.max(e.measureSize(e.width),e.measureSize(e.minWidth))}get topColumns(){return this.isChained?this.masterStore.rootNode.children.filter(this.chainedFilterFn):this.rootNode.children}get visibleColumns(){const e=this;return e._visibleColumns||(e._visibleColumns=e.leaves.filter((e=>e.isVisible&&(!e.subGrid||!e.subGrid.collapsed)))),e._visibleColumns}onStoreChange({action:e,changes:t}){("update"!==e||"hidden"in t)&&this.clearCaches()}clearSubGridCaches({subGrid:e}){e.columns.clearCaches(),this.clearCaches()}clearCaches(){var e;this._visibleColumns=null,null===(e=this.masterStore)||void 0===e||e.clearCaches()}onMasterDataChanged(e){super.onMasterDataChanged(e),("update"!==e.action||"hidden"in e.changes)&&this.clearCaches()}getAdjacentVisibleLeafColumn(e,t=!0,n=!1){const r=this.visibleColumns,i=e instanceof Kh?e:this.getById(e);let s=r.indexOf(i)+(t?1:-1);if(!r[s]){if(!n)return null;s=t?0:r.length-1}return r[s]}get bottomColumns(){return this.leaves}get(e){return this.findRecord("field",e,!0)}createRecord(e){var t,n;const{grid:r={}}=this,{store:i}=r,s=null==i||null===(t=i.modelClass)||void 0===t||null===(n=t.fieldMap)||void 0===n?void 0:n[e.field];let o=this.modelClass;if(null!=s&&s.column&&(e=Y.merge({},s.column,e)),e.type&&(o=Jh.getColumnClass(e.type),!o))throw new Error(`Column type '${e.type}' not registered`);e.locked&&(e.region="locked",delete e.locked);const a=new o(e,this);if(a.data.region||(a.data.region=r.defaultRegion||"normal"),this.autoAddField&&!a.noFieldSpecified&&i&&!s){let e=a.field;a.constructor.fieldType&&(e={name:a.field,type:a.constructor.fieldType}),i.modelClass.addField(e)}return a}indexOf(e){if(null==e)return-1;const t=super.indexOf(e);return t>-1?t:this.records.findIndex((t=>t.field===e))}get usesAutoHeight(){return this.find((e=>e.autoHeight))}get usesFlexAutoHeight(){return this.find((e=>e.autoHeight&&null!=e.flex))}static registerColumnType(e,t=!1){e.simpleRenderer=t,(Jh.columnTypes||(Jh.columnTypes={}))[e.type]=e}static getColumnClass(e){return Jh.columnTypes&&Jh.columnTypes[e]}generateColumnForField(e,t){var n;"string"==typeof e&&this.grid&&(e=null===(n=this.grid.store)||void 0===n?void 0:n.modelClass.fieldMap[e]);let r=e.column||Xh[e.type]||{};return"string"==typeof r&&(r={type:r}),r=Object.assign({text:e.text||_.separate(e.name),field:e.name},t,r),null!=e.precision&&(r.format.maximumFractionDigits=e.precision),e.columnType&&(r.type=e.columnType),this.createRecord(r)}}Jh.registerColumnType(Kh,!0),Jh._$name="ColumnStore";class Qh extends Kh{static get type(){return"action"}static get fields(){return["actions",{name:"disableIfGridReadOnly",defaultValue:!1}]}static get defaults(){return{filterable:!1,groupable:!1,sortable:!1,editor:!1,searchable:!1,htmlEncode:!1,resizable:!1,minWidth:30}}get groupHeaderReserved(){return!0}construct(e,t){const n=this;super.construct(...arguments),e.width||e.flex||n.grid.on("paint",n.updateAutoWidth,n),n.disableIfGridReadOnly&&n.grid.element.classList.add("b-actioncolumn-readonly"),n.externalRenderer=n.renderer,n.renderer=n.internalRenderer}internalRenderer({grid:e,column:t,record:n,callExternalRenderer:r=!0}){var i;const s=n&&"groupRowFor"in n.meta,{subGrid:o}=t;var a;return r&&(null===(a=this.externalRenderer)||void 0===a||a.call(this,...arguments)),{className:{"b-action-ct":1},children:null===(i=t.actions)||void 0===i?void 0:i.map(((e,r)=>{var i;if("visible"in e){if("function"==typeof e.visible&&!1===e.visible({record:n}))return"";if(!1===e.visible)return""}if(s&&!e.showForGroup||!s&&e.showForGroup)return"";const{tooltip:a,renderer:l}=e,c="function"==typeof a||null!=a&&null!==(i=a.startsWith)&&void 0!==i&&i.call(a,"up.")?o.callback(a,o,[{record:n}]):a||"";if(l){const i=o.callback(l,o,[{index:r,record:n,column:t,tooltip:c,action:e}]);return"string"==typeof i?{tag:"span",dataset:f(f({},lu.encodeConfig(c)),{},{index:r}),html:i}:(i.dataset=i.dataset||{},i.dataset.index=r,i)}return{tag:"button",dataset:f(f({},lu.encodeConfig(c)),{},{index:r}),"aria-label":c,className:{"b-tool":1,"b-action-item":1,[e.cls]:e.cls}}}))}}onCellClick({grid:e,column:t,record:n,target:r}){var i;if(t!==this||!r.classList.contains("b-action-item"))return;let s=r.dataset.index;s||(s=r.parentElement.dataset&&r.parentElement.dataset.index);const o=null===(i=t.actions)||void 0===i?void 0:i[s],a=o&&o.onClick;a&&this.callback(a,t,[{record:n,action:o,target:r}])}updateAutoWidth(){var e;const t=this,n=t,r=[],{actions:i}=n;if(!t.element)return;let s=n.actions=[];null===(e=t.actions)||void 0===e||e.forEach((e=>{const t=f({},e);delete t.visible,t.showForGroup?(delete t.showForGroup,r.push(t)):s.push(t)})),r.length>s.length&&(s=n.actions=r);const o=Mr.createElement(t.internalRenderer({column:n,callExternalRenderer:!1})).outerHTML;t.width=Mr.measureText(o,t.element,!0,t.element.parentElement),n.actions=i}}Jh.registerColumnType(Qh),Qh.exposeProperties(),Qh._$name="ActionColumn";class eg extends Kh{static get type(){return"number"}static get fieldType(){return"number"}static get fields(){return["format","min","max","step","largeStep","unit"]}static get defaults(){return{filterType:"number",format:""}}get defaultEditor(){const{format:e,name:t,max:n,min:r,step:i,largeStep:s,align:o}=this;return sn.cleanupProperties({type:"numberfield",format:e,name:t,max:n,min:r,step:i,largeStep:s,textAlign:o})}get formatter(){const e=this,{format:t}=e;let n=e._formatter;return n&&e._lastFormat===t||(e._formatter=n=cd.get(e._lastFormat=t)),n}formatValue(e){var t;return null!=e&&(e=this.formatter.format(e),this.unit&&(e=`${e}${this.unit}`)),null!==(t=e)&&void 0!==t?t:""}defaultRenderer({value:e}){return this.formatValue(e)}}Jh.registerColumnType(eg,!0),eg.exposeProperties(),eg._$name="NumberColumn";class tg extends eg{static get type(){return"aggregate"}static get fields(){return["function","includeParentInChangeSet"]}static get defaults(){return{function:"sum",includeParentInChangeSet:!1}}construct(e,t){this.configuredAlign="align"in e,this.configuredEditor="editor"in e,super.construct(...arguments);const{grid:n}=t;"sum"===this.function&&(this.function="sumChildren"),n&&(this.store=n.store)}set store(e){const t=this,n={update:"onRecordUpdate",thisObj:t,prio:1e3},r=t._store;if(e!==r){r&&r.un(n),t._store=e;const{modelClass:i}=e,s=i.fieldMap[t.field];s&&"number"===s.type&&(t.configuredAlign||(t.align="end"),t.configuredEditor||(t.editor="number")),e.on(n)}}canEdit(e){return e.isLeaf}get store(){return this._store}sumChildren(...e){let t=0;for(let n=0,{length:r}=e;n<r;n++)t+=parseInt(e[n]||0,10);return t}avg(...e){let t=0;const{length:n}=e;for(let r=0;r<n;r++)t+=parseInt(e[r]||0,10);return t/n}onRecordUpdate({record:e,changes:t}){const n=this,{rowManager:r}=n.grid;n.field in t&&e.isLeaf&&e.bubble((e=>{const t=r.getRowFor(e);if(t){const e=t.getCell(n.field);e&&t.renderCell(e)}}),!0)}getRawValue(e){let t=0;if(e.children){const n=this,r=n.function,i="string"==typeof r&&"function"==typeof Math[r],{handler:s,thisObj:o}=i?{handler:Math[r],thisObj:Math}:n.resolveCallback(r);t=s.apply(o,e.children.map((e=>n.getRawValue(e)))),n.includeParentInChangeSet?e.set(n.field,t,!0):e.setData(n.field,t)}else t=e[this.field];return t}}Jh.registerColumnType(tg,!0),tg.exposeProperties(),tg._$name="AggregateColumn";class ng extends Kh{static get type(){return"widget"}static get fields(){return["widgets"]}static get defaults(){return{filterable:!1,sortable:!1,editor:!1,searchable:!1,fitMode:!1}}construct(e,t){const n=this;n.widgetMap={},super.construct(...arguments),n.externalRenderer=n.renderer,n.renderer=n.internalRenderer}doDestroy(){for(const e of Object.values(this.widgetMap))e.destroy&&e.destroy();super.doDestroy()}updateReadOnly(e){for(const t of Object.values(this.widgetMap))t.cellInfo.record.readOnly||(t.readOnly=e)}internalRenderer(e){var t;const n=this,{cellElement:r,column:i,record:s,isExport:o}=e,{widgets:a}=i;return!o&&a&&(r.widgets||n.clearCell(r),r.widgets=e.widgets=a.map(((t,o)=>{var a,l;let c,d;if(r.widgets&&(c=r.widgets[o],d=c.element.nextElementSibling,t.recreate&&c&&(delete n.widgetMap[c.id],c.destroy(),r.widgets[o]=null)),c||(n.onBeforeWidgetCreate(t,e),t.recomposeAsync=!1,c=qc.append(t,d?{insertBefore:d}:r)[0],n.widgetMap[c.id]=c,n.onAfterWidgetCreate(c,e),c.name&&c.on({change:({value:e})=>{c.cellInfo.record[c.name]=e}})),c.cellInfo={record:s,column:i},n.grid&&!n.meta.isSelectionColumn&&(c.readOnly=n.grid.readOnly||s.readOnly),!1!==(null===(a=n.onBeforeWidgetSetValue)||void 0===a?void 0:a.call(n,c,e))){const n=t.valueProperty||"value"in c&&"value"||c.defaultBindProperty;if(n){const t=c.name?s[c.name]:e.value;c[n]=t}}return null===(l=n.onAfterWidgetSetValue)||void 0===l||l.call(n,c,e),c}))),o?null:null===(t=this.externalRenderer)||void 0===t?void 0:t.call(this,e)}onBeforeWidgetCreate(e,t){}onAfterWidgetCreate(e,t){}clearCell(e){e.widgets&&(e.widgets.forEach((e=>{delete this.widgetMap[e.id],e.destroy()})),e.widgets=null),super.clearCell(e)}resizeToFitContent(){}}Jh.registerColumnType(ng),ng.exposeProperties(),ng._$name="WidgetColumn";class rg extends ng{static get $name(){return"CheckColumn"}static get type(){return"check"}static get fields(){return["checkCls","showCheckAll","onAfterWidgetSetValue","onBeforeWidgetSetValue","callOnFunctions","onBeforeToggle","onToggle","onToggleAll"]}static get defaults(){return{align:"center",checkCls:null,showCheckAll:!1,widgets:[{type:"checkbox",valueProperty:"checked"}]}}construct(e,t){super.construct(...arguments);const n=this;Object.assign(n,{externalHeaderRenderer:n.headerRenderer,externalOnBeforeWidgetSetValue:n.onBeforeWidgetSetValue,externalOnAfterWidgetSetValue:n.onAfterWidgetSetValue,onBeforeWidgetSetValue:n.internalOnBeforeWidgetSetValue,onAfterWidgetSetValue:n.internalOnAfterWidgetSetValue,headerRenderer:n.internalHeaderRenderer}),n.field||n.meta.isSelectionColumn||console.warn("CheckColumn MUST be configured with a field, otherwise the checked state will not be persistent. Widgets are recycled and reused")}doDestroy(){var e;null===(e=this.headerCheckbox)||void 0===e||e.destroy(),super.doDestroy()}internalHeaderRenderer({headerElement:e,column:t}){let n;return e.classList.add("b-check-header"),t.showCheckAll?(e.classList.add("b-check-header-with-checkbox"),t.headerCheckbox?e.appendChild(t.headerCheckbox.element):t.headerCheckbox=new Au({appendTo:e,owner:this.grid,ariaLabel:"L{Checkbox.toggleSelection}",listeners:{change:"onCheckAllChange",thisObj:t}})):n=t.headerText,n=t.externalHeaderRenderer?t.externalHeaderRenderer.call(this,...arguments):n,t.showCheckAll?void 0:n}updateCheckAllState(e){this.headerCheckbox&&(this.suspendEvents(),this.headerCheckbox.checked=e,this.resumeEvents())}onCheckAllChange({checked:e}){const t=this;if(t.field){const{store:n}=t.grid;n.beginBatch(),n.forEach((n=>t.updateRecord(n,t.field,e))),n.endBatch()}t.trigger("toggleAll",{checked:e})}internalRenderer({value:e,isExport:t,record:n,cellElement:r}){if(t)return null==e?"":e;const i=super.internalRenderer(...arguments);return n.readOnly&&!this.meta.isSelectionColumn&&(r.widgets[0].readOnly=!0),i}onBeforeWidgetCreate(e,t){e.cls=this.checkCls}onAfterWidgetCreate(e,t){t.cellElement.widget=e,e.on({beforeChange:"onBeforeCheckboxChange",change:"onCheckboxChange",thisObj:this})}internalOnBeforeWidgetSetValue(e){var t;e.record=e.cellInfo.record,this.isInitialSet=!0,null===(t=this.externalOnBeforeWidgetSetValue)||void 0===t||t.call(this,...arguments)}internalOnAfterWidgetSetValue(e){var t;this.isInitialSet=!1,null===(t=this.externalOnAfterWidgetSetValue)||void 0===t||t.call(this,...arguments)}onBeforeCheckboxChange({source:e,checked:t,userAction:n}){const r=this,{grid:i}=r,{record:s}=e.cellInfo;return!(n&&r.field&&(!i.features.cellEdit||i.features.cellEdit.disabled)||r.meta.isSelectionColumn&&!i.isSelectable(s)&&t)&&(r.isInitialSet?void 0:r.trigger("beforeToggle",{record:s,checked:t}))}onCheckboxChange({source:e,checked:t}){if(!this.isInitialSet){const n=this,{record:r}=e.cellInfo,{field:i}=n;i&&(n.updateRecord(r,i,t),t?n.updateCheckAllState(n.grid.store.every((e=>e[i]),null,!0)):n.updateCheckAllState(!1)),n.trigger("toggle",{record:r,checked:t})}}updateRecord(e,t,n){const r=`set${_.capitalize(t)}`;e[r]?e[r](n):e.set(t,n)}onCellKeyDown({event:e,cellElement:t}){if(" "===e.key){const n=t.widget;null==n||n.toggle(),e.preventDefault(),e.handled=!0}}getCurrentConfig(e){const t=super.getCurrentConfig(e);return delete t.onBeforeWidgetSetValue,delete t.onAfterWidgetSetValue,this.externalOnBeforeWidgetSetValue&&(t.onBeforeWidgetSetValue=this.externalOnBeforeWidgetSetValue),this.externalOnAfterWidgetSetValue&&(t.onAfterWidgetSetValue=this.externalOnAfterWidgetSetValue),t}}Jh.registerColumnType(rg,!0),rg._$name="CheckColumn";class ig extends Kh{static get $name(){return"DateColumn"}static get type(){return"date"}static get fieldType(){return"date"}static get fields(){return["format","pickerFormat","step","min","max"]}static get defaults(){return{format:"L",step:1,minWidth:85,filterType:"date"}}defaultRenderer({value:e}){return e?this.formatValue(e):""}groupRenderer({cellElement:e,groupRowFor:t}){e.innerHTML=this.formatValue(t)}formatValue(e){return"string"==typeof e&&(e=en.parse(e,this.format||void 0)),en.format(e,this.format||void 0)}set format(e){const{editor:t}=this.data;this.set("format",e),t&&(t.format=e)}get format(){return this.get("format")}get defaultEditor(){const e=this,{min:t,max:n,step:r,format:i}=e;return{name:e.field,type:"date",calendarContainerCls:"b-grid-cell-editor-related",weekStartDay:e.grid.weekStartDay,format:i,max:n,min:t,step:r}}}Jh.registerColumnType(ig,!0),ig.exposeProperties(),ig._$name="DateColumn";class sg extends eg{static get type(){return"percent"}static get fieldType(){return"number"}static get fields(){return["showValue","lowThreshold"]}static get defaults(){return{min:0,max:100,showValue:!1,lowThreshold:20,htmlEncode:!1,searchable:!1,summaryRenderer:e=>`${e}%`,fitMode:!1}}constructor(e,t){super(...arguments),this.internalCellCls="b-percent-bar-cell"}defaultRenderer({value:e}){return{className:"b-percent-bar-outer",role:"progressbar","aria-Valuemin":0,"aria-Valuemax":100,"aria-Valuenow":e=e||0,tabIndex:0,children:[{tag:"div",className:{"b-percent-bar":1,"b-zero":0===e,"b-low":e<this.lowThreshold},style:{width:e+"%"},children:[this.showValue?{tag:"span",text:e+"%"}:void 0]}]}}resizeToFitContent(){}}sg.sum="average",Jh.registerColumnType(sg,!0),sg._$name="PercentColumn";class og extends eg{static get $name(){return"RatingColumn"}static get type(){return"rating"}static get fieldType(){return"number"}static get fields(){return["emptyIcon","filledIcon","editable"]}static get defaults(){return{min:0,max:5,emptyIcon:"b-icon b-icon-star",filledIcon:"b-icon b-icon-star",editable:!0,filterType:"number",searchable:!1,width:"11.2em",htmlEncode:!1,minWidth:"11.2em",editor:!1,fitMode:"value"}}renderer({value:e}){return{className:{"b-rating-cell-inner":1,"b-not-editable":!this.editable},children:ke.populate(this.max,(t=>{const n=t<e;return{tag:"i",className:{"b-rating-icon":!0,"b-filled":n,"b-empty":!n,[n?this.filledIcon:this.emptyIcon]:!0}}}))}}onCellClick({grid:e,column:t,record:n,target:r,event:i}){if(r.classList.contains("b-rating-icon")&&!e.readOnly&&t.editable){let e=[].indexOf.call(r.parentNode.childNodes,r);r.classList.contains("b-filled")&&(i.metaKey||i.shiftKey)&&(e-=1),1===n.get(t.field)&&0===e&&(e=-1),n.set(t.field,e+1)}}}Jh.registerColumnType(og,!0),og.exposeProperties(),og._$name="RatingColumn";class ag extends Kh{static get defaults(){return{groupable:!1,sortable:!1,filterable:!1,searchable:!1,resizable:!1,minWidth:50,width:50,align:"end",text:"#",editor:!1}}construct(e){super.construct(...arguments);const t=this,{grid:n}=t;t.internalCellCls="b-row-number-cell",n&&(n.on({bindStore:"bindStore",thisObj:t}),t.bindStore({store:n.store,initial:!0}),n.store.count&&!n.rendered&&n.on({paint:"resizeToFitContent",thisObj:t,once:!0}))}static get type(){return"rownumber"}get groupHeaderReserved(){return!0}bindStore({store:e,initial:t}){const n=this;n.detachListeners("grid"),e.on({name:"grid",[`change${n.grid.asyncEventSuffix}`]:"onStoreChange",thisObj:n}),t||n.resizeToFitContent()}onStoreChange({action:e}){"dataset"!==e&&"add"!==e&&"remove"!==e&&"removeall"!==e||this.resizeToFitContent()}renderer({record:e,grid:t}){return e.isSpecialRow?"":t.store.indexOf(e,!0)+1}resizeToFitContent(){const{grid:e}=this,{store:t}=e,{count:n}=t;if(n&&!this.hidden){const t=e.element.querySelector(`.b-grid-cell[data-column-id="${this.id}"]`);if(t){const e=parseInt(Mr.getStyleValue(t,"padding-left")),r=Mr.measureText(n,t);this.width=Math.max(this.minWidth,r+2*e)}}}set flex(e){}}Jh.registerColumnType(ag,!0),ag._$name="RowNumberColumn";class lg extends Kh{static get fields(){return["template"]}static get defaults(){return{htmlEncode:!1}}constructor(e,t){if(super(...arguments),!this.template)throw new Error("TemplateColumn needs a template");if("function"!=typeof this.template)throw new Error("TemplateColumn.template must be a function")}static get type(){return"template"}renderer(e){if(!e.record.isSpecialRow)return this.template({value:e.value,record:e.record,field:e.column.field})}}Jh.registerColumnType(lg,!0),lg.exposeProperties(),lg._$name="TemplateColumn";class cg extends Kh{static get type(){return"time"}static get fieldType(){return"date"}static get fields(){return["format"]}static get defaults(){return{format:"LT",minWidth:140,filterType:"time"}}defaultRenderer({value:e}){return e?this.formatValue(e):""}groupRenderer({cellElement:e,groupRowFor:t}){e.innerHTML=this.formatValue(t)}formatValue(e){return"string"==typeof e&&(e=en.parse(e,this.format)),en.format(e,this.format)}set format(e){const{editor:t}=this;this.set("format",e),t&&(t.format=e)}get format(){return this.get("format")}get defaultEditor(){return{name:this.field,type:"time",format:this.format}}}Jh.registerColumnType(cg,!0),cg.exposeProperties(),cg._$name="TimeColumn";let dg=!1;class ug extends Kh{static get defaults(){return{tree:!0,hideable:!1,minWidth:150}}static get fields(){return[{name:"expandIconCls",defaultValue:"b-icon b-icon-tree-expand"},{name:"collapseIconCls",defaultValue:"b-icon b-icon-tree-collapse"},{name:"collapsedFolderIconCls"},{name:"expandedFolderIconCls"},{name:"indentSize",defaultValue:1.7},{name:"leafIconCls",defaultValue:"b-icon b-icon-tree-leaf"},{name:"editTargetSelector",defaultValue:".b-tree-cell-value"}]}static get type(){return"tree"}constructor(e,t){super(...arguments);const n=this;n.shouldHtmlEncode=n.htmlEncode,n.setData("htmlEncode",!1),n.renderer&&(n.originalRenderer=n.renderer),n.renderer=n.treeRenderer.bind(n)}treeRenderer(e){const t=this,{grid:n,column:r,cellElement:i,row:s,record:o,isExport:a}=e,l=o.instanceMeta(n.store),c=!o.isLeaf&&l.collapsed,d={className:"b-tree-cell-value"},u=[d],h={className:"b-tree-cell-inner",tag:o.href?"a":"div",href:o.href,target:o.target,children:u},g={"b-tree-parent-row":0,"b-tree-collapsed":0,"b-tree-expanded":0,"b-loading-children":0};let m,p,{value:f}=e;if(t.originalRenderer){var v;const s=t.originalRenderer(e),o=null===(v=n.hasFrameworkRenderer)||void 0===v?void 0:v.call(n,{cellContent:s,column:r});m="object"==typeof s&&!o,f=o?"":!1===s?i.innerHTML:s,e.rendererHtml=s}var y;if(m||(f=String(null!==(y=f)&&void 0!==y?y:"")),a)return f;if(o.isLeaf)i.classList.add("b-tree-leaf-cell"),p=e.iconCls||o.iconCls||t.leafIconCls;else{var b;const r=!o.isExpanded(n.store),s=r?t.expandIconCls:t.collapseIconCls,a=r?t.collapsedFolderIconCls:t.expandedFolderIconCls;g["b-tree-parent-row"]=1,g["b-tree-collapsed"]=r,g["b-tree-expanded"]=!r,g["b-loading-children"]=l.isLoadingChildren,i.classList.add("b-tree-parent-cell"),u.unshift({tag:"i",className:{"b-tree-expander":1,[s]:1,"b-empty-parent":!(l.isLoadingChildren||!0===o.children||null!==(b=o.children)&&void 0!==b&&b.length)}}),dg=p=e.iconCls||o.iconCls||a}if(p&&u.splice(u.length-1,0,{tag:"i",className:{"b-tree-icon":1,[p]:1}}),s.isRow&&(s.assignCls(g),!o.isLeaf))if(s.setAttribute("aria-expanded",!c),c)s.removeAttribute("aria-owns");else for(const e in n.subGrids){var C,w;const t=s.elements[e];Mr.setAttributes(t,{"aria-owns":null!==(C=o.children)&&void 0!==C&&C.length?null===(w=o.children)||void 0===w?void 0:w.map((t=>`${n.id}-${e}-${t.id}`)).join(" "):null})}m||t.shouldHtmlEncode||!f.includes("<")?(m&&Object.assign(d,f),d.children=d.children||[],d.children.unshift(m?null:f)):d.html=f;const S=o.childLevel*t.indentSize+(o.isLeaf?dg?2:p?.5:.4:0);return h.style=`padding-inline-start:${S}em`,h}getCurrentConfig(e){const t=super.getCurrentConfig(e);return t.renderer=this.originalRenderer,t}}v(ug,"$name","TreeColumn"),Jh.registerColumnType(ug,!0),ug.exposeProperties(),ug._$name="TreeColumn";class hg extends Hi{static get fields(){return[{name:"iconCls",internal:!0},{name:"expanded",internal:!0},{name:"cls",internal:!0},{name:"rowHeight",internal:!0},{name:"href",internal:!0},{name:"target",internal:!0}]}}hg.exposeProperties(),hg._$name="GridRowModel";const gg=new Map,mg=new Map,pg={Grid:"GridBase",Scheduler:"SchedulerBase",SchedulerPro:"SchedulerProBase",Gantt:"GanttBase"},fg=/\$\d+$/;class vg{static registerFeature(e,t=!1,n=null,r=null){r=(r=_.uncapitalize(r||Object.prototype.hasOwnProperty.call(e,"$name")&&e.$$name||e.name)).replace(fg,""),Array.isArray(n)||(n=[n||"Grid"]),n.forEach((n=>{const i=pg[n]||n,s=gg.get(i)||new Map,o=mg.get(i)||new Map;s.set(r,e),o.set(e,t),gg.set(i,s),mg.set(i,o)}))}static getTypeNameFeatures(e="Grid"){const t=pg[e]||e,n=gg.get(t),r={};return n&&n.forEach(((e,t)=>r[t]=e)),r}static getTypeNameDefaultFeatures(e="Grid"){const t=pg[e]||e,n=gg.get(t),r=mg.get(t),i={};return n&&r&&n.forEach(((e,t)=>{r.get(e)&&(i[t]=e)})),i}static getInstanceFeatures(e){return e.$meta.names.reduce(((e,t)=>Object.assign(e,this.getTypeNameFeatures(t))),{})}static getInstanceDefaultFeatures(e){return e.$meta.names.reduce(((e,t)=>Object.entries(this.getTypeNameFeatures(t)).reduce(((e,[n,r])=>(this.isDefaultFeatureForTypeName(r,t)?e[n]=r:delete e[n],e)),e)),{})}static isDefaultFeatureForTypeName(e,t="Grid"){const n=pg[t]||t,r=mg.get(n);return r&&r.get(e)||!1}static isDefaultFeatureForInstance(e,t){const n=t.$meta.names.slice().reverse();let r=null;for(let t=0,i=n.length;t<i&&null===r;++t){const i=mg.get(n[t]);i&&i.has(e)&&(r=i.get(e))}return r||!1}static reset(){gg.clear(),mg.clear()}}const yg={Enter:1,F2:1},bg={ArrowUp:1,ArrowDown:1,ArrowLeft:1,ArrowRight:1,Escape:1,Enter:1,Tab:1,F2:1};class Cg extends(Zr(Wr)){static get $name(){return"CellEdit"}static get defaultConfig(){return{autoSelect:!0,blurAction:"complete",continueEditingOnCellClick:!0,addNewAtEnd:null,autoEdit:null,editNextOnEnterPress:!0,editorClass:Uu,triggerEvent:"celldblclick",touchEditDelay:300,focusCellAnimationDuration:!1}}static get pluginConfig(){return{assign:["startEditing","finishEditing","cancelEditing"],before:["onElementKeyDown","onElementMouseDown","onElementPointerUp"],chain:["onElementClick","bindStore"]}}construct(e,t){super.construct(e,t);const n=this,r={renderRows:"onGridRefreshed",cellClick:"onCellClick",thisObj:n};n.grid=e,"cellclick"!==n.triggerEvent&&(r[n.triggerEvent]="onTriggerEditEvent"),n.autoEdit&&!("editNextOnEnterPress"in t)&&(n.editNextOnEnterPress=!1),e.on(r),e.rowManager.on({changeTotalHeight:"onGridRefreshed",thisObj:n}),n.bindStore(e.store)}bindStore(e){this.detachListeners("store"),e.on({name:"store",update:"onStoreUpdate",thisObj:this})}async confirm(e){let t=!0;return this.editorContext&&(rh.owner=this.editorContext.editor.inputField,e.rootElement=this.grid.rootElement,t=await rh.confirm(e),rh.owner=null),t===rh.yesButton}doDestroy(){this.grid.columns.allRecords.forEach((e=>{var t;null===(t=e._cellEditor)||void 0===t||t.destroy()})),super.doDestroy()}doDisable(e){e&&this.cancelEditing(!0),super.doDisable(e)}set disabled(e){super.disabled=e}get disabled(){const{grid:e}=this;return Boolean(super.disabled||e.disabled||e.readOnly)}get isEditing(){return Boolean(this.editorContext)}get activeRecord(){var e;return(null===(e=this.editorContext)||void 0===e?void 0:e.record)||null}getEditorForCell({id:e,cell:t,column:n,columnId:r,editor:i}){var s;const o=this,{grid:a,editorClass:l}=o;let c=n.cellEditor,d=0;return n.editTargetSelector&&(d=t.querySelector(n.editTargetSelector).offsetLeft),i.autoSelect=o.autoSelect,null!==(s=c)&&void 0!==s&&s.isEditor||(c=n.data.cellEditor=l.create(l.mergeConfigs({type:l.type,constrainTo:null,cls:"b-cell-editor",inputField:i,blurAction:"none",invalidAction:n.invalidAction,completeKey:!1,cancelKey:!1,owner:a,align:{align:"t0-t0",offset:[d,0]},listeners:o.getEditorListeners(),onInternalKeyDown:o.onEditorKeydown.bind(o),allowMouseEvents:i.allowMouseEvents},c))),c.minHeight=a.rowHeight,c.inputField!==i&&(c.remove(c.items[0]),c.add(i)),c.align.offset[0]=d,n.instantUpdate&&!i.cellEditValueSetter&&(sn.wrapProperty(i,"value",null,(e=>{const{editorContext:t}=o,n=null==t?void 0:t.editor.inputField;null==t||!t.editor.isValid||sn.isEqual(t.record[t.column.field],e)||null!=n&&n.isDateField&&!n._isPickerInput||(t.record[t.column.field]=e)})),i.cellEditValueSetter=!0),Object.assign(c.element.dataset,{rowId:e,columnId:r,field:n.field}),c.inputField.revertOnEscape=n.revertOnEscape,o.editor=c}getEditorListeners(){return{focusOut:"onEditorFocusOut",focusIn:"onEditorFocusIn",start:"onEditorStart",beforeComplete:"onEditorBeforeComplete",complete:"onEditorComplete",beforeCancel:"onEditorBeforeCancel",cancel:"onEditorCancel",beforeHide:"onBeforeEditorHide",finishEdit:"onEditorFinishEdit",thisObj:this}}onEditorStart({source:e}){const t=this,n=t.editorContext=e.cellEditorContext;if(n){const{grid:e}=t;"cellclick"!==t.triggerEvent&&e.on({cellclick:"onCellClickWhileEditing"},t),t.removeEditingListeners=zr.addListener({globaltap:"onTapOut",thisObj:t}),e.trigger("startCellEdit",{grid:e,editorContext:n})}}onEditorBeforeComplete(e){const{grid:t}=this,n=e.source.cellEditorContext;return e.grid=t,e.editorContext=n,t.trigger("beforeFinishCellEdit",e)}onEditorComplete({source:e}){const{grid:t}=this,n=e.cellEditorContext;n.value=e.inputField.value,t.trigger("finishCellEdit",{grid:t,editorContext:n})}onEditorBeforeCancel(){const{editorContext:e}=this;return this.grid.trigger("beforeCancelCellEdit",{editorContext:e})}onEditorCancel({event:e}){const{editorContext:t,muteEvents:n,grid:r}=this;n||r.trigger("cancelCellEdit",{grid:r,editorContext:t,event:e})}onBeforeEditorHide({source:e}){const t=this,{row:n,cell:r}=e.cellEditorContext;null==r||r.classList.remove("b-editing"),null==n||n.removeCls("b-editing"),t.grid.un({cellclick:"onCellClickWhileEditing",viewportResize:"onViewportResizeWhileEditing"},t),t.removeEditingListeners()}onEditorFinishEdit({source:e}){e.cellEditorContext=this.editorContext=null}getAdjacentEditableCell(e,t){const{grid:n}=this,{store:r,columns:i}=n,{visibleColumns:s}=i;let o=e.id,a=i.getAdjacentVisibleLeafColumn(e.columnId,t);for(;o;)if(a){if(a.editor&&a.canEdit(r.getById(o)))return{id:o,columnId:a.id};a=i.getAdjacentVisibleLeafColumn(a,t)}else{const n=r.getAdjacent(e.id,t,!1,!0);o=null==n?void 0:n.id,n&&(a=t?s[0]:s[s.length-1])}return null}doAddNewAtEnd(){const e="object"==typeof this.addNewAtEnd?sn.clone(this.addNewAtEnd):{},{grid:t}=this,n=t.store.add(e)[0];return t.rowManager.getRowFor(n)||t.rowManager.displayRecordAtBottom(),n}getEditingContext(e){e=this.grid.normalizeCellContext(e);const{column:t,record:n}=e;if(null!=t&&t.isVisible&&t.editor&&n&&!n.isSpecialRow&&!n.readOnly&&t.canEdit(n)){const r=n?t.getRawValue(n):n;return Object.assign(e,{value:void 0===r?null:r,editor:t.editor}),e}return!1}async startEditing(e={}){const t=this;if(!t.disabled){var n;const{grid:s}=t;if(sn.isEmpty(e)&&(e.id=s.firstVisibleRow.id),s.store.isTree&&s.features.tree){var r,i;const t=null!==(r=null!==(i=e.id)&&void 0!==i?i:e.record)&&void 0!==r?r:s.store.getAt(e.row);t&&await s.expandTo(t)}const o=t.getEditingContext(e);if(!o)return!1;if(t.editorContext&&t.cancelEditing(),null!==(n=s.focusedCell)&&void 0!==n&&n.equals(o)||s.focusCell(o),!1===s.trigger("beforeCellEditStart",{grid:s,editorContext:o}))return!1;const a=o.editor=t.getEditorForCell(o),{row:l,cell:c,record:d}=o;return a.inputField.highlightExternalChange=!1,a.cellEditorContext=o,a.render(c),c.classList.add("b-editing"),l.addCls("b-editing"),await a.startEdit({target:c,field:a.inputField.name||o.column.field,value:o.value,record:d})||(c.classList.remove("b-editing"),l.removeCls("b-editing")),!0}return!1}cancelEditing(e=!1,t){const n=this,{editorContext:r,editor:i}=n;r&&(n.muteEvents=e,i.cancelEdit(t),n.muteEvents=!1)}async finishEditing(){const e=this,{editorContext:t}=e;let n=!1;if(t){const{column:r}=t;e.finishEditingPromise=t.editor.completeEdit(r.bindCallback(r.finalizeCellEdit)),n=await e.finishEditingPromise,await e.grid.waitForAnimations(),e.finishEditingPromise=null}return n}async onCellClickWhileEditing({event:e,cellSelector:t}){const n=this;Mr.isTouchEvent?await n.finishEditing():n.finishEditingPromise||n.editorContext&&!n.editorContext.editor.owns(e.target)&&(n.getEditingContext(t)?await n.finishEditing()?n.continueEditingOnCellClick&&await n.startEditing(t):(n.grid.focusCell(n.editorContext),n.editor.inputField.focus()):await n.finishEditing())}async onCellClick({source:e,cellSelector:t,target:n,event:r,column:i}){if(i.onCellClick)return;const s=this,{focusedCell:o}=s.client;if(n.closest(".b-tree-expander"))return!1;Mr.isTouchEvent&&s._lastCellClicked===(null==o?void 0:o.cell)&&r.timeStamp-s.touchEditDelay>s._lastCellClickedTime?await s.startEditing(t):"cellclick"===this.triggerEvent&&await s.onTriggerEditEvent({cellSelector:t,target:n}),s._lastCellClicked=null==o?void 0:o.cell,s._lastCellClickedTime=r.timeStamp}onElementPointerUp(e){e.target.closest(".b-tree-expander")&&this.cancelEditing(void 0,e)}async onTriggerEditEvent({cellSelector:e,target:t,event:n}){var r;const{editorContext:i,client:s}=this;t.closest(".b-tree-expander")||Mr.isTouchEvent&&"dblclick"===n.type||n&&(null===(r=s.features.cellMenu)||void 0===r?void 0:r.triggerEvent)===n.type||(!i||!i.equals(this.grid.normalizeCellContext(e))&&await this.finishEditing())&&await this.startEditing(e)}onStoreUpdate({changes:e,record:t}){const{editorContext:n}=this;null!=n&&n.editor.isVisible&&t===n.record&&n.editor.dataField in e&&n.editor.refreshEdit()}onGridRefreshed(){const e=this,{grid:t,editorContext:n}=e;if(n&&t.isVisible&&t.focusedCell){const r=t.getCell(t.focusedCell),{editor:i}=n;r&&!i.isFinishing?(n._cell=r,zr.suspendFocusEvents(),i.render(r),i.showBy(r),i.focus(),zr.resumeFocusEvents()):e.cancelEditing()}}async onElementKeyDown(e){const t=this;if(!e.handled&&!t.editorContext){const{key:n,ctrlKey:r}=e,i="Backspace"===n,s=t.autoEdit&&!r&&(1===n.length||i),{focusedCell:o}=t.grid;if((s||yg[n])&&o&&!o.isActionable&&await t.startEditing(o)){const{inputField:r}=t.editor,{input:o}=r;s&&o&&(r.internalOnKeyEvent(e),e.defaultPrevented||(o.value=i?"":n,r.internalOnInput(e))),e.preventDefault()}}}onEditorKeydown(e){const t=this;switch(e.key){case"Enter":t.onEnterKeyPress(e);break;case"F2":e.preventDefault(),t.finishEditing();break;case"Escape":e.preventDefault(),t.cancelEditing(void 0,e);break;case"Tab":t.onTabKeyPress(e)}if(bg[e.key]&&(e.handled=!0),e.handled)return e.stopPropagation(),!1}async onEnterKeyPress(e){const t=this,{grid:n}=t,{record:r}=t.editorContext;let i;if(e.preventDefault(),e.stopPropagation(),await t.finishEditing()){if(t.isDestroyed)return;if(!t.isEditing){if(e.ctrlKey||e.metaKey||e.altKey||n.touch)return;e.shiftKey?i=n.internalNextPrevRow(!1,!0,e,!1):(t.addNewAtEnd&&r===n.store.last&&await t.doAddNewAtEnd(),t.isDestroyed||(i=n.internalNextPrevRow(!0,!0,e))),i&&t.editNextOnEnterPress&&t.startEditing(i)}}}async onTabKeyPress(e){e.preventDefault();const t=this,{focusedCell:n}=t.grid;if(n){const r=!e.shiftKey;let i=t.getAdjacentEditableCell(n,r);if(!i&&r&&t.addNewAtEnd&&!0===await t.finishEditing()&&(await this.doAddNewAtEnd(),i=!t.isDestroyed&&t.getAdjacentEditableCell(n,r)),i){let n=!0;t.isEditing&&(n=await t.finishEditing()),!t.isDestroyed&&n&&(t.grid.focusCell(i,{animate:t.focusCellAnimationDuration}),await t.startEditing(i)||await t.onTabKeyPress(e))}}}onElementMouseDown(e){this.editorContext&&this.grid.isScrollbarOrRowBorderOrSplitterClick(e)&&this.cancelEditing()}async onEditorFocusOut(e){const t=this,{grid:n,editor:r,editorContext:i}=t,s=new Gh(e.relatedTarget),o=s.grid===n&&t.getEditingContext(s);i&&!r.isFinishing&&r.owns(e._target)&&("cancel"===t.blurAction?t.cancelEditing(void 0,e):t.finishEditingPromise||"cellclick"!==t.triggerEvent&&("cellclick"===t.triggerEvent||o)||await t.finishEditing())}onEditorFocusIn(e){const t=e.toWidget;t===this.editor.inputField&&this.autoSelect&&t.selectAll&&!t.readOnly&&!t.disabled&&t.selectAll()}async onTapOut({event:e}){const t=this;t.grid.bodyContainer.contains(e.target)&&!e.button||t.editor.owns(e.target)||("cancel"===t.blurAction?t.cancelEditing(void 0,e):await t.finishEditing())}async onElementClick(e){e.target.classList.contains("b-grid-body-container")&&this.editorContext&&await this.finishEditing()}}Cg._$name="CellEdit",vg.registerFeature(Cg,!0);class wg extends _c{static get $name(){return"CellMenu"}static get defaultConfig(){return{processItems:null,items:null,type:"cell"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateCellMenu"),e}showContextMenu(e){const{cellSelector:t,id:n,event:r}=e;this.client.focusCell(t,{doSelect:!this.client.isSelected(n),event:r}),super.showContextMenu(e)}shouldShowMenu({column:e}){return e&&!1!==e.enableCellContextMenu}getDataFromEvent(e){const t=this.client.getCellDataFromEvent(e);if(t)return sn.assign(super.getDataFromEvent(e),t)}beforeContextMenuShow(e){e.record&&!e.record.isSpecialRow||(e.items.removeRow=!1)}populateCellMenu({items:e,column:t,record:n}){const{client:r}=this;null!=t&&t.cellMenuItems&&sn.merge(e,t.cellMenuItems),r.readOnly||(e.removeRow={text:"L{removeRow}",localeClass:this,icon:"b-fw-icon b-icon-trash",cls:"b-separator",weight:100,disabled:n.readOnly,onItem:()=>r.store.remove(r.selectedRecords.filter((e=>!e.readOnly)))})}get showMenu(){return!0}}wg.featureClass="",wg._$name="CellMenu",vg.registerFeature(wg,!0,["Grid","Scheduler"]),vg.registerFeature(wg,!1,["Gantt"]);class Sg extends Wr{static get $name(){return"CellTooltip"}static get defaultConfig(){return{tooltipRenderer:null}}construct(e,t){super.construct(e,this.processConfig(t))}initTip(){const e=this;e.tip=lu.new({forElement:e.client.element,forSelector:".b-grid-row:not(.b-group-row) .b-grid-cell, .b-grid-merged-cells",hoverDelay:1e3,trackMouse:!1,cls:"b-celltooltip-tip",getHtml:e.getTooltipContent.bind(e),listeners:{pointerOver:"onPointerOver",thisObj:e}},e.initialConfig),e.relayEvents(e.tip,["beforeshow","show"])}onPointerOver({target:e}){const t=this.client.getColumnFromElement(e);return!1!==t.tooltipRenderer&&Boolean(t.tooltipRenderer||this.tooltipRenderer)}processConfig(e){return"function"==typeof e?{tooltipRenderer:e}:e}setConfig(e){super.setConfig(this.processConfig(e))}doDestroy(){this.tip&&this.tip.destroy(),super.doDestroy()}doDisable(e){e?this.tip&&(this.tip.destroy(),this.tip=null):this.initTip(),super.doDisable(e)}getTooltipContent({tip:e,activeTarget:t,event:n}){const r=this,i=r.client.getRecordFromElement(t),s=r.client.getColumnFromElement(t),o={cellElement:t,record:i,column:s,event:n,tip:e,cellTooltip:r};let a;return r.forSelector||i!==r.lastRecord||i.generation!==r.lastRecordGeneration||s!==r.lastColumn?(r.lastRecord=i,r.lastRecordGeneration=i.generation,r.lastColumn=s,s.tooltipRenderer?a=s.tooltipRenderer(o):r.tooltipRenderer&&!1!==s.tooltipRenderer&&(a=r.tooltipRenderer(o)),Y.isPromise(a)&&(r.lastRecord=r.lastRecordGeneration=r.lastColumn=null),a):r.tip._html}}Sg._$name="CellTooltip",vg.registerFeature(Sg);const Dg="store";class Eg extends(Zr(Wr)){static get $name(){return"ColumnAutoWidth"}static get configurable(){return{default:null,delay:0}}static get pluginConfig(){return{after:{bindStore:"bindStore",unbindStore:"unbindStore",renderRows:"syncAutoWidthColumns",onInternalResize:"onInternalResize"},assign:["columnAutoWidthPending","syncAutoWidthColumns"]}}construct(e){super.construct(e);const{client:t}=this,{store:n}=t;n&&this.bindStore(n)}doDestroy(){this.unbindStore(),super.doDestroy()}bindStore(e){this.lastSync=null,e.on({name:Dg,[`change${this.client.asyncEventSuffix}`]:"onStoreChange"},this)}unbindStore(){this.detachListeners(Dg)}get columnAutoWidthPending(){return null===this.lastSync||this.hasTimeout("syncAutoWidthColumns")}onStoreChange({action:e}){if("move"!==e){var t;const e=this;++e.storeGeneration,null!==(t=e.client.features.cellEdit)&&void 0!==t&&t.isEditing?e.syncAutoWidthColumns():e.hasTimeout("syncAutoWidthColumns")||e.setTimeout("syncAutoWidthColumns",e.delay)}}onInternalResize(e,t,n,r){0===r&&(this.lastSync=null,this.syncAutoWidthColumns())}syncAutoWidthColumns(){const e=this,t=e.client,n=e.storeGeneration;if(e.lastSync!==n){let r,i;e.lastSync=n;for(const n of t.columns.visibleColumns)r=n.autoWidth,r&&(!0===r&&(r=e.default),t.resizingColumns=i=!0,n.resizeToFitContent(r));i&&(t.resizingColumns=!1,t.afterColumnsResized())}e.hasTimeout("syncAutoWidthColumns")&&e.clearTimeout("syncAutoWidthColumns")}}Eg.prototype.storeGeneration=0,Eg._$name="ColumnAutoWidth",vg.registerFeature(Eg,!0);class xg extends(Zr(Wr)){static get $name(){return"ColumnDragToolbar"}static get pluginConfig(){return{after:["render"]}}construct(e,t){e.features.columnReorder&&e.features.columnReorder.on("beforedestroy",this.onColumnReorderBeforeDestroy,this),this.grid=e,super.construct(e,t)}doDestroy(){const e=this;e.grid.features.columnReorder&&!e.grid.features.columnReorder.isDestroyed&&e.detachFromColumnReorder(),e.element&&e.element.remove(),e.element=null,super.doDestroy()}doDisable(e){this.initialized&&(e?this.detachFromColumnReorder():this.init()),super.doDisable(e)}init(){const e=this,t=e.grid;t.features.columnReorder&&(e.reorderDetacher=t.features.columnReorder.on({gridheaderdragstart({context:n}){const r=t.columns.getById(n.element.dataset.columnId);e.showToolbar(r)},gridheaderdrag:({context:t})=>e.onDrag(t),gridheaderabort:()=>{e.hideToolbar()},gridheaderdrop:({context:t})=>{t.valid?e.hideToolbar():e.onDrop(t)},thisObj:e}),e.initialized=!0)}onColumnReorderBeforeDestroy(){this.detachFromColumnReorder()}detachFromColumnReorder(){const e=this;e.grid.features.columnReorder.un("beforedestroy",e.onColumnReorderBeforeDestroy,e),e.reorderDetacher&&e.reorderDetacher(),e.reorderDetacher=null}render(){this.initialized||this.init()}showToolbar(e){const t=this,n=t.grid.getColumnDragToolbarItems(e,[]),r=[];t.clearTimeout(t.buttonHideTimer),n.forEach((e=>{e.text=e.localeClass.L(e.text);let t=r.find((t=>t.text===e.group));t||(t={text:e.localeClass.L(e.group),buttons:[]},r.push(t)),t.buttons.push(e)})),t.element=Mr.append(t.grid.element,t.template(r)),t.groups=r,t.buttons=n,t.column=e}async hideToolbar(){const e=this,t=e.element;t&&(t.classList.add("b-remove"),await _n.waitForTransitionEnd({element:t,mode:"animation",thisObj:e.client}),t.remove(),e.element=null)}onDrag(e){var t;const n=this;if(e.dragProxy.getBoundingClientRect().top-n.grid.element.getBoundingClientRect().top>100?n.element.classList.add("b-closer"):n.element.classList.remove("b-closer"),n.hoveringButton&&(n.hoveringButton.classList.remove("b-hover"),n.hoveringButton=null),null!==(t=e.targetElement)&&void 0!==t&&t.closest(".b-columndragtoolbar")){n.element.classList.add("b-hover");const t=e.targetElement.closest(".b-columndragtoolbar  .b-target-button:not([data-disabled=true])");t&&(t.classList.add("b-hover"),n.hoveringButton=t)}else n.element.classList.remove("b-hover")}onDrop(e){const t=this;if(e.targetElement&&e.targetElement.matches(".b-columndragtoolbar .b-target-button:not([data-disabled=true])")){const n=e.targetElement,r=t.buttons.find((e=>e.ref===n.dataset.ref));r&&(n.classList.add("b-activate"),t.buttonHideTimer=t.setTimeout((()=>{t.hideToolbar(),r.onDrop({column:t.column})}),100))}else t.hideToolbar()}template(e){return Yc.tpl`
            <div class="b-columndragtoolbar">     
            <div class="b-title"></div>          
            ${e.map((e=>Yc.tpl`
                <div class="b-group">
                    <div class="b-buttons">
                    ${e.buttons.map((e=>Yc.tpl`
                        <div class="b-target-button" data-ref="${e.ref}" data-disabled="${e.disabled}">
                            <i class="${e.icon}"></i>
                            ${e.text}
                        </div>
                    `))}
                    </div>
                    <div class="b-title">${e.text}</div>
                </div>
            `))}
            </div>`}}xg.featureClass="b-hascolumndragtoolbar",xg._$name="ColumnDragToolbar",vg.registerFeature(xg,y.isTouchDevice);class Rg extends Wr{static get pluginConfig(){return{chain:["populateHeaderMenu","getColumnDragToolbarItems"]}}get grid(){return this.client}getColumnPickerItems(e){const t=this,{createColumnsFromModel:n}=t;let r;if(t.groupByRegion)r=t.grid.regions.map((e=>{const n=t.grid.getSubGrid(e).columns.topColumns;return{text:_.capitalize(e),menu:t.buildColumnMenu(n),disabled:0===n.length,region:e}})),n&&r.push({text:t.L("L{newColumns}"),menu:t.createAutoColumnItems()});else if(t.groupByTag){const i={};e.topColumns.forEach((e=>{e.tags&&Array.isArray(e.tags)&&!1!==e.hideable&&e.tags.forEach((e=>{i[e]||(i[e]=1)}))})),r=Object.keys(i).sort().map((e=>({text:_.capitalize(e),menu:t.buildColumnMenu(t.getColumnsForTag(e)),tag:e,onBeforeSubMenu:({item:e,itemEl:n})=>{t.refreshTagMenu(e,n)}}))),n&&r.push({text:t.L("L{newColumns}"),menu:t.createAutoColumnItems()})}else r=t.buildColumnMenu(e.topColumns),n&&r.items.push(...sn.transformNamedObjectToArray(t.createAutoColumnItems()));return r}createAutoColumnItems(){const e=this,{grid:t}=e,{columns:n,store:r}=t,{modelClass:i}=r,{allFields:s}=i,o={};for(let t=0,{length:r}=s;t<r;t++){const r=s[t],i=r.name;n.get(i)||r.internal||(o[i]={text:r.text||_.separate(r.name),checked:!1,onToggle:t=>{const s=n.get(i);s?s[t.checked?"show":"hide"]():n.add(n.generateColumnForField(r,{region:e.forColumn.region})),t.bubbles=!1}})}return o}getColumnsForTag(e){return this.grid.columns.records.filter((t=>t.tags&&Array.isArray(t.tags)&&t.tags.includes(e)&&!1!==t.hideable))}refreshTagMenu(e,t){this.getColumnsForTag(e.tag).forEach((t=>{const n=e.items.find((e=>e.column===t));n&&(n.checked=!0!==t.hidden)}))}buildColumnMenu(e){let t=e.length>0&&e[0].region;const{grid:n}=this,r=e.reduce(((e,r)=>{const i=n.columns.visibleColumns.filter((e=>e.region===r.region));if(!1!==r.hideable){const s={grid:n,column:r,text:r.headerText,checked:!0!==r.hidden,disabled:!0!==r.hidden&&1===i.length,cls:r.region!==t?"b-separator":""};t=r.region,r.children&&!r.isCollapsible&&(s.menu=this.buildColumnMenu(r.children)),e.push(s)}return e}),[]);return{cls:this.menuCls,items:r}}populateHeaderMenu({column:e,items:t}){const n=this,{columns:r}=n.grid;if(n.forColumn=e,!1!==e.showColumnPicker&&r.some((e=>e.hideable))&&(t.columnPicker={text:"L{columnsMenu}",localeClass:n,icon:"b-fw-icon b-icon-columns",cls:"b-separator",weight:200,menu:n.getColumnPickerItems(r),onToggle:n.onColumnToggle,disabled:n.disabled}),!1!==e.hideable&&!e.parent.isCollapsible){const i=r.visibleColumns.filter((t=>t.region===e.region));t.hideColumn={text:"L{hideColumn}",localeClass:n,icon:"b-fw-icon b-icon-hide-column",weight:210,disabled:1===i.length||n.disabled,onItem:()=>e.hide()}}}onColumnToggle({menu:e,item:t,checked:n}){if(Boolean(t.column.hidden)!==!n){var r,i;t.column[n?"show":"hide"]();const{grid:s,column:o}=t,{columns:a,features:l}=s,c=e.items,d=a.visibleColumns.filter((e=>e.region===t.column.region)),u=(null===(r=l.headerMenu)||void 0===r?void 0:r.enabled)&&l.headerMenu.menu.widgetMap.hideColumn;if(1===d.length){const e=c.find((e=>e.column===d[0]));e&&(e.disabled=!0),u&&o.region===t.column.region&&(u.disabled=!0)}else d.forEach((e=>{const t=c.find((t=>t.column===e));t&&(t.disabled=!1)})),u&&o.region===t.column.region&&(u.disabled=!1);null===(i=t.menu)||void 0===i||i.eachWidget((e=>{e.checked=n}));const h=e.owner;h&&h.column===o.parent&&(h.checked=c.some((e=>!0===e.checked)))}}getColumnDragToolbarItems(e,t){const n=this.grid.columns.visibleColumns.filter((t=>t.region===e.region));return!1!==e.hideable&&n.length>1&&t.push({text:"L{hideColumnShort}",ref:"hideColumn",group:"L{column}",localeClass:this,icon:"b-fw-icon b-icon-hide-column",weight:101,onDrop:({column:e})=>e.hide()}),t}}v(Rg,"$name","ColumnPicker"),v(Rg,"configurable",{groupByRegion:!1,groupByTag:!1,createColumnsFromModel:!1,menuCls:"b-column-picker-menu b-sub-menu"}),Rg._$name="ColumnPicker",vg.registerFeature(Rg,!0);class Tg extends Wr{doDestroy(){var e;null===(e=this.editor)||void 0===e||e.destroy(),super.doDestroy()}static get pluginConfig(){return{after:["populateHeaderMenu"]}}populateHeaderMenu({items:e,column:t}){e.rename={weight:215,icon:"b-fw-icon b-icon-edit",text:this.L("L{rename}"),disabled:t.readOnly,onItem:()=>this.startEdit(t)}}startEdit(e){var t;if(e instanceof Event&&(e=null===(t=this.client.getHeaderDataFromEvent(e))||void 0===t?void 0:t.column),e){if(e.readOnly)return!1;const{textWrapper:t}=e;let{editor:n}=this;n||(this.editor=n=new Uu({owner:this.client,align:{align:"t0-t0"}})),n.render(t),n.startEdit({target:t,record:e,field:"text"})}}}v(Tg,"$name","ColumnRename"),v(Tg,"configurable",{keyMap:{F2:"startEdit"}}),Tg._$name="ColumnRename",vg.registerFeature(Tg,!1);class Mg extends(Zr(Wr)){constructor(...e){super(...e),v(this,"ignoreSelectors",[".b-grid-header-resize-handle",".b-field"])}doDestroy(){var e,t;null===(e=this.dragHelper)||void 0===e||e.scrollManager.destroy(),null===(t=this.dragHelper)||void 0===t||t.destroy(),super.doDestroy()}get grid(){return this.client}init(){const e=this,{grid:t}=e,n=t.element,r=Mr.children(n,".b-grid-headers");r.push(...Mr.children(n,".b-grid-header-children")),e.dragHelper?e.dragHelper.containers=r:(e.dragHelper=new jc({name:"columnReorder",mode:"container",dragThreshold:10,targetSelector:".b-grid-header",floatRootOwner:t,rtlSource:t,outerElement:t.headerContainer,monitoringConfig:{scrollables:[{element:".b-grid-headers"}]},scrollManager:ru.new({direction:"horizontal",element:t.headerContainer}),containers:r,isElementDraggable(n){if(Boolean(n.closest(e.ignoreSelectors.join(",")))||e.disabled)return!1;const r=n.closest(this.targetSelector),i=r&&t.columns.getById(r.dataset.columnId),s=0===(null==i?void 0:i.childLevel)&&1===t.subGrids[i.region].columns.count;return Boolean(i)&&!1!==i.draggable&&!s},ignoreSelector:".b-filter-icon,.b-grid-header-resize-handle",listeners:{beforeDragStart:e.onBeforeDragStart,dragstart:e.onDragStart,drag:e.onDrag,drop:e.onDrop,thisObj:e}}),e.relayEvents(e.dragHelper,["dragStart","drag","drop","abort"],"gridHeader"))}static get pluginConfig(){return{after:["onPaint","renderContents"]}}onDrag({context:e,event:t}){const n=Ka.fromElement(t.target,"gridheader");null!=n&&n.subGrid.sealedColumns?e.valid=!1:this.grid.features.columnDragToolbar||(e.valid=Boolean(t.target.closest(".b-grid-headers")))}onBeforeDragStart({context:e,event:t}){const{element:n}=e,r=e.column=this.client.columns.getById(n.dataset.columnId);return this.client.trigger("beforeColumnDragStart",{column:r,event:t})}onDragStart({context:e,event:t}){const n=this,{grid:r}=n,{column:i}=e;if(!r.features.columnDragToolbar){const e=r.element.querySelector(".b-grid-header-container").getBoundingClientRect();n.dragHelper.minY=e.top,n.dragHelper.maxY=e.bottom}r.headerContainer.classList.add("b-dragging-header"),e.dragProxy.style.fontSize=Mr.getStyleValue(e.element,"fontSize"),r.trigger("columnDragStart",{column:i,event:t})}onDrop({context:e,event:t}){if(!e.valid)return this.onInvalidDrop({context:e});const{grid:n}=this,r=e.dragging,i=e.target.closest(".b-grid-header"),s=n.columns.get(i.dataset.column),o=e.draggedTo.dataset.region||s.region,a=e.insertBefore,l=n.columns.getById(r.dataset.columnId),c=l.parent,d=a?n.columns.getById(a.dataset.columnId):n.subGrids[o].columns.last.nextSibling;let u;if(d)u=d.parent;else{const e=i.parentElement.closest(".b-grid-header");u=e?n.columns.getById(e.dataset.columnId):n.columns.rootNode}n.headerContainer.classList.remove("b-dragging-header"),r.remove();let h=o===l.region&&c===u&&(s===l.previousSibling||d===l.nextSibling);h=h||!1===n.trigger("beforeColumnDropFinalize",{column:l,newParent:u,insertBefore:d,event:t}),h||(h=!u.insertChild(l,d)),e.valid=!h,h||(l.region=o,0===c.children.length&&c.parent.removeChild(c)),n.trigger("columnDrop",{column:l,newParent:u,insertBefore:d,valid:e.valid,event:t})}onInvalidDrop(){this.grid.headerContainer.classList.remove("b-dragging-header")}renderContents(){this.init()}onPaint(){this.init()}}v(Mg,"$name","ColumnReorder"),Mg.featureClass="b-column-reorder",Mg._$name="ColumnReorder",vg.registerFeature(Mg,!0);class kg extends Wr{static get $name(){return"ColumnResize"}static get configurable(){return{liveResize:"auto"}}construct(e,t){const n=this;n.grid=e,super.construct(e,t),n.resizer=new zc({name:"columnResize",targetSelector:".b-grid-header",handleSelector:".b-grid-header-resize-handle",outerElement:e.element,rtlSource:e,listeners:{beforeresizestart:n.onBeforeResizeStart,resizestart:n.onResizeStart,resizing:n.onResizing,resize:n.onResize,thisObj:n}})}doDestroy(){var e;null===(e=this.resizer)||void 0===e||e.destroy(),super.doDestroy()}changeLiveResize(e){return"auto"===e?!y.isMobileSafari:e}onBeforeResizeStart(){return!this.disabled}onResizeStart({context:e}){const{grid:t,resizer:n}=this,r=e.column=t.columns.getById(e.element.dataset.columnId);n.minWidth=r.minWidth,e.element.style.minWidth="",t.element.classList.add("b-column-resizing")}onResizing({context:e}){e.valid&&this.liveResize&&(this.grid.resizingColumns=!0,e.column.width=e.newWidth)}onResize({context:e}){const{grid:t}=this,{column:n}=e;t.element.classList.remove("b-column-resizing"),e.valid&&(this.liveResize?(t.resizingColumns=!1,t.afterColumnsResized()):n.width=e.newWidth)}}kg._$name="ColumnResize",vg.registerFeature(kg,!0);class Ig extends qu{static get $name(){return"GridFieldFilterPicker"}static get type(){return"gridfieldfilterpicker"}afterConstruct(){const e=this;if(!e.grid)throw new Error(`${e.constructor.$name} requires 'grid' to be configured.`);e._fields=e.fields,super.afterConstruct()}updateGrid(e){var t;if(null===(t=e.store)||void 0===t||!t.modelClass)throw new Error("Grid does not have a store with a modelClass defined.");if(!e.columns)throw new Error("Grid does not have a column store.");delete this._cachedFields}static getModelClassFields(e){const t=new Set(e.fields.map((({name:e})=>e)));return(null==e?void 0:e.allFields.filter((e=>!e.internal&&(Yu.includes(e.type)||Gu(e))&&(e.definedBy!==Hi||t.has(e.name)))))||[]}static getColumnFields(e,t,n){const r=ke.keyBy(Ig.getModelClassFields(t),"name"),i=n&&new Set(n);return(null==e?void 0:e.records.filter((({field:e})=>e&&r[e]&&(!i||i.has(e)))).map((({field:e,text:t})=>({name:e,title:t||e,type:Gu(r[e])?"duration":r[e].type}))))||[]}get fields(){var e,t;return null!==(e=this._cachedFields)&&void 0!==e?e:this._cachedFields=Ig.getColumnFields(this.grid.columns,null===(t=this.grid.store)||void 0===t?void 0:t.modelClass,this.allowedFieldNames)}set fields(e){}}v(Ig,"configurable",{grid:null,allowedFieldNames:null}),Ig.initClass(),Ig._$name="GridFieldFilterPicker";class Ag extends Xu{static get $name(){return"GridFieldFilterPickerGroup"}static get type(){return"gridfieldfilterpickergroup"}validateConfig(){if(!this.grid)throw new Error(`${this.constructor.$name} requires the 'grid' config property.`)}getFilterPickerConfig(e){const{grid:t,allowedFieldNames:n}=this;return f(f({},super.getFilterPickerConfig(e)),{},{grid:t,allowedFieldNames:n})}updateGrid(e){this.store=this.grid.store}canManage(e){return super.canManage(e)&&(!this.allowedFieldNames||this.allowedFieldNames.includes(e.property))}}v(Ag,"configurable",{grid:null,allowedFieldNames:null}),v(Ag,"childPickerType","gridfieldfilterpicker"),Ag.initClass(),Ag._$name="GridFieldFilterPickerGroup";const Fg={date:"date",int:"number",integer:"number",number:"number",string:"text",duration:"duration"};class Og extends Wr{static get $name(){return"Filter"}static get configurable(){return{prioritizeColumns:!1,keyMap:{f:"showFilterEditorByKey"},isMulti:!1}}construct(e,t){if(e.features.filterBar)throw new Error("Grid.feature.Filter feature may not be used together with Grid.feature.FilterBar. These features are mutually exclusive.");const n=this;if(n.grid=e,n.closeFilterEditor=n.closeFilterEditor.bind(n),super.construct(e,t),n.bindStore(e.store),t&&"object"==typeof t){const n=sn.clone(t);delete n.prioritizeColumns,delete n.isMulti,delete n.dateFormat,sn.isEmpty(n)||e.store.filter(n,null,e.isConfiguring)}}doDestroy(){var e,t;null===(e=this.filterTip)||void 0===e||e.destroy(),null===(t=this.filterEditorPopup)||void 0===t||t.destroy(),super.doDestroy()}get store(){return this.grid.store}bindStore(e){this.detachListeners("store"),e.on({name:"store",beforeFilter:"onStoreBeforeFilter",filter:"onStoreFilter",thisObj:this})}static get pluginConfig(){return{chain:["renderHeader","populateCellMenu","populateHeaderMenu","onElementClick","bindStore"]}}refreshHeaders(e){const t=this,n=t.grid,r=n.headerContainer;r&&(Mr.children(r,".b-filter-icon.b-latest").forEach((e=>e.classList.remove("b-latest"))),t.filterTip||(t.filterTip=new lu({forElement:r,forSelector:".b-filter-icon",getHtml({activeTarget:e}){return e.dataset.filterText}})),n.store.isFiltered||t.filterTip.hide(),n.columns.visibleColumns.forEach((e=>{if(!1!==e.filterable){const n=t.store.filters.allValues.filter((({property:t,disabled:n,internal:r})=>t===e.field&&!n&&!r)),r=n.length>0,i=e.element;if(i){const s=e.textWrapper;let o,a=null==s?void 0:s.querySelector(".b-filter-icon");if(r){const r="&#x2022 ";o=`${t.L("L{filter}")}: `+(n.length>1?"<br/><br/>":"")+n.map((t=>{let i=t.displayValue||t.value;return!t.displayValue&&e.formatValue&&i&&(i=Array.isArray(i)?`[ ${i.map((t=>e.formatValue(t))).join(", ")} ]`:e.formatValue(i)),i=i||"",(n.length>1?r:"")+("string"==typeof t?t:`${t.operator} ${i}`)})).join("<br/><br/>")}else o=t.L("L{applyFilter}");a?a.dataset.filterText=o:a=Mr.createElement({parent:s,tag:"div",className:"b-filter-icon",dataset:{filterText:o}}),e.field===t.store.latestFilterField&&a.classList.add("b-latest"),i.classList.add("b-filterable"),i.classList.toggle("b-filter",r)}e.meta.isFiltered=r}})),e&&n.refreshRows())}applyFilter(e,t){const{store:n}=this,{filterFn:r}=e.filterable;e.$filter=n.addFilter(f(f(f({},e.filterable),t),{},{property:e.field,[r?"filterBy":"_"]:function(t){return r({value:this.value,record:t,operator:this.operator,property:this.property,column:e})}}),!0),n.filter()}removeFilter(e){if(this.isMulti)for(const t of this.getCurrentMultiFilters(e))this.store.removeFilter(t);else this.store.removeFilter(e.field)}disableFilter(e){for(const t of this.getCurrentMultiFilters(e))t.disabled=!0,this.store.filter(t);this.store.filter()}getCurrentMultiFilters(e){return this.store.filters.values.filter((t=>t.property===e.field))}getPopupDateItems(e,t,n,r,i,s,o,a){const l=this,c=s;function d(){l.removeFilter(e)}function u({event:e}){"Enter"===e.key&&s()}function h({source:t,value:n}){null==n?d():(l.clearSiblingsFields(t),l.applyFilter(e,{operator:t.operator,value:n,displayValue:t._value,type:"date"}))}return[sn.assign({type:"date",ref:"on",placeholder:"L{on}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:"="===(null==n?void 0:n.operator)?n.value:r,operator:"=",onKeydown:u,onChange:h,onClose:c,onClear:d},a),sn.assign({type:"date",ref:"before",placeholder:"L{before}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-before"></i>',value:"<"===(null==n?void 0:n.operator)?n.value:null,operator:"<",onKeydown:u,onChange:h,onClose:c,onClear:d},a),sn.assign({type:"date",ref:"after",cls:"b-last-row",placeholder:"L{after}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-after"></i>',value:">"===(null==n?void 0:n.operator)?n.value:null,operator:">",onKeydown:u,onChange:h,onClose:c,onClear:d},a)]}getPopupNumberItems(e,t,n,r,i,s,o,a){const l=this,c=s;function d(){l.removeFilter(e)}function u({event:e}){"Enter"===e.key&&s()}function h({source:t,value:n}){null==n?d():(l.clearSiblingsFields(t),l.applyFilter(e,{operator:t.operator,value:n}))}return[sn.assign({type:"number",placeholder:"L{Filter.equals}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:"="===(null==n?void 0:n.operator)?n.value:r,operator:"=",onKeydown:u,onChange:h,onEsc:c,onClear:d},a),sn.assign({type:"number",placeholder:"L{lessThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-less"></i>',value:"<"===(null==n?void 0:n.operator)?n.value:null,operator:"<",onKeydown:u,onChange:h,onEsc:c,onClear:d},a),sn.assign({type:"number",cls:"b-last-row",placeholder:"L{moreThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-more"></i>',value:">"===(null==n?void 0:n.operator)?n.value:null,operator:">",onKeydown:u,onChange:h,onEsc:c,onClear:d},a)]}clearSiblingsFields(e){var t;null===(t=this.filterEditorPopup)||void 0===t||t.items.forEach((t=>{t!==e&&(null==t||t.clear())}))}getPopupDurationItems(e,t,n,r,i,s,o,a){const l=this,c=s,d=o;function u({source:t,value:n}){null==n?o():(l.applyFilter(e,{operator:t.operator,value:n}),s())}return[sn.assign({type:"duration",placeholder:"L{Filter.equals}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:"="===(null==n?void 0:n.operator)?n.value:r,operator:"=",onChange:u,onEsc:c,onClear:d},a),sn.assign({type:"duration",placeholder:"L{lessThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-less"></i>',value:"<"===(null==n?void 0:n.operator)?n.value:null,operator:"<",onChange:u,onEsc:c,onClear:d},a),sn.assign({type:"duration",cls:"b-last-row",placeholder:"L{moreThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-more"></i>',value:">"===(null==n?void 0:n.operator)?n.value:null,operator:">",onChange:u,onEsc:c,onClear:d},a)]}getPopupStringItems(e,t,n,r,i,s,o,a){const l=this;return[sn.assign({type:t,cls:"b-last-row",placeholder:"L{filter}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:n?n.value||n:r,operator:"*",onChange({source:t,value:n}){""===n?o():(l.applyFilter(e,{operator:t.operator,value:n,displayValue:t.displayField&&t.records?t.records.map((e=>e[t.displayField])).join(", "):void 0}),t.multiSelect||s())},onClose:s,onClear:o},a)]}getPopupItems(e,t,n,r,i,s,o,a){const l=this;if(l.isMulti)return l.getMultiFilterPopupItems(...arguments);switch(t){case"date":return l.getPopupDateItems(...arguments);case"number":return l.getPopupNumberItems(...arguments);case"duration":return l.getPopupDurationItems(...arguments);default:return l.getPopupStringItems(...arguments)}}getMultiFilterPopupItems(e){var t;const{grid:n,isMulti:r}=this,i=null===(t=n.store)||void 0===t?void 0:t.filters.find((t=>t.property===e.field));return[f(f({},"object"==typeof r?r:void 0),{},{type:"gridfieldfilterpickergroup",ref:"pickerGroup",limitToProperty:e.field,grid:n,filters:i?[]:[{property:e.field}],propertyFieldCls:"b-transparent property-field",operatorFieldCls:"b-transparent operator-field",valueFieldCls:"b-transparent value-field",width:"400px"})]}showFilterEditor(e,t){e=this.grid.columns.getById(e);const n=this,{store:r,isMulti:i}=n,s=e.element,o=r.filters.getBy("property",e.field),a=n.getFilterType(e);if(!1===e.filterable)return;n.closeFilterEditor();const l=n.getPopupItems(e,a,null!=o&&o.internal?null:o,t,r,n.closeFilterEditor,(()=>{n.removeFilter(e),n.closeFilterEditor()}),e.filterable.filterField,i);l.forEach((e=>e.placeholder=e.placeholder?this.L(e.placeholder):e.placeholder)),n.filterEditorPopup=qc.openPopup(s,{owner:n.grid,cls:"b-filter-popup",scrollAction:"realign",layout:{type:"vbox",align:"stretch"},items:l})}closeFilterEditor(){var e;null===(e=this.filterEditorPopup)||void 0===e||e.setTimeout(this.filterEditorPopup.destroy),this.filterEditorPopup=null}getFilterType(e){const t=e.field,n=this.client.store.modelClass.getFieldDefinition(t),r=e.filterType;return r?Fg[r]:Fg[e.type]||n&&Fg[n.type]||"text"}populateCellMenuWithDateItems({column:e,record:t,items:n}){const r=e.field;if("date"===this.getFilterType(e)){const i=this,s=t[r],o=t=>{i.applyFilter(e,{operator:t,value:s,displayValue:e.formatValue?e.formatValue(s):s,type:"date"})};n.filterDateEquals={text:"L{on}",localeClass:i,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:i.disabled,onItem:()=>o("=")},n.filterDateBefore={text:"L{before}",localeClass:i,icon:"b-fw-icon b-icon-filter-before",weight:310,disabled:i.disabled,onItem:()=>o("<")},n.filterDateAfter={text:"L{after}",localeClass:i,icon:"b-fw-icon b-icon-filter-after",weight:320,disabled:i.disabled,onItem:()=>o(">")}}}populateCellMenuWithNumberItems({column:e,record:t,items:n}){const r=e.field;if("number"===this.getFilterType(e)){const i=this,s=t[r],o=t=>{i.applyFilter(e,{operator:t,value:s})};n.filterNumberEquals={text:"L{equals}",localeClass:i,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:i.disabled,onItem:()=>o("=")},n.filterNumberLess={text:"L{lessThan}",localeClass:i,icon:"b-fw-icon b-icon-filter-less",weight:310,disabled:i.disabled,onItem:()=>o("<")},n.filterNumberMore={text:"L{moreThan}",localeClass:i,icon:"b-fw-icon b-icon-filter-more",weight:320,disabled:i.disabled,onItem:()=>o(">")}}}populateCellMenuWithDurationItems({column:e,record:t,items:n}){const r=e.field;if("duration"===this.getFilterType(e)){const i=this,s=t[r],o=t=>{i.applyFilter(e,{operator:t,value:s})};n.filterDurationEquals={text:"L{equals}",localeClass:i,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:i.disabled,onItem:()=>o("=")},n.filterDurationLess={text:"L{lessThan}",localeClass:i,icon:"b-fw-icon b-icon-filter-less",weight:310,disabled:i.disabled,onItem:()=>o("<")},n.filterDurationMore={text:"L{moreThan}",localeClass:i,icon:"b-fw-icon b-icon-filter-more",weight:320,disabled:i.disabled,onItem:()=>o(">")}}}populateCellMenuWithStringItems({column:e,record:t,items:n}){const r=this.getFilterType(e);if(!/(date|number|duration)/.test(r)){var i,s;const r=this,o=e.getFilterableValue(t),a=null!==(i=null===(s=e.filterable.filterField)||void 0===s?void 0:s.operator)&&void 0!==i?i:"*";n.filterStringEquals={text:"L{equals}",localeClass:r,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:r.disabled,onItem:()=>r.applyFilter(e,{value:o,operator:a})}}}populateCellMenu({column:e,record:t,items:n}){const r=this;!1!==e.filterable&&(r.populateCellMenuWithDateItems(...arguments),r.populateCellMenuWithNumberItems(...arguments),r.populateCellMenuWithDurationItems(...arguments),r.populateCellMenuWithStringItems(...arguments),e.meta.isFiltered&&(n.filterRemove={text:"L{removeFilter}",localeClass:r,icon:"b-fw-icon b-icon-remove",cls:"b-separator",weight:400,disabled:r.disabled||r.isMulti&&!r.columnHasRemovableFilters(e),onItem:()=>r.removeFilter(e)}),r.isMulti&&(n.filterDisable={text:"L{disableFilter}",localeClass:r,icon:"b-fw-icon b-icon-filter-disable",cls:"b-separator",weight:400,disabled:r.disabled||!r.columnHasEnabledFilters(e),onItem:()=>r.disableFilter(e)}))}columnHasRemovableFilters(e){const t=this;return Boolean(t.getCurrentMultiFilters(e).find((e=>!t.canDeleteFilter||!1!==t.callback(t.canDeleteFilter,t,[e]))))}columnHasEnabledFilters(e){return Boolean(this.getCurrentMultiFilters(e).find((e=>!e.disabled)))}populateHeaderMenu({column:e,items:t}){const n=this;e.meta.isFiltered?(t.editFilter={text:"L{editFilter}",localeClass:n,weight:100,icon:"b-fw-icon b-icon-filter",cls:"b-separator",disabled:n.disabled,onItem:()=>n.showFilterEditor(e)},t.removeFilter={text:"L{removeFilter}",localeClass:n,weight:110,icon:"b-fw-icon b-icon-remove",disabled:n.disabled||n.isMulti&&!n.columnHasRemovableFilters(e),onItem:()=>n.removeFilter(e)},n.isMulti&&(t.disableFilter={text:"L{disableFilter}",localeClass:n,icon:"b-fw-icon b-icon-filter-disable",weight:115,disabled:n.disabled||!n.columnHasEnabledFilters(e),onItem:()=>n.disableFilter(e)})):!1!==e.filterable&&(t.filter={text:"L{filter}",localeClass:n,weight:100,icon:"b-fw-icon b-icon-filter",cls:"b-separator",disabled:n.disabled,onItem:()=>n.showFilterEditor(e)})}onStoreBeforeFilter({filters:e}){const{columns:t}=this.client;for(let r=0;r<e.count;r++){const i=e.getAt(r);if(!i.internal){var n;const s=(i.columnOwned||this.prioritizeColumns)&&t.find((e=>!1!==e.filterable&&e.field===i.property));null!=s&&null!==(n=s.filterable)&&void 0!==n&&n.filterFn&&(s.$filter||(s.$filter=new Wi({columnOwned:!0,property:i.property,operator:i.operator,value:i.value,filterBy(e){return s.filterable.filterFn({value:this.value,record:e,operator:this.operator,property:this.property,column:s})}})),s.$filter.value=i.value,s.$filter.displayValue=i.displayValue,s.$filter.operator=i.operator,e.splice(r,1,s.$filter))}}}onStoreFilter(){this.refreshHeaders(!1)}renderHeader(){this.refreshHeaders(!1)}onElementClick({target:e}){if(this.filterEditorPopup&&this.closeFilterEditor(),e.classList.contains("b-filter-icon")){const t=e.closest(".b-grid-header");return this.showFilterEditor(t.dataset.columnId),!1}}showFilterEditorByKey({target:e}){const t=e.matches(".b-grid-header")&&e;return t&&this.showFilterEditor(t.dataset.columnId),Boolean(t)}isActionAvailable(e,t,n){const r=n.target.closest(".b-grid-header"),i=r&&this.client.columns.find((e=>e.id===r.dataset.columnId));return Boolean(null==i?void 0:i.filterable)}}Og._$name="Filter",vg.registerFeature(Og);const Lg={"*":null,isIncludedIn:null,startsWith:null,endsWidth:null};class Pg extends Wr{static get $name(){return"FilterBar"}static get configurable(){return{prioritizeColumns:!1,keyStrokeFilterDelay:300,compactMode:!1,clearStoreFiltersOnHide:!0,keyMap:{ArrowUp:{handler:"disableGridNavigation",preventDefault:!1},ArrowRight:{handler:"disableGridNavigation",preventDefault:!1},ArrowDown:{handler:"disableGridNavigation",preventDefault:!1},ArrowLeft:{handler:"disableGridNavigation",preventDefault:!1},Enter:{handler:"disableGridNavigation",preventDefault:!1}}}}static get pluginConfig(){return{before:["renderContents"],chain:["afterColumnsChange","renderHeader","populateHeaderMenu","bindStore"]}}static get properties(){return{filterFieldCls:"b-filter-bar-field",filterFieldInputCls:"b-filter-bar-field-input",filterableColumnCls:"b-filter-bar-enabled",filterFieldInputSelector:".b-filter-bar-field-input",filterableColumnSelector:".b-filter-bar-enabled",filterParseRegExp:/^\s*([<>=*])?(.*)$/,storeTrackingSuspended:0}}construct(e,t){if(e.features.filter)throw new Error("Grid.feature.FilterBar feature may not be used together with Grid.feature.Filter, These features are mutually exclusive.");const n=this;n.grid=e,n.onColumnFilterFieldChange=n.onColumnFilterFieldChange.bind(n),super.construct(e,Array.isArray(t)?{filter:t}:t),n.bindStore(e.store),n.filter&&e.store.filter(n.filter),n.gridDetacher=e.on("beforeelementclick",n.onBeforeElementClick,n)}bindStore(e){this.detachListeners("store"),e.on({name:"store",beforeFilter:"onStoreBeforeFilter",filter:"onStoreFilter",thisObj:this})}doDestroy(){var e;this.destroyFilterBar(),null===(e=this.gridDetacher)||void 0===e||e.call(this),super.doDestroy()}doDisable(e){const{columns:t}=this.grid;null==t||t.forEach((t=>{const n=this.getColumnFilterField(t);n&&(n.disabled=e)})),super.doDisable(e)}updateCompactMode(e){this.client.headerContainer.classList[e?"add":"remove"]("b-filter-bar-compact");for(const t in this._columnFilters){const n=this._columnFilters[t];n.placeholder=e?n.column.headerText:null}}destroyFilterBar(){var e;null===(e=this.grid.columns)||void 0===e||e.forEach(this.destroyColumnFilterField,this)}hideFilterBar(){var e;const t=this;t.clearStoreFiltersOnHide&&t.suspendStoreTracking(),null===(e=t.grid.columns)||void 0===e||e.forEach((e=>t.hideColumnFilterField(e,!0))),t.grid.store.filter(),t.clearStoreFiltersOnHide&&t.resumeStoreTracking(),t.hidden=!0}showFilterBar(){this.suspendStoreTracking(),this.renderFilterBar(),this.resumeStoreTracking(),this.hidden=!1}toggleFilterBar(){this.hidden?this.showFilterBar():this.hideFilterBar()}renderFilterBar(){this.grid.hideHeaders||(this.grid.columns.visibleColumns.forEach((e=>this.renderColumnFilterField(e))),this.rendered=!0)}renderColumnFilterField(e){const t=this,{grid:n}=t,r=t.getColumnFilterable(e);if(r&&e.isVisible){const i=e.element,s=n.store.filters.get(e.id)||n.store.filters.getBy("property",e.field);let o=t.getColumnFilterField(e);if(o)t.onColumnFilterFieldChange({source:o,value:o.value}),o.render(i),o.show();else{const a=`${e.filterType||"text"}field`,{filterField:l}=r,c=null==l?void 0:l.cls;c&&delete r.filterField.cls,o=qc.append(sn.assign({type:a,cls:{[t.filterFieldCls]:1,[c]:c},dataset:{column:e.field},column:e,owner:n,clearable:!0,name:e.field,value:!s||s._filterBy||s.internal?"":t.buildFilterValue(s),inputCls:t.filterFieldInputCls,keyStrokeChangeDelay:t.keyStrokeFilterDelay,onChange:t.onColumnFilterFieldChange,onClear:t.onColumnFilterFieldChange,disabled:t.disabled,placeholder:t.compactMode?e.headerText:null,format:e.format},l),i)[0],o.element.retainElement=!0,t.setColumnFilterField(e,o);const d=(null==l?void 0:l.store)&&(l.store.readUrl||l.store.data);if(o.isCombo&&!d&&0===o.store.count){const t=o.value,r=()=>o.store.data=n.store.getDistinctValues(e.field,!0).map((t=>n.store.modelClass.new({id:t,[e.field]:t})));o.value=null,o.store.isSorted||o.store.sort({field:e.field,ascending:!0}),o.picker.on("beforeShow",r),r(),o.value=t}!t.filter&&o.value&&!1!==n.store.autoLoad&&t.onColumnFilterFieldChange({source:o,value:o.value})}i.classList.add(t.filterableColumnCls)}}updateColumnFilterFields(){const e=this,{columns:t,store:n}=e.grid;let r,i;e._updatingFields=!0;for(const s of t.visibleColumns)r=e.getColumnFilterField(s),r&&(i=n.filters.get(s.id)||n.filters.getBy("property",s.field),i&&!i.internal?i._filterBy?r.value=i.value:r.value=e.buildFilterValue(i):r.value="");e._updatingFields=!1}getColumnFilterable(e){if(!e.isRoot&&!1!==e.filterable&&e.field&&e.isLeaf)return"function"==typeof e.filterable&&(e.filterable={filterFn:e.filterable}),e.filterable}destroyColumnFilterField(e){const t=this.getColumnFilterField(e);t&&(this.hideColumnFilterField(e,!0),t.destroy(),this.setColumnFilterField(e,void 0))}hideColumnFilterField(e,t){const n=this,{store:r}=n.grid,i=e.element,s=n.getColumnFilterField(e);if(s){n.isDestroying||s.hide();const{$filter:o}=e;!r.isDestroyed&&n.clearStoreFiltersOnHide&&o&&r.removeFilter(o,t),null==i||i.classList.remove(n.filterableColumnCls)}}getColumnFilterField(e){var t;return null===(t=this._columnFilters)||void 0===t?void 0:t[e.id]}setColumnFilterField(e,t){this._columnFilters=this._columnFilters||{},this._columnFilters[e.data.id]=t}parseFilterValue(e,t,n){var r;if(Array.isArray(t))return{value:t};if(sn.isDate(t))return{operator:n.isDateField?"sameDay":n.isTimeField?"sameTime":"=",value:t};const i=String(t).match(this.filterParseRegExp);return{operator:i[1]||(null===(r=e.filterable)||void 0===r?void 0:r.operator)||"*",value:i[2]}}buildFilterValue({operator:e,value:t}){return t instanceof Date||Array.isArray(t)?t:(e in Lg?"":e)+t}onStoreBeforeFilter({filters:e}){const{columns:t}=this.client;for(let r=0;r<e.count;r++){var n;const i=e.getAt(r),s=(i.columnOwned||this.prioritizeColumns)&&t.find((e=>!1!==e.filterable&&e.field===i.property));null!=s&&null!==(n=s.filterable)&&void 0!==n&&n.filterFn&&(s.$filter||(s.$filter=new Wi({columnOwned:!0,property:i.property,id:s.id,filterBy(e){return s.filterable.filterFn({value:this.value,record:e,property:this.property,column:s})}})),s.$filter.value=i.value,e.splice(r,1,s.$filter))}}onStoreFilter(){!this.storeTrackingSuspended&&this.rendered&&this.updateColumnFilterFields()}afterColumnsChange({changes:e,column:t}){!this.hidden&&null!=e&&e.hidden&&(e.hidden.value?this.destroyColumnFilterField(t):this.renderColumnFilterField(t))}suspendStoreTracking(){this.storeTrackingSuspended++}resumeStoreTracking(){this.storeTrackingSuspended--}renderHeader(){this.hidden||this.renderFilterBar()}renderContents(){if(this._columnFilters)for(const e of Object.values(this._columnFilters))null==e||e.element.remove()}disableGridNavigation(e){return!!e.target.matches(this.filterFieldInputSelector)}onBeforeElementClick({event:e}){if(e.target.closest(`.${this.filterFieldCls}`))return!1}onColumnFilterFieldChange({source:e,value:t}){const n=this,{column:r}=e,{filterFn:i}=r.filterable,{store:s}=n.grid,o=r.$filter||s.filters.find((e=>(e.id===r.id||e.property===r.field)&&!e.internal));if(n._updatingFields)return;const a=null==t||""===t||Array.isArray(t)&&0===t.length;var l,c;if(s.removeFilter(o,!0),r.$filter=null,a){if(!o)return}else r.$filter=s.addFilter(f(f({property:e.name},n.parseFilterValue(r,t,e)),{},{["boolean"==typeof(null===(l=r.filterable)||void 0===l?void 0:l.caseSensitive)?"caseSensitive":void 0]:null===(c=r.filterable)||void 0===c?void 0:c.caseSensitive,[i?"filterBy":"_"]:function(e){return i({value:this.value,record:e,operator:this.operator,property:this.property,column:r})}}),!0);s.filter()}populateHeaderMenu({items:e}){e.toggleFilterBar={text:this.hidden?"L{enableFilterBar}":"L{disableFilterBar}",localeClass:this,weight:120,icon:"b-fw-icon b-icon-filter",cls:"b-separator",onItem:()=>this.toggleFilterBar()}}}Pg.featureClass="b-filter-bar",Pg._$name="FilterBar",vg.registerFeature(Pg);class $g extends Wr{static get $name(){return"Group"}static get configurable(){return{field:null,groupSortFn:null,renderer:null,keyMap:{" ":"toggleGroup"}}}construct(e,t){const n=this;e.features.tree||(n._thisIsAUsedExpression(e.features.groupSummary),t=n.processConfig(t),n.grid=e,super.construct(e,t),n.bindStore(e.store),e.rowManager.on({beforeRenderRow:"onBeforeRenderRow",renderCell:"renderCell",prio:1100,thisObj:n}))}processConfig(e){return"string"==typeof e?{field:e,ascending:null}:e}setConfig(e){null===e?this.store.clearGroupers():super.setConfig(this.processConfig(e))}bindStore(e){this.detachListeners("store"),e.on({name:"store",group:"onStoreGroup",thisObj:this})}updateRenderer(e){this.groupRenderer=e}updateField(e){this.store.group({field:e,ascending:this.ascending,fn:this.groupSortFn})}updateGroupSortFn(e){this.isConfiguring||this.store.group({field:this.field,ascending:this.ascending,fn:e})}doDestroy(){super.doDestroy()}doDisable(e){const{store:t}=this;if(e&&t.isGrouped){const{sorters:e}=t;e.unshift(...t.groupers),t.clearGroupers(),t.sort(e)}super.doDisable(e)}get store(){return this.grid.store}static get pluginConfig(){return{assign:["collapseAll","expandAll"],chain:["renderHeader","populateHeaderMenu","getColumnDragToolbarItems","onElementTouchStart","onElementClick","bindStore"]}}toggleCollapse(e,t){this.internalToggleCollapse(e,t)}internalToggleCollapse(e,t,n=!1){const{store:r,grid:i}=this,s=r.getById(e);s.isGroupHeader&&(t=void 0===t?!s.meta.collapsed:t,!1!==i.trigger("beforeToggleGroup",{groupRecord:s,collapse:t})&&(t?r.collapse(s):r.expand(s),n||i.rowManager.renderFromRecord(s),i.trigger("toggleGroup",{groupRecord:s,collapse:t}),i.afterToggleGroup()))}collapseAll(){const e=this;e.store.isGrouped&&!e.disabled&&(e.store.groupRecords.forEach((t=>e.internalToggleCollapse(t,!0,!0))),e.grid.refreshRows(!0))}expandAll(){const e=this;e.store.isGrouped&&!e.disabled&&(e.store.groupRecords.forEach((t=>e.internalToggleCollapse(t,!1,!0))),e.grid.refreshRows())}onBeforeRenderRow({row:e}){const t=e.grid.store.getById(e.id);e.forceInnerHTML=e.forceInnerHTML||(null==t?void 0:t.isGroupHeader)}renderCell(e){const t=this,{cellElement:n,row:r,column:i}=e,{meta:s}=e.record,o={"b-group-row":0,"b-grid-group-collapsed":0};if(!t.disabled&&t.store.isGrouped&&"groupRowFor"in s){if("action"===i.type)return;i.clearCell(n),o["b-grid-group-collapsed"]=s.collapsed,o["b-group-row"]=1,i===t.groupHeaderColumn&&(n.classList.add("b-group-title"),n.$groupHeader=!0),t.buildGroupHeader(e)}else n.$groupHeader&&(n.classList.remove("b-group-title"),n.$groupHeader=!1);r.assignCls(o)}buildGroupHeader(e){const t=this,{record:n,cellElement:r,column:i,persist:s}=e,{grid:o}=t,a=n.meta,{groupRowFor:l}=a,{groupSummary:c}=o.features,d=a.childCount-(c&&"header"!==c.target?1:0);let u=null,h=!0;if(s||i){const s=o.columns.get(a.groupField),c=e.isFirstColumn=i===t.groupHeaderColumn;null!=s&&s.groupRenderer?c&&(u=s.groupRenderer(f(f({},e),{},{groupRowFor:l,groupRecords:n.groupChildren,groupColumn:s,count:d})),h=!1):t.groupRenderer&&(u=t.groupRenderer(f(f({},e),{},{groupRowFor:l,groupRecords:n.groupChildren,groupColumn:s,count:d,isFirstColumn:c}))),c&&null==u&&h&&0===Mr.getChildElementCount(r)&&(u=_.encodeHtml(`${"__novalue__"===l?"":l} (${d})`))}else t.groupRenderer&&(u=t.groupRenderer(e));return"string"==typeof u?r.innerHTML=u:"object"==typeof u&&oa.sync({targetElement:r,domConfig:{onlyChildren:!0,children:ke.asArray(u)}}),Mr.getChildElementCount(r)>0&&(r._hasHtml=!0),r.innerHTML}get groupHeaderColumn(){return this.grid.columns.visibleColumns.find((e=>!e.groupHeaderReserved))}renderHeader(e){const{store:t,grid:n}=this;if(t.isGrouped)for(const e of t.groupers){const t=n.columns.get(e.field),r=t&&n.getHeaderElement(t.id);null==r||r.classList.add("b-group",e.ascending?"b-asc":"b-desc")}}populateHeaderMenu({column:e,items:t}){const n=this;!1!==e.groupable&&(t.groupAsc={text:"L{groupAscending}",localeClass:n,icon:"b-fw-icon b-icon-group-asc",cls:"b-separator",weight:400,disabled:n.disabled,onItem:()=>n.store.group(e.field,!0)},t.groupDesc={text:"L{groupDescending}",localeClass:n,icon:"b-fw-icon b-icon-group-desc",weight:410,disabled:n.disabled,onItem:()=>n.store.group(e.field,!1)}),n.store.isGrouped&&(t.groupRemove={text:"L{stopGrouping}",localeClass:n,icon:"b-fw-icon b-icon-clear",cls:e.groupable?"":"b-separator",weight:420,disabled:n.disabled,onItem:()=>n.store.clearGroupers()})}getColumnDragToolbarItems(e,t){var n;const r=this,{store:i,disabled:s}=r;t.push({text:"L{groupAscendingShort}",group:"L{group}",localeClass:r,icon:"b-icon b-icon-group-asc",ref:"groupAsc",cls:"b-separator",weight:110,disabled:s,onDrop:({column:e})=>i.group(e.field,!0)}),t.push({text:"L{groupDescendingShort}",group:"L{group}",localeClass:r,icon:"b-icon b-icon-group-desc",ref:"groupDesc",weight:110,disabled:s,onDrop:({column:e})=>i.group(e.field,!1)});const o=(null===(n=i.groupers)||void 0===n?void 0:n.some((t=>t.field===e.field)))&&!s;return t.push({text:"L{stopGroupingShort}",group:"L{group}",localeClass:r,icon:"b-icon b-icon-clear",ref:"groupRemove",disabled:!o,weight:110,onDrop:({column:e})=>i.removeGrouper(e.field)}),t}onStoreGroup({groupers:e}){const{grid:t}=this,{element:n}=t,r=n&&Mr.children(n,".b-grid-header.b-group");if(n){for(const e of r)e.classList.remove("b-group","b-asc","b-desc");if(e)for(const n of e){const e=t.getHeaderElementByField(n.field);e&&e.classList.add("b-group",n.ascending?"b-asc":"b-desc")}}}onElementTouchStart(e){const t=this,{target:n}=e,r=n.closest(".b-grid-header"),i=r&&t.grid.getColumnFromElement(r);e.touches.length>1&&i&&!1!==i.groupable&&!t.disabled&&t.store.group(i.field)}onElementClick(e){const t=this,{store:n}=t,{target:r}=e,i=r.closest(".b-group-row"),s=r.closest(".b-grid-header"),o=null==s?void 0:s.dataset.column;if(!(r.classList.contains("b-resizer")||t.disabled||r.classList.contains("b-action-item"))){if(s&&o){var a;const r=null===(a=n.groupers)||void 0===a?void 0:a.find((e=>e.field===o));if(r&&!e.shiftKey)return n.group(o,!r.ascending),!1;e.shiftKey&&!1!==t.grid.columns.get(o).groupable&&(e.altKey?n.removeGrouper(o):n.group(o))}return i?(t.internalToggleCollapse(Ps.get(i).id),!1):void 0}}toggleGroup(e){var t;const{grid:n}=this,{focusedCell:r}=n;return!(this.disabled||r.isActionable||null===(t=r.record)||void 0===t||!t.isGroupHeader||(this.internalToggleCollapse(r.id),0))}}$g._$name="Group",vg.registerFeature($g,!0,["Grid","Scheduler"]),vg.registerFeature($g,!1,["TreeGrid"]);var _g=e=>class extends(e||Te){static get $name(){return"SummaryFormatter"}generateHtml(e,t,n,r,i,s){const o=this.store,a=e.summaries||(e.sum?[{sum:e.sum,renderer:e.summaryRenderer}]:[]);let l=`<table class="${n}">`;return a.forEach((n=>{let r=n.sum,i=null;switch(!0===r&&(r="sum"),r){case"sum":case"add":i=o.sum(e.field,t);break;case"max":i=o.max(e.field,t);break;case"min":i=o.min(e.field,t);break;case"average":case"avg":i=o.average(e.field,t);break;case"count":i=t.length;break;case"countNotEmpty":i=t.reduce(((t,n)=>t+(null!=n[e.field]?1:0)),0)}if("function"==typeof r&&(i=t.reduce(r,"seed"in n?n.seed:0)),null!==i){const e="b-grid-summary-value",t=n.label?`<td class="b-grid-summary-label">${n.label}</td>`:"";let r,s=n.renderer?n.renderer({config:n,sum:i}):i;null==s&&(s=""),r=String(s).includes("<td>")?s:t?`${t}<td class="${e}">${s}</td>`:`<td colspan="2" class="${e}">${s}</td>`,l+=`<tr>${r}</tr>`}})),l+"</table>"}};class Ng extends(_g(Wr)){static get $name(){return"GroupSummary"}static get configurable(){return{collapseToHeader:null,target:"footer"}}construct(e,t){if(this.grid=e,super.construct(e,t),!e.features.group)throw new Error("Requires Group feature to work, please enable");this.bindStore(e.store),e.rowManager.on({beforeRenderRow:"onBeforeRenderRow",renderCell:"renderCell",prio:1e3,thisObj:this})}bindStore(e){this.detachListeners("store"),e.on({name:"store",update:"onStoreUpdate",prio:1,thisObj:this})}get store(){return this.grid.store}doDisable(e){this.updateTarget(this.target),super.doDisable(e)}changeTarget(e){return sn.assertString(e,"target"),e}updateTarget(e){this.store.useGroupFooters=!this.disabled&&"footer"===e,this.isConfiguring||this.store.group()}changeCollapseToHeader(e){return sn.assertBoolean(e,"collapseToHeader"),e}updateCollapseToHeader(){this.isConfiguring||this.store.group()}static get pluginConfig(){return{chain:["bindStore"]}}onBeforeRenderRow({row:e,record:t}){e.isGroupFooter&&!("groupFooterFor"in t.meta)?(e.isGroupFooter=!1,e.forceInnerHTML=!0):e.isGroupHeader&&!t.meta.collapsed&&e.eachElement(this.removeSummaryElements)}removeSummaryElements(e){}renderCell({column:e,cellElement:t,row:n,record:r,size:i,isFirstColumn:s}){const o=this,{meta:a}=r,{rowHeight:l}=o.grid,c="groupRowFor"in a,d="groupFooterFor"in a,u="header"===o.target,h={"b-group-footer":0,"b-header-summary":0},g=c&&(u||o.collapseToHeader&&a.collapsed)&&!s||d&&!u;if((c||d)&&(i.height=l),o.store.isGrouped&&g&&!o.disabled){e.clearCell(t);const s=c?r:a.groupRecord;n.isGroupFooter=d,n.isGroupHeader=c,d?h["b-group-footer"]=1:h["b-header-summary"]=1;const g=o.updateSummaryHtml(t,e,s),m="number"==typeof g?g:g.count;m>1&&(i.height+=a.collapsed&&!u?0:m*l*.1),g.height&&(i.height+=g.height)}n.assignCls(h)}updateSummaryHtml(e,t,n){const r=n.groupChildren.slice();r[r.length-1].isGroupFooter&&r.pop();const i=this.generateHtml(t,r,"b-grid-group-summary",n,n.meta.groupField,n.meta.groupRowFor);return e.children.length?Mr.sync(i,e.firstElementChild):e.innerHTML=i,t.summaries?t.summaries.length:t.sum?1:0}onStoreUpdate({source:e,changes:t}){if(!this.disabled&&e.isGrouped){if(t&&e.groupers.find((e=>e.field in t)))return;Object.keys(t).some((e=>{const t=this.grid.columns.get(e);return Boolean(t)&&(Boolean(t.sum)||Boolean(t.summaries))}))&&(this.grid.forceFullRefresh=!0)}}refresh(){this.grid.columns.visibleColumns.forEach((e=>{this.hasSummary(e)&&this.grid.refreshColumn(e)}))}hasSummary(e){return e.sum||e.summaries}}Ng.featureClass="b-group-summary",Ng._$name="GroupSummary",vg.registerFeature(Ng);class Hg extends _c{static get $name(){return"HeaderMenu"}static get configurable(){return{type:"header",items:null,moveColumns:null}}static get defaultConfig(){return{processItems:null}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateHeaderMenu"),e}shouldShowMenu(e){const{column:t}=e;return t&&!1!==t.enableHeaderContextMenu&&t!==this.client.timeAxisColumn}getDataFromEvent(e){return sn.assign(super.getDataFromEvent(e),this.client.getHeaderDataFromEvent(e))}populateHeaderMenu({items:e,column:t}){const n=this;if(t){if(t.headerMenuItems&&sn.merge(e,t.headerMenuItems),t.isCollapsible){const{collapsed:r}=t,i=r?n.client.rtl?"left":"right":n.client.rtl?"right":"left";e.toggleCollapse={weight:215,icon:`b-fw-icon b-icon-collapse-${i}`,text:n.L(r?"L{expandColumn}":"L{collapseColumn}"),onItem:()=>t.collapsed=!r}}if(n.moveColumns){const r=n.getColumnToMoveBefore(t),i=n.getColumnToMoveAfter(t);r&&(e.movePrev={weight:220,icon:"b-fw-icon b-icon-column-move-left",text:n.L("L{moveBefore}",_.encodeHtml(r.text)),onItem:()=>{const{parent:e}=t;var n;r.parent.insertChild(t,r)&&(t.region=r.region,null!==(n=e.children)&&void 0!==n&&n.length||e.remove())}}),i&&(e.moveNext={weight:230,icon:"b-fw-icon b-icon-column-move-right",text:n.L("L{moveAfter}",_.encodeHtml(i.text)),onItem:()=>{const{parent:e}=t;var n;i.parent.insertChild(t,i.nextSibling)&&(t.region=i.region,null!==(n=e.children)&&void 0!==n&&n.length||e.remove())}})}}return e}getColumnToMoveBefore(e){const{previousSibling:t,parent:n}=e;return t?t.children&&!e.children?t.children[t.children.length-1]:t:n.isRoot?void 0:n}getColumnToMoveAfter(e){const{nextSibling:t,parent:n}=e;return t||(n.isRoot?void 0:n)}}Hg.featureClass="",Hg._$name="HeaderMenu",vg.registerFeature(Hg,!0);const Bg={mousedown:"mouseDown",mousemove:"mouseMove",mouseup:"mouseUp",touchdown:"touchDown",touchmove:"touchMove",touchup:"touchUp",mouseover:"mouseOver",mouseout:"mouseOut",dblclick:"dblClick",keydown:"keyDown",keypress:"keyPress",keyup:"keyUp",contextmenu:"contextMenu"};class jg extends Wr{constructor(...e){super(...e),v(this,"mergedRanges",[]),v(this,"mergedMap",{})}static get pluginConfig(){return{chain:["beforeRenderCell","afterRenderRow","bindStore","afterColumnsChange","afterRemove","afterToggleGroup","afterToggleSubGrid","handleEvent","populateHeaderMenu","onSelectedRecordCollectionChange"],before:["onInternalResize"],override:["getColumnFromElement","getRecordFromElement"]}}afterConstruct(){const e=this,{client:t}=e;t.eachSubGrid((t=>e.setupSubGrid(t))),t.rowManager.on({renderDone:"onRenderDone",thisObj:e}),e.bindStore(t.store)}setupSubGrid(e){e.$mergedCellsElement=Mr.createElement({parent:e.element,className:{"b-grid-merged-cells-container":1}})}doDisable(e){this.isConfiguring||(this.isDisabling=!0,this.reset(),this.isDisabling=!1),super.doDisable(e)}updatePassthrough(e){this.client.element.classList.toggle("b-mergecells-passthrough",e)}bindStore(e){this.detachListeners("store"),e.on({name:"store",change:"onStoreChange",refresh:{prio:1,fn:"onStoreRefresh"},thisObj:this})}onInternalResize(){this.refreshBounds()}beforeRenderCell(e){const{column:t,record:n,cellElement:r}=e,i=this.client.subGrids[t.region];if(!this.disabled&&t.mergeCells&&t.isSorted&&!n.isSpecialRow&&!i.collapsed){const i=this.getMergeRange(n,t);null!=i&&i.use&&(r.classList.add("b-merged-cell"),r.innerHTML="",e.cellElement=i.cellElement)}}afterRenderRow({row:e,oldId:t,oldHeight:n}){t===e.id&&n!==e.height&&(this.heightChanged=!0)}afterColumnsChange({action:e,changes:t,column:n}){if(!this.disabled)if("update"!==e||!t.mergeCells||n.mergeCells)this.refreshBounds();else{for(const e of this.mergedRanges.slice())e.column===n&&this.removeRange(e);this.syncDom()}}afterRemove(){!this.disabled&&this.reset()}afterToggleGroup(){!this.disabled&&this.reset()}afterToggleSubGrid(){!this.disabled&&this.reset()}onSelectedRecordCollectionChange({source:e}){if(!this.passthrough){const t=e.values.map((e=>this.client.store.indexOf(e)));let n=!1;for(const e of this.mergedRanges){let r=!0;for(let n=e.fromIndex;n<=e.toIndex&&r;n++)r=t.includes(n);e.isSelected!==r&&(e.isSelected=r,n=!0)}n&&this.syncDom()}}getRecordFromElement(e){var t;return null!==(t=e.elementData)&&void 0!==t&&t.range?this.client.store.getAt(e.elementData.range.fromIndex):this.overridden.getRecordFromElement(e)}getColumnFromElement(e){var t;return null!==(t=e.elementData)&&void 0!==t&&t.range?e.elementData.range.column:this.overridden.getColumnFromElement(e)}populateHeaderMenu({column:e,items:t}){!1!==e.mergeable&&(t.mergeCells={text:"L{MergeCells.mergeCells}",icon:"b-fw-icon "+(e.mergeCells?"b-icon-checked":"b-icon-unchecked"),tooltip:"L{MergeCells.menuTooltip}",cls:"b-separator",weight:500,disabled:this.disabled,onItem:()=>e.mergeCells=!e.mergeCells})}async handleEvent(e){if(!this.passthrough){const n=e.target.closest(".b-grid-merged-cells");if(n){var t;const{client:r}=this,{range:i}=n.elementData,{cellEdit:s}=r.features,{column:o}=i,a=_.capitalize(null!==(t=Bg[e.type])&&void 0!==t?t:e.type),l={grid:r,records:[],column:o,cellElement:n.firstElementChild,target:e.target,event:e};for(let e=i.fromIndex;e<=i.toIndex;e++)l.records.push(r.store.getAt(e));if(r.trigger(`mergedCell${a}`,l),(null==s?void 0:s.triggerEvent.toLowerCase())===`cell${a}`.toLowerCase()){const t=r.rowManager.getRowAt(e.clientY);await s.startEditing({id:t.id,columnId:o.id})}else"click"===e.type&&this.onRangeClick({range:i})}}}onRangeClick({range:e}){const t=[];for(let n=e.fromIndex;n<=e.toIndex;n++)t.push(this.client.store.getAt(n));this.client.selectedRecords=t}onStoreChange(){!this.disabled&&this.reset()}onStoreRefresh({action:e}){"filter"!==e&&"dataset"!==e&&!this.disabled&&this.reset(!1)}createRangeElement(e){var t,n,r;const i=this.client.getSubGridFromColumn(e.column).$mergedCellsElement,s=`${e.fromIndex}-@-${e.column.id}`;let o=null!==(t=null===(n=i.syncIdMap)||void 0===n?void 0:n[s])&&void 0!==t?t:null===(r=i.releasedIdMap)||void 0===r?void 0:r[s];return i.releasedIdMap&&delete i.releasedIdMap[s],o||(o=Mr.createElement(this.createRangeDomConfig(e))),oa.addChild(i,o,s),e.element=o,e.cellElement=o.firstElementChild,o}createRangeDomConfig(e){var t;const{column:n,fromIndex:r,toIndex:i,top:s,left:o,width:a,height:l}=e,{type:c}=n,d=this.client.store.getAt(r),u={className:{"b-grid-merged-cells":1,"b-selected":e.isSelected},elementData:{range:e},style:{top:s,left:o,height:l,width:a},dataset:{syncId:`${r}-@-${n.id}`,fromIndex:r,toIndex:i,column:n.field,columnId:n.id},children:[{className:new Mn(this.client.cellCls).assign({[`b-${null==c?void 0:c.toLowerCase()}-cell`]:c,[n.cellCls]:n.cellCls,[n.internalCellCls]:n.internalCellCls}).assign(n.autoCls),keepChildren:!0,elementData:{range:e},dataset:{column:n.field,columnId:n.id},style:{height:this.client.rowManager.rowHeight}}]};return null===(t=n.mergedRenderer)||void 0===t||t.call(n,{domConfig:u,value:n.getRawValue(d),record:d,column:n,fromIndex:r,toIndex:i}),u}buildMergedCellsConfig(e,t,n){var r,i,s,o;const a=this,{client:l}=a,{rowManager:c}=l;e=null!==(r=e)&&void 0!==r?r:null===(i=c.topRow)||void 0===i?void 0:i.dataIndex,t=null!==(s=t)&&void 0!==s?s:null===(o=c.bottomRow)||void 0===o?void 0:o.dataIndex;const d=l.regions.reduce(((e,t)=>(e[t]={className:{"b-grid-merged-cells-container":1},children:[]},e)),{});for(const r of a.mergedRanges)r.use&&r.fromIndex<=t&&r.toIndex>=e&&(a.updateRange(r,a.heightChanged,n),d[r.column.region].children.push(a.createRangeDomConfig(r)));return d}syncDom(e=!1){const t=this,{client:n}=t,{rowManager:r}=n;if(!e&&!r.topRow||t.disabled&&!t.isDisabling)return;const i=this.buildMergedCellsConfig();n.eachSubGrid((e=>{oa.sync({targetElement:e.$mergedCellsElement,syncIdField:"syncId",domConfig:i[e.region]})})),t.heightChanged=!1}onRenderDone(){this.syncDom()}removeRange(e){ke.remove(this.mergedRanges,e);for(let t=e.fromIndex;t<=e.toIndex;t++)delete this.mergedMap[`${t}-@-${e.column.id}`]}reset(e=!0){const t=this,n=t.client.columns.visibleColumns.filter((e=>e.mergeCells&&e.isSorted),!0),r=t.mergedRanges.length;if(t.mergedRanges=[],t.mergedMap={},e&&!t.client.refreshSuspended){for(const e of t.client.rowManager.rows)for(const t of n)e.renderCell(e.getCell(t.id));t.syncDom(r&&!t.client.rowManager.rowCount)}}refreshBounds(){const{mergedRanges:e}=this,t=new Map;for(const n of e.slice()){const{column:e}=n,{element:r}=e;if(r){let i=t.get(e);i||t.set(e,i=xn.from(r,r.parentElement)),n.left=i.left,n.width=i.width}else this.removeRange(n)}this.syncDom()}updateRange(e,t,n=null){const{store:r,rowManager:i}=this.client,{topRendered:s,bottomRendered:o}=e,{rowOffsetHeight:a}=i;let l,c,{fromIndex:d,toIndex:u}=e;if(t||!s||!o){if(!s||t){if(n){const e=n.findIndex((e=>e.dataIndex>=d));l=n[e],d=l.dataIndex}else do{l=i.getRowById(r.getAt(d))}while(!l&&d++<u);e.topRendered=d===e.fromIndex;const t=d-e.fromIndex;e.top=l.top-t*(n?l.offsetHeight:a)}if(!o||t){if(n){const e=Math.max(n.findIndex((e=>e.dataIndex===u-1)),n.length-1);c=n[e],d=c.dataIndex}else do{c=i.getRowById(r.getAt(u))}while(!c&&u-- >d);e.bottomRendered=u===e.toIndex;const t=e.toIndex-u;e.bottom=c.bottom+t*(n?c.offsetHeight:a)}e.height=e.bottom-e.top}}getMergeRange(e,t){if(e.isSpecialRow)return;const n=this,{mergedMap:r}=n,{store:i}=n.client,s=t.id,o=i.indexOf(e),a=`${o}-@-${s}`;let l=r[a];if(!l){const c=t.getRawValue(e);l=r[a]={column:t},n.mergedRanges.push(l);let d,u,h=o;do{d=i.getAt(--h),u=d&&t.getRawValue(d),u===c&&(r[`${h}-@-${s}`]=l)}while(d&&u===c);let g,m,p=o;do{g=i.getAt(++p),m=g&&t.getRawValue(g),m===c&&(r[`${p}-@-${s}`]=l)}while(g&&m===c);if(l.fromIndex=h+1,l.toIndex=p-1,l.toIndex-l.fromIndex>0){const e=xn.from(t.element,t.element.parentElement);l.left=e.left,l.width=e.width,l.use=!0}}return!l.element&&l.use&&n.createRangeElement(l),l}}v(jg,"$name","MergeCells"),v(jg,"configurable",{passthrough:!0}),jg._$name="MergeCells",vg.registerFeature(jg);class Vg extends Wr{static get $name(){return"QuickFind"}static get pluginConfig(){return{chain:["onElementKeyPress","onCellNavigate"]}}static get properties(){return{hitCls:"b-quick-hit",hitCellCls:"b-quick-hit-cell",hitCellBadgeCls:"b-quick-hit-cell-badge",hitTextCls:"b-quick-hit-text"}}construct(e,t){super.construct(e,t),Object.assign(this,{grid:e,treeWalker:e.setupTreeWalker(e.element,Mr.NodeFilter.SHOW_TEXT,(()=>Mr.NodeFilter.FILTER_ACCEPT))})}isActionAvailable(){const{focusedCell:e}=this.grid;return!this.disabled&&(null==e?void 0:e.record)&&!e.isActionable&&this.find.length>0}doDisable(e){e&&this.clear(),super.doDisable(e)}get store(){return this.grid.store}showQuickFind(){const e=this,t=e.grid.getHeaderElement(e.columnId);if(t){if(!e.headerField){const[n,r,i]=Mr.createElement({tag:"div",className:"b-quick-hit-header",children:[{tag:"div",className:"b-quick-hit-field"},{tag:"div",className:"b-quick-hit-badge"}]},{returnAll:!0});"header"===e.mode?t.appendChild(n):(n.className+=" b-quick-hit-mode-grid",e.grid.element.appendChild(n)),e.headerField={header:n,field:r,badge:i,colHeader:t}}e.headerField.field.innerHTML=e.find,e.headerField.badge.innerHTML=e.found.length,t.classList.add("b-quick-find-header"),e.renderListenerInitialized||(e.grid.rowManager.on({rendercell:e.renderCell,thisObj:e}),e.renderListenerInitialized=!0)}}hideQuickFind(){const e=this,{grid:t,headerField:n}=e;for(const n of e.prevFound||e.found){const r=t.getRowById(n.id);if(r){r.forceInnerHTML=!0;const t=r.getCell(e.columnId);t._content=null,r.renderCell(t),r.forceInnerHTML=!1}}n&&(n.header.parentNode.removeChild(n.header),n.colHeader.classList.remove("b-quick-find-header"),e.headerField=null),e.renderListenerInitialized&&(t.rowManager.un({rendercell:e.renderCell},e),e.renderListenerInitialized=!1),t.trigger("hideQuickFind")}search(e,t=this.columnId){const n=this,{grid:r}=n,i=r.columns.getById(t)||r.columns.get(t),s=n.store.findByField(i.field,e,i.mergeCells&&i.isSorted);let o=1;Object.assign(n,{foundMap:{},prevFound:n.found,found:s,find:e,columnId:i.id,findRe:new RegExp(`(\\s+)?(${_.escapeRegExp(String(e))})(\\s+)?`,"ig")}),e?n.showQuickFind():n.hideQuickFind();for(const e of Mr.children(r.element,`.${n.hitCls}`))e.classList.remove(n.hitCls,n.hitCellCls),e._originalContent&&(e.innerHTML=e._originalContent,e._originalContent=null);if(s){s.length>0&&n.gotoClosestHit(r.focusedCell,s);for(const e of s){n.foundMap[e.id]=o++;const t=r.getRowById(e.data.id);if(null==t||t.renderCell(t.getCell(i.id)),o>1e3)break}r.trigger("quickFind",{find:e,found:s})}}clear(){var e;(this.find||null!==(e=this.found)&&void 0!==e&&e.length)&&this.search("")}get foundCount(){var e,t;return null!==(e=null===(t=this.found)||void 0===t?void 0:t.length)&&void 0!==e?e:0}gotoHit(e){const t=this.found[e];return t&&this.grid.focusCell({columnId:this.columnId,id:t.id},{doSelect:!0}),!!t}gotoClosestHit(e,t){const n=e?this.grid.store.indexOf(e.id):0,r=t.slice().sort(((e,t)=>Math.abs(e.index-n)-Math.abs(t.index-n)));this.gotoHit(t.indexOf(r[0]))}gotoFirstHit(){this.gotoHit(0)}gotoLastHit(){this.gotoHit(this.found.length-1)}gotoNextHit(){var e,t,n;const r=this,{grid:i}=r,s=null!==(e=null===(t=i._focusedCell)||void 0===t?void 0:t.id)&&void 0!==e?e:null===(n=i.lastFocusedCell)||void 0===n?void 0:n.id,o=i.store.indexOf(s)||0,a=r.found.find((e=>e.index>o));a?i.focusCell({columnId:r.columnId,id:a.id},{doSelect:!0}):r.gotoFirstHit()}gotoPrevHit(){var e,t,n;const r=this,{grid:i,found:s}=r,o=null!==(e=null===(t=i._focusedCell)||void 0===t?void 0:t.id)&&void 0!==e?e:null===(n=i.lastFocusedCell)||void 0===n?void 0:n.id,a=i.store.indexOf(o)||0;let l;if(s.length){for(let e=s.length-1;e--;e>=0)if(s[e].index<a){l=s[e];break}l?i.focusCell({columnId:r.columnId,id:l.id},{doSelect:!0}):r.gotoLastHit()}}renderCell({cellElement:e,column:t,record:n}){var r;const i=this,{classList:s}=e,{treeWalker:o,findRe:a,hitTextCls:l}=i,c=i.columnId===t.id&&(null===(r=i.foundMap)||void 0===r?void 0:r[n.id]);if(c){s.add(i.hitCls),e.isQuickHit=!0,e._originalContent=e.innerHTML;const t=o.currentNode=Mr.down(e,".b-grid-cell-value,.b-tree-cell-value")||e;for(let e=o.nextNode();e&&t.contains(e);){const t=e,n=e.nodeValue,r=["<span>"];e=o.nextNode();let i=a.lastIndex;for(let e=a.exec(n);e;e=a.exec(n)){const t=n.substring(i,e.index),s=e[1]?" ":"",o=e[2],c=e[3]?" ":"";r.push(`${_.encodeHtml(t)}${s}<span class="${l}">${o}</span>${c}`),i=a.lastIndex}r.push(_.encodeHtml(n.substring(i)),"</span>"),t.parentNode.insertBefore(Mr.createElementFromTemplate(r.join(""),{fragment:!0}),t),t.remove()}Mr.createElement({parent:e,className:i.hitCellBadgeCls,text:c})}}onBackspace(e){const t=this;return!!t.find&&(t.find=t.find.substr(0,t.find.length-1),t.search(t.find),!0)}clearSearch(){return!!this.find&&(this.find="",this.search(this.find),!0)}showFilterEditor(){const e=this,{filter:t}=e.client.features;t&&e.columnId&&e.foundCount&&(e.clear(),t.showFilterEditor(e.client.columns.getById(e.columnId),e.find))}onElementKeyPress(e){var t;const n=this,{grid:r}=n,{focusedCell:i}=r;if(!e.handled&&!n.disabled&&null!=i&&i.record&&!i.isActionable&&1===(null===(t=e.key)||void 0===t?void 0:t.length)){const t=r.columns.getById(r._focusedCell.columnId);t&&!1!==t.searchable&&(n.columnId=r._focusedCell.columnId,n.find+=e.key,n.search(n.find))}}onCellNavigate(e,t,n){const r=this;!r.find||n&&n.columnId===r.columnId||r.clear()}}v(Vg,"configurable",{mode:"header",find:"",keyMap:{F3:"gotoNextHit","Shift+F3":"gotoPrevHit","Ctrl+g":"gotoNextHit","Ctrl+Shift+g":"gotoPrevHit","Ctrl+Shift+f":"showFilterEditor",Escape:"clearSearch",Backspace:"onBackspace"}}),Vg._$name="QuickFind",vg.registerFeature(Vg);class zg extends Wr{static get pluginConfig(){return{chain:["onElementPointerDown","onElementDblClick","onElementTouchMove","onSubGridCollapse","onSubGridExpand","render"]}}onElementDblClick(e){const t=this,{client:n}=t,r=e.target.closest(".b-grid-splitter-collapsed");if(r&&!t.expanding){t.expanding=!0;let e=r.dataset.region,i=n.getSubGrid(e);i.collapsed||(e=n.getLastRegions()[1],i=n.getSubGrid(e)),i.expand().then((()=>t.expanding=!1))}}startMove(e,t){const n=this,{client:r}=n,i=e.dataset.region,s=r.element,o=r.regions[r.regions.indexOf(i)+1],a=r.getSubGrid(o),l=r.getSubGrid(i);let c=l,d=1;if(null!=c.flex&&null==a.flex&&(c=a,d=-1),r.rtl&&(d*=-1),e.classList.contains("b-grid-splitter-collapsed"))return;const u=c.element.offsetWidth+a.element.offsetWidth;n.dragContext={element:e,headerEl:c.header.element,subGridEl:c.element,subGrid:c,splitterSubGrid:l,originalWidth:c.element.offsetWidth,originalX:t,minWidth:c.minWidth||0,maxWidth:Math.min(u,c.maxWidth||u),flip:d},s.classList.add("b-moving-splitter"),l.toggleSplitterCls("b-moving"),n.pointerDetacher=_n.on({element:document,pointermove:"onPointerMove",pointerup:"onPointerUp",thisObj:n})}endMove(){const e=this,{dragContext:t}=e;t&&(e.pointerDetacher(),e.client.element.classList.remove("b-moving-splitter"),t.splitterSubGrid.toggleSplitterCls("b-moving",!1),e.dragContext=null)}onCollapseClick(e,t){const{client:n}=this,r=t.dataset.region,i=n.getLastRegions();if(i[0]===r){const e=n.getSubGrid(i[1]);if(e.collapsed)return void e.expand()}e.collapse()}onExpandClick(e,t){const{client:n}=this,r=t.dataset.region,i=n.getLastRegions();i[0]!==r||e.collapsed?e.expand():n.getSubGrid(i[1]).collapse()}updateMove(e){const{dragContext:t}=this;if(t){const n=e-t.originalX,r=Math.max(Math.min(t.maxWidth,t.originalWidth+n*t.flip),0);t.subGrid.width=Math.max(r,t.minWidth)}}onElementPointerDown(e){const t=this,{target:n}=e,r=0===e.button&&n.closest(":not(.b-row-reordering):not(.b-dragging-event):not(.b-dragging-task):not(.b-dragging-header):not(.b-dragselecting) .b-grid-splitter"),i=r&&t.client.getSubGrid(r.dataset.region);let s;r&&(n.closest(".b-grid-splitter-button-collapse")?t.onCollapseClick(i,r):n.closest(".b-grid-splitter-button-expand")?t.onExpandClick(i,r):(t.startMove(r,e.clientX),s=r)),"touch"===e.pointerType&&t.toggleTouchSplitter(s)}onPointerMove(e){this.dragContext&&(this.updateMove(e.clientX),e.preventDefault())}onElementTouchMove(e){this.dragContext&&e.preventDefault()}onPointerUp(e){this.dragContext&&(this.endMove(),e.preventDefault())}onSubGridCollapse({subGrid:e}){const t=this.client.resolveSplitter(e);this.client.getLastRegions()[1]===e.region&&t.classList.add("b-grid-splitter-allow-collapse")}onSubGridExpand({subGrid:e}){this.client.resolveSplitter(e).classList.remove("b-grid-splitter-allow-collapse")}toggleTouchSplitter(e){const t=this,{touchedSplitter:n}=t;e&&n&&e.dataset.region!==n.dataset.region&&t.toggleTouchSplitter();const r=t.client.getSubGrid(e?e.dataset.region:null==n?void 0:n.dataset.region);r&&(r.toggleSplitterCls("b-touching",Boolean(e)),e?r.startSplitterButtonSyncing():r.stopSplitterButtonSyncing()),t.touchedSplitter=e}render(){const{regions:e,subGrids:t}=this.client;e.length>2&&(t[e[0]].splitterElement.classList.add("b-left-only"),t[e[1]].splitterElement.classList.add("b-right-only"))}}v(zg,"$name","RegionResize"),zg.featureClass="b-split",zg._$name="RegionResize",vg.registerFeature(zg);class Wg extends Wr{static get $name(){return"RowCopyPaste"}static get type(){return"rowCopyPaste"}static get pluginConfig(){return{assign:["copyRows","pasteRows"],chain:["populateCellMenu"]}}static get properties(){return{clipboardRecords:[]}}static get configurable(){return{nameField:"name",keyMap:{"Ctrl+C":"copy","Ctrl+X":"cut","Ctrl+V":"paste"},copyRecordText:"L{copyRecord}",cutRecordText:"L{cutRecord}",pasteRecordText:"L{pasteRecord}",localizableProperties:["copyRecordText","cutRecordText","pasteRecordText"]}}construct(e,t){super.construct(e,t),e.rowManager.on({beforeRenderRow:"onBeforeRenderRow",thisObj:this}),this.grid=e}onBeforeRenderRow({row:e,record:t}){e.cls["b-cut-row"]=this._isCut&&this.clipboardRecords.includes(t)}isActionAvailable(e,t,n){const{cellEdit:r}=this.grid.features,{target:i}=n;return!this.disabled&&0===globalThis.getSelection().toString().length&&(!r||!r.isEditing)&&(!i||Boolean(i.closest(".b-gridbase:not(.b-schedulerbase) .b-grid-subgrid,.b-grid-subgrid:not(.b-timeaxissubgrid)")))}copy(){this.copyRows()}cut(){this.copyRows(!0)}paste(){this.pasteRows()}copyRows(e=!1){const t=this,{client:n}=t,r=n.selectedRecords.filter((t=>!t.readOnly||!e));r.length&&!n.readOnly&&!1!==n.trigger("beforeCopy",{records:r,isCut:e})&&(t._isCut=e,t.clipboardRecords.forEach((e=>{var t;return null===(t=n.rowManager.getRowById(e))||void 0===t?void 0:t.removeCls("b-cut-row")})),t.clipboardRecords=n.selectedRecords.slice(),n.store.forEach((e=>{e.meta.isCut=t._isCut&&t.clipboardRecords.includes(e)})),n.selectedRecords.forEach((t=>this.onRowCutOrCopy(t,e))),n.trigger("copy",{records:r,isCut:e}))}onRowCutOrCopy(e,t){var n;null===(n=this.client.rowManager.getRowById(e))||void 0===n||n.toggleCls("b-cut-row",t)}pasteRows(e){const t=this,n=t.clipboardRecords,{client:r}=t,i=e||r.selectedRecord;if(r.readOnly||r.isTreeGrouped||!n.length||!1===r.trigger("beforePaste",{records:n,referenceRecord:i,isCut:t._isCut}))return[];t.sortByIndex(n);const s=n.map((e=>(t._isCut?e.meta.isCut=!1:(e=e.copy())[t.nameField]=t.generateNewName(e),e)));return t._isCut?(r.store.move(s,i),t.clearClipboard()):(t.insertCopiedRecords(i,s),r.selectedRecords=s),r.trigger("paste",{records:n,referenceRecord:i,isCut:t._isCut}),s}clearClipboard(){this._isCut&&this.clipboardRecords.forEach((e=>{var t;return null===(t=this.client.rowManager.getRowById(e))||void 0===t?void 0:t.removeCls("b-cut-row")})),this._isCut=!1,this.clipboardRecords=[]}generateNewName(e){const t=e[this.nameField];let n=2;for(;this.client.store.findRecord(this.nameField,`${t} - ${n}`);)n++;return`${t} - ${n}`}insertCopiedRecords(e,t){const{store:n}=this.client;if(n.tree)return e.parent.insertChild(t,e.nextSibling);{const r=n.indexOf(e);return n.insert(r+1,t)}}populateCellMenu({record:e,items:t}){const n=this;n.client.readOnly||n.client.isTreeGrouped||!e||e.isSpecialRow||(t.cut={text:n.cutRecordText,localeClass:n,cls:"b-separator",icon:"b-icon b-icon-cut",weight:110,disabled:e.readOnly,onItem:()=>n.copyRows(!0)},t.copy={text:n.copyRecordText,localeClass:n,icon:"b-icon b-icon-copy",weight:120,onItem:()=>n.copyRows()},n.clipboardRecords.length&&(t.paste={text:n.pasteRecordText,localeClass:n,icon:"b-icon b-icon-paste",weight:130,onItem:()=>n.pasteRows(e)}))}sortByIndex(e){return e.sort(((e,t)=>{const n=e.indexPath,r=t.indexPath;for(let e=0;e<=n.length;e++){if(n[e]<r[e])return-1;if(n[e]>r[e])return 1}}))}}Wg.featureClass="b-row-copypaste",Wg._$name="RowCopyPaste",vg.registerFeature(Wg,!0,"Grid"),vg.registerFeature(Wg,!1,"Gantt"),vg.registerFeature(Wg,!1,"SchedulerPro"),vg.registerFeature(Wg,!1,"ResourceHistogram");const Ug={remove:1,filter:1,dataset:1,replace:1};class Yg extends Wr{static get properties(){return{expanderBodyClass:"b-rowexpander-body",expandedRowClass:"b-rowexpander-row-expanded",recordStateMap:new Map,collapsingRecords:new Set}}static get pluginConfig(){return{chain:["afterColumnsChange","beforeRenderRow","processRowHeight","bindStore"],override:["onGridBodyFocusIn"]}}afterConstruct(){const e=this,{client:t}=e;e.renderer?(t.isGanttBase&&!1!==t.fixedRowHeight&&console.warn("When using RowExpander on a Gantt, the Gantt`s fixedRowHeight config must be set to false."),e.bindStore(t.store),e.triggerEvent&&t.on(e.triggerEvent,e.onTriggerEvent,e),e.addColumn()):console.warn("RowExpander requires implementing the renderer function.")}bindStore(e){const t=this;t.recordStateMap.clear(),t.collapsingRecords.clear(),t.detachListeners("clientStoreChange"),e.on({name:"clientStoreChange",change:t.onStoreChange,thisObj:t})}doDisable(e){const{client:t}=this;e&&(this.recordStateMap.clear(),this.collapsingRecords.clear()),t.isConfiguring||t.rowManager.renderFromRow(),super.doDisable(e)}changeLoadingIndicatorText(e){return e?this.L(e):e}onGridBodyFocusIn(e){var t,n;null!==(t=this.client.lastMousedownEvent)&&void 0!==t&&null!==(n=t.target)&&void 0!==n&&n.closest(".b-rowexpander-body")||this.overridden.onGridBodyFocusIn(e)}get isAnimating(){return this.client.isAnimating}set isAnimating(e){const{client:t}=this,n=t.isAnimating;t.isAnimating=e,t.isAnimating!==n&&t.element.classList.toggle("b-rowexpander-animating")}afterColumnsChange(){this.addColumn()}changeColumn(e){return null==e?e:f(f({type:"action",actions:[{cls:"b-icon b-icon-collapse-down",tooltip:"Expand",onClick:({record:e})=>this.toggleExpand(e)}],width:40,hideable:!1,align:"center",region:this.client.regions[0]},e),{},{field:"expanderActionColumn"})}addColumn(){const e=this,{column:t}=e,{columns:n}=e.client;e._isAddingExpanderColumn||!t||e._expander&&n.includes(e._expander)||(e._isAddingExpanderColumn=!0,"last"===e.columnPosition?[e._expander]=n.add(t):[e._expander]=n.insert(0,t),e._isAddingExpanderColumn=!1)}onTriggerEvent({target:e}){this.disabled||null!=e&&e.closest(".b-action-cell")||!e.closest(".b-grid-cell")||this.toggleExpand(this.client.getRecordFromElement(e))}toggleExpand(e){e&&(this.recordStateMap.has(e)?this.collapse(e):this.expand(e))}onStoreChange({action:e,source:t,records:n}){const r=this,{recordStateMap:i,collapsingRecords:s}=r;if(!r.disabled)if("removeAll"===e)i.clear(),s.clear();else if(Ug[e])for(const[e]of i)t.includes(e)||(i.delete(e),s.delete(e));else if(r.refreshOnRecordChange&&null!=n&&n.length)if("update"===e){const e=i.get(n[0]);null!=e&&e.isCreated&&(e.isCreated=!1,r.client.rowManager.renderFromRecord(n[0]))}else if("updatemultiple"===e){let e,s;for(const r of n){const n=i.get(r);if(null!=n&&n.isCreated){n.isCreated=!1;const i=t.records.indexOf(r);(!s||e>i)&&(e=i,s=r)}}s&&r.client.rowManager.renderFromRecord(s)}}processRowHeight(e,t){var n;const r=this.recordStateMap.get(e);if(r){if(!r.isCreated&&r.isRenderingAsync)return this.loadingIndicatorHeight+t;if(!r.expanderBodyHeight)for(const e of this.client.regions){const t=r.expandElements[e].offsetHeight;t>r.expanderBodyHeight&&(r.expanderBodyHeight=t)}}return(null!==(n=null==r?void 0:r.expanderBodyHeight)&&void 0!==n?n:0)+t}beforeRenderRow({row:e,record:t}){const n=this,{regions:r}=n.client,{expandedRowClass:i}=n;e.cls.toggle("b-rowexpander-disabled",n.disabled),e.cls[i]?n.enableAnimations&&n.isAnimating&&n.collapsingRecords.has(t)?n.waitForTransition(e,(()=>{n.collapsingRecords.has(t)&&n.removeExpander(e)})):n.removeExpander(e):n.collapsingRecords.delete(t);const s=n.recordStateMap.get(t);if(!n.disabled&&s){s.isCreated||n.renderExpander(t,e,s),e.cls.add(i);for(const t of r){const r=e.getElement(t);s.isCreated?r.appendChild(s.expandElements[t]):n.renderLoadingIndicator(r,s),n.lockCellHeight(r,s.cellHeight,!1)}n._shouldScrollIntoView&&(n._shouldScrollIntoView=!1,Mr.isInView(s.expandElements[r[0]],!0)||n.client.rowManager.on({once:!0,thisObj:n,renderDone:()=>n.scrollRowIntoView(e,t)}))}}scrollRowIntoView(e,t){this.isAnimating?this.waitForTransition(e,(()=>this.client.scrollRowIntoView(t))):this.client.scrollRowIntoView(t)}waitForTransition(e,t){_n.onTransitionEnd({element:e.element,property:"height",handler:t,thisObj:this})}removeExpander(e){e.cls.remove(this.expandedRowClass);for(const t of this.client.regions){const n=e.getElement(t);n.classList.remove(this.expandedRowClass),Mr.removeEachSelector(n,"."+this.expanderBodyClass),this.lockCellHeight(n,null,!1)}}renderLoadingIndicator(e,t){Mr.createElement({parent:e,className:this.expanderBodyClass+" b-rowexpander-loading",style:{top:t.cellHeight,height:this.loadingIndicatorHeight},children:[{tag:"i",className:"b-icon b-icon-spinner"},this.loadingIndicatorText]})}renderExpander(e,t,n){var r;const i=this,s=null===(r=t.cells[0])||void 0===r?void 0:r.offsetHeight,o={},a=[],l=(e,t,n)=>{null!=e&&("string"==typeof e?t.innerHTML=e:(e=Mr.createElement(e),t.appendChild(e))),o[n]=t};if(!n.isRenderingAsync){Object.assign(n,{cellHeight:s,expandElements:o,expanderBodyHeight:0});for(const n of i.client.regions){const r=t.getElement(n);t.addCls(i.expandedRowClass);const o=Mr.createElement({parent:r,className:i.expanderBodyClass,style:{top:s+"px"}}),c=i.renderer({record:e,expanderElement:o,rowElement:r,region:n});Y.isPromise(c)?a.push(c.then((e=>l(e,o,n)))):l(c,o,n)}a.length?(n.isRenderingAsync=!0,Promise.all(a).then((t=>{n.isCreated=!0,i.renderRowsWithAnimation(e),n.isRenderingAsync=!1}))):n.isCreated=!0}}renderRowsWithAnimation(e){const t=this;if(t.enableAnimations){const n=t.client.rowManager.getRowById(e);n&&(t.isAnimating=!0,t.collapsingRecords.has(e)&&n.addCls("b-row-is-collapsing"),t.waitForTransition(n,(()=>{t.isAnimating=!1,n.removeCls("b-row-is-collapsing")})))}t.client.rowManager.renderFromRecord(e)}lockCellHeight(e,t,n){for(let r=0;r<e.children.length;r++){const i=e.children[r];i.classList.contains(this.expanderBodyClass)||(i.style.height=n?"":t+"px")}}async expand(e){const t=this;t.disabled||!1!==await t.trigger("beforeExpand",{record:e})&&(t.recordStateMap.set(e,{isCreated:!1}),t.collapsingRecords.delete(e),t._shouldScrollIntoView=!0,t.renderRowsWithAnimation(e))}async collapse(e){const t=this;t.disabled||!1!==await t.trigger("beforeCollapse",{record:e})&&(t.recordStateMap.delete(e),t.collapsingRecords.add(e),t.renderRowsWithAnimation(e))}}v(Yg,"$name","RowExpander"),v(Yg,"configurable",{renderer:null,triggerEvent:null,column:{},columnPosition:"first",refreshOnRecordChange:!1,loadingIndicatorHeight:100,loadingIndicatorText:"L{loading}",enableAnimations:!0}),Yg._$name="RowExpander",vg.registerFeature(Yg);class Gg extends(Zr(Wr)){construct(e,t){this.grid=e,super.construct(...arguments)}doDestroy(){var e;null===(e=this.dragHelper)||void 0===e||e.destroy(),super.doDestroy()}init(){const e=this,{grid:t}=e;e.dragHelper=new jc({name:"rowReorder",cloneTarget:!0,dragThreshold:10,targetSelector:".b-grid-row",lockX:!0,scrollManager:t.scrollManager,dragWithin:t.element,outerElement:e.targetSubGridElement,touchStartDelay:e.touchStartDelay,isElementDraggable:e=>!e.closest(".b-grid-cell .b-widget"),monitoringConfig:{scrollables:[{element:t.scrollable.element,direction:"vertical"}]},ignoreSamePositionDrop:!1,createProxy(e){const n=e.cloneNode(!0),r=document.createElement("div");if(r.classList.add("b-row-reorder-proxy"),n.removeAttribute("id"),n.style.transform="",r.appendChild(n),t.selectedRecords.length>1){const e=n.cloneNode(!0);e.classList.add("b-row-dragging-multiple"),r.appendChild(e)}return Mr.removeClsGlobally(r,"b-selected","b-hover","b-focused"),r},listeners:{beforedragstart:"onBeforeDragStart",dragstart:"onDragStart",drag:"onDrag",drop:"onDrop",reset:"onReset",prio:1e4,thisObj:e}}),e.relayEvents(e.dragHelper,["beforeDragStart","dragStart","drag","abort"],"gridRow"),e.dropIndicator=Mr.createElement({className:"b-row-drop-indicator"}),e.dropOverTargetCls=["b-row-reordering-target","b-hover"]}static get pluginConfig(){return{after:["onPaint"]}}get targetSubGridElement(){const e=this.grid.regions[0];return this.grid.subGrids[e].element}onBeforeDragStart({event:e,source:t,context:n}){const r=this,{grid:i}=r,s=r.targetSubGridElement;if(r.disabled||i.readOnly||i.isTreeGrouped||!s.contains(n.element))return!1;if(n.startRecord=i.getRecordFromElement(n.element),n.startRecord.readOnly)return!1;n.originalRowTop=i.rowManager.getRowFor(n.startRecord).top,"touch"===t.startEvent.pointerType?i.isSelected(n.startRecord)||i.selectRow({record:n.startRecord,addToSelection:!1}):i.isSelected(n.startRecord)||e.shiftKey||e.ctrlKey||i.selectRow({record:n.startRecord});const o=n.records=i.selectedRecords.filter((e=>!e.readOnly)).slice().sort(((e,t)=>i.store.indexOf(e)-i.store.indexOf(t)));return o.length>0&&!o.some((e=>e.isSpecialRow))}onDragStart({context:e}){var t,n;const r=this,{grid:i}=r,{cellEdit:s,cellMenu:o,headerMenu:a}=i.features;s&&(r.cellEditDisabledState=s.disabled,s.disabled=!0),null==o||null===(t=o.hideContextMenu)||void 0===t||t.call(o,!1),null==a||null===(n=a.hideContextMenu)||void 0===n||n.call(a,!1),i.element.classList.add("b-row-reordering");const l=e.element.querySelector(".b-focused");null==l||l.classList.remove("b-focused"),e.element.firstElementChild.classList.remove("b-selected","b-hover"),i.bodyContainer.appendChild(r.dropIndicator)}onDrag({context:e,event:t}){const n=this,{grid:r}=n,{store:i,rowManager:s}=r,{clientY:o}=t;let a,l,c,d,u,h=!0,g=s.getRowAt(o);if(g){const e=g.top+r._bodyRectangle.y-r.scrollable.y,s=g.height/4,u=e+s,h=e+g.height/2,m=e+3*s;l=g.dataIndex,a=i.getAt(l),d=i.tree&&(a.isParent||n.dropOnLeaf)&&o>u&&o<m,c=!d&&t.clientY>=h}else t.clientY<r._bodyRectangle.y?(l=0,a=i.first,c=!1):(l=i.count-1,a=i.last,c=!0),g=r.rowManager.getRow(l);var m;a!==n.overRecord||n.after!==c||n.over!==d?(n.overRecord!==a&&(null===(m=s.getRowById(n.overRecord))||void 0===m||m.removeCls(n.dropOverTargetCls)),n.overRecord=a,n.after=c,n.over=d,a===e.startRecord&&(h=!1),!c&&0===l&&i.isGrouped&&(h=!1),i.tree?(u=c?a.nextSibling:a,e.records.some((e=>e.contains(a)))&&(h=!1),e.parent=h&&d?a:a.parent,g.toggleCls(n.dropOverTargetCls,h&&d),n.clearTimeout(n.hoverTimer),a&&a.isParent&&!a.isExpanded(i)&&(n.hoverTimer=n.setTimeout((()=>r.expand(a)),n.hoverExpandTimeout))):u=c?i.getAt(l+1):a,!d&&l===i.indexOf(e.startRecord)+(c?-1:1)&&e.parent&&e.startRecord.parent===e.parent&&(h=!1),g&&Mr.setTranslateY(n.dropIndicator,Math.max(g.top+(c?g.element.getBoundingClientRect().height:0),1)),n.dropIndicator.style.visibility=d?"hidden":"visible",n.dropIndicator.classList.toggle("b-drag-invalid",!h),e.insertBefore=u,e.valid=n.reorderValid=h):e.valid=n.reorderValid}async onDrop(e){const t=this,{context:n}=e;n.valid=n.valid&&t.reorderValid,n.valid&&(n.async=!0,t.client.store.tree&&(n.oldPositionContext=n.records.map((e=>{var t;return{record:e,parentId:null===(t=e.parent)||void 0===t?void 0:t.id,parentIndex:e.parentIndex}}))),!1===await t.trigger("gridRowBeforeDropFinalize",e)&&(n.valid=!1),await t.dragHelper.animateProxyTo(t.dropIndicator,{align:"l0-l0"}),await t.finalizeReorder(n)),t.clearTimeout(t.hoverTimer),t.overRecord=t.after=t.over=null,t.trigger("gridRowDrop",e)}async finalizeReorder(e){const t=this,{grid:n}=t,{store:r,focusedCell:i}=n;let{records:s}=e;if(e.valid=e.valid&&!s.some((e=>!r.includes(e))),e.valid){let l;var o,a;r.tree?(s=s.filter((e=>!e.parent||e.bubbleWhile((e=>!s.includes(e)),!0))),l=await e.parent.tryInsertChild(s,t.over?null===(o=e.parent.children)||void 0===o?void 0:o[0]:e.insertBefore),n.rowManager.forEach((e=>e.removeCls(t.dropOverTargetCls))),!e.parent.isExpanded()&&null!==(a=e.parent.children)&&void 0!==a&&a.length&&n.expand(e.parent),e.valid=!1!==l):r.move(s,e.insertBefore),(null==i?void 0:i._rowIndex)>=0&&(n._focusedCell=null,n.focusCell({grid:n,record:i.record,columnId:i.columnId})),r.clearSorters()}e.finalize(e.valid),n.element.classList.remove("b-row-reordering")}onReset(){const e=this,{grid:t}=e,n=t.features.cellEdit;t.element.classList.remove("b-row-reordering"),n&&(n.disabled=e.cellEditDisabledState),e.dropIndicator.remove(),Mr.removeClsGlobally(t.element,...e.dropOverTargetCls)}onPaint({firstPaint:e}){e&&this.init()}updateShowGrip(e){this.grid.element.classList.toggle("b-row-reorder-with-grip",e)}}v(Gg,"$name","RowReorder"),v(Gg,"configurable",{showGrip:null,hoverExpandTimeout:1e3,touchStartDelay:300,dropOnLeaf:!1}),Gg.featureClass="",Gg._$name="RowReorder",vg.registerFeature(Gg,!1),vg.registerFeature(Gg,!0,"Gantt");class qg extends(Zr(Wr)){static get $name(){return"Search"}static get configurable(){return{limit:1e3,keyMap:{F3:"gotoNextHit","Ctrl+g":"gotoNextHit","Shift+F3":"gotoPrevHit","Ctrl+Shift+g":"gotoPrevHit"}}}static get properties(){return{hitCls:"b-search-hit",hitCellCls:"b-search-hit-cell",hitCellBadgeCls:"b-search-hit-cell-badge",hitTextCls:"b-search-hit-text"}}construct(e,t){super.construct(e,t),Object.assign(this,{grid:e,text:"",hitEls:[],treeWalker:e.setupTreeWalker(e.element,Mr.NodeFilter.SHOW_TEXT,(()=>Mr.NodeFilter.FILTER_ACCEPT))}),e.on({expandNode:"onTreeNodeExpand",thisObj:this})}isActionAvailable(){return Boolean(this.text)}onTreeNodeExpand(){this.text&&this.requestAnimationFrame(this.search,[this.text,!1,!0])}doDestroy(){this.clear(!0),super.doDestroy()}doDisable(e){e&&this.clear(),super.doDisable(e)}get store(){return this.grid.store}static get pluginConfig(){return{chain:["populateCellMenu"]}}search(e,t=!0,n=!1){const r=this;if(!e)return r.clear();if(!n&&e===r.text||r.disabled)return;const{grid:i,store:s}=r,o=i.columns.visibleColumns.filter((e=>!1!==e.searchable)),a=[],l=o.map((e=>{var t;return a.push(null===(t=e.formatValue)||void 0===t?void 0:t.bind(e)),e.field})),c=s.search(e,l,a);for(const e of o)if(e.mergeCells&&e.isSorted){let t=null,n=null;for(const r of c)if(r.field===e.field){const e=r.data[r.field];e===t&&(r.belongsTo=n),t=e,n=`${r.field}-${r.id}`}}let d=1;if(Object.assign(r,{foundMap:{},prevFound:r.found,found:c,text:e,findRe:new RegExp(`(\\s+)?(${_.escapeRegExp(String(e))})(\\s+)?`,"ig")}),r.clearHits(),c){for(const e of c)if(r.foundMap[`${e.field}-${e.id}`]=e.belongsTo?r.foundMap[e.belongsTo]:d++,d>r.limit)break;return r.listenersInitialized||(i.rowManager.on({name:"renderCell",renderCell:"renderCell",thisObj:r}),s.on({name:"storeRefresh",[`refresh${i.asyncEventSuffix}`]:"onStoreRefresh",thisObj:r}),r.listenersInitialized=!0),i.refreshRows(),i.trigger("search",{grid:i,find:e,found:c}),t&&!r.isHitFocused&&r.gotoNextHit(!0),c}}clearHits(){for(const e of Mr.children(this.grid.element,"."+this.hitCls)){e.classList.remove(this.hitCls,this.hitCellCls);const t=Ps.get(e).row;t&&(t.forceInnerHTML=!0,t.renderCell(e),t.forceInnerHTML=!1)}}clear(e=!1){const t=this,{grid:n}=t;t.foundMap&&delete t.foundMap,t.text=null,t.clearHits(),t.listenersInitialized&&(this.detachListeners("renderCell"),this.detachListeners("storeRefresh"),t.listenersInitialized=!1),e||n.trigger("clearSearch",{grid:n})}get foundCount(){var e,t;return null!==(e=null===(t=this.found)||void 0===t?void 0:t.length)&&void 0!==e?e:0}get isHitFocused(){var e;const t=this,{grid:n}=t,{focusedCell:r}=n;if(null!=r&&null!==(e=r.cell)&&void 0!==e&&e.contains(Mr.getActiveElement(n.element))){const e=r.rowIndex,n=r.column;return-1!==e&&t.found.some((t=>t.index===e&&n&&t.field===n.field))}}gotoNextHit(e=!1){var t;const n=this;if(null===(t=n.found)||void 0===t||!t.length)return;const{grid:r}=n,i=r.focusedCell||r.lastFocusedCell,s=i&&!0!==e?r.store.indexOf(i.id):-1,o=n.found.findIndex((e=>e.index>s));-1!==o&&n.gotoHit(o)}gotoPrevHit(){var e;const t=this;if(null===(e=t.found)||void 0===e||!e.length)return;const{grid:n,found:r}=t,i=n.focusedCell||n.lastFocusedCell,s=i?n.store.indexOf(i.id):0;for(let e=r.length-1;e--;e>=0)if(r[e].index<s){t.gotoHit(e);break}}gotoHit(e){const{grid:t}=this,n=this.found[e];return n&&t.focusCell({field:n.field,id:n.id}),Boolean(n)}gotoFirstHit(){this.gotoHit(0)}gotoLastHit(){this.gotoHit(this.found.length-1)}renderCell({cellElement:e,column:t,record:n,value:r}){var i;const s=this,{treeWalker:o,findRe:a,hitTextCls:l}=s,c=null===(i=s.foundMap)||void 0===i?void 0:i[t.field+"-"+n.id];if(c){var d;e.classList.add(s.hitCls),null===(d=e.querySelector(`.${s.hitCellBadgeCls}`))||void 0===d||d.remove();const t=Mr.down(e,".b-grid-cell-value,.b-tree-cell-value")||e;if(String(r).toLowerCase()===String(s.text).toLowerCase())t.innerHTML=`<span class="${s.hitTextCls}">${t.innerHTML}</span><div class="${s.hitCellBadgeCls}">${c}</div>`;else{o.currentNode=t;for(let e=o.nextNode();e&&t.contains(e);){const t=e,n=e.nodeValue,r=["<span>"];e=o.nextNode();let i=a.lastIndex;for(let e=a.exec(n);e;e=a.exec(n)){const t=n.substring(i,e.index),s=e[1]?" ":"",o=e[2],c=e[3]?" ":"";r.push(`${_.encodeHtml(t)}${s}<span class="${l}">${o}</span>${c}`),i=a.lastIndex}r.push(_.encodeHtml(n.substring(i)),"<span>"),t.parentNode.insertBefore(Mr.createElementFromTemplate(r.join(""),{fragment:!0}),t),t.remove()}Mr.createElement({parent:e,className:s.hitCellBadgeCls,text:c})}s.hitEls.push(e)}}populateCellMenu({column:e,record:t,items:n,cellElement:r}){const i=this;e.searchable&&(n.search={text:"L{searchForValue}",localeClass:i,icon:"b-fw-icon b-icon-search",cls:"b-separator",weight:200,disabled:i.disabled,onItem:()=>{let e=globalThis.getSelection().toString();e||(e=r.innerText),i.search(e)}})}onStoreRefresh(){this.search(this.text,!1,!0)}}qg.featureClass="b-search",qg._$name="Search",vg.registerFeature(qg);class Kg extends Wr{static get $name(){return"Sort"}static get configurable(){return{multiSort:!0,prioritizeColumns:!1}}static get properties(){return{ignoreRe:new RegExp(["b-grid-header-resize-handle","b-filter-icon"].join("|")),sortableCls:"b-sortable",sortedCls:"b-sort",sortedAscCls:"b-asc",sortedDescCls:"b-desc"}}construct(e,t){t=this.processConfig(t),this.grid=e,this.bindStore(e.store),super.construct(e,t)}processConfig(e){return"string"==typeof e||Array.isArray(e)?{field:e,ascending:null}:e}setConfig(e){super.setConfig(this.processConfig(e))}bindStore(e){this.detachListeners("store"),e.on({name:"store",beforeSort:"onStoreBeforeSort",sort:"syncHeaderSortState",thisObj:this})}set field(e){const t=this.grid.columns.get(e);t&&"object"==typeof t.sortable&&(t.sortable.field=t.sortable.property||e,e=t.sortable),this.store.sort(e,this.ascending)}get store(){return this.grid.store}static get pluginConfig(){return{chain:["onElementClick","populateHeaderMenu","getColumnDragToolbarItems","renderHeader","onPaint","bindStore"]}}syncHeaderSortState(){const e=this,{grid:t}=e;if(!t.hideHeaders&&t.isPainted){const r=e.store.sorters,i=r.length,s=new Mn;let o;for(const a of t.columns.visibleColumns){var n;const t=a.element,l=null===(n=a.textWrapper)||void 0===n?void 0:n.dataset;let c="none";(null==l?void 0:l.sortIndex)&&delete l.sortIndex,s.value=t.classList,!1!==a.sortable?(s.add(e.sortableCls),o=r.find((e=>e.field===a.field||e.sortFn&&e.sortFn===a.sortable.sortFn)),o?(i>1&&l&&(l.sortIndex=r.indexOf(o)+1),s.add(e.sortedCls),o.ascending?(s.add(e.sortedAscCls),s.remove(e.sortedDescCls),c="ascending"):(s.add(e.sortedDescCls),s.remove(e.sortedAscCls),c="descending")):(s.remove(e.sortedCls),s["b-group"]||(s.remove(e.sortedAscCls),s.remove(e.sortedDescCls)))):s.remove(e.sortableCls),Mr.syncClassList(t,s),Mr.setAttributes(t,{"aria-sort":c})}}}populateHeaderMenu({column:e,items:t}){const n=this,{store:r}=n,i=f(f({},e.sortable),{},{field:e.field,columnOwned:!0});if(!1!==e.sortable&&(t.sortAsc={text:"L{sortAscending}",localeClass:n,icon:"b-fw-icon b-icon-sort-asc",cls:"b-separator",weight:300,disabled:n.disabled,onItem:()=>r.sort(i,!0)},t.sortDesc={text:"L{sortDescending}",localeClass:n,icon:"b-fw-icon b-icon-sort-desc",weight:310,disabled:n.disabled,onItem:()=>r.sort(i,!1)},n.multiSort&&n.grid.columns.records.some((e=>e.sortable)))){const s=r.sorters.find((t=>t.field===e.field||e.sortable.sortFn&&e.sortable.sortFn===t.sortFn));t.multiSort={text:"L{multiSort}",localeClass:n,icon:"b-fw-icon b-icon-sort",weight:320,disabled:n.disabled,menu:{addSortAsc:{text:s?"L{toggleSortAscending}":"L{addSortAscending}",localeClass:n,icon:"b-fw-icon b-icon-sort-asc",disabled:s&&(null==s?void 0:s.ascending),weight:330,onItem:()=>r.addSorter(i,!0)},addSortDesc:{text:s?"L{toggleSortDescending}":"L{addSortDescending}",localeClass:n,icon:"b-fw-icon b-icon-sort-desc",disabled:s&&!s.ascending,weight:340,onItem:()=>r.addSorter(i,!1)},removeSorter:{text:"L{removeSorter}",localeClass:n,icon:"b-fw-icon b-icon-remove",weight:350,disabled:!s,onItem:()=>{r.removeSorter(i.field)}}}}}}getColumnDragToolbarItems(e,t){const n=this,{store:r,disabled:i}=n;if(!1!==e.sortable){const s=r.sorters.find((t=>t.field===e.field));t.push({text:"L{sortAscendingShort}",group:"L{sort}",localeClass:n,icon:"b-icon b-icon-sort-asc",ref:"sortAsc",cls:"b-separator",weight:105,disabled:i,onDrop:({column:e})=>r.sort(e.field,!0)},{text:"L{sortDescendingShort}",group:"L{sort}",localeClass:n,icon:"b-icon b-icon-sort-desc",ref:"sortDesc",weight:105,disabled:i,onDrop:({column:e})=>r.sort(e.field,!1)},{text:"L{addSortAscendingShort}",group:"L{multiSort}",localeClass:n,icon:"b-icon b-icon-sort-asc",ref:"multisortAddAsc",disabled:i||s&&s.ascending,weight:105,onDrop:({column:e})=>r.addSorter(e.field,!0)},{text:"L{addSortDescendingShort}",group:"L{multiSort}",localeClass:n,icon:"b-icon b-icon-sort-desc",ref:"multisortAddDesc",disabled:i||s&&!s.ascending,weight:105,onDrop:({column:e})=>r.addSorter(e.field,!1)},{text:"L{removeSorterShort}",group:"L{multiSort}",localeClass:n,icon:"b-icon b-icon-remove",ref:"multisortRemove",weight:105,disabled:i||!s,onDrop:({column:e})=>r.removeSorter(e.field)})}return t}onStoreBeforeSort({sorters:e}){const{columns:t}=this.client;for(let r=0;r<e.length;r++){var n;const i=e[r],s=(i.columnOwned||this.prioritizeColumns)&&t.get(i.field);null!=s&&null!==(n=s.sortable)&&void 0!==n&&n.sortFn&&(e[r]=f(f(f({},i),s.sortable),{},{columnOwned:!0}))}}onElementClick(e){const t=this,{store:n}=t,{target:r}=e,i=r.closest(".b-grid-header.b-sortable"),s=null==i?void 0:i.dataset.column;if(!t.ignoreRe.test(r.className)&&!t.disabled&&i&&s){const r=t.grid.columns.getById(i.dataset.columnId);if(n.isGrouped&&n.groupers.find((e=>e.field===s))&&!e.shiftKey)return;if(r.sortable&&!e.shiftKey)if(e.ctrlKey&&e.altKey)n.removeSorter(r.field);else{const t={columnOwned:!0,field:r.field};"object"==typeof r.sortable&&sn.assign(t,r.sortable),n.sort(t,null,e.ctrlKey)}}}renderHeader(){this.syncHeaderSortState()}onPaint(){this.syncHeaderSortState()}}Kg.featureClass="b-sort",Kg._$name="Sort",vg.registerFeature(Kg,!0);class Xg extends Wr{static get $name(){return"StickyCells"}static get defaultConfig(){return{contentSelector:null,currentTopRowCls:"b-sticky-cells-current-top-row"}}static get pluginConfig(){return{before:["renderRows"]}}construct(e,t){super.construct(e,t),e.on({scroll:"onGridScroll",thisObj:this}),Object.assign(this,Mr.createElement({reference:"element",parent:e.element,className:"b-grid-sticky-row",children:[{reference:"contentElement",className:"b-grid-cell"}]})),this.removeClasses={"b-focused":!1,"b-hover":!1,"b-selected":!1,[this.currentTopRowCls]:!1}}renderRows(){this.element.classList.add("b-hide-visibility")}onGridScroll(){const e=this,{client:t,element:n,contentElement:r}=e,i=xn.client(t.bodyContainer).roundPx(),s=t.rowManager.getRowAt(i.y),o=s!==e.currentTopRow;if(s){o&&(e.currentTopRow&&(e.currentTopRow.removeCls(e.currentTopRowCls),e.currentTopRow.removeCls("b-not-enough-height")),e.currentTopRow=s,s.addCls(e.currentTopRowCls),r.innerHTML="",r.appendChild(e.updateStickyContent()));const t=e.currentTopRow.bottom-e.client.scrollable.y<=e.stickyContentHeight;e.element.classList[t?"add":"remove"]("b-hide-visibility"),e.currentTopRow[t?"addCls":"removeCls"]("b-not-enough-height"),i.y+=e.stickyContentTop,Mr.alignTo(n,e.stickyEls[0],{align:"t0-t0",constrainTo:i},!0)}e.lastProcessedTopRow=s}updateStickyContent(){const e=this,{currentTopRow:t,removeClasses:n}=e,r={"b-grid-sticky-row":1},i={},s=e.stickyContent||(e.stickyContent=document.createDocumentFragment()),o=e.stickyEls||(e.stickyEls=[]);for(o.forEach((e=>{e.classList.remove("b-sticky-content-el")})),o.length=0,t.eachElement((t=>{o.push(...t.querySelectorAll(e.contentSelector))}));s.firstChild;)s.remove(s.firstChild);return e.stickyContentHeight=0,e.stickyContentTop=0,o.map((t=>{t.closest(".b-grid-cell").classList.forEach((e=>i[e]=1)),t.closest(".b-grid-row").classList.forEach((e=>r[e]=1)),Object.assign(i,n),Object.assign(r,n);const o=t.offsetTop;e.stickyContentTop=Math.max(e.stickyContentTop,o),t.style.alignSelf="flex-end",e.stickyContentHeight=Math.max(e.stickyContentHeight,e.currentTopRow.height-t.offsetTop+o),t.style.alignSelf="";const a=t.cloneNode(!0);return t.classList.add("b-sticky-content-el"),s.appendChild(a),a})),i["b-focused"]=!1,Mr.syncClassList(e.contentElement,i),Mr.syncClassList(e.element,r),s}}Xg._$name="StickyCells",vg.registerFeature(Xg,!1);class Zg extends Wr{static get $name(){return"Stripe"}construct(e,t){super.construct(e,t),e.on({renderrow:"onRenderRow",thisObj:this})}doDisable(e){this.isConfiguring||this.client.refreshRows(),super.doDisable(e)}onRenderRow({row:e}){const{disabled:t}=this,n=e.dataIndex%2==0;e.assignCls({"b-even":!t&&n,"b-odd":!t&&!n})}}Zg._$name="Stripe",vg.registerFeature(Zg);class Jg extends(_g(Wr)){static get configurable(){return{selectedOnly:null,hideFooters:!1}}static get pluginConfig(){return{chain:["renderRows","bindStore"]}}static get $name(){return"Summary"}construct(e,t){this.grid=e,super.construct(e,t),this.bindStore(e.store),e.hideFooters=this.hideFooters}bindStore(e){this.detachListeners("store"),e.on({name:"store",change:"onStoreChange",thisObj:this})}get store(){return this.grid.store}doDestroy(){super.doDestroy()}doDisable(e){super.doDisable(e);const{client:t}=this;e?t.element.classList.add("b-summary-disabled"):(this.updateSummaries(),t.element.classList.remove("b-summary-disabled"),t.eachSubGrid((e=>e.scrollable.syncPartners())))}renderRows(){this.updateSummaries()}updateSummaries(){const e=this,{grid:t,store:n}=e,r=Mr.children(t.element,".b-grid-footer"),i=e.selectedOnly&&t.selectedRecords.length>0,s=(n.isFiltered?n.storage.values:n.allRecords).filter((e=>!e.isSpecialRow&&(!i||t.isSelected(e))));t.columns.forEach((e=>{var t;null===(t=e.summaries)||void 0===t||t.forEach((e=>{"seed"in e&&("initialSeed"in e||(e.initialSeed=e.seed),["number","string","date"].includes(typeof e.initialSeed)?e.seed=e.initialSeed:e.seed=Object.assign({},e.initialSeed))}))})),r.forEach((n=>{if(!n.dataset.column)return;const r=t.columns.get(n.dataset.column),i=e.generateHtml(r,s,"b-grid-footer-summary");(r.summaries?r.summaries.length:r.sum)&&(n.children.length?Mr.sync(i,n.firstElementChild):n.innerHTML=i)}))}onStoreChange({action:e,changes:t}){let n=!0;this.disabled||("update"===e&&(n=Object.keys(t).some((e=>{const t=this.grid.columns.get(e);return Boolean(t)&&(Boolean(t.sum)||Boolean(t.summaries))}))),n&&this.updateSummaries())}updateSelectedOnly(e){const t=this;t.detachListeners("selectionChange"),e&&t.grid.on({name:"selectionChange",selectionChange:t.refresh,thisObj:t}),t.refresh()}refresh(){this.updateSummaries()}}Jg.featureClass="b-summary",Jg._$name="Summary",vg.registerFeature(Jg);const Qg=Promise.resolve();class em extends(Wr.mixin(Zr)){static get pluginConfig(){return{assign:["collapseAll","expandAll","collapse","expand","expandTo","toggleCollapse"],chain:["onElementPointerUp","onElementClick","bindStore"]}}construct(e,t){super.construct(e,t),this.treeColumn||console.info("To use the tree feature, one column should be configured with `type: 'tree'`"),e.store&&this.bindStore(e.store)}doDisable(e){if(e)throw new Error("Tree feature cannot be disabled")}get store(){return this.client.store}get treeColumn(){const e=this,{columns:t}=e.client;return e._treeColumn&&t.includes(e._treeColumn)||(e._treeColumn=t.find((e=>e.isTreeColumn))),e._treeColumn}bindStore(e){this.detachListeners("store"),e.on({name:"store",beforeLoadChildren:"onBeforeLoadChildren",loadChildren:"onLoadChildren",loadChildrenException:"onLoadChildrenException",beforeToggleNode:"onBeforeToggleNode",thisObj:this})}async toggleCollapse(e,t,n=!1){if(null==e)throw new Error("Tree#toggleCollapse must be passed a record");const r=this,{store:i,client:s}=r,{rowManager:o}=s,a=i.getById(e),l=a.instanceMeta(i);if(await i.toggleCollapse(a,t)){const e=o.getRowFor(a);if(e&&a.ancestorsExpanded()){const t=r.treeColumn&&!r.treeColumn.subGrid.collapsed&&e.getCell(r.treeColumn.id);t&&e.renderCell(t)}r.isTogglingNode||(s.element.classList.add("b-toggling-node"),r.isTogglingNode=!0,r.requestAnimationFrame((()=>{s.element.classList.remove("b-toggling-node"),r.isTogglingNode=!1}))),s.trigger(l.collapsed?"collapseNode":"expandNode",{record:a}),s.trigger("toggleNode",{record:a,collapse:l.collapsed})}}async collapse(e){return this.toggleCollapse(e,!0)}async expand(e){return this.toggleCollapse(e,!1)}onBeforeToggleNode({record:e,collapse:t}){this.client.trigger("beforeToggleNode",{record:e,collapse:t})}onBeforeLoadChildren({source:e,params:t}){const n=e.getById(t[e.modelClass.idField]),r=this.client.rowManager.getRowFor(n);null==r||r.addCls("b-loading-children")}onLoadChildren({source:e,params:t}){const n=e.getById(t[e.modelClass.idField]),r=this.client.rowManager.getRowFor(n);null==r||r.removeCls("b-loading-children")}onLoadChildrenException({record:e}){const t=this.client.rowManager.getRowFor(e);null==t||t.removeCls("b-loading-children")}async expandOrCollapseAll(e=!0,t=this.store.rootNode){const{client:n,store:r}=this,i=[],s=[];return n.trigger("beforeToggleAllNodes",{collapse:e}),r.suspendEvents(),r.traverse((t=>{const n=t.instanceMeta(r);t.isLeaf||(e&&!n.collapsed?(this.toggleCollapse(t,!0,!0),s.push(...t.children)):!e&&n.collapsed&&(Array.isArray(t.children)&&s.push(...t.children),i.push(this.toggleCollapse(t,!1,!0))))}),t,t===r.rootNode),r.resumeEvents(),(e?Qg:Promise.all(i)).then((()=>{n.refreshRows(e),s.length&&(e?r.trigger("remove",{records:s,isCollapse:!0,isCollapseAll:!0}):r.trigger("add",{records:s,isExpand:!0,isExpandAll:!0})),n.trigger("toggleAllNodes",{collapse:e})}))}async collapseAll(){return this.expandOrCollapseAll(!0)}async expandAll(){return this.expandOrCollapseAll(!1)}async expandTo(e){const t=this,{store:n}=t,r=n.getById(e);if(!1!==r.instanceMeta(t.store).hiddenByCollapse){if(!r.ancestorsExpanded()){var i;const e=[];for(let t=r.parent;t&&!t.isRoot;t=t.parent)t.isExpanded(n)||e.unshift(t);for(const n of e)t.isDestroyed||await t.toggleCollapse(n,!1,!0);null===(i=t.client)||void 0===i||i.refreshRows()}t.isDestroyed||await t.client.scrollRowIntoView(r)}}onElementPointerUp(e){const t=this,n=e.target,r=t.client.getCellDataFromEvent(e);(n.closest(".b-tree-expander")||t.expandOnCellClick&&null!=r&&r.record.isParent)&&t.toggleCollapse(r.record)}onElementClick(e){e.target.closest(".b-tree-expander")&&e.preventDefault()}toggleCollapseByKey(){const{focusedCell:e}=this.client;return(null==e?void 0:e.rowIndex)>-1&&!e.isActionable&&(this.toggleCollapse(e.id),!0)}expandIfSingleColumn(){return 1===this.client.columns.count&&this.expandByKey()}expandByKey(){const{client:e}=this,{focusedCell:t}=e,n=null==t?void 0:t.record;return!!(null!=t&&t.column.tree&&n.isParent&&n.instanceMeta(e.store).collapsed)&&(this.expand(n),!0)}collapseIfSingleColumn(){return 1===this.client.columns.count&&this.collapseByKey()}collapseByKey(){const e=this,{client:t}=e,{focusedCell:n}=t,r=null==n?void 0:n.record;if(null!=n&&n.column.tree){if(r.isParent&&!r.instanceMeta(t.store).collapsed)return e.collapse(r),!0;if(r.parent&&!r.parent.isRoot)return t.focusCell({record:r.parent,column:n.column}),!0}return!1}}v(em,"$name","Tree"),v(em,"configurable",{expandOnCellClick:!1,keyMap:{" ":"toggleCollapseByKey",ArrowRight:"expandIfSingleColumn","Shift+ArrowRight":"expandByKey",ArrowLeft:"collapseIfSingleColumn","Shift+ArrowLeft":"collapseByKey"}}),em.featureClass="b-tree",em._$name="Tree",vg.registerFeature(em,!1,"Grid"),vg.registerFeature(em,!0,"TreeGrid");class tm extends Wr{construct(e,t){if(super.construct(e,t),!e.hasFeature("tree"))throw new Error("The TreeGroup feature requires the Tree feature to be enabled")}processParentData(e){this.parentCls&&(e.cls=this.parentCls)}processTransformedData(e){}async waitForReadiness(){if(this.originalStore.isLoading&&(await this.originalStore.await("load",!1),this.isDestroyed))return;const{crudManager:e}=this.client;if(e){if(e.isLoadingOrSyncing&&(await e.await("requestDone"),this.isDestroyed))return;await this.client.project.commitAsync()}}async applyLevels(e){const t=this,{client:n}=t,r=n.columns.find((e=>e instanceof ug));let{store:i}=n,s=null;if(t._levels=e,t.isApplying++,n.suspendRefresh(),e&&!t.originalStore&&(t.originalStore=i,i=new i.constructor({tree:!0,modelClass:i.modelClass}),n.store=i),await t.waitForReadiness(),!t.isDestroyed)return e?(i.data=t.originalStore.allRecords.flatMap((e=>e.isLeaf?[e.link()]:[])),s=i.treeify(e,(e=>{sn.setPath(e,i.modelClass.getFieldDataSource(r.field),e.key),t.processParentData(e)})),t.processTransformedData(s),i.data=s.children):(n.store=t.originalStore,t.originalStore=null),t.isApplying--,n.resumeRefresh(),n.rowManager.reinitialize(),s}updateLevels(e){!e&&this.isConfiguring||this.applyLevels(e)}async group(e){sn.assertArray(e,"group()"),await this.applyLevels(e)}async clearGroups(){this.isGrouped&&await this.applyLevels(null)}get isGrouped(){return Boolean(this._levels)}}v(tm,"$name","TreeGroup"),v(tm,"configurable",{levels:null,parentCls:"b-generated-parent"}),v(tm,"pluginConfig",{assign:["group","clearGroups"]}),v(tm,"properties",{isApplying:0,originalStore:null}),tm._$name="TreeGroup",vg.registerFeature(tm);const nm="all",rm="visible",im={A6:{width:4.11,height:5.81},A5:{width:5.81,height:8.25},A4:{width:8.25,height:11.69},A3:{width:11.69,height:16.49},Legal:{width:8.5,height:14},Letter:{width:8.5,height:11}},sm="portrait",om={pdf:"pdf",png:"png"},am={pdf:"application/pdf",png:"image/png"};class lm extends Eu{static get $name(){return"ExportRowsCombo"}static get type(){return"exportrowscombo"}static get defaultConfig(){return{editable:!1}}buildItems(){return[{id:nm,text:this.L("L{all}")},{id:rm,text:this.L("L{visible}")}]}}lm.initClass(),lm._$name="ExportRowsCombo";class cm extends Eu{static get $name(){return"ExportOrientationCombo"}static get type(){return"exportorientationcombo"}static get defaultConfig(){return{editable:!1}}buildItems(){return[{id:sm,text:this.L("L{portrait}")},{id:"landscape",text:this.L("L{landscape}")}]}}function dm(e,t=(e=>e)){return Object.keys(e).map((e=>({id:e,text:t(e)})))}cm.initClass(),cm._$name="ExportOrientationCombo";class um extends Ic{static get $name(){return"ExportDialog"}static get type(){return"exportdialog"}static get configurable(){return{autoShow:!1,autoClose:!1,closable:!0,centered:!0,client:null,autoSelectVisibleColumns:!0,hidePNGMultipageOption:!0,title:"L{exportSettings}",maxHeight:"80%",scrollable:{overflowY:!0},defaults:{localeClass:this},items:{columnsField:{type:"combo",label:"L{ExportDialog.columns}",store:{},valueField:"id",displayField:"text",multiSelect:!0,weight:100,maxHeight:100},rowsRangeField:{type:"exportrowscombo",label:"L{ExportDialog.rows}",value:"all",weight:200},exporterTypeField:{type:"combo",label:"L{ExportDialog.exporterType}",editable:!1,value:"singlepage",displayField:"text",buildItems(){const e=this.parent;return e.exporters.map((t=>({id:t.type,text:e.optionalL(t.title,this)})))},onChange({value:e}){this.owner.widgetMap.alignRowsField.hidden="singlepage"===e,this.owner.widgetMap.repeatHeaderField.hidden="multipagevertical"!==e},weight:300},alignRowsField:{type:"checkbox",label:"L{ExportDialog.alignRows}",checked:!1,hidden:!0,weight:400},repeatHeaderField:{type:"checkbox",label:"L{ExportDialog.repeatHeader}",localeClass:this,hidden:!0,weight:500},fileFormatField:{type:"combo",label:"L{ExportDialog.fileFormat}",localeClass:this,editable:!1,value:"pdf",items:[],onChange({value:e,oldValue:t}){const n=this.parent;if(n.hidePNGMultipageOption){const r=n.widgetMap.exporterTypeField,i=r.store.find((e=>"singlepage"===e.id));e===om.png&&i?(this._previousDisabled=r.disabled,r.disabled=!0,this._previousValue=r.value,r.value="singlepage"):t===om.png&&this._previousValue&&(r.disabled=this._previousDisabled,r.value=this._previousValue)}},weight:600},paperFormatField:{type:"combo",label:"L{ExportDialog.paperFormat}",editable:!1,value:"A4",items:[],weight:700},orientationField:{type:"exportorientationcombo",label:"L{ExportDialog.orientation}",value:"portrait",weight:800}},bbar:{defaults:{localeClass:this},items:{exportButton:{color:"b-green",text:"L{ExportDialog.export}",weight:100,onClick:"up.onExportClick"},cancelButton:{color:"b-gray",text:"L{ExportDialog.cancel}",weight:200,onClick:"up.onCancelClick"}}}}}construct(e={}){const t=this,{client:n}=e;if(!n)throw new Error("`client` config is required");t.columnsStore=n.columns.chain((e=>e.isLeaf&&e.exportable),null,{excludeCollapsedRecords:!1}),t.applyInitialValues(e),super.construct(e),lt.on({locale:"onLocaleChange",prio:-1,thisObj:t})}applyInitialValues(e){const t=this,n=e.items=e.items||{};e.width=e.width||t.L("L{width}"),e.defaults=e.defaults||{},e.defaults.labelWidth=e.defaults.labelWidth||t.L("L{ExportDialog.labelWidth}"),n.columnsField=n.columnsField||{},n.fileFormatField=n.fileFormatField||{},n.paperFormatField=n.paperFormatField||{},n.fileFormatField.items=dm(om,(e=>e.toUpperCase())),n.paperFormatField.items=dm(im),n.columnsField.store=t.columnsStore}onBeforeShow(){var e;const{columnsField:t,alignRowsField:n,exporterTypeField:r,repeatHeaderField:i}=this.widgetMap;this.autoSelectVisibleColumns&&(t.value=this.columnsStore.query((e=>!e.hidden))),n.hidden="singlepage"===r.value,i.hidden="multipagevertical"!==r.value,null===(e=super.onBeforeShow)||void 0===e||e.call(this,...arguments)}onLocaleChange(){const e=this.L("L{labelWidth}");this.width=this.L("L{width}"),this.eachWidget((t=>{t instanceof fu&&(t.labelWidth=e)}))}onExportClick(){const e=this.values;this.trigger("export",{values:e})}onCancelClick(){this.trigger("cancel"),this.hide()}get values(){const e=/field/i,t={};return this.eachWidget((n=>{e.test(n.ref)&&(t[n.ref.replace(e,"")]=n instanceof Au?n.checked:n.value)})),t}}um.initClass(),um._$name="ExportDialog";const hm=document.createRange();class gm extends Te{static get configurable(){return{cls:{$config:{equal:(e,t)=>(null==e?void 0:e.isDomClassList)&&(null==t?void 0:t.isDomClassList)&&e.isEqual(t)}}}}construct(e){Object.assign(this,{_elements:{},_elementsArray:[],_cells:{},_allCells:[],_regions:[],lastHeight:0,lastTop:-1,_dataIndex:0,_top:0,_height:0,_id:null,forceInnerHTML:!1,isGroupFooter:!1,cellContext:new Gh({grid:e.grid,id:null,columnIndex:0})}),super.construct(e)}doDestroy(){const e=this;e.rowManager.isDestroying||(e.removeElements(),e.rowManager.idMap[e.id]===e&&delete e.rowManager.idMap[e.id]),super.doDestroy()}get index(){return this._index}set index(e){this._index=e}get dataIndex(){return this._dataIndex}set dataIndex(e){this._dataIndex!==e&&(this._dataIndex=e,this.eachElement((t=>{t.dataset.index=e,t.ariaRowIndex=this.grid.hideHeaders?e+1:e+2})))}get id(){return this._id}set id(e){const t=this,n={id:e},r=t.rowManager.idMap;t._id===e&&r[e]===t||(r[t._id]===t&&delete r[t._id],r[e]=t,t._id=e,t.eachElement((t=>{Ps.assign(t,n),t.dataset.id=e})),t.eachCell((e=>Ps.assign(e,n))))}addElement(e,t){const n=this;let r=t.firstElementChild;for(n._elements[e]=t,n._elementsArray.push(t),n._regions.push(e),Ps.assign(t,{index:n.index}),n._cells[e]=[];r;)n._cells[e].push(r),n._allCells.push(r),Ps.set(r,{column:r.dataset.column,columnId:r.dataset.columnId,rowElement:r.parentNode,row:n}),r=r.nextElementSibling;t.dataset.index=n.index,t.ariaRowIndex=n.grid.hideHeaders?n.index+1:n.index+2}getElement(e){return this._elements[e]}getRectangle(e){return xn.from(this.getElement(e))}eachElement(e){this._elementsArray.forEach(e)}eachCell(e){this._allCells.forEach(e)}get elements(){return this._elements}get element(){const e=Object.keys(this._elements)[0];return this._elements[e]}get cells(){return this._allCells}getCells(e){return this._cells[e]}getCell(e){return this._allCells.find((t=>{const n=Ps.get(t);return n.columnId==e||n.column==e}))}removeElements(e=!1){const t=this;t.rowManager.trigger("removeRow",{row:t}),e||t.eachElement((e=>e.remove())),t._elements={},t._cells={},t._elementsArray.length=t._regions.length=t._allCells.length=t.lastHeight=t.height=0,t.lastTop=-1}get height(){return this._height}set height(e){this._height=e}get offsetHeight(){return this.height+this.grid._rowBorderHeight}updateElementsHeight(e){const t=this;e||t.rowManager.storeKnownHeight(t.id,t.height),t.lastHeight!==t.height&&(this.eachElement((e=>e.style.height=`${t.offsetHeight}px`)),t.lastHeight=t.height)}addCls(e){this.updateCls(this.cls.add(e))}removeCls(e){this.updateCls(this.cls.remove(e))}toggleCls(e,t){this.updateCls(this.cls[t?"add":"remove"](e))}assignCls(e){this.updateCls(this.cls.assign(e))}changeCls(e){return null!=e&&e.isDomClassList?e:new Mn(e)}updateCls(e){this.eachElement((t=>Mr.syncClassList(t,e)))}setAttribute(e,t){this.eachElement((n=>n.setAttribute(e,t)))}removeAttribute(e){this.eachElement((t=>t.removeAttribute(e)))}get isFirst(){return 0===this.dataIndex}get top(){return this._top}get bottom(){return this._top+this._height+this.grid._rowBorderHeight}setTop(e,t){this._top!==e&&(this._top=e,this.translateElements(t))}setBottom(e,t){this.setTop(e-this.offsetHeight,t)}translate(e,t=!1){return this.setTop(e,t),e+this.offsetHeight}translateElements(e){const t=this,n=t.grid.positionMode;t.lastTop!==t.top&&(t.eachElement((e=>{const r=e.style;"translate"===n?r.transform=`translate(0,${t.top}px)`:"translate3d"===n?r.transform=`translate3d(0,${t.top}px,0)`:"position"===n&&(r.top=`${t.top}px`)})),e||t.rowManager.trigger("translateRow",{row:t}),t.lastTop=t.top)}offset(e){let t=this._top+e;return t<0&&(e-=t,t=0),this.setTop(t),e}render(e,t,n=!0,r=!1,i=!1){var s,o,a,l;const c=this,{cellContext:d,cls:u,elements:h,cells:g,grid:m,rowManager:p,height:f,_id:v}=c,y=Ps.get(c._elementsArray[0]),b=p._rowHeight,{store:C}=m,{isTree:w}=C;let S,D=0;if(t||!1===t||(t=m.store.getById(y.id),e=m.store.indexOf(t)),!t)return;const E=null===(s=t)||void 0===s?void 0:s.cls,x=E?E.isDomClassList?E:new Mn(E):null;u.assign({"b-grid-row-updating":n&&m.transitionDuration&&!i,"b-selected":m.isSelected(null===(o=t)||void 0===o?void 0:o.id),"b-readonly":t.readOnly,"b-linked":t.isLinked,"b-original":t.hasLinks}),c.lastRecordCls&&u.remove(c.lastRecordCls),x?(u.add(x),c.lastRecordCls=Object.assign({},x)):c.lastRecordCls=null,p.trigger("beforeRenderRow",{row:c,record:t,recordIndex:e,oldId:v}),m.beforeRenderRow({row:c,record:t,recordIndex:e,oldId:v}),c.updateCls(u),n&&m.transitionDuration&&!i&&m.setTimeout((()=>{c.isDestroyed||(u.remove("b-grid-row-updating"),c.updateCls(u))}),m.transitionDuration),c.id=t.id,c.dataIndex=e;const R=!m.fixedRowHeight&&m.getRowHeight(t)||b;let T=c.maxRequestedHeight=null;if(w)for(const e in h){const n=h[e];var M,k;n.id=`${m.id}-${e}-${c.id}`,Mr.setAttributes(n,{"aria-level":t.childLevel+1,"aria-setsize":t.parent.children.length,"aria-posinset":t.parentIndex+1}),t.isExpanded(C)?Mr.setAttributes(n,{"aria-expanded":!0,"aria-owns":null!==(M=t.children)&&void 0!==M&&M.length?null===(k=t.children)||void 0===k?void 0:k.map((t=>`${m.id}-${e}-${t.id}`)).join(" "):null}):(t.isLeaf?n.removeAttribute("aria-expanded"):n.setAttribute("aria-expanded",!1),n.removeAttribute("aria-owns"))}for(d._record=t,d._id=t.id,d._rowIndex=e,D=0;D<g.length;D++)d._columnId=g[D].dataset.columnId,d._column=m.columns.getById(d._columnId),d._columnIndex=D,d._cell=g[D],d.height=R,d.maxRequestedHeight=T,d.updatingSingleRow=n,S=c.renderCell(d),p.fixedRowHeight||null!=S.height&&(T=Math.max(T,S.height),S.transient||(c.maxRequestedHeight=T));const I=null!==(a=T)&&void 0!==a?a:R;c.height=null!==(l=m.processRowHeight(t,I))&&void 0!==l?l:I,c.updateElementsHeight(i),n&&!i&&(f!==c.height&&p.translateFromRow(c,r),p.trigger("updateRow",{row:c,record:t,recordIndex:e,oldId:v}),p.trigger("renderDone")),m.afterRenderRow({row:c,record:t,recordIndex:e,oldId:v,oldHeight:f,isExport:i}),p.trigger("renderRow",{row:c,record:t,recordIndex:e,oldId:v,isExport:i}),f&&c.height!==f&&p.trigger("rowRowHeight",{row:c,record:t,height:c.height,oldHeight:f}),c.forceInnerHTML=!1}renderCell(e){var t,n;e.isLocation||(e=new Gh(e));let{cell:r,record:i}=e;const s=this,{grid:o,column:a,height:l,maxRequestedHeight:c,updatingSingleRow:d=!0,isMeasuring:u=!1}=e,h=null===(t=o.features)||void 0===t?void 0:t.cellEdit,g=Ps.get(r),m=g.rowElement,p=Ps.get(m);if(!i&&(i=e.record=o.store.getById(p.id),!i))return;let f=a.getRawValue(i);const v=i.fieldMap[a.field],y={configuredHeight:l,height:null,maxRequestedHeight:c},b=a.getCellClass(e),C={cellElement:r,dataField:v,rowElement:m,value:f,record:i,column:a,size:y,grid:o,row:g.row,updatingSingleRow:d,isMeasuring:u},w=a.renderer||a.defaultRenderer;o.beforeRenderCell(C),C.cellElement!==r&&(r=C.cellElement),Mr.syncClassList(r,b);let S=!0;w?(f=w.call(a,C),void 0===f&&(S=!1)):v&&(f=v.print(f));const D=null===(n=o.hasFrameworkRenderer)||void 0===n?void 0:n.call(o,{cellContent:f,column:a});D&&i.isSpecialRow&&(f="");const E=D&&!a.data.tree&&!i.isSpecialRow;if(S&&!E){var x;let t=r;null!=h&&null!==(x=h.editorContext)&&void 0!==x&&x.equals(e)&&!h.editor.isFinishing&&(t=s.moveContentFromCell(r,h.editor.element));const n=null!=f&&"object"==typeof f,i="string"==typeof f,o=n||null==f?"":String(f);if(s.forceInnerHTML&&(t.innerHTML="",delete t._content,r.lastDomConfig=null),n||!a.htmlEncode||a.disableHtmlEncode?!a.autoSyncHtml||i&&!Mr.getChildElementCount(t)?n?oa.sync({targetElement:t,domConfig:{onlyChildren:!0,children:ke.asArray(f)}}):t._content!==o&&(t.innerHTML=t._content=o):i?Mr.sync(o,t.firstElementChild):n&&oa.sync({domConfig:f,targetElement:t}):r._hasHtml?(t.innerText=o,r._hasHtml=!1):Mr.setInnerText(t,o),t!==r){const{firstChild:e}=r;for(const n of t.childNodes)r.insertBefore(n,e)}}var R;return i.isSpecialRow||null===(R=o.processCellContent)||void 0===R||R.call(o,{cellElementData:g,rendererData:C,rendererHtml:C.rendererHtml||f}),a.autoHeight&&null==y.height&&(r.classList.add("b-measuring-auto-height"),y.height=Math.max(r.offsetHeight,o.rowHeight),r.classList.remove("b-measuring-auto-height")),u||s.rowManager.trigger("renderCell",C),y}moveContentFromCell(e,t){hm.setStart(e,0),hm.setEndBefore(t);const n=document.createElement("div");return n.appendChild(hm.extractContents()),n}}v(gm,"$name","Row"),gm.initClass(),gm._$name="Row";class mm extends(Zr(tt(pt(Te)))){static get defaultConfig(){return{translateURLsToAbsolute:!0,keepPathName:!0,filterStyles:e=>e}}pageTpl(e){const{title:t,header:n,footer:r,styles:i,htmlClasses:s,bodyStyle:o,bodyClasses:a=[],paperHeight:l,paperWidth:c,html:d}=e;return a.push(`b-${this.constructor.type}`),Mr.scrollBarWidth?a.push("b-visible-scrollbar"):a.push("b-overlay-scrollbar"),y.isChrome?a.push("b-chrome"):y.isSafari?a.push("b-safari"):y.isFirefox&&a.push("b-firefox"),Yc.tpl`
            <!DOCTYPE html>
            <html class="${s}" style="width: ${c}in; height: ${l}in;">
                <head>
                    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
                    <title>${t}</title>
                    ${i.join("")}
                </head>
                <body class="b-export ${a.join(" ")}" style="width: ${c}in; height: ${l}in; ${o}">
                    <div class="b-export-content">
                        ${n&&`<div class="b-export-header" style="width: 100%">${n}</div>`}
                        <div class="b-export-body"><div class="b-export-viewport">${d}</div></div>
                        ${r&&`<div class="b-export-footer" style="width: 100%">${r}</div>`}
                    </div>
                </body>
            </html>`}get stylesheets(){const e=this;if(e._stylesheets)return e._stylesheets;const t=e.translateURLsToAbsolute,n=globalThis.origin,r=Array.from(document.querySelectorAll('link[rel="stylesheet"], style')),i=[];return r.forEach((r=>{if(r=r.cloneNode(!0),t&&r.href){let e;e=!0===t?r.href:this.keepPathName?r.href.replace(n,t):new URL(r.getAttribute("href"),t),r.setAttribute("href",e)}let s=r.outerHTML;if(t&&/style/i.test(r.tagName)){const n=e.getStyleTagURLConverter(t);s=s.replace(/url\(['"]?(.+?)['"]?\)/g,n)}i.push(s)})),i.push("<style>\n                body, html {\n                    overflow: auto;\n                }\n                body {\n                    position: relative;\n                    margin: 0;\n                }\n            </style>"),e._stylesheets=e.filterStyles(i)}set stylesheets(e){this._stylesheets=e?this.filterStyles(e):e}getStyleTagURLConverter(e){return function(t,n){let r;try{let i;/^#/.test(n)?r=t:(i=!0===e?globalThis.location.href:this.keepPathName?globalThis.location.href.replace(globalThis.location.origin,e):e,r=`url('${new URL(n,i).href}')`)}catch(e){r=t}return r}.bind(this)}saveState({client:e}){this.state=e.state}async restoreState({client:e}){const t=[],n=new Set;n.add(e.scrollable.on({scroll(){t.push(e.scrollable.await("scrollEnd"))}})),e.eachSubGrid((({header:e,scrollable:r})=>{n.add(r.on({scroll(){t.push(r.await("scrollEnd"))}})),n.add(e.scrollable.on({scroll(){t.push(e.scrollable.await("scrollEnd"))}}))})),e.state=this.state,await Promise.all(t),n.forEach((e=>e()))}beforeExport(){this.element=document.createElement("div")}cloneElement(e,t=this.element,n=!0){n&&(t.innerHTML=""),t.appendChild(e.cloneNode(!0)),Mr.removeEachSelector(t,".b-grid-row,.b-grid-merged-cells-container");const r=t.querySelector(".b-gridbase > .b-mask");r&&r.remove()}createPlaceholder(e,t=!0,n={}){return t&&(e.innerHTML=""),Mr.createElement(Object.assign({parent:e,id:Yi.generateId("export")},n))}prepareElement({client:e}){const{tbar:t,bbar:n}=e;t&&this.element.querySelector(`#${t.id}`).remove(),n&&this.element.querySelector(`#${n.id}`).remove()}measureElement(e=""){e instanceof HTMLElement&&(e=e.outerHTML);const t=Mr.createElement({parent:document.body,style:{visibility:"hidden",position:"absolute"},html:`<div style="height: 1px"></div>${e}<div style="height: 1px"></div>`}),n=t.offsetHeight-2;return t.remove(),n}prepareHTML(e){e instanceof HTMLElement&&(e=e.outerHTML);const t=Mr.createElement({parent:document.body,style:{visibility:"hidden",position:"absolute"},html:e}),n=t.querySelectorAll("img");for(let e=0,t=n.length;e<t;e++)n[e].setAttribute("src",n[e].src);const r=t.innerHTML;return t.remove(),r}getVirtualScrollerHeight(e){let t=0;return e.eachSubGrid((e=>{e.overflowingHorizontally&&(t=Mr.scrollBarWidth)})),0===t?t:t+1}inchToPx(e){return 96*e}getScaleValue(e,t){return Math.floor(1e4*e/t)/1e4}getVisibleRowsCount(e){const t=e.rowManager,n=t.rows.indexOf(t.firstVisibleRow),r=t.rows.indexOf(t.lastVisibleRow);let i;return i=-1!==n?-1===r?e.store.count-n:r-n+1:e.store.count,i}async export(e){const t=this;let n;t.beforeExport(),t.saveState(e),await t.prepareComponent(e);try{n=await t.getPages(e)}finally{await t.restoreComponent(e),t.stylesheets=null,await new Promise((e=>t.requestAnimationFrame(e))),await t.restoreState(e)}return n}async getPages(e){const t=this.pagesExtractor(e),n=[];let r;for(;(r=await t.next())&&!r.done;)n.push(r.value);return n}adjustRowBuffer(e){const{contentHeight:t}=this.exportMeta,{rowManager:n}=e;this.oldRowManagerConfig={prependRowBuffer:n.prependRowBuffer,appendRowBuffer:n.appendRowBuffer};const r=Math.ceil(t/n.rowOffsetHeight);n.prependRowBuffer=r,n.appendRowBuffer=r,e.renderRows(),e.rowManager.jumpToPosition(e.scrollable.y)}restoreRowBuffer(e){e.rowManager.prependRowBuffer=this.oldRowManagerConfig.prependRowBuffer,e.rowManager.appendRowBuffer=this.oldRowManagerConfig.appendRowBuffer}async prepareComponent(e){const t=this,{client:n,columns:r,rowsRange:i,keepRegionSizes:s,enableDirectRendering:o}=e,{rowManager:a}=n,l=t.exportMeta={enableDirectRendering:o,totalWidth:0,totalHeight:0-(o?0:t.getVirtualScrollerHeight(n)),subGrids:{}};n.columns.forEach((e=>{r.includes(e.id)?e.show():e.hide()})),await new Promise((e=>n.requestAnimationFrame(e))),n.rowManager.rowCount>0&&(i===nm?l.firstVisibleDataIndex=a.rows[0].dataIndex:(l.firstVisibleDataIndex=a.firstVisibleRow.dataIndex,e.alignRows=!0),o||await n.scrollRowIntoView(n.store.getAt(l.firstVisibleDataIndex),{block:"start"}));const{element:c}=t;let d;t.cloneElement(n.element),t.prepareElement(e),o&&(l.fakeRow=d=new gm({cls:n.rowCls,rowManager:n.rowManager,grid:n,index:-10,dataIndex:-10})),n.eachSubGrid((e=>{var r,i,o;d&&(e.onAddRow({rows:[d],isExport:!0}),d.element.dataset.ownerCmp=n.id);const a=t.createPlaceholder(c.querySelector(`[id="${e.id}"]`),!1);let u;u=null!=s&&s[e.region]?e.element.offsetWidth:e.columns.visibleColumns.reduce(((e,t)=>("number"==typeof t.width?e+=t.width:e+=(n.hideHeaders?n.rowManager.rows[0].getCell(t.id):t.element).offsetWidth,e)),0),l.totalWidth+=u;const h=(null===(r=e.splitterElement)||void 0===r?void 0:r.offsetWidth)||0;l.totalWidth+=h,l.subGrids[e.region]={id:e.id,headerId:(null===(i=e.header)||void 0===i?void 0:i.id)||null,footerId:(null===(o=e.footer)||void 0===o?void 0:o.id)||null,rows:[],splitterWidth:h,placeHolder:a,width:u}}))}prepareExportElement(){const{element:e,exportMeta:t}=this;return Object.values(t.subGrids).forEach((({width:t,id:n,headerId:r,footerId:i})=>{[n,r,i].forEach((n=>{if(n){const r=e.querySelector(`[id="${n}"]`);r&&(r.style.width=`${t}px`,r.style.flex="")}}))})),e.innerHTML}async restoreComponent(e){this.exportMeta.fakeRow&&(this.exportMeta.fakeRow.destroy(),delete this.exportMeta.fakeRow)}async scrollRowIntoView(e,t){await e.scrollRowIntoView(e.store.getAt(t),{block:"start"}),await new Promise((e=>this.requestAnimationFrame(e)))}collectRow(e){const t=this.exportMeta.subGrids,n=/data-owner-cmp=".+?"/;Object.entries(e.elements).forEach((([r,i])=>{t[r].rows.push([i.outerHTML.replace(n,""),e.top,e.offsetHeight,new Map])}))}renderMergedCells(e,t,n,r){const{client:i}=e,{subGrids:s}=this.exportMeta,o=i.features.mergeCells.buildMergedCellsConfig(t,n,r);for(const e in s){const t=s[e],n=document.createElement("div");oa.sync({targetElement:n,domConfig:{children:o[e].children}}),n.childNodes.length&&(n.childNodes.forEach((e=>{const{syncId:t}=e.dataset,n=i.features.mergeCells.mergedRanges.find((e=>{var n;return(null===(n=e.cellElement)||void 0===n?void 0:n.parentNode.dataset.syncId)===t}));n&&(e.innerHTML=n.cellElement.outerHTML)})),t.mergedCellsHtml=[n.innerHTML])}}}mm.prototype.pagesExtractor=async function*(){throw new Error("Implement this method in a subclass")},mm._$name="Exporter";class pm extends mm{static get $name(){return"MultiPageExporter"}static get type(){return"multipage"}static get title(){return this.L("L{multipage}")}static get exportingPageText(){return"L{exportingPage}"}async stateNextPage({client:e,rowsRange:t,enableDirectRendering:n}){const{exportMeta:r}=this;++r.currentPage,++r.verticalPosition,delete r.lastExportedRowBottom,r.verticalPosition>=r.verticalPages&&(Object.assign(r,{verticalPosition:0,horizontalPosition:r.horizontalPosition+1,currentPageTopMargin:0,lastTop:0,lastRowIndex:t===rm?e.rowManager.firstVisibleRow.dataIndex:0}),delete r.lastRowDataIndex,n||await this.scrollRowIntoView(e,r.firstVisibleDataIndex,{block:"start"}))}async prepareComponent(e){await super.prepareComponent(e);const t=this,{exportMeta:n}=t,{client:r,headerTpl:i,footerTpl:s,alignRows:o,rowsRange:a,enableDirectRendering:l}=e,c=im[e.paperFormat],d=e.orientation===sm,u=d?c.width:c.height,h=d?c.height:c.width,g=t.inchToPx(u),m=t.inchToPx(h),p=a===rm,f=Math.ceil(n.totalWidth/g);let v=m;i&&(v-=t.measureElement(i({totalWidth:n.totalWidth,totalPages:-1,currentPage:-1}))),s&&(v-=t.measureElement(s({totalWidth:n.totalWidth,totalPages:-1,currentPage:-1})));let y,b,C=r.store.count;if(p?(C=t.getVisibleRowsCount(r),y=n.totalHeight+r.headerHeight+r.footerHeight+r.bodyHeight):y=n.totalHeight+r.headerHeight+r.footerHeight+r.scrollable.scrollHeight,o&&!p){const e=r.rowManager.rowOffsetHeight,t=Math.floor((v-r.headerHeight)/e),n=Math.floor(v/e),i=C-t;b=1+Math.ceil(i/n)}else b=Math.ceil(y/v);Object.assign(n,{paperWidth:u,paperHeight:h,pageWidth:g,pageHeight:m,horizontalPages:f,verticalPages:b,totalHeight:y,contentHeight:v,totalRows:C,totalPages:f*b,currentPage:0,verticalPosition:0,horizontalPosition:0,currentPageTopMargin:0,lastTop:0,lastRowIndex:p?r.rowManager.firstVisibleRow.dataIndex:0}),l||this.adjustRowBuffer(r)}async restoreComponent(e){await super.restoreComponent(e),e.enableDirectRendering||this.restoreRowBuffer(e.client)}async collectRows(e){const t=this,{exportMeta:n}=t,{client:r,alignRows:i,rowsRange:s}=e,{subGrids:o,currentPageTopMargin:a,verticalPosition:l,contentHeight:c,totalRows:d,lastRowDataIndex:u}=n,{rowManager:h}=r,{rows:g}=h,m=s===rm,p=r.hasActiveFeature("mergeCells");let f,v;v=m&&null!=u?u===g[g.length-1].dataIndex?g.length-1:g.findIndex((e=>e.dataIndex===u)):m?g.findIndex((e=>e.bottom>Math.ceil(r.scrollable.y))):g.findIndex((e=>e.bottom+a+r.headerHeight>0));const y=v;f=c-(m||0===l?0:g[v].top+a+r.headerHeight),0===l&&(f-=r.headerHeight);let b,C=0;for(;f>0;){const e=g[v];i&&f<e.offsetHeight?(C=-f,f=0,t.exportMeta.lastExportedRowBottom=g[v-1].bottom):(t.collectRow(e),f-=e.offsetHeight,b=e.dataIndex,(++v===g.length&&f>0||m&&v-y===d)&&(f=0))}if(p)for(const e in o){const t=o[e],n=r.subGrids[e].element.querySelectorAll(".b-grid-merged-cells");t.mergedCellsHtml=[];for(const e of n)t.mergedCellsHtml.push(e.outerHTML)}const w=g[v-1];if(w&&(n.exactGridHeight=w.bottom+r.footerContainer.offsetHeight+r.headerContainer.offsetHeight,n.lastRowDataIndex=w.dataIndex+1),await t.onRowsCollected(g.slice(y,v),e),m)n.exactGridHeight-=n.scrollableTopMargin=r.scrollable.y;else{const e=h.on("offsetrows",(({offset:e})=>C+=e));await t.scrollRowIntoView(r,b+1),e()}return C}async renderRows(e){const t=this,{exportMeta:n}=t,{client:r,alignRows:i,rowsRange:s}=e,{currentPageTopMargin:o,verticalPosition:a,contentHeight:l,totalRows:c,lastRowIndex:d,fakeRow:u}=n,{store:h}=r,g=r.hasActiveFeature("mergeCells"),m=s===rm;let p,f=d,{lastTop:v}=n;const y=f,b=[];p=l-(m||0===a?0:v+o+r.headerHeight),0===a&&(p-=r.headerHeight);let C,w,S=0;for(;p>0;)u.render(f,h.getAt(f),!0,!1,!0),i&&p<u.offsetHeight?(S=-p,p=0,t.exportMeta.lastExportedRowBottom=v):(w=v,C=f,v=u.translate(v),p-=u.offsetHeight,t.collectRow(u),b.push({top:u.top,bottom:u.bottom,offsetHeight:u.offsetHeight,dataIndex:u.dataIndex}),(++f===h.count&&p>0||m&&f-y===c)&&(p=0));return g&&t.renderMergedCells(e,y,f,b),n.lastRowIndex=i?f:C,n.lastTop=i?v:w,u&&(n.exactGridHeight=u.bottom+r.footerContainer.offsetHeight+r.headerContainer.offsetHeight),await t.onRowsCollected(b,e),S}async buildPage(e){const t=this,{exportMeta:n}=t,{client:r,headerTpl:i,footerTpl:s,enableDirectRendering:o}=e,{totalWidth:a,totalPages:l,currentPage:c,subGrids:d}=n;let u,h,g;return Object.values(d).forEach((e=>e.rows=[])),e.rowsRange===nm&&(n.totalHeight=r.height-r.bodyHeight+r.scrollable.scrollHeight-t.getVirtualScrollerHeight(r)),i&&(u=t.prepareHTML(i({totalWidth:a,totalPages:l,currentPage:c}))),s&&(h=t.prepareHTML(s({totalWidth:a,totalPages:l,currentPage:c}))),g=o?await t.renderRows(e):await t.collectRows(e),{html:t.buildPageHtml(e),header:u,footer:h,offset:g}}async onRowsCollected(){}buildPageHtml(){const{subGrids:e}=this.exportMeta;let t=this.prepareExportElement();return Object.values(e).forEach((({placeHolder:e,rows:n,mergedCellsHtml:r})=>{const i=e.outerHTML;let s=n.reduce(((e,t)=>e+t[0]),"");null!=r&&r.length&&(s+=`<div class="b-grid-merged-cells-container">${r.join("")}</div>`),t=t.replace(i,s)})),t}prepareExportElement(){const{element:e,exportMeta:t}=this;return t.scrollableTopMargin&&(e.querySelector(".b-grid-vertical-scroller").style.marginTop=`-${t.scrollableTopMargin}px`),super.prepareExportElement()}}pm.prototype.pagesExtractor=async function*(e){const t=this,{exportMeta:n,stylesheets:r}=t,{totalWidth:i,totalPages:s,paperWidth:o,paperHeight:a,contentHeight:l}=n;let c;for(;(c=n.currentPage)<s;){t.trigger("exportStep",{text:t.L(pm.exportingPageText,{currentPage:c,totalPages:s}),progress:Math.round((c+1)/s*90)});const{html:d,header:u,footer:h,offset:g}=await t.buildPage(e),m=[...r,`\n                <style>\n                    #${e.client.id} {\n                        height: ${n.exactGridHeight}px !important;\n                        width: ${i}px !important;\n                    }\n                    .b-export-body .b-export-viewport {\n                        margin-inline-start : ${-o*n.horizontalPosition}in;\n                        margin-top  : ${n.currentPageTopMargin}px;\n                    }\n                </style>\n            `];n.currentPageTopMargin-=l+g,await t.stateNextPage(e),yield{html:t.pageTpl({html:d,header:u,footer:h,styles:m,paperWidth:o,paperHeight:a})}}},pm._$name="MultiPageExporter";class fm extends mm{static get $name(){return"MultiPageVerticalExporter"}static get type(){return"multipagevertical"}static get title(){return this.L("L{multipagevertical}")}static get exportingPageText(){return"L{exportingPage}"}async stateNextPage({client:e}){const{exportMeta:t}=this,{totalRows:n,processedRows:r,totalPages:i}=t;++t.currentPage,++t.verticalPosition,t.currentPage===i&&r.size!==n&&(++t.totalPages,++t.verticalPages)}estimateTotalPages(e){const t=this,{exportMeta:n}=t,{client:r,headerTpl:i,footerTpl:s,alignRows:o,rowsRange:a,repeatHeader:l,enableDirectRendering:c}=e,{pageWidth:d,pageHeight:u,totalWidth:h}=n,g=t.getScaleValue(d,h);let m,p=0-t.getVirtualScrollerHeight(r)+r.height-r.bodyElement.offsetHeight+r.scrollable.scrollHeight,f=u/g,v=r.store.count,y=0,b=p;if(i&&(f-=t.measureElement(i({totalWidth:h,totalPages:-1,currentPage:-1}))),s&&(f-=t.measureElement(s({totalWidth:h,totalPages:-1,currentPage:-1}))),l&&(f-=r.headerHeight+r.footerHeight,p-=r.headerHeight+r.footerHeight),a===rm){const e=r.rowManager,i=e.firstVisibleRow,s=e.lastVisibleRow;c||(y=i.top),v=t.getVisibleRowsCount(r),c?(p=r.headerHeight+r.footerHeight+s.bottom-i.top,b=s.bottom-i.top):b=p=p-r.scrollable.scrollHeight+s.bottom-i.top,n.lastRowIndex=i.dataIndex,n.finishRowIndex=s.dataIndex}else n.finishRowIndex=r.store.count-1;if(o&&!l&&a!==rm){const e=r.rowManager.rowOffsetHeight,t=Math.floor((f-r.headerHeight)/e),n=Math.floor(f/e),i=v-t;m=1+Math.ceil(i/n)}else m=Math.ceil(b/f);Object.assign(n,{scale:g,contentHeight:f,totalRows:v,totalHeight:p,verticalPages:m,initialScroll:y,horizontalPages:1,totalPages:m})}async prepareComponent(e){await super.prepareComponent(e);const t=this,{exportMeta:n}=t,{client:r}=e,i=im[e.paperFormat],s=e.orientation===sm,o=s?i.width:i.height,a=s?i.height:i.width,l=t.inchToPx(o),c=t.inchToPx(a);Object.assign(n,{paperWidth:o,paperHeight:a,pageWidth:l,pageHeight:c,horizontalPages:1,currentPage:0,verticalPosition:0,horizontalPosition:0,currentPageTopMargin:0,lastTop:0,lastRowIndex:0,processedRows:new Set}),t.estimateTotalPages(e),e.enableDirectRendering||t.adjustRowBuffer(r)}async restoreComponent(e){await super.restoreComponent(e),e.enableDirectRendering||this.restoreRowBuffer(e.client)}async collectRows(e){const t=this,{exportMeta:n}=t,{client:r,alignRows:i,repeatHeader:s}=e,{subGrids:o,currentPageTopMargin:a,verticalPosition:l,totalRows:c,contentHeight:d}=n,u=s?0:r.headerHeight,{rowManager:h}=r,{rows:g}=h,m=e.rowsRange===rm,p=r.hasActiveFeature("mergeCells");let f,v=m?g.findIndex((e=>e.bottom>r.scrollable.y)):g.findIndex((e=>e.bottom+a+u>0));const y=v;f=d-(0===l?0:g[v].top+a+u),0===l&&(f-=u);let b,C=0;for(;f>0;){const e=g[v];i&&f<e.offsetHeight?(C=-f,f=0):(t.collectRow(e),f-=e.offsetHeight,f>0&&n.processedRows.add(e.dataIndex),b=e.dataIndex,(++v===g.length&&f>0||m&&v-y===c)&&(f=0))}if(p)for(const e in o){const t=o[e],n=r.subGrids[e].element.querySelectorAll(".b-grid-merged-cells");t.mergedCellsHtml=[];for(const e of n)t.mergedCellsHtml.push(e.outerHTML)}const w=g[v-1];if(w&&(n.exactGridHeight=w.bottom+r.footerContainer.offsetHeight+r.headerContainer.offsetHeight),await t.onRowsCollected(g.slice(y,v),e),m)n.scrollableTopMargin=r.scrollable.y;else{const e=h.on("offsetrows",(({offset:e})=>C+=e));await t.scrollRowIntoView(r,b+1),e()}return C}async renderRows(e){const t=this,{exportMeta:n}=t,{client:r,alignRows:i,repeatHeader:s}=e,{currentPageTopMargin:o,verticalPosition:a,totalRows:l,contentHeight:c,lastRowIndex:d,finishRowIndex:u,fakeRow:h}=n,g=s?0:r.headerHeight,{store:m}=r,p=r.hasActiveFeature("mergeCells"),f=e.rowsRange===rm;let v,y=d,{lastTop:b}=n;const C=y,w=[];v=c-(0===a?0:b+o+g),0===a&&(v-=g);let S,D,E=0;for(;v>0;)h.render(y,m.getAt(y),!0,!1,!0),i&&v<h.offsetHeight?(E=-v,v=0):(D=b,S=y,b=h.translate(b),v-=h.offsetHeight,t.collectRow(h),w.push({top:h.top,bottom:h.bottom,offsetHeight:h.offsetHeight,dataIndex:h.dataIndex}),v>0&&n.processedRows.add(y),(y===u||++y-C===l&&f)&&(v=0));return p&&t.renderMergedCells(e,C,y,w),n.lastRowIndex=S,n.lastTop=D,h&&(n.exactGridHeight=h.bottom+r.footerContainer.offsetHeight+r.headerContainer.offsetHeight),await t.onRowsCollected(w,e),E}async buildPage(e){const t=this,{exportMeta:n}=t,{client:r,headerTpl:i,footerTpl:s,enableDirectRendering:o}=e,{totalWidth:a,totalPages:l,currentPage:c,subGrids:d}=n;let u,h,g;return Object.values(d).forEach((e=>e.rows=[])),e.rowsRange===nm&&(n.totalHeight=r.headerHeight+r.footerHeight+r.scrollable.scrollHeight,o||(n.totalHeight-=t.getVirtualScrollerHeight(r))),i&&(u=t.prepareHTML(i({totalWidth:a,totalPages:l,currentPage:c}))),s&&(h=t.prepareHTML(s({totalWidth:a,totalPages:l,currentPage:c}))),g=o?await t.renderRows(e):await t.collectRows(e),{html:t.buildPageHtml(e),header:u,footer:h,offset:g}}async onRowsCollected(){}buildPageHtml(){const{subGrids:e}=this.exportMeta;let t=this.prepareExportElement();return Object.values(e).forEach((({placeHolder:e,rows:n,mergedCellsHtml:r})=>{const i=e.outerHTML;let s=n.reduce(((e,t)=>e+t[0]),"");null!=r&&r.length&&(s+=`<div class="b-grid-merged-cells-container">${r.join("")}</div>`),t=t.replace(i,s)})),t}}fm.prototype.pagesExtractor=async function*(e){const t=this,{exportMeta:n,stylesheets:r}=t,{totalWidth:i,paperWidth:s,paperHeight:o,contentHeight:a,scale:l,initialScroll:c}=n;let d,{totalPages:u}=n;for(;(d=n.currentPage)<u;){t.trigger("exportStep",{text:t.L(fm.exportingPageText,{currentPage:d,totalPages:u}),progress:Math.round((d+1)/u*90)});const{html:h,header:g,footer:m,offset:p}=await t.buildPage(e),f=[...r,`\n                <style>\n                    #${e.client.id} {\n                        width: ${i}px !important;\n                    }\n                    .b-export .b-export-content {\n                        transform: scale(${l});\n                        transform-origin: top left;\n                        height: auto;\n                    }\n                </style>\n            `];if(e.repeatHeader){const t=n.exactGridHeight?`${n.exactGridHeight+n.currentPageTopMargin}px`:"100%";f.push(`\n                <style>\n                    #${e.client.id} {\n                        height: ${t} !important;\n                    }\n                    .b-export .b-export-content {\n                        height: ${100/l}%;\n                    }\n                    .b-export-body {\n                        height: 100%;\n                        display: flex;\n                    }\n                    .b-export-viewport {\n                        height: 100%;\n                    }\n                    .b-grid-vertical-scroller {\n                        margin-top: ${n.currentPageTopMargin-c}px;\n                    }\n                </style>\n                `)}else{const t=n.exactGridHeight||a-n.currentPageTopMargin;f.push(`\n                <style>\n                    #${e.client.id} {\n                        height: ${t}px !important;\n                    }\n                    .b-export-body {\n                        overflow: hidden;\n                    }\n                    .b-export .b-export-content {\n                        height: ${100/l}%;\n                    }\n                    .b-export-body .b-export-viewport {\n                        margin-top: ${n.currentPageTopMargin}px;\n                    }\n                    .b-grid-vertical-scroller {\n                        margin-top: -${c}px;\n                    }\n                </style>\n                `)}n.currentPageTopMargin-=a+p,await t.stateNextPage(e),({totalPages:u}=n),yield{html:t.pageTpl({html:h,header:g,footer:m,styles:f,paperWidth:s,paperHeight:o})}}},fm._$name="MultiPageVerticalExporter";class vm extends mm{static get $name(){return"SinglePageExporter"}static get type(){return"singlepage"}static get title(){return this.localize("L{singlepage}")}static get defaultConfig(){return{centerContentHorizontally:!1}}async prepareComponent(e){await super.prepareComponent(e),Object.assign(this.exportMeta,{verticalPages:1,horizontalPages:1,totalPages:1,currentPage:0,verticalPosition:0,horizontalPosition:0})}async onRowsCollected(){}positionRows(e,t){if(t.enableDirectRendering)return e.map((e=>e[0]));{let t=0;return e.map((([e,,n])=>{const r=e.replace(/translate\(\d+px, \d+px\)/,`translate(0px, ${t}px)`);return t+=n,r}))}}async collectRows(e){const t=this,{client:n}=e,{rowManager:r,store:i}=n,s=n.hasActiveFeature("mergeCells"),{subGrids:o}=t.exportMeta,a=e.rowsRange===rm&&i.count?t.getVisibleRowsCount(n):i.count;let{totalHeight:l}=t.exportMeta,c=0,d=-1;if(r.rows.length>0){if(e.rowsRange===rm&&(d=r.firstVisibleRow.dataIndex-1),s)for(const e of Object.values(o))e.mergedCellsHtml=[];for(;c<a;){const i=r.rows,u=i[i.length-1],h=c;if(i.forEach((e=>{e.dataIndex>d&&c<a&&(++c,l+=e.offsetHeight,t.collectRow(e))})),s)for(const e in o){const t=o[e],r=n.subGrids[e].element.querySelectorAll(".b-grid-merged-cells");for(const e of r)t.mergedCellsHtml.push(e.outerHTML)}const g=i.findIndex((e=>e.dataIndex===d+1)),m=g+(c-h);await t.onRowsCollected(i.slice(g,m),e),c<a&&(d=u.dataIndex,await t.scrollRowIntoView(n,d+1))}}return l}async renderRows(e){const t=this,{client:n,rowsRange:r}=e,{rowManager:i,store:s}=n,o=n.hasActiveFeature("mergeCells"),a=r===rm;let{totalHeight:l}=t.exportMeta;if(s.count){const{fakeRow:n}=t.exportMeta,{firstVisibleRow:r}=i,c=a?r.dataIndex:0,d=a?i.lastVisibleRow.dataIndex:s.count-1,u=[];let h=0;if(n.cells.length){for(let e=c;e<=d;e++)n.render(e,s.getAt(e),!0,!1,!0),h=n.translate(h),t.collectRow(n),u.push({top:n.top,bottom:n.bottom,offsetHeight:n.offsetHeight,dataIndex:n.dataIndex});await t.onRowsCollected(u,e)}l+=h,o&&t.renderMergedCells(e,c,d,u)}return l}buildPageHtml(e){const t=this,{subGrids:n}=t.exportMeta;let r=t.prepareExportElement();return Object.values(n).forEach((({placeHolder:n,rows:i,mergedCellsHtml:s})=>{const o=n.outerHTML;let a=t.positionRows(i,e).join("");null!=s&&s.length&&(a+=`<div class="b-grid-merged-cells-container">${s.join("")}</div>`),r=r.replace(o,a)})),r}}vm.prototype.pagesExtractor=async function*(e){const t=this,{client:n}=e,{totalWidth:r}=t.exportMeta,i=t.stylesheets,s=e.orientation===sm,o=im[e.paperFormat],a=s?o.width:o.height,l=s?o.height:o.width;let c,d,u;e.enableDirectRendering?(c=await t.renderRows(e),c+=n.headerHeight+n.footerHeight):(c=await t.collectRows(e),c+=n.height-n.bodyHeight);const h=t.buildPageHtml(e),g=c;e.headerTpl&&(d=t.prepareHTML(e.headerTpl({totalWidth:r})),c+=t.measureElement(d)),e.footerTpl&&(u=t.prepareHTML(e.footerTpl({totalWidth:r})),c+=t.measureElement(u));const m=Math.min(1,t.getScaleValue(t.inchToPx(a),r)),p=Math.min(1,t.getScaleValue(t.inchToPx(l),c)),f=Math.min(m,p);i.push(`<style>\n                #${n.id} {\n                    height: ${g}px !important;\n                    width: ${r}px !important;\n                }\n                .b-export-content {\n                    ${t.centerContentHorizontally?"left: 50%;":""}\n                    transform: scale(${f}) ${t.centerContentHorizontally?"translateX(-50%)":""};\n                    transform-origin: top left;\n                    height: ${1===f?"inherit":"auto !important"};\n                }\n            </style>`),y.isIE11&&i.push(`<style>\n                .b-export-body {\n                   min-height: ${g}px !important;\n                }\n         </style>`),yield{html:t.pageTpl({html:h,header:d,footer:u,styles:i,paperWidth:a,paperHeight:l})}},vm._$name="SinglePageExporter";class ym extends Wr{static get $name(){return"PdfExport"}static get configurable(){return{dialogClass:um,exportServer:void 0,exportDialog:{value:!0,$config:["lazy"]},fileName:null,fileFormat:"pdf",clientURL:null,paperFormat:"A4",orientation:"portrait",rowsRange:"all",alignRows:!1,repeatHeader:!1,keepRegionSizes:null,pagesPerRequest:0,exporterConfig:null,exporterType:"singlepage",exporters:[vm,pm,fm],translateURLsToAbsolute:!0,keepPathName:!0,openAfterExport:!0,sendAsBinary:!1,openInNewTab:!1,headerTpl:null,footerTpl:null,fetchOptions:null,exportMask:"L{Generating pages}",exportProgressMask:"L{Waiting for response from server}",showErrorToast:!0,localizableProperties:["exportMask","exportProgressMask"],filterStyles:e=>e,enableDirectRendering:!0}}updateEnableDirectRendering(e){e||K.deprecate("Grid","6.0.0","Indirect rendering is deprecated")}doDestroy(){var e;null===(e=this.exportDialog)||void 0===e||e.destroy(),this.exportersMap.forEach((e=>e.destroy())),super.doDestroy()}get currentExportPromise(){return this._currentExportPromise}set currentExportPromise(e){this._currentExportPromise=e}get exportersMap(){return this._exportersMap||(this._exportersMap=new Map)}getExporter(e={}){const t=this,{exportersMap:n}=t,{type:r}=e;let i;if(n.has(r))i=n.get(r),Object.assign(i,e);else{const s=this.exporters.find((e=>e.type===r));if(!s)throw new Error(`Exporter type ${r} is not found. Make sure you've configured it`);delete(e=sn.clone(e)).type,i=new s(e),i.relayAll(t),n.set(r,i)}return i}buildRequest(e,t){return{html:JSON.stringify(e),fileFormat:t.fileFormat,format:t.paperFormat,orientation:t.orientation}}buildExportConfig(e={}){const{client:t,exportServer:n,clientURL:r,fileFormat:i,fileName:s,paperFormat:o,rowsRange:a,alignRows:l,repeatHeader:c,keepRegionSizes:d,orientation:u,translateURLsToAbsolute:h,keepPathName:g,sendAsBinary:m,headerTpl:p,footerTpl:f,filterStyles:v,enableDirectRendering:y}=this;e.columns||(e.columns=t.columns.visibleColumns.filter((e=>e.exportable)).map((e=>e.id)));const b=sn.assign({client:t,exportServer:n,clientURL:r,fileFormat:i,paperFormat:o,rowsRange:a,alignRows:l,repeatHeader:c,keepRegionSizes:d,orientation:u,translateURLsToAbsolute:h,keepPathName:g,sendAsBinary:m,headerTpl:p,footerTpl:f,enableDirectRendering:y,exporterType:this.exporterType,fileName:s||t.$$name},e);if(b.columns=e.columns.slice(),"multipagevertical"!==b.exporterType&&(b.repeatHeader=!1),!("alignRows"in e)&&e.repeatHeader&&(b.alignRows=!0),!("keepRegionSizes"in e)&&!b.keepRegionSizes){const e=[],n={};t.eachSubGrid((t=>t.collapsed&&e.push(t.region))),e.length&&(t.eachSubGrid((t=>{e.includes(t.region)||(n[t.region]=!0)})),b.keepRegionSizes=n)}return b.exporterConfig=sn.assign({type:b.exporterType,translateURLsToAbsolute:b.translateURLsToAbsolute,keepPathName:b.keepPathName,filterStyles:v},b.exporterConfig||{}),delete b.exporterType,delete b.translateURLsToAbsolute,delete b.keepPathName,b}async export(e={}){const t=this,{client:n,pagesPerRequest:r}=t;let i;if(e=t.buildExportConfig(e),!1!==n.trigger("beforePdfExport",{config:e})){n.isExporting=!0,n.mask(t.exportMask);try{const a=t.getExporter(e.exporterConfig);if(0===r){var s;const r=await a.export(e);if(t.isDestroying)return;null===(s=t.exportDialog)||void 0===s||s.close(),n.unmask(),t.trigger("exportStep",{progress:90,text:t.exportProgressMask,contentGenerated:!0});const o=t.receiveExportContent(r,e);t.toast=t.showLoadingToast(o);const l=await o;i={response:l},await t.processExportContent(l,e)}}catch(e){throw i=e instanceof Response?{response:e}:{error:e},e}finally{var o;t.toast&&!t.toast.isDestroying&&t.toast.hide(),t.isDestroying||(null===(o=t.exportDialog)||void 0===o||o.close(),n.unmask(),t.showErrorToast&&(i.error?"AbortError"!==i.error.name&&Gc.show({html:t.L("L{Export failed}"),rootElement:t.rootElement}):i.response.ok||Gc.show({html:t.L("L{Server error}"),rootElement:t.rootElement})),n.trigger("pdfExport",i),n.isExporting=!1)}}return i}receiveExportContent(e,t){return st.fetch(t.exportServer,Object.assign({method:"POST",credentials:"omit",headers:{"Content-Type":"application/json"},body:JSON.stringify({html:e,orientation:t.orientation,format:t.paperFormat,fileFormat:t.fileFormat,fileName:t.fileName,clientURL:t.clientURL,sendAsBinary:t.sendAsBinary})},this.fetchOptions))}async processExportContent(e,t){const n=this;if(e.ok&&n.openAfterExport){const r=(e=e.clone()).headers.get("content-type");if(r.match(/application\/octet-stream/)){const r=am[t.fileFormat],i=await n.responseBlobToObjectURL(e,r);n.getDownloadLink(t.fileName,i).click()}else if(r.match(/application\/json/)){const r=await e.json();r.success?n.getDownloadLink(t.fileName,r.url).click():Gc.show({html:r.msg,rootElement:this.rootElement})}}}async responseBlobToObjectURL(e,t){const n=await e.blob();return URL.createObjectURL(n.slice(0,n.size,t))}getDownloadLink(e,t){const n=document.createElement("a");return n.download=e,n.href=t,this.openInNewTab&&(n.target="_blank"),n}get defaultExportDialogConfig(){return sn.copyProperties({},this,["client","exporters","exporterType","orientation","fileFormat","paperFormat","alignRows","rowsRange","repeatHeader"])}changeExportDialog(e,t){const n=this;if(null==t||t.destroy(),e){const t=n.dialogClass.mergeConfigs({rootElement:n.rootElement,client:n.client,items:{rowsRangeField:{value:n.rowsRange},exporterTypeField:{value:n.exporterType},orientationField:{value:n.orientation},paperFormatField:{value:n.paperFormat},repeatHeaderField:{value:n.repeatHeader},fileFormatField:{value:n.fileFormat},alignRowsField:{checked:n.alignRows}}},n.defaultExportDialogConfig,e);(e=n.dialogClass.new(t)).on({export:n.onExportButtonClick,thisObj:n})}return e}async showExportDialog(){return this.exportDialog.show()}onExportButtonClick({values:e}){const t=this,n=t.exportDialog.mask({progress:0,maxProgress:100,text:t.exportMask}),r=t.on({exportstep({progress:e,text:i,contentGenerated:s}){s?(t.exportDialog.unmask(),r()):(n.progress=e,null!=i&&(n.text=i))}});t.currentExportPromise=t.export(e),t.currentExportPromise.catch((()=>{})).finally((()=>{var e;r(),null===(e=t.exportDialog)||void 0===e||e.unmask(),t.currentExportPromise=null}))}showLoadingToast(e){const t=Gc.show({timeout:0,showProgress:!1,rootElement:this.rootElement,html:`\n    <span class="b-mask-icon b-icon b-icon-spinner"></span>\n    <span>${this.L("L{Waiting for response from server}")}</span>\n    <button class="b-button">${this.L("L{Click to abort}")}</button>`});return _n.on({element:t.element,click(){var t;null===(t=e.abort)||void 0===t||t.call(e)}}),t}}ym._$name="PdfExport",vg.registerFeature(ym,!1,"Grid");class bm extends Te{static get defaultConfig(){return{target:null,defaultColumnWidth:100,exportDateAsInstance:!0,showGroupHeader:!0,columns:null,indent:!0,indentationSymbol:"    "}}export(e={}){const t=this;return e=sn.assign({},t.config,e),t.normalizeColumns(e),t.generateExportData(e)}generateExportData(e){const t=this.generateColumns(e);return{rows:this.generateRows(e),columns:t}}normalizeColumns(e){const t=e.columns||this.target.columns.visibleColumns.filter((e=>!1!==e.exportable));e.columns=t.map((e=>"string"==typeof e?this.target.columns.find((t=>t.field===e))||{field:e}:e))}generateColumns(e){return e.columns.map((t=>this.processColumn(t,e)))}generateRows(e){const{columns:t,rows:n}=e;if(0===t.length||0===(null==n?void 0:n.length))return[];const r=this,{target:i}=r;return(n||i.store).map((n=>r.processRecord(n,t,e))).filter((e=>null==e?void 0:e.length))}getColumnType(e,t=this.target.store){let n=e.exportedType||"object";if(void 0===e.exportedType&&e.field){const r=t.modelClass.getFieldDefinition(e.field);r&&"auto"!==r.type&&(n=r.type)}return n}processColumn(e,t){const{target:n}=this,{defaultColumnWidth:r}=t;let{field:i,text:s,width:o,minWidth:a}=e;if(i in n.store.modelClass.fieldMap||(i=""),!s||!o){const e=n.columns.find((e=>e.field===i));s||(s=e&&e.text||i),null==o&&(o=e&&e.width||r)}return o=Math.max(o||r,a||r),{field:i,value:s,width:o,type:this.getColumnType(e)}}processRecord(e,t,n){const{target:r}=this,{showGroupHeader:i,indent:s,indentationSymbol:o}=n;let a;return e?e.isSpecialRow?i&&e.meta.groupRowFor&&(a=t.map((t=>r.features.group.buildGroupHeader({cellElement:Mr.createElement(),grid:r,record:e,column:t})))):a=t.map((t=>{var i;let a=null!==(i=t.field)&&void 0!==i&&i.includes(".")?e.get(t.field):e[t.field];const l=t.renderer||t.defaultRenderer;return!l||a&&t.isDateColumn&&n.exportDateAsInstance||(a=l.call(t,{value:a,record:e,column:t,grid:r,isExport:!0})),s&&t.tree&&(a=`${o.repeat(e.childLevel)}${a}`),a})):a=t.map((()=>"")),a}}bm._$name="TableExporter";class Cm{constructor(e){this._value=e}get value(){return this._value}toString(){return Boolean(this.value)?"✓":""}}Cm._$name="BooleanUnicodeSymbol";class wm extends Wr{static get $name(){return"ExcelExporter"}static get defaultConfig(){return{filename:null,dateFormat:"YYYY-MM-DD",exporterClass:bm,exporterConfig:null,zipcelx:null,convertEmptyValueToEmptyString:!0}}processValue(e){return null==e||Number.isNaN(e)||"function"==typeof e||"object"==typeof e&&"[object Object]"===String(e)?"":e}generateExportData(e){const t=this,{rows:n,columns:r}=t.exporter.export(e.exporterConfig);return{rows:n.map((n=>n.map(((n,i)=>{var s;return n instanceof Date?n=en.format(n,e.dateFormat):"boolean"==typeof n&&(n=new Cm(n)),t.convertEmptyValueToEmptyString&&(n=t.processValue(n)),{value:n,type:"number"===(null===(s=r[i])||void 0===s?void 0:s.type)?"number":"string"}})))),columns:r.map((e=>{let{field:t,value:n,width:r,type:i}=e;return i="string",{field:t,value:n,width:r,type:i}}))}}export(e={}){const t=this,n=t.zipcelx||globalThis.zipcelx;if(!n)throw new Error('ExcelExporter: "zipcelx" library is required');if(t.disabled)return;(e=sn.assign({},t.config,e)).filename||(e.filename=t.client.$$name);const{filename:r}=e,{rows:i,columns:s}=t.generateExportData(e);return n({filename:r,sheet:{data:[s].concat(i),cols:s}})}construct(e,t){super.construct(e,t),this.zipcelx||"undefined"!=typeof zipcelx&&(this.zipcelx=globalThis.zipcelx)}get exporter(){const e=this;return e._exporter||(e._exporter=e.exporterClass.new({target:e.client},e.exporterConfig))}}wm._$name="ExcelExporter",vg.registerFeature(wm,!1,"Grid");class Sm extends Ka{static get $name(){return"Bar"}static get type(){return"gridbar"}static get defaultConfig(){return{htmlCls:"",scrollable:{overflowX:"hidden-scroll"}}}get columns(){return this._columns||this.subGrid.columns}set columns(e){this._columns=e}fixCellWidths(){const e=this,{hasFlex:t}=e.columns;let n;e.columns.traverse((t=>{const r=e.getBarCellElement(t.id),i=Mr.setLength(t.width),s=Mr.setLength(t.minWidth),o=Mr.setLength(t.maxWidth);if(r){if(n=i,r.style.maxWidth=o,t.isParent&&null==t.width&&null==t.flex){const e=t.children.reduce(((e,t)=>e+(!t.hidden&&t.flex||0)),0);r.style.flex=e>0?`${e} 0 auto`:"",r.style.minWidth=null,e>0&&t.traverse((e=>e.data.minWidth=null))}else if(parseInt(t.minWidth)>=0&&(r.style.minWidth=s),r.style.flex=r.style.flexBasis=r.style.width="",t.flex)!isNaN(parseInt(t.flex))&&t.children?r.style.flex=`${t.flex} 0 auto`:r.style.flex=t.flex;else if(parseInt(t.width)>=0){const s=t.parent;!e.isHeader||s.isRoot||s.width?r.style.flexBasis=n:r.style.width=i}t.height>=0&&(r.style.height=Mr.setLength(t.height))}})),e.scrollable.element.classList.toggle("b-has-flex",t)}getLrPadding(e){if(!this.cellLrPadding){const t=e.ownerDocument.defaultView.getComputedStyle(e);this.cellLrPadding=parseInt(t.getPropertyValue("padding-left"))+parseInt(t.getPropertyValue("padding-right"))+parseInt(t.getPropertyValue("border-left-width"))+parseInt(t.getPropertyValue("border-right-width"))}return this.cellLrPadding}getBarCellElement(e){return this.element.querySelector(`[data-column-id="${e}"]`)}}Sm.initClass(),Sm._$name="Bar";class Dm extends Sm{static get $name(){return"Footer"}static get type(){return"gridfooter"}get subGrid(){return this._subGrid}set subGrid(e){this._subGrid=this.owner=e}refreshContent(){this.element.firstElementChild.innerHTML=this.contentTemplate(),this.fixFooterWidths()}onPaint({firstPaint:e}){e&&this.refreshContent()}template(){const e=this.subGrid.region;return Yc.tpl`
            <div class="b-grid-footer-scroller b-grid-footer-scroller-${e}" role="presentation">
                <div data-reference="footersElement" class="b-grid-footers b-grid-footers-${e}" data-region="${e}" role="presentation"></div>
            </div>
        `}get overflowElement(){return this.footersElement}getFooter(e){return this.getBarCellElement(e)}contentTemplate(){return this.columns.visibleColumns.map((e=>Yc.tpl`
                <div
                    class="b-grid-footer ${e.align?`b-grid-footer-align-${e.align}`:""} ${e.cls||""}"
                    data-column="${e.field||""}" data-column-id="${e.id}" data-all-index="${e.allIndex}"
                    role="presentation">
                    ${e.footerText||""}
                </div>`)).join("")}fixFooterWidths(){this.fixCellWidths()}}Dm.initClass(),Dm._$name="Footer";class Em extends Wr{static get pluginConfig(){return{chain:["destroy"],assign:["rowHeight","topRow","bottomRow","firstVisibleRow","lastVisibleRow","firstFullyVisibleRow","lastFullyVisibleRow","getRowById","getRecordCoords","getRow","getRowFor","getRowFromElement"]}}static get defaultConfig(){return{prependRowBuffer:5,appendRowBuffer:5,rowHeight:null,fixedRowHeight:null,autoHeight:!1}}static get properties(){return{idMap:{},topIndex:0,lastScrollTop:0,_rows:[],heightMap:new Map,totalKnownHeight:0,_totalHeight:0,averageRowHeight:0,scrollTargetRecordId:null,refreshDetails:{topRowIndex:0,topRowTop:0}}}construct(e){e.grid._rowManager=this,super.construct(e.grid,e)}doDestroy(){this._rows.forEach((e=>e.destroy())),super.doDestroy()}initWithHeight(e,t=!1){const n=this;return n.autoHeight&&(e=n.store.allCount*n.preciseRowOffsetHeight),n.viewHeight=e,n.calculateRowCount(t),e}reinitialize(e=!1){const t=this;t.calculateRowCount(!1,!0,!0),t.topIndex+t.rowCount-1>t.store.count&&(e=!0);const n=t.topRow&&!e?t.topRow.top:0;t.scrollTargetRecordId=null,e&&(t.topIndex=t.lastScrollTop=0);const{topRow:r}=t;r&&(r.dataIndex=t.topIndex,r.setTop(n,!0)),t.estimateTotalHeight(),t.renderFromRow(r)}matchRowCount(e=!1){const t=this,{rows:n,grid:r}=t,i=n.length,s=i-t.rowCount;if(s)if(s<0){const s=[];for(let e=i,o=i?n[i-1].dataIndex+1:0;e<t.rowCount;e++,o++)s.push(new gm({cls:r.rowCls,rowManager:t,grid:r,index:e,dataIndex:o}));n.push.apply(n,s),t.trigger("addRows",{rows:s}),e||t.renderFromRow(n[Math.max(0,i-1)])}else{var o;const{focusedCell:e}=r,l=null!=(null==e?void 0:e.id)&&(null==e||null===(o=e.cell)||void 0===o?void 0:o.contains(Mr.getActiveElement(r))),c=n.splice(i-s,s);var a;l&&(s===i?r.onFocusedRowDerender():(null===(a=t.getRowFor(e._record))||void 0===a?void 0:a.index)>=n.length&&n[n.length-1].cells[e.columnIndex].focus()),t.trigger("removeRows",{rows:c}),c.forEach((e=>e.destroy()))}}calculateRowCount(e=!1,t=!0,n=!1){var r;const i=this,{store:s}=i,o=Math.ceil(i.viewHeight/i.minRowOffsetHeight),a=o+i.prependRowBuffer+i.appendRowBuffer;if(null===(r=i.grid.columns)||void 0===r||!r.count||isNaN(o))return i.rowCount=0,0;if(a<i.rowCount&&!t)return i.rowCount;if(i.visibleRowCount=o,i.rowCount=Math.min(s.count,a),!e){var l;if(i.rows&&i.rowCount!==i.rows.length){if(i.matchRowCount(n),(null===(l=i.bottomRow)||void 0===l?void 0:l.dataIndex)>=s.count&&0!==i.topRow.dataIndex){const e=i.bottomRow.dataIndex-s.count+1;for(const t of i.rows)t.dataIndex-=e;i.topIndex-=e}}else i.rowCount||i.trigger("changeTotalHeight",{totalHeight:i.totalHeight});i.grid.toggleEmptyText()}return i.rowCount}removeAllRows(){const e=this,{topRow:t}=e,n=t?e.refreshDetails={topRowIndex:t.dataIndex,topRowTop:t.top}:e.refreshDetails,r=e.rows.slice();return e.trigger("removeRows",{rows:r}),e.rows.forEach((e=>e.destroy())),e.rows.length=0,e.idMap={},n}setPosition(e){const{topRow:t}=this,{topRowIndex:n,topRowTop:r}=e;t.setTop(r),t.dataIndex=n}get store(){return this.client.store}get rows(){return this._rows}getRow(e){if(this.rowCount)return this.rows[e-this.topIndex]}getRowById(e){return e&&e.isModel&&(e=e.id),this.idMap[e]}getRowFromElement(e){return(e=e.closest(".b-grid-row"))&&this.getRow(e.dataset.index)}getRowAt(e,t=!1){return t||(e-=xn.from(this.grid.bodyContainer,null,!0).roundPx(1).top,e+=this.grid.scrollable.y),e=Mr.roundPx(e),this.rows.find((t=>e>=t.top&&e<t.bottom))}getRowFor(e){return e instanceof HTMLElement?this.getRowFromElement(e):this.getRowById(e)}getNextRow(e){const t="number"==typeof e?e:e.index;return this.getRow((t+1)%this.rowCount)}get topRow(){return this.rows[0]}get bottomRow(){const e=Math.min(this.rowCount,this.store.count);return this.rows[e-1]}get firstVisibleRow(){return this.rows.find((e=>e.bottom>Math.ceil(this.grid.scrollable.y)))}get firstFullyVisibleRow(){return this.rows.find((e=>e.top>=Math.ceil(this.grid.scrollable.y)))}get lastVisibleRow(){const{grid:e}=this;return ke.findLast(this.rows,(t=>t.top<e.scrollable.y+e.bodyHeight))}get lastFullyVisibleRow(){const{grid:e}=this;return ke.findLast(this.rows,(t=>t.bottom<e.scrollable.y+e.bodyHeight))}offsetRows(e){if(0!==e){const{rows:t}=this,{length:n}=t;for(let r=0;r<n;r++)t[r].offset(e)}this.trigger("offsetRows",{offset:e})}get prependBufferHeight(){return this.prependRowBuffer*this.rowOffsetHeight}get appendBufferHeight(){return this.appendRowBuffer*this.rowOffsetHeight}get rowHeight(){return this._rowHeight}set rowHeight(e){const t=this,{grid:n,fixedRowHeight:r}=t,i=t.rowHeight;if(i!==e){if(sn.assertNumber(e,"rowHeight"),e<10&&(e=10),t.trigger("beforeRowHeight",{height:e}),t.minRowHeight=t._rowHeight=e,r&&(t.averageRowHeight=e),t.rows.length){const s=n.scrollable.y,o=t.getRowAt(s,!0),a=o?o.top-s:0;let l,c;r?(l=e,c=i):(c=l=t.averageRowHeight,t.clearKnownHeights(),l*=e/i),t.calculateRowCount(!1,!0,!0),t.topRow.setTop(t.topRow.dataIndex*(l+n._rowBorderHeight),!0),t.refresh(),s*(l/c)!==s&&n.scrollRowIntoView(o.id,{block:"start",edgeOffset:a})}t.trigger("rowHeight",{height:e,oldHeight:i})}}get rowOffsetHeight(){return Math.floor(this.preciseRowOffsetHeight)}get preciseRowOffsetHeight(){return(this.averageRowHeight||this._rowHeight)+this.grid._rowBorderHeight}get minRowOffsetHeight(){return(this.minRowHeight||this._rowHeight)+this.grid._rowBorderHeight}get allHeightsKnown(){return this.fixedRowHeight||this.heightMap.size>=this.store.count}storeKnownHeight(e,t){const n=this,{heightMap:r}=n;n.fixedRowHeight||(r.has(e)&&(n.totalKnownHeight-=r.get(e)),r.set(e,t),n.totalKnownHeight+=t,t<n.minRowHeight&&(n.minRowHeight=t),n.averageRowHeight=n.totalKnownHeight/r.size)}getOffsetHeight(e){const t=this;return(e&&t.heightMap.get(e.id)||e&&t.grid.getRowHeight(e)||t.averageRowHeight||t.rowHeight)+t.grid._rowBorderHeight}invalidateKnownHeight(e){const t=this;if(!t.fixedRowHeight){const{heightMap:n}=t;(e=ke.asArray(e)).forEach((e=>{e&&n.has(e.id)&&(t.totalKnownHeight-=n.get(e.id),n.delete(e.id))})),t.averageRowHeight=t.totalKnownHeight/n.size}}clearKnownHeights(){this.heightMap.clear(),this.averageRowHeight=this.totalKnownHeight=0}calculateTop(e){if(this.fixedRowHeight)return e*this.rowOffsetHeight;const{store:t}=this;let n=0;for(let r=0;r<e;r++){const e=t.getAt(r);n+=this.getOffsetHeight(e)}return Math.floor(n)}getRecordCoords(e,t=!1,n=!1){const r=this,i=r.getRowById(e);let s=r.client._bodyRectangle;return t||(s=r.client.refreshBodyRectangle()),i?new xn(s.x,t?Math.round(i.top):Math.round(i.top+s.y-r.client.scrollable.y),s.width,i.offsetHeight):r.getRecordCoordsByIndex(r.store.indexOf(e),t,n)}getRecordCoordsByIndex(e,t=!1,n=!1){const r=this,{topRow:i,bottomRow:s}=r,o=r.client._bodyRectangle,{id:a}=r.store.getAt(e),l=r.preciseRowOffsetHeight,c=i.dataIndex,d=s.dataIndex,u=e>d?{index:e-d-1,y:s.bottom,from:"bottomRow"}:e>c/2?{index:e-c,y:i.top,from:"topRow"}:{index:e,y:0,from:"top"},h=r.allHeightsKnown&&!n?r.calculateTop(e):Math.floor(u.y+u.index*l),g=new xn(o.x,t?h:h+o.y-r.client.scrollable.y,o.width,Math.floor(r.heightMap.get(a)||l));return g.virtual=!0,g.block=g.bottom<o.y?"start":g.y>o.bottom?"end":"nearest",g}get totalHeight(){return this._totalHeight}forEach(e){this.rows.forEach(e)}[Symbol.iterator](){return this.rows[Symbol.iterator]()}refreshCell(e,t){const n=new Gh({grid:this.grid,record:e,columnId:t});return Boolean(n.cell&&n.row.renderCell(n))}returnToTop(){const e=this;e.topIndex=0,e.lastScrollTop=0,e.topRow&&(e.topRow.dataIndex=0,e.topRow.setTop(0,!0)),e.refresh(),e.grid.scrollable.y=0}renderFromRecord(e){const t=this.getRowById(e.id);t&&this.renderFromRow(t)}renderFromRow(e=null){const t=this,{rows:n,store:r}=t,i=r.count;if(0===t.calculateRowCount(!1,i<n.length,!0))return void t.estimateTotalHeight(!0);const s=e?n.indexOf(e):0;let o=e?e.dataIndex:n[0].dataIndex;const a=i-o-1,l=Math.min(n.length-1,s+a);let c,d=n.length-l-1,u=s>0?n[s-1].bottom:n[s].top;for(let e=s;e<=l;e++)c=n[e],c.dataIndex=o,c.setTop(u,!0),c.render(o,r.getAt(o++),!1),u+=c.offsetHeight;for(;d-- >0;)t.displayRecordAtTop();t.bottomRow.bottom<t.viewHeight&&t.calculateRowCount(),t.estimateTotalHeight(!0),t.trigger("renderDone")}renderRows(e){let t,n=!1;(e=Array.from(e)).sort(((e,t)=>e.dataIndex-t.dataIndex));for(const r of e)t=r.height,r.render(null,null,!1),n|=r.height!==t;n&&this.translateFromRow(e[0]),this.trigger("renderDone")}translateFromRow(e,t=!1){const n=this;let r,i,s=e.bottom;for(i=e.dataIndex+1,r=n.getRow(i);r;r=n.getRow(++i))s=r.translate(s);t||n.estimateTotalHeight(!0)}refresh(){const e=this,{topRow:t}=e;t&&!e.grid.refreshSuspended&&(e.idMap={},e.renderFromRow(t),e.trigger("refresh"))}jumpToPosition(e,t){const n=this,{store:r,heightMap:i}=n,s=r.count;if(n.allHeightsKnown&&!n.fixedRowHeight){const t=e-n.prependBufferHeight,o=n.grid._rowBorderHeight;let a=0,l=0;for(;a<t;){const e=r.getAt(l);a+=i.get(e.id)+o,l++}const c=Math.max(Math.min(l,s-n.rowCount),0);n.lastScrollTop=e,n.topRow.dataIndex=n.topIndex=c,n.topRow.setTop(n.calculateTop(c),!1),n.refresh()}else{const r=n.preciseRowOffsetHeight,i=null==t?Math.floor(e/r)-n.prependRowBuffer:t-Math.floor(n.rowCount/2),o=Math.max(Math.min(i,s-n.rowCount),0),a=n.client.scrollable.y,l=Math.min(n.client._bodyRectangle.height+a+n.appendBufferHeight,n.totalHeight);if(n.lastScrollTop=e,n.topRow.dataIndex=n.topIndex=o,n.topRow.setTop(Math.floor(o*r),!1),n.refresh(),n.bottomRow.bottom<l)for(n.calculateRowCount(!1,!1,!1);n.bottomRow.bottom<l&&n._rows[n.prependRowBuffer].top<a&&n.bottomRow.dataIndex<s-1;)n.displayRecordAtBottom();n.estimateTotalHeight()}if(null!=t){const{scrollable:r}=n.grid,i=n.getRow(t),s=i&&xn.from(i._elementsArray[0]).center.y,o=r.viewport.center.y;i&&(r.y=e=Math.floor(r.y+(s-o)))}return e}warpIfNeeded(e){const t=this,n={newScrollTop:e,deltaTop:e-t.lastScrollTop};if(Math.abs(n.deltaTop)>t.rowCount*t.rowOffsetHeight*3){let r;t.scrollTargetRecordId&&(r=t.store.indexOf(t.scrollTargetRecordId)),t.grid.onFocusedRowDerender(),n.newScrollTop=t.jumpToPosition(e,r),n.deltaTop=0}return n}updateRenderedRows(e,t,n=!1){const r=this,i=r.client._bodyRectangle;if(0===r.rowCount)return 0;let s=r.totalHeight;if(t||Math.abs(e-r.lastScrollTop)>=r.rowOffsetHeight||r.topRow.top>e||r.bottomRow.bottom<e+i.height){const t=r.warpIfNeeded(e);r.scrollTargetRecordId=null,r.lastScrollTop=t.newScrollTop,t.deltaTop>0?r.fillBelow(t.newScrollTop):t.deltaTop<0&&r.fillAbove(t.newScrollTop),r.fixedRowHeight||n||r.correctError(t,i,e),s=r.estimateTotalHeight()}return s}correctError(e,t,n){const r=this;let i=0;(r.allHeightsKnown||e.deltaTop<0&&n<2*t.height||e.deltaTop>0&&n>r.totalHeight-2*t.height-3)&&(i=r.topRow.top-r.calculateTop(r.topRow.dataIndex)),i&&(r.offsetRows(-i),r.grid.scrollable.y=r.lastScrollTop=r.grid.scrollable.y-i)}fillAbove(e){const t=this,n=e-t.topRow.top-t.prependBufferHeight;let r=0;for(;r>n&&t.topIndex>0;)r-=t.displayRecordAtTop();t.trigger("renderDone")}fillBelow(e){const t=this,n=e-t.topRow.top-t.prependBufferHeight,r=t.store.count,i=t.rowCount;let s=0;for(;s<n&&t.topIndex+i<r&&t.topRow.top+t.topRow.offsetHeight<e;)s+=t.displayRecordAtBottom();t.trigger("renderDone")}estimateTotalHeight(e=!1){const t=this;if(t.grid.renderingRows)return;const n=t.store.count,r=n-t.heightMap.size,{bottomRow:i}=t;let s;if(t.fixedRowHeight)s=n*t.rowOffsetHeight;else{if(s=t.totalKnownHeight+t.heightMap.size*t.grid._rowBorderHeight+r*t.preciseRowOffsetHeight,i&&r){const e=i.bottom;(e>s||t.topIndex+t.rowCount>=n&&s>e&&e>0)&&(s=e,i.dataIndex<n-1&&(s+=(n-1-i.dataIndex)*t.preciseRowOffsetHeight))}s=Math.floor(s)}return s!==t.totalHeight&&!1!==t.trigger("changeTotalHeight",{totalHeight:s,immediate:e})&&(t._totalHeight=s),s}displayRecordAtTop(){var e;const t=this,{grid:n}=t,r=t.topIndex-1,i=t.store.getAt(r),s=t.bottomRow,o=s.top;return t.trigger("beforeTranslateRow",{row:s,newRecord:i}),s.dataIndex===(null===(e=n.focusedCell)||void 0===e?void 0:e.rowIndex)&&n.onFocusedRowDerender(),s._top=t.topRow.top-t.getOffsetHeight(i),s.estimatedTop=!t.fixedRowHeight,s.render(r,i,!1),s._top=o,s.setBottom(t.topRow.top),s.estimatedTop=!1,t.topIndex--,t._rows.unshift(t._rows.pop()),s.offsetHeight}displayRecordAtBottom(){var e;const t=this,{grid:n}=t,r=t.topIndex+t.rowCount,i=t.store.getAt(r),s=t.topRow;return t.trigger("beforeTranslateRow",{row:s,newRecord:i}),s.dataIndex===(null===(e=n.focusedCell)||void 0===e?void 0:e.rowIndex)&&n.onFocusedRowDerender(),s.dataIndex=r,s.setTop(t.bottomRow.bottom),s.render(r,i,!1),t.topIndex++,t._rows.push(t._rows.shift()),s.offsetHeight}}Em.featureClass="",Em._$name="RowManager";const xm={x:1};class Rm extends wa{addScroller(e){(this.xScrollers||(this.xScrollers=[])).push(e)}addPartner(e,t=xm){"string"==typeof t&&(t={[t]:1}),t.x&&(e.owner.initScroll(),this.xScrollers.forEach(((t,n)=>t.addPartner(e.xScrollers[n],"x")))),t.y&&super.addPartner(e,"y")}removePartner(e){this.xScrollers.forEach(((t,n)=>{t.isDestroyed||t.removePartner(e.xScrollers[n])})),super.removePartner(e)}updateOverflowX(e){var t;const n=!1===e;null===(t=this.xScrollers)||void 0===t||t.forEach((e=>e.overflowX=n?"hidden":"hidden-scroll")),this.widget.virtualScrollers.classList.toggle("b-hide-display",n)}scrollIntoView(e,t){if(e.nodeType!==Element.ELEMENT_NODE||!this.element.contains(e))return super.scrollIntoView(e,t);for(const n of this.xScrollers)if(n.element.contains(e))return n.scrollIntoView(e,t)}hasOverflow(e="y"){return"y"===e&&this.scrollHeight>this.clientHeight}set x(e){this.xScrollers&&(this.xScrollers[0].x=e)}get x(){return this.xScrollers?this.xScrollers[0].x:0}}Rm._$name="GridScroller";class Tm extends Sm{static get $name(){return"Header"}static get type(){return"gridheader"}get subGrid(){return this._subGrid}set subGrid(e){this._subGrid=this.owner=e}get region(){var e;return null===(e=this.subGrid)||void 0===e?void 0:e.region}changeElement(e,t){const{region:n}=this;return this.getConfig("columns"),super.changeElement({className:{"b-grid-header-scroller":1,[`b-grid-header-scroller-${n}`]:n},children:[{reference:"headersElement",className:{"b-grid-headers":1,[`b-grid-headers-${n}`]:n},dataset:{region:n,reference:"headersElement",maxDepth:this.maxDepth}}]},t)}get overflowElement(){return this.headersElement}getColumnConfig(e){const{id:t,align:n,resizable:r,isLeaf:i,isParent:s,isLastInSubGrid:o,cls:a,childLevel:l,field:c,tooltip:d,children:u,isFocusable:h,grid:g}=e,m=null==g?void 0:g.focusedCell,p=-1===(null==m?void 0:m.rowIndex)&&(null==m?void 0:m.column)===e;if(e.isVisible)return{className:{"b-grid-header":1,"b-grid-header-parent":s,[`b-level-${l}`]:1,[`b-depth-${e.meta.depth}`]:1,[`b-grid-header-align-${n}`]:n,"b-grid-header-resizable":r&&i,[a]:a,"b-collapsible":e.collapsible,"b-last-parent":s&&o,"b-last-leaf":i&&o},role:h?"columnheader":"presentation","aria-sort":"none","aria-label":e.ariaLabel,[h?"tabIndex":""]:p?0:-1,dataset:f(f({},lu.encodeConfig(d)),{},{columnId:t,[c?"column":""]:c}),children:[{className:"b-grid-header-text",children:[{[g&&h?"id":""]:`${null==g?void 0:g.id}-column-${e.id}`,className:"b-grid-header-text-content"}]},u?{className:"b-grid-header-children",children:u.map((e=>this.getColumnConfig(e)))}:null,{className:"b-grid-header-resize-handle"}]}}calculateMinWidthForSafari(){let e=0;return this.columns.visibleColumns.forEach((t=>{e+=t.calculateMinWidth()})),e}fixHeaderWidths(){this.fixCellWidths()}refreshHeaders(){const e=this;e.columns.traverse((t=>{const n=e.getBarCellElement(t.id);if(n){let r=t.headerText;t.headerRenderer&&(r=t.headerRenderer.call(t.thisObj||e,{column:t,headerElement:n})),t.headerWidgetMap&&Object.values(t.headerWidgetMap).forEach((e=>{e.render(t.textWrapper)})),t.icon&&(r=`<i class="${_.encodeHtml(t.icon)}"></i>`+(r||""));const i=n.querySelector(".b-grid-header-text-content");i&&(i.innerHTML=r||"")}})),e.fixHeaderWidths()}get columns(){const e=this,t=super.columns;return e.columnsDetacher||(e.columnsDetacher=t.on({change(){e.initDepths()},thisObj:e}),e.initDepths()),t}set columns(e){super.columns=e}initDepths(e=this.columns.topColumns,t=null){const n=this;let r=0;null!=t&&t.meta&&t.meta.depth++;for(const i of e){const{meta:e}=i;e.depth=0,i.children&&(n.initDepths(i.children.filter(n.columns.chainedFilterFn),i),e.depth&&t&&(t.meta.depth+=e.depth)),e.depth>r&&(r=e.depth)}return t||(n.maxDepth=r),r}getHeader(e){return this.getBarCellElement(e)}get contentElement(){return this.element.firstElementChild}refreshContent(){const e=this;oa.sync({domConfig:{children:e.columns.topColumns.map((t=>e.getColumnConfig(t))),onlyChildren:!0,strict:!0,syncIdField:"columnId",releaseThreshold:0},targetElement:e.contentElement}),e.refreshHeaders()}onPaint({firstPaint:e}){e&&this.refreshContent()}}Tm.initClass(),Tm._$name="Header";const Mm={touchstart:"onElementTouchStart",touchmove:"onElementTouchMove",touchend:"onElementTouchEnd",mouseover:"onElementMouseOver",mouseout:"onElementMouseOut",mousedown:"onElementMouseDown",mousemove:"onElementMouseMove",mouseup:"onElementMouseUp",click:"onHandleElementClick",dblclick:"onElementDblClick",keyup:"onElementKeyUp",keypress:"onElementKeyPress",contextmenu:"onElementContextMenu",pointerdown:"onElementPointerDown",pointerup:"onElementPointerUp"};var km=e=>class extends(e||Te){static get $name(){return"GridElementEvents"}static get configurable(){return{longPressTime:400,enableUndoRedoKeys:!0,keyMap:{"Ctrl+z":"undoRedoKeyPress","Ctrl+Shift+z":"undoRedoKeyPress"," ":{handler:"clickCellByKey",weight:1e3}}}}initInternalEvents(){const e=Object.keys(Mm),t=e.length,n={element:this.bodyElement,thisObj:this};for(let r=0;r<t;r++)n[e[r]]="handleEvent";_n.on(n),_n.on({focusin:"onGridBodyFocusIn",element:this.bodyElement,thisObj:this,capture:!0})}getCellDataFromEvent(e){const t=this,n=e.target.closest(".b-grid-cell");if(n){const e=Ps.get(n),{id:r,columnId:i}=e,s=t.store.getById(r),o=t.columns.getById(i);return s?{cellElement:n,cellData:e,columnId:i,id:r,record:s,column:o,cellSelector:{id:r,columnId:i}}:null}}getHeaderDataFromEvent(e){const t=e.target.closest(".b-grid-header");if(t){const e=sn.assign({},t.dataset),{columnId:n}=e,r=this.columns.getById(n);return r?{headerElement:t,headerData:e,columnId:n,column:r}:null}}handleEvent(e){!this.disabled&&Mm[e.type]&&this[Mm[e.type]](e)}onElementTouchStart(e){const t=this,n=t.getCellDataFromEvent(e);Mr.isTouchEvent=!0,1===e.touches.length&&(t.longPressTimeout=t.setTimeout((()=>{t.onElementLongPress(e),e.preventDefault(),t.longPressPerformed=!0}),t.longPressTime)),n&&!e.defaultPrevented&&t.onFocusGesture(e)}onElementTouchMove(e){const t=this;t.longPressTimeout&&(t.clearTimeout(t.longPressTimeout),t.longPressTimeout=null)}onElementTouchEnd(e){const t=this;t.longPressPerformed&&(e.cancelable&&e.preventDefault(),t.longPressPerformed=!1),t.longPressTimeout&&(t.clearTimeout(t.longPressTimeout),t.longPressTimeout=null)}onElementLongPress(e){}triggerCellMouseEvent(e,t,n=this.getCellDataFromEvent(t)){const r=this;if(n){const s=r.columns.getById(n.columnId),o={grid:r,record:n.record,column:s,cellSelector:n.cellSelector,cellElement:n.cellElement,target:t.target,event:t};var i;r.trigger("cell"+_.capitalize(e),o),"click"===e&&(null===(i=s.onCellClick)||void 0===i||i.call(s,o))}}onElementMouseDown(e){const t=this,n=t.getCellDataFromEvent(e);t.skipFocusSelection=!0,t.isScrollbarOrRowBorderOrSplitterClick(e)?e.preventDefault():(t.triggerCellMouseEvent("mousedown",e,n),n&&!e.defaultPrevented&&t.onFocusGesture(e))}isScrollbarOrRowBorderOrSplitterClick({target:e,x:t,y:n}){return!(!e.closest(".b-grid-splitter")&&!e.matches(".b-grid-row, .b-virtual-width"))||(e.matches(".b-vertical-overflow")?t>e.getBoundingClientRect().right-Mr.scrollBarWidth:e.matches(".b-horizontal-overflow")?n>e.getBoundingClientRect().bottom-Mr.scrollBarWidth-1:void 0)}onElementMouseMove(e){this.mouseMoveEvent=e}onElementMouseUp(e){}onElementPointerDown(e){}onElementPointerUp(e){}onHandleElementClick(e){!1!==this.trigger("beforeElementClick",{event:e})&&this.onElementClick(e)}onElementClick(e){const t=this,n=t.getCellDataFromEvent(e);if(n){t.triggerCellMouseEvent("click",e,n);const r=Ps.get(n.cellElement).row;r.isDestroyed||r.removeCls("b-hover")}}onFocusGesture(e){const t=this,n=2===e.button,r=!n&&e.target.matches(".b-icon-tree-expand, .b-icon-tree-collapse"),i=!document.hasFocus()&&y.isMac&&n;var s;r||i?e.preventDefault():(t.navigationEvent=e,(n||null!==(s=t.focusedCell)&&void 0!==s&&s.equals(new Gh(e.target)))&&t.focusCell(new Gh(e.target)))}onElementDblClick(e){const{target:t}=e;if(this.triggerCellMouseEvent("dblClick",e),t.classList.contains("b-grid-header-resize-handle")){const e=t.closest(".b-grid-header");this.columns.getById(e.dataset.columnId).resizeToFitContent()}}onElementMouseOver(e){if(!this.scrolling){const t=e.target.closest(".b-grid-cell");if(t){const n=Ps.get(t).row;!n||"number"==typeof e.buttons&&0!==e.buttons||this.setHoveredRow(n),this.triggerCellMouseEvent("mouseOver",e)}this.trigger("mouseOver",{event:e})}}onElementMouseOut(e){this.setHoveredRow(null),this.scrolling||(e.target.closest(".b-grid-cell")&&this.triggerCellMouseEvent("mouseOut",e),this.trigger("mouseOut",{event:e}))}setHoveredRow(e){const t=this;t._hoveredRow&&!t._hoveredRow.isDestroyed&&(t._hoveredRow.removeCls("b-hover"),t._hoveredRow=null),e&&!t.scrolling&&(t._hoveredRow=e,e.addCls("b-hover"))}keyMapOnKeyDown(e){this.onElementKeyDown(e),super.keyMapOnKeyDown(e)}onElementKeyDown(e){if(e.handled)return;const t=this,n=t.focusedCell;if(null!=n&&n.isCell&&!n.isActionable){var r,i;const s=n.cell;null===(r=(i=t.columns.getById(s.dataset.columnId)).onCellKeyDown)||void 0===r||r.call(i,{event:e,cellElement:s})}}undoRedoKeyPress(e){var t;const{stm:n}=this.store;return!(!n||!this.enableUndoRedoKeys||null!==(t=this.features.cellEdit)&&void 0!==t&&t.isEditing||(n.onUndoKeyPress(e),0))}clickCellByKey(e){const t=this,n=t.focusedCell,r=null==n?void 0:n.cell,i=t.columns.getById(r.dataset.columnId);return!(null==n||!n.isCell||n.isActionable||!i.onCellClick||(i.onCellClick({grid:t,column:i,record:t.store.getById(n.id),cellElement:r,target:e.target,event:e}),0))}onElementKeyPress(e){}onElementKeyUp(e){}onElementContextMenu(e){const t=this,n=t.getCellDataFromEvent(e);n&&(t.triggerCellMouseEvent("contextMenu",e,n),Mr.isTouchEvent&&t.onFocusGesture(e))}onInternalResize(e,t,n,r,i){const s=this;s._devicePixelRatio&&s._devicePixelRatio!==globalThis.devicePixelRatio&&Mr.resetScrollBarWidth(),s._devicePixelRatio=globalThis.devicePixelRatio,s._bodyRectangle=xn.client(s.bodyContainer),super.onInternalResize(...arguments),n!==i&&(s._bodyHeight=s.bodyContainer.offsetHeight,s.isPainted&&s.rowManager.initWithHeight(s._bodyHeight)),s.refreshVirtualScrollbars(),t!==r&&s.setTimeout((()=>{s.isDestroyed||s.updateResponsive(t,r)}),0)}get widgetClass(){}};const Im={string:1,object:1,function:1};var Am=e=>class extends(e||Te){static get $name(){return"GridFeatures"}set features(e){const t=this,n=vg.getInstanceDefaultFeatures(this);e=t._features=sn.assign({},e),n&&Object.keys(n).forEach((t=>{t in e||(e[t]=!0)}));const r=vg.getInstanceFeatures(this);for(const n of Object.keys(e)){const i=e[n];if(i){const s=!globalThis.__bryntum_code_editor_changed;if(_.uncapitalize(n)!==n){const e=`Invalid feature name '${n}', must start with a lowercase letter`;if(s)throw new Error(e);console.error(e),t._errorDuringConfiguration=e}const o=r[n];if(!o){const e=`Feature '${n}' not available, make sure you have imported it`;if(s)throw new Error(e);return console.error(e),void(t._errorDuringConfiguration=e)}Reflect.defineProperty(e,n,t.createFeatureInitializer(e,n,o,i))}}}get features(){return this._features}createFeatureInitializer(e,t,n,r){const i=[this],s=n.prototype.construct;return!0===r&&(r={}),Im[typeof r]&&(i[1]=r),{configurable:!0,get(){return delete e[t],n.prototype.construct=function(...r){e[t]=this,s.apply(this,r),n.prototype.construct=s},new n(...i)}}}hasFeature(e){const{features:t}=this;if(t){const t=Object.getOwnPropertyDescriptor(this.features,e);if(t)return Boolean(t.value||t.get)}return!1}hasActiveFeature(e){var t,n;return Boolean((null===(t=this.features)||void 0===t?void 0:t[e])&&!(null!==(n=this.features)&&void 0!==n&&n[e].disabled))}getConfigValue(e,t){if("features"===e){const e={};for(const s in this.features){var n,r,i;const o=null===(n=this.features[s])||void 0===n||null===(r=(i=n).getCurrentConfig)||void 0===r?void 0:r.call(i,t);o?sn.isEmpty(o)?vg.isDefaultFeatureForInstance(this.features[s].constructor,this)||(e[s]=!0):e[s]=o:e[s]=!1}return e}return super.getConfigValue(e,t)}get widgetClass(){}};const Fm=Object.freeze({}),Om=Object.freeze({x:!1,y:!1}),Lm=function(e){return this.focusableFinderCell.contains(e)?Mr.isFocusable(e)&&!e.disabled?Mr.NodeFilter.FILTER_ACCEPT:Mr.NodeFilter.FILTER_SKIP:Mr.NodeFilter.FILTER_REJECT};var Pm=e=>class extends(e||Te){static get $name(){return"GridNavigation"}static get configurable(){return{focusable:!1,focusableSelector:".b-grid-cell,.b-grid-header.b-depth-0",keyMap:{ArrowUp:{handler:"navigateUpByKey",weight:10},ArrowRight:{handler:"navigateRightByKey",weight:10},ArrowDown:{handler:"navigateDownByKey",weight:10},ArrowLeft:{handler:"navigateLeftByKey",weight:10},"Shift+ArrowUp":"navigateUpByKey","Shift+ArrowDown":"navigateDownByKey","Ctrl+Home":"navigateFirstCell",Home:"navigateFirstColumn","Ctrl+End":"navigateLastCell",End:"navigateLastColumn",PageUp:"navigatePrevPage",PageDown:"navigateNextPage",Enter:"activateHeader",Escape:"onEscape","Shift+Tab":{handler:"onShiftTab",preventDefault:!1},Tab:{handler:"onTab",preventDefault:!1}," ":{handler:"onSpace",preventDefault:!1}}}}onStoreRecordIdChange(e){var t;null===(t=super.onStoreRecordIdChange)||void 0===t||t.call(this,e);const{focusedCell:n}=this,{oldValue:r,value:i}=e;n&&n.id===r&&(n._id=i)}onElementMouseDown(e){this.lastMousedownEvent=e,super.onElementMouseDown(e)}onFocusedRowDerender(){const e=this,{focusedCell:t}=e;if(null!=(null==t?void 0:t.id)&&t.cell){const n=t.cell.contains(Mr.getActiveElement(e));if(e.hideHeaders)n&&e.revertFocus();else{const r=e.normalizeCellContext({rowIndex:-1,columnIndex:n?t.columnIndex:0});n?e.focusCell(r):r.cell.tabIndex=0}t.cell.tabIndex=-1}}navigateUpByKey(e){this.navigationEvent=e,this.focusCell(Gh.UP)}navigateDownByKey(e){this.navigationEvent=e,this.focusCell(Gh.DOWN)}navigateLeftByKey(e){this.navigationEvent=e,this.focusCell(this.rtl?Gh.NEXT_CELL:Gh.PREV_CELL)}navigateRightByKey(e){this.navigationEvent=e,this.focusCell(this.rtl?Gh.PREV_CELL:Gh.NEXT_CELL)}navigateFirstCell(e){this.navigationEvent=e,this.focusCell(Gh.FIRST_CELL)}navigateFirstColumn(e){this.navigationEvent=e,this.focusCell(Gh.FIRST_COLUMN)}navigateLastCell(e){this.navigationEvent=e,this.focusCell(Gh.LAST_CELL)}navigateLastColumn(e){this.navigationEvent=e,this.focusCell(Gh.LAST_COLUMN)}navigatePrevPage(e){this.navigationEvent=e,this.focusCell(Gh.PREV_PAGE)}navigateNextPage(e){this.navigationEvent=e,this.focusCell(Gh.NEXT_PAGE)}activateHeader(e){if(this.navigationEvent=e,e.target.classList.contains("b-grid-header")&&this.focusedCell.isColumnHeader){var t;const{column:n}=this.focusedCell;null===(t=n.onKeyDown)||void 0===t||t.call(n,e),this.getHeaderElement(n.id).click()}return!1}onEscape(e){const{focusedCell:t}=this;this.navigationEvent=e,!e.target.closest(".b-dragging")&&null!=t&&t.isActionable&&(e.stopImmediatePropagation(),this._focusedCell=null,this.focusCell({rowIndex:t.rowIndex,column:t.column},{disableActionable:!0}))}onTab(e){const{target:t}=e,{focusedCell:n,bodyElement:r}=this,{isActionable:i,actionTargets:s}=n,o=i&&Mr.isEditable(t)&&!t.readOnly;if(this.navigationEvent=e,o&&t===s[s.length-1])e.preventDefault(),this.navigateRightByKey(e);else if(!i||t===s[s.length-1])return r.style.display="none",this.requestAnimationFrame((()=>r.style.display="")),!1}onShiftTab(e){const t=this,{target:n}=e,{focusedCell:r,bodyElement:i}=t,{cell:s,isActionable:o,actionTargets:a}=r,l=o&&Mr.isEditable(n)&&!n.readOnly,c=0===r.columnIndex&&r.rowIndex===(t.hideHeaders?0:-1);if(t.navigationEvent=e,!c&&l&&n===a[0])e.preventDefault(),t.navigateLeftByKey(e);else if(!o||n===a[0]){const e=!c&&!t.hideHeaders&&t.focusCell({rowIndex:-1,column:0},{disableActionable:!0});return e?(e.cell.tabIndex=-1,s.tabIndex=0,t._focusedCell=r):(i.style.display="none",t.requestAnimationFrame((()=>i.style.display=""))),!1}}onSpace(e){return this.focusedCell.isActionable||e.preventDefault(),!1}get focusedCell(){return this._focusedCell}get isActionableLocation(){var e;return null===(e=this._focusedCell)||void 0===e?void 0:e.isActionable}set focusedCell(e){this.focusCell(e)}get focusedRecord(){var e;return null===(e=this._focusedCell)||void 0===e?void 0:e.record}get cellCSSSelector(){const e=this._focusedCell;return e?`[data-index=${e.rowIndex}] [data-column-id=${e.columnId}]`:""}afterHide(){super.afterHide(...arguments),this.lastFocusedCell=this.mouseMoveEvent=null}isFocused(e){var t;return Boolean(null===(t=this._focusedCell)||void 0===t?void 0:t.equals(this.normalizeCellContext(e)))}get focusElement(){if(!this.isDestroying){let t;var e;t=this.store.count&&this._focusedCell?this._focusedCell.target:this.normalizeCellContext({rowIndex:-1,columnIndex:(null===(e=this._focusedCell)||void 0===e?void 0:e.columnIndex)||0}).target;const n=super.focusElement;return!n||t&&t.compareDocumentPosition(n)!==Node.DOCUMENT_POSITION_PRECEDING?t:n}}onPaint({firstPaint:e}){var t;const n=this;null===(t=super.onPaint)||void 0===t||t.call(this,...arguments);const r=this.normalizeCellContext({rowIndex:n.hideHeaders?0:-1,column:n.hideHeaders?0:n.columns.find((e=>e.isFocusable))});if(r.cell){n._focusedCell=r;const{target:e}=r;e===r.cell&&(r.cell.tabIndex=0)}}onGridBodyFocusIn(e){const t=this,{bodyElement:n,lastMousedownEvent:r,navigationEvent:i}=t,s=i||e,o=t.focusedCell,a=null==o?void 0:o.target,{target:l,relatedTarget:c}=e,d=l.closest(t.focusableSelector);if(t.navigationEvent=t.lastMousedownEvent=null,d){var u;const h=new Gh(l),{cell:g}=h,m=null==o?void 0:o.cell,p=h.actionTargets=t.findFocusables(d),f=(Boolean(i)||t.selectOnFocus)&&l===g;if(!t.store.getById(d.parentNode.dataset.id)&&g!==d)return void g.focus({preventScroll:!0});if(l.matches(t.focusableSelector)){if(t.disableActionable)h._target=g;else if(p.length)return t.navigationEvent=s,void p[0].focus()}else{if(null!=o&&o.target&&c&&(!r||!n.contains(r.target))&&!n.contains(c)&&!h.equals(o))return void a.focus();h._target=l}if(m&&(m.classList.remove("b-focused"),m.tabIndex=-1),g&&(g.classList.add("b-focused"),h.column.onCellFocus(h),g===l&&(g.tabIndex=0),g.contains(e.relatedTarget)&&a===l))return;t._focusedCell=h,null===(u=t.onCellNavigate)||void 0===u||u.call(t,t,o,h,s,f),t.trigger("navigate",{lastFocusedCell:o,focusedCell:h,event:s})}else null==a||a.focus()}findFocusables(e){const{focusableFinder:t}=this,n=[];t.currentNode=this.focusableFinderCell=e;for(let e=t.nextNode();e;e=t.nextNode())n.push(e);return n}get focusableFinder(){const e=this;return e._focusableFinder||(e._focusableFinder=e.setupTreeWalker(e.bodyElement,Mr.NodeFilter.SHOW_ELEMENT,{acceptNode:Lm.bind(e)})),e._focusableFinder}restoreActiveItem(e=this._focusedCell){if(this.rowManager.count)return isNaN(e)?e.isModel||(e=this.store.getById(e)):e=this.store.getAt(e),this.focusCell(e)}focusCell(e,t=Fm){var n,r;const i=this,{_focusedCell:s}=i,{scroll:o,doSelect:a,disableActionable:l}=t;if(-1===(null===(n=e)||void 0===n?void 0:n.rowIndex)&&i.hideHeaders)return void i.revertFocus();var c;if((e="number"==typeof e&&null!=s&&s.isLocation?s.move(e):i.normalizeCellContext(e)).equals(s))return null===(c=i.onCellNavigate)||void 0===c||c.call(i,i,s,e,i.navigationEvent,!("doSelect"in t)||a),s;const d=i.getSubGridFromColumn(e.columnId),{cell:u}=e,h=u||i.getCell({rowIndex:i.rowManager.topIndex,columnId:e.columnId}),g=xn.from(d.element),m=xn.from(i.bodyElement),p=xn.from(h).moveTo(null,g.y);return!1===o||-1===e.rowIndex?t=Object.assign({},t,Om):(t=Object.assign({},t,o),p.width>g.width||p.height>m.height?t.x=t.y=!1:t.column=e.columnId,i.scrollRowIntoView(e.id,t)),i.disableActionable=l,i.selectOnFocus=a,null===(r=e[l?"cell":"target"])||void 0===r||r.focus(),i.disableActionable=i.selectOnFocus=!1,e}blurCell(e){const t=this.getCell(e);t&&t.classList.remove("b-focused")}clearFocus(e){const t=this;t._focusedCell&&(t.lastFocusedCell=e?null:t._focusedCell,t.blurCell(t._focusedCell),t._focusedCell=null)}internalNextPrevCell(e=!0,t){const n=this,r=n._focusedCell;return r?(n.navigationEvent=t,n.focusCell({id:r.id,columnId:n.columns.getAdjacentVisibleLeafColumn(r.columnId,e,!0).id},{doSelect:!0,event:t})):null}navigateRight(e){return this.internalNextPrevCell(!this.rtl,e)}navigateLeft(e){return this.internalNextPrevCell(Boolean(this.rtl),e)}internalNextPrevRow(e,t=!0,n,r=!0){const i=this,s=i._focusedCell;if(!s)return!1;const o=i.store["get"+(e?"Next":"Prev")](s.id,!1,t);return o?i.focusCell({id:o.id,columnId:s.columnId,scroll:{x:!1}},{doSelect:!0,event:n}):!e&&r?(this.clearFocus(),this.getHeaderElement(s.columnId).focus()):void 0}navigateDown(e){return this.internalNextPrevRow(!0,!1,e)}navigateUp(e){return this.internalNextPrevRow(!1,!0,e)}get widgetClass(){}},$m=e=>class extends(e||Te){static get $name(){return"GridResponsive"}static get defaultConfig(){return{responsiveLevels:Object.freeze({small:400,medium:600,large:"*"})}}getClosestBiggerLevel(e){const t=this,n=Object.keys(sn.assign({},t.responsiveLevels));let r=null,i=99995,s=null;return n.forEach((n=>{let o=t.responsiveLevels[n];if(["number","string"].includes(typeof o)||(o=o.levelWidth),"*"===o)s=n;else if(e<o){const t=o-e;t<i&&(i=t,r=n)}})),r||s}get responsiveLevel(){return this.getClosestBiggerLevel(this.width)}updateResponsive(e,t){const n=this,r=n.getClosestBiggerLevel(t),i=n.getClosestBiggerLevel(e);if(0===t||r!==i){const s=n.responsiveLevels[i];["number","string"].includes(typeof s)||n.applyState(s),n.columns.forEach((e=>{const t=e.responsiveLevels;t&&(t[i]?e.applyState(t[i]):t["*"]&&e.applyState(t["*"]))})),n.element.classList.remove("b-responsive-"+r),n.element.classList.add("b-responsive-"+i),n.trigger("responsive",{level:i,width:e,oldLevel:r,oldWidth:t})}}get widgetClass(){}};const _m={string:1,number:1},Nm={dataset:1,batch:1};var Hm=e=>class extends(e||Te){static get $name(){return"GridSelection"}static get configurable(){return{selectionMode:{row:!0,cell:!0,rowCheckboxSelection:!1,multiSelect:!0,checkbox:!1,showCheckAll:!1,deselectFilteredOutRecords:!1,includeChildren:!1,preserveSelectionOnPageChange:!1,preserveSelectionOnDatasetChange:!0,deselectOnClick:!1}}}static get defaultConfig(){return{selectedRecordCollection:{}}}afterConfigure(){const e=this;if(e.selectionMode.checkbox){const t=Jh.getColumnClass("check"),n=!0===e.selectionMode.checkbox?null:e.selectionMode.checkbox;if(!t)throw new Error("CheckColumn must be imported for checkbox selection mode to work");const r=e.checkboxSelectionColumn=new t(sn.assign({id:`${e.id}-selection-column`,width:"4em",minWidth:"4em",field:null,cellCls:"b-checkbox-selection",region:e.items[0].region,showCheckAll:e.selectionMode.showCheckAll,widgets:[{type:"checkbox",valueProperty:"checked",ariaLabel:"L{Checkbox.toggleRowSelect}"}]},n),e.columns,{isSelectionColumn:!0});r.meta.depth=0,r._grid=e;const i=r.renderer;r.renderer=t=>{t.value=e.isSelected(t.record),i.call(r,t)},r.on({toggle:"onCheckChange",toggleAll:"onCheckAllChange",thisObj:e});const s=e.columns.indexOf(e.columns.findRecord("type","rownumber"))+1;e.columns.insert(s,r)}super.afterConfigure()}bindStore(e){var t;this.detachListeners("selectionStoreFilter"),e.on({name:"selectionStoreFilter",filter:"onStoreFilter",thisObj:this}),null===(t=super.bindStore)||void 0===t||t.call(this,e)}unbindStore(e){this.detachListeners("selectionStoreFilter"),super.unbindStore(e)}onStoreFilter({records:e}){if(this.selectionMode.deselectFilteredOutRecords){const{filtersFunction:e}=this.store,t=this.selectedRecordCollection.values.filter((t=>!e(t)));this.selectedRecordCollection.remove(t)}}onStoreRecordIdChange({record:e,oldValue:t}){super.onStoreRecordIdChange&&super.onStoreRecordIdChange(...arguments),this.selectedRecordCollection.get(t)===e&&this.selectedRecordCollection.rebuildIndices()}onBeforeSelectedRecordCollectionSplice({toAdd:e,toRemove:t,index:n}){const r=e,i=this.selectedRecordCollection.values,s=t>0?i.slice(n,t+n):[],o=r.length>0?"select":"deselect";if(!1===this.trigger("beforeSelectionChange",{mode:"row",action:o,selected:r,deselected:s,selection:i}))return!1}onSelectedRecordCollectionChange({source:e,action:t,added:n=[],removed:r}){const i=this;i._selectedCell&&!i.selectedCell.isSelectable&&i.deselectCell(i._selectedCell),n=n.filter((e=>i.isSelectable(e))),i.triggerChangeEvent({mode:"row",action:n.length?"select":"deselect",selection:i.selectedRecords,selected:n,deselected:r},i.silent)}onCheckChange({source:e,checked:t,record:n}){const r=this,{selectionMode:i,store:s}=r,o=[n,...i.includeChildren&&!1!==i.multiSelect&&!n.isLeaf&&n.allChildren||[]];t?(r.selectRows(o,!1!==i.multiSelect),e.headerCheckbox&&r.selectedRecords.length===s.count-(s.groupRecords?s.groupRecords.length:0)&&(e.suspendEvents(),e.headerCheckbox.checked=!0,e.resumeEvents())):(r.deselectRows(o),e.headerCheckbox&&(e.suspendEvents(),e.headerCheckbox.checked=!1,e.resumeEvents()))}onCheckAllChange({checked:e}){this[e?"selectAll":"deselectAll"](this.store.isPaged&&this.selectionMode.preserveSelectionOnPageChange)}set selectedRecordCollection(e){e instanceof rs||(e=new rs(e)),this._selectedRecordCollection=e,e.on({change:"onSelectedRecordCollectionChange",beforeSplice:"onBeforeSelectedRecordCollectionSplice",thisObj:this})}get selectedRecordCollection(){return this._selectedRecordCollection}spliceSelectedRecords(e,t,n){this._selectedRecordCollection.splice(e,t,n)}isSelected(e){var t;const n=this;return null!==(t=e)&&void 0!==t&&t.isModel&&(e=e.id),_m[typeof e]?n.selectedRecordCollection.includes(e):n._selectedCell&&n._selectedCell.id==e.id&&n._selectedCell.columnId===e.columnId}isSelectable(e){return this.normalizeCellContext({id:e.id||e}).isSelectable}get selectedCell(){return this._selectedCell}set selectedCell(e){this.selectCell(e)}changeSelectionMode(e){return null!=e&&e.rowCheckboxSelection&&(e.row=!0,e.checkbox=e.checkbox||!0,e.cell=!1),e}get selectedRecord(){return this.selectedRecordCollection.last||null}set selectedRecord(e){this.selectRow({record:e})}get selectedRecords(){return this.selectedRecordCollection.values}set selectedRecords(e){this.selectRows(e)}get selectedCellCSSSelector(){const e=this._selectedCell,t=e&&this.getRowById(e.id);return e&&t?`[data-index=${t.dataIndex}] [data-column-id=${e.columnId}]`:""}selectRow({record:e,column:t=this.columns.visibleColumns[0],scrollIntoView:n=!0,addToSelection:r=!1}){const i=this;(e=arguments[0].isModel?arguments[0]:i.store.getById(e))?i.selectCell({id:e.id,column:t},n,r):i.deselectAll()}selectCell(e,t=!1,n=!1,r=!1){const i=this,{selectedRecordCollection:s,selectionMode:o}=i,a=i.normalizeCellContext(e),l=a.record||i.store.getById(a.id);if(l){if(i.isSelectable(l)){if(t&&i.scrollRowIntoView(a.id,{column:a.columnId}),o.row&&(r&&(i.silent=(i.silent||0)+1),n?s.add(l):s.splice(0,s.count,l),r&&i.silent--,1===i.selectedRecordCollection.count&&(i.startCell=a,i.lastRange=null)),o.cell&&(a.columnId||a.column)&&!i.isSelected(a)){const e=i._selectedCell?[i._selectedCell]:[];i._selectedCell=a,i.triggerChangeEvent({mode:"cell",action:"select",selected:[a],deselected:e,selection:[a]},r)}return a}i.deselectRow(l)}else"id"in a&&i.deselectRow(a.id)}selectAll(){const e=this,{store:t}=e;t.isFiltered&&!e.selectionMode.deselectFilteredOutRecords?e.selectedRecordCollection.add(...(t.isGrouped?t.allRecords:t.records).filter((e=>!e.isSpecialRow))):e.selectRows(t.allRecords.filter((e=>!e.isSpecialRow)),!0)}deselectAll(e=!1){const t=this;e?t.selectedRecordCollection.remove(...t.store.records):t.selectedRecordCollection.clear(),t._selectedCell&&t.deselectCell(t._selectedCell)}deselectRow(e){this.deselectRows(e)}selectRows(e,t=!1){const{store:n}=this,r=[];e=ke.asArray(e)||[];for(let t of e)t=n.getById(t),t&&r.push(t);t?this.selectedRecordCollection.add(r):this.selectedRecordCollection.splice(0,this.selectedRecordCollection.count,r)}deselectRows(e){const t=(e=ke.asArray(e)).map((e=>this.store.getById(e))).filter((e=>e));this.selectedRecordCollection.remove(t)}deselectCell(e){const t=this,n=t.normalizeCellContext(e),r=t.selectionMode,i=n.record||t.store.getById(n.id),s=t._selectedCell;return r.row&&t.selectedRecordCollection.remove(i),r.cell&&n.columnId&&s&&s.id===n.id&&s.columnId===n.columnId&&(t._selectedCell=null,t.triggerChangeEvent({mode:"cell",action:"deselect",selected:[],deselected:[n],selection:[]})),n}selectRange(e,t){const{store:n,selectedRecordCollection:r}=this,i=n.indexOf(e),s=n.indexOf(t),o=Math.min(i,s),a=Math.max(i,s);if(-1===o||-1===a)throw new Error("Record not found in selectRange");r.splice(0,r.count,n.getRange(o,a+1,!1))}onStoreRemove(e){super.onStoreRemove&&super.onStoreRemove(e),e.isCollapse||this.selectedRecordCollection.remove(e.records)}onStoreDataChange({action:e,source:t}){const n=this,{selectionMode:r,checkboxSelectionColumn:i,selectedRecordCollection:s}=n;if(super.onStoreDataChange&&super.onStoreDataChange(...arguments),"pageLoad"===e)r.preserveSelectionOnPageChange||n.deselectAll(),null==i||i.updateCheckAllState(!t.find((e=>!s.includes(e))));else if(Nm[e]){const e=[];!1===r.preserveSelectionOnDatasetChange?n.deselectAll():(s.forEach((n=>{const r=t.getById(n.id);if(r){const e=s.indexOf(n);s.splice(e,1,r)}else e.push(n)})),s.remove(e))}}onStoreRemoveAll(){super.onStoreRemoveAll&&super.onStoreRemoveAll(),this.deselectAll()}handleMouseMultiSelect(e,t){const n=this,r=e.id,{selectionMode:i}=n;(t.metaKey||t.ctrlKey||i.deselectOnClick)&&n.isSelected(r)?n.deselectRow(r):i.multiSelect&&(t.shiftKey&&n.startCell?function(e,t){const{store:r,selectedRecordCollection:i}=n,s=r.indexOf(e),o=r.indexOf(t),a=Math.min(s,o),l=Math.max(s,o);if(-1===a||-1===l)throw new Error("Record not found in selectRange");const c=r.getRange(a,l+1,!1).filter((e=>n.isSelectable(e)));i.splice(0,n.lastRange||0,c),n.lastRange=c}(n.startCell.id,r):(t.ctrlKey||t.metaKey)&&n.selectRow({record:r,scrollIntoView:!1,addToSelection:!0}))}onCellNavigate(e,t,n,r,i=!0){const{selectionMode:s}=e;if(e.columns.getById(n.columnId)===e.checkboxSelectionColumn||s.rowCheckboxSelection)return;if(-1===n.rowIndex||!i)return;const o=t&&n.id===t.id,a="mousedown"===(null==r?void 0:r.type)&&(r.ctrlKey||r.metaKey),l=e.isSelected(n.id);if(!r||r.button&&2!==r.button||!r.shiftKey&&!a)if(s.deselectOnClick&&l)e.deselectCell(n);else{const t=o&&(!r||r.shiftKey||r.ctrlKey||r.metaKey),i=r&&l,s=a;e.selectCell(n,!1,t||s||i)}else e.handleMouseMultiSelect(n,r);e.startCell&&!a||(e.startCell=n,e.lastRange=null)}triggerChangeEvent(e,t){const n=this,{mode:r,selected:i,deselected:s}=e,{checkboxSelectionColumn:o}=n;let a,l,c,d;if("row"===r){for(a=0,l=i.length;a<l;a++)c=n.getRowFor(i[a]),c&&(c.addCls("b-selected"),c.setAttribute("aria-selected",!0),!o||o.hidden||i[a].isSpecialRow||(c.getCell(o.id).widget.checked=!0));for(a=0,l=s.length;a<l;a++)c=n.getRowFor(s[a]),c&&(c.removeCls("b-selected"),c.setAttribute("aria-selected",!1),!o||o.hidden||s[a].isSpecialRow||(c.getCell(o.id).widget.checked=!1))}else if("cell"===r){for(a=0,l=i.length;a<l;a++)d=n.getCell(i[a]),d&&(d.setAttribute("aria-selected",!0),d.classList.add("b-selected"));for(a=0,l=s.length;a<l;a++)d=n.getCell(s[a]),d&&(d.classList.remove("b-selected"),d.setAttribute("aria-selected",!1))}t||n.trigger("selectionChange",e)}onCellClick({event:e,record:t}){const n=this;n.selectionMode.checkbox||!n.selectionMode.multiSelect||e.shiftKey||e.metaKey||e.ctrlKey||n.deselectRows(n.selectedRecords.filter((e=>e!==t)))}doDestroy(){var e;null===(e=this.selectedRecordCollection)||void 0===e||e.destroy(),super.doDestroy()}get widgetClass(){}};const Bm=e=>e.columns.suspendEvents(),jm=e=>e.columns.resumeEvents(),Vm=e=>{e.columns.clearCaches(),e.columns.fillFromMaster()},zm=(e,t)=>e.stateSortIndex-t.stateSortIndex;var Wm=e=>class extends(e||Te){static get $name(){return"GridState"}static get configurable(){return{statefulEvents:["subGridCollapse","subGridExpand","horizontalScroll","stateChange"]}}updateStore(e,t){var n;null===(n=super.updateStore)||void 0===n||n.call(this,e,t),this.detachListeners("stateStoreListeners"),null==e||e.on({name:"stateStoreListeners",filter:"triggerUpdate",group:"triggerUpdate",sort:"triggerUpdate",thisObj:this})}updateColumns(e,t){var n;null===(n=super.updateColumns)||void 0===n||n.call(this,e,t),this.detachListeners("stateColumnListeners"),e.on({name:"stateColumnListeners",change:"triggerUpdate",thisObj:this})}updateRowManager(e,t){var n;null===(n=super.updateRowManager)||void 0===n||n.call(this,e,t),this.detachListeners("stateRowManagerListeners"),e.on({name:"stateRowManagerListeners",rowHeight:"triggerUpdate",thisObj:this})}triggerUpdate(){this.trigger("stateChange")}finalizeInit(){super.finalizeInit(),this.on({selectionChange:"triggerUpdate"})}getState(){const e=this,t=e.element.style.cssText,n={rowHeight:e.rowHeight};if(t&&(n.style=t),e.selectedCell){const{id:t,columnId:r}=e.selectedCell;n.selectedCell={id:t,columnId:r}}return n.selectedRecords=e.selectedRecords.map((e=>e.id)),n.columns=e.columns.allRecords.map((e=>e.getState())),n.store=e.store.state,n.scroll=e.storeScroll(),n.subGrids={},e.eachSubGrid((e=>{var t;const r=n.subGrids[e.region]=n.subGrids[e.region]||{};e.isPainted?null==e.flex&&(r.width=e.width):null!=e.config.width?r.width=e.config.width:r.flex=e.config.flex,r.collapsed=null!==(t=e.collapsed)&&void 0!==t&&t,r.collapsed&&(r._beforeCollapseState=e._beforeCollapseState)})),n}applyState(e){const t=this;if(t.suspendRefresh(),"columns"in e){let n=!1,r=!1;t.columns.suspendEvents(),t.eachSubGrid(Bm),e.columns.forEach(((e,i)=>{const s=t.columns.getById(e.id);if(s){const t=s.generation;s.applyState(e),n=n||s.generation!==t,s.stateSortIndex=i,s.allIndex!==i&&(r=n=!0)}})),n&&t.eachSubGrid(Vm),r&&(t.eachSubGrid((e=>{e.columns.records.sort(zm),e.columns.allRecords.sort(zm)})),t.columns.sort({fn:zm,ascending:!0})),t.isPainted&&n&&t.renderContents(),t.columns.resumeEvents(),t.eachSubGrid(jm)}"subGrids"in e&&t.eachSubGrid((t=>{if(t.region in e.subGrids){const n=e.subGrids[t.region];"width"in n?t.width=n.width:"flex"in n&&(t.flex=n.flex),"collapsed"in n&&(t.collapsed=n.collapsed,t._beforeCollapseState=n._beforeCollapseState)}})),"rowHeight"in e&&(t.rowHeight=e.rowHeight),"style"in e&&(t.style=e.style),"selectedCell"in e&&(t.selectedCell=e.selectedCell),"store"in e&&(t.store.state=e.store),"selectedRecords"in e&&(t.selectedRecords=e.selectedRecords),t.resumeRefresh(!0),t.eachSubGrid((e=>e.refreshFakeScroll())),"scroll"in e&&(t.restoreScroll(e.scroll),e.scroll.scrollTop&&t.element.querySelectorAll(".b-resize-monitored").forEach((e=>{const t=qc.fromElement(e);t&&t.onElementResize(e)})))}get widgetClass(){}};const Um=Promise.resolve(),Ym={block:"nearest"};class Gm extends wa{static get configurable(){return{propagate:!1,overflowX:"hidden-scroll"}}scrollIntoView(e,t=Ym){const{xDelta:n,yDelta:r}=this.getDeltaTo(e,t),i=n||r?this.scrollBy(n,r,t):Um;return(t.highlight||t.focus)&&i.then((()=>{t.highlight&&(e instanceof xn?e.translate(-n,-r).highlight():Mr.highlight(e)),t.focus&&e.focus&&e.focus()})),i}scrollBy(e,t,n){const r=t&&this.yScroller.scrollBy(0,t,n),i=e&&super.scrollBy(e,0,n);if(i&&i.cancel&&r&&r.cancel){const e=i.cancel,t=r.cancel;return i.cancel=r.cancel=()=>{e(),t()},Promise.all([i,r])}return i||r||Um}scrollTo(e,t,n){const r=null!=t&&this.yScroller.scrollTo(null,t,n),i=null!=e&&super.scrollTo(e,null,n);if(n&&n.animate||this.syncPartners(),i&&i.cancel&&r&&r.cancel){const e=i.cancel,t=r.cancel;return i.cancel=r.cancel=()=>{e(),t()},Promise.all([i,r])}return i||r||Um}get viewport(){const e=xn.from(this.element);return e.intersect(xn.from(this.yScroller.element))||new xn(e.x,e.y,e.width,0)}set y(e){this.yScroller&&(this.yScroller.y=e)}get y(){return this.yScroller?this.yScroller.y:0}get maxY(){return this.yScroller?this.yScroller.maxY:0}get scrollHeight(){return this.yScroller?this.yScroller.scrollHeight:0}get clientHeight(){return this.yScroller?this.yScroller.clientHeight:0}}Gm._$name="SubGridScroller";const qm=(e,t)=>e+t.getBoundingClientRect().width;class Km extends Ka{static get $name(){return"SubGrid"}static get type(){return"subgrid"}static get defaultConfig(){return{insertRowsBefore:null,appendTo:null,monitorResize:!0,headerClass:null,footerClass:null,weight:null,collapsed:null,scrollable:{overflowX:"hidden-scroll"},scrollerClass:Gm,hasCalculatedWidth:null,sealedColumns:null}}static get configurable(){return{element:!0,header:{},footer:{},virtualScrollerElement:!0,splitterElement:!0,headerSplitter:!0,scrollerSplitter:!0,footerSplitter:!0,resizable:null,role:"presentation"}}construct(e){const t=this;if(super.construct(e),this.rowManager.on("addrows",this.onAddRow,this),y.isFirefox){const{element:e}=t,n=t.grid.scrollable;let r=0;e.addEventListener("wheel",(({ctrlKey:i,deltaY:s,deltaX:o})=>{const a=Math.abs(s)>Math.abs(o);i||!a||t.scrollEndDetacher||n.y===r||(e.style.pointerEvents="none",r=n.y,t.scrollEndDetacher=n.on({scrollEnd:async()=>{r=n.y,e.style.pointerEvents="",t.scrollEndDetacher=null},once:!0}))}))}}doDestroy(){var e;const t=this;t.header.destroy(),t.footer.destroy(),null===(e=t.fakeScroller)||void 0===e||e.destroy(),t.virtualScrollerElement.remove(),t.splitterElements.forEach((e=>e.remove())),super.doDestroy()}get barConfig(){const e=this,{width:t,flex:n}=e.element.style,r={subGrid:e,parent:e,maxWidth:e.maxWidth||void 0,minWidth:e.minWidth||void 0};return n?r.flex=n:t&&(r.width=t),r}changeHeader(e){return new this.headerClass(sn.assign({id:this.id+"-header"},this.barConfig,e))}changeFooter(e){return new this.footerClass(sn.assign({id:this.id+"-footer"},this.barConfig,e))}get splitterElements(){return[this.splitterElement,this.headerSplitter,this.scrollerSplitter,this.footerSplitter]}toggleSplitterCls(e,t=!0){this.splitterElements.forEach((n=>null==n?void 0:n.classList[t?"add":"remove"](e)))}hideSplitter(){this.splitterElements.forEach((e=>e.classList.add("b-hide-display"))),this.$showingSplitter=!1}showSplitter(){this.splitterElements.forEach((e=>e.classList.remove("b-hide-display"))),this.$showingSplitter=!0}changeElement(e,t){const{region:n}=this;return super.changeElement({"aria-label":n,className:{"b-grid-subgrid":1,[`b-grid-subgrid-${n}`]:n,"b-grid-subgrid-collapsed":this.collapsed},dataset:{region:n}},t)}get rowElementConfig(){const{grid:e}=this;return{role:"row",className:e.rowCls,children:this.columns.visibleColumns.map(((t,n)=>({role:"gridcell","aria-colindex":n+1,tabIndex:e.cellTabIndex,className:"b-grid-cell",dataset:{column:t.field||"",columnId:t.id}})))}}changeVirtualScrollerElement(){const e=Mr.createElement({role:"presentation",reference:"virtualScrollerElement",className:"b-virtual-scroller",tabIndex:-1,dataset:{region:this.region},children:[{reference:"virtualScrollerWidth",className:"b-virtual-width"}]});return this.virtualScrollerWidth=e.virtualScrollerWidth,e.virtualScrollerElement}changeSplitterElement(){const e=Mr.createElement({reference:"splitterElement",className:{"b-grid-splitter":1,"b-grid-splitter-collapsed":this.collapsed,"b-hide-display":1},dataset:{region:this.region},children:[y.isTouchDevice?{className:"b-splitter-touch-area"}:null,{className:"b-grid-splitter-inner b-grid-splitter-main",children:[{className:"b-grid-splitter-buttons",reference:"splitterButtons",children:[{className:"b-grid-splitter-button-collapse",children:[y.isTouchDevice?{className:"b-splitter-button-touch-area"}:null,{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",className:"b-grid-splitter-button-icon b-gridregion-collapse-arrow",viewBox:"0 0 256 512",children:[{tag:"path",d:"M192 448c-8.188 0-16.38-3.125-22.62-9.375l-160-160c-12.5-12.5-12.5-32.75 0-45.25l160-160c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25L77.25 256l137.4 137.4c12.5 12.5 12.5 32.75 0 45.25C208.4 444.9 200.2 448 192 448z"}]}]},{className:"b-grid-splitter-button-expand",children:[y.isTouchDevice?{className:"b-splitter-button-touch-area"}:null,{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",className:"b-grid-splitter-button-icon b-gridregion-expand-arrow",viewBox:"0 0 256 512",children:[{tag:"path",d:"M64 448c-8.188 0-16.38-3.125-22.62-9.375c-12.5-12.5-12.5-32.75 0-45.25L178.8 256L41.38 118.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0l160 160c12.5 12.5 12.5 32.75 0 45.25l-160 160C80.38 444.9 72.19 448 64 448z"}]}]}]}]}]});return this.splitterButtons=e.splitterButtons,e.splitterElement}get splitterConfig(){return{className:this.splitterElement.className.trim(),children:[y.isTouchDevice?{className:"b-splitter-touch-area"}:null,{className:"b-grid-splitter-inner"}],dataset:{region:this.region}}}changeHeaderSplitter(){return Mr.createElement(this.splitterConfig)}changeScrollerSplitter(){return Mr.createElement(this.splitterConfig)}changeFooterSplitter(){return Mr.createElement(this.splitterConfig)}render(...e){const t=this;super.render(...e),t.grid&&(t.updateHasFlex(),t.element.parentNode.insertBefore(t.splitterElement,t.element.nextElementSibling),t.splitterElements.forEach((e=>_n.on({element:e,mouseenter:"onSplitterMouseEnter",mouseleave:"onSplitterMouseLeave",thisObj:t}))),t._collapsed&&t.collapse())}refreshHeader(){this.header.refreshContent()}refreshFooter(){var e;null===(e=this.footer)||void 0===e||e.refreshContent()}eachWidget(e,t=!0){const n=[this.header,this.footer];for(let r=0;r<n.length;r++){const i=n[r];if(!1===e(i))return;t&&i.eachWidget&&i.eachWidget(e,t)}}fixCellWidths(e){const{visibleColumns:t}=this.columns;let n=e.firstElementChild,r=0;for(;n;){const e=t[r],{element:i}=e;e.minWidth&&(n.style.minWidth=Mr.setLength(e.minWidth)),e.maxWidth&&(n.style.maxWidth=Mr.setLength(e.maxWidth)),e.flex?e.childLevel&&i?(n.style.flex=`0 0 ${i.getBoundingClientRect().width}px`,n.style.width=""):(n.style.flex=e.flex,n.style.width=""):e.width?n.style.width=Mr.setLength(e.width):n.style.flex=n.style.width=n.style.minWidth="",n=n.nextElementSibling,r++}}get totalFixedWidth(){return this.columns.totalFixedWidth}fixWidths(){const e=this,{element:t,header:n,footer:r}=e;if(!e.collapsed){if(e.flex)n.flex=e.flex,r&&(r.flex=e.flex),t.style.flex=e.flex;else{if(e.hasCalculatedWidth&&!e.columns.some((e=>!e.hidden&&e.flex))&&e.totalFixedWidth!==e.width)return e.width=e.totalFixedWidth,void(e.hasCalculatedWidth=!0);let i=e.width;if(!i&&e.hasCalculatedWidth){i=0;for(const t of e.columns)t.flex||t.hidden||(i+=t.width)}t.style.width=`${i}px`,n.width=i,r&&(r.width=i)}e.syncScrollingPartners(!1)}}fixRowWidthsInSafariEdge(){if(y.isSafari){const e=this,{region:t,header:n}=e,r=n.calculateMinWidthForSafari();e.rowManager.forEach((e=>{const n=e.getElement(t);n&&(n.style.width=`${r}px`)})),n.headersElement.style.width=`${r}px`}}set width(e){const t=this;t.hasCalculatedWidth=!1,super.width=e,t.header.width=e,t.footer.width=e,t.isPainted&&t.onElementResize()}get width(){return super.width}set flex(e){const t=this;t.hasCalculatedWidth=!1,t.header.flex=e,t.footer.flex=e,super.flex=e,t.isPainted&&t.onElementResize()}get flex(){return super.flex}onInternalResize(e,t,n,r,i){const s=this,{grid:o}=s;super.onInternalResize(...arguments),null!=o&&o.isPainted&&(s.syncSplitterButtonPosition(),t!==r&&(o.trigger("horizontalScroll",{grid:o,subGrid:s,scrollLeft:s.scrollable.element.scrollLeft,scrollX:s.scrollable.x}),s.fakeScroller&&s.refreshFakeScroll(),o.syncFlexedSubCols(),s.fixRowWidthsInSafariEdge()),n!==i&&o.onHeightChange(),s.trigger("afterInternalResize",s))}syncParallelSplitters(e){const t=this,{grid:n}=t;if(t.splitterElement&&t.$showingSplitter)t.toggleSplitterCls("b-grid-splitter-collapsed",e);else{const r=n.getSubGrid(n.getPreviousRegion(t.region));r&&r.splitterElement&&r.syncParallelSplitters(e)}}onSplitterMouseEnter(){const e=this,{nextSibling:t}=e;e.collapsed||t&&t.collapsed||e.toggleSplitterCls("b-hover"),e.startSplitterButtonSyncing()}onSplitterMouseLeave(){const e=this,{nextSibling:t}=e;e.toggleSplitterCls("b-hover",!1),e.collapsed||t&&t.collapsed||e.stopSplitterButtonSyncing()}startSplitterButtonSyncing(){const e=this;e.splitterElement&&(e.syncSplitterButtonPosition(),e.splitterSyncScrollListener||(e.splitterSyncScrollListener=e.grid.scrollable.on({scroll:"syncSplitterButtonPosition",thisObj:e})))}stopSplitterButtonSyncing(){this.splitterSyncScrollListener&&(this.splitterSyncScrollListener(),this.splitterSyncScrollListener=null)}syncSplitterButtonPosition(){const{grid:e}=this;this.splitterButtons.style.top=`${e.scrollable.y+(e.bodyHeight-(this.headerSplitter?e.headerHeight:0))/2}px`}get viewRectangle(){const{scrollable:e}=this;return new xn(e.x,e.y,this.width||0,this.rowManager.viewHeight)}updateHasFlex(){this.scrollable.element.classList.toggle("b-has-flex",this.columns.hasFlex)}updateResizable(e){this.splitterElements.forEach((t=>Mr.toggleClasses(t,["b-disabled"],!e)))}resizeColumnsToFitContent(){this.grid.beginGridMeasuring(),this.columns.visibleColumns.forEach((e=>{e.resizeToFitContent(null,null,!0)})),this.grid.endGridMeasuring()}get overflowingHorizontally(){return!this.collapsed&&this.scrollable.hasOverflow("x")}get overflowingVertically(){return!1}refreshFakeScroll(){const e=this,{element:t,virtualScrollerElement:n,virtualScrollerWidth:r,header:i,footer:s,scrollable:o}=e,a=[...i.contentElement.children].reduce(qm,0);o.scrollWidth=a,n.style.width=t.style.width,n.style.flex=t.style.flex,i.scrollable.syncOverflowState(),s.scrollable.syncOverflowState(),e.collapsed||(e.overflowingHorizontally?(r.style.width=`${o.scrollWidth||0}px`,e.grid.virtualScrollers.classList.remove("b-hide-display")):r.style.width=0)}initScroll(){const e=this,{scrollable:t,virtualScrollerElement:n}=e;e.syncPartnersOnFrame=e.createOnFrame(e.syncScrollingPartners),y.isFirefox&&t.element.addEventListener("wheel",(e=>{e.deltaX&&(t.x+=e.deltaX,e.preventDefault())})),t.yScroller=e.grid.scrollable,t.yScroller.addScroller(t),e.fakeScroller=new wa({element:n,overflowX:!0}),t.on({scroll:"onSubGridScroll",scrollend:"onSubGridScrollEnd",thisObj:e}),t.addPartner(e.fakeScroller,"x"),t.addPartner(e.header.scrollable,"x"),t.addPartner(e.footer.scrollable,"x"),e.refreshFakeScroll()}onSubGridScrollEnd(){const e=this;e.forceScrollUpdate||e.syncScrollingPartners(),e.scrolling=!1,Mr.scrollBarWidth||(e.grid.virtualScrollers.classList.remove("b-scrolling"),e.hideOverlayScroller())}onSubGridScroll(){this.forceScrollUpdate?(this.syncScrollingPartners(),this.forceScrollUpdate=!1):this.syncPartnersOnFrame()}showOverlayScroller(){this.hideOverlayScroller.cancel(),this.virtualScrollerElement.classList.add("b-show-virtual-scroller")}hideOverlayScroller(){this.virtualScrollerElement.classList.remove("b-show-virtual-scroller")}set scrolling(e){this._scrolling=e}get scrolling(){return this._scrolling}syncScrollingPartners(e=!0){const t=this,{grid:n}=t;!t.scrolling&&e&&(t.scrolling=!0,Mr.scrollBarWidth||(n.virtualScrollers.classList.add("b-scrolling"),t.showOverlayScroller())),n.trigger("horizontalScroll",{subGrid:t,grid:n,scrollLeft:t.scrollable.element.scrollLeft,scrollX:t.scrollable.x})}scrollColumnIntoView(e,t){const{columns:n,header:r}=this,i=r.scrollable;if(e=e instanceof Kh?e:n.get(e)||n.getById(e)||n.getAt(e)){const n=r.getHeader(e.id);if(n)return i.scrollIntoView(xn.from(n,null,!0),t)}}onAddRow({rows:e,isExport:t}){const n=this,r=n.rowElementConfig,i=document.createDocumentFragment();e.forEach((e=>{const t=Mr.createElement(r);i.appendChild(t),e.addElement(n.region,t),n.fixCellWidths(t)})),t||(n.fixRowWidthsInSafariEdge(),n.element.insertBefore(i,n.insertRowsBefore))}get rowElements(){return this.fromCache(".b-grid-row",!0)}clearRows(){this.emptyCache();const e=this.element.querySelectorAll(".b-grid-row"),t=document.createRange();e.length&&(t.setStartBefore(e[0]),t.setEndAfter(e[e.length-1]),t.deleteContents())}addNewRowElement(){const e=Mr.append(this.element,this.rowElementConfig);return this.fixCellWidths(e),e}get store(){return this.grid.store}get rowManager(){var e;return null===(e=this.grid)||void 0===e?void 0:e.rowManager}toggleTransitionClasses(e=!1){const t=this,n=t.grid,r=n.getSubGrid(n.getNextRegion(t.region)),i=n.resolveSplitter(r);r.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),r.header.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),t.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),t.header.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),i.classList[e?"remove":"add"]("b-grid-splitter-animate")}get collapsed(){return this._collapsed}set collapsed(e){this.isConfiguring?this._collapsed=e:e?this.collapse():this.expand()}async collapse(){const e=this,{grid:t,element:n}=e,r=t.getSubGrid(t.getNextRegion(e.region)),i=e.splitterElement?e:e.previousSibling;let{_beforeCollapseState:s}=e,o=0;return t.eachSubGrid((t=>{t!==e&&!t._collapsed&&++o})),0===o&&await r.expand(),new Promise((t=>{if(!s){s=e._beforeCollapseState={};let i=!1;e.width&&(i=!0,e.on({afterinternalresize:()=>{t(e)},thisObj:e,once:!0})),s.width=e.width,s.elementWidth=n.style.width,""===r.element.style.flex&&(s.nextRegionWidth=r.width,r.width="",r.flex="1"),""!==n.style.flex&&(s.flex=n.style.flex,e.header.element.style.flex=n.style.flex=""),n.classList.add("b-grid-subgrid-collapsed"),e.virtualScrollerElement.classList.add("b-collapsed"),e.header.element.classList.add("b-collapsed"),e.footer.element.classList.add("b-collapsed"),e._collapsed=!0,e.width="",i||(e.syncParallelSplitters(!0),t(!1))}})).then((n=>{var r;e.isDestroyed||(!1!==n&&(t.refreshVirtualScrollbars(),e.syncParallelSplitters(!0),null===(r=i.startSplitterButtonSyncing)||void 0===r||r.call(i)),t.trigger("subGridCollapse",{subGrid:e}),t.afterToggleSubGrid({subGrid:e,collapsed:!0}))}))}async expand(){const e=this,{grid:t,_beforeCollapseState:n}=e,r=t.getSubGrid(t.getNextRegion(e.region)),i=e.splitterElement?e:e.previousSibling;return new Promise((t=>{if(null!=n){let s=!1;e.width!==n.elementWidth&&(s=!0,e.on({afterinternalresize(){e.setTimeout((()=>t(e)),10)},thisObj:e,once:!0})),n.nextRegionWidth&&(r.width=n.nextRegionWidth,r.flex=null),e.element.classList.remove("b-grid-subgrid-collapsed"),e._collapsed=!1,e.virtualScrollerElement.classList.remove("b-collapsed"),e.header.element.classList.remove("b-collapsed"),e.footer.element.classList.remove("b-collapsed"),n.flex?(e.width=n.width,e.header.flex=e.flex=n.flex,e.footer.flex=n.flex,e._width=null):e.width=n.elementWidth,e.element.classList.remove("b-grid-subgrid-collapsed"),e._collapsed=!1,s?(i.stopSplitterButtonSyncing(),e.syncParallelSplitters(!1)):t(!1),delete e._beforeCollapseState}})).then((n=>{!1!==n&&(t.trigger("subGridExpand",{subGrid:e}),t.afterToggleSubGrid({subGrid:e,collapsed:!1}))}))}}v(Km,"delayable",{hideOverlayScroller:1e3}),Km.initClass(),Km._$name="SubGrid";var Xm=e=>class extends(e||Te){static get $name(){return"GridSubGrids"}static get properties(){return{subGrids:{}}}changeSubGridConfigs(e){const t=this,n=new Set;for(const r of t.columns){const{region:t}=r;t&&(e[t]||(e[t]={}),n.add(t))}e.normal&&sn.isEmpty(e.normal)&&(e.normal=rp.defaultConfig.subGridConfigs.normal);for(const r of n)t.createSubGrid(r,e[r]);return t.items=t.subGrids,e}createSubGrid(e,t=null){const n=this,r=n.columns.makeChained((t=>t.region===e),["region"]),i=sn.assign({type:"subgrid",id:`${n.id}-${e}Subgrid`,parent:n,grid:n,region:e,headerClass:n.headerClass,footerClass:n.footerClass,columns:r,weight:e},t||n.subGridConfigs[e]);let s=!1;i.flex||i.width||(i.width=r.totalFixedWidth,s=!0);const o=n.subGrids[e]=Km.create(i);return o.hasCalculatedWidth=s,e===n.regions[0]&&(o.isFirstRegion=!0),o}onChildAdd(e){if(e.isSubGrid){const t=this,{items:n,headerContainer:r,virtualScrollers:i,footerContainer:s}=t,o=2*n.indexOf(e);t.hideHeaders||(Mr.insertAt(r,e.headerSplitter,o),Mr.insertAt(r,e.header.element,o)),Mr.insertAt(i,e.scrollerSplitter,o),Mr.insertAt(i,e.virtualScrollerElement,o),Mr.insertAt(s,e.footerSplitter,o),Mr.insertAt(s,e.footer.element,o),n.forEach(((e,t)=>{t<n.length-1&&e.showSplitter()}))}return super.onChildAdd(e)}onChildRemove(e){if(super.onChildRemove(e),e.isSubGrid){const{items:t}=this;delete this.subGrids[e.region],ke.remove(this.regions,e.region),e.destroy(),t.length&&t[t.length-1].hideSplitter()}}doDestroy(){this.eachSubGrid((e=>e.destroy())),super.doDestroy()}eachSubGrid(e,t=null){this.items.forEach(((n,r)=>{n.isSubGrid&&e.call(t||n,n,r++)}))}callEachSubGrid(e,...t){let n=null;return this.items.forEach(((r,i)=>{if(r.isSubGrid&&r[e]){const s=r[e](...t);0===i&&(n=s)}})),n}get regions(){return this.items.map((e=>e.region))}getLastRegions(){const e=this.regions.slice(-2);return 2===e.length?e:[e[0],e[0]]}getNextRegion(e){const t=this.regions;return t[t.indexOf(e)+1]||t[t.length-2]}getPreviousRegion(e){return this.regions[this.regions.indexOf(e)-1]}getSubGrid(e){return this.subGrids[e]}getSubGridFromColumn(e){return e=e instanceof Kh?e:this.columns.getById(e)||this.columns.get(e),this.getSubGrid(e.region)}resolveSplitter(e){const t=this.getLastRegions();let n=e instanceof Km?e.region:e;return t[1]===n&&(n=t[0]),this.subGrids[n].splitterElement}get widgetClass(){}};const Zm=new String,Jm=ot.mergeLocales(Da,{ColumnPicker:{column:"Column",columnsMenu:"Columns",hideColumn:"Hide column",hideColumnShort:"Hide",newColumns:"New columns"},Filter:{applyFilter:"Apply filter",filter:"Filter",editFilter:"Edit filter",on:"On",before:"Before",after:"After",equals:"Equals",lessThan:"Less than",moreThan:"More than",removeFilter:"Remove filter",disableFilter:"Disable filter"},FilterBar:{enableFilterBar:"Show filter bar",disableFilterBar:"Hide filter bar"},Group:{group:"Group",groupAscending:"Group ascending",groupDescending:"Group descending",groupAscendingShort:"Ascending",groupDescendingShort:"Descending",stopGrouping:"Stop grouping",stopGroupingShort:"Stop"},HeaderMenu:{moveBefore:e=>`Move before "${e}"`,moveAfter:e=>`Move after "${e}"`,collapseColumn:"Collapse column",expandColumn:"Expand column"},ColumnRename:{rename:"Rename"},MergeCells:{mergeCells:"Merge cells",menuTooltip:"Merge cells with same value when sorted by this column"},Search:{searchForValue:"Search for value"},Sort:{sort:"Sort",sortAscending:"Sort ascending",sortDescending:"Sort descending",multiSort:"Multi sort",removeSorter:"Remove sorter",addSortAscending:"Add ascending sorter",addSortDescending:"Add descending sorter",toggleSortAscending:"Change to ascending",toggleSortDescending:"Change to descending",sortAscendingShort:"Ascending",sortDescendingShort:"Descending",removeSorterShort:"Remove",addSortAscendingShort:"+ Ascending",addSortDescendingShort:"+ Descending"},Column:{columnLabel:e=>`${e.text?`${e.text} column. `:""}SPACE for context menu${e.sortable?", ENTER to sort":""}`,cellLabel:Zm},Checkbox:{toggleRowSelect:"Toggle row selection",toggleSelection:"Toggle selection of entire dataset"},RatingColumn:{cellLabel:e=>{var t;return`${e.text?e.text:""} ${null!==(t=e.location)&&void 0!==t&&t.record?`rating : ${e.location.record[e.field]||0}`:""}`}},GridBase:{loadFailedMessage:"Data loading failed!",syncFailedMessage:"Data synchronization failed!",unspecifiedFailure:"Unspecified failure",networkFailure:"Network error",parseFailure:"Failed to parse server response",serverResponse:"Server response:",noRows:"No records to display",moveColumnLeft:"Move to left section",moveColumnRight:"Move to right section",moveColumnTo:e=>`Move column to ${e}`},CellMenu:{removeRow:"Delete"},RowCopyPaste:{copyRecord:"Copy",cutRecord:"Cut",pasteRecord:"Paste"},PdfExport:{"Waiting for response from server":"Waiting for response from server...","Export failed":"Export failed","Server error":"Server error","Generating pages":"Generating pages...","Click to abort":"Abort"},ExportDialog:{width:"40em",labelWidth:"12em",exportSettings:"Export settings",export:"Export",exporterType:"Control pagination",cancel:"Cancel",fileFormat:"File format",rows:"Rows",alignRows:"Align rows",columns:"Columns",paperFormat:"Paper format",orientation:"Orientation",repeatHeader:"Repeat header"},ExportRowsCombo:{all:"All rows",visible:"Visible rows"},ExportOrientationCombo:{portrait:"Portrait",landscape:"Landscape"},SinglePageExporter:{singlepage:"Single page"},MultiPageExporter:{multipage:"Multiple pages",exportingPage:({currentPage:e,totalPages:t})=>`Exporting page ${e}/${t}`},MultiPageVerticalExporter:{multipagevertical:"Multiple pages (vertical)",exportingPage:({currentPage:e,totalPages:t})=>`Exporting page ${e}/${t}`},RowExpander:{loading:"Loading"}});lt.registerLocale("En",{desc:"English",locale:Jm});const Qm=new Promise((e=>e())),ep="GridBase:store",tp={block:"nearest",inline:"nearest"},np={dataset:1,pageLoad:1,filter:1};class rp extends(kc.mixin(Ur,oi,km,Am,Pm,$m,Hm,Wm,Xm,Id)){static get $name(){return"GridBase"}static get type(){return"gridbase"}static get delayable(){return{onGridVerticalScroll:{type:"raf"},bufferedAfterColumnsResized:250,bufferedElementResize:250}}static get configurable(){return{autoHeight:null,enableSticky:null,enableTextSelection:null,fillLastColumn:!0,positionMode:"translate",showDirty:null,subGridConfigs:{normal:{flex:1}},store:{value:{},$config:"nullify"},rowManager:{value:{},$config:["nullify","lazy"]},scrollManager:{value:{},$config:["nullify","lazy"]},columns:{value:[],$config:"nullify"},minHeight:"10em",hideFooters:!0,contentElMutationObserver:!1,trapFocus:!1,ariaElement:"bodyElement",cellTabIndex:-1,rowCls:{value:"b-grid-row",$config:{merge:this.mergeCls}},cellCls:{value:"b-grid-cell",$config:{merge:this.mergeCls}},emptyText:"L{noRows}"}}static get defaultConfig(){return{rowHeight:null,fixedRowHeight:null,defaultRowHeight:45,fullRowRefresh:!0,hideHeaders:null,preserveScrollOnDatasetChange:null,preserveFocusOnDatasetChange:!0,data:null,defaultRegion:"normal",destroyStore:null,maskDefaults:{cover:"body",target:"element"},columnLines:!0,resizeToFitIncludesHeader:!0,animateRemovingRows:!0,disableGridRowModelWarning:null,headerClass:Tm,footerClass:Dm,testPerformance:!1,rowScrollMode:"move",monitorResize:!0,features:!0,scrollable:{overflowY:!0},scrollerClass:Rm,refreshSuspended:0,transitionDuration:500,contextMenuTriggerEvent:"contextmenu",localizableProperties:["emptyText"],asyncEventSuffix:"",testConfig:{transitionDuration:50}}}static getLKey(){return"6817134a-cdf3-11e8-bff0-d094661a2df4"}static get properties(){return{_selectedRecords:[],_verticalScrollHeight:0,virtualScrollHeight:0,_scrollTop:null}}finishConfigure(e){const t=this,{initScroll:n}=t;t.initScroll=()=>!t.scrollInitialized&&n.call(t),super.finishConfigure(e),lt.on({locale:"onBeforeLocaleChange",prio:1,thisObj:t}),lt.on({locale:"onLocaleChange",prio:-1,thisObj:t}),zr.on({theme:"onThemeChange",thisObj:t}),t.on({subGridExpand:"onSubGridExpand",prio:-1,thisObj:t}),t.bufferedFixElementHeights=t.buffer("fixElementHeights",350,t),t.setGridClassList(t.element.classList)}onSubGridExpand(){this.renderContents()}onBeforeLocaleChange(){this._suspendRenderContentsOnColumnsChanged=!0}onLocaleChange(){this._suspendRenderContentsOnColumnsChanged=!1,this.isPainted&&this.renderContents()}finalizeInit(){super.finalizeInit(),this.store.isLoading&&this.onStoreBeforeRequest()}changeScrollManager(e,t){return null==t||t.destroy(),e?ru.new({element:this.element,owner:this},e):null}doDestroy(){var e;const t=this;t.detachListeners(ep),null===(e=t.scrollManager)||void 0===e||e.destroy();for(const e of Object.values(t.features)){var n;null===(n=e.destroy)||void 0===n||n.call(e)}t._focusedCell=null,t.columns.destroy(),super.doDestroy()}setGridClassList(e){Object.values(this.features).forEach((t=>{if(t.disabled)return;let n;n=Object.prototype.hasOwnProperty.call(t.constructor,"featureClass")?t.constructor.featureClass:`b-${t instanceof Te?t.$$name:t.constructor.name}`,n&&e.add(n.toLowerCase())}))}compose(){const{autoHeight:e,enableSticky:t,enableTextSelection:n,fillLastColumn:r,positionMode:i,showDirty:s}=this;return{class:{[`b-grid-${i}`]:1,"b-enable-sticky":t,"b-grid-notextselection":!n,"b-autoheight":e,"b-fill-last-column":r,"b-show-dirty":s}}}get cellCls(){const{_cellCls:e}=this;return e.value||e}get bodyConfig(){const{autoHeight:e,hideFooters:t,hideHeaders:n}=this;return{reference:"bodyElement",className:{"b-autoheight":e,"b-grid-panel-body":1},[this.hasHeader?"ariaLabelledBy":""]:`${this.id}-panel-title`,children:{headerContainer:{tag:"header",role:"row","aria-rowindex":1,className:{"b-grid-header-container":1,"b-hidden":n}},bodyContainer:{className:"b-grid-body-container",tabIndex:-1,role:"presentation",children:{verticalScroller:{className:"b-grid-vertical-scroller"}}},virtualScrollers:{className:"b-virtual-scrollers b-hide-display",style:y.isFirefox&&Mr.scrollBarWidth?{height:`${Mr.scrollBarWidth}px`}:void 0},footerContainer:{tag:"footer",className:{"b-grid-footer-container":1,"b-hidden":t}}}}}get contentElement(){return this.verticalScroller}get overflowElement(){return this.bodyContainer}updateHideFooters(e){var t;null===(t=this.footerContainer)||void 0===t||t.classList[e?"add":"remove"]("b-hidden")}changeColumns(e,t){const n=this;if(!e&&t)return n.isDestroying?t.owner===n&&t.destroy():t.removeAll(),t;if(e.isStore)return(null==t?void 0:t.owner)===n&&t.destroy(),e.grid=n,e;if(Array.isArray(e)){if(t){n._suspendRenderContentsOnColumnsChanged=!0;const r=t.allRecords.filter((t=>!e.includes(t)&&t!==n.checkboxSelectionColumn));return t.remove(t.allRecords,!0),r.forEach((e=>{var t;return null===(t=e.destroy)||void 0===t?void 0:t.call(e)})),t.data=e,n._suspendRenderContentsOnColumnsChanged=!1,t}e={data:e}}if(t)throw new Error("Replacing ColumnStore is not supported");return Jh.new({grid:n,owner:n},e)}updateColumns(e,t){var n;const r=this;var i,s;null===(n=super.updateColumns)||void 0===n||n.call(this,e,t),e.on({refresh:r.onColumnsChanged,change:r.onColumnsChanged,sort:r.onColumnsChanged,thisObj:r}),e.on((i=r.onColumnsResized,s=r,{update:({store:e,record:t,changes:n})=>{let r=!0;return("width"in n||"minWidth"in n||"maxWidth"in n||"flex"in n)&&(r=i.call(s,{store:e,record:t,changes:n})),r}})),y.isTouchDevice&&(r.touch=!0,e.forEach((e=>{const{touchConfig:t}=e;t&&e.applyState(t)}))),r.bodyElement.setAttribute("aria-colcount",e.visibleColumns.length)}onColumnsChanged({type:e,action:t,changes:n,record:r,records:i,isMove:s}){const o=n&&1===Object.keys(n).length;if("refresh"===e&&"batch"!==t||"update"===t&&o&&"parentIndex"in n)return;const a=this,{columns:l,checkboxSelectionColumn:c}=a;if(a.isPainted&&(!s||"remove"!==t)){if("add"===t)for(const e of i){const{region:t}=e;a.subGrids[t]||a.add(a.createSubGrid(t,a.subGridConfigs[t]))}if("update"===t){if("width"in n||"minWidth"in n||"maxWidth"in n||"flex"in n){const e=r.region;return l.visibleColumns.forEach((t=>{t.region===e&&t.repaintOnResize&&a.refreshColumn(t)})),void a.afterColumnsChange({action:t,changes:n,column:r})}if("text"in n&&o)return void r.subGrid.refreshHeader();if("hidden"in n){const e=a.getSubGridFromColumn(r.id);e.header.fixHeaderWidths(),e.footer.fixFooterWidths(),e.updateHasFlex()}}if("dataset"===t||"batch"===t||"update"===t&&"region"in n){const e=l.getDistinctValues("region"),{toRemove:t,toAdd:n}=ke.delta(e,a.regions,!0);a.remove(t.map((e=>a.getSubGrid(e)))),a.add(n.map((e=>a.createSubGrid(e))))}if(c&&!l.includes(c)){const e=l.indexOf(l.findRecord("type","rownumber"))+1;l.insert(e,c,!0)}a._suspendRenderContentsOnColumnsChanged||a.renderContents(),a.syncFlexedSubCols(),a.bodyElement.setAttribute("aria-colcount",l.visibleColumns.length),a.afterColumnsChange({action:t,changes:n,column:r})}}onColumnsResized({changes:e,record:t}){const n=this;if(n.isConfiguring)return;const r=Mr.setLength(t.width),i=Mr.setLength(t.minWidth),s=Mr.setLength(t.maxWidth),o=n.getSubGridFromColumn(t.id);if(o.header.fixHeaderWidths(),o.footer.fixFooterWidths(),o.updateHasFlex(),!t.flex||!t.childLevel){n.cellEls&&t===n.lastColumnResized||(n.cellEls=Mr.children(n.element,`.b-grid-cell[data-column-id="${t.id}"]`),n.lastColumnResized=t);for(const o of n.cellEls){var a;"width"in e&&(o.style.width=r),"minWidth"in e&&(o.style.minWidth=i),"maxWidth"in e&&(o.style.maxWidth=s),"flex"in e&&(o.style.flex=null!==(a=t.flex)&&void 0!==a?a:null)}}n.resizingColumns||n.afterColumnsResized(),n.syncFlexedSubCols()}afterColumnsResized(){const e=this;e.eachSubGrid((e=>{e.collapsed||(e.fixWidths(),e.fixRowWidthsInSafariEdge())})),e.lastColumnResized=e.cellEls=null,e.bufferedAfterColumnsResized(),e.onHeightChange()}syncFlexedSubCols(){const e=this.columns.query((e=>e.flex&&e.childLevel&&e.element));if(e)for(const t of e){const e=t.element.getBoundingClientRect().width,n=Mr.children(this.element,`.b-grid-cell[data-column-id="${t.id}"]`);for(const t of n)t.style.flex=`0 0 ${e}px`}}bufferedAfterColumnsResized(){this.columns.usesAutoHeight&&this.refreshRows(),this.refreshVirtualScrollbars(),this.eachSubGrid((e=>{e.collapsed||e.refreshFakeScroll()}))}bufferedElementResize(){this.refreshRows()}onInternalResize(e,t,n,r,i){Mr.scrollBarWidth&&t<r&&this.eachSubGrid((e=>{e.flex&&e.onElementResize(e.element)})),super.onInternalResize(...arguments),this.isPainted&&t!==r&&this.columns.usesFlexAutoHeight&&this.bufferedElementResize()}changeRowManager(e,t){const n=this;if(n._isRowMeasured||n.measureRowHeight(),null==t||t.destroy(),e){const t=Em.new({grid:n,rowHeight:n.rowHeight,rowScrollMode:n.rowScrollMode||"move",autoHeight:n.autoHeight,fixedRowHeight:n.fixedRowHeight,listeners:{changeTotalHeight:"onRowManagerChangeTotalHeight",requestScrollChange:"onRowManagerRequestScrollChange",thisObj:n}},e);return n.relayEvents(t,["beforeRenderRow","renderRow"]),n._rowManager=null,t}}getRowHeight(e){return e.rowHeight}processRowHeight(e,t){}bindStore(e){const t=this.asyncEventSuffix;e.on({name:ep,[`refresh${t}`]:"onStoreDataChange",[`add${t}`]:"onStoreAdd",[`remove${t}`]:"onStoreRemove",[`replace${t}`]:"onStoreReplace",[`removeAll${t}`]:"onStoreRemoveAll",[`move${t}`]:e.tree?null:"onFlatStoreMove",change:"relayStoreDataChange",idChange:"onStoreRecordIdChange",update:"onStoreUpdateRecord",beforeRequest:"onStoreBeforeRequest",afterRequest:"onStoreAfterRequest",exception:"onStoreException",commit:"onStoreCommit",thisObj:this}),super.bindStore(e)}unbindStore(e){this.detachListeners(ep),this.destroyStore&&e.destroy()}changeStore(e){return null==e?null:("string"==typeof e&&(e=As.getStore(e)),e.isStore||((e=sn.assign({data:this.data,tree:Boolean(null===(t=this.initialConfig.features)||void 0===t?void 0:t.tree)},e)).data||delete e.data,e.modelClass||(e.modelClass=hg),e=new(e.readUrl?Ls:As)(e)),e);var t}updateStore(e,t){var n;const r=this;var i;null===(n=super.updateStore)||void 0===n||n.call(this,e,t),t&&r.unbindStore(t),e&&(t&&r.deselectAll(),r.bindStore(e)),r.trigger("bindStore",{store:e,oldStore:t}),r.isDestroying||!r.isPainted||r.refreshSuspended||null===(i=r._rowManager)||void 0===i||i.reinitialize()}onStoreUpdateRecord({source:e,record:t,changes:n}){const r=this;if(!r.refreshSuspended)if(r.forceFullRefresh)r.rowManager.refresh(),r.forceFullRefresh=!1;else{let i;if(t.isFieldModified("id")&&(i=r.getRowFor(t.meta.modified.id)),i=i||r.getRowFor(t),!i)return;if(r.fullRowRefresh||t.isSpecialRow){const n=e.indexOf(t);-1!==n&&i.render(n,t)}else r.columns.visibleColumns.forEach((e=>{const t=e.field;if(!e.constructor.simpleRenderer||Object.prototype.hasOwnProperty.call(e.data,"renderer")||n[t]){const e=i.getCell(t);e&&i.renderCell(e)}}))}}refreshFromRowOnStoreAdd(e,t){const n=this,{rowManager:r}=n;r.renderFromRow(e),r.trigger("changeTotalHeight",{totalHeight:r.totalHeight}),1===n.store.count&&n.callEachSubGrid("refreshFakeScroll")}onMaskAutoClose(e){super.onMaskAutoClose(e),this.toggleEmptyText()}onStoreAdd({source:e,records:t,index:n,oldIndex:r,isChild:i,oldParent:s,parent:o,isMove:a,isExpandAll:l}){if(!this.isPainted||l)return;const c=a&&t.some((t=>{if(a[t.id]){const n=e.getById(t.meta.modified.parentId);return(null==n?void 0:n.isExpanded(e))&&(null==n?void 0:n.ancestorsExpanded(e))}}));if(i&&!t[0].ancestorsExpanded(e)&&!c){if(!o.isLeaf){const e=this.rowManager.getRowById(o);e&&this.rowManager.renderRows([e])}return}this.rowManager.calculateRowCount(!1,!0,!0),e.isFiltered&&(n=e.indexOf(t[0]));const d=this,{rowManager:u}=d,{topIndex:h,rows:g,rowCount:m}=u,p=u.topIndex+u.rowCount-1,f=n,v=n+t.length-1,y=p>=e.count-t.length-1;s||r>-1||i&&a?u.refresh():f>=h&&f<h+m?d.refreshFromRowOnStoreAdd(g[f-h],...arguments):v>=h&&v<h+m?u.refresh():(y&&n>p&&u.fillBelow(d._scrollTop||0),u.estimateTotalHeight(!0))}onStoreException({action:e,type:t,response:n,exceptionType:r,error:i}){var s;const o=this;let a;switch(t){case"server":a=n.message||o.L("L{unspecifiedFailure}");break;case"exception":a="network"===r?o.L("L{networkFailure}"):(null==i?void 0:i.message)||(null==n||null===(s=n.parsedJson)||void 0===s?void 0:s.message)||o.L("L{parseFailure}")}o.applyMaskError(`<div class="b-grid-load-failure">\n                <div class="b-grid-load-fail">${o.L("read"===e?"L{loadFailedMessage}":"L{syncFailedMessage}")}</div>\n                ${null!=n&&n.url?`<div class="b-grid-load-fail">${n.url}</div>`:""}\n                <div class="b-grid-load-fail">${o.L("L{serverResponse}")}</div>\n                <div class="b-grid-load-fail">${a}</div>\n            </div>`)}onStoreDataChange({action:e,changes:t,source:n}){if(this.refreshSuspended||!this.rowManager)return;const r=this,i=n.isGrouped&&t&&n.groupers.some((e=>e.field in t));super.onStoreDataChange&&super.onStoreDataChange(...arguments),"dataset"===e&&r.rowManager.clearKnownHeights(),r.isPainted&&!i&&r.renderRows(Boolean(!(e in np)||r.preserveScrollOnDatasetChange)),r.toggleEmptyText()}onStoreRecordIdChange(){super.onStoreRecordIdChange&&super.onStoreRecordIdChange(...arguments)}onStoreBeforeRequest(){this.applyLoadMask()}onStoreAfterRequest(e){this.loadMask&&!e.exception&&(this.masked=null,this.toggleEmptyText())}needsFullRefreshOnStoreRemove({isCollapse:e}){const t=this._features;return(null==t?void 0:t.group)&&!t.group.disabled||(null==t?void 0:t.groupSummary)&&!t.groupSummary.disabled||this.store.tree&&!e&&this.store.modelClass.convertEmptyParentToLeaf}onStoreRemove({records:e,isCollapse:t,isChild:n,isMove:r,isCollapseAll:i}){if(!this.isPainted||r||i)return;super.onStoreRemove&&super.onStoreRemove(...arguments);const s=this,{rowManager:o}=s;if(o.invalidateKnownHeight(e),s.animateRemovingRows&&!t&&!n){const t=e.reduce(((e,t)=>{const n=o.getRowById(t.id);return n&&e.push(n),e}),[]);if(t.length){const e=t[0];return s.isAnimating=!0,_n.onTransitionEnd({element:e._elementsArray[0],property:"left",duration:s.transitionDuration,thisObj:s,handler:()=>{s.isAnimating=!1,t.forEach((e=>!e.isDestroyed&&e.removeCls("b-removing"))),o.refresh(),s.trigger("rowRemove"),s.afterRemove(arguments[0])}}),void t.forEach((e=>e.addCls("b-removing")))}}if(s.needsFullRefreshOnStoreRemove(...arguments))o.refresh(),s.afterRemove(arguments[0]);else{const n=o.topIndex;if(o.calculateRowCount(!1,!0,!0),o.topIndex!==n)o.renderFromRow(o.topRow);else{const{rows:t}=o,n=e.reduce(((e,n)=>{const r=o.getRowById(n.id);return r&&(e=Math.min(e,t.indexOf(r))),e}),t.length);t[n]?!s.refreshSuspended&&o.renderFromRow(t[n]):o.trigger("changeTotalHeight",{totalHeight:o.totalHeight})}s.trigger("rowRemove",{isCollapse:t}),s.afterRemove(arguments[0])}}onFlatStoreMove({from:e,to:t}){const{rowManager:n}=this,{topIndex:r,rowCount:i}=n,[s,o]=[e,t].sort(((e,t)=>e-t));s>=r&&s<r+i?n.renderFromRow(n.rows[s-r]):o>=r&&o<r+i&&n.refresh()}onStoreReplace({records:e,all:t}){const{rowManager:n}=this;if(t)n.clearKnownHeights(),n.refresh();else{const t=e.reduce(((e,[,t])=>{const n=this.getRowFor(t);return n&&e.push(n),e}),[]);n.invalidateKnownHeight(e),n.renderRows(t)}}relayStoreDataChange(e){if(this.ariaElement.setAttribute("aria-rowcount",this.store.count+1),!this.project)return this.trigger("dataChange",f(f({},e),{},{store:e.source,source:this}))}onStoreRemoveAll(){super.onStoreRemoveAll&&super.onStoreRemoveAll(...arguments),this.isPainted&&(this.rowManager.clearKnownHeights(),this.renderRows(!1),this.toggleEmptyText())}onStoreCommit({changes:e}){if(this.showDirty&&e.modified.length){const t=[];e.modified.forEach((e=>{const n=this.rowManager.getRowFor(e);n&&t.push(n)})),this.rowManager.renderRows(t)}}get data(){return this._store?this._store.records:this._data}set data(e){this._store?this._store.data=e:this._data=e}populateHeaderMenu({column:e,items:t}){const n=this,{subGrids:r,regions:i}=n,{parent:s}=e;let o=!0;Object.entries(r).forEach((([a,l])=>{if(!l.sealedColumns&&e.draggable&&a!==e.region&&(!s&&r[e.region].columns.count>1||s&&s.children.length>1)){const s=l.element.compareDocumentPosition(r[e.region].element)===document.DOCUMENT_POSITION_PRECEDING,c=n.rtl?!s:s,d=i.length>2?n.L("L{moveColumnTo}",n.optionalL(a)):n.L(c?"L{moveColumnRight}":"L{moveColumnLeft}");t[`${a}Region`]={targetSubGrid:a,text:d,icon:"b-fw-icon b-icon-column-move-"+(c?"right":"left"),separator:o,onItem:({item:t})=>{e.traverse((e=>e.region=a)),n.columns.insert(n.columns.indexOf(r[t.targetSubGrid].columns.last)+1,e),n.scrollColumnIntoView(e)}},o=!1}}))}populateCellMenu({record:e,items:t}){}getColumnDragToolbarItems(e,t){return t}normalizeCellContext(e){const t=this,{columns:n}=t;return e.isLocation?e:e.isModel?new Gh({grid:t,id:e.id,columnId:n.visibleColumns[0].id}):new Gh(Object.assign({grid:t},e))}getCell(e){const{store:t,columns:n}=this,{visibleColumns:r}=this.columns,i=isNaN(e.row)?isNaN(e.rowIndex)?t.indexOf(e.record||e.id):e.rowIndex:e.row,s=isNaN(e.column)?isNaN(e.columnIndex)?r.indexOf(e.column||n.getById(e.columnId)||n.get(e.field)||r[0]):e.columnIndex:e.column;return i>-1&&i<t.count&&s>-1&&s<r.length&&this.normalizeCellContext(e).cell}getHeaderElement(e){return e.isModel&&(e=e.id),this.fromCache(`.b-grid-header[data-column-id="${e}"]`)}getHeaderElementByField(e){const t=this.columns.get(e);return t?this.getHeaderElement(t):null}get bodyHeight(){return this._bodyHeight}get headerHeight(){const e=this;return e.isPainted&&!e._headerHeight&&(e._headerHeight=e.headerContainer.offsetHeight),e._headerHeight}get footerHeight(){const e=this;return e.isPainted&&!e._footerHeight&&(e._footerHeight=e.footerContainer.offsetHeight),e._footerHeight}get isTreeGrouped(){var e;return Boolean(null===(e=this.features.treeGroup)||void 0===e?void 0:e.isGrouped)}getRecordFromElement(e){const t=e.closest(".b-grid-row");return t?this.store.getAt(t.dataset.index):null}getColumnFromElement(e){const t=e.closest(".b-grid-cell, .b-grid-header");if(!t)return null;if(t.matches(".b-grid-header"))return this.columns.getById(t.dataset.columnId);const n=Ps.get(t);return this.columns.getById(n.columnId)}updateAutoHeight(e){sn.assertBoolean(e,"autoHeight")}get columnLines(){return this._columnLines}set columnLines(e){sn.assertBoolean(e,"columnLines"),Mr.toggleClasses(this.element,"b-no-column-lines",!e),this._columnLines=e}get keyMapElement(){return this.bodyElement}fixSizes(){this.callEachSubGrid("fixWidths");const e=this.headerContainer.querySelectorAll(".b-grid-header.b-depth-0");for(let t=0,{length:n}=e;t<n;t++)e[t].setAttribute("aria-colindex",t+1)}onRowManagerChangeTotalHeight({totalHeight:e,immediate:t}){return this.refreshTotalHeight(e,t)}refreshTotalHeight(e=this.rowManager.totalHeight,t=!1){const n=this;if(n.renderingRows||!n.isVisible)return!1;const r=n.scrollable,i=Math.abs(n.virtualScrollHeight-e),s=n._bodyRectangle.height;if(i){const o=e-s-n._scrollTop<2*s||n._verticalScrollHeight&&n._verticalScrollHeight-s<n._scrollTop;r.scrollHeight=n.virtualScrollHeight=e,n.isPainted&&(n.scrolling&&!o||i<100)&&!t?n.bufferedFixElementHeights():(n.virtualScrollHeightDirty&&n.virtualScrollHeightDirty(),n.bufferedFixElementHeights.cancel(),n.fixElementHeights())}}fixElementHeights(){const e=this,t=e.virtualScrollHeight,n=`${t}px`;e._verticalScrollHeight=t,e.verticalScroller.style.height=n,e.virtualScrollHeightDirty=!1,e.autoHeight&&(e.bodyContainer.style.height=n,e._bodyHeight=t,e.refreshBodyRectangle()),e.refreshVirtualScrollbars()}refreshBodyRectangle(){return this._bodyRectangle=xn.client(this.bodyContainer)}set scrolling(e){this._scrolling=e}get scrolling(){return this._scrolling}enableScrollingCloseToEdges(e){"string"==typeof e&&(e=this.subGrids[e]),this.scrollManager.startMonitoring({scrollables:[{element:e.scrollable.element,direction:"horizontal"},{element:this.scrollable.element,direction:"vertical"}]})}disableScrollingCloseToEdges(e){"string"==typeof e&&(e=this.subGrids[e]),this.scrollManager.stopMonitoring([e.element,this.scrollable.element])}onRowManagerRequestScrollChange({bottom:e}){this.scrollable.y=e-this.bodyHeight}initScroll(){const e=this,{scrollable:t}=e;e.scrollInitialized||(e.scrollInitialized=!0,t.contentElement=e.contentElement,t.on({scroll:"onGridVerticalScroll",scrollend:"onGridVerticalScrollEnd",thisObj:e}),e.callEachSubGrid("initScroll"),y.isMobileSafari&&(t.element.style.transform="translate3d(0, 0, 0)"))}onGridVerticalScroll({source:e}){const t=this,{y:n}=e;n!==t._scrollTop&&(t._scrollTop=n,t.scrolling||(t.scrolling=!0,t.eachSubGrid((e=>e.suspendResizeMonitor=!0))),t.rowManager.updateRenderedRows(n),t.afterScroll({scrollTop:n}),t.trigger("scroll",{scrollTop:n}))}onGridVerticalScrollEnd(){this.scrolling=!1,this.eachSubGrid((e=>e.suspendResizeMonitor=!1))}async scrollRowIntoView(e,t=tp){const n=this,r=t.block||"nearest",{rowManager:i}=n,s=n.store.getById(e);if(s){let e;if(-1===n.store.indexOf(s))return Qm;let a=n.scrollable,l=n.getRecordCoords(s);const c=xn.from(a.element);if(!l.virtual){let{column:e}=t;if(e){if(e.isModel||(e=n.columns.getById(e)||n.columns.get(e)),e){a=n.getSubGridFromColumn(e).scrollable;const t=xn.from(i.getRowFor(s).getCell(e.id));l.x=t.x,l.width=t.width}}else t.x=!1;return a.scrollIntoView(l,t)}{const d=l.block,u="nearest"!==r?t:{block:d};if(e=a.scrollIntoView(l,{block:"center"}),i.scrollTargetRecordId=s,i.updateRenderedRows(a.y,!0),l=n.getRecordCoords(s),i.lastScrollTop=a.y,l.virtual)return Qm;var o;t.animate?(a.suspendEvents(),"end"===r||"nearest"===r&&"end"===d?a.y-=c.bottom-l.bottom:("start"===r||"nearest"===r&&"start"===d)&&(a.y+=l.y-c.y),i.updateRenderedRows(a.y,!1,!0),"end"===d?a.y-=i.appendRowBuffer*i.rowHeight-1:a.y+=i.prependRowBuffer*i.rowHeight-1,a.scrollIntoView(n.getRecordCoords(s),Object.assign({},t,u)),a.resumeEvents()):(t.recursive||await e,await(null===(o=n.scrollRowIntoView)||void 0===o?void 0:o.call(n,s,Object.assign({recursive:!0},t,u))))}}}scrollColumnIntoView(e,t){return e=e instanceof Kh?e:this.columns.get(e)||this.columns.getById(e)||this.columns.getAt(e),this.getSubGridFromColumn(e).scrollColumnIntoView(e,t)}scrollCellIntoView(e,t){return this.scrollRowIntoView(e.id,Object.assign({column:e.columnId},"boolean"==typeof t?{animate:t}:t))}scrollToBottom(e){return this.scrollRowIntoView(this.store.last,e)}scrollToTop(e){return this.scrollable.scrollBy(0,-this.scrollable.y,e)}storeScroll(){const e=this,t=e.storedScrollState={scrollTop:e.scrollable.y,scrollLeft:{}};return e.eachSubGrid((e=>{t.scrollLeft[e.region]=e.scrollable.x})),t}restoreScroll(e=this.storedScrollState){this.eachSubGrid((t=>{const n=e.scrollLeft[t.region];var r;null!=n&&(t.scrollable.updateX(n),t.header.scrollable.updateX(n),t.footer.scrollable.updateX(n),null===(r=t.fakeScroller)||void 0===r||r.updateX(n))})),this.scrollable.updateY(e.scrollTop)}beginGridMeasuring(){const e=this;if(e.$measureCellElements||(e.$measureCellElements=Mr.createElement({className:"b-grid-subgrid "+(!e._isRowMeasured&&e.hasFeature("stripe")?"b-stripe":""),reference:"subGridElement",style:{position:"absolute",top:"-10000px",left:"-100000px",visibility:"hidden",contain:"strict"},children:[{className:"b-grid-row",reference:"rowElement",children:[{className:"b-grid-cell",reference:"cellElement",style:{width:"auto",contain:y.isFirefox?"layout paint":"layout style paint"}}]}]})),e.getConfig("element"),e.verticalScroller.appendChild(e.$measureCellElements.subGridElement),!e.rendered){const t=e.appendTo||e.insertBefore||document.body,n=Mr.getRootElement("string"==typeof t?document.getElementById(t):t);e.adopt&&n.contains(e.element)||(n.appendChild(e.element),e.$removeAfterMeasuring=!0)}return e.$measureCellElements}endGridMeasuring(){this.$removeAfterMeasuring&&(this.element.remove(),this.$removeAfterMeasuring=!1),this.$measureCellElements.subGridElement.remove()}measureRowHeight(){const e=this,{rowElement:t}=e.beginGridMeasuring(),n=Mr.getStyleValue(t,["height","border-top-width","border-bottom-width"]),r=parseInt(n.height),i=y.isFirefox?globalThis.devicePixelRatio/Math.max(Math.trunc(globalThis.devicePixelRatio),1):1,s=n["border-top-width"]?Math.round(i*parseFloat(n["border-top-width"])):0,o=n["border-bottom-width"]?Math.round(i*parseFloat(n["border-bottom-width"])):0;null!=e.rowHeight&&e.rowHeight!==e._rowHeightFromStyle||(e.rowHeight=!isNaN(r)&&r?r:e.defaultRowHeight,e._rowHeightFromStyle=e.rowHeight),e._rowBorderHeight=s+o,e._isRowMeasured=!0,e.endGridMeasuring()}onThemeChange({theme:e}){this.whenVisible("measureRowHeight"),this.trigger("theme",{theme:e})}refreshRows(e=!1){const{element:t,rowManager:n}=this;t.classList.add("b-notransition"),e?n.returnToTop():n.refresh(),t.classList.remove("b-notransition")}refreshColumn(e){e.isVisible&&(e.isLeaf?this.rowManager.forEach((t=>t.renderCell(t.getCell(e.id)))):e.children.forEach((e=>this.refreshColumn(e))))}refreshVirtualScrollbars(){const e=this,{headerContainer:t,footerContainer:n,virtualScrollers:r,scrollable:i,hasVerticalOverflow:s}=e,{classList:o}=r,a=!o.contains("b-hide-display"),l=Object.values(e.subGrids).some((e=>e.overflowingHorizontally)),c=l!==a;if(c&&r.classList.toggle("b-hide-display",!l),Mr.scrollBarWidth){const o=s||"scroll"===i.overflowY;t.classList.toggle("b-show-yscroll-padding",o),n.classList.toggle("b-show-yscroll-padding",o),r.classList.toggle("b-show-yscroll-padding",o),c&&(l&&e.callEachSubGrid("refreshFakeScroll"),e.onHeightChange())}}get hasVerticalOverflow(){return this.scrollable.hasOverflow("y")}get contentHeight(){const e=this.rowManager;return Math.max(e.totalHeight,e.bottomRow?e.bottomRow.bottom:0)}onContentChange(){const e=this,t=e.rowManager;e.isVisible?(t.estimateTotalHeight(),e.paintListener=null,e.refreshTotalHeight(e.contentHeight),e.callEachSubGrid("refreshFakeScroll"),e.onHeightChange()):e.paintListener||(e.paintListener=e.on({paint:"onContentChange",once:!0,thisObj:e}))}triggerPaint(){this.isPainted||this.refreshBodyRectangle(),super.triggerPaint()}onHeightChange(){const e=this;e.refreshBodyRectangle(),e._bodyHeight=e.autoHeight?e.contentHeight:e.bodyContainer.offsetHeight}suspendRefresh(){this.refreshSuspended++}resumeRefresh(e){this.refreshSuspended&&!--this.refreshSuspended&&(e&&this.refreshRows(),this.trigger("resumeRefresh",{trigger:e}))}renderRows(e=!0){const t=this,n=e&&t.storeScroll();t.refreshSuspended||(t.trigger("beforeRenderRows"),t.renderingRows=!0,t.element.classList.add("b-grid-refreshing"),e||(t.scrollable.y=t._scrollTop=0),t.rowManager.reinitialize(!e),t.trigger("renderRows"),t.renderingRows=!1,t.onContentChange(),e&&t.restoreScroll(n),t.element.classList.remove("b-grid-refreshing"))}renderContents(){const e=this,{element:t,headerContainer:n,footerContainer:r,rowManager:i}=e;if(e.emptyCache(),e.isPainted){e._headerHeight=null,e.callEachSubGrid("refreshHeader",n),e.callEachSubGrid("refreshFooter",r),e.renderHeader(n,t),e.renderFooter(r,t),e.fixSizes();const s=i.removeAllRows();i.calculateRowCount(!1,!0,!0),i.rowCount&&(i.setPosition(s),e.renderRows())}}onPaintOverride(){}onPaint({firstPaint:e}){var t;const n=this;if(n.ariaElement.setAttribute("aria-rowcount",n.store.count+1),null===(t=super.onPaint)||void 0===t||t.call(this,...arguments),n.onPaintOverride()||!e)return;const{rowManager:r,store:i,element:s,headerContainer:o,bodyContainer:a,footerContainer:l}=n,c=Mr.scrollBarPadElement;let d,u=0;n.role=null!=i&&i.isTree?"treegrid":"grid",n.columns.on({change:()=>d=!0,once:!0}),n.updateResponsive(n.width,0),d&&(n.callEachSubGrid("refreshHeader",o),n.callEachSubGrid("refreshFooter",l)),n.renderHeader(o,s),n.renderFooter(l,s),Mr.append(o,c),Mr.append(l,c),Mr.append(n.virtualScrollers,c),n.refreshBodyRectangle();const h=n.bodyContainer.offsetHeight;if(n.autoHeight?(n._bodyHeight=r.initWithHeight(s.offsetHeight-o.offsetHeight-l.offsetHeight,!0),a.style.height=n.bodyHeight+"px"):(n._bodyHeight=h,r.initWithHeight(n._bodyHeight,!0)),n.eachSubGrid((e=>{e.header.maxDepth>u&&(u=e.header.maxDepth)})),o.dataset.maxDepth=u,n.fixSizes(),!i.count&&i.isLoading||n.renderRows(),n.columns.usesAutoHeight){const{fonts:e}=document;"loaded"!==(null==e?void 0:e.status)&&e.ready.then((()=>!n.isDestroyed&&n.refreshRows()))}n.initScroll(),n.initInternalEvents()}render(){const e=this;e.requireSize=Boolean(e.owner),super.render(...arguments),e.autoHeight||(e.headerContainer.offsetHeight&&!e.bodyContainer.offsetHeight&&console.warn("Grid element not sized correctly, please check your CSS styles and review how you size the widget"),"minHeight"in e.initialConfig||"height"in e.initialConfig||parseInt(globalThis.getComputedStyle(e.element).minHeight)!==e.height||console.warn(`The ${e.$$name} is sized by its predefined minHeight, likely this is not intended. Please check your CSS and review how you size the widget, or assign a fixed height in the config. For more information, see the "Basics/Sizing the component" guide in docs.`))}renderHeader(e,t){}renderFooter(e,t){}beforeRenderCell(){}beforeRenderRow(){}afterRenderRow(){}afterScroll(){}processCellEditor(e){}afterColumnsChange(){}afterRemove(e){}afterToggleGroup(){}afterToggleSubGrid(){}syncMaskCover(e=this.masked){if(e){const t="body"===e.cover&&this.rectangleOf("bodyContainer"),n=t&&this.rectangleOf("virtualScrollers"),{style:r}=e.element;r.marginTop=t?`${t.y}px`:"",r.height=t?`${t.height+((null==n?void 0:n.height)||0)}px`:""}}maskBody(e){let t;return this.bodyContainer&&(this.masked=Ta.mergeConfigs(this.loadMaskDefaults,e),t=this.masked),t}unmaskBody(){this.masked=null}updateEmptyText(e){var t;null===(t=this.emptyTextEl)||void 0===t||t.remove(),this.emptyTextEl=Mr.createElement({parent:this.bodyContainer,className:"b-empty-text",[null!=e&&e.includes("<")?"html":"text"]:e})}toggleEmptyText(){this.bodyContainer&&Mr.toggleClasses(this.bodyContainer,"b-grid-empty",!(this.rowManager.rowCount>0||this.store.isLoading||this.store.isCommitting))}updateReadOnly(e,t){if(super.updateReadOnly(e,t),!this.isConfiguring)for(const t of this.columns.bottomColumns){var n;null===(n=t.updateReadOnly)||void 0===n||n.call(t,e)}}getCurrentConfig(e){const t=super.getCurrentConfig(e),{store:n}=this,r=n.getInlineData(e),i=n.getCurrentConfig(e)||t.store;return r.length&&(t.data=r),i&&n.originalModelClass===hg&&delete i.modelClass,sn.isEmpty(i)||(t.store=i),t.store&&delete t.store.data,t}}rp.initClass(),K.setVersion("grid","5.2.4"),rp._$name="GridBase";class ip extends rp{static get $name(){return"Grid"}static get type(){return"grid"}}ip.initClass(),ip._$name="Grid";class sp extends ip{static get $name(){return"TreeGrid"}static get type(){return"treegrid"}static get configurable(){return{store:{tree:!0}}}updateStore(e,t){if(e&&!e.tree)throw new Error("TreeGrid requires a Store configured with tree : true");super.updateStore(e,t)}}sp.initClass(),sp._$name="TreeGrid";const op=function(){var e={version:"1.2.0"};return Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null==this)throw new TypeError;var t=Object(this),n=t.length>>>0;if(0===n)return-1;var r=0;if(arguments.length>1&&((r=Number(arguments[1]))!=r?r=0:0!=r&&r!=1/0&&r!=-1/0&&(r=(r>0||-1)*Math.floor(Math.abs(r)))),r>=n)return-1;for(var i=r>=0?r:Math.max(n-Math.abs(r),0);i<n;i++)if(i in t&&t[i]===e)return i;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),e.array={},e.array.sort=function(e,t){e.sort((function(e,t){return+e-+t})),t&&0===e[0]&&e.push(e.shift())},e.array.next=function(e,t,n){for(var r,i=0!==n[0],s=0,o=t.length-1;o>-1;--o){if((r=t[o])===e)return r;if(!(r>e||0===r&&i&&n[1]>e))break;s=o}return t[s]},e.array.nextInvalid=function(e,t,n){for(var r=n[0],i=n[1],s=t.length,o=0===t[s-1]&&0!==r?i:0,a=e,l=t.indexOf(e),c=a;a===(t[l]||o);)if(++a>i&&(a=r),++l===s&&(l=0),a===c)return;return a},e.array.prev=function(e,t,n){for(var r,i=t.length,s=0!==n[0],o=i-1,a=0;a<i;a++){if((r=t[a])===e)return r;if(!(r<e||0===r&&s&&n[1]<e))break;o=a}return t[o]},e.array.prevInvalid=function(e,t,n){for(var r=n[0],i=n[1],s=t.length,o=0===t[s-1]&&0!==r?i:0,a=e,l=t.indexOf(e),c=a;a===(t[l]||o);)if(--a<r&&(a=i),-1==--l&&(l=s-1),a===c)return;return a},e.day=e.D={name:"day",range:86400,val:function(t){return t.D||(t.D=e.date.getDate.call(t))},isValid:function(t,n){return e.D.val(t)===(n||e.D.extent(t)[1])},extent:function(t){if(t.DExtent)return t.DExtent;var n=e.M.val(t),r=e.DAYS_IN_MONTH[n-1];return 2===n&&366===e.dy.extent(t)[1]&&(r+=1),t.DExtent=[1,r]},start:function(t){return t.DStart||(t.DStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)))},end:function(t){return t.DEnd||(t.DEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)))},next:function(t,n){n=n>e.D.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.D,e.M),i=e.D.extent(r)[1];return n=n>i?1:n||i,e.date.next(e.Y.val(r),e.M.val(r),n)},prev:function(t,n){var r=e.date.prevRollover(t,n,e.D,e.M),i=e.D.extent(r)[1];return e.date.prev(e.Y.val(r),e.M.val(r),n>i?i:n||i)}},e.dayOfWeekCount=e.dc={name:"day of week count",range:604800,val:function(t){return t.dc||(t.dc=Math.floor((e.D.val(t)-1)/7)+1)},isValid:function(t,n){return e.dc.val(t)===n||0===n&&e.D.val(t)>e.D.extent(t)[1]-7},extent:function(t){return t.dcExtent||(t.dcExtent=[1,Math.ceil(e.D.extent(t)[1]/7)])},start:function(t){return t.dcStart||(t.dcStart=e.date.next(e.Y.val(t),e.M.val(t),Math.max(1,7*(e.dc.val(t)-1)+1||1)))},end:function(t){return t.dcEnd||(t.dcEnd=e.date.prev(e.Y.val(t),e.M.val(t),Math.min(7*e.dc.val(t),e.D.extent(t)[1])))},next:function(t,n){n=n>e.dc.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.dc,e.M);n=n>e.dc.extent(r)[1]?1:n;var i=e.date.next(e.Y.val(r),e.M.val(r),0===n?e.D.extent(r)[1]-6:1+7*(n-1));return i.getTime()<=t.getTime()?(r=e.M.next(t,e.M.val(t)+1),e.date.next(e.Y.val(r),e.M.val(r),0===n?e.D.extent(r)[1]-6:1+7*(n-1))):i},prev:function(t,n){var r=e.date.prevRollover(t,n,e.dc,e.M),i=e.dc.extent(r)[1];return n=n>i?i:n||i,e.dc.end(e.date.prev(e.Y.val(r),e.M.val(r),1+7*(n-1)))}},e.dayOfWeek=e.dw=e.d={name:"day of week",range:86400,val:function(t){return t.dw||(t.dw=e.date.getDay.call(t)+1)},isValid:function(t,n){return e.dw.val(t)===(n||7)},extent:function(){return[1,7]},start:function(t){return e.D.start(t)},end:function(t){return e.D.end(t)},next:function(t,n){return n=n>7?1:n||7,e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n-e.dw.val(t))+(n<=e.dw.val(t)?7:0))},prev:function(t,n){return n=n>7?7:n||7,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(n-e.dw.val(t))+(n>=e.dw.val(t)?-7:0))}},e.dayOfYear=e.dy={name:"day of year",range:86400,val:function(t){return t.dy||(t.dy=Math.ceil(1+(e.D.start(t).getTime()-e.Y.start(t).getTime())/e.DAY))},isValid:function(t,n){return e.dy.val(t)===(n||e.dy.extent(t)[1])},extent:function(t){var n=e.Y.val(t);return t.dyExtent||(t.dyExtent=[1,n%4?365:366])},start:function(t){return e.D.start(t)},end:function(t){return e.D.end(t)},next:function(t,n){n=n>e.dy.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.dy,e.Y),i=e.dy.extent(r)[1];return n=n>i?1:n||i,e.date.next(e.Y.val(r),e.M.val(r),n)},prev:function(t,n){var r=e.date.prevRollover(t,n,e.dy,e.Y),i=e.dy.extent(r)[1];return n=n>i?i:n||i,e.date.prev(e.Y.val(r),e.M.val(r),n)}},e.hour=e.h={name:"hour",range:3600,val:function(t){return t.h||(t.h=e.date.getHour.call(t))},isValid:function(t,n){return e.h.val(t)===n},extent:function(){return[0,23]},start:function(t){return t.hStart||(t.hStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)))},end:function(t){return t.hEnd||(t.hEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)))},next:function(t,n){n=n>23?0:n;var r=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n<=e.h.val(t)?1:0),n);return!e.date.isUTC&&r.getTime()<=t.getTime()&&(r=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r),n+1)),r},prev:function(t,n){return n=n>23?23:n,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(n>=e.h.val(t)?-1:0),n)}},e.minute=e.m={name:"minute",range:60,val:function(t){return t.m||(t.m=e.date.getMin.call(t))},isValid:function(t,n){return e.m.val(t)===n},extent:function(e){return[0,59]},start:function(t){return t.mStart||(t.mStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)))},end:function(t){return t.mEnd||(t.mEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)))},next:function(t,n){var r=e.m.val(t),i=e.s.val(t),s=n>59?60-r:n<=r?60-r+n:n-r,o=new Date(t.getTime()+s*e.MIN-i*e.SEC);return!e.date.isUTC&&o.getTime()<=t.getTime()&&(o=new Date(t.getTime()+(s+120)*e.MIN-i*e.SEC)),o},prev:function(t,n){return n=n>59?59:n,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)+(n>=e.m.val(t)?-1:0),n)}},e.month=e.M={name:"month",range:2629740,val:function(t){return t.M||(t.M=e.date.getMonth.call(t)+1)},isValid:function(t,n){return e.M.val(t)===(n||12)},extent:function(){return[1,12]},start:function(t){return t.MStart||(t.MStart=e.date.next(e.Y.val(t),e.M.val(t)))},end:function(t){return t.MEnd||(t.MEnd=e.date.prev(e.Y.val(t),e.M.val(t)))},next:function(t,n){return n=n>12?1:n||12,e.date.next(e.Y.val(t)+(n>e.M.val(t)?0:1),n)},prev:function(t,n){return n=n>12?12:n||12,e.date.prev(e.Y.val(t)-(n>=e.M.val(t)?1:0),n)}},e.second=e.s={name:"second",range:1,val:function(t){return t.s||(t.s=e.date.getSec.call(t))},isValid:function(t,n){return e.s.val(t)===n},extent:function(){return[0,59]},start:function(e){return e},end:function(e){return e},next:function(t,n){var r=e.s.val(t),i=n>59?60-r:n<=r?60-r+n:n-r,s=new Date(t.getTime()+i*e.SEC);return!e.date.isUTC&&s.getTime()<=t.getTime()&&(s=new Date(t.getTime()+(i+7200)*e.SEC)),s},prev:function(t,n,r){return n=n>59?59:n,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)+(n>=e.s.val(t)?-1:0),n)}},e.time=e.t={name:"time",range:1,val:function(t){return t.t||(t.t=3600*e.h.val(t)+60*e.m.val(t)+e.s.val(t))},isValid:function(t,n){return e.t.val(t)===n},extent:function(){return[0,86399]},start:function(e){return e},end:function(e){return e},next:function(t,n){n=n>86399?0:n;var r=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n<=e.t.val(t)?1:0),0,0,n);return!e.date.isUTC&&r.getTime()<t.getTime()&&(r=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r),e.h.val(r),e.m.val(r),n+7200)),r},prev:function(t,n){return n=n>86399?86399:n,e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n>=e.t.val(t)?-1:0),0,0,n)}},e.weekOfMonth=e.wm={name:"week of month",range:604800,val:function(t){return t.wm||(t.wm=(e.D.val(t)+(e.dw.val(e.M.start(t))-1)+(7-e.dw.val(t)))/7)},isValid:function(t,n){return e.wm.val(t)===(n||e.wm.extent(t)[1])},extent:function(t){return t.wmExtent||(t.wmExtent=[1,(e.D.extent(t)[1]+(e.dw.val(e.M.start(t))-1)+(7-e.dw.val(e.M.end(t))))/7])},start:function(t){return t.wmStart||(t.wmStart=e.date.next(e.Y.val(t),e.M.val(t),Math.max(e.D.val(t)-e.dw.val(t)+1,1)))},end:function(t){return t.wmEnd||(t.wmEnd=e.date.prev(e.Y.val(t),e.M.val(t),Math.min(e.D.val(t)+(7-e.dw.val(t)),e.D.extent(t)[1])))},next:function(t,n){n=n>e.wm.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.wm,e.M),i=e.wm.extent(r)[1];return n=n>i?1:n||i,e.date.next(e.Y.val(r),e.M.val(r),Math.max(1,7*(n-1)-(e.dw.val(r)-2)))},prev:function(t,n){var r=e.date.prevRollover(t,n,e.wm,e.M),i=e.wm.extent(r)[1];return n=n>i?i:n||i,e.wm.end(e.date.next(e.Y.val(r),e.M.val(r),Math.max(1,7*(n-1)-(e.dw.val(r)-2))))}},e.weekOfYear=e.wy={name:"week of year (ISO)",range:604800,val:function(t){if(t.wy)return t.wy;var n=e.dw.next(e.wy.start(t),5),r=e.dw.next(e.Y.prev(n,e.Y.val(n)-1),5);return t.wy=1+Math.ceil((n.getTime()-r.getTime())/e.WEEK)},isValid:function(t,n){return e.wy.val(t)===(n||e.wy.extent(t)[1])},extent:function(t){if(t.wyExtent)return t.wyExtent;var n=e.dw.next(e.wy.start(t),5),r=e.dw.val(e.Y.start(n)),i=e.dw.val(e.Y.end(n));return t.wyExtent=[1,5===r||5===i?53:52]},start:function(t){return t.wyStart||(t.wyStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)-(e.dw.val(t)>1?e.dw.val(t)-2:6)))},end:function(t){return t.wyEnd||(t.wyEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(e.dw.val(t)>1?8-e.dw.val(t):0)))},next:function(t,n){n=n>e.wy.extent(t)[1]?1:n;var r=e.dw.next(e.wy.start(t),5),i=e.date.nextRollover(r,n,e.wy,e.Y);1!==e.wy.val(i)&&(i=e.dw.next(i,2));var s=e.wy.extent(i)[1],o=e.wy.start(i);return n=n>s?1:n||s,e.date.next(e.Y.val(o),e.M.val(o),e.D.val(o)+7*(n-1))},prev:function(t,n){var r=e.dw.next(e.wy.start(t),5),i=e.date.prevRollover(r,n,e.wy,e.Y);1!==e.wy.val(i)&&(i=e.dw.next(i,2));var s=e.wy.extent(i)[1],o=e.wy.end(i);return n=n>s?s:n||s,e.wy.end(e.date.next(e.Y.val(o),e.M.val(o),e.D.val(o)+7*(n-1)))}},e.year=e.Y={name:"year",range:31556900,val:function(t){return t.Y||(t.Y=e.date.getYear.call(t))},isValid:function(t,n){return e.Y.val(t)===n},extent:function(){return[1970,2099]},start:function(t){return t.YStart||(t.YStart=e.date.next(e.Y.val(t)))},end:function(t){return t.YEnd||(t.YEnd=e.date.prev(e.Y.val(t)))},next:function(t,n){return n>e.Y.val(t)&&n<=e.Y.extent()[1]?e.date.next(n):e.NEVER},prev:function(t,n){return n<e.Y.val(t)&&n>=e.Y.extent()[0]?e.date.prev(n):e.NEVER}},e.fullDate=e.fd={name:"full date",range:1,val:function(e){return e.fd||(e.fd=e.getTime())},isValid:function(t,n){return e.fd.val(t)===n},extent:function(){return[0,3250368e7]},start:function(e){return e},end:function(e){return e},next:function(t,n){return e.fd.val(t)<n?new Date(n):e.NEVER},prev:function(t,n){return e.fd.val(t)>n?new Date(n):e.NEVER}},e.modifier={},e.modifier.after=e.modifier.a=function(e,t){var n=t[0];return{name:"after "+e.name,range:(e.extent(new Date)[1]-n)*e.range,val:e.val,isValid:function(e,t){return this.val(e)>=n},extent:e.extent,start:e.start,end:e.end,next:function(t,r){return r!=n&&(r=e.extent(t)[0]),e.next(t,r)},prev:function(t,r){return r=r===n?e.extent(t)[1]:n-1,e.prev(t,r)}}},e.modifier.before=e.modifier.b=function(e,t){var n=t[t.length-1];return{name:"before "+e.name,range:e.range*(n-1),val:e.val,isValid:function(e,t){return this.val(e)<n},extent:e.extent,start:e.start,end:e.end,next:function(t,r){return r=r===n?e.extent(t)[0]:n,e.next(t,r)},prev:function(t,r){return r=r===n?n-1:e.extent(t)[1],e.prev(t,r)}}},e.compile=function(t){var n,r=[],i=0;for(var s in t){var o=s.split("_"),a=o[0],l=o[1],c=t[s],d=l?e.modifier[l](e[a],c):e[a];r.push({constraint:d,vals:c}),i++}return r.sort((function(e,t){var n=e.constraint.range,r=t.constraint.range;return r<n?-1:r>n?1:0})),n=r[i-1].constraint,{start:function(t,s){for(var o,a=s,l=e.array[t],c=1e3;c--&&!o&&a;){o=!0;for(var d=0;d<i;d++){var u=r[d].constraint,h=u.val(a),g=u.extent(a),m=l(h,r[d].vals,g);if(!u.isValid(a,m)){a=u[t](a,m),o=!1;break}}}return a!==e.NEVER&&(a="next"===t?n.start(a):n.end(a)),a},end:function(t,n){for(var s,o=e.array[t+"Invalid"],a=function(e){return"next"===e?function(e,t){return e.getTime()>t.getTime()}:function(e,t){return t.getTime()>e.getTime()}}(t),l=i-1;l>=0;l--){var c,d=r[l].constraint,u=d.val(n),h=d.extent(n),g=o(u,r[l].vals,h);void 0!==g&&(!(c=d[t](n,g))||s&&!a(s,c)||(s=c))}return s},tick:function(t,r){return new Date("next"===t?n.end(r).getTime()+e.SEC:n.start(r).getTime()-e.SEC)},tickStart:function(e){return n.start(e)}}},e.schedule=function(t){if(!t)throw new Error("Missing schedule definition.");if(!t.schedules)throw new Error("Definition must include at least one schedule.");for(var n=[],r=t.schedules.length,i=[],s=t.exceptions?t.exceptions.length:0,o=0;o<r;o++)n.push(e.compile(t.schedules[o]));for(var a=0;a<s;a++)i.push(e.compile(t.exceptions[a]));function l(t,r,o,a,l){var b,C,w,S=v(t),D=r,E=1e6,x=[],R=[],T=[],M="next"===t,k=M?0:1,I=M?1:0;if(!(o=o?new Date(o):new Date)||!o.getTime())throw new Error("Invalid start date.");for(function(e,t,n,r){for(var i=0,s=t.length;i<s;i++)n[i]=t[i].start(e,r)}(t,n,x,o),function(t,n,r,i){for(var s=0,o=n.length;s<o;s++){var a=n[s].start(t,i);r[s]=a?[a,n[s].end(t,a)]:e.NEVER}}(t,i,R,o);E--&&D&&(b=y(x,S))&&(!a||!S(b,a));)if(s&&(u(t,i,R,b),C=m(t,R,b)))d(t,n,x,C);else{if(l){var A=p(R,S);C=f(t,n,x,b,A);var F=M?[new Date(Math.max(o,b)),C?new Date(a?Math.min(C,a):C):void 0]:[C?new Date(a?Math.max(a,C.getTime()+e.SEC):C.getTime()+e.SEC):void 0,new Date(Math.min(o,b.getTime()+e.SEC))];if(w&&F[k].getTime()===w[I].getTime()?(w[I]=F[I],D++):(w=F,T.push(w)),!C)break;d(t,n,x,C)}else T.push(M?new Date(Math.max(o,b)):g(n,x,b,a)),h(t,n,x,b);D--}for(var O=0,L=T.length;O<L;O++){var P=T[O];T[O]="[object Array]"===Object.prototype.toString.call(P)?[c(P[0]),c(P[1])]:c(P)}return 0===T.length?e.NEVER:1===r?T[0]:T}function c(e){if(e instanceof Date&&!isNaN(e.valueOf()))return new Date(e)}function d(e,t,n,r){for(var i=v(e),s=0,o=t.length;s<o;s++)n[s]&&!i(n[s],r)&&(n[s]=t[s].start(e,r))}function u(t,n,r,i){for(var s=v(t),o=0,a=n.length;o<a;o++)if(r[o]&&!s(r[o][0],i)){var l=n[o].start(t,i);r[o]=l?[l,n[o].end(t,l)]:e.NEVER}}function h(e,t,n,r){for(var i=0,s=t.length;i<s;i++)n[i]&&n[i].getTime()===r.getTime()&&(n[i]=t[i].start(e,t[i].tick(e,r)))}function g(e,t,n,r){for(var i,s=0,o=t.length;s<o;s++)if(t[s]&&t[s].getTime()===n.getTime()){var a=e[s].tickStart(n);if(r&&a<r)return r;(!i||a>i)&&(i=a)}return i}function m(e,t,n){for(var r,i=v(e),s=0,o=t.length;s<o;s++){var a=t[s];!a||i(a[0],n)||a[1]&&!i(a[1],n)||r&&!i(a[1],r)||(r=a[1])}return r}function p(e,t){for(var n,r=0,i=e.length;r<i;r++)!e[r]||n&&!t(n,e[r][0])||(n=e[r][0]);return n}function f(e,t,n,r,i){for(var s,o=v(e),a=0,l=t.length;a<l;a++){var c=n[a];if(c&&c.getTime()===r.getTime()){var d=t[a].end(e,c);if(i&&(!d||o(d,i)))return i;s&&!o(d,s)||(s=d)}}return s}function v(e){return"next"===e?function(e,t){return!t||e.getTime()>t.getTime()}:function(e,t){return!e||t.getTime()>e.getTime()}}function y(e,t){for(var n=e[0],r=1,i=e.length;r<i;r++)e[r]&&t(n,e[r])&&(n=e[r]);return n}return{isValid:function(t){return l("next",1,t,t)!==e.NEVER},next:function(e,t,n){return l("next",e||1,t,n)},prev:function(e,t,n){return l("prev",e||1,t,n)},nextRange:function(e,t,n){return l("next",e||1,t,n,!0)},prevRange:function(e,t,n){return l("prev",e||1,t,n,!0)}}},e.setTimeout=function(t,n){var r,i=e.schedule(n);return t&&function e(){var n=Date.now(),s=i.next(2,n);if(s[0]){var o=s[0].getTime()-n;o<1e3&&(o=s[1]?s[1].getTime()-n:1e3),r=o<2147483647?setTimeout(t,o):setTimeout(e,2147483647)}else r=void 0}(),{isDone:function(){return!r},clear:function(){clearTimeout(r)}}},e.setInterval=function(t,n){if(t){var r=e.setTimeout((function s(){i||(t(),r=e.setTimeout(s,n))}),n),i=r.isDone();return{isDone:function(){return r.isDone()},clear:function(){i=!0,r.clear()}}}},e.date={},e.date.timezone=function(t){e.date.build=t?function(e,t,n,r,i,s){return new Date(e,t,n,r,i,s)}:function(e,t,n,r,i,s){return new Date(Date.UTC(e,t,n,r,i,s))};var n=t?"get":"getUTC",r=Date.prototype;e.date.getYear=r[n+"FullYear"],e.date.getMonth=r[n+"Month"],e.date.getDate=r[n+"Date"],e.date.getDay=r[n+"Day"],e.date.getHour=r[n+"Hours"],e.date.getMin=r[n+"Minutes"],e.date.getSec=r[n+"Seconds"],e.date.isUTC=!t},e.date.UTC=function(){e.date.timezone(!1)},e.date.localTime=function(){e.date.timezone(!0)},e.date.UTC(),e.SEC=1e3,e.MIN=60*e.SEC,e.HOUR=60*e.MIN,e.DAY=24*e.HOUR,e.WEEK=7*e.DAY,e.DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31],e.NEVER=0,e.date.next=function(t,n,r,i,s,o){return e.date.build(t,void 0!==n?n-1:0,void 0!==r?r:1,i||0,s||0,o||0)},e.date.nextRollover=function(t,n,r,i){var s=r.val(t),o=r.extent(t)[1];return(n||o)<=s||n>o?new Date(i.end(t).getTime()+e.SEC):i.start(t)},e.date.prev=function(t,n,r,i,s,o){var a=arguments.length;return n=a<2?11:n-1,r=a<3?e.D.extent(e.date.next(t,n+1))[1]:r,i=a<4?23:i,s=a<5?59:s,o=a<6?59:o,e.date.build(t,n,r,i,s,o)},e.date.prevRollover=function(e,t,n,r){return t>=n.val(e)||!t?r.start(r.prev(e,r.val(e)-1)):r.start(e)},e.parse={},e.parse.cron=function(e,t){var n={JAN:1,FEB:2,MAR:3,APR:4,MAY:5,JUN:6,JUL:7,AUG:8,SEP:9,OCT:10,NOV:11,DEC:12,SUN:1,MON:2,TUE:3,WED:4,THU:5,FRI:6,SAT:7},r={"* * * * * *":"0/1 * * * * *","@YEARLY":"0 0 1 1 *","@ANNUALLY":"0 0 1 1 *","@MONTHLY":"0 0 1 * *","@WEEKLY":"0 0 * * 0","@DAILY":"0 0 * * *","@HOURLY":"0 * * * *"},i={s:[0,0,59],m:[1,0,59],h:[2,0,23],D:[3,1,31],M:[4,1,12],Y:[6,1970,2099],d:[5,1,7,1]};function s(e,t,r){return isNaN(e)?n[e]||null:Math.min(+e+(t||0),r||9999)}function o(e,t,n,r,i){var s=n;for(e[t]||(e[t]=[]);s<=r;)e[t].indexOf(s)<0&&e[t].push(s),s+=i||1;e[t].sort((function(e,t){return e-t}))}function a(e,t,n,r){(t.d&&!t.dc||t.dc&&t.dc.indexOf(r)<0)&&(e.push(function(e){var t,n={};for(t in e)"dc"!==t&&"d"!==t&&(n[t]=e[t].slice(0));return n}(t)),t=e[e.length-1]),o(t,"d",n,n),o(t,"dc",r,r)}function l(e,t,r,i,l,c){var d,u,h=t.schedules,g=h[h.length-1];"L"===e&&(e=i-1),null!==(d=s(e,c,l))?o(g,r,d,d):null!==(d=s(e.replace("W",""),c,l))?function(e,t,r){var i={},s={};1===r?(o(t,"D",1,3),o(t,"d",n.MON,n.FRI),o(i,"D",2,2),o(i,"d",n.TUE,n.FRI),o(s,"D",3,3),o(s,"d",n.TUE,n.FRI)):(o(t,"D",r-1,r+1),o(t,"d",n.MON,n.FRI),o(i,"D",r-1,r-1),o(i,"d",n.MON,n.THU),o(s,"D",r+1,r+1),o(s,"d",n.TUE,n.FRI)),e.exceptions.push(i),e.exceptions.push(s)}(t,g,d):null!==(d=s(e.replace("L",""),c,l))?a(h,g,d,i-1):2===(u=e.split("#")).length?a(h,g,d=s(u[0],c,l),s(u[1])):function(e,t,n,r,i,a){var l=e.split("/"),c=+l[1],d=l[0];if("*"!==d&&"0"!==d){var u=d.split("-");r=s(u[0],a,i),i=s(u[1],a,i)||i}o(t,n,r,i,c)}(e,g,r,i,l,c)}function c(e){return e.indexOf("#")>-1||e.indexOf("L")>0}function d(e,t){return c(e)&&!c(t)?1:e-t}var u=function(e){var t=e.toUpperCase();return r[t]||t}(e);return function(e){var t,n,r,s,o={schedules:[{}],exceptions:[]},a=e.replace(/(\s)+/g," ").split(" ");for(t in i)if((r=a[(n=i[t])[0]])&&"*"!==r&&"?"!==r){var c,u=(s=r.split(",").sort(d)).length;for(c=0;c<u;c++)l(s[c],o,t,n[1],n[2],n[3])}return o}(t?u:"0 "+u)},e.parse.recur=function(){var t,n,r,i,s,o,a,l,c,d=[],u=[],h=d;function g(e,d,u){if(e=s?e+"_"+s:e,t||(h.push({}),t=h[0]),t[e]||(t[e]=[]),n=t[e],i){for(r=[],l=d;l<=u;l+=i)r.push(l);c={n:e,x:i,c:n.length,m:u}}var g=(r=o?[d]:a?[u]:r).length;for(l=0;l<g;l+=1){var m=r[l];n.indexOf(m)<0&&n.push(m)}r=i=s=o=a=0}return{schedules:d,exceptions:u,on:function(){return r=arguments[0]instanceof Array?arguments[0]:arguments,this},every:function(e){return i=e||1,this},after:function(e){return s="a",r=[e],this},before:function(e){return s="b",r=[e],this},first:function(){return o=1,this},last:function(){return a=1,this},time:function(){for(var e=0,t=r.length;e<t;e++){var n=r[e].split(":");n.length<3&&n.push(0),r[e]=3600*+n[0]+60*+n[1]+ +n[2]}return g("t"),this},second:function(){return g("s",0,59),this},minute:function(){return g("m",0,59),this},hour:function(){return g("h",0,23),this},dayOfMonth:function(){return g("D",1,a?0:31),this},dayOfWeek:function(){return g("d",1,7),this},onWeekend:function(){return r=[1,7],this.dayOfWeek()},onWeekday:function(){return r=[2,3,4,5,6],this.dayOfWeek()},dayOfWeekCount:function(){return g("dc",1,a?0:5),this},dayOfYear:function(){return g("dy",1,a?0:366),this},weekOfMonth:function(){return g("wm",1,a?0:5),this},weekOfYear:function(){return g("wy",1,a?0:53),this},month:function(){return g("M",1,12),this},year:function(){return g("Y",1970,2450),this},fullDate:function(){for(var e=0,t=r.length;e<t;e++)r[e]=r[e].getTime();return g("fd"),this},customModifier:function(t,n){var i=e.modifier[t];if(!i)throw new Error("Custom modifier "+t+" not recognized!");return s=t,r=arguments[1]instanceof Array?arguments[1]:[arguments[1]],this},customPeriod:function(t){var n=e[t];if(!n)throw new Error("Custom time period "+t+" not recognized!");return g(t,n.extent(new Date)[0],n.extent(new Date)[1]),this},startingOn:function(e){return this.between(e,c.m)},between:function(e,n){return t[c.n]=t[c.n].splice(0,c.c),i=c.x,g(c.n,e,n),this},and:function(){return t=h[h.push({})-1],this},except:function(){return h=u,t=null,this}}},e.parse.text=function(t){var n,r=e.parse.recur,i=0,s="",o={eof:/^$/,fullDate:/^(\d\d\d\d-\d\d-\d\dt\d\d:\d\d:\d\d)\b/,rank:/^((\d\d\d\d)|([2-5]?1(st)?|[2-5]?2(nd)?|[2-5]?3(rd)?|(0|[1-5]?[4-9]|[1-5]0|1[1-3])(th)?))\b/,time:/^((([0]?[1-9]|1[0-2]):[0-5]\d(\s)?(am|pm))|(([0]?\d|1\d|2[0-3]):[0-5]\d))\b/,dayName:/^((sun|mon|tue(s)?|wed(nes)?|thu(r(s)?)?|fri|sat(ur)?)(day)?)\b/,monthName:/^(jan(uary)?|feb(ruary)?|ma((r(ch)?)?|y)|apr(il)?|ju(ly|ne)|aug(ust)?|oct(ober)?|(sept|nov|dec)(ember)?)\b/,yearIndex:/^(\d\d\d\d)\b/,every:/^every\b/,after:/^after\b/,before:/^before\b/,second:/^(s|sec(ond)?(s)?)\b/,minute:/^(m|min(ute)?(s)?)\b/,hour:/^(h|hour(s)?)\b/,day:/^(day(s)?( of the month)?)\b/,dayInstance:/^day instance\b/,dayOfWeek:/^day(s)? of the week\b/,dayOfYear:/^day(s)? of the year\b/,weekOfYear:/^week(s)?( of the year)?\b/,weekOfMonth:/^week(s)? of the month\b/,weekday:/^weekday\b/,weekend:/^weekend\b/,month:/^month(s)?\b/,year:/^year(s)?\b/,between:/^between (the)?\b/,start:/^(start(ing)? (at|on( the)?)?)\b/,at:/^(at|@)\b/,and:/^(,|and\b)/,except:/^(except\b)/,also:/(also)\b/,first:/^(first)\b/,last:/^last\b/,in:/^in\b/,of:/^of\b/,onthe:/^on the\b/,on:/^on\b/,through:/(-|^(to|through)\b)/},a={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12,sun:1,mon:2,tue:3,wed:4,thu:5,fri:6,sat:7,"1st":1,fir:1,"2nd":2,sec:2,"3rd":3,thi:3,"4th":4,for:4};function l(e,t,n,r){return{startPos:e,endPos:t,text:n,type:r}}function c(e){var t,n,r,o,a,c,d=e instanceof Array?e:[e],u=/\s+/;for(d.push(u),a=i;!t||t.type===u;){c=-1,n=s.substring(a),t=l(a,a,s.split(u)[0]);var h,g=d.length;for(h=0;h<g;h++)(r=(o=d[h]).exec(n))&&0===r.index&&r[0].length>c&&(t=l(a,a+(c=r[0].length),n.substring(0,c),o));t.type===u&&(a=t.endPos)}return t}function d(e){var t=c(e);return i=t.endPos,t}function u(e){for(var t=+y(e),n=f(o.through)?+y(e):t,r=[],i=t;i<=n;i++)r.push(i);return r}function h(e){for(var t=u(e);f(o.and);)t=t.concat(u(e));return t}function g(e){var t,n,r,i;f(o.weekend)?e.on(a.sun,a.sat).dayOfWeek():f(o.weekday)?e.on(a.mon,a.tue,a.wed,a.thu,a.fri).dayOfWeek():(t=y(o.rank),e.every(t),n=p(e),f(o.start)?(t=y(o.rank),e.startingOn(t),v(n.type)):f(o.between)&&(r=y(o.rank),f(o.and)&&(i=y(o.rank),e.between(r,i))))}function m(e){f(o.first)?e.first():f(o.last)?e.last():e.on(h(o.rank)),p(e)}function p(e){var t=v([o.second,o.minute,o.hour,o.dayOfYear,o.dayOfWeek,o.dayInstance,o.day,o.month,o.year,o.weekOfMonth,o.weekOfYear]);switch(t.type){case o.second:e.second();break;case o.minute:e.minute();break;case o.hour:e.hour();break;case o.dayOfYear:e.dayOfYear();break;case o.dayOfWeek:e.dayOfWeek();break;case o.dayInstance:e.dayOfWeekCount();break;case o.day:e.dayOfMonth();break;case o.weekOfMonth:e.weekOfMonth();break;case o.weekOfYear:e.weekOfYear();break;case o.month:e.month();break;case o.year:e.year();break;default:n=i}return t}function f(e){var t=c(e).type===e;return t&&d(e),t}function v(e){var t=d(e);return t.type?t.text=function(e,t){var n=e;switch(t){case o.time:var r=e.split(/(:|am|pm)/),i="pm"===r[3]&&r[0]<12?parseInt(r[0],10)+12:r[0],s=r[2].trim();n=(1===i.length?"0":"")+i+":"+s;break;case o.rank:n=parseInt(/^\d+/.exec(e)[0],10);break;case o.monthName:case o.dayName:n=a[e.substring(0,3)];break;case o.fullDate:n=new Date(e.toUpperCase())}return n}(t.text,e):n=i,t}function y(e){return v(e).text}return function(e){i=0,s=e,n=-1;for(var t=r();i<s.length&&n<0;)switch(v([o.every,o.after,o.before,o.onthe,o.on,o.of,o.in,o.at,o.and,o.except,o.also]).type){case o.every:g(t);break;case o.after:void 0!==c(o.time).type?(t.after(y(o.time)),t.time()):void 0!==c(o.fullDate).type?(t.after(y(o.fullDate)),t.fullDate()):(t.after(y(o.rank)),p(t));break;case o.before:void 0!==c(o.time).type?(t.before(y(o.time)),t.time()):void 0!==c(o.fullDate).type?(t.before(y(o.fullDate)),t.fullDate()):(t.before(y(o.rank)),p(t));break;case o.onthe:m(t);break;case o.on:t.on(h(o.dayName)).dayOfWeek();break;case o.of:t.on(h(o.monthName)).month();break;case o.in:t.on(h(o.yearIndex)).year();break;case o.at:for(t.on(y(o.time)).time();f(o.and);)t.on(y(o.time)).time();break;case o.and:break;case o.also:t.and();break;case o.except:t.except();break;default:n=i}return{schedules:t.schedules,exceptions:t.exceptions,error:n}}(t.toLowerCase())},e}();function ap(e){const t=[],n=[];let r;return[function*(){for(r||(r=e[Symbol.iterator]());t.length&&(yield*t,t.length=0),r;){const{value:t,done:i}=r.next();if(i){r=null,e=null;break}n.push(t),yield t}}(),function*(){for(r||(r=e[Symbol.iterator]());n.length&&(yield*n,n.length=0),r;){const{value:n,done:i}=r.next();if(i){r=null,e=null;break}t.push(n),yield n}}()]}op.date.localTime();class lp{constructor(e){if(this.iterable=void 0,!e)throw new Error("Require an iterable instance for chaining");this.iterable=e}derive(e){return this.iterable=void 0,new lp(e)}copy(){const[e,t]=ap(this.iterable);return this.iterable=t,new lp(e)}split(){const[e,t]=ap(this.iterable);return[new lp(e),this.derive(t)]}inBatchesBySize(e){return this.derive(function*(e,t){if(t<0)throw new Error("Batch size needs to a natural number");t|=0;const n=[];for(const r of e)n.length===t&&(yield n,n.length=0),n.push(r);n.length>0&&(yield n)}(this.iterable,e))}filter(e){return this.derive(function*(e,t){let n=0;for(const r of e)t(r,n++)&&(yield r)}(this.iterable,e))}drop(e){return this.derive(function*(e,t){let n=0;for(const r of e)++n>t&&(yield r)}(this.iterable,e))}map(e){return this.derive(function*(e,t){let n=0;for(const r of e)yield t(r,n++)}(this.iterable,e))}reduce(e,t){return function(e,t,n){let r=0,i=n;for(const n of e)i=t(i,n,r++);return i}(this,e,t)}concat(){return this.derive(function*(e){for(const t of e)yield*t}(this.iterable))}uniqueOnly(){return this.derive(function*(e){const t=new Set;for(const n of e)t.has(n)||(t.add(n),yield n)}(this.iterable))}uniqueOnlyBy(e){return this.derive(function*(e,t){const n=new Set;for(const r of e){const e=t(r);n.has(e)||(n.add(e),yield r)}}(this.iterable,e))}every(e){return function(e,t){let n=0;for(const r of e)if(!t(r,n++))return!1;return!0}(this,e)}some(e){return function(e,t){let n=0;for(const r of e)if(t(r,n++))return!0;return!1}(this,e)}takeWhile(e){return this.derive(function*(e,t){let n=0;for(const r of e){if(!t(r,n++))return;yield r}}(this.iterable,e))}*[Symbol.iterator](){let e=this.iterable;if(!e)throw new Error("Chained iterator already exhausted or used to derive the new one");this.iterable=void 0,yield*e,e=void 0}toArray(){return Array.from(this)}sort(e){return Array.from(this).sort(e)}toSet(){return new Set(this)}toMap(){return new Map(this)}flush(){for(const e of this);}memoize(){return new dp(this)}}const cp=e=>new lp(e);class dp extends lp{constructor(){super(...arguments),this.elements=[],this.$iterator=void 0}set iterable(e){this.$iterable=e}get iterable(){return this}derive(e){return new lp(e)}*[Symbol.iterator](){const e=this.elements;if(this.$iterable){this.$iterator||(this.$iterator=this.$iterable[Symbol.iterator]());let t=this.$iterator,n=e.length;for(n>0&&(yield*e);;){if(e.length>n){for(let t=n;t<e.length;t++)yield e[t];n=e.length}if(!t)break;const{value:r,done:i}=t.next();i?(t=this.$iterator=null,this.$iterable=null):(e.push(r),n++,yield r)}}else yield*e}}const up=Symbol("MixinIdentity"),hp=Symbol("MixinStateProperty");class gp{constructor(){var e;this.baseEl=void 0,this.sourceEl=void 0,this.$elementsByTopoLevel=void 0,this.$topoLevels=void 0,this.linearizedByTopoLevelsSource=(e=this.linearizedByTopoLevels(),new dp(e))}static new(e){const t=new this;return e&&Object.assign(t,e),t}get topoLevels(){return void 0!==this.$topoLevels?this.$topoLevels:this.$topoLevels=this.buildTopoLevels()}buildTopoLevels(){return Array.from(this.elementsByTopoLevel.keys()).sort(((e,t)=>e-t))}get elementsByTopoLevel(){return void 0!==this.$elementsByTopoLevel?this.$elementsByTopoLevel:this.$elementsByTopoLevel=this.buildElementsByTopoLevel()}getOrCreateLevel(e,t){let n=e.get(t);return n||(n=[],e.set(t,n)),n}buildElementsByTopoLevel(){let e=0;const t=this.baseEl?cp(this.baseEl.walkDepthState.elementsByTopoLevel.values()).concat().toSet():new Set,n=cp(this.sourceEl.requirements).map((e=>e.walkDepthState.elementsByTopoLevel)).concat().reduce(((t,[n,r])=>(n>e&&(e=n),this.getOrCreateLevel(t,n).push(r),t)),new Map);return this.getOrCreateLevel(n,e+1).push([this.sourceEl]),cp(n).map((([e,n])=>[e,cp(n).concat().uniqueOnly().filter((e=>!t.has(e))).sort(((e,t)=>e.id-t.id))])).toMap()}*linearizedByTopoLevels(){yield*cp(this.topoLevels).map((e=>this.elementsByTopoLevel.get(e))).concat()}}let mp=1;const pp=e=>class extends e{};class fp{}class vp{constructor(){this.id=mp++,this.requirements=[],this.baseClass=fp,this.identitySymbol=void 0,this.mixinLambda=pp,this.walkDepthState=void 0,this.$minimalClass=void 0,this.name=""}static new(e){const t=new this;e&&Object.assign(t,e),t.walkDepthState=gp.new({sourceEl:t,baseEl:yp(t.baseClass)});const n=t.mixinLambda,r=t.identitySymbol=Symbol(n.name),i=Object.assign((function(e){const t=n(e);return t.prototype[r]=!0,t}),{[up]:r,[hp]:t});return Object.defineProperty(i,Symbol.hasInstance,{value:bp}),t.mixinLambda=i,t}get minimalClass(){return void 0!==this.$minimalClass?this.$minimalClass:this.$minimalClass=this.buildMinimalClass()}getBaseClassMixinId(e){const t=this.constructor,n=t.baseClassesIds.get(e);if(void 0!==n)return n;const r=mp++;return t.baseClassesIds.set(e,r),r}buildMinimalClass(){const e=this.constructor;let t=this.baseClass;const n=this.walkDepthState.linearizedByTopoLevelsSource.reduce(((t,n)=>{const{cls:r,hash:i}=t,s=i+String.fromCharCode(n.id);let o=e.minimalClassesByLinearHash.get(s);return o||(o=n.mixinLambda(r),n.name=o.name,e.minimalClassesByLinearHash.set(s,o)),t.cls=o,t.hash=s,t}),{cls:t,hash:String.fromCharCode(this.getBaseClassMixinId(t))}).cls,r=Object.assign(n,{[up]:this.identitySymbol,[hp]:this,mix:this.mixinLambda,derive:e=>wp([r,e],(e=>class extends e{})),$:this,toString:this.toString.bind(this)});return Object.defineProperty(r,Symbol.hasInstance,{value:bp}),r}toString(){return this.walkDepthState.linearizedByTopoLevelsSource.reduce(((e,t)=>`${t.name}(${e})`),this.baseClass.name)}}vp.minimalClassesByLinearHash=new Map,vp.baseClassesIds=new Map;const yp=e=>Object.getPrototypeOf(e.prototype).constructor[hp],bp=function(e){return Boolean(e&&e[this[up]])},Cp=(e,t)=>Boolean(e&&e[t[up]]),wp=(e,t)=>{let n;if(e.length>0){const t=e[e.length-1];r=t,Object.getPrototypeOf(r.prototype).constructor.hasOwnProperty(hp)||t===fp||(n=t)}var r;const i=[];return e.forEach(((t,r)=>{const s=t[hp];if(void 0!==s){const e=s.baseClass;if(e!==fp)if(n){if(n!==e){const t=e.prototype.isPrototypeOf(n.prototype),r=n.prototype.isPrototypeOf(e.prototype);if(!t&&!r)throw new Error("Base class mismatch");n=r?e:n}}else n=e;i.push(s)}else if(r!==e.length-1)throw new Error("Base class should be provided as the last element of the requirements array")})),vp.new({requirements:i,mixinLambda:t,baseClass:n||fp}).minimalClass};var Sp,Dp,Ep,xp,Rp,Tp,Mp,kp,Ip;!function(e){e.Millisecond="millisecond",e.Second="second",e.Minute="minute",e.Hour="hour",e.Day="day",e.Week="week",e.Month="month",e.Quarter="quarter",e.Year="year"}(Sp||(Sp={})),function(e){e.MustStartOn="muststarton",e.MustFinishOn="mustfinishon",e.StartNoEarlierThan="startnoearlierthan",e.StartNoLaterThan="startnolaterthan",e.FinishNoEarlierThan="finishnoearlierthan",e.FinishNoLaterThan="finishnolaterthan"}(Dp||(Dp={})),function(e){e.Normal="Normal",e.FixedDuration="FixedDuration",e.FixedEffort="FixedEffort",e.FixedUnits="FixedUnits"}(Ep||(Ep={})),function(e){e[e.NoError=0]="NoError",e[e.CyclicDependency=1]="CyclicDependency",e[e.DuplicatingDependency=2]="DuplicatingDependency"}(xp||(xp={})),function(e){e[e.StartToStart=0]="StartToStart",e[e.StartToEnd=1]="StartToEnd",e[e.EndToStart=2]="EndToStart",e[e.EndToEnd=3]="EndToEnd"}(Rp||(Rp={})),function(e){e.Project="Project",e.FromEvent="FromEvent",e.ToEvent="ToEvent"}(Tp||(Tp={})),function(e){e[e.SchedulerBasic=1]="SchedulerBasic",e[e.SchedulerPro=2]="SchedulerPro",e[e.Gantt=3]="Gantt"}(Mp||(Mp={})),function(e){e.Forward="Forward",e.Backward="Backward",e.None="None"}(kp||(kp={})),function(e){e.Start="Start",e.End="End"}(Ip||(Ip={}));const Ap=new Date(-864e13),Fp=new Date(864e13);var Op,Lp;!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(Op||(Op={})),function(e){e[e.FullRangeIterated=0]="FullRangeIterated",e[e.StoppedByIterator=1]="StoppedByIterator",e[e.MaxCacheExtendCyclesReached=2]="MaxCacheExtendCyclesReached",e[e.MaxRangeReached=3]="MaxRangeReached"}(Lp||(Lp={}));class Pp{constructor(e){this.cacheFilledStartDate=Fp,this.cacheFilledEndDate=Ap,this.intervalsCachingChunkDuration=30,this.intervalsCachingChunkUnit=Sp.Day,this.maxCacheExtendCycles=1e3,this.maxRange=15768e7,e&&Object.assign(this,e)}includeWrappingRangeFrom(e,t,n){e.ensureCacheFilledForInterval(t,n),this.intervalCache.includeWrappingRange(e.intervalCache,t,n)}ensureCacheFilledForInterval(e,t){const n=this.cacheFilledStartDate.getTime(),r=this.cacheFilledEndDate.getTime();if(n!==Fp.getTime()){const i=e.getTime(),s=t.getTime();if(n<=i&&s<=r)return;if(s<=n)t=new Date(n-1);else if(i>=r)e=new Date(r+1);else if(n<=i&&i<=r)e=new Date(r+1);else{if(!(n<=s&&s<=r))return this.ensureCacheFilledForInterval(e,new Date(n-1)),void this.ensureCacheFilledForInterval(new Date(r+1),t);t=new Date(n-1)}}(n===Fp.getTime()||e.getTime()<r)&&(this.cacheFilledStartDate=e),(r===Ap.getTime()||r<t.getTime())&&(this.cacheFilledEndDate=t),this.fillCache(e,t)}fillCache(e,t){throw new Error("Abstract method")}clear(){this.cacheFilledStartDate=Fp,this.cacheFilledEndDate=Ap,this.intervalCache.clear()}forEachAvailabilityInterval(e,t,n){var r;n=n||this;const i=e.startDate,s=e.endDate,o=i&&i.getTime(),a=s&&s.getTime(),l=null!==(r=e.maxRange)&&void 0!==r?r:this.maxRange,c=!1!==e.isForward;if(c?!i:!s)throw new Error("At least `startDate` or `endDate` is required, depending from the `isForward` option");const d=this.intervalCache;let u=c?i:s,h=c?i:s;const g=h.getTime();for(let e=1;e<this.maxCacheExtendCycles;e++){c?this.ensureCacheFilledForInterval(u,s||en.add(u,this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit)):this.ensureCacheFilledForInterval(i||en.add(u,-this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit),u);let e=d.getIntervalOf(h,c?Op.Left:Op.Right);for(;e;){const r=e.startDate,u=e.endDate;if(c&&a&&r.getTime()>=a||!c&&o&&u.getTime()<=o)return Lp.FullRangeIterated;if(c&&r.getTime()-g>=l||!c&&g-u.getTime()>=l)return Lp.MaxRangeReached;if(c&&r.getTime()>this.cacheFilledEndDate.getTime()||!c&&u.getTime()<this.cacheFilledStartDate.getTime())break;h=c?u:r;const m=o&&r.getTime()<o?i:r,p=a&&u.getTime()>a?s:u;if(!1===t.call(n,m,p,e.cacheInterval))return Lp.StoppedByIterator;e=c?d.getNextInterval(e):d.getPrevInterval(e)}if(c&&h.getTime()===Fp.getTime()||!c&&h.getTime()===Ap.getTime())return Lp.FullRangeIterated;u=c?this.cacheFilledEndDate:this.cacheFilledStartDate}return Lp.MaxCacheExtendCyclesReached}}class $p{constructor(e){if(this.intervals=[],e&&Object.assign(this,e),!this.calendar)throw new Error("Required attribute `calendar` is missing")}includeInterval(e){if(-1==this.intervals.indexOf(e)){const t=this.intervals.slice();return t.push(e),new $p({intervals:t,calendar:this.calendar})}return this}combineWith(e){return new $p({intervals:this.intervals.concat(e.intervals),calendar:this.calendar})}getIsWorking(){if(null!=this.isWorking)return this.isWorking;const e=this.intervals=this.normalizeIntervals(this.intervals);return this.isWorking=e[0].isWorking}normalizeIntervals(e){const t=(n=e,Array.from(new Set(n)));var n;return t.sort(((e,t)=>t.getPriorityField()-e.getPriorityField())),t}}const _p=(e,t,n=((e,t)=>e-t))=>{let r=0,i=t.length;for(;r<i;){const s=(r+i)/2|0,o=n(e,t[s]);if(0===o)return{found:!0,index:s};o<0?i=s:r=s+1}return{found:!1,index:i}};var Np;!function(e){e[e.Exact=0]="Exact",e[e.Next=1]="Next"}(Np||(Np={}));class Hp{constructor(e){this.keys=[],this.values=[],this.comparator=e||((e,t)=>e-t)}set(e,t){const n=_p(e,this.keys,this.comparator);return n.found?this.values[n.index]=t:(this.keys.splice(n.index,0,e),this.values.splice(n.index,0,t)),n.index}insertAt(e,t,n){this.keys.splice(e,0,t),this.values.splice(e,0,n)}setValueAt(e,t){this.values[e]=t}get(e){const t=_p(e,this.keys,this.comparator);return t.found?this.values[t.index]:void 0}getEntryAt(e){return e<this.keys.length?{key:this.keys[e],value:this.values[e]}:void 0}getKeyAt(e){return this.keys[e]}getValueAt(e){return this.values[e]}delete(e){const t=_p(e,this.keys,this.comparator);t.found&&this.deleteAt(t.index)}size(){return this.keys.length}deleteAt(e){this.keys.splice(e,1),this.values.splice(e,1)}indexOfKey(e){const t=_p(e,this.keys,this.comparator);return{found:t.found?Np.Exact:Np.Next,index:t.index}}map(e){const t=this.keys,n=this.values,r=[];for(let i=0;i<t.length;i++)r.push(e(n[i],t[i],i));return r}getAllEntries(){return this.map(((e,t)=>({value:e,key:t})))}clear(){this.keys.length=0,this.values.length=0}}class Bp{constructor(e){if(this.points=new Hp(((e,t)=>e.getTime()-t.getTime())),this.leftInfinityKey=Ap,this.rightInfinityKey=Fp,Object.assign(this,e),void 0===this.emptyInterval||!this.combineIntervalsFn)throw new Error("All of `emptyPoint`, `combineIntervalsFn` are required");this.points.set(this.leftInfinityKey,this.emptyInterval)}size(){return this.points.size()}indexOf(e){return this.points.indexOfKey(e)}getDateAt(e){return this.points.getKeyAt(e)}getPointAt(e){return this.points.getValueAt(e)}getIntervalOf(e,t=Op.Left){let n,{found:r,index:i}=this.indexOf(e);return n=t===Op.Left&&r===Np.Exact?i:i-1,this.getIntervalWithStartDateIndex(n)}getPrevInterval(e){return 0===e.startDateIndex?null:this.getIntervalWithStartDateIndex(e.startDateIndex-1)}getNextInterval(e){return e.startDateIndex>=this.size()-1?null:this.getIntervalWithStartDateIndex(e.startDateIndex+1)}getIntervalWithStartDateIndex(e){return{startDateIndex:e,startDate:this.getDateAt(e),endDate:e+1<this.size()?this.getDateAt(e+1):this.rightInfinityKey,cacheInterval:this.getPointAt(e)}}addInterval(e,t,n){const r=this.points,{found:i,index:s}=r.indexOfKey(e);let o,a;if(i==Np.Exact){const e=n(a=r.getValueAt(s));r.setValueAt(s,e),o=s+1}else{const t=n(a=r.getValueAt(s-1));r.insertAt(s,e,t),o=s+1}for(;o<r.size()&&!(r.getKeyAt(o).getTime()>=t.getTime());){const e=n(a=r.getValueAt(o));r.setValueAt(o,e),o++}o===r.size()?r.insertAt(r.size(),t,this.emptyInterval):r.getKeyAt(o).getTime()===t.getTime()||r.insertAt(o,t,a)}includeWrappingRange(e,t,n){let r=e.getIntervalOf(t);for(;r&&(this.addInterval(r.startDate,r.endDate,(e=>this.combineIntervalsFn(e,r.cacheInterval))),!(r.endDate.getTime()>n.getTime()));)r=e.getNextInterval(r)}getSummary(){return this.points.map(((e,t)=>({label:e,date:t})))}clear(){this.points.clear(),this.points.set(this.leftInfinityKey,this.emptyInterval)}}new Map;class jp extends Pp{constructor(e){if(super(e),this.staticIntervalsCached=!1,!this.unspecifiedTimeInterval)throw new Error("Required attribute `unspecifiedTimeInterval` is missing");this.intervalCache=new Bp({emptyInterval:new $p({intervals:[this.unspecifiedTimeInterval],calendar:this.calendar}),combineIntervalsFn:(e,t)=>e.combineWith(t)})}fillCache(e,t){this.staticIntervalsCached||(this.cacheStaticIntervals(),this.staticIntervalsCached=!0),this.parentCache&&this.includeWrappingRangeFrom(this.parentCache,e,t);const n=e.getTime(),r=t.getTime();if(n>r)throw new Error("Invalid cache fill interval");this.forEachRecurrentInterval((i=>{const s=i.getStartDateSchedule(),o=i.getEndDateSchedule();let a,l=s.prev(1,e);if("EOD"===o){const e=s.next(1,t);a=e!==op.NEVER?en.getStartOfNextDay(e,!0):op.NEVER}else a=o.next(1,t);if(l!==op.NEVER&&l.getTime()===n){const t=s.prev(2,e);t!==op.NEVER&&2===t.length&&(l=t[1])}if(a!==op.NEVER&&a.getTime()===r){const e=o.next(2,t);e!==op.NEVER&&2===e.length&&(a=e[1])}const c=s.next(1/0,l!==op.NEVER?l:e,a!==op.NEVER?new Date(a.getTime()-1):t);if(c===op.NEVER)return;const d="EOD"===o?c.map((e=>en.getStartOfNextDay(e,!0))):o.next(1/0,new Date(c[0].getTime()+1),a!==op.NEVER?a:t);d!==op.NEVER&&(d.length>c.length?d.length=c.length:d.length<c.length&&(c.length=d.length),c.forEach(((e,t)=>{const n=e,r=d[t];this.intervalCache.addInterval(n,r,(e=>e.includeInterval(i)))})))}))}clear(){this.staticIntervalsCached=!1,super.clear()}cacheStaticIntervals(){this.forEachStaticInterval((e=>{this.intervalCache.addInterval(e.startDate,e.endDate,(t=>t.includeInterval(e)))}))}forEachStaticInterval(e){this.intervalStore.forEach((t=>{t.isStatic()&&e(t)}))}forEachRecurrentInterval(e){this.intervalStore.forEach((t=>{t.isRecurrent()&&e(t)}))}}class Vp extends(wp([],(e=>(e.prototype,class extends e{async commitAsync(){return this.project.commitAsync()}set project(e){this.$project=e}get project(){return this.$project}calculateProject(){throw new Error("Implement me")}setProject(e){return this.project=e}getProject(){return this.project?this.project:this.setProject(this.calculateProject())}getAssignmentStore(){const e=this.getProject();return null==e?void 0:e.assignmentStore}getDependencyStore(){const e=this.getProject();return null==e?void 0:e.dependencyStore}getEventStore(){const e=this.getProject();return null==e?void 0:e.eventStore}getResourceStore(){const e=this.getProject();return null==e?void 0:e.resourceStore}getCalendarManagerStore(){const e=this.getProject();return null==e?void 0:e.calendarManagerStore}})))){}class zp extends(wp([Vp,As],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.isLoadingData=!1}construct(e={}){return e.asyncEvents={add:!0,remove:!0,removeAll:!0,change:!0,refresh:!0,replace:!0,move:!0,update:!0},t.construct.call(this,e)}trigger(e,n){const r=this,{asyncEvents:i,project:s}=r,o=null==i?void 0:i[e];return o&&(!0===o||o[n.action])?(t.trigger.call(r,`${e}PreCommit`,f({},n)),!s||s.isEngineReady()&&!s.isWritingData?t.trigger.call(r,e,n):!r.eventsSuspended&&s&&(s.dataReadyDetacher||(s.queuedDataReadyEvents=[],s.dataReadyDetacher=s.on({dataReady(){this.queuedDataReadyEvents.forEach((([e,t,n,r])=>{e.trigger.call(t,n,r)})),s.queuedDataReadyEvents=null,s.dataReadyDetacher(),s.dataReadyDetacher=null},once:!0})),s.queuedDataReadyEvents.push([t,r,e,n])),!0):t.trigger.call(r,e,n)}calculateProject(){return this.project}setStoreData(e){var n;this.project&&(this.project.hasLoadedDataToCommit=!0),this.isLoadingData=!0,t.setStoreData.call(this,e),this.isLoadingData=!1,null===(n=this.project)||void 0===n||n.trigger("storeRefresh",{store:this})}async doAutoCommit(){this.suspendCount<=0&&this.project&&!this.project.isEngineReady()&&await this.project.commitAsync(),t.doAutoCommit.call(this)}async addAsync(e,t){const n=this.add(e,t);return await this.project.commitAsync(),n}async insertAsync(e,t,n){const r=this.insert(e,t,n);return await this.project.commitAsync(),r}async loadDataAsync(e){this.data=e,await this.project.commitAsync()}}}))){}class Wp extends(wp([Vp,Hi],(e=>{const t=e.prototype;return class extends e{joinStore(e){let n=null;if(Cp(e,zp)){const t=e.getProject();t&&!this.getProject()&&(this.setProject(t),n=t)}t.joinStore.call(this,e),n&&!n.isRepopulatingStores&&this.joinProject()}unjoinStore(e,n=!1){t.unjoinStore.call(this,e,n);const r=this.getProject(),i=Cp(e,zp)&&r===e.getProject();r&&!r.isDestroying&&!r.isRepopulatingStores&&i&&(this.leaveProject(n),this.setProject(null)),i&&(this.graph=null)}joinProject(){}leaveProject(e=!1){}calculateProject(){const e=this.stores.find((e=>Cp(e,zp)&&!!e.getProject()));return null==e?void 0:e.getProject()}async setAsync(e,t,n){var r;const i=this.set(e,t,n);return await(null===(r=this.project)||void 0===r?void 0:r.commitAsync()),i}async getAsync(e){var t;return await(null===(t=this.project)||void 0===t?void 0:t.commitAsync()),this.get(e)}get isStmRestoring(){const e=this.getProject();return(null==e?void 0:e.isRestoringData)||(null==e?void 0:e.stm.isRestoring)||!1}}}))){}class Up extends(wp([Wp],(e=>(e.prototype,class extends e{static get fields(){return["name",{name:"startDate",type:"date"},{name:"endDate",type:"date"},"recurrentStartDate","recurrentEndDate","cls","iconCls",{name:"isWorking",type:"boolean",defaultValue:!1},{name:"priority",type:"number"}]}getCalendar(){return this.stores[0].calendar}resetPriority(){this.priorityField=null,this.getCalendar().getDepth()}getPriorityField(){if(null!=this.priorityField)return this.priorityField;let e=1e4+100*this.getCalendar().getDepth(),t=this.priority;return null==t&&(t=this.isRecurrent()?20:30),this.priorityField=e+t}isRecurrent(){return Boolean(this.recurrentStartDate&&this.recurrentEndDate&&this.getStartDateSchedule()&&this.getEndDateSchedule())}isStatic(){return Boolean(this.startDate&&this.endDate)}parseDateSchedule(e){let t=e;if(e&&e!==Object(e)&&(t=op.parse.text(e),t!==Object(t)||t.error>=0))try{t=JSON.parse(e)}catch(e){return null}return t}getStartDateSchedule(){if(this.startDateSchedule)return this.startDateSchedule;const e=this.parseDateSchedule(this.recurrentStartDate);return this.startDateSchedule=op.schedule(e)}getEndDateSchedule(){if(this.endDateSchedule)return this.endDateSchedule;if("EOD"===this.recurrentEndDate)return"EOD";const e=this.parseDateSchedule(this.recurrentEndDate);return this.endDateSchedule=op.schedule(e)}})))){}class Yp extends(wp([zp],(e=>(e.prototype,class extends e{static get defaultConfig(){return{modelClass:Up}}})))){}class Gp extends(wp([Up],(e=>(e.prototype,class extends e{getCalendar(){return this.calendar}getPriorityField(){return null!=this.priorityField?this.priorityField:this.priorityField=this.getCalendar().getDepth()}})))){}class qp extends(wp([Vp],(e=>(e.prototype,class extends e{get eventStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.eventStore}get resourceStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.resourceStore}get assignmentStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.assignmentStore}get dependencyStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.dependencyStore}get calendarManagerStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.calendarManagerStore}getEventById(e){var t;return null===(t=this.eventStore)||void 0===t?void 0:t.getById(e)}getDependencyById(e){var t;return null===(t=this.dependencyStore)||void 0===t?void 0:t.getById(e)}getResourceById(e){var t;return null===(t=this.resourceStore)||void 0===t?void 0:t.getById(e)}getAssignmentById(e){var t;return null===(t=this.assignmentStore)||void 0===t?void 0:t.getById(e)}getCalendarById(e){var t;return null===(t=this.calendarManagerStore)||void 0===t?void 0:t.getById(e)}})))){}class Kp extends(wp([Wp],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.version=1}static get fields(){return[{name:"version",type:"number"},"name",{name:"unspecifiedTimeIsWorking",type:"boolean",defaultValue:!0},{name:"intervals",type:"store"}]}get intervalStoreClass(){return Yp}get intervalStore(){return this.meta.intervalsStore}initIntervalsStore(e){e.storeClass=this.intervalStoreClass,e.modelClass=this.getDefaultConfiguration().calendarIntervalModelClass||this.intervalStoreClass.defaultConfig.modelClass,e.calendar=this}isDefault(){const e=this.getProject();return!!e&&this===e.defaultCalendar}getDepth(){return this.childLevel+1}forEachAvailabilityInterval(e,t,n){const r=this.getProject().maxCalendarRange;return r&&(e=Object.assign({maxRange:r},e)),this.calendarCache.forEachAvailabilityInterval(e,t,n)}accumulateWorkingTime(e,t,n){if(0===t)return{finalDate:new Date(e),remainingDurationInMs:0};if(isNaN(t))throw new Error("Invalid duration");let r=e;return this.forEachAvailabilityInterval(n?{startDate:e,isForward:!0}:{endDate:e,isForward:!1},((e,i,s)=>{let o=!0;if(s.getIsWorking()){let s=i.getTime()-e.getTime();this.getProject().adjustDurationToDST&&(s+=60*(e.getTimezoneOffset()-i.getTimezoneOffset())*1e3),t<=s?(r=n?new Date(e.getTime()+t):new Date(i.getTime()-t),t=0,o=!1):(r=n?i:e,t-=s)}return o})),{finalDate:new Date(r),remainingDurationInMs:t}}calculateDurationMs(e,t,n=!1){let r=0;const i=e.getTime()<=t.getTime()||!n?1:-1;return i<0&&([e,t]=[t,e]),this.forEachAvailabilityInterval({startDate:e,endDate:t},((e,t,n)=>{if(n.getIsWorking()&&(r+=t.getTime()-e.getTime(),this.getProject().adjustDurationToDST)){const n=e.getTimezoneOffset()-t.getTimezoneOffset();r+=60*n*1e3}})),r*i}calculateEndDate(e,t){const n=t>=0,r=this.accumulateWorkingTime(e,Math.abs(t),n);return 0===r.remainingDurationInMs?r.finalDate:null}calculateStartDate(e,t){const n=t<=0,r=this.accumulateWorkingTime(e,Math.abs(t),n);return 0===r.remainingDurationInMs?r.finalDate:null}skipNonWorkingTime(e,t=!0){let n;const r=this.forEachAvailabilityInterval(t?{startDate:e,isForward:!0}:{endDate:e,isForward:!1},((e,r,i)=>{if(i.getIsWorking())return n=t?e:r,!1}));return r===Lp.MaxRangeReached||r===Lp.FullRangeIterated?"empty_calendar":n?new Date(n):new Date(e)}addInterval(e){return this.addIntervals([e])}addIntervals(e){return this.bumpVersion(),this.intervalStore.add(e)}removeInterval(e){return this.removeIntervals([e])}removeIntervals(e){return this.bumpVersion(),this.intervalStore.remove(e)}clearIntervals(e){return e||this.bumpVersion(),this.intervalStore.removeAll(e)}bumpVersion(){this.clearCache(),this.version++}get calendarCache(){if(void 0!==this.$calendarCache)return this.$calendarCache;const e=new Gp({isWorking:this.unspecifiedTimeIsWorking});return e.calendar=this,this.$calendarCache=new jp({calendar:this,unspecifiedTimeInterval:e,intervalStore:this.intervalStore,parentCache:this.parent&&!this.parent.isRoot?this.parent.calendarCache:null})}clearCache(){this.$calendarCache&&this.$calendarCache.clear(),this.$calendarCache=void 0}resetPriorityOfAllIntervals(){this.traverse((e=>{e.intervalStore.forEach((e=>e.resetPriority()))}))}insertChild(e,n,r){let i=t.insertChild.call(this,...arguments);return Array.isArray(i)||(i=[i]),i.forEach((e=>{e.bumpVersion(),e.resetPriorityOfAllIntervals()})),i}joinProject(){t.joinProject.call(this),this.intervalStore.setProject(this.getProject())}leaveProject(){t.leaveProject.call(this),this.intervalStore.setProject(null),this.intervalStore.destroy(),this.clearCache()}doDestroy(){this.leaveProject(),super.doDestroy()}isDayHoliday(e){const t=en.clearTime(e),n=en.getNext(e,Sp.Day);let r=!1;return this.forEachAvailabilityInterval({startDate:t,endDate:n,isForward:!0},((e,t,n)=>(r=n.getIsWorking(),!r))),!r}getDailyHolidaysRanges(e,t){const n=[];for(e=en.clearTime(e);e<t;)this.isDayHoliday(e)&&n.push({startDate:e,endDate:en.getStartOfNextDay(e,!0,!0)}),e=en.getNext(e,Sp.Day);return n}getWorkingTimeRanges(e,t){const n=[];return this.forEachAvailabilityInterval({startDate:e,endDate:t,isForward:!0},((e,t,r)=>{if(r.getIsWorking()){const i=r.intervals[0];n.push({name:i.name,startDate:e,endDate:t})}})),n}getNonWorkingTimeRanges(e,t){const n=[];return this.forEachAvailabilityInterval({startDate:e,endDate:t,isForward:!0},((e,t,r)=>{if(!r.getIsWorking()){const i=r.intervals[0];n.push({name:i.name,iconCls:i.iconCls,cls:i.cls,startDate:e,endDate:t})}})),n}isWorkingTime(e,t,n){if(n){let n;const r=this.forEachAvailabilityInterval({startDate:e,endDate:t,isForward:!0},((r,i,s)=>{if(s.getIsWorking()&&r<=e&&i>=t)return n=!0,!1}));return r!==Lp.MaxRangeReached&&r!==Lp.FullRangeIterated&&n}{const n=this.skipNonWorkingTime(e);return!(!n||"empty_calendar"===n)&&(t?n<t:n.getTime()===e.getTime())}}}}))){}class Xp extends(wp([Wp],(e=>{const t=e.prototype;return class extends e{getAssignmentFor(e){for(const n of null!==(t=this.assigned)&&void 0!==t?t:[]){var t;if(n.resource===e)return n}return null}isAssignedTo(e){return Boolean(this.getAssignmentFor(e))}async assign(e){const t=this.project.assignmentStore.modelClass;return this.addAssignment(new t({event:this,resource:e})),this.commitAsync()}async unassign(e){const t=this.getAssignmentFor(e);return this.removeAssignment(t),this.commitAsync()}leaveProject(){if(this.isInActiveTransaction&&this.assigned){const e=this.getEventStore();this.assigned.forEach((t=>e.assignmentsForRemoval.add(t)))}t.leaveProject.call(this,...arguments)}remove(){if(!this.parent)return t.remove.call(this);{const e=this.getEventStore();t.remove.call(this),e&&e.afterEventRemoval()}}addAssignment(e){return this.getProject().assignmentStore.add(e),e}removeAssignment(e){return this.getProject().assignmentStore.remove(e),e}}}))){}class Zp extends(wp([Wp,qp,Hi],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.$isCalculating=!1,this.$changed={},this.$beforeChange={}}get isInActiveTransaction(){return!0}joinProject(){this.invalidate()}leaveProject(e=!1){var n;t.leaveProject.call(this,e),null===(n=this.project)||void 0===n||n.bufferedCommitAsync()}invalidate(){var e;null===(e=this.project)||void 0===e||e.invalidate(this)}getCurrentOrProposed(e){var t;return e in this.$changed&&!0!==this.$changed[e]?this.$changed[e]:null!==(t=this.get(e))&&void 0!==t?t:null}hasCurrentOrProposed(e){return e in this.$changed&&1!=this.$changed[e]||null!=this.get(e)}propose(e){var t;if(this.project||null!==(t=this.recurringTimeSpan)&&void 0!==t&&t.project){const t=Object.keys(e);for(let n=0;n<t.length;n++){const r=t[n];this.$changed[r]=e[r]}this.invalidate()}else this.set(e)}setChanged(e,t,n=!0,r=!1){const i=this;i.$changed[e]=t,r&&(e in i.$beforeChange||(i.$beforeChange[e]=i.get(e)),i.setData(e,t)),n&&i.invalidate()}calculateInvalidated(){}finalizeInvalidated(e=!1){const t=this;t.$isCalculating=!0,e?t.setData(t.$changed):(t.setData(t.$beforeChange),t.set(t.$changed)),t.$changed={},t.$beforeChange={},t.$isCalculating=!1}}}))){}const Jp=e=>e instanceof Set||e instanceof Array?cp(e):cp([e]);class Qp extends(wp([zp],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.allAssignmentsForRemoval=!1}remove(e,n){this.assignmentsForRemoval=Jp(e).toSet();const r=t.remove.call(this,e,n);return this.assignmentsForRemoval.clear(),r}removeAll(e){this.allAssignmentsForRemoval=!0;const n=t.removeAll.call(this,e);return this.allAssignmentsForRemoval=!1,n}}}))){}class ef extends(wp([zp],(e=>(e.prototype,class extends e{doDestroy(){var e;const t=[];null!==(e=this.rootNode)&&void 0!==e&&e.isDestroyed||this.traverse((e=>t.push(e))),super.doDestroy(),t.forEach((e=>e.destroy()))}})))){}class tf extends(wp([zp],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}remove(e,n){this.dependenciesForRemoval=Jp(e).toSet();const r=t.remove.call(this,e,n);return this.dependenciesForRemoval.clear(),r}removeAll(e){this.allDependenciesForRemoval=!0;const n=t.removeAll.call(this,e);return this.allDependenciesForRemoval=!1,n}}}))){}const nf={splice:1,clear:1};class rf extends(wp([zp],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.dependenciesForRemoval=new Set}onDataChange(e){var t;const n=nf[e.action];super.onDataChange(e),n&&null!==(t=e.removed)&&void 0!==t&&t.length&&this.afterEventRemoval()}remove(e,n){const r=t.remove.call(this,e,n);return this.afterEventRemoval(),r}removeAll(e){const n=t.removeAll.call(this,e);return this.afterEventRemoval(),n}afterEventRemoval(){const{assignmentsForRemoval:e,dependenciesForRemoval:t}=this;if(!e)return;const n=this.getAssignmentStore();if(n&&!n.allAssignmentsForRemoval&&e.size){const t=[...e].filter((e=>!n.assignmentsForRemoval.has(e)));t.length>0&&n.remove(t)}e.clear();const r=this.getDependencyStore();if(r&&!r.allDependenciesForRemoval&&t.size){const e=[...t].filter((e=>!r.dependenciesForRemoval.has(e)));e.length>0&&r.remove(e)}t.clear()}processRecord(e,t=!1){var n;if(null===(n=this.project)||void 0===n||!n.isRepopulatingStores){const t=this.getById(e.id);if(t&&t!==e&&t.assigned)for(const n of t.assigned)n.event=e}return e}}}))){}const sf={splice:1,clear:1};class of extends(wp([zp],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set}onDataChange(e){var t;const n=sf[e.action];super.onDataChange(e),n&&null!==(t=e.removed)&&void 0!==t&&t.length&&this.afterResourceRemoval()}remove(e,n){const r=t.remove.call(this,e,n);return this.afterResourceRemoval(),r}removeAll(e){const n=t.removeAll.call(this,e);return this.afterResourceRemoval(),n}afterResourceRemoval(){const e=this.getAssignmentStore();if(e&&!e.allAssignmentsForRemoval){const t=[...this.assignmentsForRemoval].filter((t=>!e.assignmentsForRemoval.has(t)));t.length>0&&e.remove(t)}this.assignmentsForRemoval.clear()}processRecord(e,t=!1){const n=this.getById(e.id);if(n&&n!==e)for(const t of n.assigned||[])t.resource=e;return e}}}))){}class af extends(wp([Zp],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this._startDate=null,this._endDate=null,this._duration=null}static get fields(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number"},{name:"durationUnit",type:"durationunit",defaultValue:"day"}]}get startDate(){var e,t;return null!==(e=null!==(t=this._startDate)&&void 0!==t?t:this.get("startDate"))&&void 0!==e?e:null}get endDate(){var e,t;return null!==(e=null!==(t=this._endDate)&&void 0!==t?t:this.get("endDate"))&&void 0!==e?e:null}get duration(){var e,t;return null!==(e=null!==(t=this._duration)&&void 0!==t?t:this.get("duration"))&&void 0!==e?e:null}set startDate(e){this.proposeStartDate(e)}set endDate(e){this.proposeEndDate(e)}set duration(e){this.proposeDuration(e)}inSet(e,n,r,i,s){const o=this;return!o.project||o.project.isWritingData||"string"==typeof e||s||("startDate"in e&&!("startDate"in o.$changed)&&(o.$changed.startDate=!0),"endDate"in e&&!("endDate"in o.$changed)&&(o.$changed.endDate=!0)),t.inSet.call(o,e,n,r,i,s)}getStartDate(){return this.startDate}proposeStartDate(e,t=!("endDate"in this.$changed)){var n;(this.inSetting||(null==e?void 0:e.getTime())!==(null===(n=this.startDate)||void 0===n?void 0:n.getTime()))&&(this._startDate=e,this.propose({startDate:e,keepDuration:t}))}async setStartDate(e,t=!0){var n;return this.proposeStartDate(e,t),null===(n=this.project)||void 0===n?void 0:n.commitAsync()}getEndDate(){return this.endDate}proposeEndDate(e,t=!1){var n;(this.inSetting||(null==e?void 0:e.getTime())!==(null===(n=this.endDate)||void 0===n?void 0:n.getTime()))&&(this._endDate=e,this.propose({endDate:e,keepDuration:t}))}async setEndDate(e,t=!1){var n;return this.proposeEndDate(e,t),null===(n=this.project)||void 0===n?void 0:n.commitAsync()}getDuration(){return this.duration}proposeDuration(e,t,n=!0){this._duration=e,this.propose({duration:e,keepStart:n}),t&&this.propose({durationUnit:t})}async setDuration(e,t,n=!0){var r;return this.proposeDuration(e,t,n),null===(r=this.project)||void 0===r?void 0:r.commitAsync()}getDurationUnit(){return this.durationUnit}joinProject(){const e=this,n=e.$changed,r=e.getCurrentOrProposed("startDate"),i=e.getCurrentOrProposed("endDate"),s=e.getCurrentOrProposed("duration");if(null!=r&&(n.startDate=e._startDate=r),null!=i&&(n.endDate=e._endDate=i),null!=s&&(n.duration=e._duration=s),e.eventStore&&!e.eventStore.isLoadingData){var o;const t=null===(o=e.assignmentStore)||void 0===o?void 0:o.storage.findItem("event",null);if(t){var a;const n=null===(a=e.assignmentStore)||void 0===a?void 0:a.storage.findItem("eventId",e.id);if(n)for(const t of n)t.setChanged("event",e);else for(const n of t)n.getCurrentOrProposed("event")===e.id&&n.setChanged("event",e)}}t.joinProject.call(e)}applyValue(e,n,r,i,s){var o;(this.project||null!==(o=this.recurringTimeSpan)&&void 0!==o&&o.project)&&("startDate"!==n&&"duration"!=n&&"endDate"!==n||(e=!0,this["_"+n]=r),i&&(e=!1)),t.applyValue.call(this,e,n,r,i,s)}afterChange(e,n,r,i,s){this.$isCalculating||s||this.setData({startDate:this.getCurrentOrProposed("startDate"),endDate:this.getCurrentOrProposed("endDate"),duration:this.getCurrentOrProposed("duration"),durationUnit:this.getCurrentOrProposed("durationUnit")}),t.afterChange.call(this,e,n,r,i,s)}calculateInvalidated(){const e=this,t=e.$changed,n="startDate"in t,r="endDate"in t,i="duration"in t,{startDate:s,endDate:o,duration:a,keepDuration:l,keepStart:c}=t;let d=null;!n||r||i?n||!r||i?n||r||!i?n&&r&&!i?null===s&&null===o?t.duration=null:d="duration":n&&!r&&i?d="endDate":!n&&r&&i?d="startDate":n&&r&&i&&(d=null==a?"duration":null==s?"startDate":"endDate"):null===a?t.endDate=null:!e.hasCurrentOrProposed("startDate")||!c&&e.hasCurrentOrProposed("endDate")?e.hasCurrentOrProposed("endDate")&&(d="startDate"):(c&&t.duration<0&&(t.duration=0),d="endDate"):null===o?t.startDate=null:e.hasCurrentOrProposed("startDate")&&o<e.getCurrentOrProposed("startDate")&&!l?(t.startDate=o,t.duration=0):!e.hasCurrentOrProposed("duration")||!l&&e.hasCurrentOrProposed("startDate")?e.hasCurrentOrProposed("startDate")&&(d="duration"):d="startDate":null===s?t.endDate=null:e.hasCurrentOrProposed("endDate")&&s>e.getCurrentOrProposed("endDate")&&!l?(t.endDate=s,t.duration=0):!e.hasCurrentOrProposed("duration")||!l&&e.hasCurrentOrProposed("endDate")?e.hasCurrentOrProposed("endDate")&&(d="duration"):d="endDate";const u=e.getCurrentOrProposed("startDate"),h=e.getCurrentOrProposed("endDate"),g=e.getCurrentOrProposed("duration"),m=e.getCurrentOrProposed("durationUnit");let p,f;switch(d){case"startDate":t.startDate=en.add(h,-g,m);break;case"endDate":p=en.as("hour",g,m),f=en.as(m,p,"h"),t.endDate=en.add(u,f,m);break;case"duration":p=en.diff(u,h,"h"),t.duration=en.as(m,p,"h")}"startDate"in t&&!0!==t.startDate&&(this._startDate=t.startDate),"endDate"in t&&!0!==t.endDate&&(this._endDate=t.endDate),"duration"in t&&!0!==t.duration&&(this._duration=t.duration),delete t.keepDuration,delete t.keepStart}}}))){}class lf extends(wp([Zp],(e=>{const t=e.prototype;return class extends e{get assigned(){var e;return null===(e=this.project)||void 0===e?void 0:e.assignmentStore.getResourcesAssignments(this)}joinProject(){var e;this.resourceStore&&!this.resourceStore.isLoadingData&&(null===(e=this.assignmentStore)||void 0===e||e.query((e=>e.get("resource")===this.id)).forEach((e=>e.setChanged("resource",this)))),t.joinProject.call(this)}leaveProject(e=!1){if(this.assigned&&!e){const e=this.resourceStore;this.assigned.forEach((t=>e.assignmentsForRemoval.add(t)))}t.leaveProject.call(this)}applyValue(e,n,r,i,s){"id"===(null==s?void 0:s.name)&&this.assigned.forEach((e=>{e.set("resourceId",r)})),t.applyValue.call(this,e,n,r,i,s)}}}))){}class cf extends(wp([Zp],(e=>{const t=e.prototype;return class extends e{static get fields(){return[{name:"resource",isEqual:(e,t)=>e===t,persist:!1},{name:"event",isEqual:(e,t)=>e===t,persist:!1}]}setChanged(e,n,r){const{assignmentStore:i,eventStore:s,resourceStore:o,project:a}=this;let l=!1;if("event"===e){const e=Cp(n,af)?n:null==s?void 0:s.getById(n);e&&(l=!0),n=e||n}if("resource"===e){const e=Cp(n,lf)?n:null==o?void 0:o.getById(n);e&&(l=!0),n=e||n}t.setChanged.call(this,e,n,r,!0),!i||!l||a.isPerformingCommit||i.isLoadingData||o.isLoadingData||i.skipInvalidateIndices||i.invalidateIndices()}joinProject(){t.joinProject.call(this),this.setChanged("event",this.get("event")),this.setChanged("resource",this.get("resource"))}calculateInvalidated(){let{event:e=this.event,resource:t=this.resource}=this.$changed;if(null!==e&&!Cp(e,af)){var n;const t=null===(n=this.eventStore)||void 0===n?void 0:n.getById(e);t&&this.setChanged("event",t,!1)}if(null!==t&&!Cp(t,lf)){var r;const e=null===(r=this.resourceStore)||void 0===r?void 0:r.getById(t);e&&this.setChanged("resource",e,!1)}}finalizeInvalidated(e){const n=this.$changed;var r,i;"resource"in n&&(n.resourceId=null!==(r=n.resource)&&void 0!==r&&r.isModel?n.resource.id:n.resource),"event"in n&&(n.eventId=null!==(i=n.event)&&void 0!==i&&i.isModel?n.event.id:n.event),t.finalizeInvalidated.call(this,e)}set event(e){this.setChanged("event",e)}get event(){const e=this.get("event");return null!=(null==e?void 0:e.id)?e:null}set resource(e){this.setChanged("resource",e)}get resource(){const e=this.get("resource");return null!=(null==e?void 0:e.id)?e:null}}}))){}class df extends(wp([zp,qp,As],(e=>{const t=e.prototype;return class extends e{setProject(e){const n=t.setProject.call(this,e);return e&&this.joinProject(e),n}joinProject(e){}onCommitAsync(){}}}))){}const uf=new Set;class hf extends(wp([Qp,df],(e=>(e.prototype,class extends e{constructor(){super(...arguments),this.skipInvalidateIndices=!1}static get defaultConfig(){return{modelClass:cf,storage:{extraKeys:[{property:"event",unique:!1},{property:"resource",unique:!1},{property:"eventId",unique:!1}]}}}set data(e){this.allAssignmentsForRemoval=!0,super.data=e,this.allAssignmentsForRemoval=!1}getEventsAssignments(e){return this.storage.findItem("event",e)||uf}getResourcesAssignments(e){return this.storage.findItem("resource",e.$original)||uf}updateIndices(){this.storage.rebuildIndices()}invalidateIndices(){this.storage.invalidateIndices()}linkAssignments(e,t){const n=this.count&&this.storage.findItem(t,null);if(n){for(const r of n){const n=e.getById(r.getCurrentOrProposed(t));n&&r.setChanged(t,n)}this.invalidateIndices()}}unlinkAssignments(e){this.forEach((t=>{var n,r,i;return t.setChanged(e,null!==(n=null!==(r=null===(i=t[e])||void 0===i?void 0:i.id)&&void 0!==r?r:null==t?void 0:t.getData(e))&&void 0!==n?n:t[e+"Id"])})),this.invalidateIndices()}onCommitAsync(){this.updateIndices()}})))){}class gf extends(wp([Kp,Zp],(e=>(e.prototype,class extends e{})))){}class mf extends(wp([ef,df],(e=>(e.prototype,class extends e{static get defaultConfig(){return{tree:!0,modelClass:gf}}})))){}class pf extends(wp([Zp],(e=>{const t=e.prototype;return class extends e{static get fields(){return[{name:"fromEvent",isEqual:(e,t)=>e===t,persist:!1},{name:"toEvent",isEqual:(e,t)=>e===t,persist:!1}]}setChanged(e,n,r){var i;let s=!1;if("fromEvent"===e||"toEvent"===e){var o;const e=Cp(n,af)?n:null===(o=this.eventStore)||void 0===o?void 0:o.getById(n);e&&(s=!0),n=e||n}var a;t.setChanged.call(this,e,n,r,!0),!s||this.project.isPerformingCommit||null!==(i=this.dependencyStore)&&void 0!==i&&i.isLoadingData||null===(a=this.dependencyStore)||void 0===a||a.invalidateIndices()}joinProject(){t.joinProject.call(this),this.setChanged("fromEvent",this.get("fromEvent")),this.setChanged("toEvent",this.get("toEvent"))}calculateInvalidated(){let{fromEvent:e,toEvent:t}=this.$changed;if(null!==e&&!Cp(e,af)){var n;const t=null===(n=this.eventStore)||void 0===n?void 0:n.getById(e);t&&(this.$changed.fromEvent=t)}if(null!==t&&!Cp(t,af)){var r;const e=null===(r=this.eventStore)||void 0===r?void 0:r.getById(t);e&&(this.$changed.toEvent=e)}}set fromEvent(e){this.setChanged("fromEvent",e)}get fromEvent(){const e=this.get("fromEvent");return null!=(null==e?void 0:e.id)?e:null}set toEvent(e){this.setChanged("toEvent",e)}get toEvent(){const e=this.get("toEvent");return null!=(null==e?void 0:e.id)?e:null}}}))){}const ff=new Set;class vf extends(wp([tf,df],(e=>(e.prototype,class extends e{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}static get defaultConfig(){return{modelClass:pf,storage:{extraKeys:[{property:"fromEvent",unique:!1},{property:"toEvent",unique:!1}]}}}getIncomingDepsForEvent(e){return this.storage.findItem("toEvent",e)||ff}getOutgoingDepsForEvent(e){return this.storage.findItem("fromEvent",e)||ff}set data(e){this.allDependenciesForRemoval=!0,super.data=e,this.allDependenciesForRemoval=!1}updateIndices(){this.storage.rebuildIndices()}invalidateIndices(){this.storage.invalidateIndices()}onCommitAsync(){this.updateIndices()}})))){}class yf extends(wp([af,Xp],(e=>{const t=e.prototype;return class extends e{get assigned(){var e,t;return null!==(e=null===(t=this.project)||void 0===t?void 0:t.assignmentStore.getEventsAssignments(this))&&void 0!==e?e:this.$cachedAssignments}leaveProject(e=!1){this.$cachedAssignments=this.assigned,super.leaveProject(e)}applyValue(e,n,r,i,s){var o;"id"===n&&(null===(o=this.assigned)||void 0===o||o.forEach((e=>e.set("eventId",r)))),t.applyValue.call(this,e,n,r,i,s)}copy(e=null,n=null){const r=t.copy.call(this,e,n);return(sn.isObject(n)&&!n.skipFieldIdentifiers||!sn.isObject(n))&&(r.$cachedAssignments=this.assigned),r}}}))){}class bf extends(wp([af],(e=>{const t=e.prototype;return class extends e{get outgoingDeps(){return this.project.dependencyStore.getOutgoingDepsForEvent(this)}get incomingDeps(){return this.project.dependencyStore.getIncomingDepsForEvent(this)}leaveProject(){const e=this.eventStore;this.outgoingDeps&&this.outgoingDeps.forEach((t=>e.dependenciesForRemoval.add(t))),this.incomingDeps&&this.incomingDeps.forEach((t=>e.dependenciesForRemoval.add(t))),t.leaveProject.call(this)}}}))){}class Cf extends(wp([af,yf,bf],(e=>(e.prototype,class extends e{})))){}class wf extends(wp([rf,df],(e=>(e.prototype,class extends e{static get defaultConfig(){return{modelClass:Cf}}joinProject(){var e;null===(e=this.assignmentStore)||void 0===e||e.linkAssignments(this,"event")}afterLoadData(){var e;this.afterEventRemoval(),null===(e=this.assignmentStore)||void 0===e||e.linkAssignments(this,"event")}})))){}class Sf extends(wp([of,df],(e=>{const t=e.prototype;return class extends e{static get defaultConfig(){return{modelClass:lf}}joinProject(){var e;null===(e=this.assignmentStore)||void 0===e||e.linkAssignments(this,"resource")}afterLoadData(){var e;null===(e=this.assignmentStore)||void 0===e||e.linkAssignments(this,"resource")}clear(e){var n;t.clear.call(this,e),null===(n=this.assignmentStore)||void 0===n||n.unlinkAssignments("resource")}}}))){}class Df extends(wp([],tt)){}class Ef extends(wp([],Zr)){}class xf extends(wp([Df,Ef,Hi],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.isRestoringData=!1}get isRepopulatingStores(){return!1}get isInitialCommit(){return!this.isInitialCommitPerformed||this.hasLoadedDataToCommit}construct(e={}){this.isInitialCommitPerformed=!1,this.isLoadingInlineData=!1,this.isWritingData=!1,this.hasLoadedDataToCommit=!1,this.maxCalendarRange="maxCalendarRange"in e?e.maxCalendarRange:15768e7,t.construct.call(this,e),this.silenceInitialCommit=!("silenceInitialCommit"in e)||e.silenceInitialCommit,this.adjustDurationToDST="adjustDurationToDST"in e&&e.adjustDurationToDST}repopulateStore(e){}repopulateReplica(){}deferUntilRepopulationIfNeeded(e,t,n){t(...n)}attachStore(e){}detachStore(e){}async commitAsync(){throw new Error("Abstract method called")}isEngineReady(){throw new Error("Abstract method called")}getStm(){throw new Error("Abstract method called")}}}))){}class Rf extends(wp([],Zr)){}class Tf extends(wp([xf,qp,Rf,Hi],(e=>{const t=e.prototype;class n extends e{static get defaultConfig(){return{stm:{},eventStore:{},assignmentStore:{},resourceStore:{},dependencyStore:{},calendarManagerStore:{},eventModelClass:Cf,assignmentModelClass:cf,resourceModelClass:lf,dependencyModelClass:pf,calendarModelClass:gf,eventStoreClass:wf,assignmentStoreClass:hf,resourceStoreClass:Sf,dependencyStoreClass:vf,calendarManagerStoreClass:mf,assignmentsData:null,calendarsData:null,dependenciesData:null,eventsData:null,resourcesData:null}}construct(e={}){this.$invalidated=new Set,this.isPerformingCommit=!1,this.silenceInitialCommit=!0,this.ongoing=Promise.resolve(),t.construct.call(this,e),this.defaultCalendar=new this.calendarManagerStore.modelClass({unspecifiedTimeIsWorking:this.unspecifiedTimeIsWorking}),this.defaultCalendar.project=this;const{calendarsData:n,eventsData:r,dependenciesData:i,resourcesData:s,assignmentsData:o}=this;Boolean(n||r||i||s||o)?(this.loadInlineData({calendarsData:n,eventsData:r,dependenciesData:i,resourcesData:s,assignmentsData:o}),delete this.calendarsData,delete this.eventsData,delete this.dependenciesData,delete this.resourcesData,delete this.assignmentsData):this.bufferedCommitAsync()}doDestroy(){var e,n,r,i,s,o;const a=this;null===(e=a.eventStore)||void 0===e||e.destroy(),null===(n=a.dependencyStore)||void 0===n||n.destroy(),null===(r=a.assignmentStore)||void 0===r||r.destroy(),null===(i=a.resourceStore)||void 0===i||i.destroy(),null===(s=a.calendarManagerStore)||void 0===s||s.destroy(),a.defaultCalendar.destroy(),null===(o=a.stm)||void 0===o||o.destroy(),t.doDestroy.call(this)}async loadInlineData(e){this.isLoadingInlineData=!0,e.calendarsData&&(this.calendarManagerStore.data=e.calendarsData),e.resourcesData&&(this.resourceStore.data=e.resourcesData),e.assignmentsData&&(this.assignmentStore.data=e.assignmentsData),e.eventsData&&(this.eventStore.data=e.eventsData),e.tasksData&&(this.eventStore.data=e.tasksData),e.dependenciesData&&(this.dependencyStore.data=e.dependenciesData),await this.commitLoad(),this.isLoadingInlineData=!1}async commitLoad(){await this.commitAsync(),this.isDestroyed||this.trigger("load")}joinStoreRecords(e){const t=e=>{e.setProject(this),e.joinProject()};e.rootNode?e.rootNode.traverse(t):e.forEach(t)}unJoinStoreRecords(e){const t=e=>{e.leaveProject(),e.setProject(this)};e.rootNode?e.rootNode.traverse((n=>{n!==e.rootNode&&t(n)})):e.forEach(t)}resolveStoreAndModelClass(e,t){const n=(null==t?void 0:t.storeClass)||this[`${e}StoreClass`];let r=null==t?void 0:t.modelClass;return r||(r=this.getDefaultConfiguration()[`${e}ModelClass`]!==n.getDefaultConfiguration().modelClass?n.getDefaultConfiguration().modelClass:this[`${e}ModelClass`]),{storeClass:n,modelClass:r}}get eventStore(){return this.$eventStore}setEventStore(e){this.eventStore=e}set eventStore(e){const t=this,{stm:n}=t,r=t.$eventStore;if(t.detachStore(r),e instanceof As)e.project=t,n.addStore(e),t.joinStoreRecords(e);else{const{storeClass:r,modelClass:i}=t.resolveStoreAndModelClass("event",e);e=new r(sn.assign({modelClass:i,project:t,stm:n},e))}if(r&&n.hasStore(r)){n.removeStore(r),t.unJoinStoreRecords(r);const{assignmentsForRemoval:i}=r;i.forEach((t=>{const n=t.event;if(n){const r=e.getById(n.id);r&&(t.event=r,i.delete(t))}})),r.afterEventRemoval()}e.setProject(t),t.$eventStore=e,t.attachStore(e),t.trigger("eventStoreChange",{store:e})}get assignmentStore(){return this.$assignmentStore}setAssignmentStore(e){this.assignmentStore=e}set assignmentStore(e){const t=this,{stm:n}=t,r=t.$assignmentStore;if(t.detachStore(r),r&&n.hasStore(r)&&(n.removeStore(r),t.unJoinStoreRecords(r)),e instanceof As)e.project=t,n.addStore(e),t.joinStoreRecords(e);else{const{storeClass:r,modelClass:i}=t.resolveStoreAndModelClass("assignment",e);e=new r(sn.assign({modelClass:i,project:t,stm:n},e))}e.setProject(t),t.$assignmentStore=e,t.attachStore(e),t.trigger("assignmentStoreChange",{store:e})}get resourceStore(){return this.$resourceStore}setResourceStore(e){this.resourceStore=e}set resourceStore(e){const t=this,{stm:n}=t,r=t.$resourceStore;if(t.detachStore(r),e instanceof As)e.project=t,n.addStore(e),t.joinStoreRecords(e);else{const{storeClass:r,modelClass:i}=t.resolveStoreAndModelClass("resource",e);e=new r(sn.assign({modelClass:i,project:t,stm:n},e))}if(r&&n.hasStore(r)){n.removeStore(r),t.unJoinStoreRecords(r);const{assignmentsForRemoval:i}=r;i.forEach((t=>{const n=t.resource;if(n){const r=e.getById(n.id);r&&(t.resource=r,i.delete(t))}})),r.afterResourceRemoval()}e.setProject(t),t.$resourceStore=e,t.attachStore(e),t.trigger("resourceStoreChange",{store:e})}get dependencyStore(){return this.$dependencyStore}setDependencyStore(e){this.dependencyStore=e}set dependencyStore(e){const t=this,n=t.$dependencyStore;if(t.detachStore(n),e instanceof As)e.project=t,t.stm.addStore(e),t.joinStoreRecords(e);else{const{storeClass:n,modelClass:r}=t.resolveStoreAndModelClass("dependency",e);e=new n(sn.assign({modelClass:r,project:t,stm:t.stm},e))}t.$dependencyStore=e,t.attachStore(e),t.trigger("dependencyStoreChange",{store:e})}get calendarManagerStore(){return this.$calendarManagerStore}setCalendarManagerStore(e){this.calendarManagerStore=e}set calendarManagerStore(e){const t=this,n=t.$calendarManagerStore;if(t.detachStore(n),e instanceof As)t.stm.addStore(e);else{var r,i;const n=(null===(r=e)||void 0===r?void 0:r.storeClass)||t.calendarManagerStoreClass,s=(null===(i=e)||void 0===i?void 0:i.modelClass)||n.getDefaultConfiguration().modelClass||t.calendarModelClass;e=new n(sn.assign({modelClass:s,project:t,stm:t.stm},e))}e.setProject(t),t.$calendarManagerStore=e,t.attachStore(e),t.trigger("calendarManagerStoreChange",{store:e})}get calendar(){return this.$calendar||this.defaultCalendar}set calendar(e){this.$calendar=e}get effectiveCalendar(){return this.calendar}async addEvent(e){return this.eventStore.add(e),this.commitAsync()}async addAssignment(e){return this.assignmentStore.add(e),this.commitAsync()}async addResource(e){return this.resourceStore.add(e),this.commitAsync()}async addDependency(e){return this.dependencyStore.add(e),this.commitAsync()}bufferedCommitAsync(){this.hasPendingAutoCommit||this.setTimeout({fn:"commitAsync",delay:10})}get hasPendingAutoCommit(){return this.hasTimeout("commitAsync")}unScheduleAutoCommit(){this.clearTimeout("commitAsync")}async commitAsync(){return this.isPerformingCommit?this.ongoing:this.ongoing=this.doCommitAsync()}async doCommitAsync(){const e=this;if(e.isPerformingCommit=!0,e.unScheduleAutoCommit(),await(0,new Promise((e=>setTimeout(e,0)))),!e.isDestroyed){for(const t of e.$invalidated)t.calculateInvalidated();const{isInitialCommit:t,silenceInitialCommit:n}=e,r=t&&n;e.assignmentStore.onCommitAsync(),e.dependencyStore.onCommitAsync(),e.isInitialCommitPerformed=!0,e.hasLoadedDataToCommit=!1,e.isPerformingCommit=!1;const i=[e.assignmentStore,e.dependencyStore,e.eventStore,e.resourceStore,e.calendarManagerStore];if(i.forEach((e=>{var t;return null===(t=e.suspendAutoCommit)||void 0===t?void 0:t.call(e)})),e.isWritingData=!0,e.trigger("refresh",{isInitialCommit:t,isCalculated:!0}),r)for(const t of e.$invalidated)t.finalizeInvalidated(!0);else{for(const t of e.$invalidated)t.beginBatch(!0),t.finalizeInvalidated();for(const t of e.$invalidated)t.endBatch(!1,!0)}return e.isWritingData=!1,e.$invalidated.clear(),e.trigger("dataReady"),i.forEach((e=>{var t;return null===(t=e.resumeAutoCommit)||void 0===t?void 0:t.call(e)})),e.trigger("commitFinalized"),!0}}async propagateAsync(){return this.commitAsync()}invalidate(e){this.$invalidated.add(e),this.bufferedCommitAsync()}async isValidDependency(){return!0}getStm(){return this.stm}set stm(e){(e=this.$stm=new Yo(sn.assign({disabled:!0},e))).on({restoringStop:async()=>{e.disable(),await this.commitAsync(),this.isDestroyed||(e.enable(),this.trigger("stateRestoringDone"))}})}get stm(){return this.$stm}isEngineReady(){return!this.hasPendingAutoCommit&&!this.isPerformingCommit&&this.isInitialCommitPerformed}}return n.applyConfigs=!0,n}))){}class Mf extends eg{static get $name(){return"DurationColumn"}static get type(){return"duration"}static get isGanttColumn(){return!0}static get fields(){return[{name:"decimalPrecision",defaultValue:1}]}static get defaults(){return{min:null,max:null,step:1,largeStep:0,field:"fullDuration",text:"L{Duration}",instantUpdate:!0,filterType:"duration",sortable(e,t){return e[this.field]-t[this.field]}}}construct(){super.construct(...arguments);const e=this.sortable;this.sortable=(...t)=>e.call(this,...t)}get defaultEditor(){const{max:e,min:t,step:n,largeStep:r}=this;return sn.cleanupProperties({type:"duration",name:this.field,max:e,min:t,step:n,largeStep:r})}get durationUnitField(){return`${this.field}Unit`}formatValue(e,t){e instanceof Bi&&(t=e.unit,e=e.magnitude);const n="number"==typeof this.grid.durationDisplayPrecision?this.grid.durationDisplayPrecision:this.decimalPrecision,r=Math.pow(10,n);return Math.round(e*r)/r+" "+en.getLocalizedNameOfUnit(t,1!==e)}defaultRenderer({record:e,isExport:t}){const n=e[this.field],r=typeof n,i="number"===r?n:null==n?void 0:n.magnitude,s="number"===r?e[this.durationUnitField]:null==n?void 0:n.unit;return"number"!=typeof i?t?"":null:this.formatValue(i,s)}}Jh.registerColumnType(Mf),Mf._$name="DurationColumn";class kf extends Kh{static get $name(){return"ResourceCollapseColumn"}static get type(){return"resourceCollapse"}static get defaults(){return{width:"3em",align:"center",sortable:!1,groupable:!1,editor:!1,minWidth:0,cellCls:"b-resourcecollapse-cell",renderer:({record:e})=>({tag:"i",class:{"b-icon":1,"b-icon-expand-resource":1,"b-flip":"none"!==e.eventLayout}})}}onCellClick({record:e,event:t}){t.preventDefault(),e.eventLayout="none"!==e.eventLayout?"none":"stack"}}Jh.registerColumnType(kf),kf._$name="ResourceCollapseColumn";class If extends Kh{static get $name(){return"ResourceInfoColumn"}static get type(){return"resourceInfo"}static get fields(){return["showEventCount","showRole","showMeta","showImage","validNames","autoScaleThreshold","useNameAsImageName"]}static get defaults(){return{showImage:!0,showEventCount:!0,showMeta:null,showRole:!1,validNames:null,autoScaleThreshold:40,useNameAsImageName:!0,field:"name",htmlEncode:!1,width:140,cellCls:"b-resourceinfo-cell",editor:!K.isTestEnv&&"text"}}construct(...e){super.construct(...e),this.avatarRendering=new Yh({element:this.grid.element})}doDestroy(){super.doDestroy(),this.avatarRendering.destroy()}getImageURL(e){const t=this.grid.resourceImagePath||"",n=t.split("//"),r=n.length>1?n[1]:t,i=_.joinPaths([r||"",e||""]);return n.length>1?n[0]+"//"+i:i}template(e,t){const n=this,{showImage:r,showRole:i,showMeta:s,showEventCount:o,grid:a}=n,{timeAxis:l,resourceImageExtension:c="",defaultResourceImageName:d}=a,u="string"==typeof i?i:"role",h=o&&e.eventStore.getEvents({includeOccurrences:a.enableRecurringEvents,resourceRecord:e,startDate:l.startDate,endDate:l.endDate}).length;let g;if(r&&!1!==e.image)if(e.imageUrl)g=e.imageUrl;else{const i="string"==typeof r?r:e.image||t&&n.useNameAsImageName&&t.toLowerCase()+c||d||"";g=i&&n.getImageURL(i),g&&!i.includes(".")&&(n.validNames&&!n.validNames.includes(i)||(g+=c))}return{class:"b-resource-info",children:[r&&n.avatarRendering.getResourceAvatar({resourceRecord:e,initials:e.initials,color:e.eventColor,iconCls:e.iconCls,imageUrl:g,defaultImageUrl:d&&this.getImageURL(d)}),i||o||s?{tag:"dl",children:[{tag:"dt",text:t},i?{tag:"dd",class:"b-resource-role",text:e[u]}:null,o?{tag:"dd",class:"b-resource-events",html:n.L("L{eventCountText}",h)}:null,s?{tag:"dd",class:"b-resource-meta",html:n.showMeta(e)}:null]}:t]}}defaultRenderer({grid:e,record:t,cellElement:n,value:r,isExport:i}){let s;return t.isSpecialRow?s="":i?s=r:(this.autoScaleThreshold&&e.rowHeight<this.autoScaleThreshold?n.style.fontSize=e.rowHeight/40+"em":n.style.fontSize="",s=this.template(t,r)),s}}function Af(e,t){return e===t.length-1}function Ff(e,t){return t===e.cells[e.cells.length-1]}Jh.registerColumnType(If),If._$name="ResourceInfoColumn";class Of extends Ka{static get $name(){return"TimeAxisBase"}static get configurable(){return{compactCellWidthThreshold:15,model:null,cls:null,sizeProperty:null,positionProperty:null}}static get properties(){return{startDate:null,endDate:null,levels:[],size:null}}set range({startDate:e,endDate:t}){const n=this;(n.startDate-e||n.endDate-t)&&(n.startDate=e,n.endDate=t,n.refresh())}buildCells(e=this.startDate,t=this.endDate){var n;const r=this,{sizeProperty:i}=r,{stickyHeaders:s,isVertical:o}=r.client||{},a=[],{length:l}=r.levels,c=r.levels.map(((n,a)=>{var c;const d=s&&(o||a<l-1);return{className:{"b-sch-header-row":1,[`b-sch-header-row-${n.position}`]:1,"b-sch-header-row-main":a===r.model.viewPreset.mainHeaderLevel,"b-lowest":Af(a,r.levels),"b-sticky-header":d},syncOptions:{releaseThreshold:5,syncIdField:"tickIndex"},dataset:{headerFeature:`headerRow${a}`,headerPosition:n.position},children:null===(c=n.cells)||void 0===c?void 0:c.filter((n=>n.start<t&&n.end>e)).map((e=>({className:{"b-sch-header-timeaxis-cell":1,[e.headerCellCls]:e.headerCellCls,[`b-align-${e.align}`]:e.align,"b-last":Ff(n,e)},dataset:f({tickIndex:e.index},globalThis.DEBUG&&{date:e.start.getTime()}),style:{[r.positionProperty]:e.coord,[i]:e.width,[`min-${i}`]:e.width},children:[{tag:"span",className:{"b-sch-header-text":1,"b-sticky-header":d},html:e.value}]})))}}));return null===(n=r.client)||void 0===n||n.getHeaderDomConfigs(a),c.push(...a),{className:r.widgetClassList,syncOptions:{releaseThreshold:0},children:c}}render(e){super.render(e),this.refresh(!0)}refresh(e=!this.levels.length){const t=this,{columnConfig:n}=t.model,{levels:r}=t,i=r.length;if(e){r.length=0,n.forEach(((e,t)=>r[t]={position:t,cells:e})),t.size=r[0].cells.reduce(((e,t)=>e+t.width),0);const s=t.element.parentElement;s&&(r.length!==i||e)&&(s.classList.remove(`b-sch-timeaxiscolumn-levels-${i}`),s.classList.add(`b-sch-timeaxiscolumn-levels-${r.length}`))}t.startDate&&t.endDate&&(oa.sync({domConfig:t.buildCells(),targetElement:t.element,syncIdField:"headerFeature"}),t.trigger("refresh"))}get widgetClass(){return"b-timeaxis"}}Of._$name="TimeAxisBase";class Lf extends Of{static get $name(){return"HorizontalTimeAxis"}static get type(){return"horizontaltimeaxis"}static get configurable(){return{model:null,sizeProperty:"width"}}get positionProperty(){var e;return null!==(e=this.owner)&&void 0!==e&&e.rtl?"right":"left"}get width(){return this.size}onModelUpdate(){this.model.availableSpace!==this.width&&this.refresh(!0)}updateModel(e){this.detachListeners("tavm"),null==e||e.on({name:"tavm",update:"onModelUpdate",thisObj:this})}}Lf._$name="HorizontalTimeAxis";class Pf extends Ka{static get $name(){return"ResourceHeader"}static get type(){return"resourceheader"}static get defaultConfig(){return{resourceStore:null,headerRenderer:null,imagePath:null,imageExtension:null,defaultImageName:null}}static get configurable(){return{showAvatars:{value:!0,$config:"nullify"},fillWidth:!0,fitWidth:!1,columnWidth:150}}static get properties(){return{firstResource:-1,lastResource:-1}}construct(e){const t=this;e.scheduler._resourceColumns=t,super.construct(e),null!=t.imagePath&&t.element.classList.add("b-has-images"),_n.on({element:t.element,delegate:".b-resourceheader-cell",capture:!0,click:"onResourceMouseEvent",dblclick:"onResourceMouseEvent",contextmenu:"onResourceMouseEvent",thisObj:t})}changeShowAvatars(e){var t;return null===(t=this.avatarRendering)||void 0===t||t.destroy(),e&&(this.avatarRendering=new Yh({element:this.element})),e}updateShowAvatars(){this.isConfiguring||this.refresh()}set resourceStore(e){const t=this;var n;e!==t._resourceStore&&(null===(n=t.resourceStoreDetacher)||void 0===n||n.call(t),t._resourceStore=e,t.resourceStoreDetacher=e.on({changePreCommit:"onResourceStoreDataChange",thisObj:t}),e.count&&t.onResourceStoreDataChange({}))}get resourceStore(){return this._resourceStore}onResourceStoreDataChange({action:e}){this.getConfig("fillWidth"),this.getConfig("fitWidth");const t=this,{element:n,resourceStore:r}=t,i=r.getTotalWidth(t.scheduler);t.scheduler.variableColumnWidths?t._fillWidth=t._fitWidth=!1:(t._fillWidth=t.configuredFillWidth,t._fitWidth=t.configuredFitWidth),i!==t.width&&(Mr.setLength(n,"width",i),t.column.set("width",i,t.column.grid.isConfiguring)),"removeall"===e&&(n.innerHTML=""),("remove"===e||"add"===e||"filter"===e||t.fitWidth||t.fillWidth)&&t.refreshWidths(),t.column.grid.toggleEmptyText()}changeColumnWidth(e){return this.refreshingWidths||(this.configuredColumnWidth=e),e}updateColumnWidth(e,t){const n=this;n.refreshingWidths||n.refreshWidths(),n.isConfiguring||(n.refresh(),n.trigger("columnWidthChange",{width:e,oldWidth:t}))}changeFillWidth(e){return this.configuredFillWidth=e}updateFillWidth(){this.isConfiguring||this.refreshWidths()}changeFitWidth(e){return this.configuredFitWidth=e}updateFitWidth(){this.isConfiguring||this.refreshWidths()}getImageURL(e){return _.joinPaths([this.imagePath||"",e||""])}get imagePath(){return this._imagePath}set imagePath(e){this._imagePath=e,this.refresh()}get availableWidth(){return this._availableWidth}set availableWidth(e){this._availableWidth=e,this.refreshWidths()}refreshWidths(){var e;const t=this,{availableWidth:n,configuredColumnWidth:r}=t,i=null===(e=t.resourceStore)||void 0===e?void 0:e.count;if(!n||!i||t.scheduler.variableColumnWidths)return;t.refreshingWidths=!0;const s=t.fitWidth||t.fillWidth&&r*i<n?Math.floor(n/i):r,o=t.column.grid.enableEventAnimations&&Math.abs(t._columnWidth-s)>30;Mr.addTemporaryClass(t.element,"b-animating",o?300:0,t),t.columnWidth=s,t.refreshingWidths=!1}set visibleResources({firstResource:e,lastResource:t}){this.firstResource=e,this.lastResource=t,this.refresh()}refresh(){const e=this,{firstResource:t,lastResource:n,scheduler:r}=e,{variableColumnWidths:i}=r,s=[];if(!e.column.grid.isConfiguring&&t>-1&&n>-1&&n<e.resourceStore.count)for(let a=t;a<=n;a++){const t=e.resourceStore.getAt(a),n=t.instanceMeta(r),l=t.columnWidth||e.columnWidth,c={className:new Mn({"b-resourceheader-cell":1}),dataset:{resourceId:t.id},style:{[r.rtl?"right":"left"]:i?n.insetStart:a*e.columnWidth,width:l},children:[]};if(e.headerRenderer){const n=e.headerRenderer({elementConfig:c,resourceRecord:t});null!=n&&(c.html=n)}else{let n;if(t.imageUrl)n=t.imageUrl;else if(null!=e.imagePath&&!1!==t.image){var o;const r=t.image||(null===(o=t.name)||void 0===o?void 0:o.toLowerCase())+e.imageExtension;n=e.getImageURL(r)}c.children.push(e.showAvatars&&e.avatarRendering.getResourceAvatar({resourceRecord:t,initials:t.initials,color:t.eventColor,iconCls:t.iconCls,defaultImageUrl:e.defaultImageName&&e.getImageURL(e.defaultImageName),imageUrl:n}),{tag:"span",className:"b-resource-name",html:_.encodeHtml(t.name)})}s.push(c)}oa.sync({domConfig:{onlyChildren:!0,children:s},targetElement:e.element,syncIdField:"resourceId"})}onResourceMouseEvent(e){const t=e.target.closest(".b-resourceheader-cell"),n=this.resourceStore.getById(t.dataset.resourceId);this.trigger("resourceHeader"+_.capitalize(e.type),{resourceRecord:n,event:e})}getCurrentConfig(e){const t=super.getCurrentConfig(e);return delete t.resourceStore,delete t.column,delete t.type,t}}Pf._$name="ResourceHeader";class $f extends(tt(ng)){static get fields(){return[{name:"locked",persist:!1},{name:"flex",persist:!1},{name:"width",persist:!1},{name:"cellCls",persist:!1},{name:"field",persist:!1},"mode"]}static get defaults(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,resizable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,cls:"b-sch-timeaxiscolumn",needWidth:!0,mode:null,region:"normal",exportable:!1,htmlEncode:!1}}static get type(){return"timeAxis"}construct(e){const t=this;super.construct(...arguments),t.thisObj=t,t.timeAxisViewModel=t.grid.timeAxisViewModel,t.mode=t.mode,t.grid.on({paint:"onTimelinePaint",thisObj:t,once:!0})}static get autoExposeFields(){return!0}doDestroy(){var e,t;null===(e=this.resourceColumns)||void 0===e||e.destroy(),null===(t=this.timeAxisView)||void 0===t||t.destroy(),super.doDestroy()}set mode(e){const t=this,{grid:n}=t;t.set("mode",e),"horizontal"===e?t.timeAxisView=new Lf({model:t.timeAxisViewModel,compactCellWidthThreshold:t.compactCellWidthThreshold,owner:n,client:n}):"vertical"===e&&(t.resourceColumns=Pf.new({column:t,scheduler:n,resourceStore:n.resourceStore,imagePath:n.resourceImagePath,imageExtension:n.resourceImageExtension,defaultImageName:n.defaultResourceImageName},n.resourceColumns||{}),t.relayEvents(t.resourceColumns,["resourceheaderclick","resourceheaderdblclick","resourceheadercontextmenu"]))}get mode(){return this.get("mode")}onViewModelUpdate({source:e}){const t=this;"horizontal"===t.mode?(t.refreshHeader(!0),t.width=e.totalSize,t.grid.refresh(),t.subGrid.refreshFakeScroll()):"vertical"===t.mode&&t.grid.refreshRows()}onTimelinePaint({firstPaint:e}){const t=this;var n;t.subGrid.insertRowsBefore&&e&&(t.subGridElement.classList.add("b-timeline-subgrid"),"vertical"===t.mode&&(t.refreshHeader(),null===(n=t.grid)||void 0===n||n.onHeightChange()))}refreshHeader(e){const t=this,{element:n}=t;n&&("horizontal"===t.mode?(!e&&t.timeAxisViewModel.update(void 0,void 0,!0),t.timeAxisView.rendered?t.timeAxisView.refresh(!0):(n.innerHTML="",t.timeAxisView.render(n))):"vertical"===t.mode&&(t.resourceColumns.currentElement||(n.innerHTML="",t.resourceColumns.render(n))))}internalRenderer(e){const{grid:t}=this;if(t.project.isInitialCommitPerformed||t.project.isDelayingCalculation)return t.currentOrientation.renderer(e),super.internalRenderer(e)}get timeAxisViewModel(){return this._timeAxisViewModel}set timeAxisViewModel(e){const t=this;t.detachListeners("tavm"),null==e||e.on({name:"tavm",update:"onViewModelUpdate",prio:-1e4,thisObj:t}),t._timeAxisViewModel=e,t.timeAxisView&&(t.timeAxisView.model=e)}}v($f,"$name","TimeAxisColumn"),Jh.registerColumnType($f),$f._$name="TimeAxisColumn";class _f extends Of{static get $name(){return"VerticalTimeAxis"}static get configurable(){return{cls:"b-verticaltimeaxis",sizeProperty:"height",positionProperty:"top",wrapText:!0}}buildHorizontalCells(){const e=this,{client:t}=e,n=null==t?void 0:t.stickyHeaders,r=[],i=e.levels.reduce(((t,r,i)=>{var s;return r.cells&&t.push(...null===(s=r.cells)||void 0===s?void 0:s.filter((t=>t.start<e.endDate&&t.end>e.startDate)).map(((t,r,s)=>({className:{"b-sch-header-timeaxis-cell":1,[t.headerCellCls]:t.headerCellCls,[`b-align-${t.align}`]:t.align,"b-last":r===s.length-1,"b-lowest":i===e.levels.length-1},dataset:f({tickIndex:t.index,cellId:`${i}-${t.index}`,headerPosition:i},globalThis.DEBUG&&{date:t.start.getTime()}),style:{top:t.coord,height:t.width,minHeight:t.width},children:[{className:{"b-sch-header-text":1,"b-sticky-header":n},html:t.value}]})))),t}),[]);return null==t||t.getHeaderDomConfigs(r),i.push(...r),{className:e.widgetClassList,dataset:{headerFeature:"headerRow0",headerPosition:0},syncOptions:{releaseThreshold:5,syncIdField:"cellId"},children:i}}get height(){return this.size}}_f._$name="VerticalTimeAxis";class Nf extends Kh{static get type(){return"verticalTimeAxis"}static get defaults(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,minWidth:0,resizable:!1,cellCls:"b-verticaltimeaxiscolumn",flex:1}}get isFocusable(){return!1}construct(e){super.construct(...arguments),this.view=new _f({model:this.grid.timeAxisViewModel,client:this.grid})}renderer({cellElement:e,size:t}){this.view.render(e),t.height=this.view.height}getCurrentConfig(e){const t=super.getCurrentConfig(e);return delete t.id,delete t.region,delete t.type,delete t.field,delete t.ariaLabel,delete t.cellAriaLabel,t}}v(Nf,"$name","VerticalTimeAxisColumn"),Jh.registerColumnType(Nf),Nf._$name="VerticalTimeAxisColumn";var Hf=e=>class extends e{static get $name(){return"AbstractCrudManagerValidation"}static get configurable(){return{validateResponse:!0,skipSuccessProperty:!0,crudLoadValidationWarningPrefix:"CrudManager load response error(s):",crudSyncValidationWarningPrefix:"CrudManager sync response error(s):",supportShortSyncResponseNote:'Note: Please consider enabling "supportShortSyncResponse" option to allow less detailed sync responses (https://bryntum.com/products/scheduler/docs/api/Scheduler/crud/AbstractCrudManagerMixin#config-supportShortSyncResponse)',disableValidationNote:'Note: To disable this validation please set the "validateResponse" config to false'}}get crudLoadValidationMandatoryStores(){return[]}getStoreLoadResponseWarnings(e,t,n){const r=[],{storeId:i}=e,s=this.crudLoadValidationMandatoryStores,o={[i]:{}};return t?t.rows||(r.push(`- "${i}" store section should have a "rows" property with an array of the store records.`),o[i].rows=["..."]):null!=s&&s.includes(i)&&(r.push(`- No "${i}" store section found. It should contain the store data.`),o[i].rows=["..."]),r.length&&Object.assign(n,o),r}getLoadResponseWarnings(e){const t=[],n={};return this.skipSuccessProperty||(n.success=!0),this.forEachCrudStore(((r,i,s)=>{t.push(...this.getStoreLoadResponseWarnings(s,null==e?void 0:e[i],n))})),t.length&&(t.push("Please adjust your response to look like this:\n"+JSON.stringify(n,null,4).replace(/"\.\.\."/g,"...")),t.push(this.disableValidationNote)),t}validateLoadResponse(e){const t=this.getLoadResponseWarnings(e);t.length&&console.warn(this.crudLoadValidationWarningPrefix+"\n"+t.join("\n"))}getStoreSyncResponseWarnings(e,t,n,r){const i=[],s=[],o=[],{storeId:a}=e,l={[a]:{}},c=e.phantomIdField||this.phantomIdField,{modelClass:d}=e.store,u=d.getFieldDataSource(d.idField),h=(null==n?void 0:n.rows)||[],g=(null==n?void 0:n.removed)||[];let m=!1;if(null!=t&&t.added&&(s.push(...t.added.filter((e=>!h.find((t=>t[c]==e[c]))&&!g.find((t=>t[c]==e[c]||t[u]==e[c])))).map((e=>({[c]:e[c],[u]:"..."})))),s.length)){const e=s.map((e=>"#"+e[c])).join(", ");i.push(`- "${a}" store "rows" section should mention added record(s) ${e} sent in the request. It should contain the added records identifiers (both phantom and "real" ones assigned by the backend).`)}if(this.supportShortSyncResponse)!s.length&&n&&(("object"!=typeof n||Array.isArray(n))&&(i.push(`- "${a}" store section should be an Object.`),l[a]["..."]="..."),n.rows&&!Array.isArray(n.rows)&&(i.push(`- "${a}" store "rows" section should be an array`),s.push("...")),n.removed&&!Array.isArray(n.removed)&&(i.push(`- "${a}" store "removed" section should be an array:`),o.push("...")));else{if(null!=t&&t.updated){const e=t.updated.filter((e=>!h.find((t=>t[u]==e[u])))).map((e=>({[u]:e[u]})));if(s.push(...e),e.length){const t=e.map((e=>"#"+e[u])).join(", ");i.push(`- "${a}" store "rows" section should mention updated record(s) ${t} sent in the request. It should contain the updated record identifiers.`),m=!0}}if(s.length&&s.push("..."),null!=t&&t.removed&&(o.push(...t.removed.filter((e=>!h.find((t=>t[u]==e[u])))).map((e=>({[u]:e[u]})))),o.length)){const e=o.map((e=>"#"+e[u])).join(", ");i.push(`- "${a}" store "removed" section should mention removed record(s) ${e} sent in the request. It should contain the removed record identifiers.`),l[a].removed=o,o.push("..."),m=!0}}return s.length&&(l[a].rows=s),i.length||delete l[a],Object.assign(r,l),{messages:i,showSupportShortSyncResponseNote:m}}getSyncResponseWarnings(e,t){const n=[],r={},i=t.pack;this.skipSuccessProperty||(r.success=!0);let s=!1;return this.forEachCrudStore(((t,o,a)=>{const l=this.getStoreSyncResponseWarnings(a,null==i?void 0:i[o],e[o],r);s=s||l.showSupportShortSyncResponseNote,n.push(...l.messages)})),n.length&&(n.push("Please adjust your response to look like this:\n"+JSON.stringify(r,null,4).replace(/"\.\.\.":\s*"\.\.\."/g,",,,").replace(/"\.\.\."/g,"...")),s&&n.push(this.supportShortSyncResponseNote),n.push(this.disableValidationNote)),n}validateSyncResponse(e,t){const n=this.getSyncResponseWarnings(e,t);n.length&&console.warn(this.crudSyncValidationWarningPrefix+"\n"+n.join("\n"))}};class Bf extends Error{}class jf extends Bf{constructor(e={}){var t,n;super(e.message||e.request&&_.capitalize(null===(t=e.request)||void 0===t?void 0:t.type)+" failed"||"Crud Manager request failed"),Object.assign(this,e),this.action=null===(n=this.request)||void 0===n?void 0:n.type}}const Vf=function(e,t,n){return e.store&&(e=e.store),t.store&&(t=t.store),(e=e[n]||0)<(t=t[n]||0)?-1:e>t?1:0},zf=function(e,t){return Vf(e,t,"loadPriority")},Wf=function(e,t){return Vf(e,t,"syncPriority")};var Uf=e=>{var t;e.$$meta=e.$meta;const n=[];return e.isEvents||n.push(tt),e.isDelayable||n.push(Zr),n.push(Hf),t=class extends((e||Te).mixin(...n)){static get $name(){return"AbstractCrudManagerMixin"}static get defaultConfig(){return{crudRevision:null,crudStores:[],storeIdProperty:"storeId",crudFilterParam:"filter",transport:{},trackResponseType:!1,supportShortSyncResponse:!0,phantomIdField:"$PhantomId",phantomParentIdField:"$PhantomParentId",autoLoad:!1,autoSyncTimeout:100,autoSync:!1,resetIdsBeforeSync:!0,syncApplySequence:[],orderedCrudStores:[],writeAllFields:!1,crudIgnoreUpdates:0,autoSyncSuspendCounter:0,crudLoaded:!1,applyingLoadResponse:!1,applyingSyncResponse:!1,callOnFunctions:!0}}get isCrudManager(){return!0}construct(e={}){this._requestId=0,this.activeRequests={},this.crudStoresIndex={},super.construct(e)}afterConstruct(){super.afterConstruct(),this.autoLoad&&(this._autoLoadPromise=this.doAutoLoad())}get loadUrl(){return this.transport.load.url}updateLoadUrl(e){sn.setPath(this,"transport.load.url",e)}get syncUrl(){return this.transport.sync.url}updateSyncUrl(e){sn.setPath(this,"transport.sync.url",e)}getStoreDescriptor(e){return e?e instanceof As?this.crudStores.find((t=>t.store===e)):"object"==typeof e?this.crudStoresIndex[e.storeId]:this.crudStoresIndex[e]||this.getStoreDescriptor(As.getStore(e)):null}fillStoreDescriptor(e){const{store:t}=e,{storeIdProperty:n=this.storeIdProperty,modelClass:r}=t;return e.storeId||(e.storeId=t[n]||t.id),e.idField||(e.idField=r.idField),e.phantomIdField||(e.phantomIdField=r.phantomIdField),e.phantomParentIdField||(e.phantomParentIdField=r.phantomParentIdField),"writeAllFields"in e||(e.writeAllFields=t.writeAllFields),e}updateCrudStoreIndex(){const e=this.crudStoresIndex={};this.crudStores.forEach((t=>t.storeId&&(e[t.storeId]=t)))}getCrudStore(e){const t=this.getStoreDescriptor(e);return null==t?void 0:t.store}forEachCrudStore(e,t=this){if(!e)throw new Error("Iterator function must be provided");this.crudStores.every((n=>!1!==e.call(t,n.store,n.storeId,n)))}set crudStores(e){this._crudStores=[],this.addCrudStore(e);for(const e of this._crudStores)e.loadPriority=e.syncPriority=0}get crudStores(){return this._crudStores}get orderedCrudStores(){return this._orderedCrudStores}set orderedCrudStores(e){return this._orderedCrudStores=e}set syncApplySequence(e){this._syncApplySequence=[],this.addStoreToApplySequence(e)}get syncApplySequence(){return this._syncApplySequence}internalAddCrudStore(e){const t=this;let n;return e instanceof As?n={store:e}:"object"==typeof e?(e.store||(e={storeId:e.id,store:new As(e)}),n=e):n={store:As.getStore(e)},t.fillStoreDescriptor(n),(e=n.store).setCrudManager?e.setCrudManager(t):e.crudManager=t,e.pageSize=null,e.load&&(e.autoCommit=!1,e.autoLoad=!1),t.bindCrudStoreListeners(e),n}addCrudStore(e,t,n){var r;if(null===(r=e=ke.asArray(e))||void 0===r||!r.length)return;const i=this,s=e.map(i.internalAddCrudStore,i);void 0===t?i.crudStores.push(...s):(n&&((n instanceof As||"object"!=typeof n)&&(n=i.getStoreDescriptor(n)),t+=i.crudStores.indexOf(n)),i.crudStores.splice(t,0,...s)),i.orderedCrudStores.push(...s),i.updateCrudStoreIndex()}addPrioritizedStore(e){const t=this;t.hasCrudStore(e)||t.addCrudStore(e,ke.findInsertionIndex(e,t.crudStores,zf)),t.hasApplySequenceStore(e)||t.addStoreToApplySequence(e,ke.findInsertionIndex(e,t.syncApplySequence,Wf))}hasCrudStore(e){var t;return null===(t=this.crudStores)||void 0===t?void 0:t.some((t=>t===e||t.store===e||t.storeId===e))}removeCrudStore(e){const t=this,n=t.crudStores,r=n.find((t=>t===e||t.store===e||t.storeId===e));if(!r)throw new Error("Store not found in stores collection");t.unbindCrudStoreListeners(r.store),delete t.crudStoresIndex[r.storeId],ke.remove(n,r),t.syncApplySequence&&t.removeStoreFromApplySequence(e)}bindCrudStoreListeners(e){e.on({name:e.id,addConfirmed:"onCrudStoreChange",change:"onCrudStoreChange",destroy:"onCrudStoreDestroy",thisObj:this})}unbindCrudStoreListeners(e){this.detachListeners(e.id)}addStoreToApplySequence(e,t,n){if(!e)return;e=ke.asArray(e);const r=this,i=e.reduce(((e,t)=>{const n=r.getStoreDescriptor(t);return n&&e.push(n),e}),[]);if(void 0===t)r.syncApplySequence.push(...i);else{let e=t;n&&((n instanceof As||"object"!=typeof n)&&(n=r.getStoreDescriptor(n)),e+=r.syncApplySequence.indexOf(n)),r.syncApplySequence.splice(e,0,...i)}const s=r.syncApplySequence.map((({storeId:e})=>e));r.orderedCrudStores=[...r.syncApplySequence],r.crudStores.forEach((e=>{s.includes(e.storeId)||r.orderedCrudStores.push(e)}))}removeStoreFromApplySequence(e){const t=this.syncApplySequence.findIndex((t=>t===e||t.store===e||t.storeId===e));t>-1&&(this.syncApplySequence.splice(t,1),this.orderedCrudStores.splice(t,1))}hasApplySequenceStore(e){return this.syncApplySequence.some((t=>t===e||t.store===e||t.storeId===e))}onCrudStoreDestroy({source:e}){this.removeCrudStore(e)}onCrudStoreChange(e){const t=this;t.crudIgnoreUpdates||(t.crudStoreHasChanges(null==e?void 0:e.source)?(t.trigger("hasChanges"),t.autoSync&&t.scheduleAutoSync()):t.trigger("noChanges"))}suspendAutoSync(){this.autoSyncSuspendCounter++}resumeAutoSync(e=!0){const t=this;t.autoSyncSuspendCounter--,t.autoSyncSuspendCounter<=0&&(t.autoSyncSuspendCounter=0,e&&t.autoSync&&t.crudStoreHasChanges()&&t.sync())}get isAutoSyncSuspended(){return this.autoSyncSuspendCounter>0}scheduleAutoSync(){const e=this;e.hasTimeout("autoSync")||e.isAutoSyncSuspended||e.setTimeout({name:"autoSync",fn:()=>{e.sync().catch((e=>{}))},delay:e.autoSyncTimeout})}async triggerFailedRequestEvents(e,t,n,r){const{options:i,type:s}=e;this.trigger("requestFail",{requestType:s,response:t,responseText:n,responseOptions:r}),this.trigger(s+"Fail",{response:t,responseOptions:r,responseText:n,options:i})}async internalOnResponse(e,t,n){const r=this,i=t?r.decode(t):null,{options:s,type:o}=e;if(t&&!i&&console.error("Failed to parse response: "+t),i&&(r.skipSuccessProperty?!1!==i.success:i.success)){if(!1!==r.trigger("beforeResponseApply",{requestType:o,response:i})&&!1!==r.trigger(`before${_.capitalize(o)}Apply`,{response:i,options:s})){if(r.crudRevision=i.revision,await r.applyResponse(e,i,s),r.isDestroyed)return;r.trigger("requestDone",{requestType:o,response:i,responseOptions:n}),r.trigger(o,{response:i,responseOptions:n,options:s}),"load"!==o&&r.crudStoreHasChanges()||(r.trigger("noChanges"),"load"===o&&r.emitCrudStoreEvents(e.pack.stores,"afterRequest"))}}else r.triggerFailedRequestEvents(e,i,t,n);return i}suspendChangesTracking(){this.crudIgnoreUpdates++}resumeChangesTracking(e){!this.crudIgnoreUpdates||--this.crudIgnoreUpdates||e||this.onCrudStoreChange()}get isBatchingChanges(){return this.crudIgnoreUpdates>0}crudStoreHasChanges(e){return e?this.isCrudStoreDirty(this.getCrudStore(e)):this.crudStores.some((e=>this.isCrudStoreDirty(e.store)))}isCrudStoreDirty(e){return Boolean(e.changes)}doAutoLoad(){return this.load().catch((e=>{}))}emitCrudStoreEvents(e,t,n){const r=f({action:"read"+t},n);for(const n of this.crudStores)e.includes(n.storeId)&&n.store.trigger(t,r)}getLoadPackage(e){const t={type:"load",requestId:this.requestId},n=this.crudStores,r=Object.assign({},e);return delete r.request,t.stores=n.map((e=>{var t;const n=null==r?void 0:r[e.storeId],i=e.pageSize||(null===(t=e.store)||void 0===t?void 0:t.pageSize);if(n||i){const t=Object.assign({storeId:e.storeId,page:1},n);return i&&(t.pageSize=i),e.currentPage=t.page,n&&delete r[e.storeId],t}return e.storeId})),Object.assign(t,r),t}loadCrudStore(e,t,n){const r=null==t?void 0:t.rows;null!=n&&n.append||null!=t&&t.append?e.add(r):e.data=r,e.trigger("load",{data:r})}loadDataToCrudStore(e,t,n){const r=e.store,i=null==t?void 0:t.rows;r.__loading=!0,i&&this.loadCrudStore(r,t,n,e),r.__loading=!1}loadCrudManagerData(e,t={}){this.suspendChangesTracking(),this.crudStores.forEach((n=>{const r=n.storeId,i=e[r];i&&this.loadDataToCrudStore(n,i,t[r])})),this.resumeChangesTracking(!0)}get isCrudManagerLoading(){return Boolean(this.activeRequests.load||this.applyingLoadResponse)}get isCrudManagerSyncing(){return Boolean(this.activeRequests.sync||this.applyingSyncResponse)}get isLoadingOrSyncing(){return Boolean(this.isCrudManagerLoading||this.isCrudManagerSyncing)}load(e){"string"==typeof e&&(e={request:{url:e}});const t=this,n=t.getLoadPackage(e);return new Promise(((r,i)=>{if(!1!==t.trigger("beforeLoad",{pack:n})){var s;const{load:o}=t.activeRequests;o&&(t.cancelRequest(o.desc,o.reject),t.trigger("loadCanceled",{pack:n}));const a=Y.assign({id:n.requestId,data:t.encode(n),type:"load",success:t.onCrudRequestSuccess,failure:t.onCrudRequestFailure,thisObj:t},null===(s=e)||void 0===s?void 0:s.request);t.activeRequests.load={type:"load",options:e,pack:n,resolve:r,reject(...e){a.success=a.failure=null,i(...e)},id:n.requestId,desc:t.sendRequest(a)},t.emitCrudStoreEvents(n.stores,"loadStart"),t.trigger("loadStart",{pack:n})}else t.trigger("loadCanceled",{pack:n}),i({cancelled:!0})}))}getActiveCrudManagerRequest(e){let t=this.activeRequests[e];return!t&&this.trackResponseType&&(t=Object.values(this.activeRequests)[0]),t}prepareAdded(e,t){const{store:n}=t,{isTree:r}=n,i=t.phantomIdField||this.phantomIdField,s=t.phantomParentIdField||this.phantomParentIdField;return e.filter((e=>e.isValid)).map((e=>{const t=e.constructor,n=Object.assign(e.persistableData,{[i]:e.id});if(r){const{parent:t}=e;t&&!t.isRoot&&t.isPhantom&&(n[s]=t.id)}return this.resetIdsBeforeSync&&sn.deletePath(n,t.getFieldDataSource(t.idField)),n}))}prepareUpdated(e,t){const{store:n}=t,{isTree:r}=n,i=t.writeAllFields||!1!==t.writeAllFields&&this.writeAllFields,s=t.phantomParentIdField||this.phantomParentIdField;if(t.store.tree){const n=t.store.rootNode;e=e.filter((e=>e!==n))}return e.filter((e=>e.isValid)).reduce(((e,t)=>{let n;if(n=i?t.persistableData:t.modificationDataToWrite,r){const{parent:e}=t;e&&!e.isRoot&&e.isPhantom&&(n[s]=e.id)}return sn.isEmpty(n)||e.push(n),e}),[])}prepareRemoved(e){return e.map((e=>{const t=e.constructor;return sn.setPath({},t.getFieldDataSource(t.idField),e.id)}))}getCrudStoreChanges(e){const{store:t}=e;let n,{added:r=[],modified:i=[],removed:s=[]}=t.changes||{};return r.length&&(r=this.prepareAdded(r,e)),i.length&&(i=this.prepareUpdated(i,e)),s.length&&(s=this.prepareRemoved(s)),(r.length||i.length||s.length)&&(n={},r.length&&(n.added=r),i.length&&(n.updated=i),s.length&&(n.removed=s)),n}getChangesetPackage(){const{changes:e}=this;return e||this.forceSync?f({type:"sync",requestId:this.requestId,revision:this.crudRevision},e):null}get changes(){const e={};return this.crudStores.forEach((t=>{const n=this.getCrudStoreChanges(t);n&&(e[t.storeId]=n)})),Object.keys(e).length>0?e:null}getRowsToApplyChangesTo({store:e,storeId:t},n,r){var i,s;const o=this,{modelClass:a}=e,l=a.getFieldDataSource(a.idField),{updated:c,removed:d}=r||{};let u,h,g;if(n){var m,p;g=!0;const e={};u=(null===(m=n.rows)||void 0===m?void 0:m.slice())||[],h=(null===(p=n.removed)||void 0===p?void 0:p.slice())||[],[...u,...h].forEach((t=>{const n=sn.getPath(t,l);e[n]=!0})),o.supportShortSyncResponse&&(null==c||c.forEach((t=>{const n=sn.getPath(t,l);e[n]||u.push({[l]:n})})),null==d||d.forEach((t=>{const n=sn.getPath(t,l);e[n]||h.push({[l]:n})})))}else(c||d)&&(g=!1,u=c,h=d);return u=null!==(i=u)&&void 0!==i&&i.length?u:null,h=null!==(s=h)&&void 0!==s&&s.length?h:null,{rows:u,removed:h,remote:g}}applyChangesToStore(e,t,n){const r=e.phantomIdField||this.phantomIdField,{store:i}=e,s=i.modelClass.getFieldDataSource("id"),{rows:o,removed:a,remote:l}=this.getRowsToApplyChangesTo(e,t,n),c=[],d=[];if(o)for(const e of o){var u;i.getById(null!==(u=e[r])&&void 0!==u?u:e[s])?d.push(e):c.push(e)}return i.applyChangeset({removed:a,added:c,updated:d},null,r,l,!0)}applySyncResponse(e,t){const n=this,r=n.orderedCrudStores;n.applyingChangeset=n.applyingSyncResponse=!0,n.suspendChangesTracking();for(const s of r){var i;n.applyChangesToStore(s,e[s.storeId],null==t||null===(i=t.pack)||void 0===i?void 0:i[s.storeId])}n.resumeChangesTracking(!0),n.applyingChangeset=n.applyingSyncResponse=!1}applyLoadResponse(e,t){this.applyingLoadResponse=!0,this.loadCrudManagerData(e,t),this.applyingLoadResponse=!1}async applyResponse(e,t,n){const r=this;switch(r.trackResponseType&&t.type||e.type){case"load":r.validateResponse&&r.validateLoadResponse(t),r.applyLoadResponse(t,n);break;case"sync":r.validateResponse&&r.validateSyncResponse(t,e),r.applySyncResponse(t,e)}}applyChangeset(e,t=null,n,r=!1){const i=this,s=r?new Map:void 0;i.suspendAutoSync(),i.suspendChangesTracking();for(const{store:n,phantomIdField:o}of i.orderedCrudStores)if(e[n.id]){const a=n.applyChangeset(e[n.id],t,o||i.phantomIdField,!0,r);a&&s.set(n.id,a)}return i.resumeChangesTracking(!0),i.resumeAutoSync(!1),s}get requestId(){return Number.parseInt(`${Date.now()}${this._requestId++}`)}sync(){const e=this;return e.clearTimeout("autoSync"),e.activeRequests.sync?(e.trigger("syncDelayed"),e.activeSyncPromise=e.activeSyncPromise.finally((()=>e.sync()))):e.activeSyncPromise=new Promise(((t,n)=>{const r=e.getChangesetPackage();r?!1!==e.trigger("beforeSync",{pack:r})?(e.trigger("syncStart",{pack:r}),e.activeRequests.sync={type:"sync",pack:r,resolve:t,reject:n,id:r.requestId,desc:e.sendRequest({id:r.requestId,data:e.encode(r),type:"sync",success:e.onCrudRequestSuccess,failure:e.onCrudRequestFailure,thisObj:e})}):(e.trigger("syncCanceled",{pack:r}),n({cancelled:!0})):t(null)})).catch((e=>{if(e&&!e.cancelled)throw e;return e}))}async onCrudRequestSuccess(e,t,n){var r;const i=this,{type:s,id:o}=n;if(i.isDestroyed)return;let a="";n=i.activeRequests[s];try{a=await e.text()}catch(e){}if(i.isDestroyed)return;if((null===(r=n)||void 0===r?void 0:r.id)!==o)throw new Error(`Interleaved ${s} operation detected`);i.activeRequests[s]=null;const l=await i.internalOnResponse(n,a,t);i.isDestroyed||(l&&(i.skipSuccessProperty?!1!==(null==l?void 0:l.success):null!=l&&l.success)||n.reject(new jf({rawResponse:e,response:l,request:n})),i["crud"+_.capitalize(n.type)+"ed"]=!0,n.resolve({response:l,rawResponse:e,responseText:a,request:n}))}async onCrudRequestFailure(e,t,n){var r;const i=this;if(i.isDestroyed)return;n=i.activeRequests[n.type];const s=null==t||null===(r=t.abortController)||void 0===r?void 0:r.signal;if(!Boolean(null==s?void 0:s.aborted)){let r,s="";try{s=await e.text(),r=i.decode(s)}catch(e){}if(i.isDestroyed)return;if(i.triggerFailedRequestEvents(n,r,s,t),i.isDestroyed)return;n.reject(new jf({rawResponse:e,request:n}))}i.activeRequests[n.type]=null}acceptChanges(){this.crudStores.forEach((e=>e.store.acceptChanges()))}revertChanges(){this.orderedCrudStores.forEach((e=>e.store.revertChanges()))}doDestroy(){const e=this,{load:t,sync:n}=e.activeRequests;for(t&&e.cancelRequest(t.desc,t.reject),n&&e.cancelRequest(n.desc,n.reject);e.crudStores.length>0;)e.removeCrudStore(e.crudStores[0]);super.doDestroy&&super.doDestroy()}},v(t,"configurable",{loadUrl:null,syncUrl:null,forceSync:null}),t};class Yf extends(Te.mixin(Uf)){get revision(){return this.crudRevision}set revision(e){this.crudRevision=e}get json(){return _.safeJsonStringify(this)}set json(e){"string"==typeof e&&(e=_.safeJsonParse(e)),this.forEachCrudStore((t=>{const n=`${t.storeId}Data`;e[n]&&(t.data=e[n])}))}static get defaultConfig(){return{stores:null}}construct(e={}){e.stores&&(e.crudStores=e.stores,delete e.stores),super.construct(e)}toJSON(){const e={};return this.forEachCrudStore(((t,n)=>e[`${n}Data`]=t.toJSON())),e}get inlineData(){return this.toJSON()}set inlineData(e){this.json=e}set stores(e){e!==this.crudStores&&(this.crudStores=e)}get stores(){return this.crudStores}get isLoading(){return this.isCrudManagerLoading}addStore(...e){return this.addCrudStore(...e)}removeStore(...e){return this.removeCrudStore(...e)}getStore(...e){return this.getCrudStore(...e)}hasChanges(...e){return this.crudStoreHasChanges(...e)}loadData(...e){return this.loadCrudManagerData(...e)}}Yf._$name="AbstractCrudManager";var Gf=e=>class t extends(e||Te){static get $name(){return"AjaxTransport"}static get defaultMethod(){return{load:"GET",sync:"POST"}}cancelRequest(e,t){var n;null===(n=e.abort)||void 0===n||n.call(e),t({cancelled:!0})}shouldUseBodyForRequestData(e,t,n){return!("HEAD"===t||"GET"===t||n)}sendRequest(e){const n=this,{data:r}=e,i=n.transport[e.type]||{},s=Y.assign({},i,i.requestConfig);e.url&&(s.url=e.url),s.method=s.method||t.defaultMethod[e.type],s.params=Y.assign(s.params||{},e.params);let{paramName:o}=s;if(n.shouldUseBodyForRequestData(i,s.method,o)?(s.body=r,s.headers=s.headers||{},s.headers["Content-Type"]=s.headers["Content-Type"]||"application/json"):(o=o||"data",s.params[o]=r),!s.url)throw new Error("Trying to request without URL specified");delete s.requestConfig,delete s.paramName,n.trigger("beforeSend",{params:s.params,type:e.type,requestConfig:s,config:e}),s.queryParams=s.params,delete s.params;let a=!1;const l=Y.assign({},s,s.fetchOptions),c=st.fetch(s.url,l),d=c.catch((e=>{var t;c.done=!0;const n=null===(t=l.abortController)||void 0===t?void 0:t.signal;return n&&(a=n.aborted,a||console.warn(e)),{error:e,cancelled:a}})).then((t=>{c.done=!0;const r=null!=t&&t.ok?e.success:e.failure;return null==r?void 0:r.call(e.thisObj||n,t,l,e)}));return d.abort=()=>{var e;c.done||null===(e=c.abort)||void 0===e||e.call(c)},d}},qf=e=>class extends(e||Te){static get $name(){return"JsonEncoder"}static get defaultConfig(){return{encoder:{}}}encode(e){var t;return e=Object.assign({},null===(t=this.encoder)||void 0===t?void 0:t.requestData,e),_.safeJsonStringify(e)}decode(e){return _.safeJsonParse(e)}},Kf=e=>{var t;return v(t=class extends(e.mixin(Id)){static get $name(){return"CrudManagerView"}afterConstruct(){super.afterConstruct();const{crudManager:e,project:t}=this;this.loadMask&&(e||t).isCrudManagerLoading&&this.onCrudManagerLoadStart()}applySyncMask(){const{syncMask:e}=this;e&&(this.masked=Ta.mergeConfigs(this.loadMaskDefaults,e))}clearSyncMask(){this.masked=null}bindCrudManager(e){this.detachListeners("crudManager"),null==e||e.on({name:"crudManager",loadStart:"onCrudManagerLoadStart",load:"onCrudManagerLoad",loadCanceled:"onCrudManagerLoadCanceled",syncStart:"onCrudManagerSyncStart",sync:"onCrudManagerSync",syncCanceled:"onCrudManagerSyncCanceled",requestFail:"onCrudManagerRequestFail",thisObj:this})}onCrudManagerLoadStart(){var e;this.applyLoadMask(),null===(e=this.toggleEmptyText)||void 0===e||e.call(this)}onCrudManagerSyncStart(){this.applySyncMask()}onCrudManagerRequestFinalize(e=!0,t,n){const r=this,{clearMaskDelay:i}=r;var s;e?(null!=i?r.setTimeout(r.clearSyncMask,i):r.clearSyncMask(),null===(s=r.toggleEmptyText)||void 0===s||s.call(r)):r.applyMaskError(`<div class="b-grid-load-failure">\n                    <div class="b-grid-load-fail">${r.L(`L{GridBase.${t}FailedMessage}`)}</div>\n                    ${n&&n.message?`<div class="b-grid-load-fail">${r.L("L{CrudManagerView.serverResponseLabel}")} ${n.message}</div>`:""}\n                </div>`)}onCrudManagerLoadCanceled(){this.onCrudManagerRequestFinalize(!0,"load")}onCrudManagerSyncCanceled(){this.onCrudManagerRequestFinalize(!0,"sync")}onCrudManagerLoad(){this.onCrudManagerRequestFinalize(!0,"load")}onCrudManagerSync(){this.onCrudManagerRequestFinalize(!0,"sync"),this.refresh()}onCrudManagerRequestFail({requestType:e,response:t}){this.onCrudManagerRequestFinalize(!1,e,t)}get widgetClass(){}},"config",{clearMaskDelay:null,testConfig:{clearMaskDelay:0}}),t},Xf=e=>class extends(e||Te){static get $name(){return"PartOfProject"}},Zf=e=>class extends e{static get $name(){return"AssignmentModelMixin"}static get fields(){return["resourceId","eventId",{name:"drawDependencies",type:"boolean"},"event","resource"]}construct(e,...t){const n=(e=e||{})[this.fieldMap.eventId.dataSource],r=e[this.fieldMap.resourceId.dataSource];null!=n&&(e.event=n),null!=r&&(e.resource=r),super.construct(e,...t)}get eventResourceKey(){return this.buildEventResourceKey(this.event,this.resource)}buildEventResourceKey(e,t){let n,r;return n=e?e.isModel?e.id:e:this.internalId,r=t?t.isModel?t.id:t:this.internalId,`${n}-${r}`}buildIndexKey({event:e,resource:t}){return this.buildEventResourceKey(e,t)}set(e,t,...n){const r=this.fieldToKeys(e,t);var i,s;return"resource"in r?null!==(i=r.resource)&&void 0!==i&&i.id&&(r.resourceId=r.resource.id):"resourceId"in r&&this.constructor.isProAssignmentModel&&(r.resource=r.resourceId),"event"in r?null!==(s=r.event)&&void 0!==s&&s.id&&(r.eventId=r.event.id):"eventId"in r&&this.constructor.isProAssignmentModel&&(r.event=r.eventId),super.set(r,null,...n)}afterChange(e,t,n,r,i){var s;return!this.constructor.isProAssignmentModel&&null!=t&&t.resourceId&&(null===(s=this.resource)||void 0===s?void 0:s.id)!==t.resourceId.value&&(this.resource=t.resourceId.value),super.afterChange(...arguments)}set resourceId(e){const{resource:t}=this;null!=t&&t.isModel&&t.id===e?this.set("resourceId",e):this.resource=e}get resourceId(){var e;return this.get("resourceId")||(null===(e=this.resource)||void 0===e?void 0:e.id)}set eventId(e){const{event:t}=this;null!=t&&t.isModel&&t.id===e?this.set("eventId",e):this.event=e}get eventId(){var e;return this.get("eventId")||(null===(e=this.event)||void 0===e?void 0:e.id)}get eventName(){var e;return null===(e=this.event)||void 0===e?void 0:e.name}get resourceName(){var e;return null===(e=this.resource)||void 0===e?void 0:e.name}getResource(){return this.resource}get isAssignment(){return!0}get isPersistable(){var e;const{event:t,resource:n,unjoinedStores:r,assignmentStore:i}=this,s=null==i?void 0:i.crudManager;let o;return o=i?this.isValid&&t.isPersistable&&(s||!t.hasGeneratedId&&!n.hasGeneratedId):!this.isPhantom&&Boolean(r[0]),o&&super.isPersistable&&!(null!==(e=this.event)&&void 0!==e&&e.isCreating)}get isValid(){return null!=this.resource&&null!=this.event}toString(){return this.resourceName?`${this.resourceName} ${Math.round(this.units)}%`:""}shouldRecordFieldChange(e,t,n){if(!super.shouldRecordFieldChange(e,t,n))return!1;if("event"===e||"eventId"===e){var r;const e=null===(r=this.project)||void 0===r?void 0:r.eventStore;if(e&&e.oldIdMap[t]===e.getById(n))return!1}if("resource"===e||"resourceId"===e){var i;const e=null===(i=this.project)||void 0===i?void 0:i.resourceStore;if(e&&e.oldIdMap[t]===e.getById(n))return!1}return!0}};const Jf=cf;class Qf extends(Zf(Xf(Jf.derive(Hi)))){static get $name(){return"AssignmentModel"}get resource(){return super.resource}set resource(e){super.resource=e,this.set("resourceId",this.constructor.asId(e))}}Qf.exposeProperties(),Qf._$name="AssignmentModel";var ev=e=>class extends e{static get $name(){return"AssignmentStoreMixin"}static get defaultConfig(){return{loadPriority:300,syncPriority:300,storeId:"assignments"}}add(e,...t){e=ke.asArray(e);for(let t=0;t<e.length;t++){var n;let r=e[t];if(r instanceof Hi||(e[t]=r=this.createRecord(r)),!this.isSyncingDataOnLoad&&-1!==this.storage.findIndex("eventResourceKey",r.eventResourceKey,!0))throw new Error(`Duplicate assignment Event: ${r.eventId} to resource: ${r.resourceId}`);null!==(n=r.event)&&void 0!==n&&n.isCreating&&(r.isCreating=!0)}return super.add(e,...t)}includesAssignment(e,t){return-1!==this.storage.findIndex("eventResourceKey",`${e}-${t}`,!0)}setStoreData(e){super.setStoreData(e)}set storage(e){super.storage=e,this.storage.addIndex({property:"eventResourceKey",dependentOn:{event:!0,resource:!0}})}get storage(){return this._storage||super.storage}get isAssignmentStore(){return!0}getOccurrence(e,t){if(!e||null==t||!t.isOccurrence)return e;const n=this;return{id:`${t.id}:a${e.id}`,event:t,resource:e.resource,eventId:t.id,resourceId:e.resource.id,isAssignment:!0,isOccurrenceAssignment:!0,instanceMeta(e){return n.occurrenceInstanceMeta(this,e)}}}occurrenceInstanceMeta(e,t){const n=t.id||t,{id:r}=e;let{occurrenceMeta:i}=this;return i||(i=this.occurrenceMeta={}),i[r]||(i[r]={}),i[r][n]||(i[r][n]={})}mapAssignmentsForEvent(e,t,n){e=this.eventStore.getById(e);const r=Boolean(t),i=Boolean(n);return r||i?e.assignments.reduce(((e,s)=>{const o=r?t(s):s;return i&&!n(o)||e.push(o),e}),[]):e.assignments}mapAssignmentsForResource(e,t,n){e=this.resourceStore.getById(e);const r=Boolean(t),i=Boolean(n);return r||i?e.assignments.reduce(((e,s)=>{const o=r?t(s):s;return i&&!n(o)||e.push(o),e}),[]):e.assignments}getAssignmentsForEvent(e){return e.assignments}removeAssignmentsForEvent(e){return this.remove(e.assignments)}getAssignmentsForResource(e){return(e=this.resourceStore.getById(e)).assignments}removeAssignmentsForResource(e){this.remove(this.getAssignmentsForResource(e))}getResourcesForEvent(e){return e.resources}getEventsForResource(e){var t;return null===(t=e=this.resourceStore.getById(e))||void 0===t?void 0:t.events}assignEventToResource(e,t,n=null,r=!1){var i,s;const o=this,a=r?new Set(e.assignments):null;if(t=ke.asArray(t).map((e=>{var t;return null!==(t=e.$original)&&void 0!==t?t:e})),null!==(i=o.eventStore)&&void 0!==i&&i.usesSingleAssignment&&null!==(s=e.assignments)&&void 0!==s&&s.length)return o.isEventAssignedToResource(e,t[0])||(e.resource=t[0]),[];let l=[];return o.suspendAutoCommit(),t.forEach((t=>{const i=o.getAssignmentForEventAndResource(e,t);if(i)r&&a.delete(i);else{var s;const r={event:e,resource:t};l.push(null!==(s=null==n?void 0:n(r))&&void 0!==s?s:r)}})),l=o.add(l),r&&o.remove(Array.from(a)),o.resumeAutoCommit(),l}unassignEventFromResource(e,t){const n=this,r=[];if(!t)return n.removeAssignmentsForEvent(e);t=ke.asArray(t);for(let i=0;i<t.length;i++)n.isEventAssignedToResource(e,t[i])&&r.push(n.getAssignmentForEventAndResource(e,t[i]));return n.remove(r)}isEventAssignedToResource(e,t){return Boolean(this.getAssignmentForEventAndResource(e,t))}getAssignmentForEventAndResource(e,t){let n;return(e=this.eventStore.getById(e))&&(n=e.assignments)&&(t=this.resourceStore.getById(t))?this.getOccurrence(n.find((e=>e.resource===t)),e):null}};const tv=Xf(hf.derive(Ls));class nv extends(ev(tv)){static get defaultConfig(){return{modelClass:Qf}}}v(nv,"$name","AssignmentStore"),nv._$name="AssignmentStore";var rv=e=>class extends(e||Te){static get $name(){return"ResourceStoreMixin"}get isResourceStore(){return!0}static get defaultConfig(){return{loadPriority:200,syncPriority:100,storeId:"resources",autoTree:!0}}construct(e){if(super.construct(e),!this.modelClass.isResourceModel)throw new Error("Model for ResourceStore must subclass ResourceModel")}getTotalWidth(e){let t=0;return e.variableColumnWidths=!1,this.forEach((n=>{n.instanceMeta(e).insetStart=t,null==n.columnWidth?t+=e.resourceColumnWidth:(t+=n.columnWidth,e.variableColumnWidths=!0)})),t}removeAll(){const e=super.removeAll(...arguments);return e&&this.assignmentStore.removeAll(),e}onRecordIdChange({record:e,oldValue:t,value:n}){super.onRecordIdChange({record:e,oldValue:t,value:n}),e.isFieldModified("id")&&(this.isChangingId=!0,e.updateAssignmentResourceIds(),this.isChangingId=!1)}getAvailableResources({startDate:e,endDate:t}){return this.query((n=>this.eventStore.isDateRangeAvailable(e,t,null,n)))}},iv=e=>class extends e{static get $name(){return"ResourceModelMixin"}static get isResourceModel(){return!0}static get fields(){return[{name:"name",type:"string",persist:!0},"eventColor","eventStyle","imageUrl","image",{name:"resourceMargin",type:"number"},{name:"barMargin",type:"number"},"eventLayout"]}updateAssignmentResourceIds(){this.assigned.forEach((e=>{e.resourceId=this.id}))}syncId(e){super.syncId(e),this.updateAssignmentResourceIds()}get events(){return this.assignments.reduce(((e,t)=>(t.event&&e.push(t.event),e)),[])}get assignments(){return this.assigned?[...this.assigned]:[]}set assignments(e){e.forEach((e=>{e.resource=this}))}getEvents(){return this.events}get isPersistable(){return super.isPersistable&&(!this.parent||this.parent.isPersistable)}unassignAll(){this.assignments&&this.assignmentStore.remove(this.assignments)}get initials(){const{name:e=""}=this;if(!e)return"";const t=e.split(" ");return t[0][0]+(t.length>1?t[t.length-1][0]:"")}isWorkingTime(e){var t,n;const r=this.effectiveCalendar||(null===(t=this.project)||void 0===t?void 0:t.calendar);return!r||(null===(n=r.isWorkingTime)||void 0===n?void 0:n.call(r,e))}};const sv=lf;class ov extends(iv(Xf(sv.derive(hg)))){static get $name(){return"ResourceModel"}}ov.exposeProperties(),ov._$name="ResourceModel";const av=Xf(Sf.derive(Ls));class lv extends(rv(av)){static get defaultConfig(){return{modelClass:ov}}}lv._$name="ResourceStore";var cv=e=>class extends(e||Te){static get $name(){return"EventStoreMixin"}construct(e){super.construct(e),this.autoTree=!0}set filtersFunction(e){super.filtersFunction=e}get filtersFunction(){const e=super.filtersFunction;return e&&e!==$e.returnTrue?t=>t.isCreating||e(t):e}getEventCounts(e){const t=this,{filtersFunction:n,added:r}=t,i=t.getEvents(f(f({},e),{},{storeFilterFn:t.isFiltered?t.reapplyFilterOnAdd?n:e=>r.includes(e)?t.indexOf(e)>-1:n(e):null,dateMap:e.dateMap||!0}));return i.forEach(((e,t)=>i.set(t,e.length))),i}forEachScheduledEvent(e,t=this){this.forEach((n=>{const{startDate:r,endDate:i}=n;if(r&&i)return e.call(t,n,r,i)}))}getTotalTimeSpan(){let e=new Date(9999,0,1),t=new Date(0);return this.forEach((n=>{n.startDate&&(e=en.min(n.startDate,e)),n.endDate&&(t=en.max(n.endDate,t))})),e=e<new Date(9999,0,1)?e:null,t=t>new Date(0)?t:null,this.lastTotalTimeSpan={startDate:e||null,endDate:t||e||null}}isEventPersistable(e){return e.isPersistable}isDateRangeAvailable(e,t,n,r){if(r.data.generatedParent)return!1;const i=new Set(this.getEventsForResource(r));if(null!=n&&n.isAssignment&&n.event.resources.forEach((e=>{e.id!==n.resourceId&&this.getEventsForResource(e).forEach((e=>i.add(e)))})),n){const e=n.isAssignment?n.event:n;i.delete(e)}return!Array.from(i).some((n=>n.isScheduled&&en.intersectSpans(e,t,n.startDate,n.endDate)))}filterEventsForResource(e,t,n=this){return e.getEvents(this).filter(t.bind(n))}getResourcesForEvent(e){return e.isOccurrence&&(e=e.recurringTimeSpan),this.assignmentStore.getResourcesForEvent(e)}getEventsForResource(e){return this.assignmentStore.getEventsForResource(e)}getAssignmentsForEvent(e){return this.assignmentStore.getAssignmentsForEvent(e)||[]}getAssignmentsForResource(e){return this.assignmentStore.getAssignmentsForResource(e)||[]}assignEventToResource(e,t,n=!1){return this.assignmentStore.assignEventToResource(e,t,void 0,n)}unassignEventFromResource(e,t){this.assignmentStore.unassignEventFromResource(e,t)}reassignEventFromResourceToResource(e,t,n){const r=Hi.asId(n),i=this.assignmentStore.getAssignmentForEventAndResource(e,t);i?i.resourceId=r:this.assignmentStore.assignEventToResource(e,n)}isEventAssignedToResource(e,t){return this.assignmentStore.isEventAssignedToResource(e,t)}removeAssignmentsForEvent(e){this.assignmentStore.removeAssignmentsForEvent(e)}removeAssignmentsForResource(e){this.assignmentStore.removeAssignmentsForResource(e)}};const dv=()=>!0;var uv=e=>{var t;return t=class extends e{getEvents({filter:e,date:t,startDate:n,endDate:r,startOnly:i,includeOccurrences:s,allowPartial:o,onlyAssigned:a=!1,dateMap:l=!1,dayTime:c=null,getDateIndex:d}){const u=this,h=arguments[0],{lastDateRange:g,added:m,filtersFunction:p}=u,f=e;if(a&&(h.filter=f?e=>f(e)&&e.resources.length:e=>e.resources.length),"startDate"in h||(n=h.startDate=t),"includeOccurrences"in h||(s=h.includeOccurrences=!0),"allowPartial"in h||(o=h.allowPartial=!i),h.storeFilterFn=u.isFiltered&&!h.ignoreFilters?u.reapplyFilterOnAdd?p:e=>m.includes(e)?u.indexOf(e)>-1:p(e):null,!r)if(n)(r=h.endDate=en.clearTime(n)).setDate(r.getDate()+1);else{if(s)throw new Error("getEvents MUST be passed startDate and endDate if recurring occurrences are requested");h.dateFilter=dv}h.dateFilter||(h.dateFilter=i?e=>{const t=e.hasBatchedChange("startDate")?e.get("startDate"):e.startDate;return t&&!(en.clearTime(t)-n)}:o?e=>{const t=e.hasBatchedChange("startDate")?e.get("startDate"):e.startDate,i=e.hasBatchedChange("endDate")?e.get("endDate"):e.endDate||t;return t&&(t-i?en.intersectSpans(t,i,n,r):en.betweenLesserEqual(t,n,r))}:e=>{const t=e.hasBatchedChange("startDate")?e.get("startDate"):e.startDate,i=e.hasBatchedChange("endDate")?e.get("endDate"):e.endDate||t;return t&&t>=n&&i<=r});const v={startDate:n,endDate:r};return(!g||g.startDate-v.startDate||g.endDate-v.endDate)&&(u.processConfiguredListeners(),u.trigger("loadDateRange",{old:g||{},new:Y.clone(v)}),u.lastDateRange=Y.clone(v)),l?u.getEventsAsMap(h):u.getEventsAsArray(h)}getEventsAsArray({filter:e,date:t,resourceRecord:n,startDate:r=t,endDate:i,startOnly:s,includeOccurrences:o=!0,dayTime:a=null,dateFilter:l,storeFilterFn:c,getDateIndex:d}){const u=this,h=[];if(c?u.count:u.allCount){let e=n?u.getEventsForResource(n):null;if(!n){const t=u.useDayIndex(a),n=new Set,o=s?"startDate":"date";u.recurringEvents.forEach((e=>{t.dayTime.startOfDay(e.startDate)<=r&&n.add(e)}));for(const e=new Date(r);e<i;e.setDate(e.getDate()+1)){const r=t.get(d?d(e):o,e);null==r||r.forEach((e=>n.add(e)))}e=[...n]}c&&(e=e.filter(c));for(let t=0,{length:n}=e;t<n;t++){const n=e[t];o&&n.isRecurring?h.push.apply(h,n.getOccurrencesForDateRange(r,i).filter(l)):l(n)&&h.push(n)}}return e?h.filter(e):h}getEventsAsMap({filter:e,date:t,resourceRecord:n,startDate:r=t,endDate:i,startOnly:s,includeOccurrences:o=!0,dateMap:a,dayTime:l=null,storeFilterFn:c,getDateIndex:d}){var u;const h=this;if(null!==(u=a)&&void 0!==u&&u.clear?a.clear():a=new Map,h.count){const t=h.useDayIndex(l),u=s?"startDate":"date",p=[],f=t=>(!e||e(t))&&(!c||c(t)),v=e=>!e.isRecurring&&f(e);if(l=t.dayTime,n)throw new Error("Querying for events for a resource and returning a date-keyed Map is not supported");var g;null===(g=h.recurringEvents)||void 0===g||g.forEach((e=>{l.startOfDay(e.startDate)<i&&p.push(e)}));for(const e=new Date(r);e<i;e.setDate(e.getDate()+1)){var m;let[n,r]=t.get(d?d(e):u,e,!0);null!==(m=n)&&void 0!==m&&m.size&&(n=[...n].filter(v),n.length&&(a.get(r)||a.set(r,[]).get(r)).push(...n))}for(let e=0,{length:t}=p;e<t;e++){const t=p[e],n=(o?t.getOccurrencesForDateRange(r,i):[t]).filter(f),c=en.add(i,1,"day");for(let e,t=0,{length:r}=n;t<r;t++){const r=n[t],i=l.startOfDay(r.startDate),o="startDate"===(d?d(i):s?"startDate":"date")||r.allDay?en.add(i,1,"day"):en.min(r.endDate||en.add(r.startDate,r.duration,r.durationUnit),c);for(;i<o;i.setDate(i.getDate()+1)){const t=l.dateKey(i);(e=a.get(t))||a.set(t,e=[]),e.push(r)}}}}return a}},v(t,"$name","GetEventsMixin"),t};const hv={date:"_dateIndex",startDate:"_startDateIndex"},gv=Object.values(hv),mv=Object.freeze([]),{MILLIS_PER_DAY:pv}=zd;class fv{constructor(e,t){this.dayTime=t||zd.MIDNIGHT,this.store=e,this.users=[this.dayTime]}add(e,t,n){const r=this[hv[e]],i=this.dayTime.dateKey(t);(r[i]||(r[i]=new Set)).add(n)}addEvent(e){var t;let n,r=null===(t=this.dayTime.startOfDay(e.startDate))||void 0===t?void 0:t.getTime();if(r){var i,s;n=null!==(i=null===(s=e.endDate)||void 0===s?void 0:s.getTime())&&void 0!==i?i:r,this.add("startDate",r,e);do{this.add("date",r,e),r+=pv}while(r<n)}}clear(){gv.forEach((e=>this[e]=Object.create(null)))}get(e,t,n){!this.initialized&&this.initialize();let r,i=this[hv[e]];return t&&(r=this.dayTime.dateKey(t),i=n?[i[r],r]:i[r]),i}initialize(){this.initialized=!0,this.clear(),this.sync("splice",this.store.storage.allValues)}invalidate(){this.initialized=!1,gv.forEach((e=>this[e]=null))}matches(e){return this.dayTime.startShift===e.startShift}remove(e,t,n){const r=this[hv[e]][this.dayTime.dateKey(t)];r&&r.delete(n)}removeEvent(e,t,n){var r;let i,s=null===(r=this.dayTime.startOfDay(t))||void 0===r?void 0:r.getTime();if(s){var o;i=null!==(o=null==n?void 0:n.getTime())&&void 0!==o?o:s,this.remove("startDate",s,e);do{this.remove("date",s,e),s+=pv}while(s<i)}}sync(e,t,n,r,i){var s,o;n=n||mv;const a=this,l=(t=t||mv).length,c=n.length,d=null==r?void 0:r.length;let u,h,g;if(a.initialized)switch(e){case"clear":a.clear();break;case"splice":if(d)for(t=t.slice(),n=n.slice(),u=0;u<d;u++)n.push(r[u][0]),t.push(r[u][1]);if(c)for(u=0;u<c;u++)g=n[u],a.removeEvent(g,g.startDate,g.endDate);if(l)for(u=0;u<l;u++)h=t[u],h.isScheduled&&!h.isParent&&a.addEvent(h);break;case"reschedule":g=t[0],a.removeEvent(g,(null===(s=i.startDate)||void 0===s?void 0:s.oldValue)||g.startDate,(null===(o=i.endDate)||void 0===o?void 0:o.oldValue)||g.endDate),a.sync("splice",t)}}register(e){this.users.push(e)}unregister(e){const{users:t}=this,n=t.indexOf(e);return n>-1&&t.splice(n,1),!t.length}}const vv=fv.prototype;gv.forEach((e=>vv[e]=null)),vv.initialized=!1,fv._$name="EventDayIndex";const{MIDNIGHT:yv}=zd;var bv=e=>{var t;return t=class extends e{construct(e){super.construct(e),this.dayIndices=null}afterLoadData(){var e;this.syncIndices("splice",this.storage.allValues),null===(e=super.afterLoadData)||void 0===e||e.call(this)}onDataChange({action:e,added:t,removed:n,replaced:r}){this.syncIndices(e,t,n,r),super.onDataChange(...arguments)}onDataReplaced(e,t){this.syncIndices("clear"),this.syncIndices("splice",this.storage.values),super.onDataReplaced(e,t)}onModelChange(e,t,n,r,i){("startDate"in n||"endDate"in n)&&this.syncIndices("reschedule",[e],null,null,n),super.onModelChange(...arguments)}invalidateDayIndices(){var e;null===(e=this.dayIndices)||void 0===e||e.forEach((e=>e.invalidate()))}registerDayIndex(e){const t=this,n=t.dayIndices||(t.dayIndices=[]);let r,i;for(i=0;!r&&i<n.length;++i)n[i].matches(e)&&(r=n[i]).register(e);return!r&&n.push(r=new fv(t,e)),r}syncIndices(...e){var t;null===(t=this.dayIndices)||void 0===t||t.forEach((t=>t.sync(...e)))}unregisterDayIndex(e){const{dayIndices:t}=this;for(let n=null==t?void 0:t.length;n-- >0;)if(t[n].matches(e)){t[n].unregister(e)&&t.splice(n,1);break}}useDayIndex(e){const t=this,{dayIndices:n}=t;e=e||yv;for(let t=0;n&&t<n.length;++t)if(n[t].matches(e))return n[t];if(e.startShift)throw new Error(`No day index registered for ${e} on ${t.id}`);return t.registerDayIndex(yv)}},v(t,"$name","DayIndexMixin"),t},Cv=e=>class extends e{static get $name(){return"SharedEventStoreMixin"}static get defaultConfig(){return{loadPriority:100,syncPriority:200,storeId:"events",removeUnassignedEvent:!0,singleAssignment:null}}construct(e){if(super.construct(e,!0),this.singleAssignment&&(this.usesSingleAssignment=!0),!this.modelClass.isEventModel)throw new Error("The model for the EventStore must subclass EventModel")}append(e){return this.add(e)}get project(){return super.project}set project(e){var t;super.project=e,this.detachListeners("project"),e&&(null!==(t=e.assignmentStore)&&void 0!==t&&t.isAssignmentStore&&this.attachToAssignmentStore(e.assignmentStore),e.on({name:"project",assignmentStoreChange:"onProjectAssignmentStoreChange",thisObj:this,prio:200}))}processRecords(e){var t;const{assignmentStore:n}=this,r=[];return n&&(n.skipInvalidateIndices=!0),e=super.processRecords(e,n&&!(null!==(t=this.stm)&&void 0!==t&&t.isRestoring)&&(e=>{const t=e.get("resourceId");e.reassignedFromReplace||null==t||n.includesAssignment(e.id,t)||r.push({id:n.modelClass.generateId(""),resourceId:t,eventId:e.id}),e.reassignedFromReplace=!1})||void 0),n&&(n.storage.invalidateIndices(),n.skipInvalidateIndices=!1,n.add(r)),e}joinRecordsToStore(e){const{assignmentStore:t}=this;t?(t.skipInvalidateIndices=!0,super.joinRecordsToStore(e),t.storage.invalidateIndices(),t.skipInvalidateIndices=!1):super.joinRecordsToStore(e)}processRecord(e,t=!1){const n=(e=super.processRecord(e,t)).get("resourceId");if(null!=n&&!e.meta.skipEnforcingSingleAssignment){const r=this,{assignmentStore:i}=r,s=r.getById(e.id);if(s&&s!==e&&!t){const t=i.find((t=>t.eventId===e.id));t&&(t.resource=n,e.reassignedFromReplace=!0)}else r.$processResourceIds=!0;r.usesSingleAssignment=!0}return e}processResourceIds(){const{assignmentStore:e}=this;if(this.$processResourceIds&&null!=e&&e.isAssignmentStore){const t=[];this.forEach((n=>{const{resourceId:r,id:i}=n;null!=r&&t.push({id:e.modelClass.generateId(""),resourceId:r,eventId:i})})),e.useRawData={disableDefaultValue:!0,disableDuplicateIdCheck:!0,disableTypeConversion:!0},e.usesSingleAssignment=!1,e.verifyNoGeneratedIds=!1,e.data=t,e.usesSingleAssignment=!0,this.$processResourceIds=!1}}loadData(){super.loadData(...arguments),this.processResourceIds()}onBeforeRemoveAssignment({records:e}){var t;const n=this;if(n.removeUnassignedEvent&&!n.isRemoving&&!n.isSettingData&&(null===(t=n.stm)||void 0===t||!t.isRestoring)&&!n.usesSingleAssignment&&!n.assignmentStore.isSyncingDataOnLoad&&!n.resourceStore.isSyncingDataOnLoad){const t=new Set;e.forEach((n=>{const{event:r}=n;r&&!r.isRemoved&&r.assignments.every((t=>e.includes(t)))&&t.add(r)})),t.size&&n.remove([...t])}}onProjectAssignmentStoreChange({store:e}){this.attachToAssignmentStore(e)}attachToAssignmentStore(e){const t=this;t.detachListeners("assignmentStore"),e&&(t.processResourceIds(),e.on({name:"assignmentStore",addPreCommit({records:e}){!t.usesSingleAssignment||t.isSettingData||t.isAssigning||e.forEach((e=>{const{event:t}=e;null!=t&&t.isEvent&&t.resourceId!==e.resourceId&&(t.meta.isAssigning=!0,t.set("resourceId",e.resourceId),t.meta.isAssigning=!1)}))},beforeRemove:"onBeforeRemoveAssignment",removePreCommit({records:e}){t.usesSingleAssignment&&e.forEach((e=>{var n;null===(n=t.getById(e.eventId))||void 0===n||n.set("resourceId",null)}))},removeAllPreCommit(){t.usesSingleAssignment&&!t.isSettingData&&t.allRecords.forEach((e=>e.set("resourceId",null)))},update({record:e,changes:n}){if(t.usesSingleAssignment&&"resourceId"in n){const{event:t}=e;t.meta.isAssigning=!0,t.set("resourceId",n.resourceId.value),t.meta.isAssigning=!1}},thisObj:t}))}set data(e){this.isSettingData=!0,this.usesSingleAssignment&&!this.syncDataOnLoad&&this.assignmentStore.removeAll(!0),super.data=e,this.isSettingData=!1}trigger(e,t){const{changes:n}=t||{};return n&&"resourceId"in n&&1===Object.keys(n).length&&(t.isAssign=!0),super.trigger(...arguments)}};const wv=Object.freeze([]);var Sv=e=>class extends(e||Te){static get $name(){return"RecurringTimeSpansMixin"}construct(...e){this.globalOccurrences=new Map,this.recurringEvents=new Set,super.construct(...e)}afterLoadData(){this.globalOccurrences.clear(),this.refreshRecurringEventsCache("clear"),this.refreshRecurringEventsCache("splice",this.storage.allValues),super.afterLoadData&&super.afterLoadData()}onDataChange({action:e,added:t,removed:n,replaced:r}){this.refreshRecurringEventsCache(e,t,n,r),super.onDataChange(...arguments)}refreshRecurringEventsCache(e,t=wv,n=wv,r){const{recurringEvents:i}=this,s=null==r?void 0:r.length;switch(e){case"clear":i.clear();break;case"splice":{if(s){t=t.slice(),n=n.slice();for(let e=0;e<s;e++)n.push(r[e][0]),t.push(r[e][1])}const e=t.length,o=n.length;if(o&&i.size)for(let e=0;e<o;e++)i.delete(n[e]);if(e)for(let n=0;n<e;n++){const e=t[n];e.isRecurring&&i.add(e)}break}}}getById(e){let t=super.getById(e);return t||(t=this.globalOccurrences.get(this.modelClass.asId(e))),t}onModelChange(e,t,n,r,i){const s=this.isRecurrenceRelatedFieldChange(e,n);if(s&&!r&&e.removeOccurrences(),super.onModelChange(...arguments),s&&!r){const e={action:"batch",records:this.storage.values};this.trigger("refresh",e),this.trigger("change",e)}}isRecurrenceRelatedFieldChange(e,t){return e.isRecurring||"recurrenceRule"in t}getOccurrencesForTimeSpan(e,t,n){const r=[];return e.isRecurring&&e.recurrence.forEachOccurrence(t,n,(e=>r.push(e))),r}set data(e){this.globalOccurrences.clear(),super.data=e}getRecurringTimeSpans(){return[...this.recurringEvents]}},Dv=e=>class extends(Sv(e||Te)){static get $name(){return"RecurringEventsMixin"}getRecurringEvents(){return this.getRecurringTimeSpans()}isEventPersistable(e){return super.isEventPersistable(e)&&(!e.supportsRecurring||!e.isOccurrence)}};class Ev extends Hi{static get $name(){return"TimeSpan"}static get fields(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number",allowNull:!0,internal:!0},{type:"durationunit",name:"durationUnit",defaultValue:"d",internal:!0},{name:"fullDuration",persist:!1,column:{type:"duration"}},{name:"cls",defaultValue:"",internal:!0},{name:"iconCls",internal:!0},{name:"style",type:"object",internal:!0},{name:"name",type:"string",defaultValue:""}]}afterConstruct(){super.afterConstruct(),this.normalize()}get eventStore(){const e=this;return e.isOccurrence?e.recurringTimeSpan.eventStore:(e._eventStore||(e._eventStore=null===(t=e.stores)||void 0===t?void 0:t.find((e=>e.isEventStore))),e._eventStore);var t}normalize(){const e=this,{startDate:t,endDate:n,duration:r,durationUnit:i}=e,s=null!=r;t&&n&&!s?e.setData("duration",en.diff(t,n,i,!0)):t&&!n&&s?e.setData("endDate",en.add(t,r,i)):!t&&n&&s&&e.setData("startDate",en.add(n,-r,i))}updateInternalCls(e){this._cls?this._cls.value=e:this._cls=new Mn(e)}set internalCls(e){this.updateInternalCls(e),this.set("cls",this._cls.value)}get internalCls(){const{cls:e}=this;return null!=e&&e.isDomClassList?e:(this.internalCls=e,this._cls)}get cls(){return this._cls||(this._cls=new Mn(super.get("cls"))),this._cls}set cls(e){this.internalCls=e}get startDate(){return this.get("startDate")}set startDate(e){this.setStartDate(e)}get endDate(){return this.get("endDate")}set endDate(e){this.setEndDate(e)}get duration(){return this.get("duration")}set duration(e){this.setDuration(e,this.durationUnit)}get durationUnit(){return this.get("durationUnit")}setDuration(e,t=this.durationUnit){const n={duration:e=parseFloat(e),durationUnit:t};this.startDate?n.endDate=en.add(this.startDate,e,t):this.endDate&&(n.startDate=en.add(this.endDate,-e,t)),this.set(n)}getDurationInUnit(e,t){return this.starDate&&this.endDate?en.getDurationInUnit(this.startDate,this.endDate,e,t):en.as(e,this.duration,this.durationUnit)}get fullDuration(){return new Bi({unit:this.durationUnit,magnitude:this.duration})}set fullDuration(e){"string"==typeof e&&(e=en.parseDuration(e,!0,this.durationUnit)),this.setDuration(e.magnitude,e.unit)}setStartDate(e,t=!0){const n=this,r={startDate:e};if(e){let i;if(t)i=null!=n.duration;else if(n.endDate){if(r.duration=en.diff(e,n.endDate,n.durationUnit,!0),r.duration<0)throw new Error("Negative duration")}else i=null!=this.duration;i&&(r.endDate=en.add(e,n.getDurationInUnit("h"),"h"))}else r.duration=null;n.set(r)}setEndDate(e,t=!1){const n=this,r={endDate:e};if(e){let i;if(!0===t)i=null!=n.duration;else if(n.startDate){if(r.duration=en.diff(n.startDate,e,n.durationUnit,!0),r.duration<0)throw new Error("Negative duration")}else i=null!=this.duration;i&&(r.startDate=en.add(e,-n.duration,n.durationUnit))}n.set(r)}setStartEndDate(e,t,n){this.set({startDate:e,endDate:t},null,n)}get dates(){const e=[],t=en.startOf(this.startDate,"day"),n=this.endDate;for(let r=t;r<n;r=en.add(r,1,"day"))e.push(r);return e}get startDateMS(){var e;return null===(e=this.batching&&this.hasBatchedChange("startDate")?this.get("startDate"):this.startDate)||void 0===e?void 0:e.getTime()}get endDateMS(){var e;return null===(e=this.batching&&this.hasBatchedChange("endDate")?this.get("endDate"):this.endDate)||void 0===e?void 0:e.getTime()}get durationMS(){const{endDateMS:e,startDateMS:t}=this;return e&&t?e-t:en.asMilliseconds(this.duration||0,this.durationUnit)}get isMilestone(){return 0===this.duration}inSetNormalize(e){if("string"!=typeof e){let{startDate:t,endDate:n,duration:r,durationUnit:i=this.durationUnit}=e;"string"==typeof t&&(t=this.getFieldDefinition("startDate").convert(t)),"string"==typeof n&&(n=this.getFieldDefinition("endDate").convert(n)),"duration"in e?(t&&!n&&(n=en.add(t,r,i,!0,!0)),!t&&n&&(t=en.add(n,-r,i,!0,!0))):t&&n&&(r=en.as(i,en.diff(t,n,"h",!0),"h"));const s=Object.isFrozen(e)?sn.clone(e):e;return t&&(s.startDate=t),n&&(s.endDate=n),null!=r&&(s.duration=r),s}}inSet(e,t,n,r,i){return i||(e=this.inSetNormalize(e)||e),super.inSet(e,t,n,r,i)}applyValue(e,t,n,r,i){"cls"===t&&this.updateInternalCls(n),super.applyValue(e,t,n,r,i)}forEachDate(e,t){return this.dates.forEach(e.bind(t))}get isScheduled(){const{startDateMS:e,endDateMS:t}=this;return t-e>=0}get isValid(){const{startDate:e,endDate:t}=this;return!e||!t||t-e>=0}shift(e,t=this.durationUnit){if("string"==typeof e){const n=e;e=t,t=n}return this.setStartDate(en.add(this.startDate,e,t,!0),!0)}get wbsCode(){return this._wbsCode||this.indexPath.join(".")}set wbsCode(e){this._wbsCode=e}fullCopy(){return this.copy.apply(this,arguments)}intersects(e){return this.intersectsRange(e.startDate,e.endDate)}intersectsRange(e,t){const n=this.startDate,r=this.endDate;return n&&r&&en.intersectSpans(n,r,e,t)}split(e=.5){const t=this,n=t.copy(),{fullDuration:r,eventStore:i,assignmentStore:s}=t,o=new Bi(r);let a,l,c=new Bi(r);return"string"==typeof e?(a=new Bi(e),a.unit===o.unit?c.magnitude-=a.magnitude:(c.magnitude=en.as(a.unit,o)-a.magnitude,c.unit=a.unit,l=!0)):(a=new Bi(e>1?e:t.duration*e,t.durationUnit),c.magnitude-=a.magnitude),n.startDate=en.add(t.startDate,a.magnitude,a.unit),l?(n.fullDuration=c,t.fullDuration=a):(n.duration=c.magnitude,t.duration=a.magnitude),i&&(i.add(n),s&&!i.usesSingleAssignment&&s.add(t.assignments.map((e=>{const t=Object.assign({},e.data,{eventId:n.id,event:null,resource:null});return delete t.id,t})))),n}toICSString(e={}){if(!this.isScheduled)return"";const t=en.toUTC(new Date),n=en.toUTC(this.startDate),r=en.toUTC(this.endDate),i="YYYYMMDDTHHmmss",s=e.DTSTAMP||en.format(t,i)+"Z";delete e.DTSTAMP;let o={};if(this.allDay){const e="YYYYMMDD";o={"DTSTART;VALUE=DATE":en.format(n,e),"DTEND;VALUE=DATE":en.format(r,e)}}else o={DTSTART:en.format(n,i)+"Z",DTEND:en.format(r,i)+"Z"};const a={BEGIN:"VCALENDAR",VERSION:"2.0",CALSCALE:"GREGORIAN",PRODID:`-//Bryntum AB//Bryntum Scheduler ${K.scheduler&&K.getVersion("scheduler")||K.calendar&&K.getVersion("calendar")||""} //EN`,END:"VCALENDAR"},l=f(f(f(f({BEGIN:"VEVENT",UID:this.id+"@bryntum.com",CLASS:"PUBLIC",SUMMARY:this.name,DTSTAMP:s},o),this.recurrenceRule?{RRULE:this.recurrenceRule}:{}),e),{},{END:"VEVENT"}),c=Object.keys(a).map((e=>`${e}:${a[e]}`)),d=Object.keys(l).map((e=>`${e}:${l[e]}`));return c.splice(c.length-1,0,...d),c.join("\n")}exportToICS(e){if(this.isScheduled){const t=new Blob([this.toICSString(e)],{type:"text/calendar"});y.downloadBlob(t,(this.name||"Event")+".ics")}}isEditable(e){return!!this.getFieldDefinition(e)||void 0}isFieldModified(e){return"fullDuration"===e?super.isFieldModified("duration")||super.isFieldModified("durationUnit"):super.isFieldModified(e)}}Ev._$name="TimeSpan";const xv=/^([+-]?[0-9])?(SU|MO|TU|WE|TH|FR|SA)$/,Rv=["SU","MO","TU","WE","TH","FR","SA"];class Tv extends Te{static decodeDay(e){let t,n;return(t=xv.exec(e))&&(n=[Rv.indexOf(t[2])],t[1]&&(t[1]=parseInt(t[1],10),n.push(t[1]))),n}static encodeDay(e){let t;return Array.isArray(e)&&([e,t]=e),(t?t.toString():"")+Rv[e]}static decode(e){const t=[];let n;if(e)for(let r=0;r<e.length;r++)(n=this.decodeDay(e[r]))&&t.push(n);return t}static encode(e){const t=[];let n;if(e)for(let r=0;r<e.length;r++)(n=this.encodeDay(e[r]))&&t.push(n);return t}}Tv._$name="RecurrenceDayRuleEncoder";const Mv=/ly$/i,kv=e=>{const t=e.replace(Mv,"");return"DAI"===t?"DAY":t},Iv=(e,t,n,r)=>r.buildOccurrence(e,n),Av=e=>Fv=e;let Fv;class Ov extends Te{static processIterationConfig(e){var t;const{recurrence:n}=e,{frequency:r,interval:i,timeSpan:s,endDate:o,count:a}=n;if(!e.syncingStartDate&&!s.meta.isSyncedWithRule){const t=en.add(s.startDate,i,kv(r)),o=en.min(t,e.endDate||t);this.forEachDate({syncingStartDate:!0,startDate:s.startDate,endDate:o,recurrence:n,fn:Iv})}const l=s.startDate;let{startDate:c=l,endDate:d=o}=e;c<l&&(c=l),o?(!d||d>o)&&(d=o):a&&c>l&&(this.forEachDate({recurrence:n,fn:Av}),(!d||d>Fv)&&(d=new Date(Fv.getTime()+1)));const u=c;return e.startOnly||(c=new Date(en.max(en.add(c,-i,kv(r)),l))),Object.assign({extraArgs:[],startOnly:!Boolean(s.durationMS)},e,{startDate:c,endDate:d,timeSpan:s,timeSpanStart:l,earliestVisibleDate:u,endDateMS:null===(t=d)||void 0===t?void 0:t.getTime(),timeSpanStartMS:l.getTime(),earliestVisibleDateMS:u.getTime(),durationMS:s.durationMS,spansStart:c<=l&&d>l})}static getOccurrenceIndex(e){if(e.isOccurrence)return en.diff(e.recurringTimeSpan.startDate,e.startDate,kv(e.recurringTimeSpan.recurrence.frequency))}static getNthDayInPeriod(e,t,n,r){let i,s,o;if(r){r>0?(s=1,o=e):(s=-1,o=t);const a=n-o.getDay();s*a<0&&(r+=s),i=new Date(o),i.setDate(o.getDate()+7*(r-s)+a),(i<e||i>t)&&(i=null)}return i}static buildDate(e,t,n){const r=new Date(e,t,n);if(r.getFullYear()===e&&r.getMonth()===t&&r.getDate()===n)return r}static isValidPosition(e){return Boolean(e)}static forEachDateAtPositions(e,t,n,r){const i=e.length,s={};for(let o=0;o<t.length;o++){const a=t[o];if(this.isValidPosition(a)){const t=a>0?e[a-1]:e[i+a];if(t&&!s[t.getTime()]&&(s[t.getTime()]=!0,!1===n.call(r,t)))return!1}}}static isInView(e,t,n,r,i){return(e?t>=n:t.valueOf()+r>n)&&!i.hasException(t)}static isInViewMS(e,t,n,r,i,s){return(e?n>=r:n+i>r)&&!s.hasException(t)}}v(Ov,"frequency","NONE"),v(Ov,"MAX_OCCURRENCES_COUNT",1e6),Ov._$name="AbstractRecurrenceIterator";class Lv extends Ov{static forEachDate(e){const{startOnly:t,startDate:n,endDate:r,endDateMS:i,timeSpan:s,timeSpanStart:o,earliestVisibleDateMS:a,durationMS:l,spansStart:c,recurrence:d,fn:u,extraArgs:h,scope:g=this}=this.processIterationConfig(e),{interval:m}=d,p=n-o,f=864e5*m,v=Math.floor(p/f);let{count:y}=d,b=0,C=en.add(o,v*m,"day"),w=C.getTime();for(r||y||(y=this.MAX_OCCURRENCES_COUNT);(!i||w<i)&&(b++,!this.isInViewMS(t,C,w,a,l,s)||!(i&&w>i||!1===u.apply(g,[C,b,1===b&&c,s,...h])||y&&b>=y));)C=en.add(C,m,"day"),w=C.getTime()}}v(Lv,"frequency","DAILY"),Lv._$name="DailyRecurrenceIterator";class Pv extends Ov{static forEachDate(e){var t;const{startOnly:n,startDate:r,endDateMS:i,timeSpan:s,timeSpanStart:o,timeSpanStartMS:a,earliestVisibleDateMS:l,durationMS:c,spansStart:d,recurrence:u,fn:h,extraArgs:g,scope:m=this}=this.processIterationConfig(e),{interval:p,days:f}=u,{weekStartDay:v}=en,y=o.getHours(),b=o.getMinutes(),C=o.getSeconds(),w=o.getMilliseconds();let S,D,E=0,{count:x}=u,R=Tv.decode(f);if(null!==(t=R)&&void 0!==t&&t.length||(R=[[o.getDay()]]),v>0)for(let e=0;e<R.length;e++)v>R[e][0]?R[e][0]=7-v-R[e][0]:R[e][0]-=v;for(R.sort(((e,t)=>e[0]-t[0])),S=en.getNext(x||p>1?o:r,"week",0),i||x||(x=this.MAX_OCCURRENCES_COUNT);!i||S.getTime()<i;){for(let e=0;e<R.length;e++){D=new Date(S.getFullYear(),S.getMonth(),S.getDate()+R[e][0],y,b,C,w);const t=D.getTime();if(t>=a&&(E++,this.isInViewMS(n,D,t,l,c,s)&&(i&&t>=i||!1===h.apply(m,[D,E,1===E&&d,s,...g])||x&&E>=x)))return}S=en.getNext(S,"week",p)}}}v(Pv,"frequency","WEEKLY"),Pv._$name="WeeklyRecurrenceIterator";class $v extends Ov{static getNthDayOfMonth(e,t){const n=en.daysInMonth(e);let r=null;return t&&Math.abs(t)<=n&&(r=new Date(e.getFullYear(),e.getMonth(),t<0?n+t+1:t)),r}static isValidPosition(e){return e&&Math.abs(e)>0&&Math.abs(e)<=31}static forEachDate(e){const{startOnly:t,startDate:n,endDate:r,timeSpan:i,timeSpanStart:s,earliestVisibleDate:o,durationMS:a,spansStart:l,recurrence:c,fn:d,extraArgs:u,scope:h=this}=this.processIterationConfig(e),{interval:g,days:m,count:p,positions:f}=c,v=Tv.decode(m),y=f&&f.length,b={};let C,w,S,D,E,x,{monthDays:R}=c,T=0;for(w=en.startOf(p||g>1?s:n,"month"),S=new Date(en.getNext(w,"month",1)-1),R&&R.length||v&&v.length||(R=[s.getDate()]),v&&v.length&&v.forEach((e=>{e[1]&&(C=C||{},C[e[0]]=e[1])}));(!r||r>w)&&(!p||T<p);){if(D=[],v&&v.length){if(v.forEach((e=>{const t=e[0];let n=1,r=53;for(e[1]&&(n=r=e[1]),x=n;x<=r;x++)(E=this.getNthDayInPeriod(w,S,t,x))&&(E=en.copyTimeValues(E,s),b[E.getTime()]||(b[E.getTime()]=!0,D.push(E)))})),D.sort(((e,t)=>e-t)),!y)for(x=0;x<D.length;x++)if(E=D[x],E>=s){const e=this.isInView(t,E,o,a,i);if(T++,e&&(r&&E>=r||!1===d.apply(h,[E,T,1===T&&l,i,...u])||p&&T>=p))return!1}}else{const e=[];for(x=0;x<R.length;x++)(E=this.getNthDayOfMonth(w,R[x]))&&!b[E.getTime()]&&(b[E.getTime()]=!0,e.push(E));for(e.sort(((e,t)=>e-t)),x=0;x<e.length;x++)if(E=en.copyTimeValues(e[x],s),y)D.push(E);else if(E>=s){const e=this.isInView(t,E,o,a,i);if(T++,e&&(r&&E>r||!1===d.apply(h,[E,T,1===T&&l,i,...u])||p&&T>=p))return}}y&&D.length&&this.forEachDateAtPositions(D,f,(e=>{if(e>=s){const n=t?e>=o:e.valueOf()+a>o&&!i.hasException(e);if(T++,n&&(!r||e<=r)&&(!1===d.apply(h,[e,T,1===T&&l,i,...u])||p&&T>=p))return!1}})),w=en.getNext(w,"month",g),S=new Date(en.getNext(w,"month",1)-1)}}}v($v,"frequency","MONTHLY"),$v._$name="MonthlyRecurrenceIterator";class _v extends Ov{static forEachDate(e){const{startOnly:t,startDate:n,endDate:r,timeSpan:i,timeSpanStart:s,earliestVisibleDate:o,durationMS:a,spansStart:l,recurrence:c,fn:d,extraArgs:u,scope:h=this}=this.processIterationConfig(e),{interval:g,days:m,count:p,positions:f}=c,v=Tv.decode(m),y=f&&f.length,b={};let C,w,S,D,E,x,{months:R}=c,T=0;for(D=en.startOf(p||g>1?s:n,"year"),E=new Date(en.getNext(D,"year",1)-1),R&&R.sort(((e,t)=>e-t)),R&&R.length||v&&v.length||(R=[s.getMonth()+1]),v&&v.length&&v.forEach((e=>{e[1]&&(x=x||{},x[e[0]]=e[1])}));(!r||r>D)&&(!p||T<p);){if(S=[],v&&v.length){if(v.forEach((e=>{const t=e[0];let n=1,r=53;for(e[1]&&(n=r=e[1]),C=n;C<=r;C++)(w=this.getNthDayInPeriod(D,E,t,C))&&(w=en.copyTimeValues(w,s),b[w.getTime()]||(b[w.getTime()]=!0,S.push(w)))})),S.sort(((e,t)=>e-t)),!y)for(C=0;C<S.length;C++)if(w=S[C],w>=s){const e=this.isInView(t,w,o,a,i);if(T++,e&&(r&&w>=r||!1===d.apply(h,[w,T,1===T&&l,i,...u])||p&&T>=p))return}}else for(C=0;C<R.length;C++)if((w=this.buildDate(D.getFullYear(),R[C]-1,s.getDate()))&&(w=en.copyTimeValues(w,s),!b[w.getTime()]))if(b[w.getTime()]=!0,y)S.push(w);else if(w>=s){const e=t?w>=o:w.valueOf()+a>o&&!i.hasException(w);if(T++,e&&(r&&w>=r||!1===d.apply(h,[w,T,1===T&&l,i,...u])||p&&T>=p))return}y&&S.length&&this.forEachDateAtPositions(S,f,(e=>{if(e>=s){const n=t?e>=o:e.valueOf()+a>o&&!i.hasException(e);if(T++,n&&(!r||e<r)&&(!1===d.apply(h,[e,T,1===T&&l,i,...u])||p&&T>=p))return!1}})),D=en.getNext(D,"year",g),E=new Date(en.getNext(D,"year",1)-1)}}}v(_v,"frequency","YEARLY"),_v._$name="YearlyRecurrenceIterator";const Nv={};function Hv(e){return e?"string"==typeof e&&(e=e.split(",").map((e=>parseInt(e,10)))):e=null,e}function Bv(e){return e?"string"==typeof e&&(e=e.split(",")):e=null,e}function jv(e,t){return String(e)===String(t)}function Vv(e){return this.defaultValue&&void 0===e?this.defaultValue:this.allowNull&&null==e?null:(e=parseInt(e),isNaN(e)?void 0:e)}[Lv,Pv,$v,_v].forEach((e=>{Nv[e.frequency]=e}));class zv extends Hi{static get $name(){return"RecurrenceModel"}get isRecurrenceModel(){return!0}static get fields(){return[{name:"frequency",defaultValue:"DAILY"},{name:"interval",defaultValue:1,convert:Vv},{name:"endDate",type:"date"},{name:"count",allowNull:!0,convert:Vv},{name:"days",convert:Bv,isEqual:jv},{name:"monthDays",convert:Hv,isEqual:jv},{name:"months",convert:Hv,isEqual:jv},{name:"positions",convert:Hv,isEqual:jv}]}get dateFormat(){return this._dateFormat||"YYYYMMDDTHHmmss"}set dateFormat(e){this._dateFormat=e}get recurrenceIterator(){return Nv[this.frequency]}get timeSpan(){return this._timeSpan}set timeSpan(e){this._timeSpan=e}get rule(){const e=this,t=[];return e.frequency&&(t.push(`FREQ=${e.frequency}`),e.interval>1&&t.push(`INTERVAL=${e.interval}`),e.days&&e.days.length&&t.push("BYDAY="+e.days.join(",")),e.monthDays&&e.monthDays.length&&t.push("BYMONTHDAY="+e.monthDays.join(",")),e.months&&e.months.length&&t.push("BYMONTH="+e.months.join(",")),e.count&&t.push(`COUNT=${e.count}`),e.endDate&&t.push("UNTIL="+en.format(e.endDate,e.dateFormat)),e.positions&&e.positions.length&&t.push("BYSETPOS="+e.positions.join(","))),t.join(";")}set rule(e){const t=this,n={frequency:null,interval:null,count:null,endDate:null,days:null,monthDays:null,months:null,positions:null};if(t.beginBatch(),e){const r=e.split(";");for(let e=0,i=r.length;e<i;e++){const i=r[e].split("="),s=i[1];switch(i[0]){case"FREQ":n.frequency=s;break;case"INTERVAL":n.interval=s;break;case"COUNT":n.count=s,n.until=null;break;case"UNTIL":n.endDate=s?en.parse(s,t.dateFormat):null,n.count=null;break;case"BYDAY":n.days=s;break;case"BYMONTHDAY":n.monthDays=s;break;case"BYMONTH":n.months=s;break;case"BYSETPOS":n.positions=s}}}t.set(n),e&&t.sanitize(),t.endBatch()}construct(e={}){const t=this,{rule:n,timeSpan:r}=e;t._suspendedTimeSpanNotifying=0,delete e.timeSpan,delete e.rule,super.construct(...arguments),n&&(t.suspendTimeSpanNotifying(),t.rule=n,t.resumeTimeSpanNotifying()),t.timeSpan=r}forEachOccurrence(e,t,n){this.timeSpan.startDate&&this.recurrenceIterator.forEachDate({recurrence:this,startDate:e,endDate:t,fn(e,t,r,i){return n(i.buildOccurrence(e,r),r,t,e)}})}sanitize(){var e;const t=this,n=null===(e=t.timeSpan)||void 0===e?void 0:e.startDate,r={};switch(t.isSanitizing=!0,t.frequency){case"DAILY":r.positions=null,r.days=null,r.monthDays=null,r.months=null;break;case"WEEKLY":{r.positions=null,r.monthDays=null,r.months=null;const{days:e}=t;n&&1==(null==e?void 0:e.length)&&e[0]==Tv.encodeDay(n.getDay())&&(r.days=null);break}case"MONTHLY":{var i;null!==(i=t.monthDays)&&void 0!==i&&i.length&&(r.positions=null,r.days=null),r.months=null;const{monthDays:e}=t;n&&1==(null==e?void 0:e.length)&&e[0]==n.getDate()&&(r.monthDays=null);break}case"YEARLY":{r.monthDays=null;const{months:e}=t;n&&1==(null==e?void 0:e.length)&&e[0]==n.getMonth()+1&&(r.months=null);break}}t.set(r),t.isSanitizing=!1}copy(...e){const t=super.copy(...e);return t.dateFormat=this.dateFormat,t.timeSpan=this.timeSpan,t}afterChange(e,t,n){const r=super.afterChange(e,t,n),{timeSpan:i}=this;return this.isSanitizing||this.sanitize(),i&&(i.sanitizeRecurrenceData(this),this.isTimeSpanNotifyingSuspended||i.onRecurrenceChanged()),r}set(e,t,...n){const r="object"==typeof e?e:{[e]:t};r.count?r.endDate=null:r.endDate&&(r.count=null),super.set(r,void 0,...n)}get isTimeSpanNotifyingSuspended(){return Boolean(this._suspendedTimeSpanNotifying)}suspendTimeSpanNotifying(){this._suspendedTimeSpanNotifying++}resumeTimeSpanNotifying(){this._suspendedTimeSpanNotifying&&this._suspendedTimeSpanNotifying--}}function Wv(e){const t={},{dateFormat:n}=this;return e&&(e="string"==typeof e?e.split(","):ke.asArray(e)).forEach((e=>{"string"==typeof e&&(e=en.parse(e,n)),isNaN(e)||(t[en.makeKey(e)]=1)})),t}function Uv(e){const t=[],{dateFormat:n}=this;for(const r in e)e[r]&&t.push(en.format(en.parseKey(r),n));return t}zv._$name="RecurrenceModel";const Yv=[];var Gv=e=>class extends(e||Ev){static get $name(){return"RecurringTimeSpan"}get supportsRecurring(){return!0}static get fields(){return[{name:"recurrenceRule",internal:!0},{name:"exceptionDates",convert:Wv,serialize:Uv,internal:!0}]}remove(){if(!this.isOccurrence)return super.remove(...arguments);{const e=this,{recurringTimeSpan:t}=e;e.cancelBatch(),t.beginBatch(),e.detachFromRecurringEvent(),t.endBatch()}}get eventStore(){var e;let t=this.isOccurrence?this.recurringEvent.eventStore:super.eventStore;return!t&&null!==(e=this.firstStore)&&void 0!==e&&e.isRecurringTimeSpansMixin&&(t=this.firstStore),t}get recurrenceModel(){return this._recurrenceModel||zv}set recurrenceModel(e){this._recurrenceModel=e}setRecurrence(e,t,n){const r=this;let i;e&&(e.isRecurrenceModel||("string"==typeof e&&(e={frequency:e},t&&(e.interval=t),n&&(n instanceof Date?e.endDate=n:e.count=n)),e=new r.recurrenceModel(e)),e.timeSpan=r,i=e.rule),r.recurrence=e,r.recurrenceRule=i}get recurrence(){const e=this,t=e.recurrenceRule;return!e._recurrence&&t&&(e._recurrence=new e.recurrenceModel({rule:t,timeSpan:e,id:`${e.id}-recurrence`})),e._recurrence}set recurrence(e){const t=this;t._recurrence=e,e?(e.timeSpan=t,t.recurrenceRule=e.rule):t.isOccurrence?t.setData("recurrenceRule",null):t.recurrenceRule=null}get isRecurring(){return Boolean(!this.isOccurrence&&this.recurrence)}get isOccurrence(){return Boolean(this.recurringTimeSpan)}get recurringTimeSpan(){return this._recurringTimeSpan}get isPersistable(){return super.isPersistable&&(!this.supportsRecurring||!this.isOccurrence)}set recurringTimeSpan(e){this._recurringTimeSpan=e}getOccurrencesForDateRange(e,t=e){return this.eventStore.getOccurrencesForTimeSpan(this,e,t)}get occurrences(){if(this.isRecurring){const e=[];return this.occurrenceMap.forEach((t=>{t!==this&&e.push(t)})),e}return Yv}get occurrenceMap(){return this._occurrencesMap||(this._occurrencesMap=new Map)}removeOccurrence(e){var t;const n=e.isTimeSpan?e.occurrenceDate:e;null===(t=this.eventStore)||void 0===t||t.globalOccurrences.delete(this.createRecurrenceKey(n)),this.occurrenceMap.delete(en.makeKey(n))}removeOccurrencesFrom(e){this.occurrenceMap.forEach(((t,n)=>{en.parseKey(n)>=e&&this.removeOccurrence(t)}))}removeOccurrences(){[this,...this.occurrences].forEach((e=>this.removeOccurrence(e)))}onRecurrenceChanged(){var e;this.recurrenceRule=(null===(e=this.recurrence)||void 0===e?void 0:e.rule)||null}sanitizeRecurrenceData(e=this.recurrence){if(e.endDate){const t=en.clearTime(e.endDate),{exceptionDates:n}=this;if(this.removeOccurrencesFrom(t),n)for(const e in n)en.parseKey(e)>=t&&delete n[e]}}get occurrenceDate(){var e;return(null===(e=this.meta.modified)||void 0===e?void 0:e.startDate)||this.startDate}get occurrenceIndex(){return Ov.getOccurrenceIndex(this)}buildOccurrence(e,t){var n;const r=this,{occurrenceMap:i,recurrence:s,meta:o}=r,a=null===(n=r.eventStore)||void 0===n?void 0:n.globalOccurrences,l=en.makeKey(e),c=r.createRecurrenceKey(e,l),d=!(e-r.startDate),{fieldMap:u}=r.constructor;let h=null==a?void 0:a.get(c),{duration:g}=r;!r.endDate||!r.allDay&&g||(g=en.as(r.durationUnit,r.endDate.getTime()-r.startDate.getTime()));const m=void 0!==g?en.add(e,g,r.durationUnit):void 0;return h||(t||d?(h=r,d||(r.setStartEndDate(e,m,!0),s.suspendTimeSpanNotifying(),s.sanitize(),s.resumeTimeSpanNotifying()),o.isSyncedWithRule=!0):(h=r.copy({[u.id.dataSource]:c,[u.startDate.dataSource]:e,[u.endDate.dataSource]:m,[u.duration.dataSource]:g}),h.recurringTimeSpan=r),null==a||a.set(c,h),i.set(l,h)),h}createRecurrenceKey(e=this.startDate,t=null){return`_generated:${this.id}:${t||en.makeKey(e)}`}convertToRealEvent(e,t){var n,r;if(!this.isOccurrence)return;const i=this,{recurringTimeSpan:s,resource:o,occurrenceIndex:a,recurrence:l}=i,c=(null==e||null===(n=e.startDate)||void 0===n?void 0:n.value)||i.startDate,d=l&&s.recurrence.count,u=(null==e||null===(r=e.resourceRecords)||void 0===r?void 0:r.value)||i.data.newResource;s.beginBatch(),i.detachFromRecurringEvent(),i.clearChanges(),i.setData("id",i.generateId(s.eventStore)),u&&delete i.data.resourceId,s.eventStore.add(i,t),i.startDate=c,d&&(i.recurrence.count=d-a),(u||o)&&i.assign(u||o),u&&delete i.data.resourceRecords,e&&delete e.resourceRecords,s.endBatch()}afterChange(e,t,n,...r){const i=this,{eventStore:s}=i;return"recurrenceRule"in t&&(i._recurrence=null,null==s||s.recurringEvents[t.recurrenceRule.value?"add":"delete"](i)),i.isOccurrence?i.convertToRealEvent(t,n):"newExceptionDate"in t&&(i.meta.modified.exceptionDates=!0,delete i.meta.modified.newExceptionDate,i.removeOccurrence(t.newExceptionDate.value)),super.afterChange(e,t,n,...r)}detachFromRecurringEvent(){const e=this,{recurringTimeSpan:t,occurrenceDate:n,startDate:r}=e;e.recurringTimeSpan=null,t.addExceptionDate(n),e.recurrenceRule&&(t.recurrence.endDate=en.add(r,-1,"minute"))}set newExceptionDate(e){e&&((this.exceptionDates||(this.exceptionDates={}))[en.makeKey(e)]=1)}addExceptionDate(e){return this.set({newExceptionDate:e})}hasException(e){var t;return null===(t=this.exceptionDates)||void 0===t?void 0:t[en.makeKey(e)]}},qv=e=>class extends e{get endingDate(){const e=this,{endDate:t,startDate:n}=e;return t||en.add(n,e.duration,e.durationUnit)}},Kv=e=>class extends e{static get $name(){return"EventModelMixin"}static get isEventModel(){return!0}static get fields(){return[{name:"resourceId",internal:!0},{name:"resources",column:{type:"resourceassignment"},persist:!1,internal:!0},{name:"draggable",type:"boolean",persist:!1,defaultValue:!0,internal:!0},{name:"resizable",persist:!1,defaultValue:!0,internal:!0},{name:"allDay",type:"boolean",defaultValue:!1},{name:"eventStyle",internal:!0},{name:"eventColor",internal:!0},{name:"milestoneWidth",internal:!0},{name:"stickyContents",internal:!0}]}updateAssignmentEventIds(){this.assigned.forEach((e=>{e.eventId=this.id}))}syncId(e){super.syncId(e),this.updateAssignmentEventIds()}get resources(){return this.assignments.reduce(((e,t)=>(t.resource&&e.push(t.resource),e)),[])}set resources(e){e=ke.asArray(e);const t=this,n=e.map(t.constructor.asId);if(t.usesSingleAssignment)t.set("resourceId",n[0]);else{const e=t.assignments.map((e=>e.resource.id)),{onlyInA:r,onlyInB:i}=ke.delta(n,e);t.assignmentStore.add(r.map((e=>({resource:e,event:t})))),t.assignmentStore.remove(i.map((e=>t.assignments.find((t=>t.resource.id===e)))))}}forEachResource(e,t=this){for(const n of this.resources)if(!1===e.call(t,n))return}getResource(e){return null==e?this.resource:this.resourceStore?this.resourceStore.getById(e):null}get startDate(){let e;var t;return e=this.isOccurrence?this.get("startDate"):null!==(t=this._startDate)&&void 0!==t?t:super.startDate,this.allDay&&(e=this.constructor.getAllDayStartDate(e)),e}set startDate(e){this.batching?(this._startDate=e,this.set({startDate:e})):super.startDate=e}get endDate(){let e;var t;return e=this.isOccurrence?this.get("endDate"):null!==(t=this._endDate)&&void 0!==t?t:super.endDate,this.allDay&&(e=this.constructor.getAllDayEndDate(e)),e}set endDate(e){this.batching?(this._endDate=e,this.set({endDate:e})):super.endDate=e}get wrapStartDate(){return this.startDate}set wrapStartDate(e){}get wrapEndDate(){return this.endDate}set wrapEndDate(e){}get isEvent(){return!0}get isDraggable(){return this.draggable}get isResizable(){return!this.isMilestone&&(!this.isParent||this.manuallyScheduled)&&this.resizable}get isPersistable(){return super.isPersistable&&!this.isCreating}endBatch(){const{isPersistable:e,meta:{batchChanges:t}}=this;t&&("endDate"in t&&(delete this._endDate,this.postamble&&(this.wrapEndDate=null)),"startDate"in t&&(delete this._startDate,this.preamble&&(this.wrapStartDate=null))),super.endBatch(...arguments),this.isPersistable&&!e&&this.assignments.forEach((e=>{e.stores.forEach((t=>{t.updateModifiedBagForRecord(e)}))}))}get isCreating(){return super.isCreating}set isCreating(e){super.isCreating=e,this.assignments.forEach((t=>t.isCreating=e))}get usesSingleAssignment(){return!this.eventStore||this.eventStore.usesSingleAssignment}copy(...e){const t=super.copy(...e);return this.usesSingleAssignment||(t.resourceId=null),t}get persistableData(){const e=super.persistableData;return this.usesSingleAssignment||delete e.resourceId,e}get resource(){const{resources:e}=this;return e.length?e[0]:null}set resource(e){this.resourceId=this.constructor.asId(e)}get resourceId(){var e;return this.usesSingleAssignment?this.get("resourceId"):null===(e=this.resource)||void 0===e?void 0:e.id}set resourceId(e){this.applyResourceId(e)}get $linkedResources(){var e,t;return null!==(e=null===(t=this.resources)||void 0===t?void 0:t.flatMap((e=>[e,...e.$links])))&&void 0!==e?e:[]}applyResourceId(e,t=!1){const n=this,{assignments:r,assignmentStore:i,eventStore:s}=n;if(s)if(null!=e)if(n.meta.skipEnforcingSingleAssignment||(s.usesSingleAssignment=!0),null!=r&&r.length&&e!==r[0].resourceId){const t=Boolean(s.eventsSuspended);t&&i.suspendEvents(),r[0].resource=e,t&&i.resumeEvents()}else i.assignEventToResource(n,e);else i.remove(n.assignments);else t||n.set({resourceId:e})}applyValue(e,t,n,r,i){if(i&&"resourceId"===i.name&&!this.meta.isAssigning){const{eventStore:e}=this;e&&(e.isAssigning=!0),this.applyResourceId(n,!0),e&&(e.isAssigning=!1)}super.applyValue(e,t,n,r,i)}get assignments(){return[...this.assigned||[]]}assign(e,t=!1){const{eventStore:n}=this;n&&!n.usesSingleAssignment?n.assignEventToResource(this,e,t):(this.resourceId=this.constructor.asId(e),n||(this.meta.skipEnforcingSingleAssignment=!0))}unassign(e,t=!1){var n;const r=this;e=r.constructor.asId(e),r.meta.removingResource=t,null===(n=r.eventStore)||void 0===n||n.unassignEventFromResource(r,e),r.meta.removingResource=null}reassign(e,t){this.eventStore&&this.eventStore.reassignEventFromResourceToResource(this,e,t)}isAssignedTo(e){const t=this.constructor.asId(e);return this.assignments.some((e=>e.resourceId===t))}get predecessors(){var e;return[...null!==(e=this.incomingDeps)&&void 0!==e?e:[]]}get successors(){var e;return[...null!==(e=this.outgoingDeps)&&void 0!==e?e:[]]}get dependencies(){var e,t;return[...null!==(e=this.incomingDeps)&&void 0!==e?e:[],...null!==(t=this.outgoingDeps)&&void 0!==t?t:[]]}normalize(){}inSetNormalize(){}get recurringEvent(){return this.recurringTimeSpan}get isInterDay(){const{durationMS:e}=this;if(e>=864e5||!e&&this.allDay)return!0;const{endDate:t,startDate:n}=this,r=en.clearTime(n);return n&&t?(r.setDate(r.getDate()+1),(t||en.add(n,e))>r):void 0}static getAllDayStartDate(e){return e&&e.isEvent&&(e=e.get("startDate")),e&&(e=en.clearTime(e,!0)),e}static getAllDayEndDate(e){return e&&e.isEvent&&(e=e.get("endDate")),e&&(e.getHours()>0||e.getMinutes()>0||e.getSeconds()>0||e.getMilliseconds()>0)&&(e=en.getNext(e,"d",1)),e}static getAllDayDisplayStartDate(e){return e&&e.isEvent&&(e=e.get("startDate")),en.clearTime(e,!0)}static getAllDayDisplayEndDate(e,t){return e&&e.isEvent&&(t=e.get("endDate"),e=e.get("startDate")),t&&(e=this.constructor.getAllDayDisplayStartDate(e),en.clearTime(t,!0).valueOf()===t.valueOf()?t=en.add(t,en.DAY,-1):e.valueOf()!==t.valueOf()&&(t=en.clearTime(t,!0))),t}isEditable(e){switch(e){case"endDate":case"duration":case"fullDuration":return this.isLeaf}return super.isEditable(e)}};const Xv=Cf;class Zv extends(Xv.derive(Ev).mixin(Gv,Xf,Kv,qv)){static get $name(){return"EventModel"}}Zv.exposeProperties(),Zv._$name="EventModel";const Jv=Xf(wf.derive(Ls));class Qv extends(Jv.mixin(Cv,Dv,cv,bv,uv)){static get defaultConfig(){return{modelClass:Zv}}}v(Qv,"$name","EventStore"),Qv._$name="EventStore";const ey=["SS","SF","FS","FF"];class ty extends Hi{static get $name(){return"DependencyBaseModel"}static get Type(){return{StartToStart:0,StartToEnd:1,EndToStart:2,EndToEnd:3}}static get fields(){return[{name:"from"},{name:"to"},{name:"type",type:"int",defaultValue:2},{name:"cls",defaultValue:""},{name:"bidirectional",type:"boolean"},{name:"fromSide",type:"string"},{name:"toSide",type:"string"},{name:"lag",type:"number",allowNull:!0,defaultValue:0},{name:"lagUnit",type:"string",defaultValue:"d"},{name:"highlighted",persist:!1,internal:!0}]}construct(e){const t=e[this.fieldMap.from.dataSource],n=e[this.fieldMap.to.dataSource];null!=t&&(e.fromEvent=t),null!=n&&(e.toEvent=n),super.construct(...arguments)}get eventStore(){var e;return this.eventStore||(null===(e=this.unjoinedStores[0])||void 0===e?void 0:e.eventStore)}set from(e){const{fromEvent:t}=this;null!=t&&t.isModel&&t.id===e?this.set("from",e):this.fromEvent=e}get from(){return this.get("from")}set to(e){const{toEvent:t}=this;null!=t&&t.isModel&&t.id===e?this.set("to",e):this.toEvent=e}get to(){return this.get("to")}get hardType(){return this.getHardType()}set hardType(e){this.setHardType(e)}getHardType(){return this.get("type")}setHardType(e){let t;return e!==this.hardType&&(t=this.set({type:e,fromSide:null,toSide:null})),t}get lag(){return this.get("lag")}set lag(e){this.setLag(e)}setLag(e,t=this.lagUnit){1!==arguments.length?(e=parseFloat(e),this.set({lag:e,lagUnit:t})):"number"==typeof e?this.lag=e:(e=en.parseDuration(e),this.set({lag:e.magnitude,lagUnit:e.unit}))}getLag(){return this.lag?`${this.lag<0?"-":"+"}${Math.abs(this.lag)}${en.getShortNameOfUnit(this.lagUnit)}`:""}get fullLag(){return new Bi({unit:this.lagUnit,magnitude:this.lag})}set fullLag(e){"string"==typeof e?this.setLag(e):this.setLag(e.magnitude,e.unit)}get isPersistable(){const e=this,{stores:t,unjoinedStores:n}=e,r=t[0];let i;if(r){const{fromEvent:t,toEvent:n}=e,s=r.crudManager;i=t&&(s||!t.hasGeneratedId)&&n&&(s||!n.hasGeneratedId)}else i=Boolean(n[0]);return i&&super.isPersistable}getDateRange(){const{fromEvent:e,toEvent:t}=this;if(null!=e&&e.isScheduled&&null!=t&&t.isScheduled){const n=ty.Type;let r,i;switch(this.type){case n.StartToStart:r=e.startDateMS,i=t.startDateMS;break;case n.StartToEnd:r=e.startDateMS,i=t.endDateMS;break;case n.EndToEnd:r=e.endDateMS,i=t.endDateMS;break;case n.EndToStart:r=e.endDateMS,i=t.startDateMS;break;default:throw new Error("Invalid dependency type: "+this.type)}return{start:Math.min(r,i),end:Math.max(r,i)}}return null}highlight(e){var t,n;const r=null!==(t=null===(n=this.highlighted)||void 0===n?void 0:n.split(" "))&&void 0!==t?t:[];r.includes(e)||(this.highlighted=r.concat(e).join(" "))}unhighlight(e){const{highlighted:t}=this;if(t){const n=t.split(" "),r=n.indexOf(e);r>=0&&(n.splice(r,1),this.highlighted=n.join(" "))}}isHighlightedWith(e){return this.highlighted&&this.highlighted.split(" ").includes(e)}getConnectorString(e){const t=ey[this.type];return e?t:this.type===ty.Type.EndToStart?"":t}toString(){return`${this.from}${this.getConnectorString()}${this.getLag()}`}get isValid(){const{fromEvent:e,toEvent:t,type:n}=this;return"number"==typeof n&&e&&t&&e!==t}get fromEventName(){var e;return(null===(e=this.fromEvent)||void 0===e?void 0:e.name)||""}get toEventName(){var e;return(null===(e=this.toEvent)||void 0===e?void 0:e.name)||""}shouldRecordFieldChange(e,t,n){if(!super.shouldRecordFieldChange(e,t,n))return!1;if("from"===e||"to"===e||"fromEvent"===e||"toEvent"===e){var r;const e=null===(r=this.project)||void 0===r?void 0:r.eventStore;if(e&&e.oldIdMap[t]===e.getById(n))return!1}return!0}}ty.exposeProperties(),ty._$name="DependencyBaseModel";const ny=pf;class ry extends(Xf(ny.derive(ty))){static get $name(){return"DependencyModel"}getTypeFromSides(e,t,n){const r=ty.Type,i=n?"right":"left",s=n?"left":"right";return e===i?t===i?r.StartToStart:r.StartToEnd:t===s?r.EndToEnd:r.EndToStart}}ry.exposeProperties(),ry._$name="DependencyModel";var iy=e=>class extends e{static get $name(){return"DependencyStoreMixin"}static get defaultConfig(){return{loadPriority:400,syncPriority:400,storeId:"dependencies"}}reduceEventDependencies(e,t,n,r=!0,i){return i=i||(e=>this.getEventDependencies(e)),(e=ke.asArray(e)).reduce(((e,n)=>{n.children&&!r?n.traverse((n=>{e=i(n).reduce(t,e)})):e=i(n).reduce(t,e)}),n),n}mapEventDependencies(e,t,n,r,i){return this.reduceEventDependencies(e,((e,t)=>(n(t)&&e.push(t),e)),[],r,i)}mapEventPredecessors(e,t,n,r){return this.reduceEventPredecessors(e,((e,t)=>(n(t)&&e.push(t),e)),[],r)}mapEventSuccessors(e,t,n,r){return this.reduceEventSuccessors(e,((e,t)=>(n(t)&&e.push(t),e)),[],r)}getEventDependencies(e){return[].concat(e.predecessors||[],e.successors||[])}removeEventDependencies(e){this.remove(this.getEventDependencies(e))}removeEventPredecessors(e){this.remove(e.predecessors)}removeEventSuccessors(e,t){this.remove(e.successors)}getBySourceTargetId(e){return this.records.find((t=>e==this.constructor.makeDependencySourceTargetCompositeKey(t.from,t.to)))}getDependencyForSourceAndTargetEvents(e,t){return e=Hi.asId(e),t=Hi.asId(t),this.getBySourceTargetId(this.constructor.makeDependencySourceTargetCompositeKey(e,t))}getEventsLinkingDependency(e,t){return this.getDependencyForSourceAndTargetEvents(e,t)||this.getDependencyForSourceAndTargetEvents(t,e)}async isValidDependency(e,t,n){let r=e,i=t;return null!=e&&(e.isDependencyModel&&({fromEvent:r,toEvent:i}=e),r=this.eventStore.getById(r),i=this.eventStore.getById(i),r&&i?!(!r.project||!i.project)&&this.project.isValidDependency(r,i,n):e!==t)}isValidDependencyToCreate(e,t,n){return this.isValidDependency(e,t,n)}getHighlightedDependencies(e){return this.records.reduce(((t,n)=>(n.isHighlightedWith(e)&&t.push(n),t)),[])}static makeDependencySourceTargetCompositeKey(e,t){return`source(${e})-target(${t})`}getTimeSpanDependencies(e){return this.getEventDependencies(e)}};const sy=Xf(vf.derive(Ls));class oy extends(iy(sy.derive(Ls))){static get defaultConfig(){return{modelClass:ry}}}oy._$name="DependencyStore";var ay=e=>class extends((e||Te).mixin(Uf,Gf,qf)){static get defaultConfig(){return{project:null}}startConfigure(e){this.getConfig("project"),super.startConfigure(e),this._changesToClear=new Map}async doAutoLoad(){const{project:e}=this;return e&&await e.commitAsync(),super.doAutoLoad()}applyProjectResponse(e){const t=this,{project:n}=t;t.applyingProjectResponse=!0;const r=n.fieldMap.startDate,i=n.fieldMap.endDate,s=sn.getPath(e,r.dataSource),o=sn.getPath(e,i.dataSource);"string"==typeof s&&sn.setPath(e,r.dataSource,r.convert(s)),"string"==typeof o&&sn.setPath(e,i.dataSource,i.convert(s)),Object.assign(n,e),t.applyingProjectResponse=!1}loadCrudManagerData(e,t={}){const n=this,{project:r}=n;n.suspendChangesTracking(),super.loadCrudManagerData(...arguments),null!=e&&e.project&&(r.delayEnteringReplica?r.on("recordsUnlinked",(()=>{n.suspendChangesTracking(),n.applyProjectResponse(e.project),n.resumeChangesTracking()}),{once:!0}):n.applyProjectResponse(e.project)),n.resumeChangesTracking()}async sync(){const{project:e}=this;if(this.suspendAutoSync(),e&&await e.commitAsync(),!this.isDestroying)return this.resumeAutoSync(!1),super.sync()}async applyResponse(e,t,n){var r;const i=this;if(!(i.isDestroyed||null!==(r=i.project)&&void 0!==r&&r.isDestroyed)&&(i.trigger("startApplyResponse"),await super.applyResponse(e,t,n),null!=t&&t.project&&i.applyProjectResponse(t.project),i.project)){var s;let n=e.type;i.trackResponseType&&(n=t.type||n);const r=`propagating${_.capitalize(n)}Changes`;i[r]=!0,await i.project.commitAsync(),i[r]=!1,null===(s=i.commitRespondedChanges)||void 0===s||s.call(i)}}applySyncResponse(...e){var t;const n=this,r=null===(t=n.project)||void 0===t?void 0:t.stm.disabled;!1===r&&n.ignoreRemoteChangesInSTM&&n.project.stm.disable(),super.applySyncResponse(...e),!1===r&&n.project.stm.enable()}commitRespondedChanges(){this._changesToClear.forEach(((e,t)=>{Object.entries(e).forEach((([e,n])=>{const r=t.getFieldDefinition(e),i=t[e];(null!=r&&r.isEqual?r.isEqual(i,n):sn.isEqual(i,n))&&delete t.meta.modified[e]}))})),this._changesToClear.clear()}applyChangesToStore(e,t,n,...r){const i=super.applyChangesToStore(e,t,n,...r);if(i.size&&this.project)for(const[t,n]of i){const r=e.store.getById(t);r&&this._changesToClear.set(r,n)}return i}};class ly extends Ev{static get $name(){return"ResourceTimeRangeModel"}static get fields(){return["resourceId","timeRangeColor"]}static get relationConfig(){return[{relationName:"resource",fieldName:"resourceId",store:"resourceStore",collectionName:"timeRanges",nullFieldOnRemove:!0}]}get domId(){return`${this.constructor.domIdPrefix}-${this.id}`}get isResourceTimeRange(){return!0}get resources(){return this.resource?[this.resource]:[]}get $linkedResources(){return this.resources}}v(ly,"domIdPrefix","resourcetimerange"),ly._$name="ResourceTimeRangeModel";class cy extends Ls{static get defaultConfig(){return{loadPriority:500,syncPriority:500,resourceStore:null,modelClass:ly,storeId:"resourceTimeRanges"}}set resourceStore(e){this._resourceStore=e,this.isConfiguring||this.initRelations(!0)}get resourceStore(){return this._resourceStore}getResourcesForEvent(e){return[e.resource]}getRanges({resourceRecord:e,startDate:t,endDate:n}){return e.timeRanges.flatMap((e=>e.supportsRecurring?e.getOccurrencesForDateRange(t,n):e.intersectsRange(t,n)?e:[])).sort(((e,t)=>e.startDate-t.startDate))}}v(cy,"$name","ResourceTimeRangeStore"),cy._$name="ResourceTimeRangeStore";var dy=e=>class extends(e||Hi){static get $name(){return"ProjectModelMixin"}static get defaultConfig(){return{stm:{},timeRangeModelClass:Ev,resourceTimeRangeModelClass:ly,timeRangeStoreClass:As,resourceTimeRangeStoreClass:cy,eventStore:{},assignmentStore:{},dependencyStore:{},resourceStore:{},timeRangesData:null}}static get configurable(){return{json:null,timeRangeStore:{value:{id:"timeRanges",modelClass:Ev},$config:"nullify"},resourceTimeRangeStore:{value:{},$config:"nullify"},events:null,resources:null,assignments:null,dependencies:null,timeRanges:null,resourceTimeRanges:null}}get inlineData(){return _.safeJsonParse(super.json)}set inlineData(e){this.json=e}construct(e={}){super.construct(...arguments),e.timeRangesData&&(this.timeRangeStore.data=e.timeRangesData),e.resourceTimeRangesData&&(this.resourceTimeRangeStore.data=e.resourceTimeRangesData)}afterConstruct(){super.afterConstruct();const e=this;!e.timeRangeStore.stm&&e.stm.addStore(e.timeRangeStore),!e.resourceTimeRangeStore.stm&&e.stm.addStore(e.resourceTimeRangeStore)}attachStore(e){null==e||e.on({name:e.$$name,change:"relayStoreChange",thisObj:this})}detachStore(e){e&&this.detachListeners(e.$$name)}relayStoreChange(e){return this.trigger("change",f(f({store:e.source},e),{},{source:this}))}updateTimeRangeStore(e,t){this.detachStore(t),this.attachStore(e)}setTimeRangeStore(e){this.timeRangeStore=e}changeTimeRangeStore(e){return e&&!e.isStore&&(e=this.timeRangeStoreClass.new({modelClass:this.timeRangeModelClass},e)),e}updateResourceTimeRangeStore(e,t){this.detachStore(t),this.attachStore(e)}changeResourceTimeRangeStore(e){return e&&!e.isStore&&(e=this.resourceTimeRangeStoreClass.new({modelClass:this.resourceTimeRangeModelClass},e)),e}setResourceTimeRangeStore(e){this.resourceTimeRangeStore=e}get events(){return this.eventStore.records}updateEvents(e){this.eventStore.data=e}get resources(){return this.resourceStore.records}updateResources(e){this.resourceStore.data=e}get assignments(){return this.assignmentStore.records}updateAssignments(e){this.assignmentStore.data=e}get dependencies(){return this.dependencyStore.records}updateDependencies(e){this.dependencyStore.data=e}get timeRanges(){return this.timeRangeStore.records}updateTimeRanges(e){this.timeRangeStore.data=e}get resourceTimeRanges(){return this.resourceTimeRangeStore.records}updateResourceTimeRanges(e){this.resourceTimeRangeStore.data=e}async loadInlineData(e){return this.isLoadingInlineData=!0,e.resourceTimeRangesData&&(this.resourceTimeRangeStore.data=e.resourceTimeRangesData),e.timeRangesData&&(this.timeRangeStore.data=e.timeRangesData),super.loadInlineData(e)}toJSON(){const e=this,t={eventsData:e.eventStore.toJSON(),resourcesData:e.resourceStore.toJSON(),dependenciesData:e.dependencyStore.toJSON(),timeRangesData:e.timeRangeStore.toJSON(),resourceTimeRangesData:e.resourceTimeRangeStore.toJSON()};return e.eventStore.usesSingleAssignment||(t.assignmentsData=e.assignmentStore.toJSON()),t}get json(){return super.json}changeJson(e){return"string"==typeof e&&(e=_.safeJsonParse(e)),e}updateJson(e){e&&this.loadInlineData(e)}afterChange(e,t){super.afterChange(...arguments),t.calendar&&this.trigger("calendarChange")}doDestroy(){this.timeRangeStore.destroy(),this.resourceTimeRangeStore.destroy(),super.doDestroy()}},uy=e=>class extends e{getCurrentConfig(e){const t=this,n=super.getCurrentConfig(e);if(n){for(const r of["eventStore","resourceStore","assignmentStore","dependencyStore","timeRangeStore","resourceTimeRangeStore"]){const i=t[r];if(i){i.count&&(n[i.id+"Data"]=i.getInlineData(e));const t=i.getCurrentConfig(e);t&&Object.keys(t).length>0?n[r]=Object.assign(n[r]||{},t):n[r]&&0===Object.keys(n[r]).length&&delete n[r]}}return n.timeRangeStore&&(t.timeRangeStore.originalModelClass!==t.timeRangeModelClass&&"TimeSpan"!==t.timeRangeStore.originalModelClass.$name||delete n.timeRangeStore.modelClass,"timeRanges"===n.timeRangeStore.storeId&&delete n.timeRangeStore.storeId,1===Object.keys(n.timeRangeStore).length&&delete n.timeRangeStore),t.taskStore.isTaskStore&&(delete n.eventModelClass,delete n.eventStoreClass,delete n.children),n}}};class hy extends Te{set eventStore(e){const t=this;t.eventStoreDetacher&&t.eventStoreDetacher(),t._eventStore=e,e&&e.autoCommit&&(t.eventStoreDetacher=e.on({beforecommit:t.onEventStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get eventStore(){return this._eventStore}set resourceStore(e){const t=this;t.resourceStoreDetacher&&t.resourceStoreDetacher(),t._resourceStore=e,e&&e.autoCommit&&(t.resourceStoreDetacher=e.on({beforecommit:t.onResourceStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get resourceStore(){return this._resourceStore}set assignmentStore(e){const t=this;t.assignmentStoreDetacher&&t.assignmentStoreDetacher(),t._assignmentStore=e,e&&e.autoSync&&(t.assignmentStoreDetacher=e.on({beforecommit:t.onAssignmentStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get assignmentStore(){return this._assignmentStore}set dependencyStore(e){const t=this;t.dependencyStoreDetacher&&t.dependencyStoreDetacher(),t._dependencyStore=e,e&&e.autoSync&&(t.dependencyStoreDetacher=e.on({beforecommit:t.onDependencyStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get dependencyStore(){return this._dependencyStore}onEventStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}onResourceStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}onAssignmentStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}onDependencyStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}removeNonPersistableRecordsToCreate(e){const t=e.added||[];let n,r;for(r=t.length-1;r>=0;--r)n=t[r],n.isPersistable||t.splice(t.indexOf(n),1);0===t.length&&(e.added.length=0)}shallContinueSync(e){return Boolean(e.added&&e.added.length>0||e.modified&&e.modified.length>0||e.removed&&e.removed.length>0)}}hy._$name="ModelPersistencyManager";const gy=Tf;class my extends(uy(dy(gy))){static get $name(){return"ProjectModel"}static get defaultConfig(){return{eventModelClass:Zv,dependencyModelClass:ry,resourceModelClass:ov,assignmentModelClass:Qf,eventStoreClass:Qv,dependencyStoreClass:oy,resourceStoreClass:lv,assignmentStoreClass:nv}}construct(...e){super.construct(...e),K.isTestEnv&&(globalThis.bryntum.testProject=this),this.modelPersistencyManager=this.createModelPersistencyManager()}createModelPersistencyManager(){return new hy({eventStore:this,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore})}doDestroy(){this.modelPersistencyManager.destroy(),super.doDestroy()}get taskStore(){return this.eventStore}}my.applyConfigs=!0,my.initClass(),my._$name="ProjectModel";class py extends(Yf.mixin(ay,Gf,qf)){static get defaultConfig(){return{projectClass:my,resourceStoreClass:lv,eventStoreClass:Qv,assignmentStoreClass:nv,dependencyStoreClass:oy,resourceStore:{},eventStore:{},assignmentStore:{},dependencyStore:{},project:null}}buildProject(){return new this.projectClass(this.buildProjectConfig())}buildProjectConfig(){return sn.cleanupProperties({eventStore:this.eventStore,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore,resourceTimeRangeStore:this.resourceTimeRangeStore})}set project(e){const t=this;e!==t._project&&(t.detachListeners("beforeDataReady"),t.detachListeners("afterDataReady"),t._project=e,e&&(t.eventStore=e.eventStore,t.resourceStore=e.resourceStore,t.assignmentStore=e.assignmentStore,t.dependencyStore=e.dependencyStore,t.timeRangeStore=e.timeRangeStore,t.resourceTimeRangeStore=e.resourceTimeRangeStore,e.on({name:"beforeDataReady",dataReady:()=>t.suspendChangesTracking(),prio:100,thisObj:t}),e.on({name:"afterDataReady",dataReady:()=>t.resumeChangesTracking(),prio:-100,thisObj:t})),t.eventStore||(t.eventStore={}),t.resourceStore||(t.resourceStore={}),t.assignmentStore||(t.assignmentStore={}),t.dependencyStore||(t.dependencyStore={}))}get project(){return this._project}get timeRangeStore(){var e;return null===(e=this._timeRangeStore)||void 0===e?void 0:e.store}set timeRangeStore(e){var t;this.setFeaturedStore("_timeRangeStore",e,null===(t=this.project)||void 0===t?void 0:t.timeRangeStoreClass)}get resourceTimeRangeStore(){var e;return null===(e=this._resourceTimeRangeStore)||void 0===e?void 0:e.store}set resourceTimeRangeStore(e){var t;this.setFeaturedStore("_resourceTimeRangeStore",e,null===(t=this.project)||void 0===t?void 0:t.resourceTimeRangeStoreClass)}get resourceStore(){var e;return null===(e=this._resourceStore)||void 0===e?void 0:e.store}set resourceStore(e){this.setFeaturedStore("_resourceStore",e,this.resourceStoreClass)}get eventStore(){var e;return null===(e=this._eventStore)||void 0===e?void 0:e.store}set eventStore(e){this.setFeaturedStore("_eventStore",e,this.eventStoreClass)}get assignmentStore(){var e;return null===(e=this._assignmentStore)||void 0===e?void 0:e.store}set assignmentStore(e){this.setFeaturedStore("_assignmentStore",e,this.assignmentStoreClass)}get dependencyStore(){var e;return null===(e=this._dependencyStore)||void 0===e?void 0:e.store}set dependencyStore(e){this.setFeaturedStore("_dependencyStore",e,this.dependencyStoreClass)}setFeaturedStore(e,t,n){var r;const i=this,s=null===(r=i[e])||void 0===r?void 0:r.store;var o;return s!==t&&(t=As.getStore(t,(null===(o=t)||void 0===o?void 0:o.storeClass)||n),s&&i.removeStore(s),i[e]=t&&{store:t}||null,i.addPrioritizedStore(i[e])),i[e]}getChangesetPackage(){const e=super.getChangesetPackage();return e&&this.eventStore.usesSingleAssignment&&(delete e[this.assignmentStore.storeId],!this.crudStores.some((t=>e[t.storeId])))?null:e}get crudLoadValidationMandatoryStores(){return[this._eventStore.storeId,this._resourceStore.storeId]}}v(py,"$name","CrudManager"),py._$name="CrudManager";class fy extends Hi{static get fields(){return[{name:"name",type:"string"},{name:"rowHeight",defaultValue:24},{name:"tickWidth",defaultValue:50},{name:"tickHeight",defaultValue:50},{name:"displayDateFormat",defaultValue:"HH:mm"},{name:"shiftUnit",defaultValue:"hour"},{name:"shiftIncrement",defaultValue:1},{name:"defaultSpan",defaultValue:12},{name:"mainUnit"},{name:"start"},"timeResolution","headers","mainHeaderLevel","columnLinesFor"]}construct(e){super.construct(...arguments),this.normalizeUnits()}generateId(e){const t=this,{headers:n}=t,r=[];let i=Object.getPrototypeOf(t.data).id;if(!i){for(let{length:e}=n,t=e-1;t>=0;t--){const{unit:e,increment:i}=n[t],s=i>1;r.push(`${s?i:""}${t?e:_.capitalize(e)}${s?"s":""}`)}i=r.join("And")}return e.count&&e.includes(i)&&(i+=`-${t.tickWidth}by${t.tickHeight||t.tickWidth}`,e.includes(i)&&(i+=`-${t.bottomHeader.increment}`,e.includes(i)&&(i=Yi.generateId(`${i}-`)))),i}normalizeUnits(){const e=this,{timeResolution:t,headers:n}=e;for(let e=0,{length:t}=n;e<t;e++){const t=n[e];t.unit=en.normalizeUnit(t.unit),t.splitUnit&&(t.splitUnit=en.normalizeUnit(t.splitUnit)),"increment"in t||(n[e]=Object.assign({increment:1},t))}t&&(t.unit=en.normalizeUnit(t.unit)),e.shiftUnit&&(e.shiftUnit=en.normalizeUnit(e.shiftUnit))}static normalizeHeaderConfig(e){const{headerConfig:t,columnLinesFor:n,mainHeaderLevel:r}=e,i=e.headers=[];if(t.top&&("top"===n&&(e.columnLinesFor=0),"top"===r&&(e.mainHeaderLevel=0),i[0]=t.top),!t.middle)throw new Error("ViewPreset.headerConfig must be configured with a middle");"middle"===n&&(e.columnLinesFor=i.length),"middle"===r&&(e.mainHeaderLevel=i.length),i.push(t.middle),t.bottom&&(e.mainHeaderLevel=i.length-1,null==n?e.columnLinesFor=i.length-1:"bottom"===n&&(e.columnLinesFor=i.length),null==r&&(e.mainHeaderLevel=i.length-1),"bottom"===r&&(e.mainHeaderLevel=i.length),i.push(t.bottom))}set(){}inSet(){}get columnLinesFor(){return"columnLinesFor"in this.data?this.data.columnLinesFor:this.headers.length-1}get tickSize(){return this._tickSize||this.tickWidth}get tickWidth(){return"tickWidth"in this.data?this.data.tickWidth:50}get tickHeight(){return"tickHeight"in this.data?this.data.tickHeight:50}get headerConfig(){if(this.data.headerConfig)return this.data.headerConfig;const e={},{headers:t}=this,{length:n}=t;switch(n){case 1:e.middle=t[0];break;case 2:0===this.mainHeaderLevel?(e.middle=t[0],e.bottom=t[1]):(e.top=t[0],e.middle=t[1]);break;case 3:e.top=t[0],e.middle=t[1],e.bottom=t[2];break;default:throw new Error("headerConfig object not supported for >3 header levels")}return e}set mainHeaderLevel(e){this.data.mainHeaderLevel=e}get mainHeaderLevel(){return"mainHeaderLevel"in this.data?this.data.mainHeaderLevel:3===this.data.headers.length?1:this.headers.length-1}get mainHeader(){return this.headers[this.mainHeaderLevel]}get bottomHeader(){return this.headers[this.headers.length-1]}get leafUnit(){return this.bottomHeader.unit}get leafIncrement(){return this.bottomHeader.increment}get mainUnit(){return"mainUnit"in this.data?this.data.mainUnit:this.mainHeader.unit}get msPerPixel(){const{bottomHeader:e}=this;return Math.round(en.asMilliseconds(e.increment||1,e.unit)/this.tickWidth)}get isValid(){const e=this;let t=!0;for(const n of e.headers)t=t&&Boolean(en.normalizeUnit(n.unit));return e.timeResolution&&(t=t&&en.normalizeUnit(e.timeResolution.unit)),e.shiftUnit&&(t=t&&en.normalizeUnit(e.shiftUnit)),t}}v(fy,"$name","ViewPreset"),fy._$name="ViewPreset";class vy extends(pt(As)){static get $name(){return"PresetStore"}static get defaultConfig(){return{useRawData:!0,modelClass:fy,zoomOrder:1}}set storage(e){super.storage=e,this.storage.addSorter(((e,t)=>{const n=e.bottomHeader,r=t.bottomHeader;return(t.msPerPixel-e.msPerPixel||Zt[n.unit]-Zt[r.unit]||n.increment-r.increment)*this.zoomOrder}))}get storage(){return super.storage}getById(e){return super.getById(e)||!this.isPresetManager&&yy.getById(e)}createRecord(e,...t){let n;if(e.isViewPreset)return e;if("string"==typeof e)n=this.getById(e);else{if("number"!=typeof e){if(e.base){let t=this.getById(e.base);if(!t)throw new Error(`ViewPreset base '${e.base}' does not exist.`);t=sn.clone(t.data),delete t.id,delete t.name,e=sn.merge(t,e)}return super.createRecord(e,...t)}n=this.getAt(e)}if(!n)throw new Error(`ViewPreset ${e} does not exist`);return n}updateLocalization(){super.updateLocalization();const e=this;let t=e.allRecords;e.isPresetManager&&(t=new Set(t.concat(Object.values(e.basePresets)))),t.forEach((t=>{let n=e.optionalL(`L{PresetManager.${t.id}}`,null,!0);"string"==typeof n&&t.baseId&&(n=e.optionalL(`L{PresetManager.${t.baseId}}`,null,!0)),n&&"object"==typeof n&&(t.originalDisplayDateFormat||(t.originalDisplayDateFormat=t.displayDateFormat),0===t.mainHeaderLevel&&n.topDateFormat&&(n.middleDateFormat=n.middleDateFormat||n.topDateFormat),t.setData("displayDateFormat",n.displayDateFormat||t.originalDisplayDateFormat),["top","middle","bottom"].forEach((e=>{const r=t.headerConfig[e],i=n[e+"DateFormat"];r&&(r.originalDateFormat||(r.originalDateFormat=r.dateFormat),i&&r.renderer&&(r.renderer=null),r.dateFormat=i||r.originalDateFormat)})),n.name?(t.unlocalizedName||(t.unlocalizedName=t.name),t.setData("name",n.name)):t.unlocalizedName&&t.unlocalizedName!==t.name&&(t.name=t.unlocalizedName,t.unlocalizedName=null))}))}getCurrentConfig(e){return super.getCurrentConfig(e).data}}vy._$name="PresetStore";const yy=new class extends vy{static get $name(){return"PresetManager"}static get defaultConfig(){return{preventSubClassingModel:!0,basePresets:{secondAndMinute:{name:"Seconds",tickWidth:30,tickHeight:40,displayDateFormat:"ll LTS",shiftIncrement:10,shiftUnit:"minute",defaultSpan:24,timeResolution:{unit:"second",increment:5},headers:[{unit:"minute",dateFormat:"llll"},{unit:"second",increment:10,dateFormat:"ss"}]},minuteAndHour:{name:"Minutes",tickWidth:60,tickHeight:60,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"hour",defaultSpan:24,timeResolution:{unit:"minute",increment:30},headers:[{unit:"hour",dateFormat:"ddd MM/DD, hA"},{unit:"minute",increment:30,dateFormat:"mm"}]},hourAndDay:{name:"Day",tickWidth:70,tickHeight:40,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:24,timeResolution:{unit:"minute",increment:30},headers:[{unit:"day",dateFormat:"ddd DD/MM"},{unit:"hour",dateFormat:"LT"}]},day:{name:"Day/hours",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:1,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"day",dateFormat:"ddd DD/MM",splitUnit:"day"},{unit:"hour",renderer(e){return`\n                                    <div class="b-sch-calendarcolumn-ct"><span class="b-sch-calendarcolumn-hours">${en.format(e,"HH")}</span>\n                                    <span class="b-sch-calendarcolumn-minutes">${en.format(e,"mm")}</span></div>\n                                `}}]},week:{name:"Week/hours",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"week",defaultSpan:24,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"D d",splitUnit:"day"},{unit:"hour",dateFormat:"LT",renderer(e){return`\n                                    <div class="sch-calendarcolumn-ct">\n                                    <span class="sch-calendarcolumn-hours">${en.format(e,"HH")}</span>\n                                    <span class="sch-calendarcolumn-minutes">${en.format(e,"mm")}</span>\n                                    </div>\n                                `}}]},dayAndWeek:{name:"Days & Weeks",tickWidth:100,tickHeight:80,displayDateFormat:"ll LT",shiftUnit:"day",shiftIncrement:1,defaultSpan:5,timeResolution:{unit:"hour",increment:1},headers:[{unit:"week",renderer(e){return en.getShortNameOfUnit("week")+"."+en.format(e,"WW MMM YYYY")}},{unit:"day",dateFormat:"dd DD"}]},dayAndMonth:{name:"Month",tickWidth:100,tickHeight:80,displayDateFormat:"ll LT",shiftUnit:"month",shiftIncrement:1,defaultSpan:1,mainUnit:"month",timeResolution:{unit:"hour",increment:1},headers:[{unit:"month",dateFormat:"MMMM YYYY"},{unit:"day",dateFormat:"DD"}]},weekAndDay:{name:"Week",tickWidth:100,tickHeight:80,displayDateFormat:"ll hh:mm A",shiftUnit:"week",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"YYYY MMMM DD"},{unit:"day",increment:1,dateFormat:"DD MMM"}]},weekAndMonth:{name:"Weeks",tickWidth:100,tickHeight:105,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:5,defaultSpan:6,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"MMM YYYY"},{unit:"week",dateFormat:"DD MMM"}]},weekAndDayLetter:{name:"Weeks/weekdays",tickWidth:20,tickHeight:50,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"ddd DD MMM YYYY",verticalColumnWidth:115},{unit:"day",dateFormat:"d1",verticalColumnWidth:25}]},weekDateAndMonth:{name:"Months/weeks",tickWidth:30,tickHeight:40,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"YYYY MMMM"},{unit:"week",dateFormat:"DD"}]},monthAndYear:{name:"Months",tickWidth:110,tickHeight:110,displayDateFormat:"ll",shiftIncrement:3,shiftUnit:"month",defaultSpan:12,timeResolution:{unit:"day",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"month",dateFormat:"MMM YYYY"}]},year:{name:"Years",tickWidth:100,tickHeight:100,resourceColumnWidth:100,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"month",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"quarter",renderer(e,t,n){return en.getShortNameOfUnit("quarter").toUpperCase()+(Math.floor(e.getMonth()/3)+1)}}]},manyYears:{name:"Multiple years",tickWidth:40,tickHeight:50,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"year",increment:1},mainHeaderLevel:0,headers:[{unit:"year",increment:5,renderer:(e,t)=>e.getFullYear()+" - "+t.getFullYear()},{unit:"year",dateFormat:"YY",increment:1}]}},defaultPresets:["manyYears",{width:80,increment:1,resolution:1,base:"manyYears",resolutionUnit:"YEAR"},"year",{width:30,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},{width:50,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},{width:200,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},"monthAndYear","weekDateAndMonth","weekAndMonth","weekAndDayLetter","dayAndMonth","weekAndDay",{width:54,increment:1,resolution:1,base:"weekAndDay",resolutionUnit:"HOUR"},"hourAndDay",{width:64,increment:6,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},{width:100,increment:6,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},{width:64,increment:2,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},"minuteAndHour",{width:30,increment:15,resolution:5,base:"minuteAndHour"},{width:130,increment:15,resolution:5,base:"minuteAndHour"},{width:60,increment:5,resolution:5,base:"minuteAndHour"},{width:100,increment:5,resolution:5,base:"minuteAndHour"},"secondAndMinute",{width:60,increment:10,resolution:5,base:"secondAndMinute"},{width:130,increment:5,resolution:5,base:"secondAndMinute"}],listeners:{locale:"updateLocalization"}}}set basePresets(e){const t=this._basePresets={};for(const n in e)e[n].id=n,t[n]=this.createRecord(e[n])}get basePresets(){return this._basePresets}set defaultPresets(e){for(let t=0,{length:n}=e;t<n;t++){const n=e[t],r="string"==typeof n,i=r?n:n.base;let s;if(r)s=this.basePresets[i];else{const e=Object.setPrototypeOf(sn.clone(this.basePresets[i].data),{id:i}),{timeResolution:t}=e,r=e.headers[e.headers.length-1];e.id=void 0,"width"in n&&(e.tickWidth=n.width),"height"in n&&(e.tickHeight=n.height),"increment"in n&&(r.increment=n.increment),"resolution"in n&&(t.increment=n.resolution),"resolutionUnit"in n&&(t.unit=en.getUnitByName(n.resolutionUnit)),s=this.createRecord(e),s.baseId=i}this.add(s)}}getById(e){return super.getById(e)||this.basePresets[e]}registerPreset(e,t){const n=this.createRecord(Object.assign({id:e},t)),r=this.find((e=>e.equals(n)));if(r)return r;if(!n.isValid)throw new Error("Invalid preset, please check your configuration");return this.add(n),n}getPreset(e){return"number"==typeof e&&(e=this.getAt(e)),"string"==typeof e?e=this.getById(e):e instanceof fy||(e=this.createRecord(e)),e}normalizePreset(e){const t=this;if(!(e instanceof fy))if("string"==typeof e){if(!(e=t.getPreset(e)))throw new Error("You must define a valid view preset. See PresetManager for reference")}else if("object"==typeof e){if(e.base){const t=this.getById(e.base);if(!t)throw new Error(`ViewPreset base '${e.base}' does not exist`);e=sn.merge(sn.clone(t.data),e)}e.id?e=t.createRecord(e):(e=t.createRecord(sn.assign({},e))).id=e.generateId(e)}return e}deletePreset(e){"string"==typeof e?e=this.getById(e):"number"==typeof e&&(e=this.getAt(e)),e&&(this.remove(e),delete this.basePresets[e.id])}};class by extends Ev{get startDate(){return this.data.startDate}get endDate(){return this.data.endDate}}class Cy extends As{static get defaultConfig(){return{modelClass:by,continuous:!0,originalContinuous:null,include:null,autoAdjust:!0,adjustedStart:null,adjustedEnd:null,visibleTickStart:null,visibleTickEnd:null,tickCache:{},viewPreset:null,useRawData:{disableDuplicateIdCheck:!0,disableDefaultValue:!0,disableTypeConversion:!0}}}static get configurable(){return{generateTicks:null,unit:null,increment:null,resolutionUnit:null,resolutionIncrement:null,mainUnit:null,shiftUnit:null,shiftIncrement:1,defaultSpan:1,weekStartDay:null,forceFullTicks:null}}construct(e){const t=this;if(super.construct(e),t.originalContinuous=t.continuous,t.on({change:({action:e})=>{"filter"!==e&&t.trigger("reconfigure",{supressRefresh:!1})},refresh:()=>t.trigger("reconfigure",{supressRefresh:!1}),endreconfigure:e=>t.trigger("reconfigure",e)}),t.startDate)t.internalOnReconfigure(),t.trigger("reconfigure");else if(t.viewPreset){const e=t.getAdjustedDates(new Date);t.startDate=e.startDate,t.endDate=e.endDate}}get isTimeAxis(){return!0}reconfigure(e,t=!1,n=!1){const r=this,i=r.getAdjustedDates(e.startDate,e.endDate),s={};if(!1!==r.trigger("beforeReconfigure",{startDate:i.startDate,endDate:i.endDate,config:e})){r.trigger("beginReconfigure"),r._configuredStartDate=e.startDate,r._configuredEndDate=e.endDate;for(const t in e)s[t]=r[t];if(Object.assign(r,e),!1===r.internalOnReconfigure(n))return!1;r.trigger("endReconfigure",{suppressRefresh:t,config:e,oldConfig:s})}}internalOnReconfigure(e=!1){const t=this;t.isConfigured=!0;const n=t.getAdjustedDates(t.startDate,t.endDate,!0),r=t.getAdjustedDates(t.startDate,t.endDate),i=r.startDate,s=r.endDate;if(i>=s)throw new Error(`Invalid start/end dates. Start date must less than end date. Start date: ${i}. End date: ${s}.`);const{unit:o,increment:a=1}=t,l=t.generateTicks(i,s,o,a);t.suspendEvents(),t.data=l;const{count:c}=t;if(0===c){if(e)return t.resumeEvents(),!1;throw new Error("Invalid time axis configuration or filter, please check your input data.")}t.startDate=t.first.startDate,t.endDate=t.last.endDate,t.resumeEvents(),t.isContinuous?(t.adjustedStart=n.startDate,t.adjustedEnd=en.getNext(c>1?l[c-1].startDate:n.startDate,o,a,t.weekStartDay)):(t.adjustedStart=t.startDate,t.adjustedEnd=t.endDate),t.updateVisibleTickBoundaries(),t.updateTickCache(!0)}updateVisibleTickBoundaries(){const e=this,{count:t,unit:n,startDate:r,endDate:i,weekStartDay:s,increment:o=1}=e,a=en.getNormalizedUnitDuration(r,n)*o,l=en.getNormalizedUnitDuration(i,n)*o;do{e.visibleTickStart=(r-e.adjustedStart)/a,e.autoAdjust&&(e.visibleTickStart=Math.floor(e.visibleTickStart)),e.visibleTickStart>=1&&(e.adjustedStart=en.getNext(e.adjustedStart,n,o,s))}while(e.visibleTickStart>=1);do{e.visibleTickEnd=t-(e.adjustedEnd-i)/l,t-e.visibleTickEnd>=1&&(e.adjustedEnd=en.getNext(e.adjustedEnd,n,-1,s))}while(t-e.visibleTickEnd>=1);e.fullTicks=!e.visibleTickStart&&e.visibleTickEnd===t}get viewPreset(){return this._viewPreset}set viewPreset(e){if(!((e=yy.getPreset(e))instanceof fy))throw new Error("TimeAxis must be configured with the ViewPreset instance that the Scheduler is using");this._viewPreset=e,Object.assign(this,{unit:e.bottomHeader.unit,increment:e.bottomHeader.increment||1,resolutionUnit:e.timeResolution.unit,resolutionIncrement:e.timeResolution.increment,mainUnit:e.mainHeader.unit,shiftUnit:e.shiftUnit||e.mainHeader.unit,shiftIncrement:e.shiftIncrement||1,defaultSpan:e.defaultSpan||1,presetName:e.id,headers:e.headers})}get weekStartDay(){var e;return null!==(e=this._weekStartDay)&&void 0!==e?e:en.weekStartDay}get resolution(){return{unit:this.resolutionUnit,increment:this.resolutionIncrement}}set resolution(e){this.resolutionUnit=e.unit,this.resolutionIncrement=e.increment}get resolutionUnit(){return this.forceFullTicks?this.unit:this._resolutionUnit}get resolutionIncrement(){return this.forceFullTicks?this.increment:this._resolutionIncrement}setTimeSpan(e,t,n=!1){t&&e-t==0&&(t=null);const r=this,{startDate:i,endDate:s}=r.getAdjustedDates(e,t);if(r.startDate-i!=0||r.endDate-s!=0)return r.reconfigure({startDate:i,endDate:s},!1,n)}shift(e,t=this.shiftUnit){const n=this;let{startDate:r,endDate:i}=n;n.isFiltered&&(r=n.allRecords[0].startDate,i=n.allRecords[n.allCount-1].endDate);let s=0;do{r=en.add(r,e,t),i=en.add(i,e,t)}while(s++<100&&!1===n.setTimeSpan(r,i,{preventThrow:!0}))}shiftNext(e=this.shiftIncrement){this.shift(e)}shiftPrevious(e=this.shiftIncrement){this.shift(-e)}filterBy(e,t=this){const n=this;n.filters.clear(),super.filterBy(((n,r)=>e.call(t,n.data,r))),0===n.count&&(n.trigger("invalidFilter"),n.clearFilters())}triggerFilterEvent(e){const t=this;e.filters.count?t.continuous=!1:t.continuous=t.originalContinuous,t.updateTickCache(),super.triggerFilterEvent(e)}get isContinuous(){return!1!==this.continuous&&!this.filtered}getAdjustedDates(e,t,n=!1){const r=this;return t&&e-t==0&&(t=null),e=e||r.startDate,t=t||en.add(e,r.defaultSpan,r.mainUnit),r.autoAdjust||n?{startDate:r.floorDate(e,!1,r.autoAdjust?r.mainUnit:r.unit,1),endDate:r.ceilDate(t,!1,r.autoAdjust?r.mainUnit:r.unit,1)}:{startDate:e,endDate:t}}get startDate(){return this._start||(this.first?new Date(this.first.startDate):null)}set startDate(e){this._start=en.parse(e)}get endDate(){return this._end||(this.last?new Date(this.last.endDate):null)}set endDate(e){e&&(this._end=en.parse(e))}get startMS(){return this._startMS}get endMS(){return this._endMS}floorDate(e,t,n,r){const i=this,s=(t=!1!==t)?en.clone(i.startDate):null,o=r||i.resolutionIncrement,a=n||(t?i.resolutionUnit:i.mainUnit),l=(e,t)=>Math.floor(e/t)*t;if(t){const t=l(en.diff(s,e,a),o);return en.add(s,t,a,!1)}const c=en.clone(e);if("week"===a){const e=c.getDay()||7,t=i.weekStartDay||7;en.add(en.startOf(c,"day",!1),e>=t?t-e:-(7-t+e),"day",!1),c.getDay()!==t&&23===c.getHours()&&en.add(c,1,"hour",!1)}else{en.startOf(c,a,!1);const e=["day","year"].includes(a)?1:0,t="day"===a?"date":a,n=l(en.get(c,t)-e,o)+e;en.set(c,t,n)}return c}roundDate(e,t,n=this.resolutionUnit,r=this.resolutionIncrement||1){const i=this,s=en.clone(e);switch(t=en.clone(t||i.startDate),n){case"week":{en.startOf(s,"day",!1);let e,t=s.getDay()-i.weekStartDay;return t<0&&(t=7+t),e=1===Math.round(t/7)?7-t:-t,en.add(s,e,"day",!1)}case"month":{const e=en.diff(t,s,"month")+en.as("month",s.getDay()/en.daysInMonth(s)),n=Math.round(e/r)*r;return en.add(t,n,"month",!1)}case"quarter":return en.startOf(s,"month",!1),en.add(s,3-s.getMonth()%3,"month",!1);default:{const e=en.as(n,en.diff(t,s)),i=en.as(n,t.getTimezoneOffset()-s.getTimezoneOffset(),"minute"),o=Math.round((e+i)/r)*r;return en.add(t,o-i,n,!1)}}}ceilDate(e,t,n,r){const i=this;t=!1!==t,r=r||(t?i.resolutionIncrement:1);const s=n||(t?i.resolutionUnit:i.mainUnit),o=en.clone(e);let a=!1;switch(s){case"minute":a=!en.isStartOf(o,"minute");break;case"hour":a=!en.isStartOf(o,"hour");break;case"day":case"date":a=!en.isStartOf(o,"day");break;case"week":en.startOf(o,"day",!1),a=o.getDay()!==i.weekStartDay||!en.isEqual(o,e);break;case"month":en.startOf(o,"day",!1),a=1!==o.getDate()||!en.isEqual(o,e);break;case"quarter":en.startOf(o,"day",!1),a=o.getMonth()%3!=0||1!==o.getDate()||!en.isEqual(o,e);break;case"year":en.startOf(o,"day",!1),a=0!==o.getMonth()||1!==o.getDate()||!en.isEqual(o,e)}return a?en.getNext(o,s,r,i.weekStartDay):o}get include(){return this._include}set include(e){const t=this;t._include=e,t.continuous=!e,t.isConfiguring||(t.startDate=t._configuredStartDate,t.endDate=t._configuredEndDate,t.internalOnReconfigure(),t.trigger("includeChange"))}processExclusion(e,t,n){const{include:r}=this;return!!r&&Object.entries(r).some((([r,i])=>{if(!i)return!1;const{from:s,to:o}=i;if(en.compareUnits("day",n)>=0&&en.getLargerUnit(r)===n&&(s&&en.set(e,r,s),o)){let e=n;"day"===n&&(e="date"),en.set(t,{[e]:en.get(t,e)-1,[r]:o})}if(en.compareUnits(r,n)>=0){const t="day"===r?e.getDay():en.get(e,r);if(s&&t<s||o&&t>=o)return!0}}))}initExclusion(){Object.entries(this.include).forEach((([e,t])=>{if(t){const{from:n,to:r}=t;t.lengthFactor=en.getUnitToBaseUnitRatio(e,en.getLargerUnit(e))/(r-n),t.lengthFactorExcl=en.getUnitToBaseUnitRatio(e,en.getLargerUnit(e))/(r-n-1),t.center=n+n/(t.lengthFactor-1)}}))}updateGenerateTicks(){this.isConfiguring||this.reconfigure(this)}_generateTicks(e,t,n=this.unit,r=this.increment){const i=this,s=[],o=Boolean(i.include);let a,l,c,d=0,{startDate:u,endDate:h}=i.getAdjustedDates(e,t);for(i.tickCache={},o&&i.initExclusion();u<h;){if(a=en.getNext(u,n,r,i.weekStartDay),!i.autoAdjust&&a>h&&(a=h),"hour"===n&&r>1&&s.length>0&&0===d){const e=s[s.length-1];d=(e.startDate.getHours()+r)%24-e.endDate.getHours(),0!==d&&(a=en.add(a,d,"hour"))}c=!1,o?(l=new Date(a.getTime()),c=i.processExclusion(u,a,n)):l=a,c||(s.push({id:s.length+1,startDate:u,endDate:a}),i.tickCache[u.getTime()]=s.length-1),u=l}return s}get visibleTickTimeSpan(){const e=this;return e.isContinuous?e.visibleTickEnd-e.visibleTickStart:e.count}getTickFromDate(e){var t,n;const r=this,i=r.records,s=null!==(t=null===(n=e.getTime)||void 0===n?void 0:n.call(e))&&void 0!==t?t:e;let o,a,l,c,d=0,u=i.length-1;if(!i.length||s<i[0].startDateMS||s>i[u].endDateMS)return-1;if(r.isContinuous){for(;d<u;)o=d+u+1>>1,s>i[o].endDateMS?d=o+1:s<i[o].startDateMS?u=o-1:d=o;return a=i[d],l=a.startDateMS,s>l&&(c=a.endDateMS,d+=(s-l)/(c-l)),Math.min(Math.max(d,r.visibleTickStart),r.visibleTickEnd)}for(let e=0;e<=u;e++)if(c=i[e].endDateMS,s<=c)return l=i[e].startDateMS,a=e+(s>l?(s-l)/(c-l):0),a}getDateFromTick(e,t){const n=this;if(e===n.visibleTickEnd)return n.endDate;const r=Math.floor(e),i=e-r,s=n.getAt(r);if(!s)return null;const o=0===r?n.adjustedStart:s.startDate,a=r===n.count-1&&n.isContinuous?n.adjustedEnd:s.endDate;let l=en.add(o,i*(a-o),"millisecond");return t&&(l=n[t+"Date"](l)),l}get ticks(){return this.records}updateTickCache(e=!1){const t=this;t.count?(t._start=t.first.startDate,t._end=t.last.endDate,t._startMS=t.startDate.getTime(),t._endMS=t.endDate.getTime()):t._start=t._end=t._startMs=t._endMS=null,e||(t.tickCache={},t.forEach(((e,n)=>t.tickCache[e.startDate.getTime()]=n)))}dateInAxis(e,t=!1){const n=this,r=n.startDate,i=n.endDate;if(n.isContinuous)return t?en.betweenLesserEqual(e,r,i):en.betweenLesser(e,r,i);{const r=n.getCount();let i,s,o;for(let a=0;a<r;a++)if(o=n.getAt(a),i=o.startDate,s=o.endDate,t&&e<=s||!t&&e<s)return e>=i}return!1}timeSpanInAxis(e,t){const n=this;return t&&t.getTime()!==e.getTime()?n.isContinuous?en.intersectSpans(e,t,n.startDate,n.endDate):e<n.startDate&&t>n.endDate||n.getTickFromDate(e)!==n.getTickFromDate(t):this.dateInAxis(e,!0)}isTimeSpanInAxis(e){const t=this,{startMS:n,endMS:r}=t,{startDateMS:i,endDateMS:s}=e;if(!i||!s)return!1;if(s===i)return t.dateInAxis(e.startDate,!0);if(t.isContinuous)return s>n&&i<r;const o=t.getTickFromDate(e.startDate),a=t.getTickFromDate(e.endDate);return!(o===t.count&&en.isEqual(e.startDate,t.last.endDate)||0===a&&en.isEqual(e.endDate,t.first.startDate))&&(i<n&&s>r||o!==a)}forEachAuxInterval(e,t=1,n,r=this){const i=this.endDate;let s,o=this.startDate,a=0;if(o>i)throw new Error("Invalid time axis configuration");for(;o<i;)s=en.min(en.getNext(o,e,t,this.weekStartDay),i),n.call(r,o,s,a,s>=i),o=s,a++}}Cy._$name="TimeAxis";class wy extends(pt()){static get $name(){return"RecurrenceLegend"}static get allDaysValueAsArray(){return["SU","MO","TU","WE","TH","FR","SA"]}static get allDaysValue(){return this.allDaysValueAsArray.join(",")}static get workingDaysValue(){return this.allDaysValueAsArray.filter(((e,t)=>!en.nonWorkingDays[t])).join(",")}static get nonWorkingDaysValue(){return this.allDaysValueAsArray.filter(((e,t)=>en.nonWorkingDays[t])).join(",")}static getLegend(e,t){const n=this,{timeSpan:r,interval:i,days:s,monthDays:o,months:a,positions:l}=e,c=t||r.startDate,d={interval:i};let u;switch(e.frequency){case"DAILY":return 1===i?n.L("L{Daily}"):n.L("L{Every {0} days}",d);case"WEEKLY":return s&&s.length?d.days=n.getDaysLegend(s):c&&(d.days=en.getDayName(c.getDay())),n.L(1===i?"L{Weekly on {1}}":"L{Every {0} weeks on {1}}",d);case"MONTHLY":return s&&s.length&&l&&l.length?d.days=n.getDaysLegend(s,l):o&&o.length?(o.sort(((e,t)=>e-t)),d.days=n.arrayToText(o)):c&&(d.days=c.getDate()),n.L(1===i?"L{Monthly on {1}}":"L{Every {0} months on {1}}",d);case"YEARLY":return s&&s.length&&l&&l.length?d.days=n.getDaysLegend(s,l):d.days=c.getDate(),a&&a.length?(a.sort(((e,t)=>e-t)),u=a.length>2?e=>en.getMonthShortName(e-1):e=>en.getMonthName(e-1),d.months=n.arrayToText(a,u)):d.months=en.getMonthName(c.getMonth()),n.L(1===i?"L{Yearly on {1} of {2}}":"L{Every {0} years on {1} of {2}}",d)}}static getDaysLegend(e,t){const n=this,r={position:""};let i;if(t&&t.length&&(r.position=n.arrayToText(t,(e=>n.L(`L{position${e}}`)))),e.length)switch(e.sort(((e,t)=>Tv.decodeDay(e)[0]-Tv.decodeDay(t)[0])),e.join(",")){case n.allDaysValue:r.days=n.L("L{day}");break;case n.workingDaysValue:r.days=n.L("L{weekday}");break;case n.nonWorkingDaysValue:r.days=n.L("L{weekend day}");break;default:i=e.length>2?e=>en.getDayShortName(Tv.decodeDay(e)[0]):e=>en.getDayName(Tv.decodeDay(e)[0]),r.days=n.arrayToText(e,i)}return n.L("L{daysFormat}",r)}static arrayToText(e,t){return t&&(e=e.map(t)),e.join(", ").replace(/,(?=[^,]*$)/,this.L("L{ and }"))}}wy._$name="RecurrenceLegend";var Sy=e=>class extends e{static get $name(){return"AttachToProjectMixin"}async afterConstruct(){super.afterConstruct();const e=this,t=e.client||e.grid,{project:n}=t;t.projectSubscribers.push(e),n&&(e.attachToProject(n),e.attachToResourceStore(n.resourceStore),e.attachToEventStore(n.eventStore),e.attachToAssignmentStore(n.assignmentStore),e.attachToDependencyStore(n.dependencyStore),e.attachToCalendarManagerStore(n.calendarManagerStore))}attachToProject(e){this.detachListeners("project"),this._project=e}attachToEventStore(e){this.detachListeners("eventStore")}attachToResourceStore(e){this.detachListeners("resourceStore")}attachToAssignmentStore(e){this.detachListeners("assignmentStore")}attachToDependencyStore(e){this.detachListeners("dependencyStore")}attachToCalendarManagerStore(e){this.detachListeners("calendarManagerStore")}get project(){return this._project}get calendarManagerStore(){return this.project.calendarManagerStore}get assignmentStore(){return this.project.assignmentStore}get resourceStore(){return this.project.resourceStore}get eventStore(){return this.project.eventStore}get dependencyStore(){return this.project.dependencyStore}},Dy=e=>class extends(e||Te){static get $name(){return"ProjectConsumer"}static get declarable(){return["projectStores"]}static get configurable(){return{projectModelClass:my,project:{},destroyStores:null,projectSubscribers:[]}}startConfigure(e){this.getConfig("project"),super.startConfigure(e)}changeProject(e,t){const n=this,{projectStoreNames:r,projectDataNames:i}=n.constructor;if(n.projectCallbacks=new Set,e){if(n.buildingProjectConfig=!0,!e.isModel){if(n.isConfiguring){n._project=e;const{crudManager:t}=n;if(t){const{isCrudManager:e}=t;for(const i of r)t[i]&&(n[i]=t[i],e||delete t[i])}n.getConfig("projectStores");for(const e of i)n.getConfig(e)}const{eventStore:t}=e;t&&!t.isEventStoreMixin&&t.autoLoad&&!t.count&&(t.autoLoad=!1,n.delayAutoLoad=!0),e=n._sharedProject||new n.projectModelClass(e),delete n._project}n.buildingProjectConfig=!1}return e}updateProject(e,t){const n=this,{projectListeners:r,crudManager:i}=n;if(n.detachListeners("projectConsumer"),delete n._crudManager,e){r.thisObj=n,e.on(r),e.isCrudManager?n.crudManager=e:i&&(i.project=e,n.crudManager=i),n.projectSubscribers.forEach((t=>t.attachToProject(e)));for(const t of n.constructor.projectStoreNames)n[t]=e[t];n.delayAutoLoad&&(e.eventStore.autoLoad=!0,e.eventStore.load())}n.trigger("projectChange",{project:e})}changeCrudManager(e){if(!this.buildingProjectConfig)return super.changeCrudManager(e);this._crudManager=e.isCrudManager?e:Object.assign({},e)}onProjectDataReady(){const e=this;e.whenVisible((()=>{e.projectCallbacks.size&&(e.projectCallbacks.forEach((e=>e())),e.projectCallbacks.clear())}),null,null,"onProjectDataReady")}whenProjectReady(e){this.isEngineReady?e():this.projectCallbacks.add(e)}get isEngineReady(){var e,t;return Boolean(null===(e=(t=this.project).isEngineReady)||void 0===e?void 0:e.call(t))}doDestroy(){super.doDestroy(),this.destroyStores&&!this.project.isDestroyed&&this.project.destroy()}get projectStores(){const{projectStoreNames:e}=this.constructor;return e.map((e=>this[e]))}static get projectStoreNames(){return Object.keys(this.projectStores)}static get projectDataNames(){return this.projectStoreNames.reduce(((e,t)=>{const{dataName:n}=this.projectStores[t];return n&&e.push(n),e}),[])}static setupProjectStores(e,t){const{projectStores:n}=e;if(n){const e={name:"projectConsumer",dataReady:"onProjectDataReady",change:"relayProjectDataChange"},r={projectListeners:e};let i;for(const s in n){const{dataName:o}=n[s];r[s]=r[o]=null,o&&(Object.defineProperty(t.class.prototype,o,{configurable:!0,get(){var e;return null===(e=this.project[s])||void 0===e?void 0:e.records}}),this.createDataUpdater(s,o,i,t)),this.createStoreDescriptor(t,s,n[s],e),i=o}this.setupConfigs(t,r)}}static createDataUpdater(e,t,n,r){r.class.prototype[`update${_.capitalize(t)}`]=function(r){const{project:i}=this;n&&this.getConfig(n),this.buildingProjectConfig?i[`${t}Data`]=r:i[e].data=r}}static createStoreDescriptor(e,t,{listeners:n},r){const{prototype:i}=e.class,s=_.capitalize(t);r[`${t}Change`]=function({store:e}){this[t]=e},i[`change${s}`]=function(e,r){var i;const o=this,{project:a}=o,l=null===(i=e)||void 0===i?void 0:i.project;return o.buildingProjectConfig?(l&&l.isProjectModel&&(o._sharedProject=l),void(a[t]=e)):(o.initializingProject||a[t]!==e&&(a[`set${s}`](e),e=a[t]),e!==r&&(n&&(n.thisObj=o,n.name=`${t}Listeners`,o.detachListeners(n.name),e.on(n)),o.projectSubscribers.forEach((t=>{var n;null===(n=t[`attachTo${s}`])||void 0===n||n.call(t,e)}))),e)}}relayProjectDataChange(e){return this.trigger("dataChange",f(f({project:e.source},e),{},{source:this}))}get widgetClass(){}};class Ey extends Te{static get defaultConfig(){return{nbrOfBandsByResource:{},bandIndexToPxConvertFn:null,bandIndexToPxConvertThisObj:null}}clearCache(e){e?delete this.nbrOfBandsByResource[e.id]:this.nbrOfBandsByResource={}}applyLayout(e,t){return this.nbrOfBandsByResource[t.id]=this.layoutEventsInBands(e)}layoutEventsInBands(e){throw new Error("Implement in subclass")}}Ey._$name="HorizontalLayout";var xy=e=>class extends(e||Te){static get $name(){return"PackMixin"}static get defaultConfig(){return{coordProp:"top",sizeProp:"height",inBandCoordProp:"inBandTop",inBandSizeProp:"inBandHeight"}}isSameGroup(e,t){return!this.grouped||e.group===t.group}packEventsInBands(e,t){const n=this,{coordProp:r,sizeProp:i}=n;let s,o,a,l;for(let c=0,d=e.length;c<d;c++){if(o=e[c],s=n.findStartSlot(e,o),a=n.getCluster(e,c),a.length>1){for(o[r]=s.start,o[i]=s.end-s.start,l=1;l<a.length-1&&a[l+1].start-o.start==0;)l++;const t=n.findStartSlot(e,a[l]);t&&t.start<.8&&(a.length=l)}const d=a.length,u=(s.end-s.start)/d;for(l=0;l<d;l++)t(a[l],l,s,u);c+=d-1}return 1}findStartSlot(e,t){const{inBandSizeProp:n,inBandCoordProp:r,coordProp:i,sizeProp:s}=this,o=this.getPriorOverlappingEvents(e,t);let a;if(0===o.length)return{start:0,end:1};for(a=0;a<o.length;a++){const e=o[a],t=r in e?r:i,l=n in e?n:s;if(0===a&&e[t]>0)return{start:0,end:e[t]};if(e[t]+e[l]<(a<o.length-1?o[a+1][t]:1))return{start:e[t]+e[l],end:a<o.length-1?o[a+1][t]:1}}return!1}getPriorOverlappingEvents(e,t){const n=t.start,r=t.end,i=[];for(let s=0,o=e.indexOf(t);s<o;s++){const o=e[s];this.isSameGroup(o,t)&&en.intersectSpans(n,r,o.start,o.end)&&i.push(o)}return i.sort(this.sortOverlappers.bind(this)),i}sortOverlappers(e,t){const{coordProp:n}=this;return e[n]-t[n]}getCluster(e,t){const n=e[t],r=[n];if(t>=e.length-1)return r;let{start:i,end:s}=n;for(let o=t+1,a=e.length;o<a;o++){const t=e[o];if(!this.isSameGroup(t,n)||!en.intersectSpans(i,s,t.start,t.end))break;r.push(t),i=en.max(i,t.start),s=en.min(t.end,s)}return r}};class Ry extends(Ey.mixin(xy)){static get $name(){return"HorizontalLayoutPack"}static get configurable(){return{type:"pack"}}layoutEventsInBands(e){const t=this.packEventsInBands(e,((e,t,n,r)=>{e.height=r,e.top=n.start+t*r}));return e.forEach((e=>{Object.assign(e,this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,e.top,e.height,e.eventRecord,e.resourceRecord))})),t}}Ry._$name="HorizontalLayoutPack";class Ty extends Ey{static get $name(){return"HorizontalLayoutStack"}static get configurable(){return{type:"stack"}}layoutEventsInBands(e,t=!1){let n=0;do{let r=0,i=e[0];for(;i;)t||(i.top=this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,n,i.eventRecord,i.resourceRecord)),e.splice(r,1),r=this.findClosestSuccessor(i,e),i=e[r];n++}while(e.length>0);return n}findClosestSuccessor(e,t){const{endMS:n,group:r}=e,i=e.eventRecord&&0===e.eventRecord.duration;let s,o,a,l=1/0;for(let e=0,c=t.length;e<c;e++)if(a=t[e],o=a.startMS-n,o>=0&&o<l&&(o>0||a.endMS-a.startMS>0||!i)){if(this.grouped&&r!==a.group)break;s=e,l=o}return s}}Ty._$name="HorizontalLayoutStack";class My extends Te{static get defaultConfig(){return{minuteHeight:8,minuteTop:2,hourHeight:8,hourTop:2,handLeft:10,div:document.createElement("div"),scheduler:null,template(e){return`<div class="b-sch-clockwrap b-sch-clock-${e.mode||this.mode} ${e.cls||""}">\n                    <div class="b-sch-clock">\n                        <div class="b-sch-hour-indicator">${en.format(e.date,"MMM")}</div>\n                        <div class="b-sch-minute-indicator">${en.format(e.date,"D")}</div>\n                        <div class="b-sch-clock-dot"></div>\n                    </div>\n                    <span class="b-sch-clock-text">${_.encodeHtml(e.text)}</span>\n                </div>`}}}generateContent(e){return this.div.innerHTML=this.template(e)}updateDateIndicator(e,t){const n=null==e?void 0:e.querySelector(".b-sch-hour-indicator"),r=null==e?void 0:e.querySelector(".b-sch-minute-indicator");t&&n&&r&&y.isBrowserEnv&&("hour"===this.mode?(n.style.transform=`rotate(${t.getHours()%12*30}deg)`,r.style.transform=`rotate(${6*t.getMinutes()}deg)`):(n.style.transform="none",r.style.transform="none"))}set mode(e){this._mode=e}get mode(){if(this._mode)return this._mode;const e=en.compareUnits(this.scheduler.timeAxisViewModel.timeResolution.unit,"day")<0,t=en.formatContainsHourInfo(this.scheduler.displayDateFormat);return e&&t?"hour":"day"}set template(e){this._template=e}get template(){return this._template}}My._$name="ClockTemplate";class ky extends Wr{static get defaultConfig(){return{tooltipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    ${e.startClockHtml}\n                    ${e.endClockHtml}\n                    <div class="b-sch-tip-message">${e.message}</div>\n                </div>\n            `,showTooltip:!0,showExactDropPosition:!1,store:null,dragHelperConfig:null,tooltipCls:"b-eventdrag-tooltip"}}static get configurable(){return{constrainDragToTimeline:!0,constrainDragToResource:!0,tip:{$config:["lazy","nullify"],value:{align:{align:"b-t",allowTargetOut:!0},autoShow:!0,updateContentOnMouseMove:!0}},throttleDragEvent:!0}}static get pluginConfig(){return{chain:["onPaint"]}}internalSnapToPosition(e){var t;const{dragData:n}=this;null===(t=this.snapToPosition)||void 0===t||t.call(this,{assignmentRecord:n.assignmentRecord,eventRecord:n.eventRecord,resourceRecord:n.newResource||n.resourceRecord,startDate:n.startDate,endDate:n.endDate,snapTo:e})}buildDragHelperConfig(){const e=this,{client:t,constrainDragToTimeline:n,constrainDragToResource:r,constrainDragToTimeSlot:i,dragHelperConfig:s={}}=e,{timeAxisViewModel:o,isHorizontal:a}=t,l=a?r:i,c=a?i:r;return e.externalDropTargetSelector&&(s.dropTargetSelector=`.b-timeaxissubgrid,${e.externalDropTargetSelector}`),Y.merge({name:e.constructor.name,positioning:"absolute",lockX:c,lockY:l,minX:!0,maxX:!0,constrain:!1,cloneTarget:!n,removeProxyAfterDrop:!1,dragWithin:n?null:document.body,hideOriginalElement:!0,dropTargetSelector:".b-timelinebase",dropTargetCls:e.externalDropTargetSelector?"b-drop-target":"",outerElement:t.timeAxisSubGridElement,targetSelector:t.eventSelector,scrollManager:n?t.scrollManager:null,createProxy:e=>{const n=e.cloneNode(!0);return delete n.id,n.classList.add(`b-sch-${t.mode}`),n},snapCoordinates:({element:n,newX:r,newY:i})=>{const{dragData:s}=e;if(e.constrainDragToTimeline&&!e.constrainDragToTimeSlot&&(e.showExactDropPosition||o.snap)){const l=s.draggedEntities[0],c=e.getCoordinate(l,n,[r,i]),d=o.getDateFromPosition(c,"round"),{calendar:u}=l;if(!u||d&&u.isWorkingTime(d,en.add(d,l.fullDuration))){const e=d&&o.getPositionFromDate(d);d&&d>=t.startDate&&null!=e&&(a?r=e:i=e)}}const l={x:r,y:i};return e.internalSnapToPosition(l),l},listeners:{beforedragstart:"onBeforeDragStart",dragstart:"onDragStart",drag:"onDrag",drop:"onDrop",abort:"onDragAbort",abortFinalized:"onDragAbortFinalized",reset:"onDragReset",thisObj:e}},s,{isElementDraggable:(t,n)=>(!s||!s.isElementDraggable||s.isElementDraggable(t,n))&&e.isElementDraggable(t,n)})}onPaint({firstPaint:e}){var t;const n=this,{client:r}=n;null===(t=n.drag)||void 0===t||t.destroy(),n.drag=jc.new(n.buildDragHelperConfig()),e&&r.rowManager.on({changeTotalHeight:()=>{var e;return n.updateYConstraint(null===(e=n.dragData)||void 0===e?void 0:e[`${r.scheduledEventName}Record`])},thisObj:n}),n.showTooltip&&(n.clockTemplate=new My({scheduler:r}))}doDestroy(){var e,t,n;null===(e=this.drag)||void 0===e||e.destroy(),null===(t=this.clockTemplate)||void 0===t||t.destroy(),null===(n=this.tip)||void 0===n||n.destroy(),super.doDestroy()}get tipId(){return`${this.client.id}-event-drag-tip`}changeTip(e,t){const n=this;if(e){const r=lu.reconfigure(t,lu.mergeConfigs({forElement:n.element,id:n.tipId,getHtml:n.getTipHtml.bind(n),cls:n.tooltipCls,owner:n.client},e),{owner:n.client,defaults:{type:"tooltip"}});return r.on("innerhtmlupdate",n.updateDateIndicator,n),r}null==t||t.destroy()}onBeforeDragStart({context:e,event:t}){const n=this,{client:r}=n,i=n.getMinimalDragData(e,t),s=null==i?void 0:i[`${r.scheduledEventName}Record`],o=i.resourceRecord;if(r.readOnly||n.disabled||!s||!1===s.isDraggable||s.readOnly||null!=o&&o.readOnly)return!1;e.pointerStartDate=r.getDateFromXY([e.startClientX,e.startPageY],null,!1);const a=!1!==n.triggerBeforeEventDrag(`before${r.capitalizedEventName}Drag`,f(f({},i),{},{event:t,context:f(f({},e),i)}));var l;return a&&(n.updateYConstraint(s,o),null===(l=r[`before${r.capitalizedEventName}DragStart`])||void 0===l||l.call(r,e,i)),a}get isDragging(){return this.drag.isDragging}get isActivelyDragging(){return this.isDragging&&!this.finalizing}onDragStart({context:e,event:t}){var n,r,i;const s=this,o=null!==(n=s.findClientFromTarget(t,e))&&void 0!==n?n:s.client;s.currentOverClient=o,s.drag.unifiedProxy=s.unifiedDrag,s.onMouseOverNewTimeline(o,!0);const a=s.dragData=s.getDragData(e);if(s.suspendElementRedrawing(e.element),s.showTooltip&&s.tip){const t=a.context.dragProxy?a.context.dragProxy.firstChild:e.element;s.tip.showBy(t)}s.triggerDragStart(a),null===(r=o[`after${o.capitalizedEventName}DragStart`])||void 0===r||r.call(o,e,a);const{eventMenu:l,taskMenu:c}=o.features,d=l||c;null==d||null===(i=d.hideContextMenu)||void 0===i||i.call(d,!1)}updateDateIndicator(){const{startDate:e,endDate:t}=this.dragData,{tip:n,clockTemplate:r}=this,i=n.element.querySelector(".b-sch-tooltip-enddate");r.updateDateIndicator(n.element,e),i&&r.updateDateIndicator(i,t)}findClientFromTarget(e,t){let{target:n}=e;if(/^touch/.test(e.type)){const e=xn.from(t.element,null,!0).center;n=Mr.elementFromPoint(e.x,e.y)}const r=Ka.fromElement(n,"timelinebase");return null!=r&&r.isResourceHistogram?null:r}onDrag({context:e,event:t}){const n=this,r=n.dragData,i=r.startDate;let s;if(s=n.constrainDragToTimeline?n.client:n.findClientFromTarget(t,r.context),n.updateDragContext(e,t),s){if(s!==n.currentOverClient&&n.onMouseOverNewTimeline(s),r.dirty||!n.throttleDragEvent){const e=r.valid;n.triggerEventDrag(r,i),e!==r.valid&&(r.context.valid=r.externalDragValidity=r.valid)}n.showTooltip&&n.tip&&(n.tip.lastAlignSpec.allowTargetOut=!r.valid,n.tip.realign())}}onMouseOverNewTimeline(e,t){const n=this,{drag:{lockX:r,lockY:i}}=n,s=[];n.currentOverClient.element.classList.remove("b-dragging-"+n.currentOverClient.scheduledEventName),e.element.classList.add("b-dragging-"+e.scheduledEventName),t||n.currentOverClient.scrollManager.stopMonitoring(),r||s.push({element:e.timeAxisSubGrid.scrollable.element,direction:"horizontal"}),i||s.push({element:e.scrollable.element,direction:"vertical"}),e.scrollManager.startMonitoring({scrollables:s,callback:n.drag.onScrollManagerScrollCallback}),n.currentOverClient=e}triggerBeforeEventDropFinalize(e,t,n){n.trigger(e,t)}onDrop({context:e,event:t}){var n;const r=this,{currentOverClient:i,dragData:s}=r;let o=!1;null===(n=r.tip)||void 0===n||n.hide(),e.valid=e.valid&&r.isValidDrop(s),r.drag.removeProxyAfterDrop=Boolean(s.externalDropTarget),e.valid&&s.startDate&&s.endDate&&(s.finalize=async(...e)=>{await r.finalize(...e)},r.triggerBeforeEventDropFinalize(`before${i.capitalizedEventName}DropFinalize`,{context:s,event:t},i),e.async=s.async,e.async||s.externalDropTarget||(o=s.startDate-s.origStart!=0||s.newResource!==s.resourceRecord)),e.async||r.finalize(s.valid&&e.valid&&o)}onDragAbort({context:e}){var t;const n=this;n.client.currentOrientation.onDragAbort({context:e,dragData:n.dragData}),n.resetDraggedElements(),null===(t=n.tip)||void 0===t||t.hide(),n.triggerDragAbort(n.dragData)}onDragAbortFinalized({context:e}){var t,n;const r=this;r.triggerDragAbortFinalized(r.dragData),null===(t=(n=r.client)[`after${r.client.capitalizedEventName}DragAbortFinalized`])||void 0===t||t.call(n,e,r.dragData)}onDragReset({source:e}){var t;const n=this,r=n.currentOverClient;null==r||r.scrollManager.stopMonitoring(),null!==(t=e.context)&&void 0!==t&&t.started&&(n.resetDraggedElements(),r.trigger(`${r.scheduledEventName}DragReset`)),null==r||r.element.classList.remove("b-dragging-"+n.currentOverClient.scheduledEventName),n.dragData=null}resetDraggedElements(){const{dragData:e}=this,{eventBarEls:t,draggedEntities:n}=e;this.resumeRecordElementRedrawing(e.record),n.forEach(((e,n)=>{this.resumeRecordElementRedrawing(e),t[n].classList.remove(this.drag.draggingCls),t[n].retainElement=!1})),e.context.element.retainElement=!1}onInternalInvalidDrop(e){var t;const n=this,{context:r}=n.drag;null===(t=n.tip)||void 0===t||t.hide(),n.triggerAfterDrop(n.dragData,!1),r.valid=!1,e&&n.drag.abort()}async finalize(e){const t=this,{dragData:n}=t;if(!n)return;const{context:r,draggedEntities:i,externalDropTarget:s}=n;let o;return t.finalizing=!0,i.forEach(((e,r)=>{t.resumeRecordElementRedrawing(e),n.eventBarEls[r].classList.remove(t.drag.draggingCls),n.eventBarEls[r].retainElement=!1})),r.element.retainElement=!1,s&&n.valid||e?(o=t.updateRecords(n),!s&&Y.isPromise(o)&&(r.async=!0,await o),n.valid?(r.async&&r.finalize(),s&&t.client.refreshRows(!1),t.triggerAfterDrop(n,!0)):t.onInternalInvalidDrop(!0)):t.onInternalInvalidDrop(r.async||n.async),t.finalizing=!1,o}updateDragContext(e,t){const n=this,{drag:r}=n,i=n.dragData,s=n.currentOverClient,{isHorizontal:o}=s,[a]=i.draggedEntities,l=a.isAssignment?a.event:a,c=i.startDate,d=n.constrainDragToTimeSlot||(o?r.lockX:r.lockY);if(i.browserEvent=t,Object.assign(i,n.getProductDragContext(i)),d)i.timeDiff=0;else{if(s.timeAxis.isContinuous){var u,h;const{dateConstraints:t}=i,r=s.isHorizontal?null!==(u=e.pageX)&&void 0!==u?u:e.startPageX:null!==(h=e.pageY)&&void 0!==h?h:e.startPageY,o=s.getDateFromCoordinate(r,null,!1,!0),a=i.timeDiff=o-e.pointerStartDate;i.startDate=n.adjustStartDate(i.origStart,a),t&&(i.startDate=en.constrain(i.startDate,t.start,t.end?new Date(t.end-l.durationMS):null)),i.endDate=en.add(i.startDate,l.fullDuration)}else{const t=n.resolveStartEndDates(e.element);i.valid=Boolean(t.startDate&&t.endDate),i.valid&&(i.startDate=t.startDate,i.endDate=t.endDate)}i.valid&&(i.timeDiff=i.startDate-i.origStart)}const g=i.dirty=i.dirty||c-i.startDate!=0;if(i.valid)if(n.constrainDragToTimeline&&(i.endDate<=s.timeAxis.startDate||i.startDate>=s.timeAxis.endDate))i.valid=!1,i.context.message=n.L("L{EventDrag.noDropOutsideTimeline}");else if(g||i.externalDropTarget){const r=i.externalDragValidity=!t||e.pageX&&n.checkDragValidity(i,t);r&&"boolean"!=typeof r?(i.valid=!1!==r.valid,i.context.message=r.message):(i.valid=!1!==r,i.context.message="")}else{var m;i.valid=!1!==i.externalDragValidity&&!1!==(null===(m=i.externalDragValidity)||void 0===m?void 0:m.valid)}else i.valid=!1;i.context.valid=i.valid}suspendRecordElementRedrawing(e,t=!0){this.suspendElementRedrawing(this.getRecordElement(e),t),e.instanceMeta(this.client).retainElement=t}resumeRecordElementRedrawing(e){this.suspendRecordElementRedrawing(e,!1)}suspendElementRedrawing(e,t=!0){e&&(e.retainElement=t)}resumeElementRedrawing(e){this.suspendElementRedrawing(e,!1)}getDragData(e){const t=this,{client:n,drag:r}=t,i=t.setupProductDragData(e),{record:s,eventBarEls:o,draggedEntities:a}=i,{startEvent:l}=r,c=s.isAssignment?s.event:s,d=c.startDate,u=c.endDate,h=n.timeAxis,g=d<h.startDate,m=u>h.endDate,p=n.isSchedulerBase?n.multiEventSelect:n.selectionMode.multiSelect,v=t.getCoordinate(c,e.element,[e.elementStartX,e.elementStartY]),y=t.getCoordinate(c,e.element,[e.startClientX,e.startClientY]);t.suspendRecordElementRedrawing(s),a.forEach((e=>t.suspendRecordElementRedrawing(e))),s.isAssignment?n.selectAssignment(s,l.ctrlKey&&p):n.selectEvent(s,l.ctrlKey&&p);const b=f(f({context:e},i),{},{sourceDate:g?d:n.getDateFromCoordinate(v),screenSourceDate:n.getDateFromCoordinate(y,null,!1),startDate:d,endDate:u,timeDiff:0,origStart:d,origEnd:u,startsOutsideView:g,endsOutsideView:m,duration:u-d,browserEvent:l});return o.forEach((e=>e.classList.remove("b-sch-event-hover","b-active"))),o.length>1&&(e.relatedElements=o.slice(1)),b}setupConstraints(e,t,n,r){const i=this,s=!i.showExactDropPosition&&n>1?n:0;r?i.setXConstraint(e.left,e.right-t.width,s):i.setXConstraint(!0,!0,s),i.setYConstraint(e.top,e.bottom-t.height,0)}updateYConstraint(e,t){const n=this,{client:r}=n,{context:i}=n.drag,s=r.timeAxisViewModel.snapPixelAmount;if(i&&!n.drag.lockY){let o;if(!n.constrainDragToTimeline)return void n.setYConstraint(null,null,s);o=r.getScheduleRegion(t,e),n.setYConstraint(o.top,o.bottom-i.element.offsetHeight,s)}else n.setYConstraint(null,null,s)}setXConstraint(e,t,n){const{drag:r}=this;r.minX=e,r.maxX=t}setYConstraint(e,t,n){const{drag:r}=this;r.minY=e,r.maxY=t}adjustStartDate(e,t){return this.client.timeAxis.roundDate(new Date(e-0+t),!!this.client.snapRelativeToEventStartDate&&e)}resolveStartEndDates(e){const t=this.currentOverClient,{timeAxis:n}=t,r=xn.from(e,t.timeAxisSubGridElement),i=this.dragData,[s]=i.draggedEntities,{fullDuration:o}=s.isAssignment?s.event:s;let{start:a,end:l}=t.getStartEndDatesFromRectangle(r,"round",o,!n.isContinuous);if(a&&l)if(a=this.adjustStartDate(a,0),i.startsOutsideView)i.endsOutsideView||(a=l&&en.add(l,-o));else{if(!n.dateInAxis(a,!1)){const e=n.getTickFromDate(a);e>=0&&(a=n.getDateFromTick(e))}l=a&&en.add(a,o)}return{startDate:a,endDate:l}}getTipHtml(){const e=this,{dragData:t,client:n,tooltipTemplate:r}=e,{startDate:i,endDate:s,draggedEntities:o}=t,a=n.getFormattedDate(i),l=n.getFormattedEndDate(s,i),{valid:c,message:d,element:u,dragProxy:h}=t.context,g=h?h.firstChild:u,m=o[0],p=m.isTask?m:m.event;return e.tip.lastAlignSpec.target=g,r({valid:c,startDate:i,endDate:s,startText:a,endText:l,dragData:t,message:d||"",[n.scheduledEventName+"Record"]:p,startClockHtml:e.clockTemplate.template({date:i,text:a,cls:"b-sch-tooltip-startdate"}),endClockHtml:p.isMilestone?"":e.clockTemplate.template({date:s,text:l,cls:"b-sch-tooltip-enddate"})})}set constrainDragToTimeSlot(e){const t=this.client.isHorizontal?"lockX":"lockY";this._constrainDragToTimeSlot=e,this.drag&&(this.drag[t]=e)}get constrainDragToTimeSlot(){return this._constrainDragToTimeSlot}updateConstrainDragToResource(e){const t=this;if(t.drag){const{constrainDragToTimeSlot:n}=t,{isHorizontal:r}=t.client;e&&(t.constrainDragToTimeline=!0),t.drag.lockY=r?e:n,t.drag.lockX=r?n:e}}updateConstrainDragToTimeline(e){this.isConfiguring||Object.assign(this.drag,{cloneTarget:!e,dragWithin:e?null:document.body,scrollManager:e?this.client.scrollManager:null})}getElementFromContext(e){return e.grabbed||e.dragProxy||e.element}getRelatedRecords(e){return[]}getMinimalDragData(e,t){return{}}isValidDrop(e){throw new Error("Implement in subclass")}checkDragValidity(e){throw new Error("Implement in subclass")}updateRecords(e){throw new Error("Implement in subclass")}isElementDraggable(e,t){throw new Error("Implement in subclass")}getCoordinate(e,t,n){throw new Error("Implement in subclass")}setupProductDragData(e){throw new Error("Implement in subclass")}getProductDragContext(e){throw new Error("Implement in subclass")}getRecordElement(e){throw new Error("Implement in subclass")}}ky._$name="DragBase";const Iy={top:"b-t",right:"b100-t100",bottom:"t-b",left:"b0-t0"};class Ay extends(Wr.mixin(bd,Cd)){static get $name(){return"EventResize"}static get configurable(){return{draggingItemCls:"b-sch-event-wrap-resizing",resizingItemInnerCls:"b-sch-event-resizing",leftHandle:!0,rightHandle:!0,topHandle:!0,bottomHandle:!0,handleSize:10,dynamicHandleSize:!0,allowResizeToZero:null,reservedSpace:5,touchHandleSize:30,dragThreshold:0,dragTouchStartDelay:0,draggingClsSelector:".b-timeline-base",showTooltip:!0,showExactResizePosition:!1,validatorFn:()=>!0,validatorFnThisObj:null,tip:{$config:["lazy","nullify"],value:{autoShow:!1,axisLock:!0,trackMouse:!1,updateContentOnMouseMove:!0,hideDelay:0}},tooltipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    ${e.startClockHtml}\n                    ${e.endClockHtml}\n                    <div class="b-sch-tip-message">${e.message}</div>\n                </div>\n            `,ignoreSelector:".b-sch-terminal",dragActiveCls:"b-resizing-event"}}static get pluginConfig(){return{chain:["render","onEventDataGenerated","isEventElementDraggable"]}}doDestroy(){var e;super.doDestroy(),null===(e=this.dragging)||void 0===e||e.destroy()}render(){const e=this,{client:t}=e;e.dragSelector=e.dragItemSelector=t.eventSelector,e.dragRootElement=e.dropRootElement=t.timeAxisSubGridElement,e.handleSelector||y.isHoverableDevice||(e.handleSize=e.touchHandleSize),e.handleVisibilityThreshold=e.handleVisibilityThreshold||2*e.handleSize,e.dragLock=t.isVertical?"y":"x"}isEventElementDraggable(e,t,n,r){const i=this,s=null==t?void 0:t.resizable;return!(!i.disabled&&s&&!t.isMilestone)||(!0!==s&&"start"!==s||!i.isOverStartHandle(r,e))&&(!0!==s&&"end"!==s||!i.isOverEndHandle(r,e))}onEventDataGenerated({eventRecord:e,wrapperCls:t,cls:n}){var r,i;e===(null===(r=this.dragging)||void 0===r||null===(i=r.context)||void 0===i?void 0:i.eventRecord)&&(t["b-active"]=t[this.draggingItemCls]=t["b-over-resize-handle"]=n["b-resize-handle"]=n[this.resizingItemInnerCls]=1)}onDragPointerMove(e){var t;const{client:n,dragging:r}=this,{visibleDateRange:i,isHorizontal:s}=n,o=s&&n.rtl,a=s?"X":"Y",l=globalThis[`page${a}Offset`],c=e[`page${a}`]+((null===(t=r.context)||void 0===t?void 0:t.offset)||0),d=xn.from(n.timeAxisSubGridElement,null,!0),u=d.getStart(o,s),h=d.getEnd(o,s);let g=n.getDateFromCoord({coord:c,local:!1});o?c-l>u?g=i.startDate:c<h&&(g=i.endDate):c-l<u?g=i.startDate:c-l>h&&(g=i.endDate),r.clientStartCoord=u,r.clientEndCoord=h,r.date=g,super.onDragPointerMove(e)}get isResizing(){return Boolean(this.dragging)}beforeDrag(e){const{client:t}=this,n=t.resolveTimeSpanRecord(e.itemElement),r=!t.isGanttBase&&t.resolveResourceRecord(t.isVertical?e.startEvent:e.itemElement);return!(this.disabled||t.readOnly||null!=r&&r.readOnly||n&&(n.readOnly||!n.project&&!n.isOccurrence)||!1===super.beforeDrag(e))&&(e.mousedownDate=e.date=t.getDateFromCoordinate(e.event["page"+(t.isHorizontal?"X":"Y")],null,!1),this.triggerBeforeResize(e))}dragStart(e){var t,n;const r=this,{client:i,tip:s}=r,{startEvent:o,itemElement:a}=e,l=i.scheduledEventName,c=i.resolveEventRecord(a),{isBatchUpdating:d,wrapStartDate:u,wrapEndDate:h}=c,g=null===(t=i.features.eventBuffer)||void 0===t?void 0:t.enabled,m=d?c.get("startDate"):c.startDate,p=d?c.get("endDate"):c.endDate,v="x"===r.dragLock,y=v&&i.rtl,b=r.isOverEndHandle(o,a),C=b?"endDate":"startDate",w=g?b?"wrapEndDate":"wrapStartDate":null,S=b?"startDate":"endDate",D=b?"setEndDate":"setStartDate",E=b?"setStartDate":"setEndDate",x=xn.from(a),R=v?o.clientX:o.clientY,T=b?x.getEnd(y,v):x.getStart(y,v),M=e.context={eventRecord:c,element:a,timespanRecord:c,taskRecord:c,owner:r,valid:!0,oldValue:b?p:m,startDate:m,endDate:p,offset:g?0:T-R,edge:v?b?"right":"left":b?"bottom":"top",finalize:r.finalize,event:e.event,originalStartDate:m,originalEndDate:p,wrapStartDate:u,wrapEndDate:h,draggingEnd:b,toSet:C,wrapToSet:w,otherEnd:S,setMethod:D,setOtherMethod:E};c.meta.isResizing=!0,i.element.classList.add(...r.dragActiveCls.split(" ")),i.listenToBatchedUpdates||i.beginListeningForBatchedUpdates(),d||r.beginEventRecordBatch(c),r.setupProductResizeContext(M,o),r.triggerEventResizeStart(`${l}ResizeStart`,f({[`${l}Record`]:c,event:o},r.getResizeStartParams(M)),M),M.resizedRecord=(null===(n=i.resolveAssignmentRecord)||void 0===n?void 0:n.call(i,M.element))||c,s&&(s.show(),s.align=Iy[M.edge],s.showBy(r.getTooltipTarget(e)))}triggerBeforeResize(e){const{client:t}=this,n=t.resolveTimeSpanRecord(e.itemElement);return t.trigger(`before${t.capitalizedEventName}Resize`,f({[`${t.scheduledEventName}Record`]:n,event:e.event},this.getBeforeResizeParams({event:e.startEvent,element:e.itemElement})))}triggerEventResizeStart(e,t,n){var r,i;this.client.trigger(e,t),null===(r=(i=this.client)[`after${_.capitalize(e)}`])||void 0===r||r.call(i,n,t)}triggerEventResizeEnd(e,t){this.client.trigger(e,t)}triggerEventPartialResize(e,t){this.client.trigger(e,t)}triggerBeforeEventResizeFinalize(e,t){this.client.trigger(e,t)}dragEnter(e){var t;return(null===(t=e.context)||void 0===t?void 0:t.owner)===this}resizeEventPartiallyInternal(e,t){var n;const{client:r}=this,{toSet:i}=t;if(null!==(n=r.features.eventBuffer)&&void 0!==n&&n.enabled)if("startDate"===i){const n=t.startDate.getTime()-t.originalStartDate.getTime();e.wrapStartDate=new Date(t.wrapStartDate.getTime()+n)}else if("endDate"===i){const n=t.endDate.getTime()-t.originalEndDate.getTime();e.wrapEndDate=new Date(t.wrapEndDate.getTime()+n)}e.set(i,t[i])}applyDateConstraints(e,t,n){var r,i;const s=null===(r=n.dateConstraints)||void 0===r?void 0:r.start,o=null===(i=n.dateConstraints)||void 0===i?void 0:i.end;return(s||o)&&(e=en.constrain(e,s,o),n.snappedDate=en.constrain(n.snappedDate,s,o)),e}moveDrag(e){const t=this,{client:n,tip:r}=t,i="x"===t.dragLock,s=i?"X":"Y",o=n.scheduledEventName,{visibleDateRange:a,enableEventAnimations:l,timeAxis:c,weekStartDay:d}=n,u=i&&n.rtl,{resolutionUnit:h,resolutionIncrement:g}=c,{event:m,context:p}=e,{eventRecord:f}=p,v=p.offset*(u?-1:1),{isOccurrence:y}=f,b=f.get("startDate"),C=f.get("endDate"),w=m[`client${s}`]+v,S=xn.from(n.timeAxisSubGridElement,null,!0),D=S.getStart(u,i),E=S.getEnd(u,i);p.event=m,m.isScroll&&(e.date=n.getDateFromCoordinate(m[`page${s}`]+v,null,!1));let x,R,{date:T}=e,{toSet:M,otherEnd:k,draggingEnd:I}=p;u?w>D?T=e.date=a.startDate:w<E&&(T=e.date=a.endDate):w<D?T=e.date=a.startDate:w>E&&(T=e.date=a.endDate),"endDate"===M?T<b&&(x=-1):T>C&&(x=1),x&&t.onDragEndSwitch&&(t.onDragEndSwitch(p,T,x),k=p.otherEnd,M=p.toSet),n.snapRelativeToEventStartDate&&(T=c.roundDate(T,p.oldValue)),p.snappedDate=en.round(T,c.resolution,null,d);const A=en.diff(T,p[k],h)*(I?-1:1);if(t.isEventDragCreate)p.tooNarrow=A<g/2;else if(A<g)if(t.allowResizeToZero)p.snappedDate=T=p[k];else{const e="startDate"===k?1:-1;p.snappedDate=T=c.roundDate(en.add(f.get(k),g*e,h)),R=!0}if(T=t.applyDateConstraints(T,f,p),!p.date||T-p.date||R){if(p.date=T,p[M]=t.showExactResizePosition||n.timeAxisViewModel.snap?p.snappedDate:T,!(p[M]-p["startDate"===M?"endDate":"startDate"]||t.allowResizeToZero))return void(p.valid=!1);if(f.get(M)-p[M]){if(p.valid=t.checkValidity(p,m),p.message="",p.valid&&"boolean"!=typeof p.valid&&(p.message=p.valid.message,p.valid=p.valid.valid),p.valid=!1!==p.valid,p.valid){const r={[`${o}Record`]:f,startDate:b,endDate:C,element:e.itemElement,context:p};r[M]=p[M],t.triggerEventPartialResize(`${o}PartialResize`,r),y&&f.stores.push(n.eventStore),n.enableEventAnimations=!1,this.resizeEventPartiallyInternal(f,p),n.enableEventAnimations=l,y&&(f.stores.length=0)}p.tooNarrow&&(p.valid=!1)}}r&&(r.align=Iy[p.edge],r.alignTo(t.getTooltipTarget(e))),super.moveDrag(e)}dragEnd(e){const{context:t}=e;t&&(t.event=e.event),e.aborted?null==t||t.finalize(!1):this.isEventDragCreate||e.started||_n.getPagePoint(e.event).equals(_n.getPagePoint(e.startEvent))||(this.dragStart(e),this.cleanup(e.context,!1))}async dragDrop({context:e,event:t}){var n;e[e.toSet]=e.snappedDate;const{client:r}=this,{startDate:i,endDate:s}=e;let o;null===(n=this.tip)||void 0===n||n.hide(),e.valid=i&&s&&(this.allowResizeToZero||s-i>0)&&e[e.toSet]-e.oldValue&&!1!==e.valid,e.valid&&(this.triggerBeforeEventResizeFinalize(`before${r.capitalizedEventName}ResizeFinalize`,{context:e,event:t,[`${r.scheduledEventName}Record`]:e.eventRecord}),o=!0),e.async||await e.finalize(o)}async finalize(e){const t=this.owner,n=this,{eventRecord:r,oldValue:i,toSet:s}=n,{snapRelativeToEventStartDate:o,timeAxis:a}=t.client;let l=!1;e?(o&&(n[s]=n.snappedDate=a.roundDate(n.date,i)),l=await t.internalUpdateRecord(n,r)):(t.cancelEventRecordBatch(r),r.isOccurrence&&r.resources.forEach((e=>t.client.repaintEventsForResource(e)))),t.cleanup(n,l)}cleanup(e,t){var n;const r=this,{client:i}=r,{element:s,eventRecord:o}=e,a=i.scheduledEventName;o.meta.isResizing=!1,i.endListeningForBatchedUpdates(),null===(n=r.tip)||void 0===n||n.hide(),r.unHighlightHandle(s),i.element.classList.remove(...r.dragActiveCls.split(" ")),r.triggerEventResizeEnd(`${a}ResizeEnd`,f({changed:t,[`${a}Record`]:o},r.getResizeEndParams(e)))}async internalUpdateRecord(e,t){const{client:n}=this,{generation:r}=t;if(t.isOccurrence)n.endListeningForBatchedUpdates(),t[t.batching>1?"endBatch":"cancelBatch"](),t.set(Ev.prototype.inSetNormalize.call(t,{startDate:e.startDate,endDate:e.endDate}));else{const r={[e.toSet]:e[e.toSet]};if(t.isEntity){var i;const{startDate:s,endDate:o,draggingEnd:a}=e;e.duration=r.duration=t.run("calculateProjectedDuration",s,o),r[e.toSet]=t.run("calculateProjectedXDateWithDuration",a?s:o,a,e.duration);const l=!t[e.otherEnd];l&&(r[e.otherEnd]=e[e.otherEnd]),t.set(r),n.endListeningForBatchedUpdates(),this.cancelEventRecordBatch(t),null!==(i=n.features.eventBuffer)&&void 0!==i&&i.enabled&&(t[e.wrapToSet]=null);const c=[];l&&c.push(t[e.setOtherMethod](r[e.otherEnd],!1)),c.push(t[e.setMethod](r[e.toSet],!1)),await Promise.all(c),t.endBatch()}else{const i=Object.assign({},t.meta.batchChanges);delete i[e.toSet],n.endListeningForBatchedUpdates(),this.cancelEventRecordBatch(t),t.set(i),t[e.setMethod](r[e.toSet],!1)}}return await n.project.commitAsync(),t.generation!==r}onDragItemMouseMove(e){"touch"===e.pointerType||this.handleSelector||this.checkResizeHandles(e)}checkResizeHandles(e){const t=this,{overItem:n}=t;if(n&&!t.client.readOnly&&(!t.allowResize||t.allowResize(n,e))){const r=t.client.resolveTimeSpanRecord(n);if(null!=r&&r.readOnly)return;t.isOverAnyHandle(e,n)?t.highlightHandle():t.unHighlightHandle()}}onDragItemMouseLeave(e,t){this.unHighlightHandle(t)}highlightHandle(){var e,t;const{overItem:n,client:r}=this;(null!==(e=null===(t=n.syncIdMap)||void 0===t?void 0:t[r.scheduledEventName])&&void 0!==e?e:n.querySelector(r.eventInnerSelector)).classList.add("b-resize-handle"),n.classList.add("b-over-resize-handle")}unHighlightHandle(e=this.overItem){if(e){var t,n;const r=this,i=null!==(t=null===(n=e.syncIdMap)||void 0===n?void 0:n[r.client.scheduledEventName])&&void 0!==t?t:e.querySelector(r.client.eventInnerSelector);i&&i.classList.remove("b-resize-handle",r.resizingItemInnerCls),e.classList.remove("b-over-resize-handle",r.draggingItemCls)}}isOverAnyHandle(e,t){return this.isOverStartHandle(e,t)||this.isOverEndHandle(e,t)}isOverStartHandle(e,t){return"x"===this.dragLock?this[`isOver${this.client.rtl?"Right":"Left"}Handle`](e,t):this.isOverTopHandle(e,t)}isOverEndHandle(e,t){return"x"===this.dragLock?this[`isOver${this.client.rtl?"Left":"Right"}Handle`](e,t):this.isOverBottomHandle(e,t)}getDynamicHandleSize(e,t){const n=e?2:1,{handleSize:r}=this;return this.dynamicHandleSize&&r*n>t-this.reservedSpace?Math.max(Math.floor((t-this.reservedSpace)/n),0):r}isOverLeftHandle(e,t){var n;const r=this;null!==(n=r.client.features.eventBuffer)&&void 0!==n&&n.enabled&&(t=t.querySelector(`.${r.client.eventCls}`));const{offsetWidth:i}=t,s=r.client.resolveTimeSpanRecord(t),o=null==s?void 0:s.isResizable;if(!r.disabled&&r.leftHandle&&(i>=r.handleVisibilityThreshold||r.dynamicHandleSize)&&(!0===o||"start"===o)){const n=xn.from(t);return n.width=r.getDynamicHandleSize(r.rightHandle,i),n.width>0&&n.contains(_n.getPagePoint(e))}return!1}isOverRightHandle(e,t){var n;const r=this;null!==(n=r.client.features.eventBuffer)&&void 0!==n&&n.enabled&&(t=t.querySelector(`.${r.client.eventCls}`));const{offsetWidth:i}=t,s=r.client.resolveTimeSpanRecord(t),o=null==s?void 0:s.isResizable;if(!r.disabled&&r.rightHandle&&(i>=r.handleVisibilityThreshold||r.dynamicHandleSize)&&(!0===o||"end"===o)){const n=xn.from(t);return n.x=Math.floor(n.right-r.getDynamicHandleSize(r.leftHandle,i)),n.width>0&&n.contains(_n.getPagePoint(e))}return!1}isOverTopHandle(e,t){var n;const r=this;null!==(n=r.client.features.eventBuffer)&&void 0!==n&&n.enabled&&(t=t.querySelector(`.${r.client.eventCls}`));const{offsetHeight:i}=t,s=r.client.resolveTimeSpanRecord(t),o=null==s?void 0:s.isResizable;if(!r.disabled&&r.topHandle&&(i>=r.handleVisibilityThreshold||r.dynamicHandleSize)&&(!0===o||"start"===o)){const n=xn.from(t);return n.height=r.getDynamicHandleSize(r.bottomHandle,i),n.height>0&&n.contains(_n.getPagePoint(e))}return!1}isOverBottomHandle(e,t){var n;const r=this;null!==(n=r.client.features.eventBuffer)&&void 0!==n&&n.enabled&&(t=t.querySelector(`.${r.client.eventCls}`));const{offsetHeight:i}=t,s=r.client.resolveTimeSpanRecord(t),o=null==s?void 0:s.isResizable;if(!r.disabled&&r.bottomHandle&&(i>=r.handleVisibilityThreshold||r.dynamicHandleSize)&&(!0===o||"end"===o)){const n=xn.from(t);return n.y=Math.floor(n.bottom-r.getDynamicHandleSize(r.bottomHandle,i)),n.height>0&&n.contains(_n.getPagePoint(e))}return!1}setupDragContext(e){const t=this;if(t.overItem&&t.isOverAnyHandle(e,t.overItem)&&t.isElementResizable(t.overItem,e)){const n=super.setupDragContext(e);return n.scrollManager=t.client.scrollManager,n}}changeTip(e,t){const n=this;if(!n.showTooltip)return null;if(e)e.isTooltip?e.owner=n:e=lu.reconfigure(t,lu.mergeConfigs({id:n.tipId},e,{getHtml:n.getTipHtml.bind(n),owner:n.client},n.tip),{owner:n,defaults:{type:"tooltip"}}),e.on({innerhtmlupdate:"updateDateIndicator",thisObj:n}),n.clockTemplate=new My({scheduler:n.client});else if(t){var r;t.destroy(),null===(r=n.clockTemplate)||void 0===r||r.destroy()}return e}isElementResizable(e,t){var n,r;const i=this,{client:s}=i,o=s.resolveTimeSpanRecord(e);if(s.readOnly)return!1;let a=null==o?void 0:o.isResizable;const l=null!==(n=null===(r=e)||void 0===r?void 0:r.syncIdMap[s.scheduledEventName])&&void 0!==n?n:e,c=t.target.closest('[class$="-handle"]');if(!a||c&&c!==l)return!1;const d=(e=t.target.closest(i.dragSelector)).classList.contains("b-sch-event-startsoutside"),u=e.classList.contains("b-sch-event-endsoutside");if(!0===a){if(d&&u)return!1;if(d)a="end";else{if(!u)return i.isOverStartHandle(t,e)||i.isOverEndHandle(t,e);a="start"}}return!(d&&"start"===a||u&&"end"===a||!(i.isOverStartHandle(t,e)&&"start"===a||i.isOverEndHandle(t,e)&&"end"===a))}updateDateIndicator(){const{clockTemplate:e}=this,{eventRecord:t,draggingEnd:n,snappedDate:r}=this.dragging.context,i=n?t.get("startDate"):r,s=n?r:t.get("endDate"),{element:o}=this.tip;e.updateDateIndicator(o.querySelector(".b-sch-tooltip-startdate"),i),e.updateDateIndicator(o.querySelector(".b-sch-tooltip-enddate"),s)}getTooltipTarget({itemElement:e,context:t}){const n=this,{rtl:r}=n.client,i=xn.from(e,null,!0);return"x"===n.dragLock?(!r&&"right"===t.edge||r&&"left"===t.edge?i.x=i.right-1:i.x-=n.tip.anchorSize[0]/2,i.width=n.tip.anchorSize[0]/2):("bottom"===t.edge&&(i.y=i.bottom-1),i.height=n.tip.anchorSize[1]/2),{target:i}}basicValidityCheck(e,t){return e.startDate&&(e.endDate>e.startDate||this.allowResizeToZero)&&this.validatorFn.call(this.validatorFnThisObj||this,e,t)}getTipHtml({tip:e}){const t=this,{startDate:n,endDate:r,toSet:i,snappedDate:s,valid:o,message:a="",timespanRecord:l}=t.dragging.context;if(!n||!r)return e.html;const c={record:l,valid:o,message:a,startDate:n,endDate:r,[i]:s};return c.startText=t.client.getFormattedDate(c.startDate),c.endText=t.client.getFormattedDate(c.endDate),c.startClockHtml=t.clockTemplate.template({date:c.startDate,text:c.startText,cls:"b-sch-tooltip-startdate"}),c.endClockHtml=t.clockTemplate.template({date:c.endDate,text:c.endText,cls:"b-sch-tooltip-enddate"}),t.tooltipTemplate(c)}beginEventRecordBatch(e){e.beginBatch()}cancelEventRecordBatch(e){e.cancelBatch()}getBeforeResizeParams(e){const{client:t}=this;return{resourceRecord:t.resolveResourceRecord(t.isVertical?e.event:e.element)}}getResizeStartParams(e){return{resourceRecord:e.resourceRecord}}getResizeEndParams(e){return{resourceRecord:e.resourceRecord,event:e.event}}setupProductResizeContext(e,t){var n,r,i;const{client:s}=this,{element:o}=e,a=s.resolveEventRecord(o),l=null===(n=s.resolveResourceRecord)||void 0===n?void 0:n.call(s,o),c=null===(r=s.resolveAssignmentRecord)||void 0===r?void 0:r.call(s,o);Object.assign(e,{eventRecord:a,taskRecord:a,resourceRecord:l,assignmentRecord:c,dateConstraints:null===(i=s.getDateConstraints)||void 0===i?void 0:i.call(s,l,a)})}checkValidity(e,t){return(this.client.allowOverlap||this.client.isDateRangeAvailable(e.startDate,e.endDate,e.eventRecord,e.resourceRecord))&&this.basicValidityCheck(e,t)}get tipId(){return`${this.client.id}-event-resize-tip`}}Ay._$name="EventResize",vg.registerFeature(Ay,!0,"Scheduler"),vg.registerFeature(Ay,!1,"ResourceHistogram");const Fy=function(e){var t,n;return(null===(t=this.source)||void 0===t||null===(n=t.client.features.taskEdit)||void 0===n||!n._canceling)&&_n.getDistanceBetween(this.startEvent,e)};class Oy extends Ay{construct(e,t){!1===(null==t?void 0:t.showTooltip)&&(t.tip=null),super.construct(...arguments)}changeValidatorFn(e){this.createValidatorFn=e}render(){const e=this,{client:t}=e;e.dragRootElement=e.dropRootElement=t.timeAxisSubGridElement,e.dragLock=t.isVertical?"y":"x"}onDragEndSwitch(e){const{client:t}=this,{enableEventAnimations:n}=t,{eventRecord:r,draggingEnd:i}=e,s="x"===this.dragLock,{initialDate:o}=this.dragging;t.enableEventAnimations=!1,r.set({startDate:o,endDate:o}),i?Object.assign(e,{endDate:o,toSet:"startDate",otherEnd:"endDate",setMethod:"setStartDate",setOtherMethod:"setEndDate",edge:s?"left":"top"}):Object.assign(e,{startDate:o,toSet:"endDate",otherEnd:"startDate",setMethod:"setEndDate",setOtherMethod:"setStartDate",edge:s?"right":"bottom"}),e.draggingEnd=this.draggingEnd=!i,t.enableEventAnimations=n}beforeDrag(e){const t=this,n=super.beforeDrag(e),{pan:r,eventDragSelect:i}=t.client.features;return(!1===n||!(t.preventMultiple&&!t.isRowEmpty(e.rowRecord)||t.disabled||r&&!r.disabled||i&&!i.disabled))&&n}startDrag(e){const t=super.startDrag(e);if(!1!==t){const{context:t}=e;e.initialDate=t.eventRecord.get(this.draggingEnd?"startDate":"endDate"),this.client.trigger("dragCreateStart",{proxyElement:e.element,eventElement:e.element,eventRecord:t.eventRecord,resourceRecord:t.resourceRecord}),e.context.offset=0,e.context.oldValue=e.mousedownDate}return t}isOverEndHandle(){return this.draggingEnd}setupDragContext(e){const{client:t}=this;if(t.matchScheduleCell(e.target)){var n;const r=null===(n=t.resolveResourceRecord(e))||void 0===n?void 0:n.$original;if(r&&!r.isSpecialRow){const n=bd().prototype.setupDragContext.call(this,e),i=[];return t.isVertical?i.push({element:t.scrollable.element,direction:"vertical"}):i.push({element:t.timeAxisSubGrid.scrollable.element,direction:"horizontal"}),n.scrollManager=t.scrollManager,n.monitoringConfig={scrollables:i},n.resourceRecord=n.rowRecord=r,n.getDistance=Fy,n}}}async dragDrop({context:e,event:t}){var n;e[e.toSet]=e.snappedDate;const{client:r}=this,{startDate:i,endDate:s,eventRecord:o}=e,{generation:a}=o;let l;null===(n=this.tip)||void 0===n||n.hide(),await r.project.commitAsync(),o.generation!==a&&(e.eventRecord[e.toSet]=e.oldValue,e.eventRecord[e.toSet]=e[e.toSet]),e.valid=i&&s&&s-i>0&&e[e.toSet]-e.oldValue&&!1!==e.valid,e.valid&&(r.trigger("beforeDragCreateFinalize",{context:e,event:t,proxyElement:e.element,eventElement:e.element,eventRecord:e.eventRecord,resourceRecord:e.resourceRecord}),l=!0),e.async||await e.finalize(l)}updateDragTolerance(e){this.dragThreshold=e}changeTip(e,t){return super.changeTip(!e||e.isTooltip?e:sn.assign({id:`${this.client.id}-drag-create-tip`},e),t)}async finalize(e){const t=this.owner,n=this,r=()=>{t.isDestroyed||(t.client.trigger("afterDragCreate",{proxyElement:n.element,eventElement:n.element,eventRecord:n.eventRecord,resourceRecord:n.resourceRecord}),t.cleanup(n))};var i;e?(await t.finalizeDragCreate(n),r()):(null===(i=t.onAborted)||void 0===i||i.call(t,n),r())}async finalizeDragCreate(e){var t;await this.internalUpdateRecord(e,e.eventRecord),this.client.trigger("dragCreateEnd",{eventRecord:e.eventRecord,resourceRecord:e.resourceRecord,event:e.event,eventElement:e.element}),null===(t=this.client)||void 0===t||t.trigger("eventAutoCreated",{eventRecord:e.eventRecord,resourceRecord:e.resourceRecord})}cleanup(e){var t;const{client:n}=this,{eventRecord:r}=e;r.meta.isResizing=!1,n.endListeningForBatchedUpdates(),null===(t=this.tip)||void 0===t||t.hide(),n.element.classList.remove(...this.dragActiveCls.split(" "))}onElementContextMenu(){if(this.proxy)return!1}prepareCreateContextForFinalization(e,t,n,r=!1){return f(f({},e),{},{async:r,event:t,finalize:n})}onEventDataGenerated(e){var t,n;(null===(t=this.dragging)||void 0===t||null===(n=t.context)||void 0===n?void 0:n.eventRecord)===e.eventRecord&&(e.wrapperCls["b-sch-dragcreating"]=!0,e.wrapperCls["b-too-narrow"]=this.dragging.context.tooNarrow)}triggerBeforeResize(){}triggerEventResizeStart(){}checkValidity(e,t){throw new Error("Implement in subclass")}triggerDragCreateEnd(e,t){throw new Error("Implement in subclass")}handleBeforeDragCreate(e,t){throw new Error("Implement in subclass")}isRowEmpty(e){throw new Error("Implement in subclass")}}v(Oy,"configurable",{showTooltip:!0,dragTolerance:2,preventMultiple:!1,dragTouchStartDelay:300,validatorFnThisObj:null,proxyCls:"b-sch-dragcreator-proxy",tipTemplate:e=>`\n            <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                ${e.startClockHtml}\n                ${e.endClockHtml}\n                <div class="b-sch-tip-message">${e.message}</div>\n            </div>\n        `,dragActiveCls:"b-dragcreating"}),v(Oy,"pluginConfig",{chain:["render","onEventDataGenerated"],before:["onElementContextMenu"]}),Oy._$name="DragCreateBase";const Ly=en,Py=["startDate","endDate","resource","recurrenceRule"],$y=e=>{if(1===e.length)return e[0].value;if(2===e.length){const[t,n]=e[0]instanceof Nu?e:e.reverse(),r=Ly.parse(t.value);return r&&n.value&&r.setHours(n.value.getHours(),n.value.getMinutes(),n.value.getSeconds(),n.value.getMilliseconds()),r?en.clone(r):null}return null},_y=(e,t,n)=>{if(e&&t&&n.endDateField&&n.endTimeField){const e=Ly.add(((e,t)=>{const n=new Date(e.getTime());return n.setHours(t.getHours(),t.getMinutes()),n})(n.startDateField.value,n.startTimeField.value),n.eventRecord.durationMS,"milliseconds");n.endDateField.value=e,n.endTimeField.value=Ly.clone(e)}};class Ny extends Wr{static get configurable(){return{saveAndCloseOnEnter:!0,triggerEvent:null,dateFormat:"L",timeFormat:"LT",editorConfig:null,items:null,weekStartDay:null}}construct(e,t){const n=this;e.eventEdit=n,super.construct(e,sn.assign({weekStartDay:e.weekStartDay},t)),n.clientListenersDetacher=e.on({[n.triggerEvent]:"onActivateEditor",dragCreateEnd:"onDragCreateEnd",eventAutoCreated:"onEventAutoCreated",thisObj:n})}doDestroy(){var e;this.clientListenersDetacher(),null===(e=this._editor)||void 0===e||e.destroy(),super.doDestroy()}onEventAutoCreated(){}changeEditorConfig(e){const{items:t}=this;return t&&((e=Y.clone(e)).items=ae.merge(t,e.items)),e}changeItems(e){return this.cleanItemsConfig(e),e}cleanItemsConfig(e){for(const t in e){const n=e[t];!0===n?delete e[t]:null!=n&&n.items&&this.cleanItemsConfig(n.items)}}onDatesChange(e){var t,n;const r=this,i=e.source,s=e.value;var o,a;switch(r.startDateField&&r.endDateField&&(r.endDateField.min=r.startDateField.value),r.endTimeField&&(Ly.isEqual(Ly.clearTime(null===(o=r.startDateField)||void 0===o?void 0:o.value),Ly.clearTime(null===(a=r.endDateField)||void 0===a?void 0:a.value))?r.endTimeField.min=r.startTimeField.value:r.endTimeField.min=null),i.ref){case"startDateField":(null===(t=r.startTimeField)||void 0===t?void 0:t.value)&&_y(s,r.startTimeField.value,r);break;case"startTimeField":(null===(n=r.startDateField)||void 0===n?void 0:n.value)&&_y(r.startDateField.value,s,r)}}async save(){throw new Error("Implement in subclass")}get values(){const e=this,{editor:t}=e,n=[],r=[],{values:i}=t;return Py.forEach((e=>delete i[e])),t.eachWidget((s=>{var o;const{name:a}=s;if(!a||s.hidden||s.up((t=>t===e.recurrenceEditor)))delete i[a];else switch(a){case"startDate":n.push(s);break;case"endDate":r.push(s);break;case"resource":i[a]=s.record;break;case"recurrenceRule":i[a]="none"===(null===(o=t.widgetMap.recurrenceCombo)||void 0===o?void 0:o.value)?"":s.value}}),!0),i.allDay&&!e.eventRecord.allDay&&(n.push(e.startTimeField),r.push(e.endTimeField)),n.length&&(i.startDate=$y(n)),r.length&&(i.endDate=$y(r)),"startDate"in i&&"endDate"in i&&(i.duration=Ly.diff(i.startDate,i.endDate,e.editor.record.durationUnit,!0)),i}onBeforeSave(e){}onAfterSave(e){}updateRecord(e){const{values:t}=this;return this.assignmentStore&&delete t.resource,e.set(t)}onBeforeEditorShow(){const{eventRecord:e,editor:t}=this.editingContext,{nameField:n}=t.widgetMap;n&&e.isCreating&&(t.assigningValues=!0,n.value="",t.assigningValues=!1,n._configuredPlaceholder=n.placeholder,n.placeholder=e.name)}resetEditingContext(){const e=this,{eventRecord:t,client:n}=e,{eventStore:r}=n,{nameField:i}=e.editor.widgetMap;var s;t.isCreating&&(n.isTimelineBase&&(null===(s=e.editingContext.eventElement)||void 0===s||s.closest("[data-event-id]").classList.add("b-released")),r.remove(t),t.isCreating=!1);i&&(i.placeholder=i._configuredPlaceholder),e.targetEventElement=null,n.element.classList.remove("b-eventeditor-editing")}onPopupKeyDown({event:e}){const t=this;!t.readOnly&&"Enter"===e.key&&t.saveAndCloseOnEnter&&"input"===e.target.tagName.toLowerCase()&&(e.preventDefault(),"startDate"===e.target.name&&t.startTimeField&&_y(t.startDateField.value,t.startTimeField.value,t),t.onSaveClick())}async onSaveClick(){this.editor.focus();const e=await this.save();return e&&(this.editor.close(),this.client.trigger("afterEventEdit")),e}async onDeleteClick(){if(await this.deleteEvent()){const{editor:e}=this;e.autoClose&&!e.containsFocus||e.close(),this.client.trigger("afterEventEdit")}}onCancelClick(){this.editor.close(),this.client.trigger("afterEventEdit")}}Ny._$name="EditBase";class Hy extends(Wr.mixin(Sy)){static get pluginConfig(){return{chain:["getEventsToRender","onEventDataGenerated","noFeatureElementsInAxis"],override:["resolveResourceRecord"]}}noFeatureElementsInAxis(){const{timeAxis:e}=this.client;return!this.needsRefresh&&this.store&&!this.store.storage.values.some((t=>e.isTimeSpanInAxis(t)))}doDisable(e){this.client.isPainted&&this.client.refresh(),super.doDisable(e)}updateTabIndex(){this.isConfiguring||this.client.refresh()}getEventsToRender(e,t){throw new Error("Implement in subclass")}onEventDataGenerated(e){const t=this,{eventRecord:n,iconCls:r}=e;t.shouldInclude(n)&&(t.client.isVertical?e.width=e.resourceRecord.columnWidth||t.client.resourceColumnWidth:e.top=0,e.fillSize=!0,e.wrapperCls[t.rangeCls]=1,e.wrapperCls[`b-sch-color-${n.timeRangeColor}`]=n.timeRangeColor,e.eventContent.text=n.name,e.children.push(e.eventContent),e.tabIndex=null!=t.tabIndex?String(t.tabIndex):null,(null==r?void 0:r.length)>0&&e.children.unshift({tag:"i",className:r.toString()}),e.eventId=t.generateElementId(n))}generateElementId(e){return e.domId}resolveResourceTimeRangeRecord(e){var t;return null==e||null===(t=e.closest(`.${this.rangeCls}`))||void 0===t?void 0:t.elementData.eventRecord}getElementFromResourceTimeRangeRecord(e){return this.client.foregroundCanvas.syncIdMap[e.domId]}resolveResourceRecord(e){var t;return this.overridden.resolveResourceRecord(...arguments)||(null===(t=this.resolveResourceTimeRangeRecord(e.target||e))||void 0===t?void 0:t.resource)}shouldInclude(e){throw new Error("Implement in subclass")}onStoreChange(e){"removeall"!==e.action&&"dataset"!==e.action||(this.needsRefresh=!0),this.client.onInternalEventStoreChange(e),this.needsRefresh=!1}}v(Hy,"configurable",{tabIndex:null}),Hy.featureClass="",Hy._$name="ResourceTimeRangesBase";class By extends _c{}By._$name="TimeSpanMenuBase";class jy extends Wr{static get defaultConfig(){return{autoUpdate:!1,hoverDelay:250,hideDelay:100,template:null,cls:null,align:{align:"b-t"},clockTemplate:null,monitorRecordUpdate:null,testConfig:{hoverDelay:0}}}static get pluginConfig(){return{chain:["onPaint"]}}construct(e,t){const n=this;t=n.processConfig(t),super.construct(e,t),n.forSelector||(n.forSelector=`${e.eventInnerSelector}:not(.b-dragproxy)`),n.clockTemplate=new My({scheduler:e}),e.on({[`before${e.scheduledEventName}drag`]:()=>{var e;return null===(e=n.tooltip)||void 0===e?void 0:e.hide()}})}processConfig(e){return"function"==typeof e?{template:e}:e}setConfig(e){super.setConfig(this.processConfig(e))}doDestroy(){this.destroyProperties("clockTemplate","tooltip"),super.doDestroy()}doDisable(e){this.tooltip&&(this.tooltip.disabled=e),super.doDisable(e)}onPaint({firstPaint:e}){if(e){var t;const e=this,{client:n}=e,r=[".b-dragselecting",".b-eventeditor-editing",".b-taskeditor-editing",".b-resizing-event",".b-dragcreating",`.b-dragging-${n.scheduledEventName}`,".b-creating-dependency",".b-dragproxy"].map((e=>`:not(${e})`)).join("");null===(t=e.tooltip)||void 0===t||t.destroy(),e.tooltip=new lu(f(f({axisLock:"flexible",id:e.tipId||`${e.client.id}-event-tip`,cls:e.tipCls,forSelector:`.b-timelinebase${r} .b-grid-body-container:not(.b-scrolling) ${e.forSelector}`,scrollAction:"realign",forElement:n.timeAxisSubGridElement,showOnHover:!0,anchorToTarget:!0,getHtml:e.getTipHtml.bind(e),disabled:e.disabled},e.config),{},{listeners:e.configuredListeners})),e.tooltip.on({innerhtmlupdate:"updateDateIndicator",overtarget:"onOverNewTarget",show:"onTipShow",hide:"onTipHide",thisObj:e})}}processConfiguredListeners(){}addListener(...e){var t;const n=super.addListener(...e),r=null===(t=this.tooltip)||void 0===t?void 0:t.addListener(...e);if(n||r)return()=>{null==n||n(),null==r||r()}}removeListener(...e){var t;super.removeListener(...e),null===(t=this.tooltip)||void 0===t||t.removeListener(...e)}updateDateIndicator(){const e=this,t=e.tooltip,n=t.element.querySelector(".b-sch-tooltip-enddate");e.record&&(e.clockTemplate.updateDateIndicator(t.element,e.record.startDate),n&&e.clockTemplate.updateDateIndicator(n,e.record.endDate))}resolveTimeSpanRecord(e){return this.client.resolveTimeSpanRecord(e)}getTipHtml({tip:e,activeTarget:t}){const n=this,{client:r}=n,i=n.recordType||`${r.scheduledEventName}Record`,s=n.resolveTimeSpanRecord(t);if((null==s?void 0:s.startDate)instanceof Date){const{startDate:t,endDate:o}=s,a=r.getFormattedDate(t),l=r.getDisplayEndDate(o,t),c=r.getFormattedDate(l);return e.eventRecord=s,n.template({tip:e,[`${i}`]:s,startDate:t,endDate:o,startText:a,endText:c,startClockHtml:n.clockTemplate.template({date:t,text:a,cls:"b-sch-tooltip-startdate"}),endClockHtml:s.isMilestone?"":n.clockTemplate.template({date:l,text:c,cls:"b-sch-tooltip-enddate"})})}return e.hide(),""}get record(){return this.tooltip.eventRecord}onTipShow(){const e=this;e.monitorRecordUpdate&&!e.updateListener&&(e.updateListener=e.client.eventStore.on({update:e.onRecordUpdate,thisObj:e}))}onTipHide(){var e;this.tooltip.eventRecord=null,null===(e=this.updateListener)||void 0===e||e.call(this),this.updateListener=null}onOverNewTarget({newTarget:e}){this.tooltip.eventRecord=this.resolveTimeSpanRecord(e)}onRecordUpdate({record:e}){e===this.record&&(this.tooltip.alignTo(),this.tooltip.updateContent())}}jy._$name="TooltipBase";class Vy extends(Wr.mixin(Zr)){static get defaultConfig(){return{rangeCls:"b-sch-range",lineCls:"b-sch-line",enableResizing:!1,showTooltip:!0,tooltipTemplate:null,dragTipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    <div class="b-sch-tip-name">${_.encodeHtml(e.name)||""}</div>\n                    ${e.startClockHtml}\n                    ${e.endClockHtml||""}\n                </div>\n            `,baseCls:"b-sch-timerange",headerRenderer:null,bodyRenderer:null,cls:null,narrowThreshold:80}}construct(e,t){const n=this;super.construct(e,t),e.isVertical&&e.on({renderRows:n.onUIReady,thisObj:n,once:!0}),n.cls=n.cls||`b-sch-${n.constructor.$$name.toLowerCase()}`,n.baseSelector=`.${n.baseCls}.${n.cls}`,n.enableResizing&&(n.showHeaderElements=!0)}doDestroy(){var e,t,n,r;const i=this;i.detachListeners("timeAxisViewModel"),i.detachListeners("timeAxis"),null===(e=i.clockTemplate)||void 0===e||e.destroy(),null===(t=i.tip)||void 0===t||t.destroy(),null===(n=i.drag)||void 0===n||n.destroy(),null===(r=i.resize)||void 0===r||r.destroy(),super.doDestroy()}doDisable(e){this.renderRanges(),super.doDisable(e)}setupTimeAxisViewModelListeners(){const e=this;e.detachListeners("timeAxisViewModel"),e.detachListeners("timeAxis"),e.client.timeAxisViewModel.on({name:"timeAxisViewModel",update:"onTimeAxisViewModelUpdate",thisObj:e}),e.client.timeAxis.on({name:"timeAxis",includeChange:"renderRanges",thisObj:e})}onUIReady(){const e=this,{client:t}=e;t.on({timeAxisViewModelChange:e.setupTimeAxisViewModelListeners,thisObj:e}),e.setupTimeAxisViewModelListeners(),t.hideHeaders||(e.headerContainerElement&&_n.on({click:e.onTimeRangeClick,dblclick:e.onTimeRangeClick,contextmenu:e.onTimeRangeClick,delegate:e.baseSelector,element:e.headerContainerElement,thisObj:e}),e.enableResizing&&(e.drag=jc.new({name:"rangeDrag",lockX:t.isVertical,lockY:t.isHorizontal,constrain:!0,outerElement:e.headerContainerElement,targetSelector:`${e.baseSelector}`,isElementDraggable:(n,r)=>!t.readOnly&&e.isElementDraggable(n,r),rtlSource:t,listeners:{dragstart:"onDragStart",drag:"onDrag",drop:"onDrop",reset:"onDragReset",abort:"onInvalidDrop",thisObj:e}},e.dragHelperConfig),e.resize=zc.new({direction:t.mode,targetSelector:`${e.baseSelector}.b-sch-range`,outerElement:e.headerContainerElement,isElementResizable:e=>!e.matches(".b-dragging,.b-readonly"),listeners:{resizestart:"onResizeStart",resizing:"onResizeDrag",resize:"onResize",cancel:"onInvalidResize",reset:"onResizeReset",thisObj:e}},e.resizeHelperConfig))),e.renderRanges(),e.tooltipTemplate&&(e.hoverTooltip=new lu({forElement:e.headerContainerElement,getHtml({activeTarget:t}){const n=e.resolveTimeRangeRecord(t);return e.tooltipTemplate({timeRange:n})},forSelector:"."+e.baseCls+(e.cls?"."+e.cls:"")}))}refresh(){this._timeRanges=null,this.renderRanges()}getDOMConfig(e,t){const n=this,r=[],i=[];if(!n.disabled){n._labelRotationMap={};for(const s of n.timeRanges){const o=n.renderRange(s,e,t);o&&(r.push(o.bodyConfig),i.push(o.headerConfig))}}return[r,i]}renderRanges(){const e=this,{foregroundCanvas:t}=e.client;if(t&&e.client.isPainted){const{headerContainerElement:n}=e,r=[],[i,s]=e.getDOMConfig();e.bodyCanvas||(e.bodyCanvas=Mr.createElement({className:`b-timeranges-canvas ${e.cls}-canvas`,parent:t,retainElement:!0})),oa.sync({targetElement:e.bodyCanvas,childrenOnly:!0,domConfig:{children:i,syncOptions:{releaseThreshold:0,syncIdField:"id"}},callback:e.showHeaderElements?null:({targetElement:e,action:t})=>{"reuseElement"!==t&&"newElement"!==t&&"reuseOwnElement"!==t||r.push(e)}}),e.showHeaderElements&&!e.headerCanvas&&(e.headerCanvas=Mr.createElement({className:`${e.cls}-canvas`,parent:n,retainElement:!0})),e.headerCanvas&&oa.sync({targetElement:e.headerCanvas,childrenOnly:!0,domConfig:{children:s,syncOptions:{releaseThreshold:0,syncIdField:"id"}}});for(const t of r)e.cacheRotation(t.elementData.timeRange,t);for(const t of r)e.applyRotation(t.elementData.timeRange,t)}}get timeRanges(){return[]}shouldRenderRange(e,t=this.client.visibleDateRange.startDate,n=this.client.visibleDateRange.endDate){const{startDate:r,endDate:i,duration:s}=e;return Boolean(r&&en.intersectSpans(t,n,r,s?i:en.add(r,this._lineBufferDurationMS)))}getRangeDomConfig(e,t,n,r=0){const i=this,{client:s}=i,{rtl:o}=s,a=s.getCoordinateFromDate(en.max(e.startDate,t),{respectExclusion:!0})-r,l=e.endDate?s.getCoordinateFromDate(en.min(e.endDate,n),{respectExclusion:!0,isEnd:!0})-r:a,c=Math.abs(l-a),d=c>0,u=o?`calc(${a}px - 100%)`:`${a}px`;return{className:{[i.baseCls]:1,[i.cls]:i.cls,[i.rangeCls]:d,[i.lineCls]:!d,[e.cls]:e.cls,"b-narrow-range":d&&c<i.narrowThreshold,"b-readonly":e.readOnly,"b-rtl":o},dataset:{id:e.id},elementData:{timeRange:e},style:s.isVertical?`transform: translateY(${u}); ${d?`height:${c}px`:""};`:`transform: translateX(${u}); ${d?`width:${c}px`:""};`}}renderRange(e,t,n){const r=this,{client:i}=r,{timeAxis:s}=i;if(r.shouldRenderRange(e,t,n)&&s.startDate){const t=r.getRangeDomConfig(e,s.startDate,s.endDate),n=e.iconCls&&_.xss`<i class="${e.iconCls}"></i>`,i=e.name&&_.encodeHtml(e.name),o=i||n?`<label>${n||""}${i||"&nbsp;"}</label>`:"",a=f(f({},t),{},{style:t.style+(e.style||""),html:r.bodyRenderer?r.bodyRenderer({timeRange:e}):r.showHeaderElements&&!r.showLabelInBody?"":o});let l;return r.showHeaderElements&&(l=f(f({},t),{},{html:r.headerRenderer?r.headerRenderer({timeRange:e}):r.showLabelInBody?"":o})),{bodyConfig:a,headerConfig:l}}}cacheRotation(e,t){if(!e.iconCls&&!e.name||!e.duration)return;const n=t.firstElementChild;n&&!e.recurringTimeSpan&&(this._labelRotationMap[e.id]=this.client.isVertical?n.offsetHeight<t.offsetHeight:n.offsetWidth>t.offsetWidth)}applyRotation(e,t){var n,r,i;const s=this._labelRotationMap[null!==(n=null===(r=e.recurringTimeSpan)||void 0===r?void 0:r.id)&&void 0!==n?n:e.id];null===(i=t.firstElementChild)||void 0===i||i.classList.toggle("b-vertical",Boolean(s))}getBodyElementByRecord(e){const t="string"==typeof e?e:null==e?void 0:e.id;return null!=t&&oa.getChild(this.bodyCanvas,t)}resolveTimeRangeRecord(e){}get headerContainerElement(){const e=this,{isVertical:t,timeView:n,timeAxisColumn:r}=e.client;return e._headerContainerElement||(t&&n.element?e._headerContainerElement=n.element.parentElement:t||(e._headerContainerElement=r.element)),e._headerContainerElement}get showHeaderElements(){return!this.client.hideHeaders&&this._showHeaderElements}updateShowHeaderElements(e){const{client:t}=this;this.isConfiguring||(t.element.classList.toggle("b-sch-timeranges-with-headerelements",Boolean(e)),this.renderRanges())}populateTimeAxisHeaderMenu({column:e,items:t}){}onPaint({firstPaint:e}){e&&this.client.isHorizontal&&this.onUIReady()}onSchedulerHorizontalScroll(){this.client.isHorizontal&&this.renderRanges()}afterScroll(){this.client.isVertical&&this.renderRanges()}onInternalResize(e,t,n,r,i){this.client.isVertical&&i!==n&&this.renderRanges()}onTimeAxisViewModelUpdate({source:e}){this._lineBufferDurationMS=e.getDateFromPosition(50)-e.getDateFromPosition(0),this.refresh()}onTimeRangeClick(e){const t=this.resolveTimeRangeRecord(e.target);this.client.trigger(`timeRangeHeader${_.capitalize(e.type)}`,{event:e,timeRangeRecord:t})}showTip(e){const t=this;t.showTooltip&&(t.clockTemplate=new My({scheduler:t.client}),t.tip=new lu(sn.assign({id:`${t.client.id}-time-range-tip`,cls:"b-interaction-tooltip",align:"b-t",autoShow:!0,updateContentOnMouseMove:!0,forElement:e.element,getHtml:()=>t.getTipHtml(e.record,e.element)},t.showTooltip)))}destroyTip(){this.tip&&(this.tip.destroy(),this.tip=null)}isElementDraggable(e){return(e=e.closest(this.baseSelector+":not(.b-resizing):not(.b-readonly)"))&&!e.classList.contains("b-over-resize-handle")}onDragStart({context:e}){const{client:t,drag:n}=this;t.isVertical?(n.minY=0,n.maxY=t.timeAxisViewModel.totalSize-e.element.offsetHeight,n.minX=0,n.maxX=Number.MAX_SAFE_INTEGER):(n.minX=0,n.maxX=t.timeAxisViewModel.totalSize-e.element.offsetWidth,n.minY=0,n.maxY=Number.MAX_SAFE_INTEGER),t.element.classList.add("b-dragging-timerange")}onDrop({context:e}){this.client.element.classList.remove("b-dragging-timerange")}onInvalidDrop(){this.drag.reset(),this.client.element.classList.remove("b-dragging-timerange"),this.destroyTip()}onDrag(){}onDragReset(){}onResizeStart(){}onResizeDrag(){}onResize(){}onInvalidResize(){}onResizeReset(){}getTipHtml(e,t){const n=this,{client:r}=n,i=xn.from(t),s=i.getStart(r.rtl,r.isHorizontal),o=i.getEnd(r.rtl,r.isHorizontal),a=r.getDateFromCoordinate(s,"round",!1),l=e.endDate&&r.getDateFromCoordinate(o,"round",!1),c=r.getFormattedDate(a),d=l&&r.getFormattedEndDate(l,a);return n.dragTipTemplate({name:e.name||"",startDate:a,endDate:l,startText:c,endText:d,startClockHtml:n.clockTemplate.template({date:a,text:c,cls:"b-sch-tooltip-startdate"}),endClockHtml:d&&n.clockTemplate.template({date:l,text:d,cls:"b-sch-tooltip-enddate"})})}}v(Vy,"configurable",{showHeaderElements:!0}),v(Vy,"pluginConfig",{chain:["onPaint","populateTimeAxisHeaderMenu","onSchedulerHorizontalScroll","afterScroll","onInternalResize"]}),Vy._$name="AbstractTimeRanges";const zy=Object.freeze({});class Wy extends(Zr(Wr)){static get $name(){return"ColumnLines"}static get delayable(){return{refresh:{type:"raf",cancelOutstanding:!0}}}static get pluginConfig(){return{after:["render","updateCanvasSize","onVisibleDateRangeChange","onVisibleResourceRangeChange"]}}construct(e,t){e.useBackgroundCanvas=!0,super.construct(e,t)}doDisable(e){super.doDisable(e),this.isConfiguring||this.refresh()}render(){this.refresh()}getColumnLinesDOMConfig(e,t){const{client:n}=this,{rtl:r}=n,i=r?-1:1,{timeAxisViewModel:s,isHorizontal:o,resourceStore:a,variableColumnWidths:l}=n,{columnConfig:c}=s,d=s.columnLinesFor,u=Math.max(d-1,0),h=e.getTime(),g=t.getTime(),m=[],p=new Set,f=o?"X":"Y";if(!this.disabled){const e=(e,t)=>{const n=e.start.getTime();n>h&&n<g&&!p.has(n)&&(p.add(n),m.push({className:t?"b-column-line-major":"b-column-line",style:{transform:`translate${f}(${e.coord*i}px)`},dataset:{line:t?`major-${e.index}`:`line-${e.index}`}}))};if(d!==u)for(let t=1;t<=c[u].length-1;t++)e(c[u][t],!0);for(let t=1;t<=c[d].length-1;t++)e(c[d][t],!1);if(!o&&n.columnLines){const{columnWidth:e}=n.resourceColumns,{first:t,last:r}=n.currentOrientation.getResourceRange(!0);if(t>-1)for(let s=t;s<r+1;s++){const t=a.getAt(s),r=t.instanceMeta(n),o=l?r.insetStart+t.columnWidth-1:(s+1)*e-1;m.push({className:"b-column-line b-resource-column-line",style:{transform:`translateX(${o*i}px)`},dataset:{line:`resource-${s}`}})}}}return m}refresh(){const e=this,{client:t}=e,{timeAxis:n}=t,{startDate:r,endDate:i}=t.visibleDateRange||zy;if(!n.startDate||!r)return;e.element||(e.element=Mr.createElement({parent:t.backgroundCanvas,className:"b-column-lines-canvas"}));const s=e.getColumnLinesDOMConfig(r,i);oa.sync({targetElement:e.element,onlyChildren:!0,domConfig:{children:s,syncOptions:{releaseThreshold:4}},syncIdField:"line"})}onVisibleDateRangeChange(){this.refresh()}onVisibleResourceRangeChange({firstResource:e,lastResource:t}){this.refresh()}updateCanvasSize(){this.refresh()}}Wy._$name="ColumnLines",vg.registerFeature(Wy,!0,["Scheduler","Gantt"]);var Uy=e=>class extends(e||Te){static get $name(){return"DependencyCreation"}static get defaultConfig(){return{allowDropOnEventBar:!0,showCreationTooltip:!0,creationTooltip:null,terminalCls:"b-sch-terminal",terminalSides:["start","top","end","bottom"],allowCreate:!0}}construct(e,t){super.construct(e,t);const n=this;n.view=e,n.eventName=e.scheduledEventName,e.on("readOnly",(()=>n.updateCreateListeners())),n.updateCreateListeners()}doDestroy(){var e,t;const n=this;n.detachListeners("view"),n.creationData=null,null===(e=n.pointerUpMoveDetacher)||void 0===e||e.call(n),null===(t=n.creationTooltip)||void 0===t||t.destroy(),super.doDestroy()}updateCreateListeners(){const e=this;e.view&&(e.detachListeners("view"),e.isCreateAllowed&&e.view.on({name:"view",[`${e.eventName}mouseenter`]:"onTimeSpanMouseEnter",[`${e.eventName}mouseleave`]:"onTimeSpanMouseLeave",thisObj:e}))}set allowCreate(e){this._allowCreate=e,this.updateCreateListeners()}get allowCreate(){return this._allowCreate}get isCreateAllowed(){return this.allowCreate&&!this.view.readOnly&&!this.disabled}onTimeSpanMouseEnter({event:e,source:t,[`${this.eventName}Record`]:n,[`${this.eventName}Element`]:r}){if(!n.isCreating&&!n.readOnly&&(!this.client.features.nestedEvents||n.parent.isRoot)){const i=this,s=Mr.down(r,t.eventInnerSelector);i.showTerminals(n,s),i.creationData&&e.target.closest(i.client.eventSelector)&&(i.creationData.timeSpanElement=s,i.onOverTargetEventBar(e))}}onTimeSpanMouseLeave(e){const t=this,{creationData:n}=t,r=e[`${t.eventName}Element`],i=e.event.relatedTarget,s=null==n?void 0:n.timeSpanElement;n&&s&&Mr.isDescendant(s,i)||t.hideTerminals(r),n&&!n.finalizing&&(n.timeSpanElement=null,t.onOverNewTargetWhileCreating(void 0,void 0,e))}onTerminalMouseOver(e){this.creationData&&this.onOverTargetEventBar(e)}onTerminalMouseOut(e){const t=this,{creationData:n}=t,r=e.target.closest(t.view.eventSelector);!r||t.showingTerminalsFor&&Mr.isDescendant(r,t.showingTerminalsFor)||n&&r===n.timeSpanElement||(t.hideTerminals(r),t.view.unhover(r,e)),n&&t.onOverNewTargetWhileCreating(e.relatedTarget,n.target,e)}onTerminalPointerDown(e){const t=this;if(0===e.button&&!t.creationData){var n;const r=t.view,i=r.timeAxisSubGridElement,s=e.target,o=s.closest(r.eventInnerSelector),a=xn.from(r.element,document.body);e.stopPropagation(),t.creationData={source:r.resolveTimeSpanRecord(o).$original,fromSide:s.dataset.side,startPoint:xn.from(s,i).center,startX:e.pageX-a.x+r.scrollLeft,startY:e.pageY-a.y+r.scrollTop,valid:!1,sourceResource:null===(n=r.resolveResourceRecord)||void 0===n?void 0:n.call(r,e),tooltip:t.creationTooltip},t.pointerUpMoveDetacher=_n.on({pointerup:{element:r.rootElement,handler:"onMouseUp"},pointermove:{element:i,handler:"onMouseMove"},thisObj:t}),t.documentPointerUpDetacher=_n.on({pointerup:{element:document,handler:"onDocumentMouseUp"},keydown:{element:document,handler:({key:e})=>{"Escape"===e&&t.abort()}},thisObj:t})}}onMouseMove(e){const t=this,{view:n,creationData:r}=t,i=xn.from(n.element,document.body),s=e.pageX-i.x+n.scrollLeft-r.startX,o=e.pageY-i.y+n.scrollTop-r.startY,a=Math.round(Math.sqrt(s*s+o*o))-3,l=Math.atan2(o,s);let{connector:c}=t;if(!c){if(!1===t.onRequestDragCreate(e))return;c=t.connector}c.style.width=`${a}px`,c.style.transform=`rotate(${l}rad)`,t.lastMouseMoveEvent=e}onRequestDragCreate(e){const t=this,{view:n,creationData:r}=t;if(!1===n.trigger("beforeDependencyCreateDrag",{data:r,source:r.source}))return t.abort(),!1;if(n.element.classList.add("b-creating-dependency"),t.createConnector(r.startPoint.x,r.startPoint.y),n.trigger("dependencyCreateDragStart",{data:r,source:r.source}),t.showCreationTooltip){const n=t.creationTooltip||(t.creationTooltip=t.createDragTooltip());t.creationData.tooltip=n,n.disabled=!1,n.show(),n.onMouseMove(e)}n.scrollManager.startMonitoring({scrollables:[{element:n.timeAxisSubGrid.scrollable.element,direction:"horizontal"},{element:n.scrollable.element,direction:"vertical"}],callback:()=>t.lastMouseMoveEvent&&t.onMouseMove(t.lastMouseMoveEvent)})}onOverTargetEventBar(e){var t;const n=this,{view:r,creationData:i,allowDropOnEventBar:s}=n,{target:o}=e;let a=r.resolveTimeSpanRecord(o).$original;null!==(t=a)&&void 0!==t&&t.isEventSegment&&(a=a.event),Y.isPromise(i.valid)||!s&&!o.classList.contains(n.terminalCls)||a!==i.source&&n.onOverNewTargetWhileCreating(o,a,e)}async onOverNewTargetWhileCreating(e,t,n){const r=this,{view:i,creationData:s,allowDropOnEventBar:o,connector:a}=r;if(!Y.isPromise(s.valid)&&!s.finalizing&&a){if(a.classList.remove("b-valid","b-invalid"),s.timeSpanElement&&Mr.removeClsGlobally(s.timeSpanElement,"b-sch-terminal-active"),t&&t!==s.source&&(o||e.classList.contains(r.terminalCls))){var l,c;const d=s.target=t,{source:u}=s;let h,g=e.dataset.side;o&&!e.classList.contains(r.terminalCls)&&(g=r.getTargetSideFromType(r.dependencyStore.modelClass.fieldMap.type.defaultValue||ty.Type.EndToStart)),i.resolveResourceRecord&&(s.targetResource=i.resolveResourceRecord(n)),s.toSide=g;const m=s.fromSide,p=t=>{r.isDestroyed||(s.valid=t,e.classList.add(t?"b-valid":"b-invalid"),a.classList.add(t?"b-valid":"b-invalid"),i.trigger("dependencyValidationComplete",{data:s,source:u,target:d,dependencyType:h}))};switch(!0){case"start"===m&&"start"===g:h=ty.Type.StartToStart;break;case"start"===m&&"end"===g:h=ty.Type.StartToEnd;break;case"end"===m&&"start"===g:h=ty.Type.EndToStart;break;case"end"===m&&"end"===g:h=ty.Type.EndToEnd}i.trigger("dependencyValidationStart",{data:s,source:u,target:d,dependencyType:h});const f=s.valid=r.dependencyStore.isValidDependency(u,d,h);Y.isPromise(f)?p(await f):p(f);const v=f?"b-valid":"b-invalid";a.classList.add(v),null===(l=s.timeSpanElement)||void 0===l||null===(c=l.querySelector(`.b-sch-terminal[data-side=${g}]`))||void 0===c||c.classList.add("b-sch-terminal-active",v)}else s.target=s.toSide=null,s.valid=!1,a.classList.add("b-invalid");r.updateCreationTooltip()}}async onMouseUp(){var e;const t=this,n=t.creationData;if(n.finalizing=!0,null===(e=t.pointerUpMoveDetacher)||void 0===e||e.call(t),n.valid)if(!1===await t.view.trigger("beforeDependencyCreateFinalize",n)?n.valid=!1:Y.isPromise(n.valid)&&(n.valid=await n.valid),n.valid){let e=t.createDependency(n);null!==e&&(Y.isPromise(e)&&(e=await e),n.dependency=e,t.view.trigger("dependencyCreateDrop",{data:n,source:n.source,target:n.target,dependency:e}),t.doAfterDependencyDrop(n))}else t.doAfterDependencyDrop(n);else n.valid=!1,t.doAfterDependencyDrop(n);t.abort()}doAfterDependencyDrop(e){this.view.trigger("afterDependencyCreateDrop",f({data:e},e))}onDocumentMouseUp({target:e}){this.view.timeAxisSubGridElement.contains(e)||this.abort()}abort(){var e,t;const n=this,{view:r,creationData:i}=n;if(i){const{source:e,sourceResource:t,target:s,targetResource:o}=i;if(e){const i=r.getElementFromEventRecord(e,t);i&&n.hideTerminals(i)}if(s){const e=r.getElementFromEventRecord(s,o);e&&n.hideTerminals(e)}}n.creationTooltip&&(n.creationTooltip.disabled=!0),n.creationData=n.lastMouseMoveEvent=null,null===(e=n.pointerUpMoveDetacher)||void 0===e||e.call(n),null===(t=n.documentPointerUpDetacher)||void 0===t||t.call(n),n.removeConnector()}createConnector(e,t){const n=this,{view:r}=n;n.clearTimeout(n.removeConnectorTimeout),n.connector=Mr.createElement({parent:r.timeAxisSubGridElement,className:`${n.baseCls}-connector`,style:`left:${e}px;top:${t}px`}),r.element.classList.add("b-creating-dependency")}createDragTooltip(){const e=this,{view:t}=e;return e.creationTooltip=lu.new({id:`${t.id}-dependency-drag-tip`,cls:"b-sch-dependency-creation-tooltip",loadingMsg:"",anchorToTarget:!1,forElement:t.timeAxisSubGridElement,trackMouse:!0,constrainTo:null,header:{dock:"right"},listeners:{beforeShow:"updateCreationTooltip",thisObj:e}},e.creationTooltip)}removeConnector(){const e=this,{connector:t,view:n}=e;t&&(t.classList.add("b-removing"),t.style.width="0",e.removeConnectorTimeout=e.setTimeout((()=>{t.remove(),e.connector=null}),200)),n.element.classList.remove("b-creating-dependency"),e.creationTooltip&&e.creationTooltip.hide(),n.scrollManager.stopMonitoring()}showTerminals(e,t){const n=this;if(!n.isCreateAllowed||!e.project)return;const r=n.terminalCls,i=`${r}s-visible`;(t=Mr.down(t,n.view.eventInnerSelector)).classList.contains(i)||n.view.element.classList.contains("b-resizing-event")||n.view.readOnly||(n.terminalSides.forEach((e=>{e=n.fixSide(e);const i=Mr.createElement({parent:t,className:`${r} ${r}-${e}`,dataset:{side:e,feature:!0}});i.detacher=_n.on({element:i,mouseover:"onTerminalMouseOver",mouseout:"onTerminalMouseOut",pointerdown:{handler:"onTerminalPointerDown",capture:!0},thisObj:n})})),t.classList.add(i),e.internalCls.add(i),n.showingTerminalsFor=t)}fixSide(e){return"left"===e?"start":"right"===e?"end":e}hideTerminals(e){const t=this,n=t.client.getTimeSpanMouseEventParams(e),r=null==n?void 0:n[`${t.eventName}Record`],i=`${t.terminalCls}s-visible`;Mr.forEachSelector(e,`.${t.terminalCls}`,(e=>{e.detacher&&e.detacher(),e.remove()})),Mr.down(e,t.view.eventInnerSelector).classList.remove(i),r.internalCls.remove(i),t.showingTerminalsFor=null}createDependency(e){const{source:t,target:n,fromSide:r,toSide:i}=e,s=("start"===r?0:2)+("end"===i?1:0),o=this.dependencyStore.add({from:t.id,to:n.id,type:s,fromSide:r,toSide:i});return null!==o?o[0]:null}getTargetSideFromType(e){return e===ty.Type.StartToStart||e===ty.Type.EndToStart?"start":"end"}updateCreationTooltip(){const e=this,t=e.creationData,{valid:n}=t,r=e.creationTooltip,{classList:i}=r.element;if(Y.isPromise(n))return i.remove("b-invalid"),i.add("b-checking"),new Promise((i=>n.then((n=>{t.valid=n,r.isDestroyed||i(e.updateCreationTooltip())}))));r.html=e.creationTooltipTemplate(t)}creationTooltipTemplate(e){var t,n;const r=this,{tooltip:i,valid:s}=e,{classList:o}=i.element;let a,l;return Object.assign(e,{fromText:_.encodeHtml(e.source.name),toText:_.encodeHtml(null!==(t=null===(n=e.target)||void 0===n?void 0:n.name)&&void 0!==t?t:""),fromSide:e.fromSide,toSide:e.toSide||""}),o.toggle("b-invalid",!s),o.remove("b-checking"),!0===s?(a="valid",l=r.L("L{Dependencies.valid}")):(a="invalid",l=r.L("L{Dependencies.invalid}")),i.title=`<i class="b-icon b-icon-${a}"></i>${l}`,{children:[{className:"b-sch-dependency-tooltip",children:[{dataset:{ref:"fromLabel"},tag:"label",text:r.L("L{Dependencies.from}")},{dataset:{ref:"fromText"},text:e.fromText},{dataset:{ref:"fromBox"},className:`b-sch-box b-${e.fromSide}`},{dataset:{ref:"toLabel"},tag:"label",text:r.L("L{Dependencies.to}")},{dataset:{ref:"toText"},text:e.toText},{dataset:{ref:"toBox"},className:`b-sch-box b-${e.toSide}`}]}]}}},Yy=e=>{var t;return t=class extends e{constructor(...e){super(...e),v(this,"gridCache",null)}getDependenciesToConsider(e,t,n,r){const i=this,{gridCache:s}=i,{timeAxis:o}=i.client;if(s){const a=new Set,l=Math.floor((e-o.startMS)/i.MS_PER_CELL),c=Math.floor((t-o.startMS)/i.MS_PER_CELL),d=Math.floor(n/25),u=Math.floor(r/25);for(let e=l;e<=c;e++){const t=s[e];if(t)for(let e=d;e<=u;e++){const n=t[e];if(n)for(let e=0;e<n.length;e++)a.add(n[e])}}return a}}afterDrawDependency(e,t,n,r,i){const s=this;if(s.constructGridCache){const{timeAxis:l}=s.client,c=Math.floor((r-l.startMS)/s.MS_PER_CELL),d=Math.floor((i-l.startMS)/s.MS_PER_CELL),u=Math.floor(t/25),h=Math.floor(n/25),g=Math.min(c,d),m=Math.max(c,d),p=Math.min(u,h),f=Math.max(u,h);for(let t=g;t<=m;t++){var o;const n=null!==(o=s.gridCache[t])&&void 0!==o?o:s.gridCache[t]={};for(let t=p;t<=f;t++){var a;(null!==(a=n[t])&&void 0!==a?a:n[t]=[]).push(e)}}}}beforeDraw(){const e=this;e.gridCache||(e.constructGridCache=!0,e.MS_PER_CELL=en.asMilliseconds(25,e.client.timeAxis.mainUnit),e.gridCache={})}afterDraw(){this.constructGridCache=!1}reset(){this.gridCache=null}},v(t,"$name","DependencyGridCache"),t};const Gy=Math.min(1/globalThis.devicePixelRatio,.75),qy=["start","end","top","bottom"],Ky=(e,t)=>Math.abs(e-t)<.1;class Xy extends Te{static get configurable(){return{startSide:"right",startArrowMargin:12,startShift:0,endSide:"left",endArrowMargin:12,endShift:0,verticalMargin:2,horizontalMargin:5,otherBoxes:null,client:{}}}findPath(e,t){const n=this,r=e;let i,s,o,a,l,c,d,u,h,g,m,p,f,v,y,b,C,w,S,D,E,x,R,T,M,k,I,A,F;for(t=ke.asArray(t),F=0;e&&!A;){var O;for(i=Object.assign(n.config,e),s=i.startBox,o=i.endBox,a=i.startShift,l=i.endShift,c=i.startSide,d=i.endSide,u=i.startArrowMargin,h=i.endArrowMargin,g=i.horizontalMargin,m=i.verticalMargin,p=i.hasOwnProperty("startHorizontalMargin")?i.startHorizontalMargin:g,f=i.hasOwnProperty("startVerticalMargin")?i.startVerticalMargin:m,v=i.hasOwnProperty("endHorizontalMargin")?i.endHorizontalMargin:g,y=i.hasOwnProperty("endVerticalMargin")?i.endVerticalMargin:m,b=i.hasOwnProperty("otherHorizontalMargin")?i.otherHorizontalMargin:g,C=i.hasOwnProperty("otherVerticalMargin")?i.otherVerticalMargin:m,w=i.otherBoxes,c=n.normalizeSide(c),d=n.normalizeSide(d),S=n.getConnectionCoordinatesFromBoxSideShift(s,c,a),D=n.getConnectionCoordinatesFromBoxSideShift(o,d,l),M=n.calcGridBaseBoxFromBoxAndDrawParams(s,c,u,p,f),k=n.calcGridBaseBoxFromBoxAndDrawParams(o,d,h,v,y),qy.forEach((e=>{Math.abs(M[e]-k[e])<=Gy&&(k[e]=M[e])})),n.shouldLookForPath(s,o,M,k)&&(w=null===(O=w)||void 0===O?void 0:O.map((e=>n.calcGridBaseBoxFromBoxAndDrawParams(e,!1,0,b,C))),E=n.getConnectionCoordinatesFromBoxSideShift(M,c,a),x=n.getConnectionCoordinatesFromBoxSideShift(k,d,l),I=n.buildPathGrid(M,k,E,x,c,d,w),R=n.convertDecartPointToGridPoint(I,E),T=n.convertDecartPointToGridPoint(I,x),A=n.findPathOnGrid(I,R,T,c,d)),e=!1;!A&&!e&&t&&F<t.length;F++)e=t[F](i,r)}return A&&(A=n.prependPathWithArrowStaffSegment(A,S,c),A=n.appendPathWithArrowStaffSegment(A,D,d),A=n.optimizePath(A)),A}static calculateRelativePosition(e,t,n=!1){const r=n?"top":"start",i=n?"bottom":"end";let s;return s=e[i]<t[r]?0:e[i]<=t[i]&&e[i]>=t[r]&&e[r]<t[r]?1:e[r]>=t[r]&&e[i]<=t[i]?2:e[r]<t[r]&&e[i]>t[i]?-2:e[r]<=t[i]&&e[i]>t[i]?3:4,s}static boxOverlapChanged(e,t,n,r,i=!1){const s=Xy.calculateRelativePosition;return s(e,t,i)!==s(n,r,i)}shouldLookForPath(e,t,n,r){let i=!0;return(e.end-e.start<=this.startArrowMargin||t.end-t.start<=this.endArrowMargin)&&2===Math.abs(Xy.calculateRelativePosition(e,t,!0))&&(i=!Xy.boxOverlapChanged(e,t,n,r)),i}getConnectionCoordinatesFromBoxSideShift(e,t,n){let r;switch(t){case"left":r={x:e.start,y:(e.top+e.bottom)/2+n};break;case"right":r={x:e.end,y:(e.top+e.bottom)/2+n};break;case"top":r={x:(e.start+e.end)/2+n,y:e.top};break;case"bottom":r={x:(e.start+e.end)/2+n,y:e.bottom}}return r}calcGridBaseBoxFromBoxAndDrawParams(e,t,n,r,i){let s;switch(this.normalizeSide(t)){case"left":s={start:e.start-Math.max(n,r),end:e.end+r,top:e.top-i,bottom:e.bottom+i};break;case"right":s={start:e.start-r,end:e.end+Math.max(n,r),top:e.top-i,bottom:e.bottom+i};break;case"top":s={start:e.start-r,end:e.end+r,top:e.top-Math.max(n,i),bottom:e.bottom+i};break;case"bottom":s={start:e.start-r,end:e.end+r,top:e.top-i,bottom:e.bottom+Math.max(n,i)};break;default:s={start:e.start-r,end:e.end+r,top:e.top-i,bottom:e.bottom+i}}return s}normalizeSide(e){const{rtl:t}=this.client;return"start"===e?t?"right":"left":"end"===e?t?"left":"right":e}buildPathGrid(e,t,n,r,i,s,o){let a,l,c,d,u,h,g,m,p,f,v,y,b;const C={},w=[];for(a=[e.start,"left"===i||"right"===i?(e.start+e.end)/2:n.x,e.end,t.start,"left"===s||"right"===s?(t.start+t.end)/2:r.x,t.end],l=[e.top,"top"===i||"bottom"===i?(e.top+e.bottom)/2:n.y,e.bottom,t.top,"top"===s||"bottom"===s?(t.top+t.bottom)/2:r.y,t.bottom],o&&o.forEach((e=>{a.push(e.start,(e.start+e.end)/2,e.end),l.push(e.top,(e.top+e.bottom)/2,e.bottom)})),a=[...new Set(a.sort(((e,t)=>e-t)))],l=[...new Set(l.sort(((e,t)=>e-t)))],h=0,m=l.length;h<m;++h)for(C[h]=C[h]||{},c=l[h],u=0,g=a.length;u<g;++u){if(d=a[u],y=(d<=e.start||d>=e.end||c<=e.top||c>=e.bottom)&&(d<=t.start||d>=t.end||c<=t.top||c>=t.bottom),o)for(p=0,f=o.length;y&&p<f;++p)v=o[p],y=d<=v.start||d>=v.end||c<=v.top||c>=v.bottom||d===n.x&&c===n.y||d===r.x&&c===r.y;b={distance:Number.MAX_SAFE_INTEGER,permitted:y,x:d,y:c,ix:u,iy:h},C[h][u]=b,w.push(b)}return{width:a.length,height:l.length,xs:a,ys:l,points:C,linearPoints:w}}convertDecartPointToGridPoint(e,t){const n=e.xs.indexOf(t.x),r=e.ys.indexOf(t.y);return e.points[r][n]}findPathOnGrid(e,t,n,r,i){let s=!1;return t.permitted&&n.permitted&&(e=this.waveForward(e,t,0),s=this.collectPath(e,n,i)),s}getGridPointNeighbors(e,t,n){const r=t.ix,i=t.iy,s=[];let o;return i<e.height-1&&(o=e.points[i+1][r],(!n||n(o))&&s.push(o)),i>0&&(o=e.points[i-1][r],(!n||n(o))&&s.push(o)),r<e.width-1&&(o=e.points[i][r+1],(!n||n(o))&&s.push(o)),r>0&&(o=e.points[i][r-1],(!n||n(o))&&s.push(o)),s}waveForward(e,t,n){const r=this;return Rs.preWalkUnordered([t,n],(([t,n])=>r.getGridPointNeighbors(e,t,(e=>e.permitted&&e.distance>n+1)).map((e=>[e,n+1]))),(([e,t])=>e.distance=t)),e}collectPath(e,t,n){const r=this,i=[];let s,o,a,l,c=!0;for(;c&&t.distance;)if(s=r.getGridPointNeighbors(e,t,(e=>e.permitted&&e.distance===t.distance-1)),c=s.length>0,c){switch(s=s.sort(((e,r)=>{let i,s;i=e.ix-t.ix,s=e.iy-t.iy;const o=("left"===n||"right"===n)&&0===s||("top"===n||"bottom"===n)&&0===i?-1:1;i=r.ix-t.ix,s=r.iy-t.iy;const a=("left"===n||"right"===n)&&0===s||("top"===n||"bottom"===n)&&0===i?-1:1;return o>a?1:o<a?-1:o===a?e.y>r.y?-1:1:void 0})),o=s[0],i.push({x1:o.x,y1:o.y,x2:t.x,y2:t.y}),a=o.ix-t.ix,l=o.iy-t.iy,!0){case!l&&a>0:n="left";break;case!l&&a<0:n="right";break;case!a&&l>0:n="top";break;case!a&&l<0:n="bottom"}t=o}return c&&i.reverse()||!1}prependPathWithArrowStaffSegment(e,t,n){if(e.length>0){const r=e[0],i={x2:r.x1,y2:r.y1};switch(n){case"left":case"right":i.x1=t.x,i.y1=r.y1;break;case"top":case"bottom":i.x1=r.x1,i.y1=t.y}e.unshift(i)}return e}appendPathWithArrowStaffSegment(e,t,n){if(e.length>0){const r=e[e.length-1],i={x1:r.x2,y1:r.y2};switch(n){case"left":case"right":i.x2=t.x,i.y2=r.y2;break;case"top":case"bottom":i.x2=r.x2,i.y2=t.y}e.push(i)}return e}optimizePath(e){const t=[];let n,r;if(e.length>0)for(n=e.shift(),t.push(n);e.length>0;)r=e.shift(),Ky(n.x1,r.x1)&&Ky(n.y1,r.y1)&&Ky(n.x2,r.x2)&&Ky(n.y2,r.y2)?n=r:Ky(n.y1,n.y2)&&Ky(r.y1,r.y2)?n.x2=r.x2:Ky(n.x1,n.x2)&&Ky(r.x1,r.x2)?n.y2=r.y2:(t.push(r),n=r);return t}}function Zy(e){return e.x1===e.x2?e.y2>e.y1?"d":"u":e.x2>e.x1?"r":"l"}function Jy(e){return e.x1===e.x2?e.y2-e.y1:e.x2-e.x1}function Qy(e,t){const{length:n}=t;if(!n)return"";let r=null;return`M${t[0].x1},${t[0].y1} ${t.map(((i,s)=>{const o=1===n?"single":s===n-1?"last":0===s?"first":"between",a=function(e,t,n,r,i){let s=e.x1===e.x2?"v":"h",o=r;if(r){const a=Jy(e),l=t?Math.abs(Jy(t)):Number.MAX_SAFE_INTEGER,c=Math.sign(a);null==i&&(i=r),(Math.abs(a)<2*r||l<2*r)&&(o=Math.min(Math.abs(a),l)/2);const d=a-("single"===n?0:"first"===n?o:"between"===n?i+o:i)*c;s+=Math.sign(d)!==c?0:d,"last"!==n&&"single"!==n&&o>0&&(s+=` ${function(e,t,n){const r=Zy(e)+Zy(t),i=n*(r.includes("l")?-1:1),s=n*(r.includes("u")?-1:1);return`a${i},${s} 0 0 ${"ur"===r||"lu"===r||"dl"===r||"rd"===r?1:0} ${i},${s}`}(e,t,o)}`)}else s+=Jy(e);return{line:s,currentRadius:r!==o?o:null}}(i,t[s+1],o,e,r);return({currentRadius:r}=a),a.line})).join(" ")}`}Xy._$name="RectangularPathFinder";var eb=e=>{var t;return t=class extends e{constructor(...e){super(...e),v(this,"lineCache",{})}onSVGReady(){const e=this;e.pathFinder=new Xy(f(f({},e.pathFinderConfig),{},{client:e.client})),e.lineDefAdjusters=e.createLineDefAdjusters(),e.createMarker()}updateRadius(){this.isConfiguring||this.reset()}updateRenderer(){this.isConfiguring||this.reset()}createMarker(){var e,t;const n=this,{markerDef:r}=n,i=this.client.svgCanvas,s=r?`${n.client.id}-arrowEnd`:"arrowEnd";null===(e=n.marker)||void 0===e||e.remove(),i.style.setProperty("--scheduler-dependency-marker",`url(#${s})`),n.marker=Mr.createElement({parent:i,id:s,tag:"marker",className:"b-sch-dependency-arrow",ns:"http://www.w3.org/2000/svg",markerHeight:11,markerWidth:11,refX:8,refY:3,viewBox:"0 0 9 6",orient:"auto-start-reverse",markerUnits:"userSpaceOnUse",retainElement:!0,children:[{tag:"path",ns:"http://www.w3.org/2000/svg",d:null!==(t=n.markerDef)&&void 0!==t?t:"M3,0 L3,6 L9,3 z"}]})}updateMarkerDef(){this.isConfiguring||this.createMarker()}getAssignmentElement(e){return this.client.getElementFromAssignmentRecord(e)}getDomConfig(e,t,n,r){const i=this,s=i.getDependencyKey(e,t,n),o=i.lineCache[s];if(i.constructLineCache||!o||r||i.drawingLive&&(i.getAssignmentElement(t)||i.getAssignmentElement(n))){const o=i.prepareLineDef(e,t,n,r),c=o&&i.pathFinder.findPath(o,i.lineDefAdjusters),{client:d}=i,{toEvent:u}=e;if(c){var a,l;const r=i.highlighted.get(e),h={tag:"path",ns:"http://www.w3.org/2000/svg",d:Qy(null!==(a=i.radius)&&void 0!==a?a:0,c),dataset:{syncId:s,depId:e.id,fromId:t.id,toId:n.id},elementData:{dependency:e,points:c},class:{[i.baseCls]:1,[e.cls]:e.cls,[e.highlighted]:e.highlighted,[r&&[...r].join(" ")]:r,[i.noMarkerCls]:o.hideMarker,"b-inactive":!1===e.active,"b-sch-bidirectional-line":e.bidirectional,"b-readonly":e.readOnly,"b-sch-dependency-ends-outside":!u.milestone&&(u.endDate<=d.startDate||d.endDate<=u.startDate)||u.milestone&&(u.endDate<d.startDate||d.endDate<u.startDate)}};return null===(l=i.renderer)||void 0===l||l.call(i,{domConfig:h,points:c,dependencyRecord:e,fromAssignmentRecord:t,toAssignmentRecord:n,fromBox:o.startBox,toBox:o.endBox,fromSide:o.startSide,toSide:o.endSide}),i.lineCache[s]=h}return i.lineCache[s]=null}return o}generateBoundaryBoxes(e,t){return"bottom"===t?[{start:e.left,end:e.left+e.width/2,top:e.rowTop,bottom:e.rowBottom},{start:e.left+e.width/2,end:e.right,top:e.rowTop,bottom:e.rowBottom}]:[{start:e.left-this.pathFinder.startArrowMargin,end:e.right+this.pathFinder.startArrowMargin,top:e.rowTop,bottom:e.rowBottom}]}getAssignmentBounds(e){const{client:t}=this,n=this.getAssignmentElement(e);if(n&&!t.isExporting){const r=xn.from(n,this.relativeTo);if(t.isHorizontal){let n=t.getRowById(e.resource.id);if(r.y<n.top||r.bottom>n.bottom){const e=t.rowManager.getRowAt(r.center.y,!0);e&&(n=e)}r.rowTop=n.top,r.rowBottom=n.bottom}return r}return t.isEngineReady&&t.getAssignmentEventBox(e,!0)}getConnectorStartSide(e){return this.client.currentOrientation.getConnectorStartSide(e)}getConnectorEndSide(e){return this.client.currentOrientation.getConnectorEndSide(e)}getDependencyStartSide(e){const{fromEvent:t,type:n,fromSide:r}=e;if(r)return r;switch(!0){case n===ry.Type.StartToEnd:case n===ry.Type.StartToStart:return this.getConnectorStartSide(t);case n===ry.Type.EndToStart:case n===ry.Type.EndToEnd:default:return this.getConnectorEndSide(t)}}getDependencyEndSide(e){const{toEvent:t,type:n,toSide:r}=e;if(r)return r;switch(!0){case n===ry.Type.EndToEnd:case n===ry.Type.StartToEnd:return this.getConnectorEndSide(t);case n===ry.Type.EndToStart:case n===ry.Type.StartToStart:default:return this.getConnectorStartSide(t)}}createLineDefAdjusters(){const{client:e}=this;return[function(t){const{barMargin:n}=e;let r=!1;return(t.startArrowMargin>n||t.endArrowMargin>n)&&(t.startArrowMargin=t.endArrowMargin=n,r=!0),r?t:r},function(e){let t=!1;return(e.startArrowMargin>0||e.endArrowMargin>0)&&(e.startArrowMargin=e.endArrowMargin=0,t=!0),t?e:t},function(e,t){let n=!1;return e.horizontalMargin>2&&(e.horizontalMargin=1,n=!0,t.hideMarker=!0),n?e:n}]}adjustLineDef(e,t){return t}prepareLineDef(e,t,n,r){var i,s;const o=this,a=o.getDependencyStartSide(e),l=o.getDependencyEndSide(e),c=null!==(i=null==r?void 0:r.from)&&void 0!==i?i:o.getAssignmentBounds(t),d=null!==(s=null==r?void 0:r.to)&&void 0!==s?s:o.getAssignmentBounds(n),u=[];if(!c||!d)return null;let{startArrowMargin:h,verticalMargin:g}=o.pathFinder;return o.client.isHorizontal&&(null!=c.rowTop&&c.rowTop!==d.rowTop&&u.push(...o.generateBoundaryBoxes(c,a)),e.bidirectional||(/(top|bottom)/.test(a)&&(h=o.client.barMargin/2),g=o.client.barMargin/2)),o.adjustLineDef(e,{startBox:c,endBox:d,otherBoxes:u,startArrowMargin:h,verticalMargin:g,otherVerticalMargin:0,otherHorizontalMargin:0,startSide:a,endSide:l})}beforeDraw(){super.beforeDraw(),Object.keys(this.lineCache).length||(this.constructLineCache=!0)}afterDraw(){super.afterDraw(),this.constructLineCache=!1}reset(){super.reset(),this.lineCache={}}},v(t,"$name","DependencyLineGenerator"),t};const tb=["start","start","end","end"],nb=["start","end","start","end"];var rb=e=>{var t;return v(t=class extends e{changeTooltip(e,t){const n=this;return null==t||t.destroy(),n.showTooltip&&e?lu.new({align:"b-t",id:`${n.client.id}-dependency-tip`,forSelector:`.b-timelinebase:not(.b-eventeditor-editing):not(.b-resizing-event):not(.b-dragcreating):not(.b-dragging-event):not(.b-creating-dependency) .${n.baseCls}`,forElement:n.client.timeAxisSubGridElement,showOnHover:!0,hoverDelay:0,hideDelay:0,anchorToTarget:!1,textContent:!1,trackMouse:!1,getHtml:n.getHoverTipHtml.bind(n)},e):null}getHoverTipHtml({activeTarget:e}){return this.tooltipTemplate(this.resolveDependencyRecord(e))}},"$name","DependencyTooltip"),v(t,"configurable",{showTooltip:!0,tooltipTemplate(e){return{children:[{className:"b-sch-dependency-tooltip",children:[{tag:"label",text:this.L("L{Dependencies.from}")},{text:e.fromEvent.name},{className:`b-sch-box b-${e.fromSide||tb[e.type]}`},{tag:"label",text:this.L("L{Dependencies.to}")},{text:e.toEvent.name},{className:`b-sch-box b-${e.toSide||nb[e.type]}`}]}]}},tooltip:{$config:"nullify",value:{}}}),t};const ib=e=>{var t;const n=[e];return null!==(t=e.resource)&&void 0!==t&&t.hasLinks&&n.push(...e.resource.$links.map((t=>({id:`${t.id}_${e.id}`,resource:t,event:e.event,drawDependencies:e.drawDependencies})))),n};class sb extends(Wr.mixin(Sy,Zr,Uy,Yy,eb,rb)){constructor(...e){super(...e),v(this,"domConfigs",new Map),v(this,"drawingLive",!1),v(this,"lastScrollX",null),v(this,"highlighted",new Map),v(this,"visibleResources",null),v(this,"usingLinks",null),v(this,"visibleDateRange",null),v(this,"relativeTo",null)}static get pluginConfig(){return{chain:["render","onPaint","onElementClick","onElementDblClick","onElementMouseOver","onElementMouseOut","bindStore"],assign:["getElementForDependency","getElementsForDependency","resolveDependencyRecord"]}}construct(e,t){super.construct(e,t);const{scheduledEventName:n}=e;e.on({svgCanvasCreated:"onSVGReady",animationStart:"refresh",[n+"DragStart"]:"refresh",[n+"ResizeStart"]:"refresh",[n+"SegmentDragStart"]:"refresh",[n+"SegmentResizeStart"]:"refresh",timelineViewportResize:"reset",timeAxisViewModelUpdate:"reset",toggleNode:"reset",thisObj:this}),e.rowManager.on({refresh:"reset",changeTotalHeight:"reset",thisObj:this}),this.bindStore(e.store)}doDisable(e){this.isConfiguring||(this._isDisabling=e,this.draw(),this._isDisabling=!1),super.doDisable(e)}get rowStore(){return this.client.isVertical?this.client.resourceStore:this.client.store}bindStore(e){const t=this;t.client.isVertical||(t.detachListeners("store"),t.client.usesDisplayStore&&(null==e||e.on({name:"store",refresh:"onStoreRefresh",thisObj:t}),t.reset()))}onStoreRefresh(){this.reset()}attachToProject(e){super.attachToProject(e),null==e||e.on({name:"project",commitFinalized:"reset",thisObj:this})}attachToResourceStore(e){super.attachToResourceStore(e),null==e||e.on({name:"resourceStore",change:"onResourceStoreChange",refresh:"onResourceStoreChange",thisObj:this})}onResourceStoreChange(){this.usingLinks=null,this.reset()}attachToEventStore(e){super.attachToEventStore(e),null==e||e.on({name:"eventStore",refresh:"reset",thisObj:this})}attachToAssignmentStore(e){super.attachToAssignmentStore(e),null==e||e.on({name:"assignmentStore",refresh:"reset",thisObj:this})}attachToDependencyStore(e){super.attachToDependencyStore(e),null==e||e.on({name:"dependencyStore",change:"reset",refresh:"reset",thisObj:this})}updateDrawOnScroll(e){const t=this;t.detachListeners("scroll"),e?t.client.on({name:"scroll",scroll:"draw",horizontalScroll:{fn:"onHorizontalScroll",prio:-100},thisObj:t}):(t.client.scrollable.on({name:"scroll",scrollEnd:"draw",thisObj:t}),t.client.timeAxisSubGrid.scrollable.on({name:"scroll",scrollEnd:"draw",thisObj:t}))}onHorizontalScroll({subGrid:e,scrollX:t}){t!==this.lastScrollX&&e===this.client.timeAxisSubGrid&&(this.lastScrollX=t,this.draw())}onPaint(){this.refresh()}static getLocalizedDependencyType(e){return e?this.L(`L{DependencyType.${e}}`):""}getElementForDependency(e,t,n){return this.getElementsForDependency(e,t,n)[0]}getElementsForDependency(e,t,n){let r=`[data-dep-id="${e.id}"]`;return t&&(r+=`[data-from-id="${t.id}"]`),n&&(r+=`[data-to-id="${n.id}"]`),Array.from(this.client.svgCanvas.querySelectorAll(r))}resolveDependencyRecord(e){var t;return null===(t=e.elementData)||void 0===t?void 0:t.dependency}isDependencyElement(e){return e.matches(`.${this.baseCls}`)}onElementClick(e){const t=this.resolveDependencyRecord(e.target);if(t){const n="click"===e.type?"Click":"DblClick";this.client.trigger(`dependency${n}`,{dependency:t,event:e})}}onElementDblClick(e){return this.onElementClick(e)}onElementMouseOver(e){const t=this,n=t.resolveDependencyRecord(e.target);n&&(t.client.trigger("dependencyMouseOver",{dependency:n,event:e}),t.overCls&&(t.highlight(n),t.drawDependency(n)))}onElementMouseOut(e){const t=this,n=t.resolveDependencyRecord(e.target);n&&(t.client.trigger("dependencyMouseOut",{dependency:n,event:e}),t.overCls&&(t.unhighlight(n),t.drawDependency(n)))}isDependencyVisible(e){const{rowStore:t}=this,{fromEvent:n,toEvent:r}=e;if(!n||!r)return!1;const i=n.resource,s=r.resource;return!(!t.isAvailable(i)||!t.isAvailable(s))&&n.isModel&&!i.instanceMeta(t).hidden&&!s.instanceMeta(t).hidden}updateHighlightDependenciesOnEventHover(e){const t=this;if(e){const{client:e}=t;e.on({name:"highlightOnHover",[`${e.scheduledEventName}MouseEnter`]:e=>t.highlightEventDependencies(e.eventRecord||e.taskRecord),[`${e.scheduledEventName}MouseLeave`]:e=>t.unhighlightEventDependencies(e.eventRecord||e.taskRecord),thisObj:t})}else t.detachListeners("highlightOnHover")}highlight(e,t=this.overCls){let n=this.highlighted.get(e);n||this.highlighted.set(e,n=new Set),n.add(t),this.lineCache={},this.refresh()}unhighlight(e,t=this.overCls){const n=this.highlighted.get(e);n&&(n.delete(t),n.size||this.highlighted.delete(e)),this.lineCache={},this.refresh()}highlightEventDependencies(e,t){e.dependencies.forEach((e=>this.highlight(e,t)))}unhighlightEventDependencies(e,t){e.dependencies.forEach((e=>this.unhighlight(e,t)))}getDependenciesToConsider(e,t,n,r){var i,s;return null!==(i=null===(s=super.getDependenciesToConsider)||void 0===s?void 0:s.call(this,e,t,n,r))&&void 0!==i?i:this.project.dependencyStore.records.filter((e=>e.isValid))}getDependencyKey(e,t,n){return`dep:${e.id};from:${t.id};to:${n.id}`}drawDependency(e,t=!1,n=null){const r=this,{domConfigs:i,client:s,rowStore:o,visibleResources:a}=r,{eventStore:l,useInitialAnimation:c}=s,{idMap:d}=o,u=o.indexOf(a.first),h=o.indexOf(a.last),{startMS:g,endMS:m}=r.visibleDateRange,{fromEvent:p,toEvent:f}=e,v=p.assigned,y=f.assigned;let b=v&&[...v],C=y&&[...y];if(p.isScheduled&&f.isScheduled&&l.includes(p)&&l.includes(f)&&b&&C){r.usingLinks&&(b=b.flatMap(ib),C=C.flatMap(ib));for(const t of b)for(const a of C){var w,S,D,E;const l=null===(w=d[null===(S=t.resource)||void 0===S?void 0:S.id])||void 0===w?void 0:w.index,v=null===(D=d[null===(E=a.resource)||void 0===E?void 0:E.id])||void 0===D?void 0:D.index,y=Math.min(p.startDateMS,f.startDateMS),b=Math.max(p.endDateMS,f.endDateMS);if(s.isExporting||null!=l&&null!=v&&!1!==t.drawDependencies&&!1!==a.drawDependencies&&o.isAvailable(t.resource)&&o.isAvailable(a.resource)&&!(l<u&&v<u||l>h&&v>h||y<g&&b<g||y>m&&b>m)){const s=r.getDependencyKey(e,t,a),o=r.getDomConfig(e,t,a,n);o?(c&&(o.style={animationDelay:Math.max(l,v)/20*1e3+"ms"}),i.set(s,o)):i.delete(s)}r.afterDrawDependency(e,l,v,y,b)}}t||r.domSync()}afterDrawDependency(e,t,n,r,i){var s;null===(s=super.afterDrawDependency)||void 0===s||s.call(this,e,t,n,r,i)}beforeDraw(){var e;null===(e=super.beforeDraw)||void 0===e||e.call(this)}afterDraw(){var e;null===(e=super.afterDraw)||void 0===e||e.call(this)}domSync(e=this.client.svgCanvas){oa.sync({targetElement:e,domConfig:{onlyChildren:!0,children:Array.from(this.domConfigs.values())},syncIdField:"syncId",releaseThreshold:0,strict:!0,callback(){}})}fillDrawingCache(){const e=this,{client:t}=e;e.relativeTo=xn.from(t.foregroundCanvas),e.visibleResources=t.visibleResources,e.visibleDateRange=t.visibleDateRange,null==e.usingLinks&&(e.usingLinks=t.resourceStore.some((e=>e.hasLinks)))}draw(){const e=this,{client:t}=e;if(!t.refreshSuspended&&t.foregroundCanvas&&t.isEngineReady&&(!e.disabled||e._isDisabling)&&!t.isExporting){if(e.fillDrawingCache(),e.domConfigs.clear(),t.firstVisibleRow&&t.lastVisibleRow&&t.timeAxis.count&&!e.disabled){const{visibleDateRange:n,visibleResources:r}=t,i=e.rowStore.indexOf(r.first),s=e.rowStore.indexOf(r.last),o=e.getDependenciesToConsider(n.startMS,n.endMS,i,s);e.beforeDraw();for(const t of o)e.drawDependency(t,!0);e.afterDraw()}e.domSync(),t.trigger("dependenciesDrawn")}}doRefresh(){var e,t,n,r;const i=this,{client:s}=i,{scheduledEventName:o}=s;i.draw(),i.drawingLive=s.isAnimating||s.useInitialAnimation||(null===(e=s.features[`${o}Drag`])||void 0===e?void 0:e.isActivelyDragging)||(null===(t=s.features[`${o}Resize`])||void 0===t?void 0:t.isResizing)||(null===(n=s.features[`${o}SegmentDrag`])||void 0===n?void 0:n.isActivelyDragging)||(null===(r=s.features[`${o}SegmentResize`])||void 0===r?void 0:r.isResizing),i.drawingLive&&i.refresh()}refresh(){this.client.refreshSuspended||this.disabled||!this.client.isPainted||this.doRefresh()}reset(){var e;null===(e=super.reset)||void 0===e||e.call(this),this.refresh()}drawForEvent(){K.deprecate("Scheduler","6.0.0","Dependencies.drawForEvent() is no longer needed"),this.refresh()}render(){this.client.getConfig("svgCanvas")}}v(sb,"$name","Dependencies"),v(sb,"configurable",{overCls:"b-sch-dependency-over",baseCls:"b-sch-dependency",noMarkerCls:"b-sch-dependency-markerless",markerDef:null,radius:null,renderer:null,highlightDependenciesOnEventHover:null,drawOnScroll:!0}),v(sb,"delayable",{doRefresh:"raf"}),sb._$name="Dependencies",vg.registerFeature(sb,!1,["Scheduler","ResourceHistogram"]),vg.registerFeature(sb,!0,"SchedulerPro");class ob extends Ic{static get $name(){return"DependencyEditor"}static get defaultConfig(){return{items:[],draggable:{handleSelector:":not(button,.b-field-inner)"},axisLock:"flexible"}}processWidgetConfig(e){const{dependencyEditFeature:t}=this;return!("lagField"===e.ref&&!t.showLagField)&&!("deleteButton"===e.ref&&!t.showDeleteButton)&&super.processWidgetConfig(e)}afterShow(...e){const{deleteButton:t}=this.widgetMap;t&&(t.hidden=!this.record.isPartOfStore()),super.afterShow(...e)}onInternalKeyDown(e){this.trigger("keyDown",{event:e}),super.onInternalKeyDown(e)}}ob._$name="DependencyEditor";class ab extends Wr{static get $name(){return"DependencyEdit"}static get configurable(){return{autoClose:!0,saveAndCloseOnEnter:!0,showDeleteButton:!0,triggerEvent:"dependencydblclick",showLagField:!1,dependencyRecord:null,editorConfig:{title:"L{Edit dependency}",localeClass:this,closable:!0,defaults:{localeClass:this},items:{fromNameField:{type:"display",weight:100,label:"L{From}"},toNameField:{type:"display",weight:200,label:"L{To}"},typeField:{type:"combo",weight:300,label:"L{Type}",name:"type",editable:!1,valueField:"id",displayField:"name",localizeDisplayFields:!0,buildItems:function(){const e=this.parent;return Object.keys(ry.Type).map((t=>({id:ry.Type[t],name:e.L(t),localeKey:t})))}},lagField:{type:"duration",weight:400,label:"L{Lag}",name:"lag",allowNegative:!0}},bbar:{defaults:{localeClass:this},items:{foo:{type:"widget",cls:"b-label-filler"},saveButton:{color:"b-green",text:"L{Save}"},deleteButton:{color:"b-gray",text:"L{Delete}"},cancelButton:{color:"b-gray",text:"L{Object.Cancel}"}}}}}}construct(e,t){const n=this;if(e.dependencyEdit=n,super.construct(e,t),!e.features.dependencies)throw new Error("Dependencies feature required when using DependencyEdit");n.clientListenersDetacher=e.on({[n.triggerEvent]:n.onActivateEditor,thisObj:n})}doDestroy(){var e;this.clientListenersDetacher(),null===(e=this.editor)||void 0===e||e.destroy(),super.doDestroy()}changeEditorConfig(e){const{autoClose:t,cls:n,client:r}=this;return sn.assign({owner:r,align:"b-t",id:`${r.id}-dependency-editor`,autoShow:!1,anchor:!0,scrollAction:"realign",clippedBy:[r.timeAxisSubGridElement,r.bodyContainer],constrainTo:globalThis,autoClose:t,cls:n},e)}get isValid(){return Object.values(this.editor.widgetMap).every((e=>!(e.name&&!e.hidden)||!1!==e.isValid))}get values(){const e={};return this.editor.eachWidget((t=>{t.name&&!t.hidden&&(e[t.name]=t.value)}),!0),e}onBeforeSave(e){}onAfterSave(e){}updateRecord(e){const{values:t}=this;t.lag&&(t.lagUnit=t.lag.unit,t.lag=t.lag.magnitude),"type"in t&&(null!=e.fromSide&&(t.fromSide=null),null!=e.toSide&&(t.toSide=null)),sn.cleanupProperties(t,!0),e.set(t)}onPopupKeyDown({event:e}){"Enter"===e.key&&this.saveAndCloseOnEnter&&"input"===e.target.tagName.toLowerCase()&&(e.preventDefault(),this.onSaveClick())}onSaveClick(){this.save()&&this.editor.hide()}onDeleteClick(){this.deleteDependency(),this.editor.hide()}onCancelClick(){this.editor.hide()}internalShowEditor(e){const t=this,{client:n}=t;let r=t.lastPointerDownCoordinate;if(!1===n.trigger("beforeDependencyEdit",{dependencyEdit:t,dependencyRecord:e}))return;const i=t.getEditor(e);if(t.loadRecord(e),n.trigger("beforeDependencyEditShow",{dependencyEdit:t,dependencyRecord:e,editor:i}),!r){const e=xn.from(t.client.element).center;r=[e.x-i.width/2,e.y-i.height/2]}i.showBy(r)}editDependency(e){this.client.readOnly||e.readOnly||this.internalShowEditor(e)}getEditor(){var e,t,n;const r=this;let{editor:i}=r;return i||(i=r.editor=ob.new({dependencyEditFeature:r,autoShow:!1,anchor:!0,scrollAction:"realign",constrainTo:globalThis,autoClose:r.autoClose,cls:r.cls,rootElement:r.client.rootElement,listeners:{keydown:r.onPopupKeyDown,thisObj:r}},r.editorConfig),0===i.items.length&&console.warn("Editor configured without any `items`"),i.eachWidget((e=>{const t=e.ref||e.id;t&&!r[t]&&(r[t]=e)})),null===(e=r.saveButton)||void 0===e||e.on("click",r.onSaveClick,r),null===(t=r.deleteButton)||void 0===t||t.on("click",r.onDeleteClick,r),null===(n=r.cancelButton)||void 0===n||n.on("click",r.onCancelClick,r),r.editor)}loadRecord(e){const t=this;t.fromNameField.value=e.fromEvent.name,t.toNameField.value=e.toEvent.name,t.lagField&&(t.lagField.value=new Bi(e.lag,e.lagUnit)),t.editor.record=t.dependencyRecord=e}async save(){const e=this,{client:t,dependencyRecord:n}=e;if(!n||!e.isValid)return;const{dependencyStore:r,values:i}=e;if(!1!==t.trigger("beforeDependencySave",{dependencyRecord:n,values:i})){var s;if(e.onBeforeSave(n),e.updateRecord(n),r&&!n.stores.length){if(!1===t.trigger("beforeDependencyAdd",{dependencyRecord:n,dependencyEdit:e}))return;r.add(n)}await(null===(s=t.project)||void 0===s?void 0:s.commitAsync()),t.trigger("afterDependencySave",{dependencyRecord:n}),e.onAfterSave(n)}return n}async deleteDependency(){const{client:e,editor:t,dependencyRecord:n}=this;var r;return!1!==e.trigger("beforeDependencyDelete",{dependencyRecord:n})&&(t.containsFocus&&t.revertFocus(),e.dependencyStore.remove(n),await(null===(r=e.project)||void 0===r?void 0:r.commitAsync()),!0)}get dependencyStore(){return this.client.dependencyStore}onActivateEditor({dependency:e,event:t}){this.disabled||(this.lastPointerDownCoordinate=[t.clientX,t.clientY],this.editDependency(e))}}ab._$name="DependencyEdit",vg.registerFeature(ab,!1);class lb extends(Wr.mixin(Zr)){static get $name(){return"ScheduleContext"}construct(e,t){super.construct(e,t);const{triggerEvent:n}=this,r={datachange:"syncContextElement",timeaxisviewmodelupdate:"onTimeAxisViewModelUpdate",presetchange:"clearContext",thisObj:this};"mouseover"===n?r.timelineContextChange="onTimelineContextChange":("click"!==n&&"mousedown"!==n||(r.schedulecontextmenu="onScheduleContextGesture"),Object.assign(r,f({[`schedule${n}`]:"onScheduleContextGesture",[`event${n}`]:"onScheduleContextGesture"},r))),e.useBackgroundCanvas=!0,e.on(r),e.rowManager.on({rowheight:"syncContextElement",thisObj:this})}changeTriggerEvent(e){return"hover"!==e&&"mousemove"!==e||(e="mouseover"),e}get element(){return this._element||(this._element=Mr.createElement({parent:this.client.backgroundCanvas,className:"b-schedule-selected-tick"}))}onTimelineContextChange({context:e}){this.context=e}onScheduleContextGesture(e){this.context=e}onTimeAxisViewModelUpdate({source:e}){var t;e.timeAxis.includes(null===(t=this.context)||void 0===t?void 0:t.tick)?this.syncContextElement():this.clearContext()}clearContext(){this.context=null}updateContext(e,t){this.syncContextElement()}syncContextElement(){if(this.context){const e=this,{client:t,element:n,context:r,renderer:i}=e,{isVertical:s}=t,{style:o}=n,a=s?t.rowManager.rows[0]:t.getRowFor(r.resourceRecord);if(a){const{tickStartDate:l,tickEndDate:c,resourceRecord:d}=r,u=t.currentOrientation.getTimeSpanRenderData({startDate:l,endDate:c,startDateMS:l.getTime(),endDateMS:c.getTime()},d);let h,g,m;s?(h=u.top,g=u.resourceWidth,m=u.height):(h=a.top,g=u.width,m=a.height),o.display="",o.width=`${g}px`,o.height=`${m}px`,Mr.setTranslateXY(n,u.left,h),r.index=a.index,n.innerHTML="",i&&e.callback(i,e,[r,n])}else o.display="none"}else this.element.style.display="none"}}v(lb,"delayable",{syncContextElement:"raf"}),v(lb,"configurable",{triggerEvent:"click",renderer:null,context:{$config:{equal(e,t){return(null==e?void 0:e.index)===(null==t?void 0:t.index)&&(null==e?void 0:e.tickParentIndex)===(null==t?void 0:t.tickParentIndex)&&!(((null==e?void 0:e.tickStartDate)||0)-((null==t?void 0:t.tickStartDate)||0))}}}}),lb.featureClass="b-scheduler-context",lb._$name="ScheduleContext",vg.registerFeature(lb,!1,["Scheduler"]);class cb extends Wr{constructor(...e){super(...e),v(this,"clipboardRecords",[])}construct(e,t){super.construct(e,t),e.features.scheduleContext&&(e.features.scheduleContext.disabled=!1),e.on({eventclick:this.onEventClick,scheduleclick:this.onScheduleClick,thisObj:this}),this.scheduler=e}onEventDataGenerated(e){const{assignmentRecord:t}=e;t&&(e.cls["b-cut-item"]=t.meta.isCut)}onEventClick(e){this._cellClickedContext=null}onScheduleClick(e){this._cellClickedContext=e}isActionAvailable(e,t,n){const r=this.client.features.cellEdit;return!this.disabled&&0===globalThis.getSelection().toString().length&&!(null!=r&&r.isEditing)&&Boolean(n.target.closest(".b-timeaxissubgrid"))}copy(){this.copyEvents()}cut(){this.copyEvents(void 0,!0)}paste(){this.pasteEvents()}copyEvents(e=this.scheduler.selectedAssignments,t=!1){const n=this,{scheduler:r}=n;if(null==e||!e.length)return;let i=e.slice();e[0].isEventModel&&(i=e.map((e=>e.assignments)).flat()),t&&(i=i.filter((e=>!e.event.readOnly)));const s=i.map((e=>e.event));i.length&&!r.readOnly&&!1!==r.trigger("beforeCopy",{assignmentRecords:i,records:s,eventRecords:s,isCut:t})&&(i.length>0&&r.trigger("copy",{assignmentRecords:i,eventRecords:s,isCut:t}),n._isCut=t,n.clipboard={assignmentRecords:i,eventRecords:s},r.assignmentStore.forEach((e=>{e.meta.isCut=t&&i.includes(e)})),r.refreshWithTransition())}pasteEvents(e,t){const n=this,{clipboard:r,scheduler:i}=n,{assignmentRecords:s,eventRecords:o}=r,a=n._isCut;if(0===arguments.length){const r=n._cellClickedContext||{};e=r.date,t=r.resourceRecord}if(t){if(t.readOnly)return;t=t.$original}if(!r||!1===i.trigger("beforePaste",{assignmentRecords:s,records:o,eventRecords:o,resourceRecord:t||s[0].resource,date:e,isCut:a}))return;let l=null;const c=new Set;for(const r of s){let{event:s}=r;const o=t||r.resource,d=e||r.event.startDate;if(c.has(s))a&&r.remove();else{if(c.add(s),a)r.meta.isCut=!1,r.resource=o,l=r;else if(i.eventStore.usesSingleAssignment||"clone"===n.copyPasteAction)s=s.copy(),s.name=n.generateNewName(s),i.eventStore.add(s),s.assign(o),l=i.assignmentStore.last;else if(!s.resources.includes(o)){const e=r.copy();e.resource=o,[l]=i.assignmentStore.add(e)}s.startDate=d,s.constraintDate&&(s.constraintDate=null)}}r&&i.trigger("paste",{assignmentRecords:s,eventRecords:o,resourceRecord:t,date:e,isCut:a});const d=i.on({renderEvent({assignmentRecord:e,element:t}){e===l&&(t.focus(),d())}});a&&n.clearClipboard()}clearClipboard(){const e=this;e._isCut&&(e.clipboard.assignmentRecords.forEach((e=>{e.meta.isCut=!1})),e.scheduler.refreshWithTransition(),e._isCut=!1),e.clipboard=null}populateEventMenu({assignmentRecord:e,items:t}){const n=this;n.scheduler.readOnly||(t.copyEvent={text:"L{copyEvent}",localeClass:n,icon:"b-icon b-icon-copy",weight:110,onItem:()=>n.copyEvents([e].concat(n.scheduler.selectedAssignments.filter((t=>t!==e))))},t.cutEvent={text:"L{cutEvent}",localeClass:n,icon:"b-icon b-icon-cut",weight:120,disabled:e.event.readOnly,onItem:()=>n.copyEvents([e].concat(n.scheduler.selectedAssignments.filter((t=>t!==e))),!0)})}populateScheduleMenu({items:e,resourceRecord:t}){const n=this,{scheduler:r}=n;!r.readOnly&&n.clipboard&&(e.pasteEvent={text:"L{pasteEvent}",localeClass:n,icon:"b-icon b-icon-paste",disabled:0===r.resourceStore.count||t.readOnly,weight:110,onItem:({date:e,resourceRecord:t})=>n.pasteEvents(e,t,r.getRowFor(t))})}generateNewName(e){const t=e[this.nameField];let n=2;for(;this.client.eventStore.findRecord(this.nameField,`${t} - ${n}`);)n++;return`${t} - ${n}`}}v(cb,"$name","EventCopyPaste"),v(cb,"pluginConfig",{assign:["copyEvents","pasteEvents"],chain:["populateEventMenu","populateScheduleMenu","onEventDataGenerated"]}),v(cb,"configurable",{nameField:"name",keyMap:{"Ctrl+C":"copy","Ctrl+X":"cut","Ctrl+V":"paste"},copyPasteAction:"clone"}),cb.featureClass="b-event-copypaste",cb._$name="EventCopyPaste",vg.registerFeature(cb,!0,"Scheduler");class db extends ky{static get $name(){return"EventDrag"}static get defaultConfig(){return{constrainDragToResource:!1,constrainDragToTimeSlot:!1,externalDropTargetSelector:null,validatorFn:()=>{},validatorFnThisObj:null,unifiedDrag:null,snapToPosition:null,capitalizedEventName:null}}afterConstruct(){this.capitalizedEventName=this.capitalizedEventName||this.client.capitalizedEventName,super.afterConstruct(...arguments)}get scheduler(){return this.client}getDraggableElement(e){return null==e?void 0:e.closest(this.drag.targetSelector)}resolveEventRecord(e,t=this.client){return t.resolveEventRecord(e)}isElementDraggable(e,t){var n;const r=this,{client:i}=r,s=r.getDraggableElement(e);if(!s||r.disabled||i.readOnly)return!1;if(e.matches('[class$="-handle"]'))return!1;const o=r.resolveEventRecord(s,i);return!(!o||!o.isDraggable||o.readOnly)&&!(!1===(null===(n=i[`is${r.capitalizedEventName}ElementDraggable`])||void 0===n?void 0:n.call(i,s,o,e,t)))}getTriggerParams(e){const{assignmentRecords:t,eventRecords:n,resourceRecord:r,browserEvent:i}=e;return{context:e,eventRecords:n,resourceRecord:r,assignmentRecords:t,event:i}}triggerBeforeEventDrag(e,t){return this.client.trigger(e,t)}triggerEventDrag(e,t){this.client.trigger("eventDrag",Object.assign(this.getTriggerParams(e),{startDate:e.startDate,endDate:e.endDate,newResource:e.newResource}))}triggerDragStart(e){this.client.navigator.skipNextClick=!0,this.client.trigger("eventDragStart",this.getTriggerParams(e))}triggerDragAbort(e){this.client.trigger("eventDragAbort",this.getTriggerParams(e))}triggerDragAbortFinalized(e){this.client.trigger("eventDragAbortFinalized",this.getTriggerParams(e))}triggerAfterDrop(e,t){const n=this;if(n.currentOverClient.trigger("afterEventDrop",Object.assign(n.getTriggerParams(e),{valid:t})),!t){const{assignmentStore:e,eventStore:t}=n.client;n.dragData.initialAssignmentsState.find((({resource:r,assignment:i},s)=>{var o;return!e.includes(i)||!t.includes(i.event)||r.id!==(null===(o=n.dragData.assignmentRecords[s])||void 0===o?void 0:o.resourceId)}))&&n.client.refresh()}n.client.setTimeout((()=>n.client.navigator.skipNextClick=!1),10)}isValidDrop(e){const{newResource:t,resourceRecord:n}=e,r=e.draggedEntities[0];return t?!(t.isSpecialRow||t.readOnly||n!==t&&r.event.resources.includes(t)):!(this.constrainDragToTimeline||!this.externalDropTargetSelector)&&Boolean(e.browserEvent.target.closest(this.externalDropTargetSelector))}checkDragValidity(e,t){var n;const r=this,i=r.currentOverClient;let s;return(null===(n=e.newResource)||void 0===n||!n.readOnly)&&(s=i.allowOverlap||i.isDateRangeAvailable(e.startDate,e.endDate,e.draggedEntities[0],e.newResource)?r.validatorFn.call(r.validatorFnThisObj||r,e,t):{valid:!1,message:r.L("L{eventOverlapsExisting}")},(!s||s.valid)&&(s=null!==(o=null===(a=i.checkEventDragValidity)||void 0===a?void 0:a.call(i,e,t))&&void 0!==o?o:s),s);var o,a}async updateRecords(e){const t=this,n=t.client,r=t.currentOverClient;let i;return e.externalDropTarget||(n.eventStore.suspendAutoCommit(),r.eventStore.suspendAutoCommit(),i=await t.updateAssignments(n,r,e,!1),n.eventStore.resumeAutoCommit(),r.eventStore.resumeAutoCommit()),r.trigger("eventDrop",Object.assign(t.getTriggerParams(e),{isCopy:!1,event:e.browserEvent,targetEventRecord:e.targetEventRecord,targetResourceRecord:e.newResource,externalDropTarget:e.externalDropTarget})),i}async updateAssignments(e,t,n,r){const i=this,s=e!==t,{isVertical:o}=t,{assignmentStore:a,eventStore:l}=e,{assignmentStore:c,eventStore:d}=t,u=e.isVertical?e.resourceStore:e.store,h=o?t.resourceStore:t.store,{eventRecords:g,assignmentRecords:m,timeDiff:p,initialAssignmentsState:v,resourceRecord:y,newResource:b}=n,{unifiedDrag:C}=i,w=i.adjustStartDate(m[0].event.startDate,p),S=[],D=[],E=[],x=[],R=[],T=new Set;e.suspendRefresh(),t.suspendRefresh();let M,k=!1,I=!1;M=s?h.indexOf(b)-u.indexOf(y):i.constrainDragToResource?0:u.indexOf(y)-u.indexOf(b),o&&g.forEach(((t,r)=>{const i=n.eventBarEls[r];delete t.instanceMeta(e).hasTemporaryDragElement,i.dataset.transient&&i.remove()}));const A=n.eventBarEls.slice(),F=[];for(let e=0;e<m.length;e++){let o=m[e],g=o.event;if(!(o.isOccurrenceAssignment||a.includes(o)&&l.includes(g))){A[e].remove(),A.splice(e,1),m.splice(e,1),e--;continue}const y=v[e],O=g,L=y.startDate,P=y.resource,$=this.constrainDragToTimeSlot?L:C?w:i.adjustStartDate(L,p);if(r)o=o.copy(null),E.push(o);else if(a!==c){const e=O.assignments.length>1,t=o.copy();t.event&&(t.event=t.event.id,t.resource=null),x.push(o),e||D.push(O),d.getById(O.id)||(g=f(f({},O.data),{},{id:O.id,calendar:null}),S.push(g)),d.usesSingleAssignment||E.push(t),o=t}let _=b,N=null;if(!C)if(s){if(e>0){const e=u.indexOf(P);_=h.getAt(e+M)||_}}else if(0!==M){const e=Math.max(Math.min(u.indexOf(P)-M,u.count-1),0);_=u.getAt(e),_.isSpecialRow&&(_=u.getNext(_,!1,!0)||u.getPrevious(_,!1,!0)),_=_.$original}else _=P;if(o.resource!==_&&(N=o.resource,o.resource=_,g.isEvent&&T.add(g),k=!0,g.isOccurrence&&g.set("newResource",_),s&&d.usesSingleAssignment&&(g.resourceId=_.id)),!R.find((e=>e.draggedEvent===g))&&!en.isEqual(g.startDate,$)){for(;!g.isOccurrence&&g.isBatchUpdating;)g.endBatch(!0);g.startDate=$,R.push({draggedEvent:g,originalStartDate:L}),g.isEvent&&T.add(g),I=!0}t.processEventDrop({eventRecord:g,resourceRecord:_,element:0===e?n.context.element:n.context.relatedElements[e-1],context:n,toScheduler:t,reassignedFrom:N,eventsToAdd:S,addedEvents:F,draggedAssignment:o})}if(a.remove(x),l.remove(D),c.add(E),S.length&&F.push(...d.add(S)),!i.constrainDragToTimeline)for(let e=0;e<m.length;e++){const r=m[e].event,i=(null==F?void 0:F.find((e=>e.id===r.id)))||r,o=n.eventBarEls[e],a=0===e?n.context.element:n.context.relatedElements[e-1],l=t.isInTimeAxis(i);if(oa.removeChild(o.parentElement,o),i.resource&&t.rowManager.getRowFor(i.resource)&&l){if(!i.parent||i.parent.isRoot){const e=xn.from(a,t.foregroundCanvas,!0);Mr.setTopLeft(a,e.y,e.x),oa.addChild(t.foregroundCanvas,a,i.assignments[0].id),s&&t.processCrossSchedulerEventDrop({eventRecord:i,toScheduler:t})}a.classList.remove("b-sch-event-hover","b-active","b-drag-proxy","b-dragging"),a.retainElement=!1}}null==F||F.forEach((e=>T.add(e))),(x.length||D.length||E.length||S.length)&&(k=!0),(k||I)&&(d.usesSingleAssignment&&T.forEach((e=>e.beginBatch())),await Promise.all([t.project!==e.project?t.project.commitAsync():null,e.project.commitAsync()]),d.usesSingleAssignment&&T.forEach((e=>e.endBatch(!1,!0)))),k||(k=R.some((({draggedEvent:e,originalStartDate:t})=>!en.isEqual(e.startDate,t)))),t.resumeRefresh(),e.resumeRefresh(),m.length>0&&(k?(t.fillTicks&&A.forEach((e=>delete e.lastDomConfig)),t.refreshWithTransition(),s&&(e.refreshWithTransition(),t.selectedEvents=F)):n.valid=!1)}getProductDragContext(e){const t=this,{currentOverClient:n}=t,r=e.browserEvent.target,i=e.newResource||e.resourceRecord,s=e.targetEventRecord;let o,a,l=n?t.resolveEventRecord(r,n):null;e.eventRecords.includes(l)&&(l=null),t.constrainDragToResource?o=e.resourceRecord:t.constrainDragToTimeline?n&&(o=t.resolveResource()||e.newResource||e.resourceRecord):o=t.resolveResource();const{assignmentRecords:c,eventRecords:d}=e,u=i!==o;let h=Boolean(o&&!o.isSpecialRow);return!o&&t.externalDropTargetSelector&&(a=r.closest(t.externalDropTargetSelector),h=Boolean(a)),{valid:h,externalDropTarget:a,eventRecords:d,assignmentRecords:c,newResource:o,targetEventRecord:l,dirty:u||l!==s}}getMinimalDragData(e){const t=this,{scheduler:n}=t,r=t.getElementFromContext(e),i=t.resolveEventRecord(r,n),s=n.resolveResourceRecord(r),o=n.resolveAssignmentRecord(r),a=o?[o]:[];return o&&(n.isAssignmentSelected(a[0])||t.drag.startEvent.ctrlKey)&&a.push.apply(a,t.getRelatedRecords(o)),{eventRecord:i,resourceRecord:s,assignmentRecord:o,eventRecords:[...new Set(a.map((e=>e.event)))],assignmentRecords:a}}setupProductDragData(e){var t;const n=this,{scheduler:r}=n,i=n.getElementFromContext(e),{eventRecord:s,resourceRecord:o,assignmentRecord:a,assignmentRecords:l}=n.getMinimalDragData(e),c=[];if(n.constrainDragToResource&&!o)throw new Error("Resource could not be resolved for event: "+s.id);let d;if(n.constrainDragToTimeline){var u;d=null===(u=n.getDateConstraints)||void 0===u?void 0:u.call(n,o,s);const e=n.constrainRectangle=n.getConstrainingRectangle(d,o,s),t=xn.from(i,r.timeAxisSubGridElement);super.setupConstraints(e,t,r.timeAxisViewModel.snapPixelAmount,Boolean(d.start))}return l.forEach((e=>{let t=r.getElementFromAssignmentRecord(e,!0);t||(t=r.currentOrientation.addTemporaryDragElement(e.event,e.resource)),c.push(t)})),{record:a,draggedEntities:l,dateConstraints:null!==(t=d)&&void 0!==t&&t.start?d:null,eventBarEls:c}}getDateConstraints(e,t){var n;const{scheduler:r}=this,i=null===(n=r.getDateConstraints)||void 0===n?void 0:n.call(r,e,t);let s,o;return this.constrainDragToTimeSlot?(s=t.startDate,o=t.endDate):i&&(s=i.start,o=i.end),{start:s,end:o}}getConstrainingRectangle(e,t,n){return this.scheduler.getScheduleRegion(this.constrainDragToResource&&t,n,!0,e&&{start:e.start,end:e.end})}getDragData(e){const t=this.getMinimalDragData(e)||{};return f(f(f({},super.getDragData(e)),t),{},{initialAssignmentsState:t.assignmentRecords.map((e=>({startDate:e.event.startDate,resource:e.resource,assignment:e})))})}getRelatedRecords(e){return this.scheduler.selectedAssignments.filter((t=>t!==e&&!t.resource.readOnly&&t.event.isDraggable))}getCoordinate(e,t,n){const r=this.currentOverClient;if(r.isHorizontal){let i=n[0];if("default"!==r.milestoneLayoutMode&&e.isMilestone)switch(r.milestoneAlign){case"center":i+=t.offsetWidth/2;break;case"end":i+=t.offsetWidth}return i}{let i=n[1];if("default"!==r.milestoneLayoutMode&&e.isMilestone)switch(r.milestoneAlign){case"center":i+=t.offsetHeight/2;break;case"end":i+=t.offsetHeight}return i}}resolveResource(){const e=this,t=e.currentOverClient,{isHorizontal:n}=t,{context:r,browserEvent:i,dragProxy:s}=e.dragData,o=s||r.element,a=xn.from(o,null,!0),l=t.isVertical||e.unifiedDrag?r.clientY:a.center.y,c=xn.from(o,t.timeAxisSubGridElement,!0),{x:d,y:u}=c.center,h=e.getMouseMoveEventTarget(i);let g=null;if(t.element.contains(h))if(n){const e=t.rowManager.getRowAt(l);g=e&&t.store.getAt(e.dataIndex)}else g=t.resolveResourceRecord(t.timeAxisSubGridElement.querySelector(".b-sch-timeaxis-cell"),[d,u]);return g}adjustStartDate(e,t){const n=this.currentOverClient;return n.timeAxis.roundDate(new Date(e-0+t),!!n.snapRelativeToEventStartDate&&e)}getRecordElement(e){return this.client.getElementFromAssignmentRecord(e,!0)}getMouseMoveEventTarget(e){return e.target}}db._$name="EventDrag",vg.registerFeature(db,!0,"Scheduler"),vg.registerFeature(db,!1,"ResourceHistogram");class ub extends Oy{get scheduler(){return this.client}get store(){return this.client.eventStore}updateLockLayout(e){this.dragActiveCls="b-dragcreating"+(e?" b-dragcreate-lock":"")}handleBeforeDragCreate(e,t,n){var r;const{resourceRecord:i}=e;if(i.readOnly)return!1;const{scheduler:s}=this,o=(!s.isSchedulerPro||i.isWorkingTime(e.mousedownDate))&&s.trigger("beforeDragCreate",{resourceRecord:i,date:e.mousedownDate,event:n});return this.dateConstraints=null===(r=s.getDateConstraints)||void 0===r?void 0:r.call(s,i,t),o}dragStart(e){var t;const n=this,{client:r}=n,{eventStore:i,assignmentStore:s,enableEventAnimations:o}=r,{resourceRecord:a}=e,l=n.createEventRecord(e),c=[a];if(l.set("duration",en.diff(l.startDate,l.endDate,l.durationUnit,!0)),l.isCreating=!0,l.meta.isDragCreating=!0,r.features.taskEdit&&r.features.taskEdit.doCancel(),!1===n.handleBeforeDragCreate(e,l,e.event))return!1;let d=[];return a&&(d=s.assignEventToResource(l,a)),!1===r.trigger("beforeEventAdd",{eventRecord:l,resourceRecords:c,assignmentRecords:d})?(s.remove(d),!1):(n.lockLayout&&(l.meta.excludeFromLayout=!0),null===(t=r.onEventCreated)||void 0===t||t.call(r,l),r.enableEventAnimations=!1,i.addAsync(l).then((()=>r.enableEventAnimations=o)),r.isCreating=!0,r.refreshRows(),r.isCreating=!1,e.itemElement=e.element=r.getElementFromEventRecord(l),Mr.isInView(e.itemElement)||r.scrollable.scrollIntoView(e.itemElement,{animate:!0,edgeOffset:r.barMargin}),super.dragStart(e))}checkValidity(e,t){const n=this,{client:r}=n;return e.resourceRecord=n.dragging.resourceRecord,(r.allowOverlap||r.isDateRangeAvailable(e.startDate,e.endDate,e.eventRecord,e.resourceRecord))&&n.createValidatorFn.call(n.validatorFnThisObj||n,e,t)}isRowEmpty(e){const t=this.store.getEventsForResource(e);return!t||!t.length}triggerBeforeFinalize(e){this.client.trigger("beforeDragCreateFinalize",e)}createEventRecord(e){const t=this,{client:n}=t,r=n.isHorizontal?"X":"Y",{timeAxis:i,eventStore:s,weekStartDay:o}=n,{event:a,mousedownDate:l}=e,c=t.draggingEnd=a[`page${r}`]>e.startEvent[`page${r}`],d={name:s.modelClass.fieldMap.name.defaultValue||t.L("L{Object.newEvent}"),startDate:c?en.floor(l,i.resolution,null,o):l,endDate:c?l:en.ceil(l,i.resolution,null,o)};return n.project.isGanttProjectMixin&&sn.assign(d,{constraintDate:d.startDate,constraintType:"startnoearlierthan"}),s.createRecord(d)}async finalizeDragCreate(e){const{meta:t}=e.eventRecord;return t.excludeFromLayout=!1,t.isDragCreating=!1,this.client.hasEventEditor||(e.eventRecord.isCreating=!1),super.finalizeDragCreate(e)}getTipHtml(...e){const t=super.getTipHtml(...e),{element:n}=this.tip;return n.classList.add("b-sch-dragcreate-tooltip"),n.classList.toggle("b-too-narrow",this.dragging.context.tooNarrow),t}onAborted(e){var t,n;const{eventRecord:r,resourceRecord:i}=e;null===(t=(n=this.store).unassignEventFromResource)||void 0===t||t.call(n,r,i),this.store.remove(r)}}v(ub,"$name","EventDragCreate"),v(ub,"configurable",{validatorFn:()=>!0,lockLayout:!1}),ub._$name="EventDragCreate",vg.registerFeature(ub,!0,"Scheduler"),vg.registerFeature(ub,!1,"ResourceHistogram");class hb extends(Zr(Wr)){constructor(...e){super(...e),v(this,"targetSelector",".b-sch-timeaxis-cell, .b-timeaxissubgrid")}construct(e,t){e.multiEventSelect=!0,super.construct(e,t)}onElementMouseDown(e){const t=this,{client:n}=t,{foregroundCanvas:r}=n,{target:i,button:s,touches:o,clientX:a,clientY:l}=e,c=xn.from(r,!0);o||0!==s||t.disabled||!i.matches(t.targetSelector)||!1===n.trigger("beforeEventDragSelect",{event:e})||(t.startX=a-c.x,t.startY=l-c.y,t.element=Mr.createElement({tag:"div",className:"b-dragselect-rect",parent:n.foregroundCanvas,retainElement:!0,style:{transform:`translate(${t.startX}px, ${t.startY}px)`}}),n.element.classList.add("b-dragselecting"),n.clearEventSelection(),t.subGridElementRect=xn.from(n.timeAxisSubGridElement,!0),n.navigator.disabled=!0,n.enableScrollingCloseToEdges(n.timeAxisSubGrid),t.mouseUpDetacher=_n.on({element:document,mouseup:"onDocumentMouseUp",thisObj:t}))}get eventRectangles(){const{client:e}=this;return Array.from(e.element.querySelectorAll(e.eventSelector)).map((t=>({rectangle:xn.from(t,!0),record:e.resolveAssignmentRecord(t)})))}onElementMouseMove(e){const t=this;if("number"==typeof t.startX){const n=t.rectangle=xn.from(t.client.foregroundCanvas,!0),r=Math.min(Math.max(e.clientX-n.x,0),n.width+1),i=Math.min(Math.max(e.clientY-n.y,0),n.height+1),s=new xn(t.startX,t.startY,r-t.startX,i-t.startY);Mr.setTranslateXY(t.element,s.x,s.y),t.element.style.width=`${s.width}px`,t.element.style.height=`${s.height}px`,t.updateSelection()}}onDocumentMouseUp(e){var t;const n=this,{client:r}=n,{selectedAssignments:i,navigator:s}=r;var o;r.disableScrollingCloseToEdges(r.timeAxisSubGrid),null===(t=n.element)||void 0===t||t.remove(),r.element.classList.remove("b-dragselecting"),n.startX=n.startY=null,s.skipNextClick=r.timeAxisSubGridElement.contains(e.target),s.disabled=!1,i.length&&(s.skipScrollIntoView=!0,r.activeAssignment=i[i.length-1],null===(o=s.activeItem)||void 0===o||o.focus(),s.skipScrollIntoView=!1),n.mouseUpDetacher()}updateSelection(){const e=this,t=e.rectangle=xn.from(e.element,!0),{eventRectangles:n,client:r}=e,i=r.selectedAssignments.reduce(((e,t)=>(r.getElementFromAssignmentRecord(t)||e.push(t),e)),[]);for(const e of n)t.intersect(e.rectangle,!0)&&!e.selected&&(e.selected=!0,i.push(e.record));r.selectedAssignments=i}}v(hb,"$name","EventDragSelect"),v(hb,"pluginConfig",{chain:["onElementMouseDown","onElementMouseMove"]}),hb._$name="EventDragSelect",vg.registerFeature(hb,!1,"Scheduler");class gb extends Ic{static get type(){return"eventeditor"}static get $name(){return"EventEditor"}static get configurable(){return{items:[],draggable:{handleSelector:":not(button,.b-field-inner)"},axisLock:"flexible",scrollable:{overflowY:!0},readOnly:null,titleRenderer:null}}updateLocalization(){super.updateLocalization(...arguments),this.initialTitle=this.title||""}chainResourceStore(){return this.eventEditFeature.resourceStore.chain((e=>!e.isSpecialRow),null,{storeClass:As,excludeCollapsedRecords:!1})}processWidgetConfig(e){var t;if(null!==(t=e.type)&&void 0!==t&&t.includes("date")&&null==e.weekStartDay&&(e.weekStartDay=this.weekStartDay),"extraItems"===e.type)return!1;const{eventEditFeature:n}=this,r={};if("resourceField"===e.ref){const{store:t}=e;e.store=this.chainResourceStore(),t&&e.store.setConfig(t),"multiSelect"in e||(e.multiSelect=!n.eventStore.usesSingleAssignment)}return"startDate"!==e.name&&"endDate"!==e.name||"date"!==e.type||(r.format=n.dateFormat),"startDate"!==e.name&&"endDate"!==e.name||"time"!==e.type||(r.format=n.timeFormat),Object.assign(e,r),super.processWidgetConfig(e)}show(...e){var t;const{resourceField:n}=this.widgetMap;n&&(null===(t=n.store)||void 0===t?void 0:t.masterStore)!==this.eventEditFeature.resourceStore&&(n.store=this.chainResourceStore()),super.show(...e)}onBeforeShow(...e){const t=this,{record:n,titleRenderer:r}=t,i=t.widgetMap.deleteButton;i&&(i.hidden=t.readOnly||n.isCreating),t.title=r?t.callback(r,t,[n]):t.initialTitle,super.onBeforeShow&&super.onBeforeShow(...e)}onInternalKeyDown(e){this.trigger("keyDown",{event:e}),super.onInternalKeyDown(e)}updateReadOnly(e){const{deleteButton:t,saveButton:n,cancelButton:r}=this.widgetMap;super.updateReadOnly(e),t&&(t.hidden=e),n&&(n.hidden=e),r&&(r.hidden=e)}}gb.initClass(),gb._$name="EventEditor";class mb extends Ic{static get $name(){return"RecurrenceConfirmationPopup"}static get type(){return"recurrenceconfirmation"}static get defaultConfig(){return{localizableProperties:[],align:"b-t",autoShow:!1,autoClose:!1,closeAction:"onRecurrenceClose",modal:!0,centered:!0,scrollAction:"realign",constrainTo:globalThis,draggable:!0,closable:!0,floating:!0,eventRecord:null,cls:"b-sch-recurrenceconfirmation",bbar:{defaults:{localeClass:this},items:{changeSingleButton:{weight:100,cls:"b-raised",color:"b-blue",text:"L{update-only-this-btn-text}",onClick:"up.onChangeSingleButtonClick"},changeMultipleButton:{weight:200,color:"b-green",text:"L{Object.Yes}",onClick:"up.onChangeMultipleButtonClick"},cancelButton:{weight:300,color:"b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelButtonClick"}}}}}get changeMultipleButton(){return this.widgetMap.changeMultipleButton}get changeSingleButton(){return this.widgetMap.changeSingleButton}get cancelButton(){return this.widgetMap.cancelButton}onChangeMultipleButtonClick(){this.processMultipleRecords(),this.hide()}onChangeSingleButtonClick(){this.processSingleRecord(),this.hide()}onCancelButtonClick(){this.cancelFn&&this.cancelFn.call(this.thisObj),this.hide()}onRecurrenceClose(){this.cancelFn&&this.cancelFn.call(this.thisObj),this.hide()}confirm(e={}){const t=this;return["actionType","eventRecord","title","html","changerFn","cancelFn","thisObj"].forEach((n=>{n in e&&(t[n]=e[n])})),t.updatePopupContent(),super.show(e)}updatePopupContent(){const e=this,{changeMultipleButton:t,changeSingleButton:n,cancelButton:r}=e.widgetMap,{eventRecord:i,actionType:s="update"}=e;(null==i?void 0:i.isRecurring)?(t.text=e.L("L{Object.Yes}"),e.html=e.L(`${s}-all-message`)):(t.text=e.L(`${s}-further-btn-text`),e.html=e.L(`${s}-further-message`)),n.text=e.L(`${s}-only-this-btn-text`),r.text=e.L("L{Object.Cancel}"),e.width=e.L("L{width}"),e.title=e.L(`${s}-title`)}processMultipleRecords(){const{eventRecord:e,changerFn:t,thisObj:n}=this;e.beginBatch(),this.callback(t,n,[e]),e.endBatch()}processSingleRecord(){var e;const{eventRecord:t,changerFn:n,thisObj:r}=this;let i;t.beginBatch(),null!=t&&t.isRecurring&&t.recurrence.forEachOccurrence(t.startDate,null,((e,t,n)=>{if(2===n)return i=e,!1})),null===(e=i)||void 0===e||e.convertToRealEvent(),t.recurrence=null,this.callback(n,r,[t]),t.recurrenceRule=null,t.endBatch()}updateLocalization(){this.updatePopupContent(),super.updateLocalization()}}mb.initClass(),mb._$name="RecurrenceConfirmationPopup";class pb extends Eu{static get $name(){return"RecurrenceFrequencyCombo"}static get type(){return"recurrencefrequencycombo"}static get defaultConfig(){return{editable:!1,displayField:"text",valueField:"value",localizeDisplayFields:!0}}buildItems(){return[{value:"DAILY",text:"L{Daily}"},{value:"WEEKLY",text:"L{Weekly}"},{value:"MONTHLY",text:"L{Monthly}"},{value:"YEARLY",text:"L{Yearly}"}]}}pb.initClass(),pb._$name="RecurrenceFrequencyCombo";class fb extends pb{static get $name(){return"RecurrenceCombo"}static get type(){return"recurrencecombo"}static get defaultConfig(){return{customValue:"custom",placeholder:"None",splitCls:"b-recurrencecombo-split",items:!0,highlightExternalChange:!1}}buildItems(){return[{value:"none",text:"L{None}"},...super.buildItems(),{value:this.customValue,text:"L{Custom}",cls:this.splitCls}]}set value(e){e=e||"none",super.value=e}get value(){return super.value}set recurrence(e){const t=this;t.value=e?t.isCustomRecurrence(e)?t.customValue:e.frequency:null}isCustomRecurrence(e){const{interval:t,days:n,monthDays:r,months:i}=e;return Boolean(t>1||n&&n.length||r&&r.length||i&&i.length)}}fb.initClass(),fb._$name="RecurrenceCombo";class vb extends cc{static get $name(){return"RecurrenceLegendButton"}static get type(){return"recurrencelegendbutton"}static get defaultConfig(){return{localizableProperties:[],recurrence:null}}set recurrence(e){this._recurrence=e,this.updateLegend()}get recurrence(){return this._recurrence}set eventStartDate(e){this._eventStartDate=e,this.updateLegend()}get eventStartDate(){return this._eventStartDate}updateLegend(){const{recurrence:e}=this;this.text=e?wy.getLegend(e,this.eventStartDate):""}onLocaleChange(){this.updateLegend()}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}}vb.initClass(),vb._$name="RecurrenceLegendButton";class yb extends Eu{static get $name(){return"RecurrenceDaysCombo"}static get type(){return"recurrencedayscombo"}static get defaultConfig(){const e=["SU","MO","TU","WE","TH","FR","SA"],t=e.join(",");return{allDaysValue:t,editable:!1,defaultValue:t,workingDaysValue:e.filter(((e,t)=>!en.nonWorkingDays[t])).join(","),nonWorkingDaysValue:e.filter(((e,t)=>en.nonWorkingDays[t])).join(","),splitCls:"b-recurrencedays-split",displayField:"text",valueField:"value"}}buildItems(){const e=this;return e._weekDays=null,e.weekDays.concat([{value:e.allDaysValue,text:e.L("L{day}"),cls:e.splitCls},{value:e.workingDaysValue,text:e.L("L{weekday}")},{value:e.nonWorkingDaysValue,text:e.L("L{weekend day}")}])}get weekDays(){const e=this;if(!e._weekDays){const t=en.weekStartDay,n=en.getDayNames().map(((e,t)=>({text:e,value:Tv.encodeDay(t)})));e._weekDays=n.slice(t).concat(n.slice(0,t))}return e._weekDays}set value(e){e&&Array.isArray(e)&&(e=e.join(",")),e&&this.store.findRecord("value",e)||(e=this.defaultValue),super.value=e}get value(){let e=super.value;return e&&Array.isArray(e)&&(e=e.join(",")),e}}yb.initClass(),yb._$name="RecurrenceDaysCombo";class bb extends Mu{static get $name(){return"RecurrenceDaysButtonGroup"}static get type(){return"recurrencedaysbuttongroup"}static get defaultConfig(){return{defaults:{cls:"b-raised",toggleable:!0}}}construct(e={}){e.columns=7,e.items=this.buildItems(),super.construct(e)}updateItemText(e){const t=Tv.decodeDay(e.value)[0];e.text=en.getDayName(t).substring(0,3)}buildItems(){const e=this;if(!e.__items){const t=en.weekStartDay,n=en.getDayNames().map(((e,t)=>({text:e.substring(0,3),value:Tv.encodeDay(t)})));e.__items=n.slice(t).concat(n.slice(0,t))}return e.__items}set value(e){e&&Array.isArray(e)&&(e=e.join(",")),super.value=e}get value(){let e=super.value;return e&&Array.isArray(e)&&(e=e.join(",")),e}onLocaleChange(){this.items.forEach(this.updateItemText,this)}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}get widgetClassList(){const e=super.widgetClassList;return e.push("b-field"),e}}bb.initClass(),bb._$name="RecurrenceDaysButtonGroup";class Cb extends Mu{static get $name(){return"RecurrenceMonthDaysButtonGroup"}static get type(){return"recurrencemonthdaysbuttongroup"}static get defaultConfig(){return{defaults:{toggleable:!0,cls:"b-raised"}}}get minValue(){return 1}get maxValue(){return 31}construct(e={}){e.columns=7,e.items=this.buildItems(),super.construct(e)}buildItems(){const e=this,t=[];for(let n=e.minValue;n<=e.maxValue;n++)t.push({text:n+"",value:n});return t}get widgetClassList(){const e=super.widgetClassList;return e.push("b-field"),e}}Cb.initClass(),Cb._$name="RecurrenceMonthDaysButtonGroup";class wb extends Mu{static get $name(){return"RecurrenceMonthsButtonGroup"}static get type(){return"recurrencemonthsbuttongroup"}static get defaultConfig(){return{defaults:{toggleable:!0,cls:"b-raised"}}}construct(e={}){e.columns=4,e.items=this.buildItems(),super.construct(e)}buildItems(){return en.getMonthNames().map(((e,t)=>({text:e.substring(0,3),value:t+1})))}updateItemText(e){e.text=en.getMonthName(e.value-1).substring(0,3)}onLocaleChange(){this.items.forEach(this.updateItemText,this)}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}get widgetClassList(){const e=super.widgetClassList;return e.push("b-field"),e}}wb.initClass(),wb._$name="RecurrenceMonthsButtonGroup";class Sb extends Eu{static get $name(){return"RecurrenceStopConditionCombo"}static get type(){return"recurrencestopconditioncombo"}static get defaultConfig(){return{editable:!1,placeholder:"Never",displayField:"text",valueField:"value"}}buildItems(){return[{value:"never",text:this.L("L{Never}")},{value:"count",text:this.L("L{After}")},{value:"date",text:this.L("L{On date}")}]}set value(e){e=e||"never",super.value=e}get value(){return super.value}get recurrence(){return this._recurrence}set recurrence(e){let t=null;e.endDate?t="date":e.count&&(t="count"),this._recurrence=e,this.value=t}}Sb.initClass(),Sb._$name="RecurrenceStopConditionCombo";class Db extends Eu{static get $name(){return"RecurrencePositionsCombo"}static get type(){return"recurrencepositionscombo"}static get defaultConfig(){return{editable:!1,splitCls:"b-sch-recurrencepositions-split",displayField:"text",valueField:"value",defaultValue:1,maxPosition:5}}buildItems(){const e=this;return e.buildDayNumbers().concat([{value:"-1",text:e.L("L{position-1}"),cls:e.splitCls}])}buildDayNumbers(){const e=this;return ke.populate(e.maxPosition,(t=>({value:t+1,text:e.L(`position${t+1}`)})))}set value(e){e&&Array.isArray(e)&&(e=e.join(",")),e&&this.store.findRecord("value",e)||(e=this.defaultValue),super.value=e}get value(){const e=super.value;return e?`${e}`.split(",").map((e=>parseInt(e,10))):[]}}Db.initClass(),Db._$name="RecurrencePositionsCombo";class Eb extends Ic{static get $name(){return"RecurrenceEditor"}static get type(){return"recurrenceeditor"}static get configurable(){return{draggable:!0,closable:!0,floating:!0,cls:"b-recurrenceeditor",title:"L{Repeat event}",autoClose:!0,width:470,defaults:{localeClass:this},items:{frequencyField:{type:"recurrencefrequencycombo",name:"frequency",label:"L{Frequency}",weight:10,onChange:"up.onFrequencyFieldChange"},intervalField:{type:"numberfield",weight:15,name:"interval",label:"L{Every}",min:1,required:!0},daysButtonField:{type:"recurrencedaysbuttongroup",weight:20,name:"days",forFrequency:"WEEKLY"},monthDaysRadioField:{type:"checkbox",weight:30,toggleGroup:"radio",forFrequency:"MONTHLY",label:"L{Each}",checked:!0,onChange:"up.onMonthDaysRadioFieldChange"},monthDaysButtonField:{type:"recurrencemonthdaysbuttongroup",weight:40,name:"monthDays",forFrequency:"MONTHLY"},monthsButtonField:{type:"recurrencemonthsbuttongroup",weight:50,name:"months",forFrequency:"YEARLY"},positionAndDayRadioField:{type:"checkbox",weight:60,toggleGroup:"radio",forFrequency:"MONTHLY|YEARLY",label:"L{On the}",onChange:"up.onPositionAndDayRadioFieldChange"},positionsCombo:{type:"recurrencepositionscombo",weight:80,name:"positions",forFrequency:"MONTHLY|YEARLY"},daysCombo:{type:"recurrencedayscombo",weight:90,name:"days",forFrequency:"MONTHLY|YEARLY",flex:1},stopRecurrenceField:{type:"recurrencestopconditioncombo",weight:100,label:"L{End repeat}",onChange:"up.onStopRecurrenceFieldChange"},countField:{type:"numberfield",weight:110,name:"count",min:2,required:!0,disabled:!0,label:" "},endDateField:{type:"datefield",weight:120,name:"endDate",hidden:!0,disabled:!0,label:" ",required:!0}},bbar:{defaults:{localeClass:this},items:{foo:{type:"widget",cls:"b-label-filler",weight:100},saveButton:{color:"b-green",text:"L{Save}",onClick:"up.onSaveClick",weight:200},cancelButton:{color:"b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelClick",weight:300}}}}}updateReadOnly(e){super.updateReadOnly(e),this.bbar.hidden=e}updateRecord(e){super.updateRecord(e);const t=this,n=e.timeSpan,r=null==n?void 0:n.startDate,{daysButtonField:i,monthDaysButtonField:s,monthsButtonField:o,monthDaysRadioField:a,positionAndDayRadioField:l,stopRecurrenceField:c}=t.widgetMap;r&&(e.days&&e.days.length||(i.value=[Tv.encodeDay(r.getDay())]),e.monthDays&&e.monthDays.length||(s.value=r.getDate()),e.months&&e.months.length||(o.value=r.getMonth()+1)),e.days&&e.positions?(l.check(),t.isPainted||a.uncheck()):(a.check(),t.isPainted||l.uncheck()),c.recurrence=e}onSaveClick(){const e=this;e.saveHandler?e.saveHandler.call(e.thisObj||e,e,e.record):(e.syncEventRecord(),e.close())}onCancelClick(){const e=this;e.cancelHandler?e.cancelHandler.call(e.thisObj||e,e,e.record):e.close()}syncEventRecord(e){const t=this.getValues((t=>t.name in e&&!t.disabled));e.set(t)}toggleStopFields(){const{countField:e,endDateField:t}=this.widgetMap;switch(this.widgetMap.stopRecurrenceField.value){case"count":e.show(),e.enable(),t.hide(),t.disable();break;case"date":e.hide(),e.disable(),t.show(),t.enable();break;default:e.hide(),t.hide(),e.disable(),t.disable()}}onMonthDaysRadioFieldChange({checked:e}){const{monthDaysButtonField:t}=this.widgetMap;t.disabled=!e||!this.isWidgetAvailableForFrequency(t)}onPositionAndDayRadioFieldChange({checked:e}){const{daysCombo:t,positionsCombo:n}=this.widgetMap;t.disabled=n.disabled=!e||!this.isWidgetAvailableForFrequency(t)}onStopRecurrenceFieldChange(){this.toggleStopFields()}isWidgetAvailableForFrequency(e,t=this.widgetMap.frequencyField.value){return!e.forFrequency||e.forFrequency.indexOf(t)>-1}onFrequencyFieldChange({value:e,valid:t}){const n=this,r=n.queryAll((e=>"forFrequency"in e));if(t&&e){for(let t=0;t<r.length;t++){const i=r[t];n.isWidgetAvailableForFrequency(i,e)?(i.show(),i.enable()):(i.hide(),i.disable())}n.widgetMap.intervalField.hint=n.L(`${e}intervalUnit`),n.toggleFieldsState()}}toggleFieldsState(){const e=this,{widgetMap:t}=e;e.onMonthDaysRadioFieldChange({checked:t.monthDaysRadioField.checked}),e.onPositionAndDayRadioFieldChange({checked:t.positionAndDayRadioField.checked}),e.onStopRecurrenceFieldChange()}updateLocalization(){const{countField:e,intervalField:t,frequencyField:n}=this.widgetMap;e.hint=this.L("L{time(s)}"),n.value&&(t.hint=this.L(`${n.value}intervalUnit`)),super.updateLocalization()}}Eb.initClass(),Eb._$name="RecurrenceEditor";var xb=e=>class extends(e||Te){static get $name(){return"RecurringEventEdit"}static get configurable(){return{recurringEventsItems:{recurrenceCombo:{type:"recurrencecombo",label:"L{EventEdit.Repeat}",ref:"recurrenceCombo",weight:700},editRecurrenceButton:{type:"recurrencelegendbutton",ref:"editRecurrenceButton",name:"recurrenceRule",color:"b-gray",menuIcon:null,flex:1,weight:800,ignoreParentReadOnly:!0}},showRecurringUI:null}}changeEditorConfig(e){return e.items=f(f({},e.items),this.recurringEventsItems),super.changeEditorConfig(e)}construct(e,t){super.construct(e,t),this.scheduler.on({beforeEventSave:"onRecurrableEventBeforeSave",thisObj:this})}doDestroy(){var e,t;null===(e=this._recurrenceConfirmation)||void 0===e||e.destroy(),null===(t=this._recurrenceEditor)||void 0===t||t.destroy(),super.doDestroy()}onEditorConstructed(e){var t;const n=this;e.on({hide:n.onRecurringEventEditorHide,thisObj:n}),n.editRecurrenceButton&&(n.editRecurrenceButton.menu=n.recurrenceEditor),null===(t=n.recurrenceCombo)||void 0===t||t.on({change:n.onRecurrenceComboChange,thisObj:n})}updateReadOnly(e){this._recurrenceEditor&&(this._recurrenceEditor.readOnly=e)}internalShowEditor(){this.toggleRecurringFieldsVisibility(this.client.enableRecurringEvents&&!1!==this.showRecurringUI)}toggleRecurringFieldsVisibility(e=!0){var t,n,r,i;const s=e?"show":"hide";null===(t=this.editRecurrenceButton)||void 0===t||null===(n=t[s])||void 0===n||n.call(t),null===(r=this.recurrenceCombo)||void 0===r||null===(i=r[s])||void 0===i||i.call(r)}onRecurringEventEditorHide(){var e,t;null!==(e=this.recurrenceEditor)&&void 0!==e&&e.isVisible&&this.recurrenceEditor.hide(),null!==(t=this.recurrenceConfirmation)&&void 0!==t&&t.isVisible&&this.recurrenceConfirmation.hide()}makeRecurrence(e){const t=this.eventRecord,n=t.copy();let r=t.recurrence;return r=!e&&r?r.copy():new t.recurrenceModel(e?{rule:e}:{}),r.timeSpan=n,n.setStartDate(this.values.startDate),r.suspendTimeSpanNotifying(),r}onRecurrableEventBeforeSave({eventRecord:e,context:t}){this.isEditing&&!e.isCreating&&e.supportsRecurring&&(e.isRecurring||e.isOccurrence)&&(this.recurrenceConfirmation.confirm({actionType:"update",eventRecord:e,changerFn(){t.finalize(!0)},cancelFn(){t.finalize(!1)}}),t.async=!0)}set recurrenceConfirmation(e){this._recurrenceConfirmation=e}get recurrenceConfirmation(){const e=this;let t=e._recurrenceConfirmation;return t&&t.$$name||(t=Ka.create(f({type:"recurrenceconfirmation",owner:e.editor},t)),e._recurrenceConfirmation=t),t}set recurrenceEditor(e){this._recurrenceEditor=e}get recurrenceEditor(){const e=this;let t=e._recurrenceEditor;return t&&t.$$name||(e._recurrenceEditor=t=Ka.create(f({type:"recurrenceeditor",autoShow:!1,centered:!0,modal:!0,constrainTo:globalThis,anchor:!1,rootElement:e.rootElement,saveHandler:e.recurrenceEditorSaveHandler,onBeforeShow:e.onBeforeShowRecurrenceEditor.bind(e),thisObj:e},t)),t.readOnly=e._readOnly),t}onBeforeShowRecurrenceEditor(){const e=this,{recurrenceEditor:t,eventRecord:n}=e;t&&null!=n&&n.supportsRecurring&&(e.recurrence||(e.recurrence=e.makeRecurrence()),e.recurrence.timeSpan.setStartDate(e.values.startDate),t.record=e.recurrence,t.centered=!0)}loadRecurrenceData(e){this.recurrence=e,this.updateRecurrenceFields(e)}updateRecurrenceFields(e){const t=this,{editRecurrenceButton:n}=t;t.recurrenceCombo&&(t.recurrenceCombo.recurrence=e),n&&(n.recurrence=e,n.value=e?e.rule:null,e&&t.client.enableRecurringEvents&&!1!==t.showRecurringUI?n.show():n.hide())}onRecurrenceComboChange({source:e,value:t,userAction:n}){if(n){const n=this,{recurrenceEditor:r}=n;t===e.customValue?(n.recurrenceCombo.recurrence=n.makeRecurrence(),r.centered?r.show():r.show((n.editRecurrenceButton||e).element)):n.loadRecurrenceData(t&&"none"!==t?n.makeRecurrence(`FREQ=${t}`):null)}}recurrenceEditorSaveHandler(e,t){e.syncEventRecord(t),this.updateRecurrenceFields(t),e.close()}onDatesChange(...e){if(super.onDatesChange(...e),!this.loadingRecord&&this.editRecurrenceButton){const{startDate:e}=this.values;e&&(this.editRecurrenceButton.eventStartDate=e)}}internalLoadRecord(e){null!=e&&e.supportsRecurring&&this.loadRecurrenceData(e.recurrence?this.makeRecurrence():null)}updateRecord(e){return e.recurrenceRule&&!this.recurrence&&(e.recurrenceRule=null),super.updateRecord(e)}};class Rb extends Eu{static get $name(){return"ResourceCombo"}static get type(){return"resourcecombo"}static get configurable(){return{showEventColor:!1,picker:{cls:"b-resourcecombo-picker",itemIconTpl(e,t){const{eventColor:n}=e,r=!Mr.isNamedColor(n);return`<div class="b-icon b-icon-square${!n||r?"":` b-sch-foreground-${n}`}"${n?r?` style="color:${n}"`:"":' style="display:none"'}></div>`}}}}changeShowEventColor(e){return Boolean(e)}updateShowEventColor(e){const{_picker:t}=this,n=e?"add":"remove";this.element.classList[n]("b-show-event-color"),null==t||t.element.classList[n]("b-show-event-color")}changePicker(e,t){var n;return null===(n=e=super.changePicker(e,t))||void 0===n||n.element.classList[this.showEventColor?"add":"remove"]("b-show-event-color"),e}get innerElements(){return[{class:"b-icon b-resource-icon b-icon-square b-hide-display",reference:"resourceIcon"},this.inputElement]}syncInputFieldValue(){var e,t;const n=this,{resourceIcon:r,lastResourceIconCls:i}=n,{classList:s}=r,o=null!==(e=null===(t=n.selected)||void 0===t?void 0:t.eventColor)&&void 0!==e?e:"";super.syncInputFieldValue(),r.style.color="",i&&s.remove(i),n.lastResourceIconCls=null,o?(Mr.isNamedColor(o)?(n.lastResourceIconCls=`b-sch-foreground-${o}`,s.add(n.lastResourceIconCls)):r.style.color=o,s.remove("b-hide-display")):s.add("b-hide-display")}}Rb.initClass(),Rb._$name="ResourceCombo";const Tb=/[^\w\d]/g;class Mb extends(Ny.mixin(xb,Zr)){static get $name(){return"EventEdit"}static get configurable(){return{triggerEvent:"eventdblclick",typeField:"eventType",eventRecord:null,readOnly:null,editorConfig:{type:"eventeditor",title:"L{EventEdit.Edit event}",closable:!0,localeClass:this,defaults:{localeClass:this},items:{nameField:{type:"text",label:"L{Name}",clearable:!0,name:"name",weight:100,required:!0},resourceField:{type:"resourcecombo",label:"L{Resource}",name:"resource",editable:!0,valueField:"id",displayField:"name",highlightExternalChange:!1,destroyStore:!0,weight:200},startDateField:{type:"date",cls:"b-inline",clearable:!1,required:!0,label:"L{Start}",name:"startDate",validateDateOnly:!0,weight:300},startTimeField:{type:"time",clearable:!1,required:!0,name:"startDate",cls:"b-match-label",weight:400},endDateField:{type:"date",cls:"b-inline",clearable:!1,required:!0,label:"L{End}",name:"endDate",validateDateOnly:!0,weight:500},endTimeField:{type:"time",clearable:!1,required:!0,name:"endDate",cls:"b-match-label",weight:600}},bbar:{hideWhenEmpty:!0,defaults:{localeClass:this},items:{saveButton:{color:"b-blue",cls:"b-raised",text:"L{Save}",weight:100},deleteButton:{text:"L{Delete}",weight:200},cancelButton:{text:"L{Object.Cancel}",weight:300}}}},targetEventElement:null}}static get pluginConfig(){return{chain:["populateEventMenu","onEventEnterKey","editEvent"]}}construct(e,t){this.readOnly=e.readOnly,super.construct(e,t),e.on({projectChange:"onChangeProject",readOnly:"onClientReadOnlyToggle",thisObj:this})}get scheduler(){return this.client}get readOnly(){return this._editor?this.editor.readOnly:this._readOnly}updateReadOnly(e){super.updateReadOnly(e),this._editor&&(this.editor.readOnly=e)}onClientReadOnlyToggle({readOnly:e}){this.readOnly=e}get editor(){var e,t,n,r,i;const s=this,o=new Date(2e3,12,31,23,55,55),a=en.format(o,s.dateFormat).replace(Tb,"").length,l=en.format(o,s.timeFormat).replace(Tb,"").length,c=a+l;let{_editor:d}=s;return d||(d=s._editor=Ka.create(s.getEditorConfig()),d.element.style.setProperty("--date-time-length",`${c}em`),d.element.style.setProperty("--date-width-difference",(a-l)/2+"em"),d.readOnly=s._readOnly,0===d.items.length&&console.warn("Event Editor configured without any `items`"),d.on({beforehide:"resetEditingContext",beforeshow:"onBeforeEditorShow",keydown:"onPopupKeyDown",thisObj:s}),s.scheduler.relayEvents(d,["beforeSetRecord"],"eventEdit"),Object.values(d.widgetMap).forEach((e=>{const t=e.ref||e.id;if(t&&!s[t])switch(s[t]=e,e.name){case"startDate":case"endDate":e.on("change",s.onDatesChange,s)}})),null===(e=s.onEditorConstructed)||void 0===e||e.call(s,d),null===(t=s.eventTypeField)||void 0===t||t.on("change",s.onEventTypeChange,s),null===(n=s.saveButton)||void 0===n||n.on("click",s.onSaveClick,s),null===(r=s.deleteButton)||void 0===r||r.on("click",s.onDeleteClick,s),null===(i=s.cancelButton)||void 0===i||i.on("click",s.onCancelClick,s),d)}getEditorConfig(){const e=this,{cls:t,scheduler:n}=e;return sn.assign({owner:n,eventEditFeature:e,weekStartDay:e.weekStartDay,align:"b-t",id:`${n.id}-event-editor`,autoShow:!1,anchor:!0,scrollAction:"realign",constrainTo:globalThis,cls:t},e.editorConfig)}internalShowEditor(e,t,n=null){var r,i,s;const o=this,{scheduler:a}=o,l=(null===(r=n)||void 0===r||null===(i=r.target)||void 0===i?void 0:i.nodeType)===Element.ELEMENT_NODE?n.target:a.getElementFromEventRecord(e,t),c=e.isPartOfStore(a.eventStore);if((n=null!==(s=n)&&void 0!==s?s:{target:l,anchor:!0}).target||!c||e.isCreating){if(!1===a.trigger("beforeEventEdit",{eventEdit:o,eventRecord:e,resourceRecord:t,eventElement:l}))return a.element.classList.remove("b-eventeditor-editing"),!1;o.resourceRecord=t;const{editor:r}=o;o.editingContext={eventRecord:e,resourceRecord:t,eventElement:l,editor:r,isPartOfStore:c},super.internalShowEditor&&super.internalShowEditor(e,t,n),o.typeField&&o.toggleEventType(e.get(o.typeField)),o.loadRecord(e,t),r.centered||!r.anchor?r.show():l?(o.targetEventElement=l,r.showBy(n)):(r.show(),r.updateCentered(!0));const i=a.timeAxisViewModel.timeResolution;if("hour"===i.unit||"minute"===i.unit){const e=`${i.increment}${i.unit}`;o.startTimeField&&(o.startTimeField.step=e),o.endTimeField&&(o.endTimeField.step=e)}o.detachListeners("changesWhileEditing"),a.eventStore.on({change:o.onChangeWhileEditing,refresh:o.onChangeWhileEditing,thisObj:o,name:"changesWhileEditing"})}}onChangeWhileEditing(){const e=this;e.isEditing&&e.editingContext.isPartOfStore&&!e.eventRecord.isPartOfStore(e.scheduler.eventStore)&&e.onCancelClick()}onBeforeEditorShow(){super.onBeforeEditorShow(...arguments),this.scheduler.trigger("beforeEventEditShow",f({eventEdit:this},this.editingContext))}updateTargetEventElement(e,t){e&&e.classList.add("b-editing"),t&&t.classList.remove("b-editing")}editEvent(e,t,n=null){const r=this,{simpleEventEdit:i}=r.client.features;if(r.isEditing&&r.resetEditingContext(),r.disabled||e.readOnly||e.isCreating&&i&&!i.disabled)return;const s=r.doEditEvent(...arguments);return r.isEditing&&r.scheduler.element.classList.add("b-eventeditor-editing"),s}get isEditing(){var e;return Boolean(null===(e=this._editor)||void 0===e?void 0:e.isVisible)}doEditEvent(e,t,n=null){const r=this,{scheduler:i}=r,s=e.isCreating;t||(t=e.resource||r.resourceStore.getById(e.resourceId)),s&&Ev.prototype.normalize.call(e),n||s?r.internalShowEditor(e,t,n?{target:n}:null):i.scrollResourceEventIntoView(t,e,{animate:!0,edgeOffset:0,extendTimeAxis:!1}).then((()=>r.internalShowEditor(e,t)),(()=>i.element.classList.remove("b-eventeditor-editing")))}loadRecord(e,t){this.loadingRecord=!0,this.internalLoadRecord(e,t),this.loadingRecord=!1}get eventRecord(){var e;return null===(e=this._editor)||void 0===e?void 0:e.record}internalLoadRecord(e,t){const n=this,{eventStore:r}=n.client,{editor:i}=n;if(n.resourceRecord=t,i.record=e,n.resourceField){const s=r.assignmentStore.getResourcesForEvent(e);i.assigningValues=!0,e.isOccurrence||r.storage.includes(e,!0)||!t?n.assignmentStore&&(n.resourceField.value=s.map((e=>e[n.resourceField.valueField]))):n.resourceField.value=t[n.resourceField.valueField],i.assigningValues=!1}super.internalLoadRecord(e,t)}toggleEventType(e){this.editor.element.dataset.eventType=e||"",this.editor.eachWidget((t=>{var n;(null===(n=t.dataset)||void 0===n?void 0:n.eventType)&&(t.hidden=t.dataset.eventType!==e)}))}async finalizeEventSave(e,t,n,r){const i=this,{scheduler:s,assignmentStore:o}=i;o.suspendAutoCommit(),s.suspendRefresh(),i.onBeforeSave(e),e.beginBatch(),i.updateRecord(e),e.endBatch(),e.isOccurrence?t&&e.set("resourceRecords",t):i.resourceField&&o.assignEventToResource(e,t,null,!0),e.isCreating=!1,await s.project.commitAsync(),o.resumeAutoCommit(),s.resumeRefresh(!0),s.trigger("afterEventSave",{eventRecord:e}),i.onAfterSave(e),n(e)}save(){return new Promise(((e,t)=>{var n;const r=this,{scheduler:i,eventRecord:s}=r;if(!s||!r.editor.isValid)return void e(!1);const{eventStore:o,values:a}=r,l=(null===(n=r.resourceField)||void 0===n?void 0:n.records)||(r.resourceRecord?[r.resourceRecord]:[]);if(!r.scheduler.allowOverlap&&o){let{startDate:t,endDate:n}=a;if(n||(n="duration"in a?en.add(t,a.duration,a.durationUnit||s.durationUnit):"fullDuration"in a?en.add(t,a.fullDuration):s.endDate),l.some((e=>!o.isDateRangeAvailable(t,n,s,e))))return void e(!1)}const c={finalize(n){try{!1!==n?r.finalizeEventSave(s,l,e,t):e(!1)}catch(e){t(e)}}};!1!==i.trigger("beforeEventSave",{eventRecord:s,resourceRecords:l,values:a,context:c})?c.async||c.finalize():e(!1)}))}deleteEvent(){return this.detachListeners("changesWhileEditing"),new Promise(((e,t)=>{const{eventRecord:n,editor:r}=this;this.scheduler.removeEvents([n],(t=>{t&&r.containsFocus&&r.revertFocus(),e(t)}),r)}))}onChangeProject(){this.resourceField&&(this.resourceField.store={})}get eventStore(){return this.scheduler.project.eventStore}get resourceStore(){return this.scheduler.project.resourceStore}get assignmentStore(){return this.scheduler.project.assignmentStore}onActivateEditor({eventRecord:e,resourceRecord:t,eventElement:n}){this.editEvent(e,t,n)}onDragCreateEnd({eventRecord:e,resourceRecord:t,proxyElement:n}){this.editEvent(e,t,n)}onEventEnterKey({assignmentRecord:e,eventRecord:t,target:n}){const{client:r}=this,i=n[n.matches(r.eventSelector)?"querySelector":"closest"](r.eventInnerSelector);e?this.editEvent(t,e.resource,i):t&&this.editEvent(t,t.resource,i)}onEventTypeChange({value:e}){this.toggleEventType(e)}populateEventMenu({eventRecord:e,resourceRecord:t,items:n}){this.scheduler.readOnly||this.disabled||(n.editEvent={text:"L{EventEdit.Edit event}",localeClass:this,icon:"b-icon b-icon-edit",weight:100,disabled:e.readOnly,onItem:()=>{this.editEvent(e,t)}})}resetEditingContext(){this.detachListeners("changesWhileEditing"),super.resetEditingContext(),this.resourceRecord=this.editingContext=this.editor._record=null}}Mb._$name="EventEdit",vg.registerFeature(Mb,!0,"Scheduler"),vg.registerFeature(Mb,!1,["SchedulerPro","ResourceHistogram"]),Mb.initClass();class kb extends Wr{static get $name(){return"EventFilter"}static get pluginConfig(){return{chain:["populateTimeAxisHeaderMenu"]}}populateTimeAxisHeaderMenu({items:e}){const t=this;e.eventsFilter={text:"L{filterEvents}",icon:"b-fw-icon b-icon-filter",disabled:t.disabled,localeClass:t,weight:100,menu:{type:"popup",localeClass:t,items:{nameFilter:{weight:110,type:"textfield",cls:"b-eventfilter b-last-row",clearable:!0,keyStrokeChangeDelay:300,label:"L{byName}",localeClass:t,width:200,listeners:{change:t.onEventFilterChange,thisObj:t}}},onBeforeShow({source:e}){const[n]=e.items,r=t.store.filters.getBy("property","name");n.value=(null==r?void 0:r.value)||""}}}}onEventFilterChange({value:e}){""!==e?this.store.filter("name",e):this.store.removeFilter("name")}get store(){const{client:e}=this;return e.isGanttBase?e.store:e.eventStore}}kb.featureClass="b-event-filter",kb._$name="EventFilter",vg.registerFeature(kb,!0,["Scheduler","Gantt"]),vg.registerFeature(kb,!1,"ResourceHistogram");class Ib extends By{static get $name(){return"EventMenu"}static get configurable(){return{processItems:null,type:"event"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateEventMenu"),e}get resourceStore(){return this.client.isHorizontal?this.client.store:this.client.resourceStore}getDataFromEvent(e){var t;const n=super.getDataFromEvent(e),r=n.targetElement,{client:i}=this,s=i.resolveEventRecord(r),o=s&&(null===(t=i.resolveResourceRecord(r)||this.resourceStore.last)||void 0===t?void 0:t.$original),a=s&&i.resolveAssignmentRecord(r);return Object.assign(n,{eventElement:r,eventRecord:s,resourceRecord:o,assignmentRecord:a})}getTargetElementFromEvent({target:e}){return e.closest(this.client.eventSelector)||e}shouldShowMenu(e){return e.eventRecord}showContextMenuFor(e,{targetElement:t,event:n}={}){this.disabled||(t||(t=this.getElementFromRecord(e)))&&Mr.triggerMouseEvent(t,this.tiggerEvent)}getElementFromRecord(e){return this.client.getElementsFromEventRecord(e)[0]}populateEventMenu({items:e,eventRecord:t,assignmentRecord:n}){const{client:r}=this;e.deleteEvent={disabled:t.readOnly||(null==n?void 0:n.readOnly),hidden:r.readOnly},e.unassignEvent={disabled:t.readOnly||(null==n?void 0:n.readOnly),hidden:r.readOnly||r.eventStore.usesSingleAssignment}}changeItems(e){const{client:t}=this;return Y.merge({deleteEvent:{text:"L{SchedulerBase.Delete event}",icon:"b-icon b-icon-trash",weight:200,onItem({menu:e,eventRecord:n}){var r;const i=null===(r=e.focusInEvent)||void 0===r?void 0:r.relatedTarget;i&&(i.focus(),t.navigator.activeItem=i),t.removeEvents(t.isEventSelected(n)?t.selectedEvents:[n])}},unassignEvent:{text:"L{SchedulerBase.Unassign event}",icon:"b-icon b-icon-unassign",weight:300,onItem({menu:e,eventRecord:n,resourceRecord:r}){var i;const s=null===(i=e.focusInEvent)||void 0===i?void 0:i.relatedTarget;s&&(s.focus(),t.navigator.activeItem=s),n.unassign(r)}}},e)}}Ib.featureClass="",Ib._$name="EventMenu",vg.registerFeature(Ib,!0,"Scheduler"),vg.registerFeature(Ib,!1,"ResourceHistogram");var Ab=e=>{var t;return v(t=class extends e{getNonWorkingTimeRanges(e,t,n){if(!e.getNonWorkingTimeRanges){const r=[];return e.forEachAvailabilityInterval({startDate:t,endDate:n,isForward:!0},((e,t,n)=>{for(const[i,s]of n.intervalGroups)s.getIsWorking()||r.push({name:i.name,iconCls:i.iconCls,cls:i.cls,startDate:e,endDate:t})})),r}return e.getNonWorkingTimeRanges(t,n)}getCalendarTimeRanges(e,t=!1){const n=this,{timeAxis:r,fillTicks:i}=n.client,{unit:s,increment:o}=r,a=!n.maxTimeAxisUnit||en.compareUnits(s,n.maxTimeAxisUnit)<=0;if(e&&a&&r.count){const a=n.getNonWorkingTimeRanges(e,r.startDate,r.endDate).map((e=>new Ev({name:e.name,cls:`b-nonworkingtime ${e.cls||""}`,startDate:i?en.ceil(e.startDate,{magnitude:o,unit:s}):e.startDate,endDate:i?en.floor(e.endDate,{magnitude:o,unit:s}):e.endDate}))),l=[];let c=null;for(const e of a)c&&e.startDate<=c.endDate&&(t||e.name===c.name)&&e.duration>0?c.endDate=e.endDate:(l.push(e),e.id=`nonworking-${l.length}`,c=e);return l}return[]}setupDefaultCalendar(){const{client:e,project:t}=this;this.autoGeneratedWeekends||e.isSchedulerPro||e.isGantt||t.effectiveCalendar!==t.defaultCalendar||t.defaultCalendar.intervalStore.count||(this.autoGeneratedWeekends=!0,this.updateDefaultCalendar())}updateDefaultCalendar(){if(this.autoGeneratedWeekends){const e=this.client.project.effectiveCalendar,t=this.defaultNonWorkingIntervals,n=Boolean(t.length);e.clearIntervals(n),n&&e.addIntervals(t)}}updateLocalization(){var e;null===(e=super.updateLocalization)||void 0===e||e.call(this),this.autoGeneratedWeekends&&this.updateDefaultCalendar()}get defaultNonWorkingIntervals(){const e=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return en.nonWorkingDaysAsArray.map((t=>({recurrentStartDate:`on ${e[t]} at 0:00`,recurrentEndDate:`on ${e[(t+1)%7]} at 0:00`,isWorking:!1})))}},"$name","NonWorkingTimeMixin"),v(t,"configurable",{maxTimeAxisUnit:"week"}),t};class Fb extends(Wr.mixin(Sy,Ab)){doDisable(e){this.client.refresh(),super.doDisable(e)}attachToCalendarManagerStore(e){super.attachToCalendarManagerStore(e);const t=this;e.on({name:"calendarManagerStore",change:"onCalendarChange",thisObj:t}),t.client.isScheduler&&t.project.effectiveCalendar.intervals.on({name:"calendarManagerStore",change:"onCalendarChange",thisObj:t}),t.setupDefaultCalendar()}onCalendarChange(){this.calendarRangeCache.clear()}onTimeAxisViewModelUpdate(){this.calendarRangeCache.clear()}getRangeDomConfig(e,t,n,r){const{client:i}=this,{rtl:s}=i,o=i.getCoordinateFromDate(en.max(e.startDate,t))-r,a=e.endDate?i.getCoordinateFromDate(en.min(e.endDate,n))-r:o,l=Math.abs(a-o),c=l>0,d=s?`calc(${o}px - 100%)`:`${o}px`;return{className:{"b-sch-timerange":1,"b-sch-range":1,"b-sch-nonworkingtime":1,[e.cls]:e.cls,"b-rtl":s},dataset:{id:e.id},elementData:{timeRange:e},style:i.isVertical?`transform: translateY(${d}); ${c?`height:${l}px`:""};`:`transform: translateX(${d}); ${c?`width:${l}px`:""};`}}getCalendarTimeRanges(e){let t=this.calendarRangeCache.get(e);return t||(t=super.getCalendarTimeRanges(e,!0),this.calendarRangeCache.set(e,t)),t}onEventDataGenerated({eventRecord:e,endMS:t,startMS:n,start:r,end:i,left:s,top:o,children:a}){if(this.enabled){var l;const{isVertical:c}=this.client,d=null!==(l=e.effectiveCalendarsCombination)&&void 0!==l?l:this.client.project.calendar;for(const e of this.getCalendarTimeRanges(d))if(e.startDateMS<t&&e.endDateMS>n){const t=this.getRangeDomConfig(e,r,i,c?o:s);a.push(t)}}}}v(Fb,"$name","EventNonWorkingTime"),v(Fb,"pluginConfig",{chain:["onTimeAxisViewModelUpdate","updateLocalization","onEventDataGenerated"]}),v(Fb,"properties",{calendarRangeCache:new Map}),Fb._$name="EventNonWorkingTime",vg.registerFeature(Fb,!1,"Scheduler");class Ob extends jy{static get $name(){return"EventTooltip"}static get defaultConfig(){return{template:e=>`\n                ${e.eventRecord.name?_.xss`<div class="b-sch-event-title">${e.eventRecord.name}</div>`:""}\n                ${e.startClockHtml}\n                ${e.endClockHtml}`,cls:"b-sch-event-tooltip",monitorRecordUpdate:!0,scrollAction:"hide"}}construct(e,t){const n=this;super.construct(e,t),"string"==typeof n.align&&(n.align={align:n.align})}onPaint({firstPaint:e}){if(super.onPaint(...arguments),e){const e=this,t=e.client.features.dependencies;if(t){const n=e.align.offset;e.tooltip.on("beforeshow",(({source:e})=>{t.disabled?e.align.offset=n:e.align.offset=[0,10]}))}}}}Ob._$name="EventTooltip",vg.registerFeature(Ob,!0,"Scheduler"),vg.registerFeature(Ob,!1,"ResourceHistogram");const Lb={add:1,remove:1,update:1,removeAll:1,filter:1};class Pb extends Ng{static get $name(){return"GroupSummary"}static get defaultConfig(){return{showTooltip:!0,summaries:null,renderer:null}}static get properties(){return{footersToUpdate:new Set}}static get pluginConfig(){return{chain:["render"]}}construct(e,t){const n=this;if(e.isVertical)throw new Error("GroupSummary feature is not supported in vertical mode");n.scheduler=e,super.construct(e,t),!n.summaries&&n.renderer&&(n.summaries=[{renderer:n.renderer}]),e.isSchedulerBase&&(e.eventStore.on({changePreCommit:n.onEventStoreChange,thisObj:n}),e.on({timeAxisViewModelUpdate:n.onTimeAxisChange,thisObj:n}),e.project.on({dataReady:n.onProjectDataReady,thisObj:n}))}doDestroy(){var e;null===(e=this._tip)||void 0===e||e.destroy(),super.doDestroy()}onTimeAxisChange(){this.scheduler.rowManager.forEach((e=>{e.isGroupFooter&&e.render()}))}onEventStoreChange({action:e,record:t,records:n,changes:r}){if(Lb[e]){var i;const{rowManager:e}=this.scheduler,s=t?[t]:n,o=new Set;if(s.forEach((e=>e.resources.forEach((e=>o.add(e))))),null!=(null==r||null===(i=r.resourceId)||void 0===i?void 0:i.oldValue)){const e=this.scheduler.resourceStore.getById(r.resourceId.oldValue);e&&o.add(e)}for(const t of o){let n=e.getRowFor(t);if("header"===this.target)for(;n&&!n.isGroupHeader;)n=e.getRow(n.index-1);else for(;n&&!n.isGroupFooter;)n=e.getRow(n.index+1);n&&this.footersToUpdate.add(n)}}}onProjectDataReady(){const{footersToUpdate:e,client:t}=this;if(t.isVisible){if(e.size){for(const t of e){var n;null===(n=t.render)||void 0===n||n.call(t)}e.clear()}}else t.whenVisible("refresh",t,[!0])}onBeforeRenderRow({row:e,record:t}){if(e.isGroupFooter&&!t.meta.hasOwnProperty("groupFooterFor")){const t=e.elements.normal.querySelector(".b-sch-timeaxis-cell");t&&(t.innerHTML="")}super.onBeforeRenderRow(...arguments)}generateHtml(e,t,n,r,i,s){if("timeAxis"===e.type){const e=this,{scheduler:n}=e,{eventStore:o}=n,a=n.timeAxisViewModel.columnConfig;let l="";const c=n.getResourcesEventsPerTick(t,(({event:e})=>e.resources.some((e=>t.includes(e)))&&(!o.isFiltered||o.records.includes(e))));return n.timeAxis.forEach(((d,u)=>{const h=c[u]||[],g=e.summaries.map((e=>`<div class="b-timeaxis-summary-value">${e.renderer({startDate:d.startDate,endDate:d.endDate,resourceStore:n.resourceStore,events:h,resources:t,eventStore:o,groupRecord:r,groupField:i,groupValue:s})}</div>`)).join("");l+=`<div class="b-timeaxis-tick" style="width: ${a[a.length-1][u].width}px">${g}</div>`})),`<div class="b-timeaxis-group-summary">${l}</div>`}return super.generateHtml(e,t,n,r,i,s)}updateSummaryHtml(e,t,n){const r=super.updateSummaryHtml(e,t,n);if("timeAxis"===t.type){const e={count:0,height:0};return this.summaries.forEach((t=>{t.height?e.height+=t.height:e.count++})),e}return r}getTipHtml({activeTarget:e}){const t=this,n=Array.from(e.parentElement.children).indexOf(e),r=t.scheduler.timeAxis.getAt(n);let i=`<header>${t.L("L{Summary.Summary for}",t.scheduler.getFormattedDate(r.startDate))}</header>`,s=!1;return Mr.forEachSelector(e,".b-timeaxis-summary-value",((e,n)=>{const r=t._labels[n],o=e.innerText.trim();i+=`<label>${r||""}</label><div class="b-timeaxis-summary-value">${o}</div>`,e.innerHTML&&(s=!0)})),s?i:null}render(){const e=this,{scheduler:t}=e;var n;t.isSchedulerBase&&null!==(n=e.summaries)&&void 0!==n&&n.some((e=>e.label))&&e.showTooltip&&!e._tip&&(e._labels=e.summaries.map((e=>e.label||"")),e._tip=new lu({id:`${t.id}-groupsummary-tip`,cls:"b-timeaxis-summary-tip",hoverDelay:0,hideDelay:0,forElement:t.timeAxisSubGridElement,anchorToTarget:!0,forSelector:".b-timeaxis-group-summary .b-timeaxis-tick",getHtml:e.getTipHtml.bind(e)}))}removeSummaryElements(e){const t=e.querySelector(".b-timeaxis-group-summary");null==t||t.remove(),super.removeSummaryElements()}hasSummary(e){return super.hasSummary(e)||e.isTimeAxisColumn}}Pb._$name="GroupSummary",vg.registerFeature(Pb,!1,"Scheduler");class $b extends Wr{static get pluginConfig(){return{chain:["onElementMouseDown","onElementMouseMove"]}}onElementMouseDown(e){const t=this;if(!e.touches&&0===e.button&&!t.disabled&&e.target.closest(".b-sch-header-timeaxis-cell")){const n=t.client.subGrids.normal.header.headersElement;t.startX=e.clientX,t.element=Mr.createElement({parent:n,tag:"div",className:"b-headerzoom-rect"}),t.headerElementRect=xn.from(n),_n.on({element:document,mouseup:"onMouseUp",thisObj:t,once:!0})}}onElementMouseMove(e){const t=this;if("number"==typeof t.startX){const n=Math.max(e.clientX,t.headerElementRect.left),r=Math.min(t.startX,n),i=Math.abs(t.startX-n),s=new xn(r-t.headerElementRect.x+t.client.scrollLeft,0,i,t.headerElementRect.height);Mr.setTranslateX(t.element,s.left),t.element.style.width=s.width+"px"}}onMouseUp(){const e=this;if("number"==typeof e.startX){const{client:t}=e,n=xn.from(e.element),r=t.getDateFromCoordinate(n.left,"round",!1),i=t.getDateFromCoordinate(n.right,"round",!1);e.element.remove(),e.startX=null,t.zoomToSpan({startDate:r,endDate:i})}}}v($b,"$name","HeaderZoom"),$b._$name="HeaderZoom",vg.registerFeature($b,!1,"Scheduler");const _b=["top","before","after","bottom"],Nb=(e,t)=>{switch(e){case"top":return"b-b";case"after":return t.rtl?"r-r":"l-l";case"right":return"l-l";case"bottom":return"t-t";case"before":return t.rtl?"l-l":"r-r";case"left":return"r-r"}},Hb={top:1,bottom:1},Bb={estimate:1,measure:1},jb={before:1,after:1};class Vb extends Wr{static get $name(){return"Labels"}static get configurable(){return{labelCls:"b-sch-label",top:null,after:null,right:null,bottom:null,before:null,left:null,thisObj:null,blurAction:"cancel",labelLayoutMode:"default",labelCharWidth:7}}static get pluginConfig(){return{chain:["onEventDataGenerated"]}}construct(e,t){const n=this;if(e.isVertical)throw new Error("Labels feature is not supported in vertical mode");n.scheduler=e,super.construct(e,t),(n.top||n.bottom||n.before||n.after)&&n.updateHostClasslist()}updateHostClasslist(){const{top:e,bottom:t}=this,{classList:n}=this.scheduler.element;n.remove("b-labels-topbottom"),n.remove("b-labels-top"),n.remove("b-labels-bottom"),(e||t)&&(n.add("b-labels-topbottom"),e&&n.add("b-labels-top"),t&&n.add("b-labels-bottom"))}onLabelDblClick(e){const t=this,n=e.target;if(n&&!t.scheduler.readOnly){const{side:r}=n.dataset,i=t[r],{editor:s,field:o}=i;if(s){const a=this.scheduler.resolveEventRecord(e.target);if(a.readOnly)return;return s instanceof Uu||(i.editor=new Uu({blurAction:t.blurAction,inputField:s,scrollAction:"realign"})),i.editor.render(t.scheduler.element),i.editor.startEdit({target:n,align:Nb(r,t.client),matchSize:!1,record:a,field:o}),e.stopImmediatePropagation(),!1}}}changeTop(e){return this.processLabelSpec(e,"top")}updateTop(){this.updateHostClasslist()}changeAfter(e){return this.processLabelSpec(e,"after")}updateAfter(){this.updateHostClasslist()}changeRight(e){this[this.client.rtl?"before":"after"]=e}changeBottom(e){return this.processLabelSpec(e,"bottom")}updateBottom(){this.updateHostClasslist()}changeBefore(e){return this.processLabelSpec(e,"before")}updateBefore(){this.updateHostClasslist()}changeLeft(e){this[this.client.rtl?"after":"before"]=e}processLabelSpec(e,t){if("function"==typeof e)e={renderer:e};else if("string"==typeof e)e={field:e};else{if(!e)return null;e=Object.setPrototypeOf({},e)}const{scheduler:n}=this,{eventStore:r,resourceStore:i,taskStore:s,id:o}=n,{field:a,editor:l}=e;if(Hb[t]&&(n.milestoneWidth=null),e.recordType=r&&!s?"event":"task",a){let t;r&&!s&&(t=r.modelClass.fieldMap[a],t?(e.fieldDef=t,e.recordType="event"):Reflect.has(r.modelClass.prototype,a)&&(e.recordType="event")),!t&&s&&(t=s.modelClass.fieldMap[a],t?(e.fieldDef=t,e.recordType="task"):Reflect.has(i.modelClass.prototype,a)&&(e.recordType="task")),!t&&i&&(t=i.modelClass.fieldMap[a],t?(e.fieldDef=t,e.recordType="resource"):Reflect.has(i.modelClass.prototype,a)&&(e.recordType="resource")),l&&("boolean"==typeof l?n.editor={type:"textfield"}:"string"==typeof l&&(n.editor={type:l}),_n.on({element:n.timeAxisSubGrid.element,delegate:".b-sch-label",dblclick:"onLabelDblClick",thisObj:this}))}return e}doDisable(e){super.doDisable(e),this.client.isPainted&&this.client.refresh()}generateLabelConfigs(e){const t=this,n=[];for(const r of _b)if(t[r]){const{field:i,fieldDef:s,recordType:o,renderer:a,thisObj:l}=t[r],c={tag:"label",className:{[t.labelCls]:1,[`${t.labelCls}-${r}`]:1},dataset:{side:r,taskFeature:`label-${r}`}};let d;const u=`${o}Record`,h=e[u];a?d=a.call(l||t.thisObj||t,{[u]:h,resourceRecord:e.resourceRecord,assignmentRecord:e.assignmentRecord,domConfig:c}):(d=h[i],d="date"!==(null==s?void 0:s.type)||a?_.encodeHtml(d):en.format(d,t.client.displayDateFormat)),c.html=d||" ",n.push(c)}return n}measureLabels(e,t){const n=this,r=n.client.timeAxisViewModel.getSingleUnitInPixels("millisecond");for(const i of e)if(jb[i.dataset.side]){let{html:e}=i,s=0;if("estimate"===n.labelLayoutMode)e.includes("<")&&(e=Mr.stripTags(e)),s=e.length*n.labelCharWidth+18;else{const e=n.labelMeasureElement||(n.labelMeasureElement=Mr.createElement({className:"b-sch-event-wrap b-measure-label",parent:n.client.foregroundCanvas}));e.retainElement=!0,oa.sync({targetElement:e,childrenOnly:!0,domConfig:{children:[i]}}),s=e.firstElementChild.offsetWidth}const o=s/r;switch(i.dataset.side){case"before":t.startMS-=o;break;case"after":t.endMS+=o}}}onEventDataGenerated(e){var t;if(!(this.disabled||null!==(t=e.eventRecord)&&void 0!==t&&t.isResourceTimeRange)){const t=this.generateLabelConfigs(e);Bb[this.labelLayoutMode]&&this.measureLabels(t,e),e.wrapperChildren.push(...t)}}updateLabelLayoutMode(){this.isConfiguring||this.client.refreshWithTransition()}updateLabelCharWidth(){this.isConfiguring||this.client.refreshWithTransition()}}Vb.featureClass="b-sch-labels",Vb._$name="Labels",vg.registerFeature(Vb,!1,"Scheduler");class zb extends(Vy.mixin(Sy,Ab)){static get defaultConfig(){return{highlightWeekends:null,hideRangesOnZooming:!0,showHeaderElements:!0,showLabelInBody:!0,autoGeneratedWeekends:!1}}doDestroy(){this.attachToCalendar(null),super.doDestroy()}set highlightWeekends(e){K.deprecate("Scheduler","6.0.0","Deprecated in favour of disabling the feature"),this.disabled=!e}get highlightWeekends(){return!this.disabled}onConfigChange({name:e}){this.isConfiguring||"fillTicks"!==e||this.refresh()}attachToProject(e){super.attachToProject(e),this.attachToCalendar(e.effectiveCalendar),e.on({name:"project",calendarChange:()=>this.attachToCalendar(e.effectiveCalendar),thisObj:this})}onTimeAxisViewModelUpdate(...e){return this._timeAxisUnitDurationMs=null,super.onTimeAxisViewModelUpdate(...e)}attachToCalendar(e){const t=this,{project:n,client:r}=t;t.detachListeners("calendar"),t.autoGeneratedWeekends=!1,e&&(t.setupDefaultCalendar(),e.intervalStore.on({name:"calendar",change:()=>t.setTimeout((()=>t.refresh()),1)})),!r.isEngineReady||r.project.isDelayingCalculation||r.isDestroying?n.isDestroyed||(t.detachListeners("initialProjectListener"),n.on({name:"initialProjectListener",refresh({isCalculated:e}){!1!==e&&(t.refresh(),t.detachListeners("initialProjectListener"))},thisObj:t})):t.refresh()}get calendar(){var e;return null===(e=this.project)||void 0===e?void 0:e.effectiveCalendar}get timeAxisUnitDurationMs(){return this._timeAxisUnitDurationMs||(this._timeAxisUnitDurationMs=en.as("ms",1,this.client.timeAxis.unit)),this._timeAxisUnitDurationMs}shouldRenderRange(e){return super.shouldRenderRange(e)&&(!this.hideRangesOnZooming||e.durationMS>=this.timeAxisUnitDurationMs)}get timeRanges(){const e=this;return e._timeRanges||(e._timeRanges=e.getCalendarTimeRanges(e.calendar)),e._timeRanges}}v(zb,"$name","NonWorkingTime"),v(zb,"pluginConfig",{chain:["onPaint","attachToProject","updateLocalization","onConfigChange","onSchedulerHorizontalScroll"]}),zb._$name="NonWorkingTime",vg.registerFeature(zb,!1,"Scheduler"),vg.registerFeature(zb,!0,["SchedulerPro","Gantt","ResourceHistogram"]);class Wb extends Wr{get targetSelector(){return".b-grid-cell,.b-timeline-subgrid"+(this.enableInHeader?",.b-sch-header-timeaxis-cell,.b-sch-header-text":"")}static get pluginConfig(){return{chain:["onElementMouseDown"]}}onElementMouseDown(e){const t=this,{client:n}=t,{button:r,touches:i,target:s,clientX:o,clientY:a}=e,l=n.features.taskDrag||n.features.eventDrag,c=n.readOnly||!(null!=l&&l.enabled);i||0!==r||t.disabled||!1===n.trigger("beforePan",{event:e})||(s.matches(t.targetSelector)||c&&s.closest(n.eventSelector))&&(t.mouseX=o,t.mouseY=a,t.onHeader=t.enableInHeader&&s.closest(".b-sch-header-timeaxis-cell"),t.mouseDetacher=_n.on({element:document,mousemove:"onMouseMove",mouseup:"onMouseUp",thisObj:t}))}onMouseMove(e){const t=this,{client:n}=t,r=n.timeAxisSubGrid.scrollable,i=n.scrollable,s=e.clientX,o=e.clientY;e.preventDefault(),!t.vertical||!n.isVertical&&t.onHeader||i.scrollBy(0,t.mouseY-o),!t.horizontal||!n.isHorizontal&&t.onHeader||r.scrollBy(t.mouseX-s),t.mouseX=s,t.mouseY=o}onMouseUp(){this.mouseDetacher(),this.mouseDetacher=null}get isActive(){return Boolean(this.mouseDetacher)}}v(Wb,"$name","Pan"),v(Wb,"configurable",{horizontal:!0,vertical:!0,enableInHeader:!0}),Wb._$name="Pan",vg.registerFeature(Wb,!1,["Scheduler","Gantt"]);class Ub extends Hy{static get pluginConfig(){const e=super.pluginConfig;return f(f({},e),{},{override:["matchScheduleCell",...e.override],assign:["resolveResourceTimeRangeRecord","getElementFromResourceTimeRangeRecord"]})}updateEnableMouseEvents(e){var t;const n=this,{client:r}=n;if(null===(t=n.mouseEventsDetacher)||void 0===t||t.call(n),n.mouseEventsDetacher=null,e){function i(){n.mouseEventsDetacher=_n.on({element:r.foregroundCanvas,delegate:`.${n.rangeCls}`,mousedown:"handleRangeMouseEvent",mouseup:"handleRangeMouseEvent",click:"handleRangeMouseEvent",dblclick:"handleRangeMouseEvent",contextmenu:"handleRangeMouseEvent",mouseover:"handleRangeMouseEvent",mouseout:"handleRangeMouseEvent",thisObj:n})}r.whenVisible(i)}r.element.classList.toggle("b-interactive-resourcetimeranges",Boolean(e))}attachToProject(e){const t=this,{client:n}=t;if(super.attachToProject(e),!e.resourceTimeRangeStore){e.resourceTimeRangeStore=n.resourceTimeRangeStore||new cy({owner:t});const{crudManager:r}=n;r&&!r.resourceTimeRangeStore&&(r.resourceTimeRangeStore=e.resourceTimeRangeStore)}const r=e.resourceTimeRangeStore;t.exposedOnScheduler||(n.resourceTimeRanges&&(r.add(n.resourceTimeRanges),delete n.resourceTimeRanges),Object.defineProperty(n,"resourceTimeRanges",{get:()=>r.records,set:e=>r.data=e}),t.exposedOnScheduler=!0),r.resourceStore||(r.resourceStore=e.resourceStore),t.detachListeners("store"),r.on({name:"store",change:t.onStoreChange,thisObj:t})}attachToResourceTimeRangeStore(e){this.attachToProject(this.project),this.client.refresh()}get store(){return this.project.resourceTimeRangeStore}handleRangeMouseEvent(e){const t=this,n=e.target.closest(`.${t.rangeCls}`);if(n){var r;const i=null!==(r=_n.eventNameMap[e.type])&&void 0!==r?r:_.capitalize(e.type),s=t.resolveResourceTimeRangeRecord(n);t.client.trigger("resourceTimeRange"+i,{feature:t,resourceTimeRangeRecord:s,resourceRecord:t.client.resourceStore.getById(s.resourceId),domEvent:e})}}matchScheduleCell(e){let t=this.overridden.matchScheduleCell(e);if(!t&&this.enableMouseEvents){const{client:n}=this,r=e.closest(`.${this.rangeCls}`);t=r&&n.getCell({record:n.isHorizontal?r.elementData.resource:n.store.first,column:n.timeAxisColumn})}return t}getEventsToRender(e,t){if(!this.disabled){const{timeRanges:n}=e.$original;if(null!=n&&n.length){const{startDate:e,endDate:r}=this.client;n.forEach((n=>{n.isRecurring?t.push(...n.getOccurrencesForDateRange(e,r)):t.push(n)}))}}return t}shouldInclude(e){return e.isResourceTimeRange&&!e.isNonWorking&&!e.isCalendarHighlightModel}doDestroy(){var e;(null===(e=this.store)||void 0===e?void 0:e.owner)===this&&this.store.destroy(),super.doDestroy()}}v(Ub,"$name","ResourceTimeRanges"),v(Ub,"configurable",{rangeCls:"b-sch-resourcetimerange",enableMouseEvents:!1,tabIndex:0}),Ub.featureClass="",Ub._$name="ResourceTimeRanges",vg.registerFeature(Ub,!1,"Scheduler");class Yb extends By{static get $name(){return"ScheduleMenu"}static get defaultConfig(){return{type:"schedule",items:null,processItems:null}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateScheduleMenu"),e}shouldShowMenu(e){const{client:t}=this,{targetElement:n,resourceRecord:r}=e,i=t.timeAxisSubGridElement.contains(n);return!n.closest(t.eventSelector)&&i&&!(r&&r.isSpecialRow)}getDataFromEvent(e){if(Mr.isDOMEvent(e)){var t,n;const{client:r}=this,i=null===(t=r.getCellDataFromEvent)||void 0===t?void 0:t.call(r,e),s=null===(n=r.getDateFromDomEvent)||void 0===n?void 0:n.call(r,e,"floor"),o=r.resolveResourceRecord(e)||r.isVertical&&r.resourceStore.last;return sn.assign(super.getDataFromEvent(e),i,{date:s,resourceRecord:o})}return e}populateScheduleMenu({items:e,resourceRecord:t,date:n}){const{client:r}=this;!r.readOnly&&r.eventStore&&(e.addEvent={text:"L{SchedulerBase.Add event}",icon:"b-icon b-icon-add",disabled:!t||t.readOnly||!t.isWorkingTime(n),weight:100,onItem(){r.createEvent(n,t,r.getRowFor(t))}})}}Yb.featureClass="",Yb._$name="ScheduleMenu",vg.registerFeature(Yb,!0,"Scheduler");class Gb extends Wr{static get $name(){return"ScheduleTooltip"}static get configurable(){return{messageTemplate:e=>`<div class="b-sch-hovertip-msg">${e.message}</div>`,hideForNonWorkingTime:null}}static get pluginConfig(){return{chain:["onPaint"]}}onPaint({firstPaint:e}){if(!e)return;const t=this,{client:n}=t;let r;n.isSchedulerPro&&void 0===t.hideForNonWorkingTime&&(t.hideForNonWorkingTime=!0);const i=t.hoverTip=new lu(f(f({id:`${n.id}-schedule-tip`,cls:"b-sch-scheduletip",allowOver:!0,hoverDelay:0,hideDelay:100,showOnHover:!0,forElement:n.timeAxisSubGridElement,anchorToTarget:!1,trackMouse:!0,updateContentOnMouseMove:!0,monitorResize:!1,textContent:!1,forSelector:".b-schedulerbase:not(.b-dragging-event):not(.b-dragcreating) .b-grid-body-container:not(.b-scrolling) .b-timeline-subgrid:not(.b-scrolling) > :not(.b-sch-foreground-canvas):not(.b-group-footer):not(.b-group-row) *",constrainTo:null,getHtml:t.getHoverTipHtml.bind(t),onDocumentMouseDown(e){i.forElement.contains(e.event.target)&&(r=_n.on({element:n.timeAxisSubGridElement,mousemove:e=>i.internalOnPointerOver(e),capture:!0}));const t=i.hideAnimation;i.hideAnimation=!1,i.constructor.prototype.onDocumentMouseDown.call(i,e),i.hideAnimation=t}},t.config),{},{listeners:t.configuredListeners}));i.on({pointerover({event:e}){const n="buttons"in e?e.buttons>0:e.which>0;return!n&&r&&r(),!t.disabled&&!n},innerhtmlupdate({source:e}){t.clockTemplate.updateDateIndicator(e.element,t.lastTime)}}),n.on({timeAxisViewModelUpdate:"updateTip",thisObj:t}),t.clockTemplate=new My({scheduler:n})}processConfiguredListeners(){}updateTip(){this.hoverTip.isVisible&&this.hoverTip.updateContent()}doDestroy(){this.destroyProperties("clockTemplate","hoverTip"),super.doDestroy()}getHoverTipHtml({tip:e,event:t}){const n=this,r=n.client,i=t&&r.getDateFromDomEvent(t,"floor",!0);let s=n.lastHtml;if(i&&t.target){const o=r.resolveResourceRecord(t);if(o&&(i-n.lastTime!=0||o.id!==n.lastResourceId)){if(n.hideForNonWorkingTime){const t=o.isWorkingTime(i);e.element.classList.toggle("b-nonworking-time",!t)}n.lastResourceId=o.id,s=n.lastHtml=n.generateTipContent({date:i,event:t,resourceRecord:o})}}else e.hide(),n.lastTime=null,n.lastResourceId=null;return s}generateTipContent({date:e,event:t,resourceRecord:n}){const r=this,i=r.clockTemplate.generateContent({date:e,text:r.client.getFormattedDate(e)}),s=r.messageTemplate({message:r.getText(e,t,n)||""});return r.lastTime=e,i+s}getText(e,t,n){}}Gb.featureClass="b-scheduletip",Gb._$name="ScheduleTooltip",vg.registerFeature(Gb,!0,"Scheduler"),vg.registerFeature(Gb,!1,"ResourceUtilization");class qb extends Wr{static get $name(){return"SimpleEventEdit"}static get defaultConfig(){return{triggerEvent:"eventdblclick",eventRecord:null,field:"name",editorConfig:null}}static get pluginConfig(){return{chain:["onEventEnterKey","editEvent"]}}construct(e,t){const n=this;n.scheduler=e,e.eventEdit=n,super.construct(e,t),n.clientListenersDetacher=e.on({[n.triggerEvent]:({eventRecord:e,eventElement:t})=>n.editEvent(e,e.resource,t),dragcreateend:n.onDragCreateEnd,thisObj:n})}doDestroy(){var e;this.clientListenersDetacher(),null===(e=this.editor)||void 0===e||e.destroy(),super.doDestroy()}get eventStore(){return this.scheduler.eventStore}editEvent(e,t,n){const r=this,i=r.scheduler,{eventEdit:s}=r.client.features;i.readOnly||r.disabled||e.readOnly||s&&!s.disabled&&!e.isCreating||(n=Mr.down(n,i.eventInnerSelector)||n,e=e.isAssignment?e.event:e,r.resource=t,r.event=e,r.element=n,i.element.classList.add("b-eventeditor-editing"),r.editor?r.editor.render(i.timeAxisSubGridElement):(r.editor=Uu.new({owner:i.timeAxisSubGrid,appendTo:i.timeAxisSubGridElement,scrollAction:"realign",align:{align:"c-c"},cls:"b-simpleeventeditor",listeners:{complete:"onEditorComplete",cancel:"onEditorCancel",thisObj:r},onInternalKeyDown:e=>e.stopPropagation()},r.editorConfig),r.relayEvents(r.editor,["beforestart","start","beforecomplete","complete","beforecancel","cancel"])),e.isCreating&&(e.name=""),r.editor.startEdit({target:n,record:e,field:r.field}),r.scheduler.navigator.disabled=!0)}onEditorComplete(){this.event.isCreating=!1,this.reset()}onEditorCancel(){this.event.isCreating&&this.event.remove(),this.reset()}reset(){this.scheduler.element.classList.remove("b-eventeditor-editing"),this.scheduler.navigator.disabled=!1,this.event=null,this.resource=null}onEventEnterKey({assignmentRecord:e,eventRecord:t}){const n=e?this.scheduler.getElementFromAssignmentRecord(e):this.scheduler.getElementFromEventRecord(t),r=(e||t).resource;this.editEvent(t,r,n)}onDragCreateEnd({eventRecord:e,resourceRecord:t,eventElement:n}){this.element=n,this.editEvent(e,t,n)}}qb._$name="SimpleEventEdit",vg.registerFeature(qb,!1,"Scheduler");const Kb={width:0,height:0};class Xb extends Wr{construct(e,t){super.construct(e,t),e.isVertical&&(this.toUpdate=new Set,e.on({scroll:"onSchedulerScroll",thisObj:this,prio:1e4}))}onEventDataGenerated(e){this.client.isHorizontal?e.wrapperCls["b-disable-sticky"]=!1===e.eventRecord.stickyContents:(this.syncEventContentPosition(e,void 0,!0),this.updateStyles())}onSchedulerScroll(){this.disabled||this.verticalSyncAllEventsContentPosition(this.client)}updateStyles(){for(const{contentEl:e,style:t}of this.toUpdate)Mr.applyStyle(e,t);this.toUpdate.clear()}verticalSyncAllEventsContentPosition(e){const{resourceMap:t}=e.currentOrientation;for(const e of t.values())for(const{renderData:t,elementConfig:n}of Object.values(e)){const e=[t];n&&t.eventRecord.isResourceTimeRange&&e.push(n.children[0]),this.syncEventContentPosition.apply(this,e)}this.toUpdate.size&&this.updateStyles()}syncEventContentPosition(e,t=e.eventContent,n=!1){if(this.disabled||!1===e.eventRecord.stickyContents)return;const{client:r}=this,{eventRecord:i,resourceRecord:s,useEventBuffer:o,bufferAfterWidth:a,bufferBeforeWidth:l,top:c,height:d}=e,u=r.scrollable.y,h=n?null:r.getElementFromEventRecord(i,s,!0),g=h&&oa.getChild(h,"event.content"),m=i.instanceMeta(r),p="string"==typeof t.style?t.style=Mr.parseStyle(t.style):t.style||(t.style={});if(null!=h&&h.classList.contains("b-dragging"))return;let f=c,v=d,y=f+v;if(o&&(f+=l,v=v-l-a,y=f+v),f<u&&y>=u&&!i.isMilestone){const t=null==g?void 0:g.offsetWidth,n="center"===((null==g?void 0:g.parentNode)&&Mr.getStyleValue(g.parentNode,"justifyContent"))?(e.width-t)/2:0,r=f,i=r+v-1;if((!g||t)&&r<u&&i>=u){const e=this.getEventContentMargins(g),t=g?v-g.offsetHeight-e.height-n:Number.MAX_SAFE_INTEGER,i=Math.min(u-r,t-2);p.transform=i>0?`translateY(${i}px)`:"",m.stuck=!0}else p.transform="",m.stuck=!1;g&&this.toUpdate.add({contentEl:g,style:p})}else g&&m.stuck&&(p.transform="",m.stuck=!1,this.toUpdate.add({contentEl:g,style:p}))}getEventContentMargins(e){return null!=e&&e.classList.contains("b-sch-event-content")?Mr.getEdgeSize(e,"margin"):Kb}doDisable(){super.doDisable(...arguments),this.isConfiguring||this.client.refreshWithTransition()}}v(Xb,"$name","StickyEvents"),v(Xb,"type","stickyEvents"),v(Xb,"pluginConfig",{chain:["onEventDataGenerated"]}),Xb._$name="StickyEvents",vg.registerFeature(Xb,!0,"Scheduler"),vg.registerFeature(Xb,!1,"ResourceHistogram");class Zb extends Jg{static get $name(){return"TimelineSummary"}static get configurable(){return{showTooltip:!0}}static get pluginConfig(){return{chain:["renderRows","updateProject"]}}construct(e,t){const n=this;super.construct(e,t),n.summaries||(n.summaries=[{renderer:n.renderer}]),e.isTimelineBase&&(n.updateProject(e.project),e.on({timeAxisViewModelUpdate:n.renderRows,thisObj:n}))}updateProject(e){this.detachListeners("summaryProject"),e.on({name:"summaryProject",dataReady:"updateTimelineSummaries",thisObj:this})}renderRows(){this.client.isHorizontal&&this.client.timeAxisSubGrid.footer.element.querySelector(".b-grid-footer").classList.add("b-sch-summarybar"),super.renderRows(),this.disabled||this.render()}get summaryBarElement(){return this.client.element.querySelector(".b-sch-summarybar")}render(){const e=this,{client:t}=e,n=t.isHorizontal?"width":"height",r=t.timeAxisViewModel.columnConfig,i=e.summaryBarElement;i&&(!e._tip&&e.showTooltip&&e.summaries.some((e=>e.label))&&(e._tip=new lu({id:`${t.id}-summary-tip`,cls:"b-timeaxis-summary-tip",hoverDelay:0,hideDelay:100,forElement:i,anchorToTarget:!0,trackMouse:!1,forSelector:".b-timeaxis-tick",getHtml:({activeTarget:e})=>e._tipHtml})),i.innerHTML=r[r.length-1].map((e=>`<div class="b-timeaxis-tick" style="${n}: ${e.width}px"></div>`)).join(""),e.updateTimelineSummaries())}refresh(){super.refresh(),this.updateTimelineSummaries()}doDisable(e){var t;const{isConfiguring:n}=this.client;super.doDisable(e),null===(t=this.summaryColumn)||void 0===t||t.toggle(!e),n||e||this.render()}doDestroy(){var e;null===(e=this._tip)||void 0===e||e.destroy(),super.doDestroy()}}Zb._$name="TimelineSummary";class Jb extends Zb{static get $name(){return"Summary"}static get configurable(){return{summaries:null,renderer:null,verticalSummaryColumnConfig:null}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("bindStore","updateEventStore","updateResourceStore"),e}construct(e,t){const n=this;n.scheduler=e,e.isVertical&&(e.timeAxisSubGrid.resizable=!1,t.hideFooters=!0,e.add(e.createSubGrid("right")),n.summaryColumn=e.columns.add(sn.assign({filterable:null,region:"right",cellCls:"b-grid-footer b-sch-summarybar",align:"center",sortable:!1,groupable:!1,htmlEncode:!1,enableHeaderContextMenu:!1,hidden:n.disabled},n.verticalSummaryColumnConfig))[0]),super.construct(e,t),e.isSchedulerBase&&(n.updateEventStore(e.eventStore),n.updateResourceStore(e.resourceStore))}updateEventStore(e){this.detachListeners("summaryEventStore"),e.on({name:"summaryEventStore",filter:"updateTimelineSummaries",thisObj:this})}updateResourceStore(e){this.detachListeners("summaryResourceStore"),e.on({name:"summaryResourceStore",filter:"updateTimelineSummaries",thisObj:this})}updateTimelineSummaries(){const e=this,{client:t}=e,{eventStore:n,timeAxis:r}=t,i=e.summaryBarElement,s=e.selectedOnly&&t.selectedRecords.length?t.selectedRecords:t.resourceStore.records;if(i&&t.isEngineReady){const o=t.getResourcesEventsPerTick(s,(({event:e})=>!n.isFiltered||n.records.includes(e)));Array.from(i.children).forEach(((i,s)=>{const a=r.getAt(s),l=o[s]||[];let c="",d=`<header>${e.L("L{Summary for}",t.getFormattedDate(a.startDate))}</header>`;e.summaries.forEach((r=>{const s=r.renderer({startDate:a.startDate,endDate:a.endDate,resourceStore:t.resourceStore,eventStore:n,events:l,element:i}),o=s?`<div class="b-timeaxis-summary-value">${s}</div>`:"";(e.summaries.length>1||s)&&(c+=o),d+=o?`<label>${r.label||""}</label>`+o:""})),i.innerHTML=c,i._tipHtml=c?d:""}))}}}Jb._$name="Summary",vg.registerFeature(Jb,!1,"Scheduler");const Qb={maintainVisibleStart:!0};class eC extends Hg{static get $name(){return"TimeAxisHeaderMenu"}static get defaultConfig(){return{processItems:null,items:null,type:"timeAxisHeader"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateTimeAxisHeaderMenu"),e}construct(){super.construct(...arguments),this.triggerEvent.includes("click")&&this.client.zoomOnTimeAxisDoubleClick&&(this.client.zoomOnTimeAxisDoubleClick=!1)}shouldShowMenu(e){const{column:t}=e;return t&&!1!==t.enableHeaderContextMenu&&t===this.client.timeAxisColumn}showContextMenu(e){super.showContextMenu(...arguments),this.menu&&(this.menu.scrollAction="realign")}populateTimeAxisHeaderMenu({items:e}){const t=this,{client:n}=t,r={magnitude:n.timeAxis.shiftIncrement,unit:n.timeAxis.shiftUnit};Object.assign(e,{zoomLevel:{text:"L{pickZoomLevel}",localeClass:t,icon:"b-fw-icon b-icon-search-plus",disabled:!n.presets.count||t.disabled,weight:200,menu:{type:"popup",items:{zoomSlider:{weight:210,type:"slider",minWidth:130,showValue:!1}},onBeforeShow({source:e}){const[r]=e.items;r.min=n.minZoomLevel,r.max=n.maxZoomLevel,r.value=n.zoomLevel,t.zoomDetatcher=r.on("input","onZoomSliderChange",t)},onHide(){t.zoomDetatcher&&(t.zoomDetatcher(),t.zoomDetatcher=null)}}},dateRange:{text:"L{activeDateRange}",localeClass:t,icon:"b-fw-icon b-icon-calendar",weight:300,menu:{type:"popup",cls:"b-sch-timeaxis-menu-daterange-popup",defaults:{localeClass:t},items:{startDateField:{type:"datefield",label:"L{startText}",weight:310,labelWidth:"6em",required:!0,step:r,listeners:{change:t.onRangeDateFieldChange,thisObj:t}},endDateField:{type:"datefield",label:"L{endText}",weight:320,labelWidth:"6em",required:!0,step:r,listeners:{change:t.onRangeDateFieldChange,thisObj:t}},leftShiftBtn:{type:"button",weight:330,cls:"b-left-nav-btn",icon:"b-icon b-icon-previous",color:"b-blue b-raised",flex:1,margin:0,listeners:{click:t.onLeftShiftBtnClick,thisObj:t}},todayBtn:{type:"button",weight:340,cls:"b-today-nav-btn",color:"b-blue b-raised",text:"L{todayText}",flex:4,margin:"0 8",listeners:{click:t.onTodayBtnClick,thisObj:t}},rightShiftBtn:{type:"button",weight:350,cls:"b-right-nav-btn",icon:"b-icon b-icon-next",color:"b-blue b-raised",flex:1,listeners:{click:t.onRightShiftBtnClick,thisObj:t}}},listeners:{paint:t.initDateRangeFields,thisObj:t}}}})}onZoomSliderChange({value:e}){const t=this;t.menu.scrollAction="realign",t.client.zoomLevel=e,t.menu.setTimeout({fn:()=>t.menu.scrollAction="hide",delay:100,cancelOutstanding:!0})}initDateRangeFields({source:e,firstPaint:t}){if(t){const{widgetMap:t}=e;this.startDateField=t.startDateField,this.endDateField=t.endDateField}this.initDates()}initDates(){const e=this;e.startDateField.suspendEvents(),e.endDateField.suspendEvents(),e.startDateField.value=e.startDateFieldInitialValue=e.client.startDate,e.endDateField.value=e.endDateFieldInitialValue=e.client.endDate,e.startDateField.resumeEvents(),e.endDateField.resumeEvents()}onRangeDateFieldChange({source:e}){const t=this,n=e===t.startDateField,{client:r}=t,{timeAxis:i}=r,s=t.startDateFieldInitialValue&&!n?t.startDateFieldInitialValue:t.startDateField.value;let o=t.endDateFieldInitialValue&&n?t.endDateFieldInitialValue:t.endDateField.value;n?t.startDateFieldInitialValue=null:t.endDateFieldInitialValue=null,o-s?o<s&&(o=en.add(s,i.shiftIncrement,i.shiftUnit)):o=en.add(o,i.shiftIncrement,i.shiftUnit),r.setTimeSpan(s,o,Qb),t.initDates()}onLeftShiftBtnClick(){this.client.timeAxis.shiftPrevious(),this.initDates()}onTodayBtnClick(){const e=en.clearTime(new Date);this.client.setTimeSpan(e,en.add(e,1,"day")),this.initDates()}onRightShiftBtnClick(){this.client.timeAxis.shiftNext(),this.initDates()}}eC._$name="TimeAxisHeaderMenu",vg.registerFeature(eC,!0,["Scheduler","Gantt"]),vg.registerFeature(eC,!1,"ResourceHistogram");class tC extends(Vy.mixin(Sy)){static get $name(){return"TimeRanges"}static get defaultConfig(){return{store:!0}}doDestroy(){var e;null===(e=this.storeDetacher)||void 0===e||e.call(this),super.doDestroy()}get timeRanges(){const e=this;if(!e._timeRanges){const{store:t}=e;let{records:n}=t;if(t.recurringEvents){const{startDate:t,endDate:r}=e.client.timeAxis;n=n.flatMap((e=>e.isRecurring?e.getOccurrencesForDateRange(t,r):e))}e.currentTimeLine&&(t.recurringEvents||(n=n.slice()),n.push(e.currentTimeLine)),e._timeRanges=n}return e._timeRanges}initCurrentTimeLine(){const e=this;if(e.currentTimeLine||!e.showCurrentTimeLine)return;const t="object"==typeof e.showCurrentTimeLine?e.showCurrentTimeLine:{};e.currentTimeLine=e.store.modelClass.new({id:"currentTime",cls:"b-sch-current-time"},t),e.currentTimeInterval=e.setInterval((()=>e.updateCurrentTimeLine()),e.currentTimeLineUpdateInterval),e._timeRanges=null,e.updateCurrentTimeLine()}updateCurrentTimeLine(){const e=this,{currentTimeLine:t}=e;t.startDate=new Date,t.originalData.name||(t.name=en.format(t.startDate,e.currentDateFormat)),e.renderRanges()}hideCurrentTimeLine(){const e=this;e.currentTimeLine&&(e.clearInterval(e.currentTimeInterval),e.currentTimeLine=null,e.refresh())}updateShowCurrentTimeLine(e){e?this.initCurrentTimeLine():this.hideCurrentTimeLine()}populateTimeAxisHeaderMenu({column:e,items:t}){t.currentTimeLine={weight:400,text:this.L("L{showCurrentTimeLine}"),checked:this.showCurrentTimeLine,onToggle:({checked:e})=>{this.showCurrentTimeLine=e}}}attachToStore(e){const t=this;let n=!1;t.storeDetacher&&(t.storeDetacher(),n=!0),t.storeDetacher=e.on({change:"onStoreChange",refresh:"onStoreChange",thisObj:t}),t._timeRanges=null,n&&t.renderRanges()}get store(){return this.client.project.timeRangeStore}updateStore(e){const{client:t}=this,{project:n}=t;e=n.timeRangeStore,this.attachToStore(e),t.timeRanges&&!t._timeRangesExposed&&(e.add(t.timeRanges),delete t.timeRanges)}attachToTimeRangeStore(e){this.store=e}resolveTimeRangeRecord(e){return this.store.getById(e.closest(this.baseSelector).dataset.id)}onStoreChange({type:e,action:t}){const n=this;n._timeRanges=null,n.disabled||!n.client.isVisible||n.isConfiguring||"refresh"===e&&"batch"!==t||n.client.runWithTransition((()=>n.renderRanges()),!n.client.refreshSuspended)}onDragStart(e){const t=this,{context:n}=e,r=t.resolveTimeRangeRecord(n.element.closest(t.baseSelector)),i=t.getBodyElementByRecord(r);n.relatedElements=[i],Object.assign(n,{record:r,rangeBodyEl:i,originRangeX:Mr.getTranslateX(i),originRangeY:Mr.getTranslateY(i)}),super.onDragStart(e),t.showTip(n)}onDrop(e){const{context:t}=e;if(!t.valid)return this.onInvalidDrop({context:t});const n=this,{client:r}=n,{record:i}=t,s=xn.from(t.rangeBodyEl),o=r.getDateFromCoordinate(s.getStart(r.rtl,r.isHorizontal),"round",!1);i.startDate-o!=0?i.setStartDate(o):n.onInvalidDrop(),n.destroyTip(),super.onDrop(e)}onResizeStart({context:e}){const t=this,n=t.resolveTimeRangeRecord(e.element.closest(t.baseSelector)),r=t.getBodyElementByRecord(n);Object.assign(e,{record:n,rangeBodyEl:r}),t.showTip(e)}onResizeDrag({context:e}){const{rangeBodyEl:t}=e;this.client.isVertical?("top"===e.edge&&Mr.setTranslateY(t,e.newY),t.style.height=e.newHeight+"px"):("left"===e.edge&&Mr.setTranslateX(t,e.newX),t.style.width=e.newWidth+"px")}onResize({context:e}){if(!e.valid)return this.onInvalidDrop({context:e});const t=this,{client:n}=t,{rtl:r}=n,i=e.record,s=xn.from(e.element),o=s.getStart(r,n.isHorizontal),a=s.getEnd(r,n.isHorizontal),l=n.getDateFromCoordinate(o,"round",!1),c=r&&"right"===e.edge||!r&&"left"===e.edge||"top"===e.edge,d=n.getDateFromCoordinate(a,"round",!1);(c&&i.startDate-l!=0||d&&i.endDate-d!=0)&&d>l?c?i.setStartDate(l,!1):i.setEndDate(d,!1):t.onInvalidResize({context:e}),t.destroyTip()}onInvalidResize({context:e}){const t=this;t.resize.reset(),e.rangeBodyEl.parentElement.lastDomConfig=e.rangeBodyEl.lastDomConfig=null,t.renderRanges(),t.destroyTip()}}v(tC,"configurable",{store:{modelClass:Ev},currentTimeLineUpdateInterval:1e4,currentDateFormat:"HH:mm",showCurrentTimeLine:!1}),tC._$name="TimeRanges",vg.registerFeature(tC,!1,["Scheduler","Gantt"]);class nC extends Vy{static get configurable(){return{enableResizing:!0,showTooltip:!1,dragTipTemplate:null,cls:"b-selected-time-span",dragHelperConfig:{skipUpdatingElement:!0},resizeHelperConfig:{skipUpdatingElement:!0},headerRenderer({timeRange:e}){const{dateFormat:t}=this.client.timeAxisViewModel.bottomHeader;return`<span class="b-selection-start">${en.format(e.startDate,t)}</span>\n                        <span class="b-selection-end">${en.format(e.endDate,t)}</span>\n                        <i class='b-icon b-icon-close' data-ref="closeButton" data-btip="L{Popup.close}"></i>`},selectedTimeSpan:null}}onUIReady(){super.onUIReady(),this.client.on({timeAxisHeaderMouseDown:"onTimeAxisHeaderMouseDown",thisObj:this})}onTimeAxisHeaderMouseDown({startDate:e,endDate:t}){this.disabled||(this.selectedTimeSpan={startDate:e,endDate:t})}onTimeRangeClick(e){super.onTimeRangeClick(e);const t=this;!t.disabled&&e.target.closest(".b-selected-time-span")&&(e.target.matches('[data-ref="closeButton"]')?t.selectedTimeSpan=null:t.client.trigger("timeSelectionElementClick",f(f({},t.selectedTimeSpan),{},{domEvent:e})))}updateFromCoords(e,t,n,r){const{client:i}=this,s=i.isHorizontal?n:r;let o=i.isHorizontal?e:t;i.rtl&&i.isHorizontal&&(o=Math.max(i.timeAxisViewModel.totalSize-o-s,0));const a=i.getDateFromCoord({coord:o,roundingMethod:"round",ignoreRTL:!0}),l=i.getDateFromCoord({coord:o+s,roundingMethod:"round",ignoreRTL:!0});this.selectedTimeSpan={startDate:en.max(a,i.startDate),endDate:en.min(l,i.endDate)}}onResizeStart({source:e}){const{timeAxisViewModel:t,timeResolution:n}=this.client,r=en.asMilliseconds(n.increment,n.unit);this.resize.minWidth=t.getDistanceForDuration(r)}onResizeDrag({context:e}){var t,n;this.updateFromCoords(e.newX,e.newY,null!==(t=e.newWidth)&&void 0!==t?t:e.elementWidth,null!==(n=e.newHeight)&&void 0!==n?n:e.elementHeight)}onDragStart(e){super.onDragStart(e);const{context:t}=e;t.elementWidth=t.element.offsetWidth,t.elementHeight=t.element.offsetHeight}onDrag({context:e}){this.updateFromCoords(e.newX,e.newY,e.elementWidth,e.elementHeight)}onDrop(){this.client.element.classList.remove("b-dragging-timerange")}onDragReset(){this.refresh()}get timeRanges(){return this.selectedTimeSpan?[this.selectedTimeSpan]:[]}shouldRenderRange(){return!0}changeSelectedTimeSpan(e){return e&&(e.id="time-selection"),e}updateSelectedTimeSpan(e){this.isConfiguring||this.refresh(),this.client.trigger("timeSelectionChange",f({},null!=e?e:{}))}}v(nC,"$name","TimeSelection"),nC._$name="TimeSelection",vg.registerFeature(nC,!1,"Scheduler");const rC={completeview:"completeview",currentview:"currentview",daterange:"daterange"},iC=Promise.resolve();var sC=e=>class extends e{async scrollRowIntoView(e,t){const{rowManager:n,scrollable:r}=e,i=r.y;return t<e.store.count&&(r.scrollTo(null,n.calculateTop(t)),r.y!==i)?new Promise((r=>{const i=e.on({scroll({scrollTop:e}){null!=e&&n.getRow(t)&&(i(),r())}})})):iC}async scrollToDate(e,t){let n=!1;const r=[],i=e.timeAxisSubGrid.scrollable.on({scrollStart({x:e}){null!=e&&(n=!0)}});r.push(e.scrollToDate(t,{block:"start"})),i(),n&&r.push(e.timeAxisSubGrid.header.scrollable.await("scrollEnd",{checkLog:!1})),await Promise.all(r)}cloneElement(e,t,n){super.cloneElement(e,t,n);const r=this.element.querySelector(".b-schedulerbase");null==r||r.classList.remove(...["fade-in","slide-from-left","slide-from-top","zoom-in"].map((e=>`b-initial-${e}`)))}async prepareComponent(e){const t=this,{client:n}=e,{currentOrientation:r}=n,i=n.timeAxisSubGrid.width>0;switch(e.scheduleRange){case rC.completeview:e.rangeStart=n.startDate,e.rangeEnd=n.endDate;break;case rC.currentview:{const{startDate:t,endDate:r}=n.visibleDateRange;e.rangeStart=t,e.rangeEnd=r;break}}await n.waitForAnimations(),e.infiniteScroll=n.infiniteScroll,n.infiniteScroll=!1,i&&(n.setTimeSpan(e.rangeStart,e.rangeEnd),n.svgCanvas),t._oldEnableEventAnimations=n.enableEventAnimations,n.enableEventAnimations=!1,r.isHorizontalRendering&&(t._oldScrollBuffer=r.scrollBuffer,t._oldVerticalBuffer=r.verticalBufferSize,r.scrollBuffer=100,r.verticalBufferSize=-1),n.ignoreViewBox=!0,await super.prepareComponent(e);const{exportMeta:s,element:o}=t,a=o.querySelector(".b-sch-foreground-canvas"),l=o.querySelector(".b-horizontaltimeaxis");if(s.includeTimeline=i,i&&e.scheduleRange!==rC.completeview){s.totalWidth-=s.subGrids.normal.width,s.totalWidth+=s.subGrids.normal.width=n.timeAxisViewModel.getDistanceBetweenDates(e.rangeStart,e.rangeEnd);const t=Math.ceil(s.totalWidth/s.pageWidth),r=t*s.verticalPages;s.horizontalPages=t,s.totalPages=r,s.subGrids.normal.scrollLeft=n.getCoordinateFromDate(e.rangeStart)}if(s.timeAxisHeaders=[],s.timeAxisPlaceholders=[],s.headersColleted=!1,Mr.forEachSelector(l,".b-sch-header-row",(e=>{s.timeAxisPlaceholders.push(t.createPlaceholder(e)),s.timeAxisHeaders.push(new Map)})),s.subGrids.normal.eventsPlaceholder=t.createPlaceholder(a,!1),Mr.removeEachSelector(a,".b-sch-event-wrap,.b-sch-resourcetimerange"),Mr.removeEachSelector(t.element,".b-released"),s.eventsBoxes=new Map,s.client=n,n.hasActiveFeature("columnLines")){const e=o.querySelector(".b-column-lines-canvas");s.columnLinesPlaceholder=t.createPlaceholder(e),s.columnLines={lines:new Map,majorLines:new Map}}if(n.hasActiveFeature("timeRanges")){const e=o.querySelector(".b-sch-timeaxiscolumn .b-sch-timeranges-canvas"),n=o.querySelector(".b-sch-foreground-canvas .b-sch-timeranges-canvas");s.timeRanges={},e&&(s.timeRanges.header={},s.timeRangesHeaderPlaceholder=t.createPlaceholder(e)),s.timeRanges.body={},s.timeRangesBodyPlaceholder=t.createPlaceholder(n)}if(n.hasActiveFeature("dependencies")){n.features.dependencies.fillDrawingCache();const e=o.querySelector(`[id="${n.svgCanvas.getAttribute("id")}"]`);e&&(s.dependencyCanvasEl=e,s.dependenciesPlaceholder=t.createPlaceholder(e,!1,{ns:"http://www.w3.org/2000/svg",tag:"path"}),Mr.removeEachSelector(e,".b-sch-dependency"))}i&&!en.betweenLesser(e.rangeStart,n.startDate,n.endDate)&&await t.scrollToDate(n,e.rangeStart)}async restoreState(e){let t=!1;const{client:n}=e,r=[],i=n.timeAxisSubGrid.scrollable.on({scrollStart({x:e}){this.element.scrollLeft!==e&&(t=!0)}});r.push(super.restoreState(e)),i(),t&&r.push(n.timeAxisSubGrid.header.scrollable.await("scrollEnd",{checkLog:!1})),await Promise.all(r)}async restoreComponent(e){const{client:t}=e,{currentOrientation:n}=t;t.ignoreViewBox=!1,t.infiniteScroll=e.infiniteScroll,t.enableEventAnimations=this._oldEnableEventAnimations,n.isHorizontalRendering&&(n.scrollBuffer=this._oldScrollBuffer,n.verticalBufferSize=this._oldVerticalBuffer),await super.restoreComponent(e)}async onRowsCollected(e,t){const n=this;if(await super.onRowsCollected(e,t),n.exportMeta.includeTimeline){const{client:r,enableDirectRendering:i}=t,{timeView:s}=r,{pageRangeStart:o,pageRangeEnd:a}=n.getCurrentPageDateRange(t);if(i)o&&a&&(n.renderHeaders(t,o,a),n.renderLines(t,o,a),n.renderRanges(t,o,a),n.renderEvents(t,e,o,a));else{if(o){let i=!1;for(await n.scrollToDate(r,o);!i;)if(n.collectLines(t),n.collectHeaders(t),n.collectRanges(t),n.collectEvents(e,t),en.timeSpanContains(s.startDate,s.endDate,o,a))i=!0;else if(s.endDate.getTime()>=a.getTime())i=!0;else{const e=s.endDate;if(await n.scrollToDate(r,s.endDate),e.getTime()===s.endDate.getTime())throw new Error("Could not scroll to date")}}await n.scrollToDate(r,t.rangeStart)}}}getCurrentPageDateRange({rangeStart:e,rangeEnd:t,enableDirectRendering:n,client:r}){const{exportMeta:i}=this,{horizontalPages:s,horizontalPosition:o,pageWidth:a,subGrids:l}=i;let c,d;if(s>1){const e=o*a,i=(o+1)*a,s=l.locked.width+l.locked.splitterWidth;if(i<=s)d=c=null;else{c=r.getDateFromCoordinate(Math.max(e-s,0));const o=n?1:1.2;d=r.getDateFromCoordinate((i-s)*o)||t}}else c=e,d=t;return{pageRangeStart:c,pageRangeEnd:d}}prepareExportElement(){const{element:e,exportMeta:t}=this,{id:n,headerId:r,footerId:i,scrollLeft:s}=t.subGrids.normal,o=e.querySelector(`[id="${n}"]`);return[".b-sch-background-canvas",".b-sch-foreground-canvas"].forEach((e=>{const n=o.querySelector(e);n&&(t.lastExportedRowBottom?n.style.height=`${t.lastExportedRowBottom}px`:n.style.height="",s&&(n.style.marginLeft=`-${s}px`))})),s&&[r,i].forEach((t=>{const n=e.querySelector(`[id="${t}"] .b-widget-scroller`);n&&(n.style.marginLeft=`-${s}px`)})),super.prepareExportElement()}collectHeaders(e){const{client:t}=e,{exportMeta:n}=this;if(!n.headersCollected){const e=t.timeView.element,r=n.timeAxisHeaders;Mr.forEachSelector(e,".b-sch-header-row",((e,i,s)=>{const o=r[i];Mr.forEachSelector(e,".b-sch-header-timeaxis-cell",(e=>{o.has(e.dataset.tickIndex)||o.set(e.dataset.tickIndex,e.outerHTML)})),i===s.length-1&&o.has(String(t.timeAxis.count-1))&&(n.headersCollected=!0)}))}}collectRanges(e){const{client:t}=e,{exportMeta:n}=this,{timeRanges:r}=n;if(!n.headersCollected&&r){const{headerCanvas:e,bodyCanvas:n}=t.features.timeRanges;e&&Mr.forEachSelector(e,".b-sch-timerange",(e=>{r.header[e.dataset.id]=e.outerHTML})),Mr.forEachSelector(n,".b-sch-timerange",(e=>{r.body[e.dataset.id]=e.outerHTML}))}}collectLines(e){const{client:t}=e,{exportMeta:n}=this,{columnLines:r}=n;if(!n.headersCollected&&r){const e=t.backgroundCanvas;Mr.forEachSelector(e,".b-column-line, .b-column-line-major",(e=>{if(e.classList.contains("b-column-line")){const t=Number(e.dataset.line.replace(/line-/,""));r.lines.set(t,e.outerHTML)}else{const t=Number(e.dataset.line.replace(/major-/,""));r.majorLines.set(t,e.outerHTML)}}))}}collectEvents(e,t){const n=e.length,{client:r}=t,i=this.exportMeta.subGrids.normal.rows;e.forEach(((e,t)=>{var s,o;const a=i[i.length-n+t],l=r.store.getAt(e.dataIndex),c=a[3];null===(s=l.events)||void 0===s||s.forEach((e=>{if(e.isScheduled){let t=r.getElementFromEventRecord(e,l);t&&(t=t.parentElement)&&!c.has(e.id)&&c.set(e.id,[t.outerHTML,xn.from(t,t.offsetParent)])}})),null===(o=l.timeRanges)||void 0===o||o.forEach((e=>{var t;const n=(null===(t=r.features.resourceTimeRanges)||void 0===t?void 0:t.generateElementId(e))||"",i=r.foregroundCanvas.syncIdMap[n];i&&!c.has(n)&&c.set(n,[i.outerHTML,xn.from(i,i.offsetParent)])}))}))}renderHeaders(e,t,n){const{exportMeta:r}=this,{client:i}=e,s=r.timeAxisHeaders,{timeAxisView:o}=i.timeAxisColumn,a=o.buildCells(t,n),l=document.createElement("div");oa.sync({targetElement:l,domConfig:a}),Mr.forEachSelector(l,".b-sch-header-row",((e,t)=>{const n=s[t];Mr.forEachSelector(e,".b-sch-header-timeaxis-cell",(e=>{n.has(e.dataset.tickIndex)||n.set(e.dataset.tickIndex,e.outerHTML)}))}))}renderEvents(e,t,n,r){const{client:i}=e,s=this.exportMeta.subGrids.normal.rows;t.forEach(((e,t)=>{const o=s[t][3],a=i.store.getAt(e.dataIndex),l=i.currentOrientation.getResourceLayout(a),c=i.getCoordinateFromDate(n),d=i.getCoordinateFromDate(r),u=i.currentOrientation.getEventDOMConfigForCurrentView(l,e,c,d),h=document.createElement("div");u.forEach((e=>{const{eventId:t}=e.dataset,{left:n,top:r,width:i,height:s}=e.style;oa.sync({targetElement:h,domConfig:e}),o.set(t,[h.outerHTML,new xn(n,r,i,s)])}))}))}renderLines(e,t,n){const{client:r}=e,{exportMeta:i}=this,{columnLines:s}=i;if(s){const e=r.features.columnLines.getColumnLinesDOMConfig(t,n),i=document.createElement("div");oa.sync({targetElement:i,domConfig:{children:e},onlyChildren:!0}),s.lines.set(0,i.innerHTML)}}renderRanges(e,t,n){const{client:r}=e,{exportMeta:i}=this,{timeRanges:s}=i;if(s){const e=r.features.timeRanges.getDOMConfig(t,n),i=document.createElement("div");e.forEach(((e,t)=>{oa.sync({targetElement:i,domConfig:{children:e,onlyChildren:!0}}),0===t?s.body=i.innerHTML:s.header=i.innerHTML}))}}buildPageHtml(e){const t=this,{subGrids:n,timeAxisHeaders:r,timeAxisPlaceholders:i,columnLines:s,columnLinesPlaceholder:o,timeRanges:a,timeRangesHeaderPlaceholder:l,timeRangesBodyPlaceholder:c}=t.exportMeta,{enableDirectRendering:d}=e;let u=t.prepareExportElement();if(Object.values(n).forEach((({placeHolder:n,eventsPlaceholder:r,rows:i,mergedCellsHtml:s})=>{const o=n.outerHTML,{resources:a,events:l}=t.positionRows(i,e);let c=a.join("");null!=s&&s.length&&(c+=`<div class="b-grid-merged-cells-container">${s.join("")}</div>`),u=u.replace(o,c),r&&(u=u.replace(r.outerHTML,l.join("")))})),r.forEach(((e,t)=>{u=u.replace(i[t].outerHTML,Array.from(e.values()).join(""))})),s){const e=Array.from(s.lines.values()).concat(Array.from(s.majorLines.values()));u=u.replace(o.outerHTML,e.join("")),d&&(t.exportMeta.columnLines.lines.clear(),t.exportMeta.columnLines.majorLines.clear())}return a&&(d?(u=u.replace(c.outerHTML,a.body),l&&(u=u.replace(l.outerHTML,a.header)),t.exportMeta.timeRanges={}):(u=u.replace(c.outerHTML,Object.values(a.body).join("")),l&&(u=u.replace(l.outerHTML,Object.values(a.body).join(""))))),u=t.buildDependenciesHtml(u),u}getEventBox(e){const{eventsBoxes:t,enableDirectRendering:n}=this.exportMeta,r=e&&t.get(String(e.id));return n&&r&&e.isMilestone&&r.translate(-r.width/2,0),r}renderDependencies(){const e=this,{client:t,eventsBoxes:n}=e.exportMeta,{dependencies:r}=t,i=t.features.dependencies,s=Mr.createElement();let o=!1;return r.forEach((t=>{if(!n.has(String(t.from))&&!n.has(String(t.to))||!i.isDependencyVisible(t))return;const r=e.getEventBox(t.fromEvent),s=e.getEventBox(t.toEvent);i.drawDependency(t,!0,{from:null==r?void 0:r.clone(),to:null==s?void 0:s.clone()}),o=!0})),o&&i.domSync(s),s.innerHTML}buildDependenciesHtml(e){const{dependenciesPlaceholder:t,includeTimeline:n}=this.exportMeta;if(t&&n){const n=t.outerHTML;e=e.replace(n,this.renderDependencies())}return e}};class oC extends(sC(pm)){static get $name(){return"MultiPageExporter"}static get type(){return"multipage"}async stateNextPage(e){await super.stateNextPage(e),this.exportMeta.eventsBoxes.clear()}positionRows(e){const t=[],n=[];return e.forEach((([e,r,i,s])=>{t.push(e),s&&Array.from(s.entries()).forEach((([e,[t,r,i=[]]])=>{n.push(t+i.join("")),this.exportMeta.eventsBoxes.set(String(e),r)}))})),{resources:t,events:n}}}oC._$name="MultiPageExporter";class aC extends(sC(fm)){static get $name(){return"MultiPageVerticalExporter"}static get type(){return"multipagevertical"}async stateNextPage(e){await super.stateNextPage(e),this.exportMeta.eventsBoxes.clear()}async prepareComponent(e){await super.prepareComponent(e),e.scheduleRange!==rC.completeview&&this.estimateTotalPages(e)}positionRows(e){const t=[],n=[];return e.forEach((([e,,,r])=>{t.push(e),r&&Array.from(r.entries()).forEach((([e,[t,r,i=[]]])=>{n.push(t+i.join("")),this.exportMeta.eventsBoxes.set(String(e),r)}))})),{resources:t,events:n}}}aC._$name="MultiPageVerticalExporter";class lC extends Eu{static get $name(){return"ScheduleRangeCombo"}static get type(){return"schedulerangecombo"}static get defaultConfig(){return{editable:!1,localizeDisplayFields:!0,displayField:"text",buildItems(){return Object.entries(rC).map((([e,t])=>({value:e,text:"L{"+t+"}"})))}}}}lC.initClass(),lC._$name="ScheduleRangeCombo";class cC extends um{static get $name(){return"SchedulerExportDialog"}static get type(){return"schedulerexportdialog"}static get configurable(){return{defaults:{localeClass:this},items:{scheduleRangeField:{type:"schedulerangecombo",label:"L{Schedule range}",value:"completeview",weight:150,onChange({value:e}){this.parent.widgetMap.rangesContainer.hidden=e!==rC.daterange}},rangesContainer:{type:"container",flex:"1 0 100%",weight:151,hidden:!0,defaults:{localeClass:this},items:{filler:{weight:0,type:"widget"},rangeStartField:{type:"datefield",label:"L{Export from}",labelWidth:"3em",flex:"1 0 25%",weight:10,onChange({value:e}){this.parent.widgetMap.rangeEndField.min=en.add(e,1,"d")}},filler2:{type:"widget",weight:20,width:"0.5em"},rangeEndField:{type:"datefield",label:"L{Export to}",labelWidth:"1em",flex:"1 0 25%",weight:30,onChange({value:e}){this.parent.widgetMap.rangeStartField.max=en.add(e,-1,"d")}}}}}}}onLocaleChange(){const e=this.L("labelWidth");this.width=this.L("L{width}"),this.items.forEach((t=>{t instanceof fu?t.labelWidth=e:"rangesContainer"===t.ref&&(t.items[0].width=e)}))}applyInitialValues(e){super.applyInitialValues(e);const{client:t,scheduleRange:n}=e,r=e.items=e.items||{},i=r.scheduleRangeField=r.scheduleRangeField||{},s=r.rangesContainer=r.rangesContainer||{},o=s.items=s.items||{},a=o.filler=o.filler||{},l=o.rangeStartField=o.rangeStartField||{},c=o.rangeEndField=o.rangeEndField||{};a.width=this.L("labelWidth"),i.value=i.value||n,i.value===rC.daterange&&(s.hidden=!1);const d=l.value=l.value||t.startDate;l.max=en.max(t.startDate,en.add(t.endDate,-1,"d"));let u=c.value||t.endDate;u<=d&&(u=en.add(d,1,"d")),c.value=u,c.min=en.min(t.endDate,en.add(t.startDate,1,"d"))}}cC._$name="SchedulerExportDialog";class dC extends(sC(vm)){static get $name(){return"SinglePageExporter"}static get type(){return"singlepage"}collectDependencies(){}positionRows(e,t){const n=[],r=[],i=/translate\((\d+.?\d*)px, (\d+.?\d*)px\)/,s=/top:.+?px/;if(t.enableDirectRendering)e.forEach((([e,,,t])=>{n.push(e),t&&Array.from(t.entries()).forEach((([e,[t,n,i=[]]])=>{this.exportMeta.eventsBoxes.set(String(e),n),r.push(t+i.join(""))}))}));else{let t=0;e.forEach((([e,o,a,l])=>{n.push(e.replace(i,`translate($1px, ${t}px)`));const c=t-o;l&&Array.from(l.entries()).forEach((([e,[t,n]])=>{n.translate(0,c),this.exportMeta.eventsBoxes.set(String(e),n),r.push(t.replace(s,`top: ${n.y}px`))})),t+=a}))}return{resources:n,events:r}}}dC._$name="SinglePageExporter";class uC extends ym{static get $name(){return"PdfExport"}static get defaultConfig(){return{exporters:[dC,oC,aC],dialogClass:cC,scheduleRange:"completeview",rangeStart:null,rangeEnd:null}}get defaultExportDialogConfig(){return sn.copyProperties(super.defaultExportDialogConfig,this,["scheduleRange"])}buildExportConfig(e){e=super.buildExportConfig(e);const{scheduleRange:t,rangeStart:n,rangeEnd:r}=this;return e.columns&&!e.columns.find((e=>"timeAxis"===e.type))&&e.columns.push(e.client.timeAxisColumn.id),sn.assign({scheduleRange:t,rangeStart:n,rangeEnd:r},e)}}uC._$name="PdfExport",vg.registerFeature(uC,!1,"Scheduler");class hC extends(tt()){static get defaultConfig(){return{timeAxis:null,availableSpace:null,tickSize:100,snap:!1,forceFit:!1,headers:null,mode:"horizontal",suppressFit:!1,columnConfig:[],viewPreset:null,columnLinesFor:null,originalTickSize:null,headersDatesCache:[]}}construct(e){const t=this;t.unitToPixelsCache={},super.construct(e);const n=t.timeAxis.viewPreset||t.viewPreset;if(n)if(n instanceof fy)t.consumeViewPreset(n);else{const e=yy.getPreset(n);e&&t.consumeViewPreset(e)}t.timeAxis.on("reconfigure",t.onTimeAxisReconfigure,t),t.configured=!0}doDestroy(){this.timeAxis.un("reconfigure",this.onTimeAxisReconfigure,this),super.doDestroy()}calculateInfiniteScrollingDateRange(e,t,n=this.viewPreset){const{timeAxis:r,availableSpace:i}=this,{bufferCoef:s}=this.owner,{leafUnit:o,leafIncrement:a,tickSize:l}=n;if(t){const t=Math.ceil((i*s+i/2)/l);return{startDate:r.floorDate(en.add(e,-t*a,o),!1,o,a),endDate:r.ceilDate(en.add(e,t*a,o),!1,o,a)}}{const t=Math.ceil(i*s/l);return{startDate:r.floorDate(en.add(e,-t*a,o),!1,o,a),endDate:r.ceilDate(en.add(e,Math.ceil((i/l+t)*a),o),!1,o,a)}}}get columnConfig(){return this._columnConfig}set columnConfig(e){this._columnConfig=e}get headers(){return this._headers}set headers(e){if(e&&e.length&&e[e.length-1].cellGenerator)throw new Error("`cellGenerator` cannot be used for the bottom level of your headers. Use TimeAxis#generateTicks() instead.");this._headers=e}get isTimeAxisViewModel(){return!0}get isHorizontal(){return"vertical"!==this.mode}get isVertical(){return"vertical"===this.mode}set forceFit(e){e!==this._forceFit&&(this._forceFit=e,this.update())}reconfigure(e){this.headers=null,this.setConfig(e),this.trigger("reconfigure")}onTimeAxisReconfigure({source:e,suppressRefresh:t}){this.viewPreset!==e.viewPreset&&this.consumeViewPreset(e.viewPreset),t||this.update()}update(e,t=!1,n=!1){const r=this,{timeAxis:i,headers:s}=r;if(r.isConfiguring||r._availableSpace===e)return void(n&&r.trigger("update"));if(r._availableSpace=Math.max(e||r.availableSpace||0,0),"number"!=typeof r.availableSpace)throw new Error("Invalid available space provided to TimeAxisModel");r.columnConfig=[];const o=r._tickSize=r.calculateTickSize(r.originalTickSize);if("number"!=typeof o||o<=0)throw new Error("Invalid timeAxis tick size");r.unitToPixelsCache={},r._totalSize=null;for(let e=0,{length:t}=s;e<t;e++){const t=s[e];if(t.cellGenerator){const n=t.cellGenerator.call(r,i.startDate,i.endDate);r.columnConfig[e]=r.createHeaderRow(e,t,n)}else r.columnConfig[e]=r.createHeaderRow(e,t)}t||r.trigger("update")}getDistanceBetweenDates(e,t){return this.getPositionFromDate(t)-this.getPositionFromDate(e)}getDistanceForDuration(e){return this.getSingleUnitInPixels("millisecond")*e}getPositionFromDate(e,t={}){const n=this.getScaledTick(e,t);return-1===n?-1:this.tickSize*(n-this.timeAxis.visibleTickStart)}getScaledTick(e,{respectExclusion:t,snapToNextIncluded:n,isEnd:r,min:i,max:s}){const{timeAxis:o}=this,{include:a,unit:l}=o;let c=o.getTickFromDate(e);if(-1!==c&&t&&a){let t=!1;if(a.hour&&en.compareUnits(l,"hour")>0&&"day"!==l){const{from:r,to:i,lengthFactor:s,center:o}=a.hour,l=e.getHours(),c=Math.min(Math.max(l,r),i);if(!n&&c!==l)return-1;const d=o-(o-(c+e.getMinutes()/60))*s;e=en.add(e,d-l,"h"),t=!0}if(a.day&&en.compareUnits(l,"day")>0){const{from:l,to:c,lengthFactor:d,center:u}=a.day;let h=e.getDay();r&&0===e.getHours()&&0===e.getMinutes()&&0===e.getSeconds()&&0===e.getMilliseconds()&&--h<0&&(h=6);let g=0;if(h<l||h>=c){if(!n)return-1;if(g=r?(c-h-8)%7:(l-h+7)%7,e=en.add(e,g,"d"),e=en.startOf(e,"d",!1),s&&e.getTime()>=s||i&&e.getTime()<=i)return-1}const{weekStartDay:m}=o,p=0===e.getDay()?0:u,f=e.getDay()+e.getHours()/24,v=p-(p-f)*d;e=en.add(e,v-f+m,"d"),t=!0}t&&(e=en.constrain(e,o.startDate,o.endDate),c=o.getTickFromDate(e))}return c}getDateFromPosition(e,t,n=!1){const r=this,{timeAxis:i}=r,s=r.getScaledPosition(e)/r.tickSize+i.visibleTickStart;if(s<0||s>i.count){if(n){let e;return e=s<0?en.add(i.startDate,s,i.unit):en.add(i.endDate,s-i.count,i.unit),t&&(e=i[t+"Date"](e)),e}return null}return i.getDateFromTick(s,t)}getScaledPosition(e){const{include:t,unit:n,weekStartDay:r}=this.timeAxis;if(t){const i=this.getSingleUnitInPixels("day");if(t.day&&en.compareUnits(n,"day")>0){const{from:n,lengthFactor:s}=t.day,o=e%(7*i);e=o/s+(n-r)*i+(e-o)}if(t.hour&&en.compareUnits(n,"hour")>0&&"day"!==n){const{from:n,lengthFactorExcl:r}=t.hour,s=e%i;e=s/r+n*this.getSingleUnitInPixels("hour")+(e-s)}}return e}getSingleUnitInPixels(e){const t=this;return t.unitToPixelsCache[e]||(t.unitToPixelsCache[e]=en.getUnitToBaseUnitRatio(t.timeAxis.unit,e,!0)*t.tickSize/t.timeAxis.increment)}get snapPixelAmount(){if(this.snap){const{resolution:e}=this.timeAxis;return(e.increment||1)*this.getSingleUnitInPixels(e.unit)}return 1}get tickSize(){return this._tickSize}set tickSize(e){this.setTickSize(e,!1)}setTickSize(e,t){this._tickSize=this.originalTickSize=e,this.update(void 0,t)}get timeResolution(){return this.timeAxis.resolution}calculateTickSize(e){const t=this,{forceFit:n,timeAxis:r,suppressFit:i}=t,s=r.unit;let o=0,a=1;if(t.snap){const e=r.resolution;a=en.getUnitToBaseUnitRatio(s,e.unit)*e.increment}if(i)o=e;else{const i=t.availableSpace/r.visibleTickTimeSpan;o=n||e<i?i:e,a>0&&(!n||a<1)&&(o=Math.max(1,a*o)/a)}return o}get totalSize(){return this._totalSize||(this._totalSize=Math.floor(this.tickSize*this.timeAxis.visibleTickTimeSpan))}get availableSpace(){return this._availableSpace}set availableSpace(e){const t=this;if(t._availableSpace=Math.max(0,e),t._availableSpace>0){const e=t.calculateTickSize(t.originalTickSize);e>0&&e!==t.tickSize&&t.update()}}getDates(e=this.columnLinesFor,t=!1,n=!1){const r=this,i=[],s=t?r.lowestHeader:e,o=r.majorHeaderLevel,a=r.headers&&r.headers[e].unit,l=null!=o&&r.headers&&r.headers[o].unit,c=null!=o&&en.doesUnitsAlign(l,a);if(r.headers&&r.headers[s].cellGenerator){const e=r.columnConfig[s];for(let t=1,n=e.length;t<n;t++)i.push({date:e[t].startDate})}else r.forEachInterval(s,((t,s)=>{i.push({date:n?s:t,isMajor:o!==e&&c&&r.isMajorTick(n?s:t)})}));return i}get forceFit(){return this._forceFit}fitToAvailableSpace(e){const t=Math.floor(this.availableSpace/this.timeAxis.visibleTickTimeSpan);this.setTickSize(t,e)}get snap(){return this._snap}set snap(e){e!==this._snap&&(this._snap=e,this.configured&&this.update())}createHeaderRow(e,t,n){const r=this,i=[],{align:s,headerCellCls:o=""}=t,a=en.clearTime(new Date),{timeAxis:l}=r,c=r.headers.length-1,d=(n,d,h,g,m)=>{let p=en.format(n,t.dateFormat);const f=h>0&&!g,v={align:s,start:n,end:d,value:m?m.header:p,headerCellCls:o,width:c===e&&r.owner&&(l.fullTicks||f)?r.owner.tickSize:r.getDistanceBetweenDates(n,d),index:h};0!==v.width&&(v.coord=u-1,u+=v.width,r.headersDatesCache[e][n.getTime()]=1,t.renderer&&(p=t.renderer.call(t.thisObj||r,n,d,v,h),v.value=null==p?"":p),"day"!==t.unit||t.increment&&1!==t.increment||(v.headerCellCls+=" b-sch-dayheadercell-"+n.getDay(),en.clearTime(n,!0)-a==0&&(v.headerCellCls+=" b-sch-dayheadercell-today")),i.push(v))};let u=0;return r.headersDatesCache[e]={},n?n.forEach(((e,t)=>d(e.start,e.end,t,t===n.length-1,e))):r.forEachInterval(e,d),i}get mainHeader(){return"mainHeaderLevel"in this?this.headers[this.mainHeaderLevel]:this.bottomHeader}get bottomHeader(){return this.headers[this.headers.length-1]}get lowestHeader(){return this.headers.length-1}get majorHeaderLevel(){const{headers:e}=this;return e?Math.max(e.length-2,0):null}isMajorTick(e){const t=this.majorHeaderLevel;return null!=t&&this.headersDatesCache[t]&&this.headersDatesCache[t][e.getTime()]||!1}forEachInterval(e,t,n=this){const{headers:r,timeAxis:i}=this;if(r)if(e===r.length-1)i.forEach(((e,r)=>t.call(n,e.startDate,e.endDate,r,r===i.count-1)));else{const s=r[e];i.forEachAuxInterval(s.unit,s.increment,t,n)}}forEachMainInterval(e,t){this.forEachInterval(this.mainHeaderLevel,e,t)}consumeViewPreset(e){const t=this;t.headers=null,t.getConfig("tickSize"),t.viewPreset=e,Object.assign(t,{headers:e.headers,columnLinesFor:e.columnLinesFor,mainHeaderLevel:e.mainHeaderLevel,_tickSize:t.isHorizontal?e.tickWidth:e.tickHeight}),t.originalTickSize=t.tickSize}}hC._$name="TimeAxisViewModel";const gC=new Date;var mC=e=>{var t;return v(t=class extends(e||Te){getRtlX(e){return this.rtl&&this.isHorizontal&&(e=this.timeAxisViewModel.totalSize-e),e}getDateFromCoordinate(e,t,n=!0,r=!1,i=!1){return n||(e=this.currentOrientation.translateToScheduleCoordinate(e)),i||(e=this.getRtlX(e)),this.timeAxisViewModel.getDateFromPosition(e,t,r)}getDateFromCoord(e){return this.getDateFromCoordinate(e.coord,e.roundingMethod,e.local,e.allowOutOfRange,e.ignoreRTL)}getDateFromXY(e,t,n=!0,r=!1){return this.currentOrientation.getDateFromXY(e,t,n,r)}getDateFromDomEvent(e,t,n=!1){return this.getDateFromXY([e.pageX,e.pageY],t,!1,n)}getStartEndDatesFromRectangle(e,t,n,r=!1){const i=this,{isHorizontal:s}=i,o=s?e.x:e.top,a=s?e.right:e.bottom;let l,c;return o>=0&&a<i.timeAxisViewModel.totalSize?(l=i.getDateFromCoordinate(o,t,!0),c=i.getDateFromCoordinate(a,t,!0)):o<0?(c=i.getDateFromCoordinate(a,t,!0,r),l=c&&en.add(c,-n,"ms")):(l=i.getDateFromCoordinate(o,t,!0,r),c=l&&en.add(l,n,"ms")),{start:l,end:c}}get displayDateFormat(){return this._displayDateFormat}set displayDateFormat(e){this._displayDateFormat=e,this.trigger("displayDateFormatChange",{format:e})}getFormattedDate(e){return en.format(e,this.displayDateFormat)}getDisplayEndDate(e,t){return 0!==e.getHours()||0!==e.getMinutes()||t&&e.getYear()===t.getYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()||en.formatContainsHourInfo(this.displayDateFormat)||(e=en.add(e,-1,"day")),e}getFormattedEndDate(e,t){return this.getFormattedDate(this.getDisplayEndDate(e,t))}getCoordinateFromDate(e,t=!0){const n=this,{timeAxisViewModel:r}=n,{isContinuous:i,startMS:s,endMS:o,startDate:a,endDate:l,unit:c}=n.timeAxis,d=e.valueOf();let u;if(!0===t?t={local:!0}:t?"local"in t||(t.local=!0):t={local:!1},e instanceof Date||(gC.setTime(e),e=gC),i&&e.getTimezoneOffset()===a.getTimezoneOffset()&&a.getTimezoneOffset()===l.getTimezoneOffset()&&-1!==en.getUnitToBaseUnitRatio(c,"day")){if(d<s||d>o)return-1;u=(d-s)/(o-s)*r.totalSize}else u=r.getPositionFromDate(e,t);return n.rtl&&n.isHorizontal&&(u=r.totalSize-u),t.local||(u=n.currentOrientation.translateToPageCoordinate(u)),u}getTimeSpanDistance(e,t){return this.timeAxisViewModel.getDistanceBetweenDates(e,t)}get viewportCenterDate(){const e=this,{isHorizontal:t,timeAxis:n}=e,{scrollable:r}=t?e.timeAxisSubGrid:e,i=r.x+r.clientWidth/2,s=r.y+r.clientHeight/2;if(n.isContinuous){const e=t?i/r.scrollWidth:s/r.scrollHeight,o=n.startMS+(n.endMS-n.startMS)*e;return new Date(o)}{const n=t?[i,0]:[0,s];return e.getDateFromXY(n,null,!0)}}get viewportCenterDateCached(){return this.cachedCenterDate||(this.cachedCenterDate=this.viewportCenterDate)}get timeResolution(){return this.timeAxis.resolution}set timeResolution(e){this.timeAxis.resolution="number"==typeof e?{increment:e,unit:this.timeAxis.resolution.unit}:e}get snap(){var e,t;return null!==(e=null===(t=this._timeAxisViewModel)||void 0===t?void 0:t.snap)&&void 0!==e?e:this._snap}updateSnap(e){this.isConfiguring||(this.timeAxisViewModel.snap=e,this.timeAxis.forceFullTicks=e&&this.fillTicks)}onSchedulerHorizontalScroll({subGrid:e,scrollLeft:t,scrollX:n}){this.scrollingToCenter||(this.cachedCenterDate=null)}get widgetClass(){}},"$name","TimelineDateMapper"),v(t,"configurable",{snap:!1}),t};const{eventNameMap:pC}=_n;var fC=e=>{var t;return t=class extends(e||Te){constructor(...e){super(...e),v(this,"hoveredEvents",new Set)}initDomEvents(){const e=this,{schedulerEvents:t,schedulerEnterLeaveEvents:n}=e;t.element=n.element=e.timeAxisSubGridElement,t.thisObj=n.thisObj=e,_n.on(t),_n.on(n),y.supportsPointerEventConstructor&&(e.docScrollListener=_n.on({element:document,scroll:"onScheduleScroll",capture:!0,thisObj:e}))}doDestroy(){this.docScrollListener(),super.doDestroy()}getTimeSpanMouseEventParams(e,t){throw new Error("Implement in subclass")}getScheduleMouseEventParams(e,t){throw new Error("Implement in subclass")}handleScheduleEvent(e){const t=this,n=t.getTimelineEventContext(e);t.lastPointerEvent=e,n&&t.trigger(`${n.eventElement?t.scheduledEventName:"schedule"}${pC[e.type]||_.capitalize(e.type)}`,n),t.timelineContext=n}handleScheduleEnterLeaveEvent(e){e.target.parentElement===this.foregroundCanvas&&this.handleScheduleEvent(e)}onScheduleScroll(e){var t;if(e.target&&(null===(t=this.features.pan)||void 0===t||!t.isActive)&&(e.target.contains(this.element)||this.bodyElement.contains(e.target))){const{timelineContext:e,lastPointerEvent:t}=this;if(e){const n=Mr.elementFromPoint(e.domEvent.clientX,e.domEvent.clientY),r=new PointerEvent("pointermove",t),i=new MouseEvent("mousemove",t);r.scrollInitiated=i.scrollInitiated=!0,null==n||n.dispatchEvent(r),null==n||n.dispatchEvent(i)}}}updateTimelineContext(e,t){this.trigger("timelineContextChange",{oldContext:t,context:e}),e||this.trigger("scheduleMouseLeave")}getTimelineEventContext(e){const t=this,n=e.target.closest(t.eventInnerSelector),r=t.getCellElementFromDomEvent(e);if(r){const i=t.getDateFromDomEvent(e,"floor");if(!i)return;const s=Ps.get(r),o=n?t.getTimeSpanMouseEventParams(n,e):t.getScheduleMouseEventParams(s,e),a=t.isVertical?t.resourceStore.indexOf(o.resourceRecord):s.row.dataIndex,l=t.timeAxis.getTickFromDate(i),c=t.timeAxis.getAt(Math.floor(l));if(c)return f({isTimelineContext:!0,domEvent:e,eventElement:n,cellElement:r,index:a,tick:c,tickIndex:l,date:i,tickStartDate:c.startDate,tickEndDate:c.endDate,tickParentIndex:c.parentIndex,row:s.row,event:e},o)}}getCellElementFromDomEvent({target:e,clientY:t,type:n}){const r=this,{isVertical:i,foregroundCanvas:s}=r,o=e.closest(r.eventSelector);var a;return s.contains(e)&&(o||e===s||"mousemove"===n)?null===(a=r.rowManager.getRowAt(t,!1))||void 0===a?void 0:a.getCell(r.timeAxisColumn.id):o?r.getCell({[i?"row":"record"]:i?0:r.resolveRowRecord(o),column:r.timeAxisColumn}):e.matches(".b-grid-row")?e.firstElementChild:e.closest(r.timeCellSelector)}matchScheduleCell(e){return e.closest(this.timeCellSelector)}onElementMouseButtonEvent(e){const t=e.target.closest(".b-sch-header-timeaxis-cell");if(t){const n=t.dataset.tickIndex,r=t.parentElement.dataset.headerPosition,i=this.timeAxisViewModel.columnConfig[r][n],s=this.features.contextMenu;s&&e.type===s.triggerEvent||this.trigger(`timeAxisHeader${_.capitalize(e.type)}`,{startDate:i.start,endDate:i.end,event:e})}}onElementMouseDown(e){this.onElementMouseButtonEvent(e),super.onElementMouseDown(e)}onElementClick(e){this.onElementMouseButtonEvent(e),super.onElementClick(e)}onElementDblClick(e){this.onElementMouseButtonEvent(e),super.onElementDblClick(e)}onElementContextMenu(e){this.onElementMouseButtonEvent(e),super.onElementContextMenu(e)}onElementMouseOver(e){var t;super.onElementMouseOver(e);const n=this,{target:r}=e,{hoveredEvents:i}=n;if(!r.closest(n.eventInnerSelector)||null!==(t=n.features.eventDrag)&&void 0!==t&&t.isDragging)i.size&&n.unhoverAll(e);else{const t=r.closest(n.eventSelector);if(!i.has(t)&&!n.preventOverCls){i.add(t),t.classList.add(n.overScheduledEventClass);const r=n.getTimeSpanMouseEventParams(t,e);r&&n.trigger(`${n.scheduledEventName}MouseEnter`,r)}}}onElementMouseOut(e){var t;super.onElementMouseOut(e);const n=this,{target:r,relatedTarget:i}=e,s=r.closest(n.eventInnerSelector),o=r.closest(n.eventSelector),a=n.resolveTimeSpanRecord(r);if(s&&a&&n.hoveredEvents.has(o)&&(null===(t=n.features.eventDrag)||void 0===t||!t.isDragging)){if(i&&Mr.isDescendant(s,i))return;n.unhover(o,e)}}unhover(e,t){const n=this;e.classList.remove(n.overScheduledEventClass),n.trigger(`${n.scheduledEventName}MouseLeave`,n.getTimeSpanMouseEventParams(e,t)),n.hoveredEvents.delete(e)}unhoverAll(e){for(const t of this.hoveredEvents)!t.isReleased&&!t.classList.contains("b-released")&&this.unhover(t,e);this.hoveredEvents.clear()}get widgetClass(){}},v(t,"$name","TimelineDomEvents"),v(t,"configurable",{timelineContext:{$config:{equal(e,t){return(null==e?void 0:e.index)===(null==t?void 0:t.index)&&(null==e?void 0:e.tickParentIndex)===(null==t?void 0:t.tickParentIndex)&&!(((null==e?void 0:e.tickStartDate)||0)-((null==t?void 0:t.tickStartDate)||0))}}}}),v(t,"properties",{schedulerEvents:{mouseover:"handleScheduleEvent",mousedown:"handleScheduleEvent",mouseup:"handleScheduleEvent",click:"handleScheduleEvent",dblclick:"handleScheduleEvent",contextmenu:"handleScheduleEvent",mousemove:"handleScheduleEvent",mouseout:"handleScheduleEvent"},schedulerEnterLeaveEvents:{mouseenter:"handleScheduleEnterLeaveEvent",mouseleave:"handleScheduleEnterLeaveEvent",capture:!0}}),v(t,"delayable",{onScheduleScroll:"raf"}),t};const vC=(e=0,t=0)=>t-e;var yC=e=>class extends(e||Te){static get $name(){return"TimelineViewPresets"}static get configurable(){return{viewPreset:"weekAndDayLetter",presets:!0,displayDateFormat:null}}changePresets(e){const t={owner:this};let n=[];if(!0===e)n=yy.allRecords;else if(Array.isArray(e))for(const t of e)if("string"==typeof t){const e=yy.getById(t);e&&n.push(e)}else n.push(t);else sn.assign(t,e);const r=new vy(t);return r.add(n),r}changeViewPreset(e,t){const n=this,{presets:r}=n;e?(e=r.createRecord(e),r.add(e)):e=r.first;const i=n.lastViewPresetOptions||{},s=e.options||(e.options={}),o=s.event={startDate:s.startDate,endDate:s.endDate,from:t,to:e,preset:e},a=!n._viewPreset||!n._viewPreset.equals(e),l=vC(s.startDate,i.startDate)||vC(s.endDate,i.endDate)||vC(s.centerDate,i.centerDate)||s.startDate&&vC(s.startDate,n.startDate)||s.endDate&&vC(s.endDate,n.endDate);if((a||l)&&(a||(n._viewPreset=null),n.isConfiguring||!1!==n.trigger("beforePresetChange",o)))return e}get displayDateFormat(){return this._displayDateFormat||this.viewPreset.displayDateFormat}updateViewPreset(e){const t=this,{options:n}=e,{event:r,startDate:i,endDate:s}=n,{isHorizontal:o,_timeAxis:a,_timeAxisViewModel:l}=t;let{centerDate:c}=n,d=!1;if(t._viewPresetChanging=!0,a&&!t.isConfiguring){if(t.lastViewPresetOptions=n,a.isConfigured){t.suspendRefresh();const n=sn.copyProperties({},t,["weekStartDay","startTime","endTime"]);t.infiniteScroll?Object.assign(n,l.calculateInfiniteScrollingDateRange(c,!0,e)):i?(n.startDate=i,n.endDate=s,!c&&s&&(c=new Date((i.getTime()+s.getTime())/2))):(n.startDate=a.startDate,n.endDate=s||a.endDate,c||(c=t.viewportCenterDate)),a.isConfigured=!1,a.viewPreset=e,a.reconfigure(n,!0),l.reconfigure({viewPreset:e,headers:e.headers,columnLinesFor:null!=e.columnLinesFor?e.columnLinesFor:e.headers.length-1,tickSize:o?e.tickWidth:e.tickHeight||e.tickWidth||60}),t.resumeRefresh(!1)}if(t.refresh(),!n.notScroll&&t.isPainted)if(c){t.cachedCenterDate=c,r.centerDate=c;const e=t.isHorizontal?t.timeAxisSubGrid.width:t.scrollable.clientHeight,n=Math.max(t.getCoordinateFromDate(c,!0)-e/2,0);t.scrollingToCenter=!0,n===(t.isHorizontal?t.scrollLeft:t.scrollTop)?d=!0:t.isHorizontal?t.scrollHorizontallyTo(n,!1):t.scrollVerticallyTo(n,!1),t.setTimeout((()=>{t.scrollingToCenter=!1}),100)}else 0===(t.isHorizontal?t.scrollLeft:t.scrollTop)?d=!0:t.timelineScroller.scrollTo(0)}t.dataset.presetId=e.id,t.trigger("presetChange",r),t._viewPresetChanging=!1,d&&(t.isHorizontal?t.currentOrientation.updateFromHorizontalScroll(t.scrollLeft,t.scrollX):t.currentOrientation.updateFromVerticalScroll(t.scrollTop))}doDestroy(){this._presets.owner===this&&this._presets.destroy(),super.doDestroy()}getCurrentConfig(e){const t=super.getCurrentConfig(e);return t.viewPreset&&t.viewPreset.name&&!t.viewPreset.base&&delete t.viewPreset.name,t}get widgetClass(){}},bC=e=>class extends(e||Te){static get $name(){return"TimelineZoomable"}static get defaultConfig(){return{zoomOnMouseWheel:!0,zoomOnTimeAxisDoubleClick:!0,preventScrollZoom:null,minZoomLevel:0,maxZoomLevel:null,visibleZoomFactor:5,zoomKeepsOriginalTimespan:null}}construct(e){const t=this;super.construct(e),t.zoomOnMouseWheel&&_n.on({element:t.timeAxisSubGridElement,wheel:"onWheel",throttled:{buffer:100,alt(e){e.ctrlKey&&e.preventDefault()}},thisObj:t,capture:!0,passive:!1}),t.zoomOnTimeAxisDoubleClick&&t.on("timeaxisheaderdblclick",(({startDate:e,endDate:n})=>{t.zoomToSpan({startDate:e,endDate:n})}))}get maxZoomLevel(){return this._maxZoomLevel||this.presets.count-1}set maxZoomLevel(e){if("number"!=typeof e&&(e=this.presets.count-1),e<0||e>=this.presets.count)throw new Error("Invalid range for `maxZoomLevel`");this._maxZoomLevel=e}get minZoomLevel(){return this._minZoomLevel}set minZoomLevel(e){if("number"!=typeof e&&(e=0),e<0||e>=this.presets.count)throw new Error("Invalid range for `minZoomLevel`");this._minZoomLevel=e}get zoomLevel(){return this.presets.indexOf(this.viewPreset)}set zoomLevel(e){this.zoomToLevel(e)}getMilliSecondsPerPixelForZoomLevel(e,t){const{bottomHeader:n}=e,r=this.isHorizontal?e.tickWidth:e.tickHeight;return Math.round((en.add(new Date(1,0,1),n.increment||1,n.unit)-new Date(1,0,1))/(t?r:e.actualWidth||r))}zoomTo(e){const t=this;"object"==typeof e?e.preset?t.zoomToLevel(e.preset,e):null!=e.level?t.zoomToLevel(e.level,e):t.zoomToSpan(e):t.zoomToLevel(e)}zoomToLevel(e,t={}){"number"==typeof e&&(e=Math.min(Math.max(e,this.minZoomLevel),this.maxZoomLevel));const n=this,{presets:r}=n,i=n.isVertical?"tickHeight":"tickWidth",s=r.createRecord(e),o=s[i],a=t.startDate?new Date(t.startDate):null,l=t.endDate?new Date(t.endDate):null;r.add(s);let c=a&&l?{startDate:a,endDate:l}:null;const d=t.centerDate?new Date(t.centerDate):c?new Date((a.getTime()+l.getTime())/2):n.viewportCenterDateCached,u=n.isVertical?n.scrollable.clientHeight:n.timeAxisSubGrid.width;return 0===u?null:(c||(c=n.calculateOptimalDateRange(d,u,s)),"width"in t&&s.setData(i,t.width),n.isZooming=!0,s.options={startDate:c.startDate||n.startDate,endDate:c.endDate||n.endDate,centerDate:d},n.viewPreset=s,s.actualWidth=n.timeAxisViewModel.tickSize,n.isZooming=!1,s.setData(i,o),n.zoomLevel)}zoomToFit(e){const t=this.eventStore.getTotalTimeSpan();(e=Object.assign({leftMargin:0,rightMargin:0},e,t)).startDate&&e.endDate&&(e.endDate>e.startDate?this.zoomToSpan(e):this.scrollToDate(e.startDate))}zoomToSpan(e={}){if((e.leftMargin||e.rightMargin)&&(e.adjustStart=0,e.adjustEnd=0),e.leftMargin||(e.leftMargin=0),e.rightMargin||(e.rightMargin=0),!e.startDate||!e.endDate)throw new Error("zoomToSpan: must provide startDate + endDate dates");const t=this,{timeAxis:n}=t,r=e.adjustStart>=0||e.adjustEnd>=0;let{startDate:i,endDate:s}=e;if(r&&(i=en.add(i,-e.adjustStart,n.mainUnit),s=en.add(s,e.adjustEnd,n.mainUnit)),i<=s){const{availableSpace:o}=t.timeAxisViewModel,a=t.presets.allRecords,l=s-i||1;let c,d,u=t.zoomLevel;-1===u&&(u=0);let h,g=t.getMilliSecondsPerPixelForZoomLevel(a[u],!0),m=u+(c=l/g+e.leftMargin+e.rightMargin>o?-1:1),p=null;for(;m>=0&&m<=a.length-1;){h=a[m],g=t.getMilliSecondsPerPixelForZoomLevel(h,!0);const n=l/g+e.leftMargin+e.rightMargin;if(-1===c){if(n<=o){p=m;break}}else{if(!(n<=o))break;u!==m-c&&(p=m)}m+=c}p=null!=p?p:m-c,h=a[p];const f=h.bottomHeader.unit;g=t.getMilliSecondsPerPixelForZoomLevel(h,!0),(e.leftMargin||e.rightMargin)&&(i=new Date(i.getTime()-g*e.leftMargin),s=new Date(s.getTime()+g*e.rightMargin));const v=en.getDurationInUnit(i,s,f,!0)/h.bottomHeader.increment;if(0===v)return null;const y=Math.floor(o/v),b=e.centerDate||new Date((i.getTime()+s.getTime())/2);d=r?{startDate:i,endDate:s}:t.calculateOptimalDateRange(b,o,h);let C=t.zoomLevel;return t.zoomLevel===p?n.reconfigure(d):C=t.zoomToLevel(p,Object.assign(d,{width:y,centerDate:b})),t.infiniteScroll&&t.scrollToDate(i,{block:"start"}),C}return null}zoomIn(e=1){const t=this.zoomLevel;return t>=this.maxZoomLevel?null:this.zoomToLevel(t+e)}zoomOut(e=1){const t=this.zoomLevel;return t<=this.minZoomLevel?null:this.zoomToLevel(t-e)}zoomInFull(){return this.zoomToLevel(this.maxZoomLevel)}zoomOutFull(){return this.zoomToLevel(this.minZoomLevel)}calculateOptimalDateRange(e,t,n,r){if(r)return r;const i=this,{timeAxis:s}=i,{bottomHeader:o}=n,a=i.isHorizontal?n.tickWidth:n.tickHeight;if(i.zoomKeepsOriginalTimespan)return{startDate:s.startDate,endDate:s.endDate};const l=o.unit,c=Math.ceil(t/a*o.increment*i.visibleZoomFactor/2),d=en.add(e,-c,l),u=en.add(e,c,l);return i.infiniteScroll?i.timeAxisViewModel.calculateInfiniteScrollingDateRange(e,!0):{startDate:s.floorDate(d,!1,l,o.increment),endDate:s.ceilDate(u,!1,l,o.increment)}}onWheel(e){const t=this;e.ctrlKey&&(e.preventDefault(),t.preventScrollZoom||(e.deltaY>0?t.zoomOut():e.deltaY<0&&t.zoomIn(),t.preventScrollZoom=!0,t.setTimeout((()=>t.preventScrollZoom=!1),30)))}setTimeSpan(e,t){this.timeAxis.setTimeSpan(e,t)}shift(e,t){this.timeAxis.shift(e,t)}shiftNext(e){this.timeAxis.shiftNext(e)}shiftPrevious(e){this.timeAxis.shiftPrevious(e)}get widgetClass(){}},CC=e=>class extends(e||Te){static get $name(){return"RecurringEvents"}static get configurable(){return{enableRecurringEvents:!1,recurrenceConfirmationPopup:{$config:["lazy"],value:{type:"recurrenceconfirmation"}}}}construct(e){super.construct(e),this.on({beforeeventdropfinalize:"onRecurrableBeforeEventDropFinalize",beforeeventresizefinalize:"onRecurrableBeforeEventResizeFinalize",beforeAssignmentDelete:"onRecurrableAssignmentBeforeDelete"})}changeRecurrenceConfirmationPopup(e,t){const n=this.constructor.reconfigure(t,e,"recurrenceconfirmation");return n.owner=this,n}findRecurringEventToConfirmDelete(e){return e.find((e=>e.supportsRecurring&&(e.isRecurring||e.isOccurrence)))}onRecurrableAssignmentBeforeDelete({assignmentRecords:e,context:t}){const n=e.map((e=>e.event)),r=this.findRecurringEventToConfirmDelete(n);if(this.enableRecurringEvents&&r)return this.recurrenceConfirmationPopup.confirm({actionType:"delete",eventRecord:r,changerFn(){t.finalize(!0)},cancelFn(){t.finalize(!1)}}),!1}onRecurrableBeforeEventDropFinalize({context:e}){if(this.enableRecurringEvents){const{eventRecords:t}=e,n=t.filter((e=>e.supportsRecurring&&(e.isRecurring||e.isOccurrence)));n.length&&(e.async=!0,this.recurrenceConfirmationPopup.confirm({actionType:"update",eventRecord:n[0],changerFn(){e.finalize(!0)},cancelFn(){e.finalize(!1)}}))}}onRecurrableBeforeEventResizeFinalize({context:e}){if(this.enableRecurringEvents){const{eventRecord:t}=e;t.supportsRecurring&&(t.isRecurring||t.isOccurrence)&&(e.async=!0,this.recurrenceConfirmationPopup.confirm({actionType:"update",eventRecord:t,changerFn(){e.finalize(!0)},cancelFn(){e.finalize(!1)}}))}}getOccurrencesFor(e){return this.eventStore.getOccurrencesForTimeSpan(e,this.timeAxis.startDate,this.timeAxis.endDate)}async removeEvents(e,t=null,n=this){const r=this;if(!r.readOnly&&e.length){const i={finalize(n=!0){t&&t(n),!1!==n&&(e.some((e=>{var t;return e.isOccurrence||(null===(t=e.event)||void 0===t?void 0:t.isOccurrence)}))?e.forEach((e=>e.isOccurrenceAssignment?e.event.remove():e.remove())):(e[0].isAssignment?r.assignmentStore:r.eventStore).remove(e))}};let s;if(s=e[0].isAssignment?r.trigger("beforeAssignmentDelete",{assignmentRecords:e,context:i}):r.trigger("beforeEventDelete",{eventRecords:e,context:i}),!1!==s){const t=e.find((e=>e.isRecurring||e.isOccurrence));return t?(r.recurrenceConfirmationPopup.owner=n,r.recurrenceConfirmationPopup.confirm({actionType:"delete",eventRecord:t,changerFn(){i.finalize(!0)},cancelFn(){i.finalize(!1)}})):i.finalize(!0),!0}}return!1}get widgetClass(){}},wC=e=>{var t;return v(t=class extends(e||Te){static get $name(){return"TimelineEventRendering"}static get defaultConfig(){return{resourceMargin:null,managedEventSizing:!0,generatedIdCls:"b-sch-dirty-new",dirtyCls:"b-sch-dirty",committingCls:"b-sch-committing",endsOutsideViewCls:"b-sch-event-endsoutside",startsOutsideViewCls:"b-sch-event-startsoutside",fixedEventCls:"b-sch-event-fixed",eventStyle:"plain",eventColor:"green",tickSize:null}}updateFillTicks(e){this.isConfiguring||(this.timeAxis.forceFullTicks=e&&this.snap,this.refreshWithTransition(),this.trigger("stateChange"))}changeBarMargin(e){return sn.assertNumber(e,"barMargin"),this.isHorizontal&&this.rowHeight?Math.min(Math.ceil(this.rowHeight/2),e):e}updateBarMargin(){this.rendered&&(this.currentOrientation.onBeforeRowHeightChange(),this.refreshWithTransition(),this.trigger("stateChange"))}get resourceMargin(){return null==this._resourceMargin?this.barMargin:this._resourceMargin}set resourceMargin(e){const t=this;sn.assertNumber(e,"resourceMargin"),t.isHorizontal&&t.rowHeight&&(e=Math.min(Math.ceil(t.rowHeight/2),e)),t._resourceMargin!==e&&(t._resourceMargin=e,t.rendered&&(t.currentOrientation.onBeforeRowHeightChange(),t.refreshWithTransition()))}set tickSize(e){sn.assertNumber(e,"tickSize"),this.timeAxisViewModel.tickSize=e}get tickSize(){return this.timeAxisViewModel.tickSize}static get eventColors(){return["red","pink","purple","violet","indigo","blue","cyan","teal","green","lime","yellow","orange","deep-orange","gray"]}static get eventStyles(){return["plain","border","hollow","colored","line","dashed","minimal","rounded"]}get widgetClass(){}},"configurable",{barMargin:10,fillTicks:!1}),t};const SC={maintainVisibleStart:!0},DC={block:"nearest"};var EC=e=>class extends(e||Te){static get $name(){return"TimelineScroll"}static get configurable(){return{bufferCoef:5,bufferThreshold:.2,infiniteScroll:!1}}initScroll(){const e=this,{isHorizontal:t}=e;super.initScroll();const{scrollable:n}=t?e.timeAxisSubGrid:e;if(e.timelineScroller=new xC({widget:e,scrollable:n,isHorizontal:t}),n.on({scroll:"onTimelineScroll",thisObj:e}),e.infiniteScroll){const{visibleDate:t}=e,n=t?t.date||t:e.viewportCenterDate,r=!t||!("block"in t)||"center"===t.block,{startDate:i,endDate:s}=e.timeAxisViewModel.calculateInfiniteScrollingDateRange(n,r);e.setTimeSpan(i,s,{visibleDate:n})}}doDestroy(){var e;null===(e=this.timelineScroller)||void 0===e||e.destroy(),super.doDestroy()}onTimelineScroll({source:e}){this.infiniteScroll&&this.checkTimeAxisScroll(e[this.isHorizontal?"x":"y"])}checkTimeAxisScroll(e){const t=this,n=t.timelineScroller,{clientSize:r}=n,i=r*t.bufferCoef*t.bufferThreshold,s=n.maxPosition,{style:o}=t.timeAxisSubGrid.virtualScrollerElement;(s-e<i||e<i)&&(o.overflow="hidden",o.pointerEvents="none",o.paddingBottom=`${Mr.scrollBarWidth}px`,t.setTimeout((()=>{o.overflow="",o.paddingBottom="",o.pointerEvents=""}),100),t.shiftToDate(t.getDateFromCoordinate(e,null,!0)))}shiftToDate(e,t){const n=this.timeAxisViewModel.calculateInfiniteScrollingDateRange(e,t);this.setTimeSpan(n.startDate,n.endDate,SC)}updateInfiniteScroll(e){!this.isConfiguring&&e&&this.checkTimeAxisScroll(this.timelineScroller.position)}scrollToDate(e,t={}){const n=this,{timeAxis:r,visibleDateRange:i,infiniteScroll:s}=n,{unit:o,increment:a}=r,l=t.edgeOffset||0,c=en.ceil(i.endDate,a+" "+o)-en.floor(i.startDate,a+" "+o),d=e>n.viewportCenterDate?1:-1,u=(s?c*n.bufferCoef*n.bufferThreshold:"center"===t.block?c/2:l?n.getMilliSecondsPerPixelForZoomLevel(n.viewPreset)*l:0)*d,h=new Date(e.getTime()+u);(h>r.endDate||h<r.startDate&&-1)&&n.infiniteScroll&&n.shiftToDate(new Date(e-u),null,!0);const g=n.timelineScroller.viewport,m=n.getCoordinateFromDate(e,!0),p=n.isHorizontal?new xn(n.getCoordinateFromDate(e,!1),g.y,n.timeAxisViewModel.tickSize,g.height):new xn(g.x,n.getCoordinateFromDate(e,!1),g.width,n.timeAxisViewModel.tickSize);return n.scrollToCoordinate(m,p,e,t)}scrollToNow(e={}){return this.scrollToDate(new Date,e)}async scrollToCoordinate(e,t,n,r={}){const i=this;if(e<0){const e=i.endDate-i.startDate,{unit:t,increment:s}=i.timeAxis,o=en.floor(new Date(n.getTime()-e/2),s+" "+t),a=en.add(o,e);return o-i.startDate!=0&&a-i.endDate!=0?(i.setTimeSpan(o,a),i.scrollToDate(n,r)):void 0}return await i.timelineScroller.scrollIntoView(t,r),!i.isDestroyed&&i.nextAnimationFrame()}set scrollLeft(e){this.timeAxisSubGrid.scrollable.element.scrollLeft=e}get scrollLeft(){return this.timeAxisSubGrid.scrollable.element.scrollLeft}set scrollX(e){this.timeAxisSubGrid.scrollable.x=e}get scrollX(){return this.timeAxisSubGrid.scrollable.x}set scrollTop(e){this.scrollable.y=e}get scrollTop(){return this.scrollable.y}scrollHorizontallyTo(e,t=!0){return this.timeAxisSubGrid.scrollable.scrollTo(e,null,t)}scrollVerticallyTo(e,t=!0){return this.scrollable.scrollTo(null,e,t)}scrollTo(e,t=!0){return this.timeAxisSubGrid.scrollable.scrollTo(e,null,t)}get widgetClass(){}};class xC extends wa{static get configurable(){return{position:null,x:null,y:null}}updateOverflowX(){}updateOverflowY(){}onScroll(e){super.onScroll(e),this._position=null}syncPartners(e){this.scrollable.syncPartners(e)}updatePosition(e){this.scrollable[this.isHorizontal?"x":"y"]=e}get viewport(){return this.scrollable.viewport}get position(){return this._position=this.scrollable[this.isHorizontal?"x":"y"]}get clientSize(){return this.scrollable["client"+(this.isHorizontal?"Width":"Height")]}get scrollSize(){return this.scrollable["scroll"+(this.isHorizontal?"Width":"Height")]}get maxPosition(){return this.scrollable["max"+(this.isHorizontal?"X":"Y")]}scrollTo(e,t){return this.isHorizontal?this.scrollable.scrollTo(e,null,t):this.scrollable.scrollTo(null,e,t)}scrollBy(e=0,t=0,n=DC){return this.isHorizontal?this.scrollable.scrollBy(e||t,0,n):this.scrollable.scrollBy(0,t||e,n)}scrollIntoView(){return this.scrollable.scrollIntoView(...arguments)}changeX(e){this.position=e}changeY(e){this.position=e}get x(){return this.position}set x(e){this.scrollable[this.isHorizontal?"x":"y"]=e}get y(){return this.position}set y(e){this.scroller[this.isHorizontal?"x":"y"]=e}get clientWidth(){return this.clientSize}get clientHeight(){return this.clientSize}get scrollWidth(){return this.scrollSize}get scrollHeight(){return this.scrollSize}get maxX(){return this.maxPosition}get maxY(){return this.maxPosition}}const RC=["barMargin"];var TC=e=>class extends(e||Te){static get $name(){return"TimelineState"}getState(){const e=this,t=sn.copyProperties(super.getState(),e,RC);return t.zoomLevel=e.zoomLevel,t.zoomLevelOptions={startDate:e.startDate,endDate:e.endDate,centerDate:e.viewportCenterDate,width:e.tickSize},t}applyState(e){const t=this;var n;(t.suspendRefresh(),null!=e.zoomLevel)&&(t.infiniteScroll&&null!=e&&null!==(n=e.scroll)&&void 0!==n&&n.scrollLeft&&(e.scroll.scrollLeft={}),t.isPainted?t.zoomToLevel(e.zoomLevel,e.zoomLevelOptions):t._zoomAfterPaint={zoomLevel:e.zoomLevel,zoomLevelOptions:e.zoomLevelOptions});sn.copyProperties(t,e,RC),super.applyState(e),t.resumeRefresh(!0)}onPaint(...e){if(super.onPaint(...e),this._zoomAfterPaint){const{zoomLevel:e,zoomLevelOptions:t}=this._zoomAfterPaint;this.zoomToLevel(e,t),delete this._zoomAfterPaint}}get widgetClass(){}};class MC extends Tm{static get $name(){return"SchedulerHeader"}refreshContent(){var e;null!==(e=this.headersElement)&&void 0!==e&&e.querySelector(".b-sch-timeaxiscolumn")||super.refreshContent()}}MC._$name="Header";class kC extends Km{static get $name(){return"TimeAxisSubGrid"}static get type(){return"timeaxissubgrid"}static get configurable(){return{sealedColumns:!0,headerClass:MC}}startConfigure(e){const{grid:t}=e;t.timeAxisSubGrid=this,super.startConfigure(e),t.isHorizontal&&(e.header={cls:{"b-sticky-headers":t.stickyHeaders}},delete e.headerClass),"flex"in e||"width"in e||(e.flex=1)}changeScrollable(){const e=this,t=super.changeScrollable(...arguments);return t&&Object.defineProperty(t,"scrollWidth",{get(){var e,t;return null!==(e=null===(t=this.element)||void 0===t?void 0:t.scrollWidth)&&void 0!==e?e:0},set(){e.grid.updateCanvasSize()}}),t}syncScrollingPartners(e=!0){this.grid._viewPresetChanging||super.syncScrollingPartners(e)}onInternalResize(e,t,n,r,i){const s=this;if(s.isPainted&&t!==r){const e=s.grid,n=e._bodyRectangle.height;Mr.scrollBarWidth&&t<r&&(s.monitorResize=!1),e.onSchedulerViewportResize(t,n,r,n),s.monitorResize||s.requestAnimationFrame((()=>s.monitorResize=!0))}super.onInternalResize(...arguments)}}kC.initClass(),kC._$name="TimeAxisSubGrid";const IC={fn:"exitTransition",delay:0,cancelOutstanding:!0},AC={};class FC extends(rp.mixin(mC,fC,wC,EC,TC,yC,bC,CC)){static get $name(){return"TimelineBase"}static get type(){return"timelinebase"}static get defaultConfig(){return{workingTime:null,timeAxis:null,timeAxisViewModel:null,autoAdjustTimeAxis:!0,snapRelativeToEventStartDate:!1,suppressFit:!1,timeCellCls:null,scheduledEventName:null,overScheduledEventClass:null,preventOverCls:!1,useBackgroundCanvas:!1,enableEventAnimations:!0,disableGridRowModelWarning:!0,animateRemovingRows:!1,partner:null,schedulerRegion:"normal",transitionDuration:200,animationTimeout:null,defaultRegion:"locked",durationDisplayPrecision:1,asyncEventSuffix:"PreCommit",viewportResizeTimeout:250}}populateEventMenu(){}populateScheduleMenu(){}onVisibleDateRangeChange(e){if(!this.handlingVisibleDateRangeChange){const t=this,{_visibleDateRange:n}=t;(!n||n.startDate-e.startDate||n.endDate-e.endDate)&&(t.timeView.range=e,t.handlingVisibleDateRangeChange=!0,t.trigger("visibleDateRangeChange",{old:n,new:e}),t.handlingVisibleDateRangeChange=!1,t._visibleDateRange=e)}}onVisibleResourceRangeChange(){}construct(e={}){const t=this;super.construct(e),t.$firstVerticalOverflow=!0,t.initDomEvents(),t.currentOrientation.init(),t.rowManager.on("refresh",(()=>{t.forceLayout=!1}))}createSubGrid(e,t={}){const n=this,{stickyHeaders:r}=n;return e===(n.schedulerRegion||"normal")?t.type="timeaxissubgrid":"locked"===e&&r&&n.isVertical&&(t.scrollable={overflowX:"visible",overflowY:"visible"},n.bodyContainer.classList.add("b-sticky-headers")),super.createSubGrid(e,t)}doDestroy(){const e=this,{partneredWith:t,currentOrientation:n}=e;null==n||n.destroy(),t?(t.forEach((t=>{e.removePartner(t)})),t.destroy()):(e.timeAxisViewModel.destroy(),e.timeAxis.destroy()),super.doDestroy()}startConfigure(e){super.startConfigure(e),ua.addResizeListener(this.bodyContainer,this.onBodyResize.bind(this)),this.getConfig("partner")}changeStartDate(e){return"string"==typeof e&&(e=en.parse(e)),e}onPaint({firstPaint:e}){if(e){const e=this,r=(e.isHorizontal?e.timeAxisSubGrid.scrollable:e.scrollable).element.getBoundingClientRect()[e.isHorizontal?"width":"height"];var t,n;e.timeAxisViewModel.update(r,e.infiniteScroll,!0),e.infiniteScroll&&(null===(t=(n=e.currentOrientation).doUpdateTimeView)||void 0===t||t.call(n))}super.onPaint(...arguments)}onSchedulerHorizontalScroll(e,t,n){this.currentOrientation.updateFromHorizontalScroll(n),super.onSchedulerHorizontalScroll(e,t,n)}initScroll(){const e=this;let t=0;super.initScroll(),e.on("horizontalscroll",(({subGrid:n,scrollLeft:r,scrollX:i})=>{!e.isPainted||n!==e.timeAxisSubGrid||e.isDestroying||e.refreshSuspended||e.onSchedulerHorizontalScroll(n,r,i),t++})),"horizontal"===e.testPerformance&&e.setTimeout((()=>{const n=performance.now();let r=5,i=1;const s=e.setInterval((()=>{if(r+=5,e.scrollX+=(10+Math.floor(r))*i,1===i&&e.scrollX>5500&&(i=-1,r=5),-1===i&&e.scrollX<=0){const r=(performance.now()-n)/t,i=Math.round(1e3/r*10)/10;clearInterval(s),console.log(e.eventPositionMode,e.eventScrollMode,i+"fps")}}),0)}),500)}preserveViewCenter(e,t=this,...n){const r=this,i=r.viewportCenterDate,s=e.apply(t,n),o=r.timelineScroller,{clientSize:a}=o,l=Math.max(Math.floor(r.getCoordinateFromDate(i,!0)-a/2),0);return r.scrollingToCenter=!0,o.scrollTo(l,!1).then((()=>r.scrollingToCenter=!1)),s}setTimeSpan(e,t,{preventThrow:n=!1,maintainVisibleStart:r=!1,visibleDate:i}=AC){const s=this,{timeAxis:o}=s,{startDate:a,endDate:l}=o.getAdjustedDates(e,t),c=o.startDate-a!=0,d=o.endDate-l!=0;if(c||d){if(r){const{timeAxisViewModel:e}=s,{totalSize:t}=e,n=e.tickSize,r=s.timelineScroller,i=r.position,o=e.getDateFromPosition(i);o>=a&&o<l&&e.on({update(){const a=e.tickSize!==n;s.updateCanvasSize(),!c||d||a?r.position=c||a?e.getPositionFromDate(o):i:r.position+=e.totalSize-t,r.syncPartners(!0)},prio:1e4,once:!0})}const e=o.reconfigure({startDate:a,endDate:l},!1,n);return i&&s.scrollToDate(i.date||i,i),e}}get hasVisibleEvents(){return!this.noFeatureElementsInAxis()||this.eventStore.storage.values.some((e=>this.timeAxis.isTimeSpanInAxis(e)))}noFeatureElementsInAxis(){}get capitalizedEventName(){return this._capitalizedEventName||(this._capitalizedEventName=_.capitalize(this.scheduledEventName)),this._capitalizedEventName}set partner(e){this._partner=e,this.addPartner(e)}addPartner(e){const t=this;if(!t.isPartneredWith(e)){(t.partneredWith||(t.partneredWith=new rs)).add(e),(e.partneredWith||(e.partneredWith=new rs)).add(t),t.getConfig("viewPreset"),e.on({presetchange:"onPartnerPresetChange",thisObj:t}),e.scrollable.on({overflowChange:"onPartnerOverflowChange",thisObj:t});const n=t.partnerSharedConfigs.reduce(((t,n)=>(t[n]=e[n],t)),{});t.setConfig(n),t.on({presetchange:"onPartnerPresetChange",thisObj:e}),t.scrollable.on({overflowChange:"onPartnerOverflowChange",thisObj:e}),t.isPainted?(t.scrollable.addPartner(e.scrollable,t.isHorizontal?"x":"y"),e.syncPartnerSubGrids()):t.initScroll=$e.createSequence(t.initScroll,(()=>{t.scrollable.addPartner(e.scrollable,t.isHorizontal?"x":"y"),e.syncPartnerSubGrids()}),t)}}removePartner(e){const t=this,{partneredWith:n}=t;t.isPartneredWith(e)&&(n.remove(e),t.scrollable.removePartner(e.scrollable),t.un({presetchange:"onPartnerPresetChange",thisObj:e}),t.scrollable.un({overflowChange:"onPartnerOverflowChange",thisObj:e}),e.removePartner(t))}isPartneredWith(e){var t;return Boolean(null===(t=this.partneredWith)||void 0===t?void 0:t.includes(e))}onPartnerOverflowChange({source:e,y:t}){const{scrollable:n}=this,r=n.hasOverflow("y");r!==t?r?e.overflowY="scroll":(e.overflowY=!0,n.overflowY="scroll",this.refreshVirtualScrollbars()):n.overflowY=!0}onPartnerPresetChange({preset:e,startDate:t,endDate:n,centerDate:r}){this._viewPresetChanging||this.viewPreset===e||(e.options={startDate:t,endDate:n,centerDate:r},this.viewPreset=e)}get partner(){return this._partner}get partners(){const e=this.partner?[this.partner]:[];return this.partneredWith&&e.push.apply(e,this.partneredWith.allValues),e}get timeAxisColumn(){return this.columns&&this._timeAxisColumn}get columns(){return super.columns}set columns(e){const t=this;let n,r,i;if(e){const i=Array.isArray(e);let s=e;i||(s=e.data),n=s&&s.length,s.some(((e,i)=>"timeAxis"===e.type&&(n=i,r=sn.assign(e,t.timeAxisColumn),!0))),t.isVertical?(t._horizontalColumns=e,s=[sn.assign({type:"verticalTimeAxis",locked:!0},t.verticalTimeAxisColumn),s[n]],n=1):s=s.slice(),s[n]=f({type:"timeAxis",locked:!1,cellCls:t.timeCellCls,mode:t.mode},r),i?e=s:e.data=s}super.columns=e,e&&(i=t._timeAxisColumn=t.columns.find((e=>e.isTimeAxisColumn)),t.isVertical&&(t.verticalTimeAxisColumn=t.columns.find((e=>e.isVerticalTimeAxisColumn)),t.verticalTimeAxisColumn.relayAll(t)),i.relayAll(t))}onColumnsChanged({action:e,changes:t,record:n}){const{timeAxisColumn:r,columns:i}=this;"dataset"!==e||i.includes(r)?n===r&&"width"in t&&this.updateCanvasSize():i.add(r,!0),super.onColumnsChanged(...arguments)}get timeView(){const e=this;return e.columns&&e.isVertical?e.verticalTimeAxisColumn&&e.verticalTimeAxisColumn.view:e.timeAxisColumn&&e.timeAxisColumn.timeAxisView}updateEventCls(e){const t=this;t.eventSelector||(t.unreleasedEventSelector=t.eventSelector=`.${e}-wrap`),t.eventInnerSelector||(t.eventInnerSelector=`.${e}`)}set timeAxisViewModel(e){var t;const n=this,r=n._timeAxisViewModel,i={name:"timeAxisViewModel",update:"onTimeAxisViewModelUpdate",prio:100,thisObj:n};n.partner&&!e||r&&r===e||((null==r?void 0:r.owner)===n&&r.destroy(),n.detachListeners("timeAxisViewModel"),null!==(t=e)&&void 0!==t&&t.isTimeAxisViewModel?e.on(i):e=hC.new({mode:n._mode,snap:n.snap,forceFit:n.forceFit,timeAxis:n.timeAxis,suppressFit:n.suppressFit,listeners:i,owner:n},e),n.isConfiguring||(n.isHorizontal?n.timeAxisColumn.timeAxisViewModel=e:n.verticalTimeAxisColumn.view.model=e),n._timeAxisViewModel=e,n.relayEvents(e,["update"],"timeAxisViewModel"),r&&e&&n.trigger("timeAxisViewModelChange",{timeAxisViewModel:e}))}get timeAxisViewModel(){return this._timeAxisViewModel||(this.timeAxisViewModel=null),this._timeAxisViewModel}get suppressFit(){var e,t;return null!==(e=null===(t=this._timeAxisViewModel)||void 0===t?void 0:t.suppressFit)&&void 0!==e?e:this._suppressFit}set suppressFit(e){this._timeAxisViewModel?this.timeAxisViewModel.suppressFit=e:this._suppressFit=e}set timeAxis(e){var t;const n=this,r=n._timeAxis,i={name:"timeAxis",reconfigure({config:e,oldConfig:t}){e&&(!t||t.startDate-e.startDate||t.endDate-e.endDate)&&n.trigger("dateRangeChange",{old:{startDate:t.startDate,endDate:t.endDate},new:{startDate:e.startDate,endDate:e.endDate}}),n.trigger("timeAxisChange",{config:e})},thisObj:n};n.partner&&!e||r&&r===e||(r&&r.owner===n&&r.destroy(),n.detachListeners("timeAxis"),null!==(t=e)&&void 0!==t&&t.isTimeAxis||(e=sn.assign({owner:n,viewPreset:n.viewPreset,autoAdjust:n.autoAdjustTimeAxis,weekStartDay:n.weekStartDay,forceFullTicks:n.fillTicks&&n.snap},e),n.startDate&&(e.startDate=n.startDate),n.endDate&&(e.endDate=n.endDate),n.workingTime&&n.applyWorkingTime(e),e=new Cy(e)),e.on(i),n._timeAxis=e)}get timeAxis(){return this._timeAxis||(this.timeAxis=null),this._timeAxis}updateForceFit(e){this._timeAxisViewModel&&(this._timeAxisViewModel.forceFit=e)}set workingTime(e){this._workingTime=e,this.isConfiguring||this.applyWorkingTime(this.timeAxis)}get workingTime(){return this._workingTime}applyWorkingTime(e){const t=this,n=t._workingTime;if(n){let t=null;n.fromHour>=0&&n.fromHour<24&&n.toHour>n.fromHour&&n.toHour<=24&&n.toHour-n.fromHour<24&&(t={from:n.fromHour,to:n.toHour});let r=null;n.fromDay>=0&&n.fromDay<7&&n.toDay>n.fromDay&&n.toDay<=7&&n.toDay-n.fromDay<7&&(r={from:n.fromDay,to:n.toDay}),e.include=t||r?{hour:t,day:r}:null}else e.include=null;var r;t.isPainted&&(t.timeAxisColumn.refreshHeader(),null===(r=t.features.columnLines)||void 0===r||r.refresh(),t.refreshWithTransition())}updateStartDate(e){this.setStartDate(e)}setStartDate(e,t=!0){const n=this,r=n._timeAxis,{startDate:i,endDate:s,mainUnit:o}=r||AC;if("string"==typeof e&&(e=en.parse(e)),r&&s){if(e){let r=s;if(t&&i){const t=en.diff(i,s,o,!0);r=en.add(e,t,o)}n.setTimeSpan(e,r)}}else n._tempStartDate=e}get startDate(){const e=this;return e._timeAxis?e._timeAxis.startDate:e._tempStartDate||new Date}changeEndDate(e){"string"==typeof e&&(e=en.parse(e)),this.setEndDate(e)}setEndDate(e,t=!1){const n=this,r=n._timeAxis,{startDate:i,endDate:s,mainUnit:o}=r||AC;if("string"==typeof e&&(e=en.parse(e)),r&&i){if(e){let r=i;if(t&&s){const t=en.diff(i,s,o,!0);r=en.add(e,-t,o)}n.setTimeSpan(r,e)}}else n._tempEndDate=e}get endDate(){const e=this;return e._timeAxis?e._timeAxis.endDate:e._tempEndDate||en.add(e.startDate,e.viewPreset.defaultSpan,e.viewPreset.mainHeader.unit)}changeVisibleDate(e){return e instanceof Date?{date:e}:e}updateVisibleDate(e){const t=this;t.isPainted?t.scrollToDate(e.date,e):t.on({paint:()=>t.scrollToDate(e.date,e),once:!0})}get features(){return super.features}set features(e){"regionResize"in(e=!0===e?{}:e)||(e.regionResize=!0),super.features=e}get eventStyle(){return this._eventStyle}set eventStyle(e){this._eventStyle=e,this.refreshWithTransition(),this.trigger("stateChange")}get eventColor(){return this._eventColor}set eventColor(e){this._eventColor=e,this.refreshWithTransition(),this.trigger("stateChange")}onLocaleChange(){super.onLocaleChange();const e=this.timeAxis.autoAdjust;this.timeAxis.reconfigure({autoAdjust:!1}),this.timeAxis.autoAdjust=e}onBodyResize(e,t,{width:n,height:r}){this.isVertical&&t&&n!==t.width&&delete this.timeAxisSubGrid._width;const i=this.timeAxisSubGrid.element.offsetWidth;this._bodyRectangle&&t&&r!==t.height&&this.onSchedulerViewportResize(i,r,i,t.height)}onSchedulerViewportResize(e,t,n,r){if(this.isPainted){const i=this,{isHorizontal:s,timeAxisViewModel:o,partneredWith:a}=i;i.currentOrientation.onViewportResize(e,t,n,r),o.availableSpace=s?e:Math.floor(t),a&&!i.isSyncingFromPartner&&i.syncPartnerSubGrids(),i.trigger("timelineViewportResize",{width:e,height:t,oldWidth:n,oldHeight:r})}}onTimeAxisViewModelUpdate(){this._viewPresetChanging||(this.updateCanvasSize(),this.currentOrientation.onTimeAxisViewModelUpdate())}syncPartnerSubGrids(){this.partneredWith.forEach((e=>{e.isSyncingFromPartner||(e.isSyncingFromPartner=!0,this.eachSubGrid((t=>{const n=e.subGrids[t.region];n.width!==t.width&&(t.collapsed?n.collapse():(n.collapsed&&n.expand(),t.flex?t.flex!==n.flex&&(n.flex=t.flex):n.width=t.width))})),e.isSyncingFromPartner=!1)}))}get currentOrientation(){throw new Error("Implement in subclass")}get isHorizontal(){return!0}get backgroundCanvas(){return this._backgroundCanvas}get foregroundCanvas(){return this._foregroundCanvas}get svgCanvas(){const e=this;if(!e._svgCanvas){const t=e._svgCanvas=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("id",Yi.generateId("svg")),t.retainElement=!0,e.foregroundCanvas.appendChild(t),e.trigger("svgCanvasCreated",{svg:t})}return e._svgCanvas}get timeAxisSubGridElement(){var e;return this._timeAxisSubGridElement||(this.getConfig("regions"),this._timeAxisSubGridElement=null===(e=this.timeAxisColumn)||void 0===e?void 0:e.subGridElement),this._timeAxisSubGridElement}updateCanvasSize(){const e=this,{totalSize:t}=e.timeAxisViewModel,n=e.isHorizontal?t:e.timeAxisColumn.width;let r=!1;return e.isVertical&&(e.isPainted&&e.refreshTotalHeight(t+e._rowBorderHeight,!0),e.suppressFit&&Mr.setLength(e.foregroundCanvas,"height",t),r=!0),n!==e.$canvasWidth&&e.foregroundCanvas&&(e.backgroundCanvas&&Mr.setLength(e.backgroundCanvas,"width",n),Mr.setLength(e.foregroundCanvas,"width",n),e.$canvasWidth=n,r=!0),r}getHeaderDomConfigs(e){}getForegroundDomConfigs(e){}async onStoreDataChange({action:e}){const t=this;t.isVisible?("dataset"===e&&t.project.isRepopulatingStores&&await t.project.await("refresh",!1),super.onStoreDataChange(...arguments)):t.whenVisible("refresh",t,[!0])}refresh(e=!0){const t=this;t.isPainted&&!t.refreshSuspended&&(t.hasVisibleEvents||t.timeAxisSubGridElement.querySelector(t.eventSelector)?t.isEngineReady?t.refreshRows(!1,e):(t.refreshAfterProjectRefresh=!0,t.currentOrientation.refreshAllWhenReady=!0):t.rowManager.trigger("refresh"))}render(){const e=this,t=e.timeAxisSubGridElement;e.useBackgroundCanvas&&(e._backgroundCanvas=Mr.createElement({className:"b-sch-background-canvas",parent:t,nextSibling:t.firstElementChild}));const n=e._foregroundCanvas=Mr.createElement({className:"b-sch-foreground-canvas",style:`font-size:${e.rowHeight-2*e.resourceMargin}px`,parent:t});e.timeAxisSubGrid.insertRowsBefore=n,e.isVertical&&e.suppressFit&&e.updateCanvasSize(),super.render(...arguments)}refreshRows(e=!1,t=!0){this.isConfiguring||(this.currentOrientation.refreshRows(t),super.refreshRows(e))}runWithTransition(e,t){const n=this;n.isVisible&&(null!=t&&!0!==t||(t=n.transitionDuration),t&&n.enableEventAnimations&&(n.hasTimeout("exitTransition")||(n.isAnimating=!0),IC.delay=t,n.setTimeout(IC))),e()}exitTransition(){this.isAnimating=!1,this.trigger("transitionend")}async waitForAnimations(){this.isEngineReady||await this.project.await("dataReady",!1),await super.waitForAnimations()}refreshWithTransition(e,t){this.isPainted&&!this.refreshSuspended&&this.runWithTransition((()=>this.refresh(e)),t)}get visibleDateRange(){return this.currentOrientation.visibleDateRange}formatDuration(e,t=this.durationDisplayPrecision){const n=Math.pow(10,t);return Math.round(e*n)/n}beginListeningForBatchedUpdates(){this.listenToBatchedUpdates=(this.listenToBatchedUpdates||0)+1}endListeningForBatchedUpdates(){this.listenToBatchedUpdates&&(this.listenToBatchedUpdates-=1)}}v(FC,"configurable",{partnerSharedConfigs:{value:["timeAxisViewModel","timeAxis","viewPreset"],$config:{merge:"distinct"}},startDate:{$config:{equal:"date"},value:null},endDate:{$config:{equal:"date"},value:null},stickyHeaders:!0,visibleDate:null,eventCls:null,forceFit:!1}),v(FC,"properties",{timeCellSelector:null}),FC.initClass(),K.setVersion("scheduler","5.2.4"),FC._$name="TimelineBase";const OC=ot.mergeLocales(Jm,{Object:{newEvent:"New event"},ResourceInfoColumn:{eventCountText:function(e){return e+" event"+(1!==e?"s":"")}},Dependencies:{from:"From",to:"To",valid:"Valid",invalid:"Invalid"},DependencyType:{SS:"SS",SF:"SF",FS:"FS",FF:"FF",StartToStart:"Start-to-Start",StartToEnd:"Start-to-Finish",EndToStart:"Finish-to-Start",EndToEnd:"Finish-to-Finish",short:["SS","SF","FS","FF"],long:["Start-to-Start","Start-to-Finish","Finish-to-Start","Finish-to-Finish"]},DependencyEdit:{From:"From",To:"To",Type:"Type",Lag:"Lag","Edit dependency":"Edit dependency",Save:"Save",Delete:"Delete",Cancel:"Cancel",StartToStart:"Start to Start",StartToEnd:"Start to End",EndToStart:"End to Start",EndToEnd:"End to End"},EventEdit:{Name:"Name",Resource:"Resource",Start:"Start",End:"End",Save:"Save",Delete:"Delete",Cancel:"Cancel","Edit event":"Edit event",Repeat:"Repeat"},EventDrag:{eventOverlapsExisting:"Event overlaps existing event for this resource",noDropOutsideTimeline:"Event may not be dropped completely outside the timeline"},SchedulerBase:{"Add event":"Add event","Delete event":"Delete event","Unassign event":"Unassign event"},TimeAxisHeaderMenu:{pickZoomLevel:"Zoom",activeDateRange:"Date range",startText:"Start date",endText:"End date",todayText:"Today"},EventCopyPaste:{copyEvent:"Copy event",cutEvent:"Cut event",pasteEvent:"Paste event"},EventFilter:{filterEvents:"Filter tasks",byName:"By name"},TimeRanges:{showCurrentTimeLine:"Show current timeline"},PresetManager:{secondAndMinute:{displayDateFormat:"ll LTS",name:"Seconds"},minuteAndHour:{topDateFormat:"ddd MM/DD, hA",displayDateFormat:"ll LST"},hourAndDay:{topDateFormat:"ddd MM/DD",middleDateFormat:"LST",displayDateFormat:"ll LST",name:"Day"},day:{name:"Day/hours"},week:{name:"Week/hours"},dayAndWeek:{displayDateFormat:"ll LST",name:"Week/days"},dayAndMonth:{name:"Month"},weekAndDay:{displayDateFormat:"ll LST",name:"Week"},weekAndMonth:{name:"Weeks"},weekAndDayLetter:{name:"Weeks/weekdays"},weekDateAndMonth:{name:"Months/weeks"},monthAndYear:{name:"Months"},year:{name:"Years"},manyYears:{name:"Multiple years"}},RecurrenceConfirmationPopup:{"delete-title":"You are deleting an event","delete-all-message":"Do you want to delete all occurrences of this event?","delete-further-message":"Do you want to delete this and all future occurrences of this event, or only the selected occurrence?","delete-further-btn-text":"Delete All Future Events","delete-only-this-btn-text":"Delete Only This Event","update-title":"You are changing a repeating event","update-all-message":"Do you want to change all occurrences of this event?","update-further-message":"Do you want to change only this occurrence of the event, or this and all future occurrences?","update-further-btn-text":"All Future Events","update-only-this-btn-text":"Only This Event",Yes:"Yes",Cancel:"Cancel",width:600},RecurrenceLegend:{" and ":" and ",Daily:"Daily","Weekly on {1}":({days:e})=>`Weekly on ${e}`,"Monthly on {1}":({days:e})=>`Monthly on ${e}`,"Yearly on {1} of {2}":({days:e,months:t})=>`Yearly on ${e} of ${t}`,"Every {0} days":({interval:e})=>`Every ${e} days`,"Every {0} weeks on {1}":({interval:e,days:t})=>`Every ${e} weeks on ${t}`,"Every {0} months on {1}":({interval:e,days:t})=>`Every ${e} months on ${t}`,"Every {0} years on {1} of {2}":({interval:e,days:t,months:n})=>`Every ${e} years on ${t} of ${n}`,position1:"the first",position2:"the second",position3:"the third",position4:"the fourth",position5:"the fifth","position-1":"the last",day:"day",weekday:"weekday","weekend day":"weekend day",daysFormat:({position:e,days:t})=>`${e} ${t}`},RecurrenceEditor:{"Repeat event":"Repeat event",Cancel:"Cancel",Save:"Save",Frequency:"Frequency",Every:"Every",DAILYintervalUnit:"day(s)",WEEKLYintervalUnit:"week(s)",MONTHLYintervalUnit:"month(s)",YEARLYintervalUnit:"year(s)",Each:"Each","On the":"On the","End repeat":"End repeat","time(s)":"time(s)"},RecurrenceDaysCombo:{day:"day",weekday:"weekday","weekend day":"weekend day"},RecurrencePositionsCombo:{position1:"first",position2:"second",position3:"third",position4:"fourth",position5:"fifth","position-1":"last"},RecurrenceStopConditionCombo:{Never:"Never",After:"After","On date":"On date"},RecurrenceFrequencyCombo:{Daily:"Daily",Weekly:"Weekly",Monthly:"Monthly",Yearly:"Yearly"},RecurrenceCombo:{None:"None",Custom:"Custom..."},Summary:{"Summary for":e=>`Summary for ${e}`},ScheduleRangeCombo:{completeview:"Complete schedule",currentview:"Visible schedule",daterange:"Date range",completedata:"Complete schedule (for all events)"},SchedulerExportDialog:{"Schedule range":"Schedule range","Export from":"From","Export to":"To"},ExcelExporter:{"No resource assigned":"No resource assigned"},CrudManagerView:{serverResponseLabel:"Server response:"},DurationColumn:{Duration:"Duration"}});lt.registerLocale("En",{desc:"English",locale:OC});const LC=["eventStore","taskStore","assignmentStore","resourceStore","dependencyStore","timeRangeStore","resourceTimeRangeStore"],PC=["events","tasks","resources","assignments","dependencies","timeRanges","resourceTimeRanges"];var $C=e=>class extends e{static get $name(){return"CurrentConfig"}preProcessCurrentConfigs(e){for(const t of PC)delete e[t];super.preProcessCurrentConfigs(e)}getCurrentConfig(e){const t=this.project.getCurrentConfig(e),n=super.getCurrentConfig(e);if(t){n.project=t;const{crudManager:e}=n;if(e)for(const n of LC)e[n]&&(t[n]=e[n]);0===Object.keys(t).length&&delete n.project}return delete n.data,delete n.crudManager,n}get widgetClass(){}};const _C=e=>!e||Array.isArray(e)?e:[e],NC=(e,t,n)=>e&&!0!==e[t]?e[t]:n;var HC=e=>{var t;return v(t=class extends(e||Te){get dateBounds(){return[this.date]}get description(){var e;const t=this,{dateBounds:n,dateFormat:r,descriptionRenderer:i}=t,s=null!==(e=t.descriptionFormat)&&void 0!==e?e:_C(t.defaultDescriptionFormat);let o,a;if(i)a=t.callback(i,t,[t]);else{const e=NC(s,0,r);a=en.format(n[0],e),o=n.length>1&&(null==s?void 0:s.length)>1&&en.format(n[0],e)!==en.format(n[1],e),o&&(a=en.formatRange(n,NC(s,1,`S${r}${t.dateSeparator}E${r}`)))}return a}changeDescriptionFormat(e){return _C(e)}get widgetClass(){}},"$name","Describable"),v(t,"configurable",{dateFormat:"MMMM d, YYYY",dateSeparator:" - ",descriptionFormat:null,descriptionRenderer:null}),t},BC=e=>class extends(e||Te){static get $name(){return"SchedulerDom"}getElementFromAssignmentRecord(e,t=!1){if(this.isPainted&&e){var n,r,i;let o=null===(n=this.foregroundCanvas.syncIdMap)||void 0===n?void 0:n[e.id];if(!o&&e.resource.hasLinks)for(const t of e.resource.$links){var s;if(o=null===(s=this.foregroundCanvas.syncIdMap)||void 0===s?void 0:s[`${e.id}_${t.id}`],o)break}return t?o:null===(r=o)||void 0===r||null===(i=r.syncIdMap)||void 0===i?void 0:i.event}return null}getElementFromEventRecord(e,t=(()=>{var t;return null===(t=e.resources)||void 0===t?void 0:t[0]})(),n=!1){if(e.isResourceTimeRange){var r;const t=null===(r=this.foregroundCanvas.syncIdMap)||void 0===r?void 0:r[e.domId];return n?t:null==t?void 0:t.syncIdMap.event}const i=this.assignmentStore.getAssignmentForEventAndResource(e,t);return this.getElementFromAssignmentRecord(i,n)}getElementsFromEventRecord(e,t,n=!1){return t?[this.getElementFromEventRecord(e,t,n)]:e.resources.reduce(((t,r)=>{const i=this.getElementFromEventRecord(e,r,n);return i&&t.push(i),t}),[])}resolveResourceRecord(e,t){return this.currentOrientation.resolveRowRecord(e,t)}resolveRowRecord(e){return this.resolveResourceRecord(e)}resolveEventRecord(e){var t;e instanceof Event&&(e=e.target);const n=null===(t=e)||void 0===t?void 0:t.closest(this.eventSelector);if(n){if(n.dataset.eventId)return this.eventStore.getById(n.dataset.eventId);if(n.dataset.assignmentId)return this.assignmentStore.getById(n.dataset.assignmentId).event}return null}resolveTimeSpanRecord(e){return this.resolveEventRecord(e)}resolveAssignmentRecord(e){const t=e.closest(this.eventSelector),n=t&&this.assignmentStore.getById(t.dataset.assignmentId),r=t&&this.eventStore.getById(t.dataset.eventId);return this.assignmentStore.getOccurrence(n,r)}isRowVisible(e){return this.store.indexOf(e)>=0}get widgetClass(){}},jC=e=>class extends(e||Te){static get $name(){return"SchedulerDomEvents"}getTimeSpanMouseEventParams(e,t){const n=this.resolveEventRecord(e);return n&&{eventRecord:n,resourceRecord:this.resolveResourceRecord(e),assignmentRecord:this.resolveAssignmentRecord(e),eventElement:e,event:t}}getScheduleMouseEventParams(e,t){return{resourceRecord:this.isVertical?this.resolveResourceRecord(t):this.store.getById(e.id)}}onElementKeyDown(e){const t=super.onElementKeyDown(e),n=this;return n.selectedEvents.length&&n.trigger(n.scheduledEventName+"KeyDown",{eventRecords:n.selectedEvents,assignmentRecords:n.selectedAssignments,event:e,eventRecord:n.selectedEvents,assignmentRecord:n.selectedAssignments}),t}onElementKeyUp(e){super.onElementKeyUp(e);const t=this;t.selectedEvents.length&&t.trigger(t.scheduledEventName+"KeyUp",{eventRecords:t.selectedEvents,assignmentRecords:t.selectedAssignments,event:e,eventRecord:t.selectedEvents,assignmentRecord:t.selectedAssignments})}get widgetClass(){}},VC=e=>class extends(e||Te){static get $name(){return"SchedulerEventRendering"}static get configurable(){return{milestoneTextPosition:"outside",milestoneAlign:"center",milestoneCharWidth:10,milestoneLayoutMode:"default",milestoneMinWidth:40,eventLayout:"stack",overlappingEventSorter:null,horizontalEventSorterFn:null,resourceMargin:null,useInitialAnimation:!0,eventRenderer:null,eventRendererThisObj:null,eventBarTextField:"name",eventBodyTemplate:null,horizontalLayoutPackClass:Ry,horizontalLayoutStackClass:Ty,resourceColumns:null,resourceImagePath:null,defaultResourceImageName:null,resourceImageExtension:".jpg",isFirstRender:!0,initialAnimationDuration:2e3,narrowEventWidth:10,internalEventLayout:null,eventPositionMode:"translate",eventScrollMode:"move"}}changeEventLayout(e){return this.internalEventLayout=e,this.internalEventLayout.type}changeInternalEventLayout(e){return this.getEventLayout(e)}updateInternalEventLayout(e,t){const n=this;t&&n.element.classList.remove(`b-eventlayout-${t.type}`),n.element.classList.add(`b-eventlayout-${e.type}`),n.isConfiguring||(n.refreshWithTransition(),n.trigger("stateChange"))}changeHorizontalEventSorterFn(e){K.deprecate("Scheduler","6.0.0","Replaced by overlappingEventSorter()"),this.overlappingEventSorter=e}updateOverlappingEventSorter(e){this.isConfiguring||this.refreshWithTransition()}getEventLayout(e){var t;return null!==(t=e)&&void 0!==t&&t.isModel&&(e=e.eventLayout||this.internalEventLayout),"string"==typeof e&&(e={type:e}),e}getEventLayoutHandler(e){const t=this;if(!t.isHorizontal)return null;const{timeAxisViewModel:n,horizontal:r}=t,{type:i}=e;switch(t.layouts||(t.layouts={}),i){case"stack":return t.layouts.horizontalStack||(t.layouts.horizontalStack=new t.horizontalLayoutStackClass(sn.assign({scheduler:t,timeAxisViewModel:n,bandIndexToPxConvertFn:r.layoutEventVerticallyStack,bandIndexToPxConvertThisObj:r},e))),t.layouts.horizontalStack;case"pack":return t.layouts.horizontalPack||(t.layouts.horizontalPack=new t.horizontalLayoutPackClass(sn.assign({scheduler:t,timeAxisViewModel:n,bandIndexToPxConvertFn:r.layoutEventVerticallyPack,bandIndexToPxConvertThisObj:r},e))),t.layouts.horizontalPack;default:return null}}get resourceColumns(){var e;return(null===(e=this.timeAxisColumn)||void 0===e?void 0:e.resourceColumns)||this._resourceColumns}get resourceColumnWidth(){var e;return(null===(e=this.resourceColumns)||void 0===e?void 0:e.columnWidth)||null}getEventsToRender(e,t){return t}repaintEventsForResource(e){this.currentOrientation.repaintEventsForResource(e)}repaintEvent(e){this.eventStore.getResourcesForEvent(e).forEach((e=>this.repaintEventsForResource(e)))}getResourceMargin(e){var t;return null!==(t=null==e?void 0:e.resourceMargin)&&void 0!==t?t:this.resourceMargin}getBarMargin(e){var t;return null!==(t=null==e?void 0:e.barMargin)&&void 0!==t?t:this.barMargin}getResourceHeight(e){var t;return null!==(t=e.rowHeight)&&void 0!==t?t:this.isHorizontal?this.rowHeight:this.getResourceWidth(e)}getResourceWidth(e){var t;return null!==(t=e.columnWidth)&&void 0!==t?t:this.resourceColumnWidth}getAppliedResourceHeight(e){var t;const n=this.getRowById(e);return null!==(t=null==n?void 0:n.maxRequestedHeight)&&void 0!==t?t:this.getResourceHeight(e)}getResourceLayoutSettings(e,t=null){const n=this.getResourceMargin(e,t),r=this.getAppliedResourceHeight(e,t);return{barMargin:this.getBarMargin(e,t),contentHeight:Math.max(r-2*n,1),rowHeight:r,resourceMargin:n}}getEventStyle(e,t){return e.eventStyle||t.eventStyle||this.eventStyle}getEventColor(e,t){var n,r;return e.eventColor||(null===(n=e.event)||void 0===n?void 0:n.eventColor)||(null===(r=e.parent)||void 0===r?void 0:r.eventColor)||t.eventColor||this.eventColor}generateRenderData(e,t,n={viewport:!0}){const r=this,i=r.currentOrientation.getTimeSpanRenderData(e,t,n),{isEvent:s}=e,{eventResize:o}=r.features,a=!e.meta.isDragCreating&&e.isMilestone,l=s&&e.assignments.find((e=>e.resourceId===t.$originalId)),c={className:"b-sch-event-content",dataset:{taskBarFeature:"content"}};if(i){var d;i.tabIndex="0";let n=e.isResizable;o&&n&&(i.startsOutsideView&&(!0===n?n="end":"start"===n&&(n=!1)),i.endsOutsideView&&(!0===n?n="start":"end"===n&&(n=!1)),n&&(r.isHorizontal?!r.rtl&&!o.leftHandle||r.rtl&&!o.rightHandle?n="start"!==n&&"end":(!r.rtl&&!o.rightHandle||r.rtl&&!o.leftHandle)&&(n="end"!==n&&"start"):o.topHandle?o.bottomHandle||(n="end"!==n&&"start"):n="start"!==n&&"end"));const h=Boolean(e.hasPersistableChanges||(null==l?void 0:l.hasPersistableChanges)),g={[t.cls]:t.cls,[r.generatedIdCls]:!e.isOccurrence&&e.hasGeneratedId,[r.dirtyCls]:h,[r.committingCls]:e.isCommitting,[r.endsOutsideViewCls]:i.endsOutsideView,[r.startsOutsideViewCls]:i.startsOutsideView,"b-clipped-start":i.clippedStart,"b-clipped-end":i.clippedEnd,"b-iscreating":e.isCreating,"b-rtl":r.rtl},m={[`${r.eventCls}-parent`]:t.isParent,"b-readonly":e.readOnly||(null==l?void 0:l.readOnly),"b-linked-resource":t.isLinked,"b-original-resource":t.hasLinks},p=e.isResourceTimeRange?new Mn:e.internalCls.clone(),f=e.isResourceTimeRange?e.internalCls.clone():new Mn;if(i.wrapperStyle="",i.isWrap=!0,s){const s=l&&r.isAssignmentSelected(l);sn.assign(g,{[r.eventCls]:1,"b-milestone":a,"b-sch-event-narrow":i.width<r.narrowEventWidth,[r.fixedEventCls]:!1===e.isDraggable,[`b-sch-event-resizable-${n}`]:Boolean((null==o?void 0:o.enabled)&&!e.readOnly),[r.eventSelectedCls]:s,[r.eventAssignHighlightCls]:r.eventAssignHighlightCls&&!s&&r.isEventSelected(e),"b-recurring":e.isRecurring,"b-occurrence":e.isOccurrence,"b-inactive":e.inactive}),i.eventId=e.id;const c=r.getEventStyle(e,t),d=r.getEventColor(e,t),u=r.isFirstRender&&r.useInitialAnimation&&!0!==globalThis.bryntum.noAnimations;if(sn.assign(m,{[`${r.eventCls}-wrap`]:1,"b-milestone-wrap":a}),u){const e=(i.row?i.row.index:(i.top-r.scrollTop)/r.tickSize)/20*1e3;i.wrapperStyle=`animation-delay: ${e}ms;`,r.maxDelay=Math.max(r.maxDelay||0,e),r.initialAnimationDetacher||(r.initialAnimationDetacher=_n.on({element:r.foregroundCanvas,delegate:r.eventSelector,once:!0,animationend:()=>r.setTimeout({fn:"stopInitialAnimation",delay:r.maxDelay,cancelOutstanding:!0}),expires:{alt:"stopInitialAnimation",delay:r.initialAnimationDuration+r.maxDelay},thisObj:r}))}i.eventColor=d,i.eventStyle=c,i.assignmentRecord=i.assignment=l}if(i.wrapperCls=sn.assign(f,m),i.cls=sn.assign(p,g),i.iconCls=new Mn(e.get(r.eventBarIconClsField)||e.iconCls),e.isResourceTimeRange?(i.style="",i.wrapperStyle+=e.style||""):i.style=e.style||"",i.resource=i.resourceRecord=t,i.resourceId=i.rowId,s){let n,s=null,o=null;if(r.eventRenderer){const s=r.eventRenderer.call(r.eventRendererThisObj||r,{eventRecord:e,resourceRecord:t,assignmentRecord:i.assignmentRecord,renderData:i});"string"==typeof i.cls&&(i.cls=new Mn(i.cls)),"string"==typeof i.wrapperCls&&(i.wrapperCls=new Mn(i.wrapperCls)),"string"==typeof i.iconCls&&(i.iconCls=new Mn(i.iconCls)),n=r.eventBodyTemplate?r.eventBodyTemplate(s):s}else r.eventBodyTemplate?n=r.eventBodyTemplate(e):r.eventBarTextField&&(n=_.encodeHtml(e[r.eventBarTextField]||""));var u;!r.eventBodyTemplate||Array.isArray(n)?(c.children=[],a&&"default"===r.milestoneLayoutMode&&null!=n&&""!==n&&c.children.unshift(o={tag:"label",children:[]}),null!==(u=i.iconCls)&&void 0!==u&&u.length&&c.children.unshift({tag:"i",className:i.iconCls}),Array.isArray(n)?(o||c).children.push(...n):_.isHtml(n)?c.children.length?s={tag:"span",class:"b-event-text-wrap",html:n}:(c.children=null,c.html=n):"string"==typeof n||"object"==typeof n?s=n:null!=n&&(s=String(n)),null!=s&&((o||c).children.push(s),i.cls.add("b-has-content")),(null!=c.html||c.children.length)&&i.children.push(c)):(c.html=n,i.children.push(c))}const{eventStyle:v,eventColor:y}=i;if(i.wrapperCls[`b-sch-style-${v}`]=v,Mr.isNamedColor(y))i.wrapperCls[`b-sch-color-${y}`]=y;else if(y){const e=v?"color":"background-color";i.style=`${e}:${y};`+i.style,i.wrapperCls["b-sch-custom-color"]=1}i.style&&a&&c&&(c.style=i.style,delete i.style),i.cls["b-sch-event-withicon"]=null===(d=i.iconCls)||void 0===d?void 0:d.length,i.eventContent=c,i.wrapperChildren=[],r.onEventDataGenerated(i)}return i}onEventDataGenerated(e){}changeUseInitialAnimation(e){return!0===e?"fade-in":e}updateUseInitialAnimation(e,t){const{classList:n}=this.element;t&&n.remove(`b-initial-${t}`),e&&(n.add(`b-initial-${e}`),y.isFirefox&&n.add("b-prevent-event-transitions"))}restartInitialAnimation(e){var t;const n=this;null===(t=n.initialAnimationDetacher)||void 0===t||t.call(n),n.initialAnimationDetacher=null,n.useInitialAnimation=e,n.isFirstRender=!0,n.refresh()}stopInitialAnimation(){const e=this;e.initialAnimationDetacher(),e.isFirstRender=!1,e.useInitialAnimation=!1,y.isFirefox&&e.setTimeout((()=>e.element.classList.remove("b-prevent-event-transitions")),100)}getMilestoneLabelWidth(e,t){const n=this,r=n.milestoneLayoutMode;if("measure"===r){const r=n.getEventColor(e,t),i=n.getEventStyle(e,t),s=n.milestoneMeasureElement||(n.milestoneMeasureElement=Mr.createElement({className:{"b-sch-event-wrap":1,"b-milestone-wrap":1,"b-measure":1,[`b-sch-color-${r}`]:r,[`b-sch-style-${i}`]:i},children:[{className:"b-sch-event b-milestone",children:[{className:"b-sch-event-content"}]}],parent:n.foregroundCanvas}));return s.retainElement=!0,s.firstElementChild.firstElementChild.innerHTML=_.encodeHtml(e.name),s.firstElementChild.offsetWidth}return"estimate"===r?Math.max(e.name.length*n.milestoneCharWidth,n.milestoneMinWidth):"data"===r?Math.max(e.milestoneWidth,n.milestoneMinWidth):0}updateMilestoneLayoutMode(e){this.element.classList["default"!==e?"add":"remove"]("b-sch-layout-milestones"),this.isConfiguring||this.refreshWithTransition()}updateMilestoneTextPosition(e){this.element.classList.toggle("b-sch-layout-milestone-text-position-inside","inside"===e)}updateMilestoneAlign(){this.isConfiguring||this.refreshWithTransition()}updateMilestoneCharWidth(){this.isConfiguring||this.refreshWithTransition()}get widgetClass(){}},zC=e=>class extends(Dy(e||Te)){static get $name(){return"SchedulerStores"}static get projectStores(){return{resourceStore:{dataName:"resources"},eventStore:{dataName:"events",listeners:{batchedUpdate:"onEventStoreBatchedUpdate",changePreCommit:"onInternalEventStoreChange",commitStart:"onEventCommitStart",commit:"onEventCommit",exception:"onEventException",idchange:"onEventIdChange",beforeLoad:"applyStartEndParameters"}},assignmentStore:{dataName:"assignments",listeners:{changePreCommit:"onAssignmentChange",commitStart:"onAssignmentCommitStart",commit:"onAssignmentCommit",exception:"onAssignmentException",beforeRemove:{fn:"onAssignmentBeforeRemove",prio:-1e3}}},dependencyStore:{dataName:"dependencies"},calendarManagerStore:{},timeRangeStore:{},resourceTimeRangeStore:{}}}static get configurable(){return{store:null,startParamName:"startDate",endParamName:"endDate",passStartEndParameters:!1,crudManagerClass:null,crudManager:null}}updateProject(e,t){super.updateProject(e,t),this.detachListeners("schedulerStores"),e.on({name:"schedulerStores",refresh:"onProjectRefresh",thisObj:this})}onProjectRefresh({isInitialCommit:e}){const t=this;t.isVisible?(e&&t.isVertical&&(t.refreshAfterProjectRefresh=!1,t.refreshWithTransition()),t.navigateToAfterRefresh&&(t.navigateTo(t.navigateToAfterRefresh),t.navigateToAfterRefresh=null),t.refreshAfterProjectRefresh&&(t.refreshWithTransition(!1,!e),t.refreshAfterProjectRefresh=!1)):t.whenVisible("refresh",t,[!0])}changeCrudManager(e){const t=this;e&&!e.isCrudManager&&(e=t.crudManagerClass.new({scheduler:t},e)),t._crudManager=e,t.bindCrudManager(e)}get store(){return!this._store&&this.isVertical&&(this._store=new As({data:[{id:"verticalTimeAxisRow",cls:"b-verticaltimeaxis-row"}]})),super.store}set store(e){super.store=e}refreshFromRowOnStoreAdd(e,{isExpand:t,records:n}){const r=arguments;this.runWithTransition((()=>{this.currentOrientation.suspended=!t&&!n.some((e=>e.isLinked)),super.refreshFromRowOnStoreAdd(e,...r),this.currentOrientation.suspended=!1}),!t)}onStoreAdd(e){super.onStoreAdd(e),this.isPainted&&this.calculateRowHeights(e.records)}onStoreUpdateRecord({source:e,record:t,changes:n}){let r=0;"assigned"in n&&r++,"calendar"in n&&r++,r!==Object.keys(n).length&&super.onStoreUpdateRecord(...arguments)}updateResourceStore(e){e&&this.isHorizontal&&(e.metaMapId=this.id,this.store=e)}get usesDisplayStore(){return this.store!==this.resourceStore}onEventIdChange(e){this.currentOrientation.onEventStoreIdChange&&this.currentOrientation.onEventStoreIdChange(e)}onEventStoreBatchedUpdate(e){if(this.listenToBatchedUpdates)return this.onInternalEventStoreChange(e)}onInternalEventStoreChange(e){this.isPainted&&this._mode&&!e.isAssign&&!this.assignmentStore.isRemovingAssignment&&this.currentOrientation.onEventStoreChange(e)}onEventCommit({changes:e}){let t=[...e.added,...e.modified].map((e=>this.eventStore.getResourcesForEvent(e)));t=Array.prototype.concat.apply([],t),new Set(t).forEach((e=>this.repaintEventsForResource(e)))}onEventCommitStart({changes:e}){const{currentOrientation:t,committingCls:n}=this;[...e.added,...e.modified].forEach((e=>e.assignments.forEach((e=>t.toggleCls(e,n,!0)))))}onEventException({action:e}){if("commit"===e){const{changes:e}=this.eventStore;[...e.added,...e.modified,...e.removed].forEach((e=>this.repaintEvent(e)))}}onAssignmentCommit({changes:e}){this.repaintEventsForAssignmentChanges(e)}onAssignmentCommitStart({changes:e}){const{currentOrientation:t,committingCls:n}=this;[...e.added,...e.modified].forEach((e=>{t.toggleCls(e,n,!0)}))}onAssignmentException({action:e}){"commit"===e&&this.repaintEventsForAssignmentChanges(this.assignmentStore.changes)}repaintEventsForAssignmentChanges(e){const t=[...e.added,...e.modified,...e.removed].map((e=>e.getResource()));new Set(t).forEach((e=>this.repaintEventsForResource(e)))}onAssignmentBeforeRemove({records:e,removingAll:t}){if(t)return;const n=this;let r;if(!n.isConfiguring&&(n.navigateToAfterRefresh||n.activeAssignment&&e.includes(n.activeAssignment))){if(e.includes(n.navigateToAfterRefresh)&&(n.navigateToAfterRefresh=null),"key"===zr.lastInteractionType)for(let t=0,i=e.length;t<i&&!r;t++){const i=e[t];if(i.resource&&i.resource.isModel){let t=n.getNext(i);t&&!e.includes(t)||(t=n.getPrevious(i)),t&&!e.includes(t)&&(r=t)}}r?(n.navigateTo(r),n.navigateToAfterRefresh=r):Mr.focusWithoutScrolling(n.focusElement)}}set timeRanges(e){this.project.timeRanges=e}get timeRanges(){return this.project.timeRanges}set resourceTimeRanges(e){this.project.resourceTimeRanges=e}get resourceTimeRanges(){return this.project.resourceTimeRanges}applyStartEndParameters({source:e,params:t}){const n=this,r=e.modelClass.fieldMap.startDate;n.passStartEndParameters&&(t[n.startParamName]=r.print(n.startDate),t[n.endParamName]=r.print(n.endDate))}getResourcesEventsPerTick(e,t){const{timeAxis:n,resourceStore:r}=this,i=[];return(e=e||r.records).forEach((e=>{e.events.forEach((r=>{if(!n.isTimeSpanInAxis(r)||t&&!t.call(this,{resource:e,event:r}))return;let s=Math.floor(n.getTickFromDate(r.startDate)),o=Math.ceil(n.getTickFromDate(r.endDate));-1==s&&(s=0),-1===o&&(o=n.ticks.length);do{i[s]?i[s].push(r):i[s]=[r]}while(++s<o)}))})),i}get widgetClass(){}};const WC={block:"nearest",edgeOffset:20},UC={highlight:!1,focus:!1};var YC=e=>class extends(e||Te){static get $name(){return"SchedulerScroll"}async scrollEventIntoView(e,t=WC){const n=e.resources||[e];if(n.length>1)throw new Error("scrollEventIntoView() is not applicable for events with multiple assignments, please use scrollResourceEventIntoView() instead.");n.length||console.warn("You have asked to scroll to an event which is not assigned to a resource"),await this.scrollResourceEventIntoView(n[0],e,t)}scrollAssignmentIntoView(e,...t){return this.scrollResourceEventIntoView(e.resource,e.event,...t)}async scrollResourceEventIntoView(e,t,n=WC){const r=this,i=t.startDate,s=t.endDate,o=t.isScheduled&&i<r.timeAxis.startDate|(s>r.timeAxis.endDate)<<1;let a;if(arguments.length>3&&(n=arguments[3]),null==n.edgeOffset&&(n.edgeOffset=20),o&&!1!==n.extendTimeAxis){const e=r.timeAxis.endDate-r.timeAxis.startDate;3===o?r.setTimeSpan(new Date(i.valueOf()-e/2),new Date(s.getTime()+e/2)):1&o?r.setTimeSpan(new Date(i),new Date(i.valueOf()+e)):r.setTimeSpan(new Date(s.valueOf()-e),new Date(s))}var l;if(r.store.tree&&await(null===(l=r.expandTo)||void 0===l?void 0:l.call(r,e)),a=r.getElementFromEventRecord(t,e),a){Mr.isFocusable(a)||(a=a.parentNode);const e=r.timeAxisSubGrid.scrollable;r.timeAxisSubGrid.forceScrollUpdate=!0,await e.scrollIntoView(a,n)}else o&&!1===n.extendTimeAxis?console.warn("You have asked to scroll to an event which is outside the current view and extending timeaxis is disabled"):t.isOccurrence||r.eventStore.isAvailable(t)?t.isScheduled?await r.scrollUnrenderedEventIntoView(e,t,n):await r.scrollResourceIntoView(e,n):console.warn("You have asked to scroll to an event which is not available")}scrollUnrenderedEventIntoView(e,t,n=WC){return new Promise((r=>{const i=this,s=Object.assign({edgeOffset:20},n,UC),o=i.timeAxisSubGrid.scrollable,a=i.getResourceEventBox(t,e),l=o.viewport;if(!l||!a)return void r();a.x=Math.ceil(a.x),a.y=Math.ceil(a.y),i.rtl&&a.translate(-i.timeAxisViewModel.totalSize+l.width,0),a.translate(l.x-o.scrollLeft,l.y-o.y);const c=i.on({renderEvent:async({eventRecord:e,element:i,targetElement:s})=>{if(e===t){const e=i||s;c(),await d,n.highlight&&Mr.highlight(e),n.focus&&e.focus(),r()}}}),d=o.scrollIntoView(a,s)}))}scrollResourceIntoView(e,t=WC){return this.isVertical?this.currentOrientation.scrollResourceIntoView(e,t):this.scrollRowIntoView(e,t)}get widgetClass(){}},GC=e=>class extends(e||Te){static get $name(){return"SchedulerRegions"}getScheduleRegion(e,t,n=!0,r){return this.currentOrientation.getScheduleRegion(...arguments)}getResourceRegion(e,t,n){return this.currentOrientation.getRowRegion(...arguments)}getAssignmentEventBox(e,t){return this.getResourceEventBox(e.event,e.resource,t)}getResourceEventBox(e,t,n=!1,r=!1){return this.currentOrientation.getResourceEventBox(...arguments)}getItemBox(e,t=!1){return e.resources.map((n=>this.getResourceEventBox(e,n,t)))}get widgetClass(){}};const qC=["eventLayout","mode","eventColor","eventStyle","tickSize","fillTicks"];var KC=e=>class extends(e||Te){static get $name(){return"SchedulerState"}getState(){return sn.copyProperties(super.getState(),this,qC)}applyState(e){var t;this.suspendRefresh();let n=qC.slice();"layoutFn"===(null==e?void 0:e.eventLayout)&&(delete e.eventLayout,n.splice(n.indexOf("eventLayout"),1)),null!=e&&null!==(t=e.zoomLevelOptions)&&void 0!==t&&t.width&&(n=n.filter((e=>"tickSize"!==e))),sn.copyProperties(this,e,n),super.applyState(e),this.resumeRefresh(!0)}get widgetClass(){}},XC=e=>class extends(e||Te){static get $name(){return"EventSelection"}static get configurable(){return{highlightPredecessors:!1,highlightSuccessors:!1,deselectOnClick:!1}}static get defaultConfig(){return{multiEventSelect:!1,eventSelectionDisabled:!1,eventSelectedCls:"b-sch-event-selected",triggerSelectionChangeOnRemove:!1,maintainSelectionOnDatasetChange:!0,eventAssignHighlightCls:"b-sch-event-assign-selected",selectedCollection:{}}}afterConstruct(){var e;super.afterConstruct(),null===(e=this.navigator)||void 0===e||e.on({navigate:"onEventNavigate",thisObj:this})}set selectedCollection(e){e instanceof rs||(e=new rs(e)),this._selectedCollection=e,e.on({change:(...e)=>this.project.deferUntilRepopulationIfNeeded("onSelectedCollectionChange",((...e)=>!this.isDestroying&&this.onSelectedCollectionChange(...e)),e),beforeSplice:"onBeforeSelectedCollectionSplice",thisObj:this})}get selectedCollection(){return this._selectedCollection}getActionType(e,t,n){return e.length>0?t.length>0&&n.length>0?"update":t.length>0?"select":"deselect":"clear"}getEventsFromAssignments(e){return ke.unique(e.map((e=>e.event)))}get selectedEvents(){return this.getEventsFromAssignments(this.selectedCollection.values)}set selectedEvents(e){var t;const n=[];null===(t=e=ke.asArray(e))||void 0===t||t.forEach((e=>{!1!==this.isEventSelectable(e)&&n.push(...e.assignments)})),this.selectedCollection.splice(0,this.selectedCollection.count,n)}get selectedAssignments(){return this.selectedCollection.values}set selectedAssignments(e){this.selectedCollection.splice(0,this.selectedCollection.count,e||[])}isEventSelected(e){const{selectedCollection:t}=this;return Boolean(t.count&&t.includes(e.assignments))}isEventSelectable(e){}isAssignmentSelected(e){return this.selectedCollection.includes(e)}select(e,t=!1){e.isAssignment?this.selectAssignment(e,t):this.selectEvent(e,t)}selectEvent(e,t=!1){this.isEventSelected(e)||this.selectEvents([e],t)}selectAssignment(e,t=!1,n){this.isAssignmentSelected(e)||(t?this.selectedCollection.add(e):this.selectedAssignments=e)}deselect(e){e.isAssignment?this.deselectAssignment(e):this.deselectEvent(e)}deselectEvent(e){this.isEventSelected(e)&&this.selectedCollection.remove(...e.assignments)}deselectAssignment(e){this.isAssignmentSelected(e)&&this.selectedCollection.remove(e)}selectEvents(e,t=!1){if(t){const t=e.reduce(((e,t)=>(!1!==this.isEventSelectable(t)&&e.push(...t.assignments),e)),[]);this.selectedCollection.add(t)}else this.selectedEvents=e}deselectEvents(e){this.selectedCollection.remove(e.reduce(((e,t)=>(e.push(...t.assignments),e)),[]))}selectAssignments(e){this.selectedCollection.add(e)}deselectAssignments(e){this.selectedCollection.remove(e)}clearEventSelection(){this.selectedAssignments=[]}onBeforeSelectedCollectionSplice({toAdd:e,toRemove:t,index:n}){const r=this,i=r._selectedCollection.values,s=e,o=t>0?s.slice(n,t+n):[],a=r.getActionType(i,s,o);return!1!==r.trigger("beforeEventSelectionChange",{action:a,selection:r.getEventsFromAssignments(i)||[],selected:r.getEventsFromAssignments(s)||[],deselected:r.getEventsFromAssignments(o)||[]})&&!1!==r.trigger("beforeAssignmentSelectionChange",{action:a,selection:i,selected:s,deselected:o})&&void 0}onSelectedCollectionChange({added:e,removed:t}){const n=this,r=n.selectedAssignments,i=e||[],s=t||[];function o(e,t){const r=e.event;if(r){const{eventAssignHighlightCls:i}=n,s=n.getElementFromAssignmentRecord(e);n.currentOrientation.toggleCls(e,n.eventSelectedCls,t),i&&n.getElementsFromEventRecord(r).forEach((e=>{if(e!==s){const r=n.resolveAssignmentRecord(e);n.currentOrientation.toggleCls(r,i,t),t&&(e.style.animation="none",e.offsetHeight,e.style.animation=""),e.classList.toggle(i,t)}}))}}if(s.forEach((e=>o(e,!1))),i.forEach((e=>o(e,!0))),(n.highlightSuccessors||n.highlightPredecessors)&&n.highlightLinkedEvents(n.selectedEvents),n.$selectedAssignments=r.map((e=>({eventId:e.eventId,resourceId:e.resourceId}))),!n.silent){const e=this.getActionType(r,i,s);n.trigger("assignmentSelectionChange",{action:e,selection:r,selected:i,deselected:s}),n.trigger("eventSelectionChange",{action:e,selection:n.selectedEvents,selected:n.getEventsFromAssignments(i),deselected:n.getEventsFromAssignments(s)})}}onAssignmentChange({action:e,records:t}){const n=this;if(n.silent=!n.triggerSelectionChangeOnRemove,"remove"===e)n.deselectAssignments(t);else if("removeall"!==e||n.eventStore.isSettingData){if("dataset"===e&&n.$selectedAssignments)if(n.maintainSelectionOnDatasetChange){const e=n.$selectedAssignments.map((e=>t.find((t=>t.eventId===e.eventId&&t.resourceId===e.resourceId))));n.selectedAssignments=ke.clean(e)}else n.clearEventSelection()}else n.clearEventSelection();n.silent=!1}onInternalEventStoreChange({source:e,action:t,records:n}){e.isResourceTimeRangeStore||"dataset"!==t||n.length||this.clearEventSelection(),super.onInternalEventStoreChange(...arguments)}onAssignmentSelectionClick(e,t){const n=this;n.isAssignmentSelected(t)?(n.deselectOnClick||e.ctrlKey)&&n.deselectAssignment(t,n.multiEventSelect,e):!1!==this.isEventSelectable(t.event)&&n.selectAssignment(t,e.ctrlKey&&n.multiEventSelect,e)}onEventNavigate({event:e,item:t}){if(!this.eventSelectionDisabled){const n=t&&(t.nodeType===Element.ELEMENT_NODE?this.resolveAssignmentRecord(t):t);n?this.onAssignmentSelectionClick(e,n):this.clearEventSelection()}}changeHighlightSuccessors(e){return this.changeLinkedEvents(e)}changeHighlightPredecessors(e){return this.changeLinkedEvents(e)}changeLinkedEvents(e){const t=this;return e?(t.highlighted=t.highlighted||new Set,t.highlightLinkedEvents(t.selectedEvents)):t.highlighted&&t.highlightLinkedEvents(),e}highlightLinkedEvents(e=[]){const t=this,{highlighted:n,eventStore:r}=t,i=t.features.dependencies;n.forEach((t=>{e.includes(t)||(t.meta.highlight=!1,n.delete(t),r.includes(t)&&t.dependencies.forEach((e=>i.unhighlight(e,"b-highlight"))))})),e.forEach((e=>{const r=[e];for(;r.length;){const e=r.pop();n.add(e),t.highlightSuccessors&&e.outgoingDeps.forEach((e=>{i.highlight(e,"b-highlight"),!n.has(e.toEvent)&&r.push(e.toEvent)})),t.highlightPredecessors&&e.incomingDeps.forEach((e=>{i.highlight(e,"b-highlight"),!n.has(e.fromEvent)&&r.push(e.fromEvent)}))}n.forEach((e=>e.meta.highlight=!0))})),t.element.classList.toggle("b-highlighting",e.length>0),t.refreshWithTransition()}onEventDataGenerated(e){(this.highlightSuccessors||this.highlightPredecessors)&&(e.cls["b-highlight"]=e.eventRecord.meta.highlight),super.onEventDataGenerated(e)}updateProject(e,t){this.clearEventSelection(),super.updateProject(e,t)}doDestroy(){var e;null===(e=this._selectedCollection)||void 0===e||e.destroy(),super.doDestroy()}get widgetClass(){}};const ZC=e=>e.preventDefault(),JC={ArrowRight:1,ArrowLeft:1,ArrowUp:1,ArrowDown:1},QC={animate:100},ew=Object.freeze({});var tw=e=>class extends(Zr(e||Te)){static get $name(){return"EventNavigation"}static get configurable(){return{navigator:{allowCtrlKey:!0,scrollSilently:!0,keys:{Space:"onEventSpaceKey",Enter:"onEventEnterKey",Delete:"onDeleteKey",Backspace:"onDeleteKey",ArrowUp:"onArrowUpKey",ArrowDown:"onArrowDownKey",Escape:"onEscapeKey",Tab:"onTab","SHIFT+Tab":"onShiftTab"}},isNavigationKey:{ArrowDown:1,ArrowUp:1,ArrowLeft:1,ArrowRight:1}}}static get defaultConfig(){return{focusCls:"b-active",enableDeleteKey:!0,onDeleteKeyBuffer:500,navigatePreviousBuffer:200,navigateNextBuffer:200,testConfig:{onDeleteKeyBuffer:1}}}construct(e){const t=this;t.isInTimeAxis=t.isInTimeAxis.bind(t),t.onDeleteKey=t.throttle(t.onDeleteKey,t.onDeleteKeyBuffer,t),super.construct(e)}changeNavigator(e){const t=this;return t.getConfig("subGridConfigs"),new id(t.constructor.mergeConfigs({ownerCmp:t,target:t.timeAxisSubGridElement,processEvent:t.processEvent,itemSelector:`.${t.eventCls}-wrap`,focusCls:t.focusCls,navigatePrevious:t.throttle(t.navigatePrevious,{delay:t.navigatePreviousBuffer,throttled:ZC}),navigateNext:t.throttle(t.navigateNext,{delay:t.navigateNextBuffer,throttled:ZC})},e))}doDestroy(){this.navigator.destroy(),super.doDestroy()}isInTimeAxis(e){return!e.instanceMeta(this).excluded&&this.timeAxis.isTimeSpanInAxis(e)}onElementKeyDown(e){var t,n;const r=this,{navigator:i}=r,s=i.constructor.getComposedKeyName(e);if(-1===(null===(t=r.focusedCell)||void 0===t?void 0:t.rowIndex)||(null===(n=r.focusedCell)||void 0===n?void 0:n.column)!==r.timeAxisColumn||e.target.closest(i.itemSelector)||"Enter"!==e.key){var o;if(!r.isNavigationKey[s]||!e.target.matches(r.navigator.itemSelector))return null===(o=super.onElementKeyDown)||void 0===o?void 0:o.call(this,e)}else{const t=r.getFirstVisibleAssignment();if(t)return r.navigateTo(t,{uiEvent:e}),!1}}getFirstVisibleAssignment(e=this.focusedCell){const{currentOrientation:t,rowManager:n,eventStore:r}=this;if(this.isHorizontal){var i;let c=t.rowMap.get(n.getRow(e.rowIndex));var s,o,a,l;if(null!==(i=c)&&void 0!==i&&i.length)return null===(s=c[0])||void 0===s?void 0:s.elementData.assignmentRecord;if(c=null===(o=t.resourceMap.get(e.id))||void 0===o?void 0:o.eventsData,null!==(a=c)&&void 0!==a&&a.length)return null===(l=c.filter((e=>r.isAvailable(e.eventRecord)))[0])||void 0===l?void 0:l.assignmentRecord}else{const e=[...t.resourceMap.values()][0],n=e&&Object.values(e);if(null!=n&&n.length)return n.filter((e=>r.isAvailable(e.renderData.eventRecord)))[0].renderData.assignmentRecord}}onGridBodyFocusIn(e){const t=e.target.closest(this.focusableSelector);if(this.timeAxisSubGridElement.contains(e.target)){const r=this,{navigationEvent:i}=r,{target:s}=e,o=s.closest(r.navigator.itemSelector),a=o?r.normalizeCellContext({rowIndex:r.isVertical?0:r.resourceStore.indexOf(r.resolveResourceRecord(s)),column:r.timeAxisColumn,target:s}):new Gh(s);if(o){var n;const{_focusedCell:e}=r;return r._focusedCell=a,void(null===(n=r.onCellNavigate)||void 0===n||n.call(r,r,e,a,i,!0))}if(t&&(!i||JC[i.key])){const t=r.getFirstVisibleAssignment(a);if(t)return void r.navigateTo(t,{scrollIntoView:Boolean(i&&"mousedown"!==i.type),uiEvent:i||e})}}t&&super.onGridBodyFocusIn(e)}accessibleFocusCell(e,t){if((e=this.normalizeCellContext(e)).columnId!==this.timeAxisColumn.id)return super.focusCell(e,t)}normalizeTarget(e){return e.assignmentRecord}getPrevious(e,t){const n=this,{resourceStore:r}=n,{eventSorter:i}=n.currentOrientation,{startDate:s,endDate:o}=n.timeAxis,a=e.event,l=n.eventStore.getEvents({resourceRecord:e.resource,startDate:s,endDate:o}).filter(this.isInTimeAxis).sort(i);let c=e.resource,d=l[l.indexOf(a)-1];if(!d)for(let e=r.indexOf(c)-1;(!d||t&&d===a)&&e>=0;e--){c=r.getAt(e);const t=n.eventStore.getEvents({resourceRecord:c,startDate:s,endDate:o}).filter(n.isInTimeAxis).sort(i);d=t.length&&t[t.length-1]}return n.assignmentStore.getAssignmentForEventAndResource(d,c)}navigatePrevious(e){const t=this,n=t.getPrevious(t.normalizeTarget(e));return e.preventDefault(),n?(e.ctrlKey||t.clearEventSelection(),t.navigateTo(n,{uiEvent:e})):t.doGridNavigation(e)}getNext(e,t){const n=this,{resourceStore:r}=n,{eventSorter:i}=n.currentOrientation,{startDate:s,endDate:o}=n.timeAxis,a=e.event,l=n.eventStore.getEvents({resourceRecord:e.resource,startDate:s,endDate:o}).filter(this.isInTimeAxis).sort(i);let c=e.resource,d=l[l.indexOf(a)+1];if(!d)for(let e=r.indexOf(c)+1;(!d||t&&d===a)&&e<r.count;e++)c=r.getAt(e),d=n.eventStore.getEvents({resourceRecord:c,startDate:s,endDate:o}).filter(n.isInTimeAxis).sort(i)[0];return n.assignmentStore.getAssignmentForEventAndResource(d,c)}navigateNext(e){const t=this,n=t.getNext(t.normalizeTarget(e));return e.preventDefault(),n?(e.ctrlKey||t.clearEventSelection(),t.navigateTo(n,{uiEvent:e})):t.doGridNavigation(e)}doGridNavigation(e){e.handled||0!==e.key.indexOf("Arrow")||this[`navigate${e.key.substring(5)}ByKey`](e)}async navigateTo(e,{scrollIntoView:t=!0,uiEvent:n={}}=ew){const r=this,{navigator:i}=r,{skipScrollIntoView:s}=i;e&&(t?(i.disabled=!0,await r.scrollAssignmentIntoView(e,QC),i.disabled=!1):i.skipScrollIntoView=!0,!r.isDestroyed&&this.getElementFromAssignmentRecord(e)&&(r.activeAssignment=e,i.skipScrollIntoView=s,i.trigger("navigate",{event:n,item:r.getElementFromAssignmentRecord(e).closest(i.itemSelector)})))}set activeAssignment(e){const t=this.getElementFromAssignmentRecord(e,!0);t&&(this.navigator.activeItem=t)}get activeAssignment(){const{activeItem:e}=this.navigator;if(e)return this.resolveAssignmentRecord(e)}get previousActiveEvent(){const{previousActiveItem:e}=this.navigator;if(e)return this.resolveEventRecord(e)}processEvent(e){const t=this,n=e.target.closest(t.eventSelector);return!t.navigator.disabled&&n&&(e.assignmentRecord=t.resolveAssignmentRecord(n),e.eventRecord=t.resolveEventRecord(n),e.resourceRecord=t.resolveResourceRecord(n)),e}onDeleteKey(e){const t=this;if(!t.readOnly&&t.enableDeleteKey){const e=t.eventStore.usesSingleAssignment?t.selectedEvents:t.selectedAssignments;t.removeEvents(e.filter((e=>!e.readOnly)))}}onArrowUpKey(e){this.focusCell({rowIndex:this.focusedCell.rowIndex-1,column:this.timeAxisColumn}),e.handled=!0}onArrowDownKey(e){this.focusedCell.rowIndex<this.resourceStore.count-1&&(this.focusCell({rowIndex:this.focusedCell.rowIndex+1,column:this.timeAxisColumn}),e.handled=!0)}onEscapeKey(e){e.target.closest(".b-dragging")||(this.focusCell({rowIndex:this.focusedCell.rowIndex,column:this.timeAxisColumn}),e.handled=!0)}onEventSpaceKey(e){}onEventEnterKey(e){}get isActionableLocation(){if(!this.navigator.activeItem)return super.isActionableLocation}get widgetClass(){}};const nw={releaseElement:1,reuseElement:1},rw={newElement:1,reuseOwnElement:1,reuseElement:1},iw=9999999,sw=({startDateMS:e},{startDateMS:t})=>e-t,ow={startDate:1,endDate:1,duration:1};function aw(e,t,n,r,i){var s;const{timeAxis:o}=e,a=t.isBatchUpdating&&!i?t.get(r):t[r],l=null===(s=t.hasBatchedChange)||void 0===s?void 0:s.call(t,r);if(e.fillTicks&&(!t.meta.isResizing||!l)){let e=o.getTickFromDate(a);if(e>=0){n&&e===Math.round(e)&&e>0&&e--;const t=Math.floor(e);return o.getAt(t)[r].getTime()}}return null==a?void 0:a.getTime()}class lw extends(Te.mixin(Sy)){static get configurable(){return{scrollBuffer:0,bufferSize:150,verticalBufferSize:150}}static get properties(){return{resourceMap:new Map,rowMap:new Map,eventConfigs:[],isFirstRefresh:!0,toDrawOnProjectRefresh:new Set,toDrawOnDataReady:new Set}}construct(e){const t=this;t.client=t.scheduler=e,t.eventSorter=t.eventSorter.bind(e),e.scrollable.on({scroll:"onEarlyScroll",prio:1,thisObj:t}),e.rowManager.on({name:"rowManager",renderDone:"onRenderDone",removeRows:"onRemoveRows",translateRow:"onTranslateRow",beforeRowHeight:"onBeforeRowHeightChange",thisObj:t}),super.construct({})}init(){}updateVerticalBufferSize(){const{rowManager:e}=this.scheduler;this.scheduler.isPainted&&e.renderRows(e.rows)}get visibleDateRange(){return this._visibleDateRange}getDateFromXY(e,t,n,r=!1){const{scheduler:i}=this;let s=e[0];return n||(s=this.translateToScheduleCoordinate(s)),s=i.getRtlX(s),i.timeAxisViewModel.getDateFromPosition(s,t,r)}translateToScheduleCoordinate(e){const{scheduler:t}=this,{scrollable:n}=t.timeAxisSubGrid;let r=e-t.timeAxisSubGridElement.getBoundingClientRect().left-globalThis.scrollX;return t.rtl?r+=n.maxX-Math.abs(t.scrollLeft):r+=t.scrollLeft,r}translateToPageCoordinate(e){const{scheduler:t}=this,{scrollable:n}=t.timeAxisSubGrid;let r=e+t.timeAxisSubGridElement.getBoundingClientRect().left;return t.rtl?r-=n.maxX-Math.abs(t.scrollLeft):r-=t.scrollLeft,r}getScheduleRegion(e,t,n=!0,r,i=!1){var s,o;const a=this,{scheduler:l}=a,{timeAxisSubGridElement:c,timeAxis:d}=l,u=(!i||e)&&l.getResourceMargin(e)||0;let h;if(e){const n=t&&l.getElementsFromEventRecord(t,e)[0];if(h=xn.from(l.getRowById(e.id).getElement("normal"),c),n){const e=xn.from(n,c);h.y=e.y,h.bottom=e.bottom}else h.y=h.y+u,h.bottom=h.bottom-u}else h=xn.from(c).moveTo(null,0),h.width=c.scrollWidth,h.y=h.y+u,h.bottom=h.bottom-u;const g=d.startDate,m=d.endDate;r=(null===(s=r)||void 0===s?void 0:s.start)&&r||(null===(o=l.getDateConstraints)||void 0===o?void 0:o.call(l,e,t))||{start:g,end:m};let p=l.getCoordinateFromDate(r.start?en.max(g,r.start):g),f=l.getCoordinateFromDate(r.end?en.min(m,r.end):m);return n||(p=a.translateToPageCoordinate(p),f=a.translateToPageCoordinate(f)),h.left=Math.min(p,f),h.right=Math.max(p,f),h}getRowRegion(e,t,n){const{scheduler:r}=this,{timeAxis:i}=r,s=r.getRowById(e.id);if(!s)return null;const o=i.startDate,a=i.endDate,l=t?en.max(o,t):o,c=n?en.min(a,n):a,d=r.getCoordinateFromDate(l),u=r.getCoordinateFromDate(c,!0,!0),h=s.top,g=Math.min(d,u),m=h+s.offsetHeight;return new xn(g,h,Math.max(d,u)-g,m-h)}getResourceEventBox(e,t,n,r=!1){const i=this.resourceMap.get(t.id);let s=null,o=!1;if(i&&(s=i.eventsData.find((t=>t.eventRecord===e))),s||(s=this.getTimeSpanRenderData(e,t,{viewport:!0,timeAxis:n}),o=!0),s){const e=this.scheduler.rowManager.getRecordCoords(t,!0,r),n=s.top+e.top,i=new xn(s.left,n,s.width,s.height);return i.layout=!o,i.rowTop=e.top,i.rowBottom=e.bottom,i.resourceId=t.id,i}return null}resolveRowRecord(e){const{scheduler:t}=this,n=e.nodeType?e:e.target,r=n.nodeType===Element.TEXT_NODE?n.parentElement:n,i=r.closest(t.eventSelector);return i?this.resourceStore.getById(i.dataset.resourceId):t.getRecordFromElement(r)}attachToProject(e){super.attachToProject(e),this.refreshAllWhenReady=!0,this.scheduler.isConfiguring||this.clearAll({clearDom:!0}),null==e||e.on({name:"project",refresh:"onProjectRefresh",commitFinalized:"onProjectCommitFinalized",thisObj:this})}onProjectCommitFinalized(){const{scheduler:e,toDrawOnDataReady:t}=this;e.isVisible?e.isPainted&&!e.refreshSuspended&&(t.size&&(this.clearResources(t),this.refreshResources(t)),t.clear()):e.whenVisible("refreshRows")}onProjectRefresh({isCalculated:e,isInitialCommit:t}){const n=this,{scheduler:r,toDrawOnProjectRefresh:i}=n;if(r.isVisible){if(r.isPainted&&!r.isConfiguring&&!r.refreshSuspended){if(n.refreshAllWhenReady||t&&e){r.calculateAllRowHeights(!0);const{rowManager:i}=r;i.topRow?(n.clearAll(),r.refreshAfterProjectRefresh||(i.topRow.dataIndex>=r.store.count?r.renderRows(!1):r.refreshWithTransition(!1,!n.isFirstRefresh&&e&&!t)),n.isFirstRefresh=!1):i.reinitialize(),n.refreshAllWhenReady=!1}else i.size&&n.refreshResources(i);i.clear()}}else r.whenVisible("refresh",r,[!0])}attachToAssignmentStore(e){this.refreshAllWhenReady=!0,super.attachToAssignmentStore(e),e&&e.on({name:"assignmentStore",changePreCommit:"onAssignmentStoreChange",refreshPreCommit:"onAssignmentStoreRefresh",thisObj:this})}onAssignmentStoreChange({action:e,records:t=[],replaced:n,changes:r}){const i=this,{scheduler:s}=i,o=new Set(t.flatMap((e=>{var t,n,r;return[e.resourceId,...null!==(t=null===(n=e.resource)||void 0===n||null===(r=n.$links)||void 0===r?void 0:r.map((e=>e.id)))&&void 0!==t?t:[]]})));if(!i.resourceStore.isRemoving&&!i.resourceStore.isChangingId)switch(e){case"dataset":return void(i.eventStore.usesSingleAssignment||(o.size?i.refreshResourcesWhenReady(o):(i.clearAll(),s.refreshWithTransition())));case"add":case"remove":case"updateMultiple":return void i.refreshResourcesWhenReady(o);case"removeall":return void(i.refreshAllWhenReady=!0);case"replace":return n.forEach((([e,t])=>{o.add(e.resourceId),o.add(t.resourceId)})),void i.refreshResourcesWhenReady(o);case"filter":return i.clearAll(),s.calculateAllRowHeights(!0),void s.refreshWithTransition();case"update":("eventId"in r||"resourceId"in r||"id"in r)&&("resourceId"in r&&o.add(r.resourceId.oldValue),i.refreshResourcesOnDataReady(o));break;case"clearchanges":{const{added:e,modified:t,removed:n}=r;t?s.refreshWithTransition():(e.forEach((e=>o.add(e.resourceId))),n.forEach((e=>o.add(e.resourceId))),i.refreshResourcesOnDataReady(o))}}}onAssignmentStoreRefresh({action:e,records:t}){"batch"===e&&(this.clearAll(),this.scheduler.refreshWithTransition())}attachToEventStore(e){this.refreshAllWhenReady=!0,super.attachToEventStore(e),e&&e.on({name:"eventStore",refreshPreCommit:"onEventStoreRefresh",thisObj:this})}onEventStoreRefresh({action:e}){if("batch"===e){const{scheduler:e}=this;e.isEngineReady&&e.isPainted&&(this.clearAll(),e.refreshWithTransition())}}onEventStoreChange({action:e,records:t=[],record:n,replaced:r,changes:i,source:s}){const o=this,{scheduler:a}=o,l=s.isResourceTimeRangeStore,c=new Set;if(a.isPainted)if(t.forEach((e=>{var t;return null===(t=e.$linkedResources)||void 0===t?void 0:t.forEach((e=>c.add(e.id)))})),l){switch(e){case"removeall":case"dataset":return o.clearAll(),void a.refreshWithTransition()}o.refreshResources(c)}else{switch(e){case"batch":case"sort":case"group":case"move":case"remove":return;case"clearchanges":return o.clearAll(),void a.refreshWithTransition();case"dataset":return o.clearAll(),void(o.refreshAllWhenReady=!0);case"add":case"updateMultiple":break;case"replace":r.forEach((([,e])=>{e.resources.map((e=>c.add(e.id)))}));break;case"removeall":case"filter":return a.isEngineReady?(o.clearAll(),a.calculateAllRowHeights(!0),void a.refreshWithTransition()):void(o.refreshAllWhenReady=!0);case"update":{const e=n.$entity?!Object.keys(i).some((e=>!n.$entity.getField(e))):!Object.keys(i).some((e=>!ow[e]));let t=0;var d,u;return"startDate"in i&&t++,"endDate"in i&&t++,"duration"in i&&t++,"resourceId"in i&&c.add(i.resourceId.oldValue),void((!e||t&&(!("duration"in i)||1!==t)||"percentDone"in i||"inactive"in i||"segments"in i)&&(null!==(d=o.project)&&void 0!==d&&d.propagatingLoadChanges||null!==(u=o.project)&&void 0!==u&&u.isWritingData?o.refreshResourcesOnDataReady(c):o.refreshResources(c)))}}o.refreshResourcesWhenReady(c)}}attachToResourceStore(e){this.refreshAllWhenReady=!0,super.attachToResourceStore(e),e&&(this.clearAll({clearLayoutCache:!0}),e.on({name:"resourceStore",changePreCommit:"onResourceStoreChange",thisObj:this}))}get resourceStore(){return this.client.store}onResourceStoreChange({action:e,isExpand:t,records:n,changes:r}){const i=this,s=null==n?void 0:n.flatMap((e=>e.isLinked?[e.id,e.$originalId]:[e.id]));if(i.scheduler.isPainted){switch(e){case"add":return void(t||(n.every((e=>e.isLinked))?i.refreshResources(s):i.refreshResourcesWhenReady(s)));case"update":return void(i.project.isBatchingChanges||r.isLeaf||i.refreshResources(s));case"filter":case"dataset":return;case"removeall":return void i.clearAll({clearLayoutCache:!0})}s&&i.clearResources(s)}}onTranslateRow({row:e}){null!=e.id&&this.refreshEventsForResource(e,!1)}calculateRowHeight(e){var t;const{scheduler:n}=this,r=n.getResourceHeight(e),i=n.getEventLayout(e);if("stack"===i.type&&n.isEngineReady&&!e.isSpecialRow&&(null===(t=e.assigned)||void 0===t?void 0:t.size)>1){const{assignmentStore:t,eventStore:r,timeAxis:s}=n,{barMargin:o,resourceMargin:a,contentHeight:l}=n.getResourceLayoutSettings(e),c=(r.isFiltered||t.isFiltered)&&(n=>n.assignments.some((n=>n.resource===e.$original&&t.includes(n)))),d=r.getEvents({resourceRecord:e,includeOccurrences:n.enableRecurringEvents,startDate:s.startDate,endDate:s.endDate,filter:c}).sort(sw).map((t=>{const n=t.isBatchUpdating?t.get("startDate"):t.startDate,r=t.isBatchUpdating?t.get("endDate"):t.endDate||n;return{eventRecord:t,resourceRecord:e,startMS:n.getTime(),endMS:r.getTime()}})),u=n.getEventLayoutHandler(i),h=u.layoutEventsInBands(d,!0);return"layoutFn"===u.type?h:h*l+(h-1)*o+2*a}return r}doUpdateTimeView(){const{scrollable:e}=this.scheduler.timeAxisSubGrid;this.updateFromHorizontalScroll(e.x)}onTimeAxisViewModelUpdate(){const e=this,{scheduler:t}=e;e.clearAll(),t.refreshSuspended&&(e.detachListeners("renderingSuspend"),t.on({name:"renderingSuspend",resumeRefresh({trigger:n}){t.isEngineReady&&n&&e.doUpdateTimeView()},thisObj:e,once:!0})),e.doUpdateTimeView()}getConnectorStartSide(e){return"start"}getConnectorEndSide(e){return"end"}refreshRows(e){e&&this.clearAll()}onLocaleChange(){this.clearAll()}onViewportResize(e,t,n,r){t>r&&this.onRenderDone()}onDragAbort({context:e,dragData:t}){this.resourceStore.indexOf(t.record.resource)<this.scheduler.topRow.dataIndex&&e.element.remove()}toggleCls(e,t,n=!0,r=!1){const i=this.client.getElementFromAssignmentRecord(e,r),s=this.resourceMap.get(e.isModel?e.get("resourceId"):e.resourceId),o=null==s?void 0:s.eventsData.find((t=>t.eventId===e.eventId));o&&(o[r?"wrapperCls":"cls"][t]=n),i&&(i.classList[n?"add":"remove"](t),i.lastDomConfig.className[t]=n)}onRemoveRows({rows:e}){e.forEach((e=>this.rowMap.delete(e))),this.onRenderDone()}onEarlyScroll(){this.rendererCalled=!1}updateFromVerticalScroll(){this.rendererCalled||this.onRenderDone()}updateFromHorizontalScroll(e){const t=this,{scheduler:n,scrollBuffer:r}=t,{timeAxisSubGrid:i,timeAxis:s,rtl:o}=n,{width:a}=i,{totalSize:l}=n.timeAxisViewModel,c=e,d=0!==i.scrollable.maxX&&Math.abs(i.scrollable.maxX)<=Math.round(c)+5,u=n.getDateFromCoord({coord:Math.max(0,c-r),ignoreRTL:!0}),h=d?s.endDate:n.getDateFromCoord({coord:c+a+r,ignoreRTL:!0})||s.endDate;if(u&&!n._viewPresetChanging){t._visibleDateRange={startDate:u,endDate:h,startMS:u.getTime(),endMS:h.getTime()},t.viewportCoords=o?{left:l-e-a+r,right:l-e-r}:{left:e-r,right:e+a+r};const i=n.timeView.range={startDate:u,endDate:h};if(n.onVisibleDateRangeChange(i),!n.refreshSuspended&&n.rowManager.rows.length){if(null===n.rowManager.rows[0].id)return;n.rowManager.rows.forEach((e=>t.refreshEventsForResource(e,!1))),t.onRenderDone()}}}repaintEventsForResource(e){this.refreshResources([e.id])}onBeforeRowHeightChange(){this.clearAll()}refreshResourcesOnDataReady(e){e.forEach((e=>this.toDrawOnDataReady.add(e)))}refreshResourcesWhenReady(e){this.clearResources(e),e.forEach((e=>this.toDrawOnProjectRefresh.add(e)))}refreshResources(e,t=!0){const{scheduler:n}=this,r=[],i=[];this.clearResources(e),n.refreshSuspended||(e.forEach((e=>{const t=n.getRowById(e);t?r.push(t):i.push(t)})),n.runWithTransition((()=>{n.calculateRowHeights(i.map((e=>this.resourceStore.getById(e))),!0),n.rowManager.renderRows(r)}),t))}layoutEventVerticallyStack(e,t,n){const{barMargin:r,resourceMargin:i,contentHeight:s}=this.scheduler.getResourceLayoutSettings(n,t.parent);return 0===e?i:i+e*s+e*r}layoutEventVerticallyPack(e,t,n,r){const{barMargin:i,resourceMargin:s,contentHeight:o}=this.scheduler.getResourceLayoutSettings(r,n.parent),a=1/t,l=e*a,c=(o-(a-1)*i)*t;return{top:s+l*c+l*i,height:c}}addTemporaryDragElement(e,t=e.resource){const{scheduler:n}=this,r=n.generateRenderData(e,t,{timeAxis:!0,viewport:!0});r.absoluteTop=r.row?r.top+r.row.top:n.getResourceEventBox(e,t,!0).top;const i=this.renderEvent(r),{dataset:s}=i;delete i.tabIndex,delete s.eventId,delete s.resourceId,delete s.assignmentId,delete s.syncId,s.transient=!0,i.parent=this.scheduler.foregroundCanvas,i.retainElement=!0;const o=Mr.createElement(i);return o.innerElement=o.firstChild,e.instanceMeta(n).hasTemporaryDragElement=!0,o}eventSorter(e,t){if(this.overlappingEventSorter)return this.overlappingEventSorter(e.eventRecord||e,t.eventRecord||t);const n=e.isModel?e.startDateMS:e.dataStartMS||e.startMS,r=e.isModel?e.endDateMS:e.dataEndMS||e.endMS,i=t.isModel?t.startDateMS:t.dataStartMS||t.startMS,s=t.isModel?t.endDateMS:t.dataEndMS||t.endMS,o=e.isModel?e.name:e.eventRecord.name,a=t.isModel?t.name:t.eventRecord.name;return n-i||s-r||(o<a?-1:o==a?0:1)}calculateMS(e,t,n,r,i){const{scheduler:s}=this,{timeAxisViewModel:o}=s;let a=aw(s,e,!1,t,r),l=aw(s,e,!0,n,r),c=l-a;if("default"!==s.milestoneLayoutMode&&0===c){const t=o.getSingleUnitInPixels("minute");switch(c=s.getMilestoneLabelWidth(e,i)*(1/t)*60*1e3,s.milestoneAlign){case"start":case"left":l=a+c;break;case"end":case"right":l=a,a=l-c;break;default:l=a+c/2,a=l-c}}return{startMS:a,endMS:l,durationMS:c}}setupRenderData(e,t){var n;const r=this,{scheduler:i}=r,{timeAxis:s,timeAxisViewModel:o}=i,{preamble:a,postamble:l}=e,c=r.isProHorizontalRendering&&(null===(n=i.features.eventBuffer)||void 0===n?void 0:n.enabled)&&(a||l)&&!e.isMilestone,d=o.getSingleUnitInPixels("minute"),{isBatchUpdating:u}=e,h=c?"wrapStartDate":"startDate",g=c?"wrapEndDate":"endDate",m=u&&!c?e.get(h):e[h],p=u&&!c?e.get(g):e[g]||m,f=s.startMS,v=s.endMS,{startMS:y,endMS:b,durationMS:C}=r.calculateMS(e,h,g,c,t),w=y<f|(y>v)<<1,S=b>v|(b<=f)<<1,D=S?d*(C/6e4):null,E=i.getRowById(t);return{eventRecord:e,taskRecord:e,start:m,end:p,rowId:t.id,children:[],startMS:y,endMS:b,durationMS:C,startsOutsideView:w,endsOutsideView:S,width:D,row:E,useEventBuffer:c}}fillTimeSpanHorizontalPosition(e){const{startMS:t,endMS:n,durationMS:r}=e,i=null!=t&&null!=n&&this.calculateHorizontalPosition(e,t,n,r);return!!i&&(Object.assign(e,i),!0)}calculateHorizontalPosition(e,t,n,r){const{scheduler:i}=this,{timeAxis:s,timeAxisViewModel:o}=i,{startsOutsideView:a,endsOutsideView:l,eventRecord:c}=e,d=s.startMS,u=o.getSingleUnitInPixels("minute"),h=l?u*(r/6e4):null;let g,m=i.getCoordinateFromDate(n,{local:!0,respectExclusion:!0,isEnd:!0}),p=!1,f=!1;return a?(g=(t-d)/6e4*u,i.rtl&&(g=i.timeAxisSubGrid.scrollable.scrollWidth-g)):(g=i.getCoordinateFromDate(t,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:-1!==m}),p=-1===g),l?m=y.isSafari&&i.features.stickyEvents?i.getCoordinateFromDate(s.endMS):g+h*(i.rtl?-1:1):f=-1===m,f&&!p&&(m=i.getCoordinateFromDate(n,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0})),h>iw&&(1===a?1===l?(g=-100,m=i.timeAxisColumn.width+100):g=m-iw:1===l&&(m=g+iw)),p&&f&&(g=i.getCoordinateFromDate(t,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:!0,max:n}),m=i.getCoordinateFromDate(n,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0,min:t}),g===m)?(c.instanceMeta(i).excluded=!0,null):{left:Math.min(g,m),width:Math.abs(m-g)||(c.isMilestone&&!c.meta.isDragCreating?0:6),clippedStart:p,clippedEnd:f}}fillTimeSpanVerticalPosition(e,t){const{scheduler:n}=this,{start:r,end:i}=e,{resourceMargin:s,contentHeight:o}=n.getResourceLayoutSettings(t);n.fillTicks&&(e.dataStartMS=r.getTime(),e.dataEndMS=i.getTime()),e.top=Math.max(0,s),n.managedEventSizing&&(e.height=o)}getTimeSpanRenderData(e,t,n=!1){const r=this,{scheduler:i}=r,{timeAxis:s}=i,o=!0===n||n.timeAxis,a=!0===n||n.viewport;if((o||s.isTimeSpanInAxis(e))&&(i.getRowById(t)||a)){const n=r.setupRenderData(e,t);return r.fillTimeSpanHorizontalPosition(n)?(r.fillTimeSpanVerticalPosition(n,t),n):null}}layoutEvents(e,t,n=!1,r,i){const{scheduler:s}=this,{timeAxis:o}=s,a=t.reduce(((t,r)=>{if(n||o.isTimeSpanInAxis(r)){const n=s.generateRenderData(r,e,!1);n&&t.push(n)}return t}),[]);a.sort(null!=i?i:this.eventSorter);let l=s.getAppliedResourceHeight(e,r);const c=a.filter((({eventRecord:e})=>e.isEvent&&!e.meta.excludeFromLayout)),d=s.getEventLayout(e,r),u=s.getEventLayoutHandler(d);if(u){const{barMargin:t,resourceMargin:n,contentHeight:i}=s.getResourceLayoutSettings(e,r),o=u.applyLayout(c,e)||1;l="layoutFn"===u.type?o:o*i+(o-1)*t+2*n}else if(c.length>0)for(let e=0;e<c.length;e++)c[e].wrapperStyle+=`;z-index:${e+5}`;return{rowHeight:l,eventsData:a}}layoutResourceEvents(e,t=!1){const{scheduler:n}=this,{eventStore:r,assignmentStore:i,timeAxis:s}=n,o=r.getEvents({includeOccurrences:n.enableRecurringEvents,resourceRecord:e,startDate:s.startDate,endDate:s.endDate,filter:(i.isFiltered||r.isFiltered)&&(t=>t.assignments.some((t=>t.resource===e.$original&&i.includes(t))))}),a=n.getEventsToRender(e,o)||[];return this.layoutEvents(e,a,t)}renderEvent(e,t){const{scheduler:n}=this,{resourceRecord:r,assignmentRecord:i,eventRecord:s}=e,o=i?this.assignmentStore.getOccurrence(i,s).id:e.eventId,a={className:e.cls,style:e.style||"",children:e.children,dataset:{taskFeature:"event"},syncOptions:{syncIdField:"taskBarFeature"}},l={className:e.wrapperCls,tabIndex:"tabIndex"in e?e.tabIndex:-1,children:[a,...e.wrapperChildren],style:{top:e.absoluteTop,left:e.left,height:e.fillSize?t:e.height,width:e.width||e.height,style:e.wrapperStyle,fontSize:e.height+"px"},dataset:{resourceId:r.id,eventId:e.eventId,syncId:r.isLinked?`${o}_${r.id}`:o},elementData:e,retainElement:(null==i?void 0:i.instanceMeta(n).retainElement)||s.instanceMeta(n).retainElement,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}};return e.fillSize&&(e.height=t),e.zIndex&&(l.zIndex=e.zIndex),i&&(l.dataset.assignmentId=i.id),e.elementConfig=l,n.trigger("beforeRenderEvent",{renderData:e,domConfig:l}),l}refreshEventsForResource(e,t=!0,n=!0){const r=this.scheduler.store.getById(e.isRow?e.id:e),i=this.scheduler.rowManager.getRowFor(r);t&&this.clearResources([r]),i&&r&&(this.renderer({row:i,record:r}),t&&n&&this.onRenderDone())}getResourceLayout(e){const t=this;let n=t.resourceMap.get(e.id);if(!n||n.invalid){if(t.suspended)return;n=t.layoutResourceEvents(e,!1),t.resourceMap.set(e.id,n)}return n}getEventDOMConfigForCurrentView(e,t,n,r){const i=this,{bufferSize:s,scheduler:o}=i,{labels:a,eventBuffer:l}=o.features,c=l&&!l.disabled||a&&!a.disabled&&(a.left||a.right||a.before||a.after),d=[];let u,h;return e.eventsData.forEach((o=>{u=n,h=r,(c||0===o.width)&&(u-=s,h+=s),o.left+o.width>=u&&o.left<=h&&(o.absoluteTop=o.top+t.top,d.push(i.renderEvent(o,e.rowHeight)))})),d}renderer({row:e,record:t,size:n={}}){if(t.isSpecialRow)return void this.rowMap.delete(e);const r=this,{left:i,right:s}=r.viewportCoords,o=r.getResourceLayout(t);if(!o)return;n.height=o.rowHeight,n.transient=!0;const a=r.getEventDOMConfigForCurrentView(o,e,i,s);r.rowMap.set(e,a),r.rendererCalled=!0}onRenderDone(){var e;const{scheduler:t,rowMap:n,verticalBufferSize:r}=this,i=[],s=null!==(e=t._scrollTop)&&void 0!==e?e:0,o=s-r,a=s+t._bodyRectangle.height+r,l=r<0,c=!t.managedEventSizing;n.forEach(((e,t)=>{if(l||t.bottom>o&&t.top<a)for(let t=0;t<e.length;t++){const n=e[t],r=n.elementData,{absoluteTop:s,eventRecord:d}=r;(l||c||d.meta.isDragCreating||d.meta.isResizing||s+r.height>o&&s<a)&&i.push(n)}for(let t=0;t<e.length;t++)e[t]=f({},e[t])})),this.visibleEventDOMConfigs=i,oa.sync({domConfig:{onlyChildren:!0,children:i},targetElement:t.foregroundCanvas,syncIdField:"syncId",callback({action:e,domConfig:n,lastDomConfig:r,targetElement:i}){var s;if("none"===e||null==n||null===(s=n.elementData)||void 0===s||!s.isWrap)return;const o=rw[e];if(nw[e]&&null!=r&&r.elementData){const{eventRecord:e,resourceRecord:n,assignmentRecord:s}=r.elementData,o={renderData:r.elementData,element:i,eventRecord:e,resourceRecord:n,assignmentRecord:s};i===Mr.getActiveElement(i)&&t.focusElement.focus(),t.trigger("releaseEvent",o)}if(o){const{eventRecord:r,resourceRecord:s,assignmentRecord:o}=n.elementData,a={renderData:n.elementData,element:i,isReusingElement:"reuseElement"===e,isRepaint:"reuseOwnElement"===e,eventRecord:r,resourceRecord:s,assignmentRecord:o};t.trigger("renderEvent",a)}}})}clearResources(e){(e=ke.asArray(e)).map(Hi.asId).forEach((e=>{const t=this.resourceMap.get(e);t&&(t.invalid=!0);const n=this.scheduler.getRowById(e);n&&this.rowMap.delete(n)}))}clearAll({clearDom:e=!1,clearLayoutCache:t=!1}={}){const{layouts:n}=this.scheduler;if(t&&n)for(const e in n)n[e].clearCache();const{foregroundCanvas:r}=this.scheduler;if(r&&e){r.syncIdMap=r.lastDomConfig=null;for(const e of r.children)e.lastDomConfig=e.elementData=null}this.resourceMap.clear(),this.rowMap.clear()}}v(lw,"$name","HorizontalRendering"),lw._$name="HorizontalRendering";class cw extends(xy()){static get defaultConfig(){return{coordProp:"leftFactor",sizeProp:"widthFactor"}}applyLayout(e,t,n,r,i,s){const o=this,a=s.type;return o.packEventsInBands(e,((e,i,s,l)=>{if("none"===a)e.width=t-2*n,e.left+=n;else{e.widthFactor=l;const o=e.leftFactor=s.start+i*l,c=Math.round(1/l),d=o/l,u=t-2*n-r*(c-1);"mixed"===a&&2===c?(e.left+=o*t/5+r,e.width=t-o*t/5-2*r,e.zIndex=5+d):(e.width=l*u,e.left+=o*u+n+r*d)}e.cls["b-sch-event-narrow"]=e.width<o.scheduler.narrowEventWidth}))}}cw._$name="VerticalLayout";const dw={releaseElement:1,reuseElement:1},uw={newElement:1,reuseOwnElement:1,reuseElement:1},hw={startDate:1,endDate:1,duration:1},gw=Object.freeze({});class mw extends(Te.mixin(Zr,Sy)){static get properties(){return{eventMap:new Map,resourceMap:new Map,releasedElements:{},toDrawOnProjectRefresh:new Set,resourceBufferSize:1}}construct(e){this.client=this.scheduler=e,this.verticalLayout=new cw({scheduler:e}),super.construct({})}init(){const e=this,{scheduler:t,resourceColumns:n}=e;n.resourceStore=e.resourceStore,n.on({name:"resourceColumns",columnWidthChange:"onResourceColumnWidthChange",thisObj:e}),e.initialized=!0,t.isPainted&&e.renderer(),n.availableWidth=t.timeAxisSubGridElement.offsetWidth}resolveRowRecord(e,t){const{scheduler:n}=this,r=e.nodeType?null:e,i=r?r.target:e,s=r?[r.borderOffsetX,r.borderOffsetY]:t,o=(i.nodeType===Element.TEXT_NODE?i.parentElement:i).closest(n.eventSelector);if(o)return n.resourceStore.getById(o.dataset.resourceId);if(!i.closest(".b-sch-timeaxis-cell"))return null;if(!s)throw new Error("Vertical mode needs coordinates to resolve this element. Can also be called with a browser\n                event instead of element to extract element and coordinates from");const a=Math.floor(s[0]/this.resourceColumns.columnWidth);return n.resourceStore.getAt(a)}toggleCls(e,t,n=!0,r=!1){var i;const s=null===(i=this.eventMap.get(e.eventId))||void 0===i?void 0:i[e.resourceId];if(s){s.renderData[r?"wrapperCls":"cls"][t]=n;const i=this.client.getElementFromAssignmentRecord(e,r);i&&i.classList[n?"add":"remove"](t)}}getDateFromXY(e,t,n,r=!1){let i=e[1];return n||(i=this.translateToScheduleCoordinate(i)),this.scheduler.timeAxisViewModel.getDateFromPosition(i,t,r)}translateToScheduleCoordinate(e){return e-this.scheduler.timeAxisSubGridElement.getBoundingClientRect().top-globalThis.scrollY}translateToPageCoordinate(e){return e+this.scheduler.timeAxisSubGridElement.getBoundingClientRect().top+globalThis.scrollY}getResourceEventBox(e,t){var n;const r=e.id,i=t.id;let{renderData:s}=(null===(n=this.eventMap.get(r))||void 0===n?void 0:n[i])||gw;var o,a;return s||(this.layoutResource(this.scheduler.resourceStore.getById(i)),s=null===(o=this.eventMap.get(r))||void 0===o||null===(a=o[i])||void 0===a?void 0:a.renderData),s?new xn(s.left,s.top,s.width,s.bottom-s.top):null}getScheduleRegion(e,t,n){var r;const i=this,{scheduler:s}=i,o=xn.from(s.timeAxisSubGridElement,s.timeAxisSubGridElement);e&&(o.left=i.resourceStore.indexOf(e)*s.resourceColumnWidth,o.right=o.left+s.resourceColumnWidth);const a=s.timeAxis.startDate,l=s.timeAxis.endDate,c=(null===(r=s.getDateConstraints)||void 0===r?void 0:r.call(s,e,t))||{start:a,end:l},d=s.getCoordinateFromDate(en.max(a,c.start)),u=s.getCoordinateFromDate(en.min(l,c.end));return n?(o.top=d,o.bottom=u):(o.top=i.translateToPageCoordinate(d),o.bottom=i.translateToPageCoordinate(u)),o}getRowRegion(e,t,n){const{scheduler:r}=this,i=this.resourceStore.indexOf(e)*r.resourceColumnWidth,s=r.timeAxis.startDate,o=r.timeAxis.endDate,a=t?en.max(s,t):s,l=n?en.min(o,n):o,c=r.getCoordinateFromDate(a),d=r.getCoordinateFromDate(l,!0,!0),u=Math.min(c,d),h=Math.abs(c-d);return new xn(i,u,r.resourceColumnWidth,h)}get visibleDateRange(){const e=this.scheduler,t=e.scrollable.y,n=e.scrollable.clientHeight,r=e.getDateFromCoordinate(t)||e.timeAxis.startDate,i=e.getDateFromCoordinate(t+n)||e.timeAxis.endDate;return{startDate:r,endDate:i,startMS:r.getTime(),endMS:i.getTime()}}onResourceColumnWidthChange({width:e,oldWidth:t}){const n=this,{scheduler:r}=n;n.resourceColumns.width=r.timeAxisColumn.width=n.resourceStore.count*e,n.clearAll(),n.refresh(Math.abs(e-t)>30)}attachToProject(e){super.attachToProject(e),e&&e.on({name:"project",refresh:"onProjectRefresh",thisObj:this})}onProjectRefresh(){const e=this,{scheduler:t,toDrawOnProjectRefresh:n}=e;t.isVisible?t.rendered&&!t.refreshSuspended&&(e.refreshAllWhenReady?(e.clearAll(),e.refresh(),e.refreshAllWhenReady=!1):n.size&&e.refresh(),n.clear()):t.whenVisible("refresh",t,[!0])}attachToEventStore(e){super.attachToEventStore(e),this.refreshAllWhenReady=!0,e&&e.on({name:"eventStore",refreshPreCommit:"onEventStoreRefresh",thisObj:this})}onEventStoreRefresh({action:e}){"batch"===e&&(this.refreshAllWhenReady=!0)}onEventStoreChange({action:e,records:t=[],record:n,replaced:r,changes:i,isAssign:s}){const o=this,a=new Set;switch(t.forEach((e=>{e.resources.forEach((e=>a.add(e.id)))})),e){case"sort":case"group":case"move":case"remove":return;case"dataset":return void o.refreshAllResourcesWhenReady();case"add":case"updateMultiple":break;case"replace":r.forEach((([,e])=>{e.resources.map((e=>a.add(e.id)))})),o.clearResources(a);break;case"removeall":case"filter":return o.clearAll(),void o.refresh();case"update":{const e=n.$entity?!Object.keys(i).some((e=>!n.$entity.getField(e))):!Object.keys(i).some((e=>!hw[e]));let t=0;return"startDate"in i&&t++,"endDate"in i&&t++,"duration"in i&&t++,void(e&&!t||(o.clearResources(a),o.refresh()))}}o.refreshResourcesWhenReady(a)}attachToResourceStore(e){const t=this;super.attachToResourceStore(e),t.refreshAllWhenReady=!0,t.resourceColumns&&(t.resourceColumns.resourceStore=e),e.on({name:"resourceStore",changePreCommit:"onResourceStoreChange",refreshPreCommit:"onResourceStoreRefresh",load:()=>t.scheduler.unmaskBody(),thisObj:t,prio:1}),t.initialized&&t.scheduler.isPainted&&(t.firstResource=t.lastResource=null,t.clearAll(),t.renderer())}onResourceStoreChange({source:e,action:t,records:n=[],record:r,replaced:i,changes:s}){const o=this,a=i?i.map((e=>e[1])):n,l=new Set(a.map((e=>e.id)));if(o.firstResource=o.lastResource=null,o.scheduler.isEngineReady){switch(t){case"update":null!=s&&s.id?o.clearResources([s.id.oldValue,s.id.value]):o.clearResources([r.id]);break;case"filter":o.clearAll()}s&&"columnWidth"in s&&o.clearAll(),o.refresh(!0)}else{switch(t){case"dataset":case"remove":case"removeall":return void o.refreshAllResourcesWhenReady();case"replace":case"add":{const t=a.reduce(((t,n)=>Math.min(t,e.indexOf(n))),e.count);for(let n=t;n<e.count;n++)l.add(e.getAt(n).id)}}o.refreshResourcesWhenReady(l)}}onResourceStoreRefresh({action:e}){const t=this;if("group"===e)throw new Error("Grouping of resources not supported in vertical mode");"sort"===e&&(t.firstResource=t.lastResource=null,t.clearAll(),t.refresh())}attachToAssignmentStore(e){super.attachToAssignmentStore(e),this.refreshAllWhenReady=!0,e&&e.on({name:"assignmentStore",changePreCommit:"onAssignmentStoreChange",refreshPreCommit:"onAssignmentStoreRefresh",thisObj:this})}onAssignmentStoreChange({action:e,records:t=[],replaced:n,changes:r}){const i=this,s=new Set(t.map((e=>e.resourceId)));if(i.scheduler.isEngineReady){switch(e){case"remove":i.clearResources(s);break;case"filter":i.clearAll();break;case"update":if("resourceId"in r&&s.add(r.resourceId.oldValue),!Object.keys(r).filter((e=>"resource"!==e&&"event"!==e)).length)return;i.clearResources(s)}i.refresh(!0)}else{switch(r&&"resourceId"in r&&s.add(r.resourceId.oldValue),e){case"removeall":return void i.refreshAllResourcesWhenReady();case"replace":n.forEach((([e,t])=>{s.add(e.resourceId),s.add(t.resourceId)}))}i.refreshResourcesWhenReady(s)}}onAssignmentStoreRefresh({action:e,records:t}){"batch"===e&&(this.clearAll(),this.refreshAllResourcesWhenReady())}refreshRows(e){e&&(this.clearAll(),this.scheduler.refreshFromRerender=!1)}repaintEventsForResource(e){this.renderResource(e)}updateFromHorizontalScroll(e){e!==this.prevScrollX&&(this.renderer(),this.prevScrollX=e)}updateFromVerticalScroll(){this.renderer()}scrollResourceIntoView(e,t){const{scheduler:n}=this,r=n.resourceStore.indexOf(e)*n.resourceColumnWidth;return n.scrollHorizontallyTo(r,t)}onViewportResize(e){this.resourceColumns.availableWidth=e,this.renderer()}get resourceColumns(){return this.scheduler.timeAxisColumn.resourceColumns}onLocaleChange(){this.clearAll()}onDragAbort(){}onBeforeRowHeightChange(){}onTimeAxisViewModelUpdate(){}updateElementId(){}releaseTimeSpanDiv(){}getConnectorStartSide(e){return"top"}getConnectorEndSide(e){return"bottom"}refreshResourcesWhenReady(e){this.clearResources(e),e.forEach((e=>this.toDrawOnProjectRefresh.add(e)))}refreshAllResourcesWhenReady(){this.clearAll(),this.refreshAllWhenReady=!0}get resourceRange(){return this.getResourceRange(!0)}get visibleResources(){const{first:e,last:t}=this.getResourceRange();return{first:this.resourceStore.getAt(e),last:this.resourceStore.getAt(t)}}getResourceRange(e){const{scheduler:t,resourceStore:n}=this,{resourceColumnWidth:r,scrollX:i}=t,{scrollWidth:s}=t.timeAxisSubGrid.scrollable,o=e?this.resourceBufferSize:0,a=i-o,l=i+s+o;if(null==n||!n.count)return{first:-1,last:-1};if(t.variableColumnWidths){let e,r,i,s=0;return n.forEach(((n,o)=>{if(n.instanceMeta(t).insetStart=i=s,s=i+n.columnWidth,i>l)return!1;s>a&&null==e?e=o:i<l&&(r=o)})),{first:e,last:r}}return{first:Math.max(Math.floor(i/r)-o,0),last:Math.min(Math.floor((i+t.timeAxisSubGrid.width)/r)+o,n.count-1)}}get dateRange(){const{scheduler:e}=this;let t=e.getDateFromCoordinate(Math.min(e.scrollTop+e.bodyHeight+e.tickSize-1,(e.virtualScrollHeight||e.scrollable.scrollHeight)-1));t||(t=e.timeAxis.last.endDate);let n=e.getDateFromCoordinate(Math.max(e.scrollTop-e.tickSize,0));return n||(n=e.timeAxis.first.startDate,t=e.getDateFromCoordinate(e.bodyHeight+e.tickSize-1)),{topDate:n,bottomDate:t}}getTimeSpanRenderData(e,t,n=!1){var r;const i=this,{scheduler:s}=i,{preamble:o,postamble:a}=e,{variableColumnWidths:l}=s,c=(null===(r=s.features.eventBuffer)||void 0===r?void 0:r.enabled)&&i.isProVerticalRendering&&(o||a)&&!e.isMilestone,d=c?"wrapStartDate":"startDate",u=c?"wrapEndDate":"endDate",h=e.isBatchUpdating&&e.hasBatchedChange(d)&&!c?e.get(d):e[d],g=e.isBatchUpdating&&e.hasBatchedChange(u)&&!c?e.get(u):e[u],m=s.getResourceMargin(t),p=s.getCoordinateFromDate(h),f=t.instanceMeta(s),v=l?f.insetStart:i.resourceStore.indexOf(t)*s.resourceColumnWidth,y=s.getResourceWidth(t),b=y-2*m,C=h.getTime(),w=g.getTime();let S=s.getCoordinateFromDate(g),D=S-p;return-1===S&&(D=Math.round((w-C)*s.timeAxisViewModel.getSingleUnitInPixels("millisecond")),S=p+D),{eventRecord:e,resourceRecord:t,left:v,top:p,bottom:S,resourceWidth:y,width:b,height:D,startDate:h,endDate:g,startDateMS:C,endDateMS:w,useEventBuffer:c,children:[],start:h,end:g,startMS:C,endMS:w}}eventSorter(e,t){const n=e.dataStartMs||e.startDateMS,r=e.dataEndMs||e.endDateMS,i=t.dataStartMs||t.startDateMS,s=t.dataEndMs||t.endDateMS,o=e.isModel?e.name:e.eventRecord.name,a=t.isModel?t.name:t.eventRecord.name;return n-i||s-r||(o<a?-1:o==a?0:1)}layoutResource(e){const t=this,{scheduler:n}=t,{variableColumnWidths:r}=n,{id:i}=e,s=e.instanceMeta(n),{assignmentStore:o,eventStore:a,timeAxis:l}=n,c=t.resourceMap.set(i,{}).get(i),d=n.resourceStore.indexOf(e),{barMargin:u,resourceMargin:h}=n.getResourceLayoutSettings(e);let g=a.getEvents({includeOccurrences:n.enableRecurringEvents,resourceRecord:e,startDate:l.startDate,endDate:l.endDate,filter:(o.isFiltered||a.isFiltered)&&(t=>t.assignments.some((t=>t.resource===e&&o.includes(t))))});g=n.getEventsToRender(e,g);const m=g.reduce(((o,a)=>{if(a.isScheduled){const l=n.generateRenderData(a,e,!1),u={renderData:l};sn.getMapPath(t.eventMap,l.eventId,{})[i]=u,c[l.eventId]=u,l.fillSize?(l.left=r?s.insetStart:d*n.resourceColumnWidth,l.width=n.getResourceWidth(e)):o.push(l)}return o}),[]);return m.sort(t.eventSorter),t.verticalLayout.applyLayout(m,n.getResourceWidth(e),h,u,d,n.getEventLayout(e)),c}addTemporaryDragElement(e){const{scheduler:t}=this,n=t.generateRenderData(e,e.resource,{timeAxis:!0,viewport:!0});n.top=n.row?n.top+n.row.top:t.getResourceEventBox(e,e.resource,!0).top;const r=this.renderEvent({renderData:n}),{dataset:i}=r;delete r.tabIndex,delete i.eventId,delete i.resourceId,delete i.assignmentId,delete i.syncId,i.transient=!0,r.parent=this.scheduler.foregroundCanvas,r.retainElement=!0;const s=Mr.createElement(r);return s.innerElement=s.firstChild,e.instanceMeta(t).hasTemporaryDragElement=!0,s}renderEvent(e){const{scheduler:t}=this,n=e.renderData,{resourceRecord:r,assignmentRecord:i,eventRecord:s}=n,o={className:n.wrapperCls,tabIndex:-1,children:[{className:n.cls,style:(n.internalStyle||"")+(n.style||""),children:n.children,dataset:{taskFeature:"event"},syncOptions:{syncIdField:"taskBarFeature"}},...n.wrapperChildren],style:{top:n.top,[t.rtl?"right":"left"]:n.left,height:s.isMilestone?"1em":n.height,width:n.width,style:n.wrapperStyle||"",fontSize:s.isMilestone?Math.min(n.width,40):null},dataset:{resourceId:r.id,eventId:n.eventId,syncId:i?this.assignmentStore.getOccurrence(i,s).id:n.eventId},elementData:e,retainElement:(i||s).instanceMeta(this.scheduler).retainElement,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}};return o.className["b-sch-vertical"]=1,n.zIndex&&(o.zIndex=n.zIndex),i&&(o.dataset.assignmentId=i.id),this.scheduler.trigger("beforeRenderEvent",{renderData:n,domConfig:o}),e.elementConfig=o,o}renderResource(e){const t=this,{topDateMS:n,bottomDateMS:r}=t,i=[];let s=t.resourceMap.get(e.id);s||(s=t.layoutResource(e));for(const e in s){const o=s[e],{endDateMS:a,startDateMS:l,eventRecord:c}=o.renderData;a>=n&&l<=r&&!c.instanceMeta(t.scheduler).hasTemporaryDragElement&&i.push(t.renderEvent(o))}return i}isEventElement(e){const t=e&&e.className;return t&&t[this.scheduler.eventCls+"-wrap"]}renderer(){const e=this,{scheduler:t}=e,{resourceStore:n}=t,{first:r,last:i}=e.resourceRange,{topDate:s,bottomDate:o}=e.dateRange,a=[],l=[];if(e.initialized&&(t.isEngineReady||t.isCreating)){if(!en.isEqual(s,e.topDate)||!en.isEqual(o,e.bottomDate)){e.topDate=s,e.bottomDate=o,e.topDateMS=s.getTime(),e.bottomDateMS=o.getTime();const n=e.timeView.range={startDate:s,endDate:o};t.onVisibleDateRangeChange(n)}if(-1!==r&&-1!==i)for(let t=r;t<=i;t++)a.push.apply(a,e.renderResource(n.getAt(t)));if(t.getForegroundDomConfigs(l),a.push.apply(a,l),oa.sync({domConfig:{onlyChildren:!0,children:a},targetElement:t.foregroundCanvas,syncIdField:"syncId",callback({action:n,domConfig:r,lastDomConfig:i,targetElement:s}){if(e.isEventElement(r)){const o=uw[n];if(dw[n]&&e.isEventElement(i)&&!i.isReleased){const e=i.elementData.renderData,n={renderData:e,assignmentRecord:e.assignmentRecord,eventRecord:e.eventRecord,resourceRecord:e.resourceRecord,element:s};s===Mr.getActiveElement(s)&&t.focusElement.focus(),t.trigger("releaseEvent",n)}if(o){const e=r.elementData.renderData,i={renderData:e,assignmentRecord:e.assignmentRecord,eventRecord:e.eventRecord,resourceRecord:e.resourceRecord,element:s,isReusingElement:"reuseElement"===n,isRepaint:"reuseOwnElement"===n};i.reusingElement="reuseElement"===n,t.trigger("renderEvent",i)}}}}),e.firstResource!==r||e.lastResource!==i){const n=e.resourceColumns.visibleResources={firstResource:r,lastResource:i};e.firstResource=r,e.lastResource=i,t.onVisibleResourceRangeChange(n),t.trigger("resourceRangeChange",n)}}}refresh(e){this.scheduler.runWithTransition((()=>this.renderer()),e)}refreshResources(e){this.clearResources(e),this.refresh()}refreshEventsForResource(e,t=!0,n=!0){this.refreshResources([e.id])}onRenderDone(){}get timeView(){return this.scheduler.timeView}clearResources(e){const{resourceMap:t,eventMap:n}=this;e.forEach((e=>{t.has(e)&&(Object.values(t.get(e)).forEach((({renderData:{eventId:t}})=>{delete n.get(t)[e]})),t.delete(e))}))}clearAll(){this.resourceMap.clear(),this.eventMap.clear()}}mw._$name="VerticalRendering";const pw={month:"MMMM, YYYY",week:["MMMM YYYY (Wp)","S{MMM} - E{MMM YYYY} (S{Wp})"],day:"MMMM D, YYYY"};class fw extends(FC.mixin(Kf,HC,BC,jC,zC,YC,KC,VC,GC,XC,tw,$C)){static get $name(){return"SchedulerBase"}static get type(){return"schedulerbase"}static get configurable(){return{date:{value:null,$config:{equal:"date"}},stepUnit:"week",range:"week",getDateConstraints:null,verticalTimeAxisColumn:{},createEventOnDblClick:!0,schedulableAreaSelector:".b-sch-timeaxis-cell",scheduledEventName:"event"}}static get defaultConfig(){return{mode:"horizontal",eventCls:"b-sch-event",timeCellCls:"b-sch-timeaxis-cell",overScheduledEventClass:"b-sch-event-hover",allowOverlap:!0,rowHeight:60,preCalculateHeightLimit:1e4,crudManagerClass:py,testConfig:{loadMaskError:{autoClose:10,showDelay:0}}}}afterConstruct(){const e=this;super.afterConstruct(),e.on("scroll",e.onVerticalScroll,e),e.createEventOnDblClick&&e.on("scheduledblclick",e.onTimeAxisCellDblClick)}onPaintOverride(){}get store(){return super.store}set store(e){super.store=e}get visibleResources(){var e,t;const n=this;return n.isVertical?n.currentOrientation.visibleResources:{first:n.store.getById(null===(e=n.firstVisibleRow)||void 0===e?void 0:e.id),last:n.store.getById(null===(t=n.lastVisibleRow)||void 0===t?void 0:t.id)}}onLocaleChange(){this.currentOrientation.onLocaleChange(),super.onLocaleChange()}onTimeAxisCellDblClick({date:e,resourceRecord:t,row:n}){this.readOnly||t.isSpecialRow||t.readOnly||this.createEvent(e,t,n)}onVerticalScroll({scrollTop:e}){this.currentOrientation.updateFromVerticalScroll(e)}onEventCreated(e){}get isHorizontal(){return"horizontal"===this.mode}get isVertical(){return"vertical"===this.mode}get mode(){return this._mode}set mode(e){const t=this;t._mode=e,t[e]||(t.element.classList.add(`b-sch-${e}`),"horizontal"===e?(t.horizontal=new lw(t),t.isPainted&&t.horizontal.init()):"vertical"===e&&(t.vertical=new mw(t),t.rendered&&t.vertical.init()))}get currentOrientation(){return this[this.mode]}onElementKeyDown(e){return super.onElementKeyDown(e)}onElementKeyUp(e){return super.onElementKeyUp(e)}onElementMouseOver(e){return super.onElementMouseOver(e)}onElementMouseOut(e){return super.onElementMouseOut(e)}processEventDrop(){}processCrossSchedulerEventDrop(){}beforeEventDragStart(){}afterEventDragStart(){}afterEventDragAbortFinalized(){}checkEventDragValidity(){}afterEventResizeStart(){}get hasEventEditor(){const{eventEdit:e,taskEdit:t,simpleEventEdit:n}=this.features;return Boolean((null==e?void 0:e.enabled)||(null==t?void 0:t.enabled)||(null==n?void 0:n.enabled))}editEvent(e,t,n){const r=this,{eventStore:i,assignmentStore:s}=r;if(!r.hasEventEditor)return!1;if(e.eventStore!==i){const{enableEventAnimations:n}=r,o=[];e.isCreating=!0;let a=[];if(t&&(o.push(t),a=s.assignEventToResource(e,t)),!1===r.trigger("beforeEventAdd",{eventRecord:e,resourceRecords:o,assignmentRecords:a}))return null==s||s.remove(a),!1;r.enableEventAnimations=!1,i.add(e),r.project.commitAsync().then((()=>r.enableEventAnimations=n)),r.refreshRows()}}async createEvent(e,t){var n,r,i;const s=this,{enableEventAnimations:o,features:a,eventStore:l,assignmentStore:c}=s,d=[t],u=s.createEventOnDblClick.useEventModelDefaults,h=u?l.modelClass.defaultValues.duration:1,g=u?l.modelClass.defaultValues.durationUnit:s.timeAxis.unit,m=l.createRecord({startDate:e,endDate:en.add(e,h,g),duration:h,durationUnit:g,name:s.L("L{Object.newEvent}")}),p=Boolean((null===(n=a.eventEdit)||void 0===n?void 0:n.enabled)||(null===(r=a.taskEdit)||void 0===r?void 0:r.enabled)||(null===(i=a.simpleEventEdit)||void 0===i?void 0:i.enabled));if(s.readOnly||t.isSpecialRow||!s.allowOverlap&&!s.isDateRangeAvailable(m.startDate,m.endDate,null,t))return;m.isCreating=p,s.onEventCreated(m);const f=null==c?void 0:c.assignEventToResource(m,t);!1!==s.trigger("beforeEventAdd",{eventRecord:m,resourceRecords:d,assignmentRecords:f})?(s.enableEventAnimations=!1,l.add(m),s.project.commitAsync().then((()=>s.enableEventAnimations=o)),s.isCreating=!0,s.refreshRows(),s.isCreating=!1,s.trigger("eventAutoCreated",{eventRecord:m,resourceRecord:t}),p&&s.editEvent(m,t,s.getEventElement(m))):null==c||c.remove(f)}isDateRangeAvailable(e,t,n,r){return this.eventStore.isDateRangeAvailable(e,t,n,r)}async resumeRefresh(e){super.resumeRefresh(!1);const t=this;if(!t.refreshSuspended&&e){if(!t.isEngineReady)return t.currentOrientation.refreshAllWhenReady=!0,t.project.commitAsync();t.isDestroyed||t.refreshWithTransition()}}toggleEmptyText(){const e=this;var t;e.bodyContainer&&Mr.toggleClasses(e.bodyContainer,"b-grid-empty",!(e.resourceStore.count>0||null!==(t=e.crudManager)&&void 0!==t&&t.isLoading))}getRowHeight(e){if(this.isHorizontal){const t=this.currentOrientation.calculateRowHeight(e);return this.rowManager.storeKnownHeight(e.id,t),t}}calculateRowHeights(e,t=!1){e.forEach((e=>e&&this.getRowHeight(e))),t||this.rowManager.estimateTotalHeight(!0)}calculateAllRowHeights(e=!1){const{store:t,rowManager:n}=this,r=Math.min(t.count,this.preCalculateHeightLimit);if(r){n.clearKnownHeights();for(let e=0;e<r;e++)this.getRowHeight(t.getAt(e));e||n.estimateTotalHeight(!0)}}get dateBounds(){const e=this,t=[e.startDate];return"week"===e.range&&t.push(e.lastDate),t}get defaultDescriptionFormat(){return pw[this.range]}get lastDate(){const e=this.endDate;return e&&en.add(e,-1,"day")}getEventRecord(e){return e=Mr.getEventElement(e),this.resolveEventRecord(e)}getEventElement(e){return this.getElementFromEventRecord(e)}changeRange(e){return en.normalizeUnit(e)}updateRange(e){if(!this.isConfiguring){const t=this.date,n=this.date=en.startOf(t,e);t.getTime()===n.getTime()&&this.updateDate(n)}}changeStepUnit(e){return en.normalizeUnit(e)}updateDate(e){const t=this,n=en.startOf(e,t.range);t.setTimeSpan(n,en.add(n,1,t.range)),t.visibleDate={date:en.max(e,t.timeAxis.startDate),block:"start",animate:!0},t.trigger("descriptionChange")}previous(){this.date=en.add(this.date,-1,this.stepUnit)}next(){this.date=en.add(this.date,1,this.stepUnit)}async scheduleEvent({startDate:e,eventRecord:t,resourceRecord:n,element:r}){const i=this;if(i.eventStore.includes(t)||([t]=i.eventStore.add(t)),t.startDate=e,t.assign(n),r){const e=xn.from(r,i.foregroundCanvas);Mr.setTranslateXY(r,0,0),Mr.setTopLeft(r,e.y,e.x),oa.addChild(i.foregroundCanvas,r,t.assignments[0].id)}await i.project.commitAsync()}}v(fw,"properties",{timeCellSelector:".b-sch-timeaxis-cell",resourceTimeRangeSelector:".b-sch-resourcetimerange"}),fw.initClass(),fw._$name="SchedulerBase";class vw extends(pt(bm)){static get defaultConfig(){return{includeUnassigned:!0,eventColumns:[{text:"Task",field:"name"},{text:"Starts",field:"startDate",width:140},{text:"Ends",field:"endDate",width:140}],eventSortFn:null}}construct(e={},...t){super.construct(e,...t),this.eventSortFn||(this.eventSortFn=(e,t)=>e.internalId-t.internalId)}normalizeColumns(e){super.normalizeColumns(e),e.eventColumns=e.eventColumns.map((e=>"string"==typeof e?{field:e}:e))}generateExportData(e){const t=this,n=this.target instanceof fw,r=t.generateColumns(e),i=n?t.generateEventColumns(e):[];return{columns:r.concat(i),rows:t.generateRows(e)}}generateEventColumns(e){return e.eventColumns.map((t=>this.processEventColumn(t,e)))}processEventColumn(e,t){const{width:n,minWidth:r}=e,{defaultColumnWidth:i}=t;return{field:e.field,value:e.text,width:Math.max(n||i,r||i),eventColumn:!0,type:this.getColumnType(e,this.target.eventStore)}}generateRows(e){const t=this,{target:n}=t;let r;if(n instanceof fw){if(r=[],n.resourceStore.map((n=>{const i=n.events||[];i.sort(t.eventSortFn),i.length||i.push(""),i.forEach((i=>r.push(t.getRowData(e,n,i))))})),e.includeUnassigned&&e.eventColumns.length){const i=n.eventStore.query((e=>!e.resources.length));if(i.length){const n=new Array(e.columns.length).fill("");n.push(t.L("L{ExcelExporter.No resource assigned}")),r.push(n),i.forEach((n=>r.push(t.getRowData(e,null,n))))}}r=r.filter((e=>e.length))}else r=super.generateRows(e);return r}getRowData(e,t,n){const{columns:r,eventColumns:i}=e,s=[],o=this.processRecord(t,r,e);if(o&&s.push(...o),!t||!t.isSpecialRow){const t=this.processRecord(n,i,e);t&&s.push(...t)}return s}}vw._$name="ScheduleTableExporter";class yw extends wm{static get $name(){return"ExcelExporter"}static get defaultConfig(){return{exporterClass:vw,exporterConfig:null}}}yw._$name="ExcelExporter",vg.registerFeature(yw,!1,"Scheduler");class bw extends fw{static get $name(){return"Scheduler"}static get type(){return"scheduler"}}bw.initClass(),bw._$name="Scheduler";class Cw extends Eu{static get $name(){return"ProjectCombo"}static get type(){return"projectcombo"}static get configurable(){return{project:null,displayField:"title",valueField:"url",highlightExternalChange:!1,editable:!1}}updateProject(e){var t;null!==(t=e.transport.load)&&void 0!==t&&t.url&&(this.value=e.transport.load.url)}onChange({value:e,userAction:t}){t&&this.project&&(this.project.transport.load.url=e,this.project.load())}}Cw.initClass(),Cw._$name="ProjectCombo";class ww extends Cu{static get $name(){return"ResourceFilter"}static get type(){return"resourcefilter"}static get delayable(){return{applyFilter:"raf"}}static get configurable(){return{eventStore:null,multiSelect:!0,toggleAllIfCtrlPressed:!0,itemTpl:e=>_.encodeHtml(e.name||""),masterFilter:()=>!0}}itemIconTpl(e,t){const{eventColor:n}=e,r=Mr.isNamedColor(n)?` b-sch-foreground-${n}`:"",i=!r&&n?` style="color:${n}"`:"";return this.multiSelect?`<div class="b-selected-icon b-icon${r}"${i}></div>`:""}updateEventStore(e){var t,n;const r=this,i=null!==(t=r.initialConfig.store)&&void 0!==t&&t.isStore?r.initialConfig.store.initialConfig:null===(n=r.store)||void 0===n?void 0:n.config,{resourceStore:s}=e,o=r.store=s.chain(r.masterFilter,null,f(f({},i),{},{syncOrder:!0})),a={change:"onStoreChange",thisObj:r};o.un(a),s.on(a),s.count?r.initFilter():s.project.on({name:"project",refresh:"initFilter",thisObj:r})}changeMasterFilter(e){const t=this;return function(n){return e.call(t,n)}}initFilter(){const{eventStore:e,selected:t}=this;e.count&&e.resourceStore.count&&(this.initialSelection||t.add(this.store.getRange()),this.detachListeners("project"))}onStoreRefresh({source:e,action:t}){if("filter"===t&&this.resourceFilter){const{resourceFilter:t}=this,{disabled:n}=t,r=!e.isFiltered&&this.allSelected;r!==n&&(t.disabled=r,this.applyFilter())}super.onStoreRefresh(...arguments)}onSelectionChange({source:e,added:t,removed:n}){const r=this,i=!r.store.isFiltered&&r.allSelected;if(super.onSelectionChange(...arguments),r.resourceFilter){if(r.resourceFilter.disabled=i,r.applyFilter(),r.eventListeners.change){const i=e.values,s=i.concat(n);ke.remove(s,t),r.triggerFieldChange({value:i,oldValue:s})}}else r.resourceFilter=r.eventStore.addFilter({id:`${r.id}-filter-instance`,filterBy:e=>!e.resource||r.selected.includes(e.resources),disabled:i},!0)}get value(){return this.selected.values}applyFilter(){this.eventStore.filter()}}ww.initClass(),ww._$name="ResourceFilter";class Sw extends $u{static get $name(){return"SchedulerDatePicker"}static get type(){return"datepicker"}static get configurable(){return{showEvents:null,eventStore:null}}construct(e){"events"in e&&(delete(e=f(f({},e),{},{showEvents:e.events})).events,K.deprecate(K.calendar?"Calendar":"Scheduler","6.0.0","DatePicker#events should be configured as showEvents")),super.construct(e)}doRefresh(){return this.refreshEventsMap(),super.doRefresh(...arguments)}updateShowEvents(e,t){const n=this,{classList:r}=n.contentElement;let{eventStore:i}=n;if(n.requestAnimationFrame((()=>{var i;n.element.classList.toggle("b-datepicker-with-events",Boolean(e)),null===(i=n.owner)||void 0===i||i.element.classList.toggle("b-datepicker-with-events",Boolean(e)),e&&r.add(`b-show-events-${e}`),r.remove(`b-show-events-${t}`)})),e){if(!i){const e=n.up((e=>e.eventStore));if(!e)throw new Error("DatePicker configured with events but no eventStore");i=e.eventStore}}else n.eventsMap=null;n.isConfiguring||(n.updateEventStore(i),n.doRefresh())}refreshEventsMap(){const e=this;e.showEvents&&(e.eventsMap=e.eventStore.getEventCounts({startDate:e.startDate,endDate:e.endDate,dateMap:e.eventsMap}))}updateEventStore(e){var t;-1===e.findListener("change","refresh",this)&&(null==e||null===(t=e[this.showEvents?"on":"un"])||void 0===t||t.call(e,{change:"refresh",thisObj:this}))}cellRenderer({cell:e,date:t}){var n,r;const{showEvents:i}=this,s=null===(n=this.eventCounts)||void 0===n||null===(r=n.get)||void 0===r?void 0:r.call(n,en.makeKey(t));s&&Mr.createElement({dataset:{count:s},class:{["count"===i?"b-cell-events-badge":"b-icon b-icon-circle"]:1,[Sw.getEventCountClass(s)]:1},parent:e,["count"===i?"text":""]:s})}static getEventCountClass(e){return e?e<4?"b-datepicker-1-to-3-events":e<7?"b-datepicker-4-to-6-events":"b-calendar-7-or-more-events":""}static setupClass(e){e.replaceType=!0,super.setupClass(e)}}Sw.initClass(),Sw._$name="SchedulerDatePicker";const Dw=e=>e.isProjectConsumer;class Ew extends Ru{static get $name(){return"UndoRedo"}static get type(){return"undoredo"}static get configurable(){return{scheduler:null,project:null}}construct(){super.construct(...arguments),this.stm||(this.scheduler=this.up(Dw))}changeScheduler(e){return e.isProjectConsumer?e:Ew.getById(e)}updateScheduler(e){const{crudManager:t}=e;t?t.on({load:"onCrudManagerLoad",thisObj:this}):this.onCrudManagerLoad(),this.stm=e.project.stm}async onCrudManagerLoad(){await this.scheduler.project.commitAsync(),this.isDestroyed||(this.stm.enable(),this.fillUndoRedoCombo())}}Ew.initClass(),Ew._$name="UndoRedo";class xw extends Eu{construct(){super.construct(...arguments),this.scheduler.on({presetchange:this.onClientPresetChange,thisObj:this})}get scheduler(){return this.client||this.up((e=>e.isTimelineBase))||Ka.query((e=>e.isTimelineBase))}updatePresets(e){this.store=this.scheduler.presets.chain((t=>e.includes(t.id))),this.store.sort(((t,n)=>e.indexOf(t.id)-e.indexOf(n.id)))}onClientPresetChange({preset:e}){const t=this;t._isSelecting||(t.isSettingValue=!0,t.store.includes(e.id)?t.value=e:t.clear(),t.isSettingValue=!1)}onSelect({record:e}){if(!this.isSettingValue){const{scheduler:n}=this,{mainUnit:r,start:i,defaultSpan:s}=e;if(n.suspendRefresh(),this._isSelecting=!0,n.viewPreset=e,this._isSelecting=!1,r&&s){let o=r;var t;i&&"string"==typeof i&&(o=null!==(t=en.parseTimeUnit(i))&&void 0!==t?t:i);let a=en.startOf(n.startDate,o);e.start&&"number"==typeof i&&(a=en.add(a,i,r));const l=en.add(a,s,r);n.setTimeSpan(a,l)}n.scrollLeft=0,n.resumeRefresh(!0)}}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue()}}v(xw,"$name","ViewPresetCombo"),v(xw,"type","viewpresetcombo"),v(xw,"configurable",{presets:["hourAndDay","weekAndDay","dayAndMonth"],client:null,editable:!1,valueField:"id",displayField:"name",placeholder:"Select view"}),xw.initClass(),xw._$name="ViewPresetCombo";class Rw extends Kh{static get type(){return"agendacolumn"}static get defaults(){return{id:"agenda",text:"Agenda",filterable:!1,sortable:!1,editor:!1,searchable:!1,autoHeight:!1}}construct(){super.construct(...arguments),this.grid.on({beforeResponsiveStateChange:"onBeforeGridResponsiveStateChange",thisObj:this})}defaultRenderer({cellElement:e,record:t,grid:n,size:r}){var i;const s=this,{events:o,date:a}=t,l=[];for(let e=0;e<o.length;e++){const r=o[e],i=r.endDate||en.add(r.startDate,r.duration,r.durationUnit),s=r.startDate<a,c=i>t.tomorrow,d=n.createEventDomConfig({date:t.date,isAllDay:r.allDay||c||s,eventRecord:r});d.className["b-continues-future"]=c,d.className["b-continues-past"]=s,l.push({className:{"b-cal-agenda-event-row":1},dataset:{rowId:r.id},children:[n.eventListEventTimeRenderer(r,a),d],syncOptions:{syncIdField:"rowId",releaseThreshold:0,strict:!0}})}if(null===(i=n._cellRenderer)||void 0===i||i.call(n,...arguments),e.classList[t.isNonWorking?"add":"remove"](n.nonWorkingDayCls),oa.sync({domConfig:{onlyChildren:!0,children:[n.agendaEventDateRenderer(a),{className:{"b-cal-event-bar-container":1},children:l}],syncOptions:{syncIdField:"date",releaseThreshold:0,strict:!0}},targetElement:e}),e.dataset.date=t.id,!s.autoHeight){const i=e.querySelector(".b-cal-agenda-date"),o=s._cellTbPadding||(s._cellTbPadding=Mr.getEdgeSize(e,"padding","tb").height),a=s._containerPadding||(s._containerPadding=Mr.getEdgeSize(e.querySelector(".b-cal-event-bar-container"),"margin","tb").height),l=s._dateBlockHeight||(s._dateBlockHeight=xn.outer(i).height);r.height=Math.max(t.events.length*(n.eventHeightInPixels+n.eventRowSpacing)-n.eventRowSpacing+o+a+("small"===n.responsiveState?l:0),86)}}onBeforeGridResponsiveStateChange(){this._cellTbPadding=this._containerPadding=this._dateBlockHeight=this._dateBlockHeight=null}getCellClass(e){const t=super.getCellClass(e);return t["b-sticky-cell"]=t[`b-day-of-week-${e.record.day}`]=1,t}headerRenderer({headerElement:e}){e.innerHTML="",oa.sync({domConfig:{className:{"b-cal-agenda-header":1,"b-grid-header":1,"b-last-leaf":1},children:[{className:{"b-cal-agenda-header-date":1},text:"Date"},{className:{"b-cal-agenda-header-time":1},text:"Time"},{className:{"b-cal-agenda-header-event":1},text:"Event"}]},targetElement:e})}}v(Rw,"$name","AgendaColumn"),Jh.registerColumnType(Rw),Rw._$name="AgendaColumn";class Tw extends Kh{static get type(){return"calendarevents"}static get defaults(){return{id:"calendarevents",text:"Event Details",filterable:!1,sortable:!1,editor:!1,searchable:!1,autoHeight:!0}}renderer({cellElement:e,record:t,grid:n}){var r,i;const s=null===(r=n.calendar)||void 0===r?void 0:r.widgetMap.resourceFilter,o=s?t.resources.filter((e=>s.selected.includes(e))):t.resources;null===(i=n._cellRenderer)||void 0===i||i.call(n,...arguments),n.showResourceAvatars=!0,oa.sync({domConfig:{onlyChildren:!0,children:[{class:"b-cal-event-resource-avatars",children:o.map((e=>({class:"b-cal-event-resource-avatar-row",children:[n.getResourceAvatar(e),{class:"b-cal-event-resource-avatar-desc",children:[{class:"b-event-column-resource-name",text:e.name},{class:"b-event-column-resource-role",text:e.role}]}]})))},{class:"b-cal-event-column-event-desc",children:[{class:"b-cal-event-column-event-name",text:t.name}]},{class:"b-cal-event-column-times",children:[n.eventListEventTimeRenderer(t)]}],syncOptions:{syncIdField:"date",releaseThreshold:0,strict:!0}},targetElement:e})}}Jh.registerColumnType(Tw),Tw.exposeProperties(),Tw._$name="EventColumn";class Mw extends(Wr.mixin(Ci)){static get factoryable(){return{}}static get configurable(){return{clientListeners:{paint:"onCalendarPaint"},disableOnReadOnly:null}}updateDisableOnReadOnly(e){const t=this,{client:n}=t,r="readonlyToggle",i="onClientReadOnlyToggle";e?(t[i]({readOnly:n.readOnly}),n.on({name:r,readOnly:i,thisObj:t})):t.detachListeners(r)}doDestroy(){this.syncModes(),super.doDestroy()}createZone(e,t){return new e(f({owner:this},t))}onClientReadOnlyToggle({readOnly:e}){this.disabled=e}updateDisabled(e,t){super.updateDisabled(e,t),this.client.isPainted&&this.syncModes()}onCalendarPaint({firstPaint:e}){e&&this.syncModes()}syncModes(){const e=this,{client:t,_modeDetacher:n,zones:r}=e;let i,s,o,a,l,c=null;if(e.disabled||e.isDestroying||!e.getViewZoneType)null==n||n();else for(s in t.isCalendar?(n||(e._modeDetacher=t.on({addMode:()=>e.syncModes()})),i=t.modes):i={view:t},i){var d;l=null==r?void 0:r[s],o=i[s],a=e.getViewZoneType(o),a&&((sn.isObject(l)?l.type:null===(d=l)||void 0===d?void 0:d.constructor)===a?delete r[s]:l=o.isPainted?e.createZone(a,{view:o}):e.whenPainted(s,o,a),(c||(c={}))[s]=l)}if(e.zones=c,r)for(s in r)r[s].destroy()}whenPainted(e,t,n){const r=this,i={type:n,destroy:t.on({once:!0,prio:1e4,paint(){r.zones[e]===i&&(r.zones[e]=r.createZone(n,{view:t}))}})};return i}}Mw._$name="CalendarFeature";const kw=e=>e.eventStore;class Iw extends lu{static get $name(){return"EventTip"}static get type(){return"eventtip"}static get configurable(){return{align:{monitorResize:!0},dateFormat:"ll",eventRecord:{$config:"nullify",value:null},recurrenceHint:"",timeFormat:"LST",axisLock:"flexible",closable:null,forSelector:".b-cal-event-wrap",maxWidth:"30em",minWidth:"14em",scrollAction:"realign",cls:{"b-sch-event-tooltip":1},tools:{edit:{cls:"b-icon-edit",handler:"up.onEditClick",tooltip:"L{EventEdit.Edit event}",weight:100},delete:{cls:"b-icon-trash",handler:"up.onDeleteClick",tooltip:"L{SchedulerBase.Delete event}",weight:0},maximize:null},titleRenderer:e=>_.encodeHtml(e.name),extendAllDayEndDay:null,activeClient:null}}static get delayable(){return{refreshContent:20}}static get properties(){return{clockTemplate:new My({})}}get owner(){return lu.fromElement(this.activeTarget)||this.ownerFeature.client}onEditClick(){this.trigger("edit")}onDeleteClick(){this.trigger("delete")}getHtml(e){const t=this,{eventRecord:n}=t;if(n)return e.eventRecord=n,t.title=t.titleRenderer?t.callback(t.titleRenderer,t,[n]):"",t.callback(t.renderer||t.internalRenderer,t,[f(f({},e),{},{eventRecord:n})])}internalRenderer({eventRecord:e}){const{clockTemplate:t,dateFormat:n,recurrenceHint:r,timeFormat:i}=this,{allDay:s,endDate:o,startDate:a,recurrence:l}=e,c=s?this.extendAllDayEndDay?en.ceil(o,"1 day"):en.add(o,-1,"day"):o,d=en.clearTime(a),u=en.clearTime(c),h=d<u,g=!s&&d<a||u<c?h?`${n} ${i}`:i:n,m=l?wy.getLegend(l):r,p=en.formatDelta(en.diff(a,o),s?{precision:"d"}:null),f=e.isMilestone||s&&!h;return t.mode=h?"day":"hour",t.template({date:a,text:en.format(a,g),cls:"b-sch-tooltip-startdate"})+(f?"":t.template({date:c,text:en.format(c,g),cls:"b-sch-tooltip-enddate"}))+(e.isMilestone?"":`<div class="b-cal-tooltip-duration b-icon b-icon-duration">${p}</div>`)+(m?`<div class="b-cal-tooltip-recurrence b-icon b-icon-recurring">${m}</div>`:"")}showByEvent(e,t=e.target){const n=this;return n.activeTarget=t,n.pointerEvent=e,n.updateContent(),"contextmenu"===e.type?n.showBy({position:{x:e.clientX,y:e.clientY},anchor:!1}):n.showBy(t)}afterShowByTarget(){var e;const{delete:t}=this.tools;this.activeClient=null===(e=lu.fromElement(this.activeTarget))||void 0===e?void 0:e.closest(kw),super.afterShowByTarget(),t&&(t.disabled=this.ownerFeature.client.readOnly)}afterHide(){super.afterHide(...arguments),this.activeClient=null}refreshContent(){this.updateContent()}updateEventRecord(e){var t;const n=this;null===(t=n._changeHook)||void 0===t||t.call(n),n._changeHook=e&&$e.after(e,"afterChange",n.refreshContent,n),e&&(n.tools.delete&&(n.tools.delete.hidden=e.readOnly),n.tools.edit&&(n.tools.edit.hidden=e.readOnly),n.updateContent())}updateContent(){const{clockTemplate:e,element:t,eventRecord:n}=this,r=super.updateContent(),i=t.querySelector(".b-sch-tooltip-startdate"),s=t.querySelector(".b-sch-tooltip-enddate"),{edit:o,delete:a}=this.tools,{client:l}=this.ownerFeature,{eventEdit:c}=l.features,d=l.readOnly||n.readOnly;return i&&e.updateDateIndicator(i,n.startDate),s&&e.updateDateIndicator(s,n.endDate),o&&(o.hidden=d||!(null!=c&&c.enabled)),a&&(a.hidden=d),r}updateActiveClient(e){this.detachListeners("clientOverflowChange"),e&&e.on({name:"clientOverflowChange",eventsPerCellChange:"onClientOverflowChange",thisObj:this})}onClientOverflowChange(){Mr.isVisible(this.lastAlignSpec.target)||this.hide()}onDocumentMouseDown({event:e}){if(e.button||"click"!==this.ownerFeature.showOn||!this.activeTarget.contains(e.target))return super.onDocumentMouseDown(...arguments)}}Iw.initClass(),Iw._$name="EventTip";const Aw="YYYY-MM-DD",Fw=/^b-hover-(top|right|bottom|left)$/,Ow=Symbol("eventDragMode"),Lw=(e,t)=>{let n;return"b-cal-event-body"===e.className?e.children.push(n=t):Array.isArray(e.children)&&e.children.forEach((e=>{!n&&e&&(n=Lw(e,t))})),n},Pw=e=>Object.freeze({type:e,create:!1,move:!1,resize:!1,[e]:!0}),$w={create:{finisher:"finishDropCreate",mode:Pw("create"),validatorFn:"validateCreateFn"},move:{finisher:"finishDropMove",mode:Pw("move"),validatorFn:"validateMoveFn"},resize:{finisher:"finishDropResize",mode:Pw("resize"),validatorFn:"validateResizeFn"}},_w={calendarrow:!0,monthview:!0};class Nw extends(Te.mixin(bd,Cd,kd)){static get $name(){return"Zone"}static get configurable(){return{droppableSelector:"*",droppable:!0,hoverable:null,hoverAnimationCls:"b-hover-anim",days:{$config:{equal:"array"},value:null},dragProxy:{type:"tip",tooltip:null},eventRecord:null,hit:null,dragItemSelector:".b-cal-event-wrap",overflow:{$config:"nullify",value:null},owner:null,rootElement:null,view:{$config:"nullify",value:null}}}findRootElement(e){return e.contentElement}getDateFromPosition(e,t){return this.view.getDateFromPosition(e,t)}get dragEventer(){return this.owner}beforeDrag(e){const t=this,{owner:n}=t,r=t.hitTest(e),i=null==r?void 0:r.eventRecord,s=t.view.rtl?"right":"left";if(!r||null!=i&&i.readOnly||null!=i&&i.isCreating)return!1;let o,a;switch(r.date&&e.set("date",r.date),r.type){case"event":e.set("eventRecord",i),e.set("eventSourceHit",r),e.set("eventInset",r.eventElement.style[s]),e.set("eventWidth",r.eventElement.offsetWidth),o="move",a=!n.draggable||!i.draggable,a||t.captureDragOffset(i,r,e);break;case"resize":e.set("eventRecord",i),e.set("eventSourceHit",r),e.set("eventInset",r.eventWrap.style[s]),e.set("eventWidth",r.eventWrap.offsetWidth),o="resize",a=!n.resizable||!i.resizable;break;case"schedule":case"dayNumber":e.set("eventCreate",r),o="create",a=!n.creatable;break;default:return!1}if(a)return!1;e.set("eventDragMode",e[Ow]=$w[o].mode)}dragStart(){var e;const t=this,{dragging:n,owner:r,view:i}=t,{client:s}=r,o=()=>{n.lastMoveEvent&&n.move(n.lastMoveEvent)},a={scrollables:s.scrollManager?[{element:s.viewContainer.element,callback:o}]:[]};var l;(t.isResizing||t.isMoving)&&(t.refocus=r.client.captureFocus()),t.isResizing&&(null===(l=n.itemElement)||void 0===l||l.classList.add("b-resizing")),i.scrollable&&a.scrollables.push({element:i.scrollable.element,callback:o}),i.horizontalScroller&&a.scrollables.push({element:i.horizontalScroller.element,callback:o}),null===(e=s.scrollManager)||void 0===e||e.startMonitoring(a)}captureDragOffset(){}cleanupDrag(){var e;const t=this,{dragProxy:n,dragging:r}=t,{tooltip:i}=n;null==r||null===(e=r.itemElement)||void 0===e||e.classList.remove("b-resizing"),t.view.on({refresh(){var e;null===(e=t.refocus)||void 0===e||e.call(t,!1,!0),t.refocus=null},once:!0}),t.days=null,i&&(i.hide(),n.tooltip=null)}dragEnd(){var e,t;null===(e=this.owner.client)||void 0===e||null===(t=e.scrollManager)||void 0===t||t.stopMonitoring(),this.cleanupDrag()}makeDays(e,t){const{dayTime:n,startDate:r,endDate:i}=this.view,s=en.add(i,-1,"d");e=en.constrain(e,r,s),t=en.constrain(t,r,s);const o=n.startOfDay(t),a=[];for(let t=n.startOfDay(e);t<=o;t=en.add(t,1,"day"))a.push(en.format(t,Aw));return a}onShowOverflowPopup({overflowPopup:e}){this.overflow||(this.overflow=new zw({owner:this.owner,view:e}))}get calendarCells(){const e=this.dropRootElement,{hideNonWorkingDays:t}=this.view;return e&&Mr.children(e,`${this.view.visibleCellSelector}${t?":not(.b-nonworking-day)":""}`)}get isCreating(){var e,t;return null===(e=this.dropping)||void 0===e||null===(t=e[Ow])||void 0===t?void 0:t.create}get isMoving(){var e,t,n;const r=(null===(e=this.dropping)||void 0===e?void 0:e[Ow])||(null===(t=this.dragging)||void 0===t?void 0:t[Ow]);return r?r.move:Boolean(null===(n=this.dropping)||void 0===n?void 0:n.peek("eventRecord"))}get isResizing(){var e,t;return null===(e=this.dragging)||void 0===e||null===(t=e[Ow])||void 0===t?void 0:t.resize}get recurrable(){return this.isDayZone||this.isMonthZone}cleanupDrop(){this.eventRecord=this.eventDom=this.days=null,this.noTip=!1}createEvent(e){var t;const n=(null===(t=this.dropping)||void 0===t?void 0:t[Ow])||$w.create;this.setupEvent(e,n.create)}async dragDrop(e){if(this.isResizing||e.target===this)return e.finalizer=this.finishDrop(e)}dragEnter(e){const t=this,n=e[Ow];if(t.isMoving)t.startMove(e.peek("eventRecord"));else{if(!n||e.source!==t)return!1;if(n.resize)t.startResize(e.peek("eventSourceHit"));else{if(!n.create)return!1;t.startCreate(e.peek("date"),e.peek("eventCreate"))}}}dragLeave(){this.isResizing||this.cleanupDrop()}dragMove(e){this.hit=this.pickDropTarget(e)}dropHitMove(e,t,n){const{endDate:r,startDate:i}=n.isScheduled?n:this.eventRecord,s=en.diff(i,r,"s");let{date:o}=t;o=en.clearTime(o),n.allDay||(o=en.add(o,en.diff(en.clearTime(i),i,"s"),"s")),o=this.applyDragOffset(o,e),this.setEventData({startDate:o,endDate:en.add(o,s,"s")})}dropHitNowhere(){this.days=null}dropHitResize(e,t,n){const{eventRecord:r}=this,{startDate:i,endDate:s}=r,o=en.clearTime(t.date);let a,l;n.atEnd?(l=en.add(o,1,"d"),a={startDate:i,endDate:i<l?l:en.add(i,1,"d")}):a={startDate:o<s?o:en.add(s,-1,"d"),endDate:s},a.duration=en.diff(a.startDate,a.endDate,r.durationUnit),this.setEventData(a)}async finishDrop(e){const t=this,{eventRecord:n,owner:r,view:i}=t,{eventStore:s}=i,o=e[Ow],a=$w[(null==o?void 0:o.type)||"move"];if(a&&t.hit){const i=!a.validatorFn||await r.callback(r[a.validatorFn],r,[{drag:e,eventRecord:n,event:e.event}]);!1!==i&&await t[a.finisher](e,r,n,s,i,(async s=>{let o={drag:e,eventRecord:n,validation:i,event:e.event,feature:r,view:e[t.isResizing?"source":"target"].view};return!1===await r.client.trigger("before"+_.capitalize(s),o)?o=!1:r.client.trigger(s,o),o}))}t.cleanupDrop()}async finishDropCreate(e,t,n,r,i,s){const o=!1!==(null==i?void 0:i.add);!1===await s("dragCreateEnd")?o&&r.remove(n):o&&!r.includes(n)&&r.add(n)}async finishDropMove(e,t,n,r,i,s){let o=await e.get("eventRecord");const a=this,{view:l}=a,c=o.isOccurrence?o.recurringTimeSpan:o,{source:d}=e,u=d!==a,h=u&&d.resource!==a.resource;if((h||!en.isEqual(n.startDate,o.startDate)||!en.isEqual(n.endDate,o.endDate)||o.eventStore!==r)&&!1!==await s("dragMoveEnd"))if(r.getByInternalId(c.internalId)){var g;o=await a.finishDropConfirm(o),o&&(await a.moveEventTo(e,o),h&&(o.assign(a.resource),o.unassign(d.resource)),u&&a.owner.client.activeView.eachView&&(l.refresh(),null===(g=l.getEventElement(o,o.startDate))||void 0===g||g.focus()))}else{var m,p;const t=await e.get("sourceStore");t?(t.remove(o),await a.moveEventTo(e,o)):o=n;const i=null!==(m=null!==(p=o.resourceId)&&void 0!==p?p:a.resource)&&void 0!==m?m:this.owner.client.defaultCalendarId;delete o.resourceId,r.add(o),o.assign(h?a.resource:i)}}async finishDropResize(e,t,n,r,i,s){if(!1===await s("dragResizeEnd"))return;let{eventRecord:o}=await e.get("eventSourceHit");o=await this.finishDropConfirm(o),o&&o.set({startDate:n.startDate,endDate:n.endDate,duration:en.diff(n.startDate,n.endDate,o.durationUnit)})}async finishDropConfirm(e){return e.isOccurrence||e.isRecurring?new Promise((t=>{new mb({owner:this.owner}).confirm({actionType:"update",eventRecord:e,cancelFn(){t(null)},changerFn(e){t(e)}})})):e}async moveEventTo(e,t){let n=this.view.getDateFromElement(e.targetElement);if(t.startDate&&(n=en.copyTimeValues(en.clearTime(n),t.startDate)),n=this.applyDragOffset(n,e),!this.view.eventStore.getByInternalId(t.internalId)&&!t.startDate){const t=e.target.view.autoCreate||this.owner.client.autoCreate;n.setHours((null==t?void 0:t.startHour)||8)}await this.setStartDate(t,n)}pickDropTarget(e){var t;const n=this;let r=n.hitTest(e);return!r&&n.isResizing&&(r=n.hit),null!==(t=r)&&void 0!==t&&t.date?r:null}setStartDate(e,t){return e.set({startDate:t,endDate:en.add(t,this.eventRecord.duration,this.eventRecord.durationUnit)})}getHoverHandleCls(e){return e?"":"b-gripper-vert"}hoverEnter(){var e,t;const n=this,r=n.hitTest(n.hoverTarget),{gripper:i}=n.owner,s=n.getHoverHandleCls(),o=n.getHoverHandleCls(!0);o&&i.classList.remove(o),!1===(null==r||null===(e=r.eventRecord)||void 0===e?void 0:e.resizable)||null!=r&&null!==(t=r.eventRecord)&&void 0!==t&&t.readOnly||(s&&i.classList.add(s),n.hoverTarget.appendChild(i))}hoverLeave(e){const{gripper:t}=this.owner,n=this.getHoverHandleCls();t.parentNode===e&&(n&&t.classList.remove(n),e.removeChild(t))}applyDragOffset(e,t){const n=t.peek("eventOffset");var r;return e&&null!=n&&n[0]&&t.source.constructor===(null===(r=t.target)||void 0===r?void 0:r.constructor)&&(e=en.add(e,-n[0],n[1])),e}hitTest(e){const t=this,n=null==e?void 0:e.isDragContext,r=n?e.event:e,i=n&&e.targetElement||Mr.getEventElement(r);let s,o,a=t.view,l=null;if(i){a.calendarHitTest||(a=t.owner.client);const e=a.rtl?"right":"left";l=a.calendarHitTest(i),l&&(l.eventWrap=o=i.closest(".b-cal-event-wrap"),i.classList.contains("b-gripper")?(l={type:"resize",cell:l.cell,date:l.date,edge:s={},eventRecord:l.eventRecord,eventWrap:o,gripper:i,view:l.view},Mn.normalize(o.className,"array").forEach((e=>{(e=Fw.exec(e))&&(s[e[1]]=!0)})),l.atEnd=!(s.top||s[e])):l.eventRecord||(o=null),o&&(l.eventTop=o.style.top),i!==r&&(l.date=t.getDateFromPosition(r.clientX,r.clientY)||l.date))}return l}renderEvent(e,t,n){const{view:r}=this;Object.defineProperty(e,"resource",{configurable:!0,get:()=>r.defaultCalendar});const i=r.createEventDomConfig({eventRecord:e,isAllDay:_w[r.type]});if(i.className["b-cal-tentative-event"]=1,i.className["b-cal-tentative-event-first"]=t,i.className["b-cal-tentative-event-last"]=n,delete e.resource,n){const{footer:t}=this.owner;t&&Lw(i,sn.assign({html:en.format(e.endDate,r.timeFormat)},t))}return i}setEventData(e,t){const n=this,{eventRecord:r,view:i}=n,{duration:s,startDate:o}=e;if(o&&null!=s&&!e.endDate&&(e=f(f({},e),{},{endDate:en.add(o,s,r.durationUnit)})),r.set(e),n.eventDom)n.eventDom.className[i.shortEventCls]=r.durationMS<=i.shortEventDuration;else{if(t){let{newName:e}=n.owner;"function"==typeof e&&(e=e(r)),r.set("name",e)}n.eventDom=n.renderEvent(r)}}setupEvent(e,t){var n;const r=this,{owner:i}=r,{defaultCalendar:s,eventStore:o}=r.view,{tooltip:a}=i,l=r.eventRecord=i.eventRecord=o.createRecord({}),c=t?new Set([new o.assignmentStore.modelClass({event:l,resource:s})]):e.assigned;Object.defineProperty(l,"assigned",{configurable:!0,get:()=>c}),r.setEventData(e,t),delete l.assigned,r.isCreating&&s&&o.assignmentStore.assignEventToResource(l,s);const{eventDom:d}=r;return d.className["b-cal-tentative-event"]=1,r.noTip||a.disabled||null===(n=r.dragging)||void 0===n||!n.has("eventCreate")||(a.eventRecord=l,a.recurrenceHint=t&&r.recurrable?i.recurrenceTip:"",r.dragProxy.tooltip=a),d}startCreate(e){this.createEvent({allDay:!0,startDate:e,endDate:en.add(e,1,"d")})}startMove(e){var t;const n=this,r=sn.clone(e.data),i=null===(t=e.resource)||void 0===t?void 0:t.eventColor;if(!r.eventColor&&i&&(r.eventColor=i),r.assigned=e.assigned,!r.startDate){const t=n.pickDropTarget(n.dropping);r.startDate=(null==t?void 0:t.date)||new Date,r.endDate=en.add(r.startDate,e.duration||1,e.durationUnit||"h")}var s;r.resourceId||(r.resourceId=n.dropping.peek("resourceId")||(null===(s=n.owner.client)||void 0===s?void 0:s.defaultCalendarId)),delete r.id,n.setupEvent(r)}startResize(e){var t;const{eventRecord:n}=e,r=n.data;this.createEvent(f(f({},r),{},{id:`dragResize-event-${r.id}`,eventColor:r.eventColor||(null===(t=n.resource)||void 0===t?void 0:t.eventColor),recurrenceRule:null,realEventId:r.id}))}configureListeners(e){const t=super.configureListeners(e);return t.element=this.view.rootElement,t}updateHit(e){const t=this,n=t.dropping,r=e&&n[Ow];e?t.isMoving?t.dropHitMove(n,e,n.peek("eventRecord")):null!=r&&r.create?t.dropHitCreate(n,e,n.peek("eventCreate")):null!=r&&r.resize&&t.dropHitResize(n,e,n.peek("eventSourceHit")):t.dropHitNowhere(n)}updateDays(e){const t=this,{calendarCells:n,eventDom:r,dayValues:i}=t,s=n&&{};let o,a,l,c,d,u=!0;if(t.dayValues=s,n&&r){for(c=0;c<n.length;++c)o=n[c],null!=e&&e.includes(o.dataset.date)&&(d=o);for(c=0;c<n.length;++c)o=n[c],a=o.dataset.date,null!=e&&e.includes(a)&&((l=null==i?void 0:i[a])?delete i[a]:(l=t.includeDay(a,o,u,o===d)||!0,u=!1),s[a]=l);if(i)for(c in i)t.removeDay(c,i[c])}}updateEventRecord(e){this.owner.eventRecord=e}updateOverflow(e,t){return!e&&t&&t.destroy(),e}updateOwner(e){this.hoverIgnoreElement=null==e?void 0:e.gripper}updateRootElement(e){const t=this;t.dragRootElement=e,t.dropRootElement=t.droppable?e:null,t.hoverRootElement=t.hoverable?e:null}updateView(e){var t;const n=this;n.rootElement=e?n.findRootElement(e):null,null===(t=n._overflowDetacher)||void 0===t||t.call(n),n._overflowDetacher=null==e?void 0:e.on({thisObj:n,showOverflowPopup:"onShowOverflowPopup"})}}Nw.prototype._eventRecord=null;class Hw extends Nw{static get $name(){return"BaseDayZone"}static get configurable(){return{hoverSelector:".b-cal-event-wrap",draggingClsSelector:".b-dayview-content"}}getHoverHandleCls(e){let t=this.isAllDayZone;return e&&(t=!t),"b-gripper-"+(t?"vert":"horz")}}class Bw extends Hw{static get $name(){return"AllDayZone"}static get configurable(){return{hoverEdges:"lr"}}beforeDrag(e){const t=super.beforeDrag(e);return!(!1!==t&&!this.draggable&&e[Ow].move)&&t}dragEnter(e){return this.view.eventsPerCell||this.view.expandGutter(),super.dragEnter(e)}dragLeave(e){this.view.collapseGutter(),super.dragLeave(e)}captureDragOffset(e,t,n){n.set("eventOffset",[Math.max(Math.floor(en.diff(e.startDate,t.date,"d")),0),"d"])}dropHitCreate(e,t,n){let r=en.clearTime(t.date),i=en.clearTime(n.date);r<i&&([i,r]=[r,i]),this.setEventData({startDate:i,duration:en.diff(i,r,"d")+1,durationUnit:"d"})}async moveEventTo(e,t){const n=this,r=n.hitTest(e),i=n.applyDragOffset(null==r?void 0:r.date,e),s=new Date(t.startDate);i&&(s.setFullYear(i.getFullYear()),s.setMonth(i.getMonth()),s.setDate(i.getDate()),t.isInterDay||(t.allDay=!0),await n.setStartDate(t,s))}setEventData(e,t){super.setEventData(e,t);const n=this,{eventRecord:r}=n;let{startDate:i,endDate:s}=r;r.allDay&&(s=en.add(s,-1,"d")),n.days=n.makeDays(i,s)}setupEvent(e,t){super.setupEvent(e,t),this.eventRecord.allDay=!0}updateDays(e){const t=this;let{eventEl:n}=t;if(e){var r,i;n||(t.eventEl=n=Mr.createElement(f({},t.eventDom)),n.classList.add("b-allday"));const{dropRootElement:s}=t,{hideNonWorkingDays:o,visibleCellSelector:a,weekLength:l}=t.view,c=null===(r=t.dragging)||void 0===r||null===(i=r.peek("eventSourceHit"))||void 0===i?void 0:i.eventTop,d=Mr.children(s,`${a}${o?":not(.b-nonworking-day)":""}`),u=Mr.down(s,`${a}${o?":not(.b-nonworking-day)":""}[data-date='${e[e.length-1]}']`);Mr.down(u,".b-cal-event-bar-container").appendChild(n),n.style[t.view.rtl?"right":"left"]=Mr.percentify(100*(d.indexOf(u)-e.length+1)/l),n.style.width=Mr.percentify(100*e.length/l),c&&(n.style.top=c),t.view.scrollable.scrollIntoView(n,!0)}else n&&(n.classList.contains("b-cal-tentative-event")&&n.remove(),t.eventEl=null)}updateView(e,t){if(e){const t=en.diff(e.startDate,e.endDate,"d")>1;this.hoverable=this.draggable=t}super.updateView(e,t)}}class jw extends Hw{static get $name(){return"DayZone"}static get configurable(){return{dragEventId:null,hoverable:!0,hoverEdges:"tb",times:{$config:{equal:"array"},value:null}}}construct(...e){const t=this;super.construct(...e),t.allDayZone=new Bw({active:t.active,owner:t.owner,view:t.view.allDayEvents,resource:t.resource})}syncDraggingElements(e,t){const{dragging:n}=this,{draggingItemCls:r}=n.source,i=n.itemElement.closest(".b-dayview-day-container").querySelectorAll(`[data-event-id="${e}"]`);for(const e of i)e.classList.toggle(r,t)}updateDragEventId(e,t){t&&this.syncDraggingElements(t,!1),e&&this.syncDraggingElements(e,!0)}get eventRecord(){var e;return super.eventRecord||(null===(e=this.allDayZone)||void 0===e?void 0:e.eventRecord)}set eventRecord(e){super.eventRecord=e}get recurring(){var e;return this.isCreating&&null!=(null===(e=this.eventRecord)||void 0===e?void 0:e.recurrenceRule)}get droppingAllDay(){var e,t;const n=null===(e=this.dropping)||void 0===e?void 0:e.peek("eventRecord");return(null==n?void 0:n.startDate)&&(null===(t=this.view)||void 0===t?void 0:t.isAllDayEvent(n))||!1}get useAllDay(){return this.droppingAllDay&&this.view.showAllDayHeader&&this.dropping.source!==this.allDayZone}get wasAllDay(){return this.droppingAllDay&&this.dropping.source===this.allDayZone}doDestroy(){var e;null===(e=this.allDayZone)||void 0===e||e.destroy(),super.doDestroy()}dragStart(){var e,t;super.dragStart(),this.dragEventId=null!==(e=null===(t=this.dragging.peek("eventRecord"))||void 0===t?void 0:t.id)&&void 0!==e?e:null}findRootElement(e){return e.eventContentElement}captureDragOffset(e,t,n){n.set("eventOffset",[Math.floor(en.diff(e.startDate,t.date,"m")),"m"])}cleanupDrag(){var e;this.dragEventId=null,super.cleanupDrag(),null===(e=this.allDayZone)||void 0===e||e.cleanupDrag()}cleanupDrop(){var e,t,n;super.cleanupDrop(),null===(e=this.owner.client)||void 0===e||null===(t=e.scrollManager)||void 0===t||t.stopMonitoring(),null===(n=this.allDayZone)||void 0===n||n.cleanupDrop()}dropHitCreate(e,t){const n=e.peek("eventCreate");let r,i,s=t.date,o=n.date,a=s,l=o;const c=!(en.clearTime(o)-en.clearTime(s)),d=e.ctrlKey&&!c;d||c?(a=en.clearTime(s),l=en.clearTime(o),o-=l,s-=a,a<l&&([l,a]=[a,l]),s<o&&([o,s]=[s,o]),l.setTime(l.getTime()+o),r=Math.max(this.view.increment,Math.floor(s-o))/6e4,d&&(i=en.diff(en.clearTime(l),en.clearTime(a),"d")+1)):(a<l&&([l,a]=[a,l]),r=Math.floor((a-l)/6e4)),this.setEventData({startDate:l,duration:r,recurrenceRule:d?`FREQ=DAILY;COUNT=${i}`:null})}dropHitMove(e,t,n){let r=t.date;const i=this,{view:s}=i,o=s.dayTime.startOfDay(r);i.useAllDay?i.allDayZone.dropHitMove(e,t,n):(n=i.eventRecord,r=i.applyDragOffset(r,e),s.showAllDayHeader&&r<o&&(r=o),i.setEventData({startDate:r,endDate:en.add(r,n.duration,n.durationUnit),duration:n.duration}))}dropHitResize(e,t,n){const r=this,{eventRecord:i}=r,s=t.date;n.atEnd?i.startDate<s&&r.setEventData({endDate:s}):s<i.endDate&&r.setEventData({startDate:s})}async moveEventTo(e,t){const n=this,r=n.hitTest(e),i=null==r?void 0:r.date;i&&(n.useAllDay?await n.allDayZone.moveEventTo(e,t):(n.wasAllDay&&(t.allDay=!1),await n.setStartDate(t,n.applyDragOffset(i,e))))}startCreate(e){this.createEvent({duration:0,durationUnit:"m",startDate:e})}includeDay(e,t,n,r){return Mr.createElement(f({parent:t},this.renderEvent(this.eventRecord,n,r)))}removeDay(e,t){t.classList.contains("b-cal-tentative-event")&&t.remove()}setEventData(e,t){const n=this;if(n.useAllDay)return void n.allDayZone.setEventData(e,t);super.setEventData(e,t);const{eventRecord:r}=n,{endDate:i,startDate:s}=r,{dayTime:o}=n.view;let a=i;n.recurring&&(a=en.add(a,r.recurrence.count-1,"d")),n.days=n.makeDays(s,a),n.times=[o.delta(s,"s"),o.delta(i,"s")]}setupEvent(e,t){this.useAllDay?this.allDayZone.setupEvent(e,t):(this.wasAllDay&&(e.allDay=!1,e.endDate=en.add(e.startDate,e.duration=1,e.durationUnit="hour")),super.setupEvent(e,t))}updateDays(e,t){super.updateDays(e,t),this.updateTimes(this.times,null)}updateTimes(e){if(!e)return;const t=this,{allDayZone:n,dayValues:r,dragging:i,eventRecord:s,recurring:o,view:a}=t,{dayTime:l,eventSpacing:c}=a,d=a.rtl?"right":"left",{endDate:u,startDate:h}=s,[g,m]=e,p=!(null!=i&&i.aborted)&&(null==i?void 0:i.peek("eventInset")),f=!(null!=i&&i.aborted)&&(null==i?void 0:i.peek("eventWidth")),v=l.dateKey(h),y=l.dateKey(u),b=l.startOfDay(h)<l.startOfDay(u),C=100/l.duration("s");let w,S,D,E,x,{days:R}=t;if(R){for(w in r)S=w===v,E=r[w].style,x=g*C,D=(m-g)*C,oa.sync({targetElement:r[w],domConfig:t.renderEvent(t.eventRecord,S,w===R[R.length-1])}),!o&&b&&(D=S?100-x:w===y?x+D:100),E.top=o||S?Mr.percentify(x):0,E.height=Mr.percentify(D),E.paddingBottom=Mr.setLength(c),p&&(E[d]=p),f&&(E.width=`${f}px`);!R||R.length<2||o?(null==n||n.cleanupDrop(),R=null):n&&a.showAllDayHeader&&(n.eventRecord||(n.noTip=!0,n.createEvent({startDate:s.startDate,endDate:s.endDate})),n.eventRecord.set({startDate:s.startDate,endDate:en.add(s.startDate,R.length-1,"d")}),n.days=R)}}}class Vw extends Nw{static get $name(){return"MonthZone"}static get configurable(){return{coverage:{$config:{equal:sn.isEqual},value:null},hoverable:!0,hoverEdges:"lr",hoverSelector:".b-cal-event-wrap.b-allday"}}findRootElement(e){return e.weeksElement}captureDragOffset(e,t,n){n.set("eventOffset",[Math.floor(en.diff(en.clearTime(e.startDate),t.date,"d")),"d"])}cleanupDrag(){super.cleanupDrag(),this.coverage=null}cleanupDrop(){var e,t;super.cleanupDrop(),null===(e=this.owner.client)||void 0===e||null===(t=e.scrollManager)||void 0===t||t.stopMonitoring(),this.coverage=null}dropHitCreate(e,t){const n=e.ctrlKey,r=e.peek("eventCreate");let i,s,o,a,l,c,d,u=null;a=en.clearTime(t.date),l=en.clearTime(r.date),s=r.dayNumber,o=t.dayNumber,c=r.weekOffset,d=t.weekOffset,d<c&&([c,d]=[d,c]),n?(i=d-c+1,u=i>1?`FREQ=WEEKLY;COUNT=${i}`:null,a<l?(l=a,s<o&&(l=en.add(l,s-o,"d"))):o<s&&(l=en.add(l,o-s,"d")),o<s&&([s,o]=[o,s])):a<l&&([l,a]=[a,l],[s,o]=[o,s]),this.setEventData({startDate:l,duration:(n?o-s:en.diff(l,a,"d"))+1,durationUnit:"d",recurrenceRule:u})}dropHitNowhere(e){super.dropHitNowhere(e),this.coverage=null}setEventData(e,t){super.setEventData(e,t);const{dropping:n,eventRecord:r,view:i}=this,{visibleCellSelector:s,hideNonWorkingDays:o}=i,a=Mr.children(i.weeksElement,"> .b-calendar-week"),l={},c=e=>{const{startDate:t,endDate:n}=e;for(let e,r,c,d,u=0;u<a.length;++u){for(e=Mr.children(a[u],`${s}${o?":not(.b-nonworking-day)":""}`),d=e.length,r="",c=0;c<d;++c){const s=i.getDateFromElement(e[c]),o=en.add(s,1,"d");t<o&&s<n&&(!c&&t<s&&(r="<"),r+=c,c===d-1&&o<n&&(r+=">"))}r&&(l[u]||(l[u]=[])).push(r)}};null!=n&&n.has("eventRecord")||!r.recurrence?c(r):r.recurrence.forEachOccurrence(i.startDate,i.endDate,c),this.coverage=l}updateCoverage(e){const t=this,{dragging:n,weekValues:r,view:i}=t,{rtl:s}=i,{visibleCellSelector:o,hideNonWorkingDays:a}=i,l=e&&(null==n?void 0:n.peek("eventSourceHit")),c=null==l?void 0:l.eventTop,d={},u=i.getWeekElementFor(null==l?void 0:l.eventElement),{weekElements:h}=i;let g,m,p,f,v,y,b,C,w,S,D;for(t.weekValues=d,w=0;w<h.length;++w)if(f=null==e?void 0:e[w])for(D=h[w],m=Mr.children(D,`${o}${a?":not(.b-nonworking-day)":""}`),S=0;S<f.length;++S){var E;(y=null==r||null===(E=r[w])||void 0===E?void 0:E.shift())||(y=Mr.createElement(t.eventDom)),(d[w]||(d[w]=[])).push(y),p=f[S],b=p.includes("<")?1:0,C=p.includes(">")?1:0,p=p.substr(b,p.length-C-b),y.classList[b?"add":"remove"]("b-continues-past"),y.classList[C?"add":"remove"]("b-continues-future"),y.style[s?"right":"left"]=Mr.percentify(100*Number(p[0])/m.length),y.style.width=Mr.percentify(100*p.length/m.length),c&&D===u&&(y.style.top=c),g=m[Number(p[p.length-1])],v=Mr.down(g,".b-cal-event-bar-container"),v!==y.parentNode&&v.appendChild(y)}if(r)for(w in r)r[w].forEach((e=>{e.classList.contains("b-cal-tentative-event")&&e.remove()}))}}class zw extends Nw{static get $name(){return"OverflowZone"}static get configurable(){return{droppable:!1,dragProxy:{type:"default",open(e){const t=this,{owner:n}=e.source.view,r=e.element.closest(".b-cal-event-wrap");n.isYearView&&(t.proxyEl=r.cloneNode(!0),t.proxyEl.classList.add("b-cal-drag-proxy"),t.proxyEl.style.width=`${r.offsetWidth}px`,t.proxyOffset=_n.getClientPoint(e.startEvent).getDelta(xn.from(r)),n.contentElement.appendChild(t.proxyEl))},dragMove(e){this.proxyEl&&Mr.alignTo(this.proxyEl,_n.getClientPoint(e.event).translate(10,10),{align:"t0-t0"})},close(){var e;null===(e=this.proxyEl)||void 0===e||e.remove()}}}}findRootElement(e){return e.contentElement}beforeDrag(e){const t=this.hitTest(e);if("event"!==(null==t?void 0:t.type))return!1;e.set("eventRecord",t.eventRecord),e.set("eventDragMode",e[Ow]=$w.move.mode)}dragStart(){this.view.hide()}}class Ww extends Nw{static get $name(){return"YearZone"}startCreate(){var e;null===(e=this.view._overflowPopup)||void 0===e||e.hide(),super.startCreate(...arguments)}dragEnter(e){const t=super.dragEnter(e);return!1!==t&&this.view.contentElement.classList.add(this.draggingCls),t}dragLeave(e){super.dragLeave(e),this.view.contentElement.classList.remove(this.draggingCls)}dropHitCreate(e,t,n){let r=en.clearTime(t.date),i=en.clearTime(n.date);r<i&&([i,r]=[r,i]);const s=this,o=s.makeDayRange(i,r);s.setEventData({startDate:i,endDate:en.add(r,1,"d")}),s.days=o}dropHitMove(e,t,n){super.dropHitMove(e,t,n);const r=this,i=r.eventRecord;let{endDate:s}=i;i.allDay&&(s=en.add(s,-1,"d")),r.days=r.makeDayRange(i.startDate,s)}includeDay(e){const t=Mr.children(this.view.bodyElement,`[data-date='${e}']`);return t.forEach((e=>e.classList.add("b-cal-tentative-event"+(this.view.hideNonWorkingDays?":not(.b-nonworking-day)":"")))),t}makeDayRange(e,t){const n=[];for(let r=e;r<=t;r=en.add(r,1,"d"))n.push(en.format(r,Aw));return n}removeDay(e,t){t.forEach((e=>e.classList.remove("b-cal-tentative-event")))}}class Uw extends Te{static get configurable(){return{view:null,zones:{$config:["nullify"],value:[]}}}updateView(e){e.eachView((e=>{this.onResourceViewViewCreate({view:e})})),e.on({viewCreate:"onResourceViewViewCreate",thisObj:this})}onResourceViewViewCreate({view:e}){const{zones:t,owner:n}=this,r=n.client.constructor.Modes,i=n.getViewZoneType(r.resolveType(e.type));i&&t.push(n.createZone(i,{view:e,resource:e.defaultCalendar}))}changeZones(e,t){if(null!=t&&t.length&&!e)for(let e=0,{length:n}=t;e<n;e++)t[e].destroy();return e}}class Yw extends Mw{static get $name(){return"CalendarDrag"}static get type(){return"drag"}static get configurable(){return{disableOnReadOnly:!0,localizableProperties:["newName","recurrenceTip"],creatable:!0,draggable:!0,footer:{className:"b-cal-event-footer"},gripper:{class:"b-gripper"},newName:"L{newEvent}",recurrenceTip:"(L{holdCtrlForRecurrence})",resizable:!0,tooltip:{$config:["lazy","nullify"],value:{type:"eventTip",disabled:!0,forSelector:null,tools:null}},validateCreateFn:()=>{},validateMoveFn:()=>{},validateResizeFn:()=>{}}}changeGripper(e,t){return null==t||t.remove(),e&&Mr.createElement(e)}changeTooltip(e,t){return e&&(e=!0===e?this.constructor.configurable.tooltip.value:e,this.initialConfig.tooltip&&(e.disabled=!1),e.ownerFeature=this),Ka.reconfigure(t,e,this)}getViewZoneType(e){return e.isDayView?jw:e.isMonthView?Vw:e.isYearView?Ww:e.isResourceView?Uw:void 0}}Yw.initClass(),Yw._$name="CalendarDrag";class Gw extends gb{static get $name(){return"EventEditor"}static get type(){return"calendareventeditor"}static get configurable(){return{align:{monitorResize:!0}}}updateRecord(e){this.fixTimeFieldVisibility(e.allDay),super.updateRecord(e)}onAllDayChange({value:e,userAction:t}){this.fixTimeFieldVisibility(e,t)}fixTimeFieldVisibility(e,t){const n=e?"hide":"show",r=e?"remove":"add",{startDateField:i,startTimeField:s,endDateField:o,endTimeField:a}=this.widgetMap;s&&s[n](),a&&a[n](),null==i||i.element.classList[r]("b-inline"),null==o||o.element.classList[r]("b-inline"),!e&&t&&(i&&(i.value=s.value=this.record.getData("startDate")),o&&(o.value=a.value=this.record.getData("endDate")))}onBeforeShow(){const{deleteButton:e}=this.widgetMap;super.onBeforeShow(...arguments),e&&!e.hidden&&this.record.isCreating&&e.hide()}onFocusOut(){super.onFocusOut(...arguments),this.owner=this.initialConfig.owner}}Gw.initClass(),Gw._$name="EventEditor";class qw extends Mb{static get $name(){return"EventEdit"}static get type(){return"eventEdit"}static get configurable(){return{editorConfig:{type:"calendareventeditor",items:{resourceField:{label:"L{Calendar}",showEventColor:!0},allDay:{type:"checkbox",cls:"b-match-label",name:"allDay",weight:250,label:"L{All day}",listeners:{change:"up.onAllDayChange"}}}}}}construct(e){super.construct(e.client,e)}onDragCreateEnd({eventRecord:e}){this.editNewlyCreatedEvent(e)}onEventAutoCreated({eventRecord:e}){this.editNewlyCreatedEvent(e)}editNewlyCreatedEvent(e){if(!this.disabled)return e.isCreating=!0,this.editEvent(e)}async doEditEvent(e,t,n){var r,i,s;const o=this,{client:a}=o,{eventStore:l}=a;let c=a.eventSource||a.activeSubView,d=!1;if(c.isScheduler)return o.client=c,await super.doEditEvent(...arguments),void(o.client=a);if(!c.isCalendarMixin||null!==(r=c.features)&&void 0!==r&&null!==(i=r.cellEdit)&&void 0!==i&&i.isEditing)return;en.intersectSpans(e.startDate,e.endDate,c.startDate,c.endDate)||(a.date=e.startDate),e.isOccurrence||l.includes(e)||(d=e.isCreating=!0,await l.addAsync(e)),e.isInterDay&&c.allDayEvents&&c.showAllDayHeader&&(c=c.allDayEvents);const{_overflowPopup:u}=c,h=c.getDateFromElement(n);let g=null==u?void 0:u.isVisible,m=g?u.getEventElement(e):c.getEventElement(e,h);var p,f,v,y;g&&(m?g=!1:m=u.getEventElement(e)),e.isCreating&&(null===(p=a.onEventCreated)||void 0===p||p.call(a,e)),!m&&c.isEventList&&(m=null===(f=c)||void 0===f||null===(v=f.rowManager)||void 0===v||null===(y=v.getRowFor(e))||void 0===y?void 0:y.element);const b=m&&!Mr.isInView(m)||!e.isCreating||!d;if(g)m.focus();else if(m){var C,w;b&&null!==(C=c.scrollable)&&void 0!==C&&C.hasOverflow?await(null===(w=c.scrollable)||void 0===w?void 0:w.scrollIntoView(m,{animate:!0,focus:!0})):Mr.focusWithoutScrolling(m)}else{if(!e.isInterDay&&c.hiddenNonWorkingDays[e.startDate.getDay()])return void o.internalShowEditor(e,null,{target:!0});b?await c.scrollTo(e):await c.await("refresh",!1),m=c.getEventElement(e)}m||n||!c.isDayCellRenderer||(m=c.getCell(e.startDate)),o.internalShowEditor(e,null,{target:m||n,allowTargetOut:c.isAnimating}),null!==(s=o.editor)&&void 0!==s&&s.lastAlignSpec&&(o.editor.lastAlignSpec.allowTargetOut=!1)}async onSaveClick(){const e=this,{eventRecord:t}=e,{isCreating:n}=t.meta;e.isValid&&(t.isCreating=!1);const r=await super.onSaveClick(...arguments);var i;n&&r&&(e.eventStore.added.add(t),e.eventStore.usesSingleAssignment||e.assignmentStore.added.add(t.assignments),null!==(i=e.client.crudManager)&&void 0!==i&&i.autoSync&&e.client.crudManager.scheduleAutoSync())}internalShowEditor(){var e,t,n,r;const{client:i,startTimeField:s,endTimeField:o,editor:a}=this,l=null!==(e=null===(t=i.activeView)||void 0===t?void 0:t.autoCreate)&&void 0!==e?e:i.autoCreate||i.constructor.configurable.autoCreate,c=null==l?void 0:l.step,{activeSubView:d}=i,u=null==d?void 0:d._overflowPopup;null===(n=i.features.eventTooltip)||void 0===n||null===(r=n._tooltip)||void 0===r||r.hide(),a.owner=null!=u&&u.isVisible?u:d,!1!==super.internalShowEditor(...arguments)?c&&(s&&(s.step=c),o&&(o.step=c)):a.owner=a.initialConfig.owner}}Mw.register(qw.type,qw),qw._$name="EventEdit";const Kw=e=>e.eventStore;class Xw extends Ib{static get $name(){return"EventMenu"}static get type(){return"eventMenu"}populateEventMenu({items:e,eventRecord:t,assignmentRecord:n}){super.populateEventMenu(...arguments);const{client:r}=this;e.duplicate={disabled:t.readOnly||(null==n?void 0:n.readOnly),hidden:r.readOnly}}getDataFromEvent(e){const{client:t}=this,{activeView:n}=t;n.isScheduler&&(this.client=n);const r=super.getDataFromEvent(e);return this.client=t,r}changeMenu(){const e=this,t=super.changeMenu(...arguments);return null==t||t.on({beforeShow({source:t}){const{activeSubView:n}=e.client,{_overflowPopup:r}=n;t.owner=null!=r&&r.containsFocus?r:n}}),t}changeItems(e){return(e=super.changeItems(...arguments)).unassignEvent=null,e}}v(Xw,"configurable",{items:{duplicate:{text:"L{EventMenu.duplicateEvent}",icon:"b-icon b-icon-copy",weight:400,onItem({eventRecord:e}){const t=e.copy(null,{skipFieldIdentifiers:!0}),{eventStore:n}=this.up(Kw),{resources:r}=e;t.name=`${e.name} (${this.L("copy")})`,t.recurrence=null,null!=r&&r.length&&n.assignmentStore.assignEventToResource(t,r),n.add(t)}}}}),Mw.register(Xw.type,Xw),Xw._$name="EventMenu";const Zw=e=>e.eventStore,Jw=["activeElement","client","clientListeners","disabled","showOn","tooltip"];class Qw extends Mw{static get $name(){return"EventTooltip"}static get type(){return"eventTooltip"}static get configurable(){return{activeElement:null,showOn:"click",closable:!0,axisLock:"flexible",tooltip:{$config:["lazy","nullify"],value:{type:"eventTip",align:{monitorResize:!0}}},titleRenderer:e=>_.encodeHtml(e.name),renderer:null,recurrenceConfirmation:{$config:["lazy","nullify"],value:{type:"recurrenceconfirmation"}},extendAllDayEndDay:null,align:null}}static get pluginConfig(){return{chain:["render"]}}get isVisible(){return!0}changeRecurrenceConfirmation(e,t){return e&&(e.rootElement=this.owner.rootElement),Ka.reconfigure(t,e,{owner:this})}changeTooltip(e,t){return Ka.reconfigure(t,e,{owner:this,setup:"setupTooltip"})}setupTooltip(e){const t=this,n=t.config;return Jw.forEach((e=>delete n[e])),Iw.mergeConfigs(n,{ownerFeature:t,id:`${t.client.id}-event-tip`,forSelector:"hover"===t.showOn&&".b-cal-event-wrap:not(.b-editing)",cls:{"b-eventedit":t.client.features.eventEdit},disabled:t.disabled,listeners:{thisObj:t,delete:"onDeleteClick",edit:"onEditClick",pointerOver:"onTipPointerOver",hide(){t.activeElement=null}}},e)}render(){const e=this,t={eventsPerCellChange:"onClientEventsPerCellChange",navigate:"onClientNavigate",thisObj:e};"hover"===e.showOn?e.getConfig("tooltip"):t[`event${e.showOn}`]="onClientTooltipGesture",e.client.on(t)}get owner(){var e;return null!==(e=this.client.activeView._overflowPopup)&&void 0!==e&&e.containsFocus?this.client.activeView.overflowPopup:this.client}addListener(...e){var t;null===(t=this.tooltip)||void 0===t||t.addListener(...e)}removeListener(...e){var t;null===(t=this.tooltip)||void 0===t||t.removeListener(...e)}onEditClick(){var e,t;const{client:n,activeClient:r,tooltip:i}=this,{overflowPopup:s}=r,o=(null==r||null===(e=r.features)||void 0===e?void 0:e.eventEdit)||n.features.eventEdit,a=(null==s||null===(t=s.element)||void 0===t?void 0:t.contains(i.activeTarget))?s.targetCell:i.activeTarget;o&&!o.disabled&&(o.editEvent(this.eventRecord,null,a),i.hide())}onDeleteClick(){this.activeClient.calendar.removeEvents([this.eventRecord],(()=>{var e;return null===(e=this.tooltip)||void 0===e?void 0:e.hide()}),this.tooltip)}onClientEventsPerCellChange(){var e,t;null===(e=this._tooltip)||void 0===e||e.requestAnimationFrame(null===(t=this._tooltip)||void 0===t?void 0:t.hide)}onClientNavigate(e){var t;!e.item&&this.owner.owns(e.event)||null===(t=this._tooltip)||void 0===t||t.hide()}onClientTooltipGesture({domEvent:e,event:t,eventElement:n,eventRecord:r,source:i}){this.activeElement=n,e=e||t,!1!==this.onTipPointerOver({event:e,target:n,eventRecord:r,owningCalendarWidget:i})&&this.tooltip.showByEvent(e,n)}onTipPointerOver({target:e,owningCalendarWidget:t,eventRecord:n}){var r,i,s;return t||(t=null===(s=Ka.fromElement(e))||void 0===s?void 0:s.closest(Zw)),n||(n=t.getEventRecord(e)),(null===(r=this.client.features)||void 0===r||null===(i=r.eventEdit)||void 0===i||!i.isEditing)&&(t&&(this.activeClient=t,n=t.getEventRecord(e),this.tooltip.eventRecord=this.eventRecord=n),null!=n)}updateActiveElement(e,t){null==t||t.classList.remove("b-cal-event-reveal"),null!=e&&e.classList.contains("b-cal-in-cluster")&&(null==e||e.classList.add("b-cal-event-reveal"))}updateDisabled(e,t){super.updateDisabled(e,t),this._tooltip&&(this._tooltip.disabled=e)}}Qw.initClass(),Qw._$name="EventTooltip";const eS={magnitude:1,unit:"hour"};class tS extends(Te.mixin(bd)){static get configurable(){return{dragItemSelector:".b-grid-row",droppable:!1,dragProxy:{type:"default",open(e){return this.owner.owner.openProxy(e)},dragMove(e){return this.owner.owner.moveProxy(e)},close(){var e;null===(e=this.owner.owner.proxyEl)||void 0===e||e.remove()}}}}beforeDrag(e){return this.owner.onDragStart(e)}}class nS extends(Mw.mixin(Zr)){static get $name(){return"ExternalEventSource"}static get delayable(){return{onCalendarPaint:"raf"}}static get type(){return"externalEventSource"}static get configurable(){return{grid:{$config:["lazy"],value:null},dragRootElement:null,dragItemSelector:null,getRecordFromElement:function(e){const t=this.grid||(this.grid=Ka.fromElement(e,"grid"));return t?t.getRecordFromElement(e):e.innerText},hideExternalProxy:!0,draggable:{$config:["lazy"],value:{}}}}onCalendarPaint({firstPaint:e}){e&&this.getConfig("draggable")}onDragStart(e){var t;const n=this,{client:r}=n,{eventStore:i}=r,{modelClass:s}=i;if(!e.itemElement)return!1;let o=n.callback(n.getRecordFromElement,n,[e.itemElement]);if(o.isModel)o.isEventModel||(o=i.createRecord(o.data));else{if("string"==typeof o){const e=r.activeView.autoCreate||r.autoCreate,t=en.parseDuration((null==e?void 0:e.duration)||eS);o={[s.getFieldDataSource("name")]:o,[s.getFieldDataSource("duration")]:t.magnitude,[s.getFieldDataSource("durationUnit")]:t.unit}}o=i.createRecord(o)}e.set("sourceStore",null===(t=n.grid)||void 0===t?void 0:t.store),e.set("eventRecord",o)}openProxy(e){const{grid:t}=this,n=e.element.closest(this.draggable.dragItemSelector),r=n.querySelector('[data-column="name"]'),i=this.proxyEl=Mr.createElement({className:"b-grid-to-cal-drag-proxy"});i.innerHTML=r?r.innerHTML:e.peek("eventRecord").name,this.proxyOffset=_n.getClientPoint(e.startEvent).getDelta(xn.from(n)),((null==t?void 0:t.element)||this.dragRootElement).parentNode.appendChild(i)}moveProxy(e){const{proxyEl:t}=this;t&&(this.client.owns(e.targetElement)&&this.hideExternalProxy?t.classList.add("b-hide-display"):(t.classList.remove("b-hide-display"),Mr.alignTo(t,_n.getClientPoint(e.event).translate(10,10),{align:"t0-t0"})))}changeDragRootElement(e){return"string"==typeof e&&(e=document.querySelector(e)||document.getElementById(e)),e}changeDraggable(e){const{grid:t}=this,n=(null==t?void 0:t.contentElement)||this.dragRootElement,{dragItemSelector:r}=this;return e=nS.mergeConfigs({owner:this,grid:t},e),n&&(e.dragRootElement=n),r&&(e.dragItemSelector=r),new tS(e)}changeGrid(e){return"string"==typeof e&&(e=Ka.getById(e)),e}}nS.initClass(),nS._$name="ExternalEventSource";class rS extends Mw{static get type(){return"loadOnDemand"}static get configurable(){return{startDateParamName:"startDate",endDateParamName:"endDate",dateFormat:"YYYY-MM-DD",beforeRequest:null}}construct(e){e.client.on({dateRangeChange:"onClientDateRangeChange",thisObj:this}),super.construct(...arguments)}onClientDateRangeChange({new:{startDate:e,endDate:t}}){this.disabled||this.loadDateRange(e,t)}loadDateRange(e,t){const{crudManager:n}=this.client,{load:r}=n.activeRequests,{beforeRequest:i}=this,s={request:{params:{[this.startDateParamName]:en.format(e,this.dateFormat),[this.endDateParamName]:en.format(t,this.dateFormat)}}};if(i&&this.callback(i,this.client,[s]),r)try{n.cancelRequest(r.desc,r.reject)}catch(e){}return n.load(s)}}rS.initClass(),rS._$name="LoadOnDemand";class iS extends mm{restoreState({client:e}){}saveState({client:e}){}cloneElement(e,t=this.element,n=!0){n&&(t.innerHTML=""),t.appendChild(e.cloneNode(!0))}pageTpl(e){const{config:t,title:n,header:r,footer:i,styles:s,htmlClasses:o,bodyStyle:a,bodyClasses:l=[`b-${this.constructor.type}`,...this.owner.bodyClasses,...Ka.outerCls],paperHeight:c,paperWidth:d,html:u}=e,h=y.isSafari?"":"window.removeElement && window.removeElement();",g=null!=t&&t.debug?"":`<script type="text/javascript">window.addEventListener('load', function() { window.print(); ${h} });<\/script>`;return Yc.tpl`
            <!DOCTYPE html>
            <html class="${o}" style="width: ${d}in; height: ${c}in;">
                <head>
                    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
                    <title>${n}</title>
                    ${s.join("")}
                </head>
                <body class="b-print ${l.join(" ")}" style="width: ${d}in; height: ${c}in; ${a}">
                    <div class="b-print-content">
                        ${r&&`<div class="b-print-header" style="width: 100%">${r}</div>`}
                        <div class="b-print-body"><div class="b-print-viewport">${u}</div></div>
                        ${i&&`<div class="b-print-footer" style="width: 100%">${i}</div>`}
                    </div>
                    ${g}
                </body>
            </html>`}}iS._$name="Printer";const sS={configurable:!0,get:()=>Number.MAX_SAFE_INTEGER};class oS extends iS{static get $name(){return"CalendarPrinter"}static get type(){return"calendar"}getTotalHeight(e){const{activeView:t}=e;switch(e.mode){case"agenda":return t.virtualScrollHeight;case"day":case"week":return t.dayContentElement.scrollHeight+t.alldayRowElement.offsetHeight;case"month":if(this.owner.wysiwyg)return t.weeksElement.scrollHeight+t.weekdaysHeader.offsetHeight+10;break;case"year":return this.inchToPx(im.A4.width)}}getTotalWidth(e){return"year"===e.mode?this.inchToPx(im.A4.height):this.inchToPx(im.A4.width)}async prepareComponent(e){const t=this,{owner:n}=t,{wysiwyg:r}=n,i=!r,{client:s}=e,{activeView:o}=s;if(t.exportMeta={title:n.callback(n.titleRenderer,n,[o]),totalWidth:t.getTotalWidth(s),totalHeight:t.getTotalHeight(s),subGrids:{}},"month"===s.mode&&i&&(Object.defineProperty(o,"eventsPerCell",sS),o.doRefresh()),t.cloneElement(o.currentElement),"month"===s.mode){let e;i&&(e=o.shrinkwrapRowHeights,delete o.eventsPerCell,o.doRefresh(),t.exportMeta.totalHeight=o.weekdaysHeader.offsetHeight+e.reduce(((e,t)=>e+t),5)),o.weekElements.forEach(((n,s)=>{const o=t.element.querySelector(`[data-week="${n.dataset.week}"]`);o.style.minHeight="",o.style.flex=i?`0 0 ${e[s]}px`:r?`1 0 ${n.offsetHeight}px`:`1 0 ${250/6}mm`}))}}pxToInch(e){return(e/96).toFixed(2)}}oS.prototype.pagesExtractor=async function*(e){const t=this,{totalHeight:n,totalWidth:r,title:i}=t.exportMeta;yield{html:t.pageTpl({config:e,title:i,html:t.prepareExportElement(),styles:t.stylesheets,paperWidth:t.pxToInch(r),paperHeight:t.pxToInch(n)})}},oS._$name="CalendarPrinter";const aS=Object.freeze([]);class lS extends Mw{static get $name(){return"Print"}static get type(){return"print"}static get configurable(){return{printer:{$config:["lazy","nullify"],value:{type:"calendar"}},wysiwyg:!1,titleRenderer:e=>e.description,printers:new Map([[oS.type,oS]])}}construct(){super.construct(...arguments),this.client.print=this.print.bind(this)}changePrinter(e){const t=this,n=t.printersMap||(t.printersMap=new Map);if(e){let r;const{type:i}=e;if(n.has(i))r=n.get(i),r.setConfig(e);else{const s=t.printers.get(i);if(!s)throw new Error(`Printer type ${i} is not found. Make sure you've configured it`);(e=sn.clone(e)).owner=t,r=new s(e),r.relayAll(t),n.set(i,r)}return r}n.forEach((e=>e.destroy()))}get bodyClasses(){return this.shrinkwrapRowHeights?["b-shrinkwrap-row-heights"]:aS}async print(e={}){const t=this,{client:n,printer:r}=t,i=`${n.id}-print-iframe`;if(!1!==n.trigger("beforePrint",{config:e,printer:r})){e.client=n;const r=await t.printer.export(e);if(!e.debug){var s;null===(s=document.getElementById(i))||void 0===s||s.remove();const e=Mr.createElement({id:i,class:"b-calendar-print-iframe",tag:"iframe",parent:document.body});return e.contentWindow.removeElement=()=>{e.remove(),n.trigger("print",r)},e.contentWindow.document.write(r[0].html),e.contentWindow.document.close(),r}n.trigger("print",r)}}}lS.initClass(),lS._$name="Print";class cS extends Yb{static get $name(){return"ScheduleMenu"}static get type(){return"scheduleMenu"}getDataFromEvent(e){const{client:t}=this,{activeView:n}=t,r=t.resolveResourceRecord(e)||t.defaultCalendar;n.isScheduler&&(this.client=n);const i=super.getDataFromEvent(e);return i.resourceRecord||(i.resourceRecord=r),this.client=t,i}shouldShowMenu({date:e,targetElement:t}){const{client:n}=this,{activeView:r}=n;if(r.isScheduler){this.client=r;const e=super.shouldShowMenu(...arguments);return this.client=n,e}return Boolean(e&&!t.closest(n.eventSelector))}}Mw.register(cS.type,cS),cS._$name="ScheduleMenu";class dS extends Mw{static get $name(){return"WeekExpander"}static get type(){return"weekExpander"}static get pluginConfig(){return{chain:["render"]}}render(){const{client:e}=this,t=this.monthView=e.isMonthView?e:e.modes.month;if(t){const{weekRenderer:e}=this;t.showWeekColumn=!0,t.weekRenderer=t.weekRenderer?$e.createSequence(t.weekRenderer,e):e,t.on({weeknumberclick:"onWeekNumberClick",thisObj:this,prio:1e4})}}weekRenderer(e,[t,n]){e.querySelector(".b-week-toggle-tool-wrap")||Mr.createElement({parent:e,className:"b-week-toggle-tool-wrap",children:[{className:"b-icon b-week-toggle-tool",dataset:{btip:this.L("L{WeekExpander.expandTip}")}}]})}onWeekNumberClick({domEvent:e,date:t}){const n=e.target.closest(".b-week-toggle-tool");if(n&&!this.disabled){const r=e.target.closest(".b-calendar-row");return r.classList.contains("b-shrinkwrapped")?(this.monthView.flexWeekRow(t),n.dataset.btip=this.L("L{expandTip}")):r.classList.contains("b-has-overflow")&&(this.monthView.shrinkwrapWeekRow(t),n.dataset.btip=this.L("L{collapseTip}")),!1}}updateDisabled(e,t){super.updateDisabled(e,t),this.client.element.classList.toggle("b-weekexpander",!e)}}dS.initClass(),dS._$name="WeekExpander";class uS extends(Te.mixin(Ci)){static get factoryable(){}static get configurable(){return{overlapTolerance:null}}clusterize(e,t,n){const r=e[e.length-1]||null;t.push(n),r&&this.overlaps(r,n)?(n.cluster=r,r.end=Math.max(r.end,n.end),r.items.push(n)):e.push(n.cluster={start:n.start,end:n.end,items:[n]})}layoutEvents({date:e,tomorrow:t,events:n,dayTime:r,denominator:i=100,numerator:s=1e4}){const o=this,a=r.duration("s"),l=(e,t)=>(e=Math.round(e*s)/i,t?`calc(${Mr.percentify(e)} ${t<0?"-":"+"} ${Math.abs(t)}px)`:e),c=[],d=[];let u,h,g;for(u=0,g=(n=r.sortEvents(e,n.slice())).length;u<g;u++)h=o.createLayoutItem(r,n[u],e,a,t),o.clusterize(c,d,h);for(u=0,g=c.length;u<g;++u)o.layoutCluster(c[u],l,r);for(u=0,g=d.length;u<g;u++)h=d[u],h.top=l(h.start/a),h.bottom=l(h.end/a),h.height=h.bottom-h.top;return d}createLayoutItem(e,t,n,r,i){const{allDay:s,startDate:o,endingDate:a}=t,l=s||o<n?0:e.delta(o,"s"),c=s||a>=i?r:e.delta(a,"s");return{eventRecord:t,id:t.id,start:Math.max(l,0),end:Math.min(c,r),startsBefore:o<n||l<0,endsAfter:i<a||c>r}}overlaps(e,t,n,r){var i;return"string"==typeof n&&(r=n,n=null),r=r||"end",n=null!==(i=n)&&void 0!==i?i:60*this.overlapTolerance||0,e.start<t[r]-n&&t.start<e[r]-n}}uS._$name="DayLayout";class hS extends(xy()){static get defaultConfig(){return{coordProp:"left",sizeProp:"width"}}pack(e){const t=e.map((e=>{const{startDate:t}=e.eventRecord,n=new Date(t);return n.setSeconds(n.getSeconds()+e.maxEnd-e.start),{item:e,start:t,end:n,x:0}}));this.packEventsInBands(t,((e,t,n,r)=>{e.width=r,e.w=r*gS,e.x+=(e.left=n.start+t*r)*gS,e.item.x=e.x,e.item.w=e.w}))}}const gS=1e4,mS=Object.freeze([]),pS=new hS;class fS extends uS{static get type(){return"fluid"}static get configurable(){return{clearanceMinutes:45,complexityLimit:2e3,escapeMinutes:null,gutter:!0,gutterWidth:5,indentWidth:10,staggerMaximum:null,staggerMinimum:.4,staggerWidth:!0,stretch:null}}layoutCluster(e,t,n){const r=this,{indentWidth:i,staggerMaximum:s,staggerMinimum:o,stretch:a}=r,{items:l}=e,{length:c}=l,d=r.gutter?r.gutterWidth:0,u=d>=1,h=i>=1,g=[0,0],m=[0,0],p=r.treeify(e);let f,v,{staggerWidth:y}=r;!0===y&&(y=d);const b=y>=1;for(r._assignSizes(l,p),f=0;f<c;f++){const e=l[f],n=e.depth,r=e.majorParent||e,c=r.x,p=r.w;v=y*(n.height+n.overlap),v=s?Math.min(s,v):v,g[0]=h?c:c+n.minor*i*p,g[1]=h?n.minor*i:0,m[0]=a?1-g[0]:p-g[0]+c,m[1]=-g[1],(a||Math.abs(1-(g[0]+m[0]))<1e-6)&&(m[u?1:0]-=u?d:d*p),o&&(e.minWidth=m[1]?`calc(${o} * (${Mr.percentify(t(m[0]))} - ${-m[1]}px))`:`calc(${o} * ${Mr.percentify(t(m[0]))})`),m[b?1:0]-=b?v:v*p,e.left=t(...g),e.width=t(...m)}}treeify(e){const{items:t}=e,{length:n}=t,r=[];for(let e=0;e<n;e++)this._addChild(t[e],e,r);return r}_addChild(e,t,n){const r=this,{clearanceMinutes:i,escapeMinutes:s,stretch:o}=r,a=60*i,l=a+60*s,c=60*(r.overlapTolerance||0),d=e=>10*e.depth.minor+e.depth.major*(o?1:0),u={depth:0,height:0,heightMajor:0,overlap:0,major:0,minor:0};if(e.parent=null,e.maxEnd=e.maxEndMajor=e.end,e.depth=u,e.order=t,!n.length)return n[0]=e,void(e.barriers=mS);let h,g,m,p,f,v,y=0;for(p of n){if(h=p.lastItem||p,!r.overlaps(e,p,c,"maxEnd")){f=p.parent,g=!0;break}if(b=e,C=h,Math.abs(C.start-b.start)>=a){for(m=!0,g&&(g=!1,f=null);h!==p&&!r.overlaps(h,e,c);h=h.parent);v=d(h),(!f||v<y)&&(f=h,y=v)}else m||(g=!0,f=p)}var b,C;if(g)m=0,g=f?f.depth.major+1:0,p=f=n[g-1]||null;else{for(p=f.majorParent||f;l&&f!==p&&!(r.overlaps(f,e,c)&&e.start-f.start<l);f=f.parent);m=f.depth.minor+1,g=f.depth.major}e.parent=f,u.major=g,u.minor=m,u.depth=f?f.depth.depth+1:0,m?(e.majorParent=p,e.previousItem=p.lastItem,p.lastItem=e):r._addMajor(e,n),r._adjustOverlap(e),r._adjustParents(e)}_addMajor(e,t){const n=this,{stretch:r}=n;if(t[e.depth.major]=e,e.barriers=n._getOverlaps(t,e,1),r||e.barriers.length)for(const i of n._getOverlaps(t,e,-1)){const t=i.barriers.filter((t=>!e.barriers.includes(t)));(r||t.length<i.barriers.length)&&(i.barriers=t,t.push(e))}}_adjustOverlap(e){if(e.depth.minor){let t,n;for(n=e;n.depth.minor>1;n=n.parent);for(t=0;n=n.previousItem;)this.overlaps(n,e)&&(t=Math.max(t,n.depth.height+n.depth.overlap+1));e.depth.overlap=t}}_adjustParents(e){const{depth:t,end:n}=e,r=t.minor+t.overlap;for(let i,s=e;s=s.parent;)if(i=s.depth,i.major===t.major)for(s.maxEnd=Math.max(s.maxEnd,n);i.height<r-i.minor;)++i.height,i.overlap&&--i.overlap;else i.heightMajor=Math.max(i.heightMajor,t.major-i.major)}_assignSizes(e,t){const{complexityLimit:n,stretch:r}=this,i=e.filter((e=>!e.depth.minor));if(n)for(const e of i){const i=e.barriers.map((e=>[e])),{parent:s}=e,o=e.depth.heightMajor+1;e.x=s?s.x+s.w:0;let a,l,c,d,u,h,g,m=(1-e.x)/o;if(i.length){for(a=0;a<i.length;){if(d=i[a],c=c||d,a>n){m=1/t.length;break}if(u=d[d.length-1],u.order<e.order)++a,g=u.x,l=0;else{if(u.barriers.length){i.splice(a,1,...u.barriers.map((e=>d.concat(e)))),c===d&&(c=null);continue}++a,g=1,l=1}h=(g-e.x)/(l+d.length),h<m&&(m=h,c=d)}if(r){for(h=c.reduce(((e,t)=>e+t.depth.height+1),0),a=e.lastItem;a;a=a.previousItem)a.depth.overlap+=h;e.depth.overlap+=h}}e.w=m}else{pS.pack(i);for(const e of i)e.x/=gS,e.w/=gS}}_getOverlaps(e,t,n){const{end:r}=t,i=n<0?-1:e.length;let s,o,a,{start:l}=t;for(s=t.depth.major+n;s!==i&&l<r;s+=n)o=e[s],l<o.maxEnd&&o.start<r&&((a||(a=[])).push(o),l=o.maxEnd);return a||mS}}fS.initClass(),fS._$name="FluidDayLayout";var vS=e=>class extends(Dy(e||Te)){static get $name(){return"CalendarStores"}static get configurable(){return{defaultCalendar:null,crudManagerClass:null,crudManager:null}}static get projectStores(){return{resourceStore:{dataName:"resources",listeners:{changePreCommit:"onCalendarStoreChange"}},eventStore:{dataName:"events",listeners:{changePreCommit:"onCalendarStoreChange"}},assignmentStore:{dataName:"assignments"}}}changeCrudManager(e){var t;const n=this;e&&!e.isCrudManager&&(e=n.crudManagerClass.new({scheduler:n},e)),n._crudManager=e,null===(t=n.bindCrudManager)||void 0===t||t.call(n,e)}get defaultCalendar(){const{eventStore:e}=this,t=sn.hasOwn(this,"_defaultCalendar")?this._defaultCalendar:e.defaultCalendarId;if(null!==t)return null!=t?t.isResourceModel?t:e.resourceStore.getById(t):e.resourceStore.first}get defaultCalendarId(){return this.eventStore.modelClass.asId(this.defaultCalendar)}updateProject(e,t){super.updateProject(e,t),this.detachListeners("CalendarStores"),e.on({name:"CalendarStores",dataReady:"onCalendarStoreChange",refresh:"onProjectRefresh",thisObj:this})}onProjectRefresh({source:e,isInitialCommit:t}){t&&e.eventStore.invalidateDayIndices()}updateEventStore(e,t){if(t&&delete t.createRecord,e&&!e.isCalendarEventStore){const t=this;Object.defineProperty(e,"defaultCalendar",{get:()=>t.defaultCalendar}),e.isCalendarEventStore=!0}}get widgetClass(){}};class yS extends Array{constructor(...e){super(...e),v(this,"firstFreeSlot",0)}set(e,t){const n=this;if(null==e)return n.add(t);if(n[e]=t,n.firstFreeSlot===e)for(;n[n.firstFreeSlot];)n.firstFreeSlot++}add(e){const t=this.firstFreeSlot;for(this[t]=e;this[this.firstFreeSlot];)this.firstFreeSlot++;return t}setEvents(e){const t=this.length=this.firstFreeSlot=e.length;for(let n=0;n<t;n++)this[n]=e[n]}}yS._$name="EventSlots";class bS extends Te{static defaultSorterFn(e,t){e=e.eventRecord||e,t=t.eventRecord||t;const{startDate:n}=e,{startDate:r}=t;return n?r?n-r||t.durationMS-e.durationMS:1:-1}static interDaySorterFn(e,t){e=e.eventRecord||e,t=t.eventRecord||t;const{startDate:n,isInterDay:r}=e,{startDate:i,isInterDay:s}=t;return n?i?r!==s?Number(s)-Number(r):n-i||t.durationMS-e.durationMS:1:-1}}bS._$name="EventSorter";const CS=e=>e.isCalendarMixin&&e.eventStore,wS=/(touch|mouse|pointer|key|context|dbl)(.*)/,SS=(e,t,n)=>`${_.capitalize(t)}${_.capitalize(n)}`;var DS=e=>class extends(e||Te){static get $name(){return"SchedulerInterface"}calendarHitTest(e){const{activeView:t}=this,n=Mr.getEventElement(e);return null!=t&&t.element.contains(n)?t.calendarHitTest(e):null}get timeAxis(){const e=this;return e._timeAxis||(e._timeAxis={get startDate(){return e.activeView.startDate},get endDateDate(){return e.activeView.endDate},isTimeSpanInAxis(e){return en.intersectSpans(e.startDate,e.endDate,this.startDate,this.endDate)}}),this._timeAxis}get timeAxisViewModel(){const e=this;return e._timeAxisViewModel||(e._timeAxisViewModel={get timeResolution(){return e.activeView.timeResolution||{}}}),this._timeAxisViewModel}resolveEventRecord(e){var t;e instanceof Event&&(e=e.target);const n=null===(t=this.constructor.fromElement(e))||void 0===t?void 0:t.closest(CS);return null==n?void 0:n.getEventRecord(e)}resolveAssignmentRecord(){}resolveResourceRecord(e){var t;const{activeView:n}=this;if(n.isResourceView){const t=(e.nodeType===Node.ELEMENT_NODE?e:e.target).closest(".b-overflowpopup"),r=t?bryntum.fromElement(t,"overflowpopup").owner:bryntum.fromElement(e,n.viewType.type);if(r)return r.resource}return null===(t=this.resolveEventRecord(e))||void 0===t?void 0:t.resource}handleEvent(e){const t=(e=>e.type.replace(wS,SS))(e);if(super.handleEvent)super.handleEvent(e);else if(!e.handled&&!e.schedulerRedirected){var n;!1!==this.trigger(`beforeElement${t}`,{event:e})&&(null===(n=this[`onElement${t}`])||void 0===n||n.call(this,e)),e.schedulerRedirected=!0}}onInternalKeyDown(e){var t;null===(t=this.onCalendarPointerInteraction)||void 0===t||t.call(this,e)}getCellDataFromEvent(e){var t;return null===(t=super.getCellDataFromEvent)||void 0===t?void 0:t.call(this,e)}getDateFromDomEvent(e){var t;const n=null===(t=this.constructor.fromElement(e))||void 0===t?void 0:t.closest(CS);if(n)return n.getDateFromDomEvent(e)}createEvent(){this.activeView.createEvent(...arguments)}get enableRecurringEvents(){return!0}getRowFor(){}suspendRefresh(){}resumeRefresh(){}get widgetClass(){}};const ES=new String("");var xS=e=>{var t;return v(t=class extends(e||Te){createEventDomConfig(e,t=this.eventRenderer){var n,r,i;const s=this,{eventHeight:o,intradayCls:a,alldayCls:l,solidBarCls:c,pastEventCls:d,showTime:u,timeFormat:h,rtl:g}=s,m=s.up("calendar"),{eventRecord:p,minimal:f}=e,v=e.eventEndDate||p.endingDate,y=p.isOccurrence?p.recurringEvent.resource:p.resource,b=p.isRecurring||p.isOccurrence,C="isAllDay"in e?e.isAllDay:null===(n=s.isAllDayEvent)||void 0===n?void 0:n.call(s,p),w={height:"auto"!==o?Mr.setLength(o):null},S=null==m?void 0:m.eventSelectedCls,D=e.dataset={eventId:p.id};let E=s.internalBodyContentRenderer(p),x="string"!=typeof E,R=x?"children":"html",T=p.color||p.eventColor||(null==y?void 0:y.eventColor)||ES;if(e.cls=p.cls.clone(),e.solidBar=C||f,e.iconStyle="header"===s.iconTarget&&s.showTime&&!Mr.isNamedColor(T)?{color:T}:{},e.iconCls=new Mn(p.iconCls),e.style=Object.assign(Mr.parseStyle(null==y?void 0:y.eventStyle),Mr.parseStyle(p.style)),e.eventColor=T,e.eventHeight=o,e.cls[s.shortEventCls]=p.durationMS<=s.shortEventDuration,null!=y&&y.cls&&e.cls.add(y.cls),t&&!f){const n=s.callback(t,s,[{eventRecord:p,resourceRecord:y,renderData:e}]);e.eventHeight!==o&&(w.height=Mr.setLength(e.eventHeight)),null!=n&&(x=!0,E=n,"string"!=typeof E&&(E=ke.asArray(E),R="children")),"string"==typeof e.cls&&(e.cls=new Mn(e.cls)),"string"==typeof e.iconCls&&(e.iconCls=new Mn(e.iconCls)),"string"==typeof e.style&&(e.style=Mr.parseStyle(e.style))}E=[{className:{"b-cal-event-desc":1,"b-cal-event-desc-complex":x},[R]:E}],Object.assign(e.cls,{"b-cal-event-wrap":1,"b-iscreating":p.isCreating,"b-readonly":p.readOnly,"b-minimal":f,[l]:l&&C,[c]:c&&e.solidBar,[a]:a&&!C,[d]:d&&v<new Date,[S]:S&&(null==m?void 0:m.isEventSelected(p)),"b-rtl":g}),T=e.eventColor,null!==(r=T)&&void 0!==r&&r.length&&(Mr.isNamedColor(T)?e.cls[`b-cal-color-${T}`]=1:e.solidBar?w["background-color"]=T:w[s.eventColourStyleProperty]=T),!u||C&&this.showAllDayHeader||E.unshift({className:"b-event-header",children:[{className:"b-event-time",html:en.format(p.startDate,h)}]});const M=Boolean(null===(i=e.iconCls)||void 0===i?void 0:i.length),k=!M&&b,I=s.showCircle&&!M&&!b,A={tag:"i",className:Object.assign({"b-cal-event-icon":!k,"b-cal-recurrence-icon":k,"b-icon":1,"b-fw-icon":1,"b-icon-circle":I,"b-icon-recurring":k},e.iconCls),style:e.iconStyle},F=[{className:"b-cal-event-body",children:E}],O="header"===s.iconTarget&&s.showTime?E[0].children.length>0?E[0].children:E:F;return(M||k||I)&&("header"===s.iconTarget&&s.showTime?O.push(A):O.unshift(A)),M&&b&&O.push({tag:"i",className:{"b-cal-recurrence-icon":1,"b-icon":1,"b-fw-icon":1,"b-icon-recurring":1},style:e.iconStyle}),{tabIndex:f?null:0,dataset:D,className:e.cls,style:e.style,children:[{className:"b-cal-event",style:w,children:f?null:F}]}}internalBodyContentRenderer(e){var t;const n=_.encodeHtmlBR(e.name),{showResourceAvatars:r}=this;if(r&&null!==(t=e.assigned)&&void 0!==t&&t.size){const t=[{class:"b-cal-event-resource-avatars",children:e.resources.map((e=>this.getResourceAvatar(e)))},{tag:"span",class:"b-cal-event-name",html:n}];return"last"===r?t.reverse():t}return n}},"$name","EventRenderer"),v(t,"configurable",{eventRenderer:null}),t};const RS=ot.mergeLocales(OC,{EventEdit:{Calendar:"Calendar","All day":"All day",day:"Day",week:"Week",month:"Month",year:"Year",decade:"Decade"},EventMenu:{duplicateEvent:"Duplicate event",copy:"copy"},Calendar:{Today:"Today",next:e=>`Next ${e}`,previous:e=>`Previous ${e}`,plusMore:e=>`+${e} more`,allDay:"All day",endsOn:e=>`Ends ${e}`,weekOfYear:([e,t])=>`Week ${t}, ${e}`},CalendarDrag:{holdCtrlForRecurrence:"Hold CTRL for a recurring event"},CalendarMixin:{eventCount:e=>`${e||"No"} event${1===e?"":"s"}`},EventTip:{"Edit event":"Edit event",timeFormat:"LST"},ModeSelector:{includeWeekends:"Include weekends",weekends:"Weekends"},AgendaView:{Agenda:"Agenda"},MonthView:{Month:"Month",monthUnit:"month"},WeekView:{weekUnit:"week"},YearView:{Year:"Year",yearUnit:"year"},EventList:{List:"List",Start:"Start",Finish:"Finish"},DayView:{Day:"Day",dayUnit:"day",daysUnit:"days",expandAllDayRow:"Expand all-day section",collapseAllDayRow:"Collapse all-day section",timeFormat:"LST"},Sidebar:{"Filter events":"Filter events"},WeekExpander:{expandTip:"Click to expand row",collapseTip:"Click to collapse row"}});lt.registerLocale("En",{desc:"English",locale:RS});const TS=Promise.resolve(),MS=Object.freeze({}),{eventNameMap:kS}=_n,IS=e=>e.isCalendarMixin&&e.containsFocus;var AS=e=>{var t;return t=class t extends((e||Te).mixin(HC,DS,wd,vS,xS,_h)){static get configurable(){return{localizableProperties:["autoCreate.newName"],eventStore:null,resourceStore:null,eventSorter:bS.defaultSorterFn,responsive:{},hideNonWorkingDays:null,hideNonWorkingDaysCls:"b-hide-nonworking-days",weekStartDay:en.weekStartDay,nonWorkingDays:{value:en.nonWorkingDays,$config:{merge:"replace"}},nonWorkingDayCls:"b-nonworking-day",dayCellCls:"b-calendar-cell",weekendCls:"b-weekend",todayCls:"b-today",pastEventCls:"b-past-event",shortEventCls:"b-short-event",shortEventDuration:"30 minutes",eventHeight:25,eventSpacing:2,intradayCls:"b-intraday",alldayCls:"b-allday",solidBarCls:"b-solid-bar",dayNameSelector:".b-day-name",showTime:!1,timeFormat:"LT",showCircle:!0,eventColourStyleProperty:"color",handlePointerInteraction:!0,shortDateFormat:"ll",shortDateTimeFormat:"ll LT",readOnly:null,autoCreate:{gesture:"dblclick",newName:"L{Object.newEvent}",step:"15 minutes",duration:"1 hour",startHour:8},autoRefresh:{$config:{merge:"classList"},value:null},allowOverlap:!0,syncViewDate:!0,focusable:!1,avatarRendering:{$config:"lazy",value:null},showResourceAvatars:null,resourceImagePath:null,minDate:null,maxDate:null,animateTimeShift:!0,testConfig:{animateTimeShift:!1}}}static get delayable(){return{refreshSoon:{type:"raf",cancelOutstanding:!0}}}static get featureable(){return{factory:Mw}}construct(e){var t;const n=this;super.construct(e),n.isYearView||-1===n.element.tabIndex||-1===(null===(t=n.contentElement)||void 0===t?void 0:t.tabIndex)||((n.contentElement||n.element).tabIndex=-1),n.getConfig("avatarRendering"),_n.on({element:n.element,keydown:"onCalendarKeyDown",thisObj:n}),n.handlePointerInteraction&&_n.on({element:n.element,mouseover:"onEventMouseOverOut",mouseout:"onEventMouseOverOut",mousedown:"onCalendarPointerInteraction",mouseup:"onCalendarPointerInteraction",click:{handler:"onCalendarPointerInteraction",block:300},dblclick:"onCalendarPointerInteraction",contextmenu:"onCalendarPointerInteraction",thisObj:n})}onConfigChange(e){var t;null!==(t=this.autoRefresh)&&void 0!==t&&t[null==e?void 0:e.name]&&this.refreshSoon(),super.onConfigChange(e)}changeAvatarRendering(e){return Yh.new({element:this.element},e)}updateShowResourceAvatars(e){e&&(this.avatarRendering||(this.avatarRendering=!0))}getResourceAvatar(e){return this.avatarRendering.getResourceAvatar({resourceRecord:e,imageUrl:!1===e.image?null:e.imageUrl||e.image&&this.resourceImagePath+e.image,color:e.eventColor,initials:e.initials,dataset:{btip:_.encodeHtml(e.name),resourceId:e.id}})}updateEventHeight(e){const{style:t}=this.element;this._eventHeightInPixels=null,t.setProperty("--event-height",Mr.setLength(e)),t.setProperty("--arrow-width","calc(var(--event-height) / 3)"),t.setProperty("--arrow-margin","calc(var(--event-height) / -3)"),this.isConfiguring||this.refreshSoon()}get eventHeightInPixels(){const e=this,{eventHeight:t}=e;let n=e._eventHeightInPixels;return"auto"!==t&&(n||(n=e._eventHeight,"string"==typeof n&&(n=Mr.measureSize(n,e.contentElement.querySelector(`.${e.eventBarContainerCls}`),!1)),e._eventHeightInPixels=n)),n}get visibleCellSelector(){const e=[];return this.hideOtherMonthCells&&e.push(`.${this.otherMonthCls}`),this.hideNonWorkingDays&&e.push(`.${this.nonWorkingDayCls}`),`.${this.dayCellCls}${e.length?`:not(${e.join(",")})`:""}`}get activeView(){return this}get activeSubView(){var e;const{items:t}=this;return(null===(e=t.filter(IS))||void 0===e?void 0:e[0])||this}eachView(e,t,n=null){this.callback(e,n||this,t||[this])}get focusElement(){const{calendar:e}=this;if(e){const{navigator:t}=e;return t.activeItem||t.previousActiveItem||this.element.querySelector(t.itemSelector)||super.focusElement}}captureFocusItem(e){const t=this.getEventRecord(e),n=super.captureFocusItem(e);return(e=!0)=>{const r=t&&this.getEventElement(t);r?e?r.focus():Mr.focusWithoutScrolling(r):null==n||n(e)}}refresh(){this.refreshSoon.cancel(),this.month&&this.element.style.setProperty("--week-length",this.month.weekLength),this.whenVisible("refreshNow")}refreshNow(){const e=this.captureFocus();this.doRefresh(),e()}get displayName(){return _.capitalize(this.title||this.type)}get hiddenNonWorkingDays(){return this.hideNonWorkingDays?this.nonWorkingDays||this.month.nonWorkingDays:MS}changeAutoCreate(e){const n=t.$meta.config.autoCreate;return!0===e?n:("string"==typeof e&&(e={gesture:e}),ae.merge(e,n))}updateDateSeparator(){this.refreshCalendarDescription()}updateDescriptionFormat(){this.refreshCalendarDescription()}refreshCalendarDescription(){const{calendar:e}=this;null!=e&&e.isPainted&&e.activeView===this&&e.updateViewDescription()}changeShortEventDuration(e){return isNaN(e)?en.as("ms",e):Number(e)}updateShortEventDuration(){this.isConfiguring||this.refresh()}updateLocalization(){"weekStartDay"in this.initialConfig||(this.weekStartDay=en.weekStartDay),"nonWorkingDays"in this.initialConfig||(this.nonWorkingDays=en.nonWorkingDays),super.updateLocalization(),this.refreshCalendarDescription()}updateAutoCreate(e){this.updateLocalization()}updateWeekStartDay(e){var t;const{refreshCount:n,month:r}=this;null===(t=super.updateWeekStartDay)||void 0===t||t.call(this,e),r&&(r.weekStartDay=e),this.isPainted&&this.refreshCount===n&&this.refresh()}changeNonWorkingDays(e){const t=this,n=new Proxy(sn.assign({},e),{set(e){const n=Reflect.set(...arguments);return t.updateNonWorkingDays(e),n},deleteProperty(e){const n=Reflect.deleteProperty(...arguments);return t.updateNonWorkingDays(e),n}});return n}updateNonWorkingDays(e){var t;const{refreshCount:n,month:r}=this;null===(t=super.updateNonWorkingDays)||void 0===t||t.call(this,e),r&&(r.nonWorkingDays=e),this.isPainted&&this.refreshCount===n&&this.refresh()}dayOfDate(e){return en.clearTime(e)}ingestDate(e){if(e="string"==typeof e?en.parse(e):new Date(e),isNaN(e))throw new Error("Calendar widget date ingestion must be passed a Date, or a YYYY-MM-DD date string");return this.dayOfDate(e)}changeDate(e,t){if(e=this.ingestDate(e),this.isInIsValidTargetDate||this.isValidTargetDate(e))return(!t||e-t)&&!1!==this.trigger("beforeDateChange",{date:e,oldDate:t})?e:void 0}isValidTargetDate(e,t){var n,r;const i=this,s=i.minDate||(null===(n=i.calendar)||void 0===n?void 0:n.minDate),o=i.maxDate||(null===(r=i.calendar)||void 0===r?void 0:r.maxDate);if(!isNaN(s)||!isNaN(o)){this.isInIsValidTargetDate=!0;const n=t?i[`change${_.capitalize(t)}Date`](e,null):e;if(i.isInIsValidTargetDate=!1,!isNaN(s)&&n<s)return!1;if(!isNaN(o))return!("end"===t?n>o:n>=o)}return!0}changeStartDate(e){if(e&&(e=this.ingestDate(e),this.isInIsValidTargetDate||this.isValidTargetDate(e,"start")))return e}changeEndDate(e){if(e&&(e=this.ingestDate(e),this.isInIsValidTargetDate||this.isValidTargetDate(e,"end")))return e}async scrollTo(e,t={animate:!0}){const n=this,{scrollable:r}=n;let i=TS;if(n.scrollPromise&&await n.scrollPromise,e.isEvent){const t=e;en.intersectSpans(n.startDate,n.endDate,e.startDate,e.endDate)||(n.date=e.startDate),(e=n.getEventElement(e))||(n.refresh(),e=n.getEventElement(t))}else e=n.changeDate(e),en.betweenLesser(e,n.startDate,n.endDate)&&n.getDayElement(e,!0)||(n.date=e),e=n.getDayElement(e);return r?i=r.scrollIntoView(e,t):t.highlight&&("boolean"==typeof t.highlight?Mr.highlight(xn.from(e)):n.callback(t.highlight,n,[e,n])),n.scrollPromise=i}async checkAutoCreateGesture(e,t){var n,r;if(this.isVisible&&!this.readOnly&&e.type===(null===(n=this.autoCreate)||void 0===n||null===(r=n.gesture)||void 0===r?void 0:r.toLowerCase()))return this.createEvent(t)}async createEvent(e){var t;const n=this.autoCreate;n||(this.autoCreate=!0);const r=this,i=r.calendar||(null===(t=r.owner)||void 0===t?void 0:t.calendar),{eventStore:s}=i,{autoCreate:o,defaultCalendar:a}=r,{modelClass:l}=s,{newName:c}=o,d=en.startOf(e,void 0,void 0,r.weekStartDay),u=isNaN(o.startHour)?en.getTimeOfDay(en.parse(o.startHour,"HH:mm:ss")):1e3*o.startHour*60*60,h=e-d?en.round(e,o.step):en.add(d,u),g=en.parseDuration(o.duration),m=en.as("ms",g),p=en.add(h,m),f=r.resolveCallback(c,r,!1)?r.callback(c,r,[r,h]):c,v={[l.getFieldDataSource("name")]:f,[l.getFieldDataSource("startDate")]:h,[l.getFieldDataSource("endDate")]:p,[l.getFieldDataSource("duration")]:g.magnitude,[l.getFieldDataSource("durationUnit")]:g.unit,allDay:1===en.diff(h,p,"day")},y=s.createRecord(v);null!=i&&i.features.eventEdit&&!i.features.eventEdit.disabled&&(y.isCreating=!0),a&&s.assignmentStore.assignEventToResource(y,a),await s.addAsync(y),r.editAutoCreatedEvent(y),n||(r.autoCreate=!1)}editAutoCreatedEvent(e){this.trigger("eventAutoCreated",{eventRecord:e})}get duration(){return this.endDate?this.calculateDuration(this.startDate,this.endDate):1}calculateDuration(e,t){return en.diff(e,t,"day")}next(){this.date=en.add(this.date,this.duration,"day")}previous(){this.date=en.add(this.date,-this.duration,"day")}get eventContentElement(){return this.contentElement}get firstVisibleCell(){return this.eventContentElement.querySelector(this.visibleCellSelector)}get lastVisibleCell(){const e=this.contentElement.querySelectorAll(this.visibleCellSelector);return e[e.length-1]}get firstVisibleDate(){const e=new Date(this.startDate),{month:t}=this.month;for(;this.hideOtherMonthCells&&e.getMonth()!==t||this.hiddenNonWorkingDays[e.getDay()];)e.setDate(e.getDate()+1);return e}get lastVisibleDate(){const e=en.add(this.endDate,-1,"d"),{month:t}=this.month;for(;this.hideOtherMonthCells&&e.getMonth()!==t||this.hiddenNonWorkingDays[e.getDay()];)e.setDate(e.getDate()-1);return e}updateHideNonWorkingDays(e){var t,n;const r=this,{month:i,calendar:s}=r;if(null===(t=r.contentElement)||void 0===t||t.classList[e?"add":"remove"](r.hideNonWorkingDaysCls),null==i)return;let o,a,l;var c;if(!r.isConfiguring&&e&&(a=r.date,l=null===(c=a)||void 0===c?void 0:c.getDay(),a&&r.nonWorkingDays[l]&&r.getDayElement(a)&&(o=i.visibleDayColumnIndex[l])),i.hideNonWorkingDays=e,null===(n=super.updateHideNonWorkingDays)||void 0===n||n.call(this,e),"number"==typeof o){const e=i.getWeekStart(i.getWeekNumber(a)),t=Math.min(o,i.visibleColumnCount-1);for(let n=-1;"number"!=typeof i.visibleDayColumnIndex[e.getDay()]||++n!==t;e.setDate(e.getDate()+1));r.date=e,s&&(s.date=a)}}onCalendarStoreChange({source:e,action:t}){const n=this;var r;("dataset"!==t||e.isChained)&&n.project.isInitialCommitPerformed&&!n.project.isWritingData&&(null===(r=n._cellMap)||void 0===r||r.clear(),n.refreshSoon())}refreshSoon(){this.refresh()}onEventCreated(e){}getEventRecord(e){var t;let n=e instanceof Event?e.target:e;return n=(null===(t=n)||void 0===t?void 0:t.closest("[data-event-id]"))||null,n&&this.eventStore.getById(n.dataset.eventId)}resolveEventRecord(e){return this.getEventRecord(e)}getDateFromElement(e){let t=null==e?void 0:e.closest("[data-date],[data-header-date],[data-month-date]");return t?en.parseKey(t.dataset.date||t.dataset.headerDate||t.dataset.monthDate):(t=null==e?void 0:e.closest("[data-week]"),t?null===(n=this.month)||void 0===n?void 0:n.getWeekStart(t.dataset.week.split(",").map(Number)):void 0);var n}getDateFromDomEvent(e){return this.getDateFromElement(Mr.getEventElement(e))}getDateFromPosition(){return null}dateKey(e){return en.makeKey(e)}getDayElement(e,t){return"string"!=typeof e&&(e=this.dateKey(e)),this.eventContentElement.querySelector(`[data-date="${e}"]`)}getEventElement(e,t=Math.max(e.startDate,this.firstVisibleDate||this.startDate)){var n;const r=this,i=null===(n=r.calendar)||void 0===n?void 0:n.navigator.activeItem,s=r.getDateFromElement(i),o=r.eventStore.modelClass.asId(e);if(document.contains(i)&&(null==i?void 0:i.dataset.eventId)===String(o)&&s&&!(t-s))return i;if(t){const e=r.getDayElement(t);if(e)return Mr.down(e,`[data-event-id="${o}"]`)}return r.getEventElements(e)[0]}getEventElements(e){const t=this.eventStore.modelClass.asId(e);return this.eventContentElement.querySelectorAll(`[data-event-id="${t}"]`)}onEventMouseOverOut(e){const t=this,{currentOverEventEl:n}=t,r="mouseout"===e.type,i=e[r?"relatedTarget":"target"],s=(null==i?void 0:i.closest(".b-cal-event-wrap"))||null;if(s!==(n||null))return r?(t.currentOverEventEl=null,n&&Object.defineProperty(e,"target",{configurable:!0,get:()=>n}),t.onCalendarPointerInteraction(e)):(t.currentOverEventEl=s,t.onCalendarPointerInteraction(e))}calendarHitTest(e){const t=this,{monthSelector:n}=t,r=t.getDateFromDomEvent(e),i=Mr.getEventElement(e);let s,o=null;if(s=i.closest(".b-cal-event-wrap"))o={type:"event",eventElement:s,eventRecord:t.eventStore.getById(s.dataset.eventId)};else if(s=i.closest(t.dayNameSelector))o={type:"dayNumber",dayNumberElement:s};else if(s=i.closest(".b-week-num,.b-week-number-cell")){const e=i.closest(".b-calendar-week");e&&e.dataset.week&&(o={type:"weekNumber",week:e.dataset.week.split(",").map(Number),weekNumberElement:s,weekElement:e})}else n&&i.closest(n)&&(o={type:"monthName",month:r.getMonth(),date:r});return o||((s=i.closest(".b-cal-cell-overflow"))?o={type:"cellOverflow",cellOverflowElement:s}:r&&(o={type:"schedule"})),o&&(o.cell=i.closest(".b-calendar-cell"),o.date=r,o.view=t),o}onCalendarPointerInteraction(e){const t=this,{monthSelector:n}=t,{target:r}=e,i=Boolean(r.closest(".b-overflowpopup")),s=kS[e.type],o=t.getDateFromDomEvent(e),a=r.closest(".b-cal-event-wrap"),l=a?t.eventStore.getById(a.dataset.eventId):t.getEventRecord(r),c=a||l&&t.getEventElement(l,o),d=r.closest("[data-resource-id]"),u=d&&t.resourceStore.getById(d.dataset.resourceId);let h;if(u&&(h=t.trigger(`resource${s}`,{domEvent:e,date:o,eventElement:c,eventRecord:l,resourceRecord:u,fromOverflowPopup:i})),i||t.eventContentElement.contains(r)){if(!1!==h&&l){const n=t.trigger(`event${s}`,{domEvent:e,date:o,eventElement:c,eventRecord:l,resourceRecord:u,fromOverflowPopup:i});n&&(h=n)}if(l||u)return h;if(r.closest(t.dayNameSelector)){const n=t.trigger(`dayNumber${s}`,{domEvent:e,date:o,cellData:t.cellMap.get(o)||t.createCellData(o),fromOverflowPopup:i});if(!1===n)return n;t.checkAutoCreateGesture(e,o)}if(r.closest(".b-week-num,.b-week-number-cell")){const n=e.target.closest("[data-week]");if(n)return t.trigger(`weekNumber${s}`,{domEvent:e,week:n.dataset.week.split(",").map(Number),date:t.getDateFromElement(n.querySelector(".b-calendar-cell")),fromOverflowPopup:i})}if(n&&r.closest(n))return t.trigger(`monthName${s}`,{domEvent:e,month:o.getMonth(),date:o,fromOverflowPopup:i});if((!r.closest(".b-cal-cell-overflow")||!1===t.trigger(`cellOverflow${s}`,{domEvent:e,date:o,fromOverflowPopup:i}))&&o&&t.dayCellCls&&e.target.closest(`.${t.dayCellCls}`)){const n=t.trigger(`schedule${s}`,{domEvent:e,date:o,fromOverflowPopup:i});return!1!==n&&t.checkAutoCreateGesture(e,o),n}}}onCalendarKeyDown(e){var t,n,r;e.ctrlKey&&"z"===e.key.toLowerCase()&&null!==(t=this.calendar)&&void 0!==t&&t.enableUndoRedoKeys?null===(n=this.project)||void 0===n||null===(r=n.stm)||void 0===r||r.onUndoKeyPress(e):this.onCalendarPointerInteraction(e)}isAllDayEvent(e){return e.allDay||e.isInterDay}sortEvents(e){e.sort(this.eventSorter)}preProcessCurrentConfigs(e){super.preProcessCurrentConfigs(e),delete e.calendar,delete e.project}getCurrentConfig(e){const t=super.getCurrentConfig(e);return delete t.project,t}},v(t,"$name","CalendarMixin"),t};const FS=({key:e},{key:t})=>e<t?-1:t<e?1:0,OS=e=>e.endDate||en.add(e.startDate,e.duration,e.durationUnit);var LS=e=>class extends(e||Te){static get $name(){return"DayCellCollecter"}static get configurable(){return{eventFilter:null}}get dayTime(){return zd.MIDNIGHT}get cellMonth(){return this._cellMonth||(this._cellMonth=new Wd({}))}createCellMap(e={}){const t=this,{filter:n,skipPropagate:r}=e,{eventFilter:i,cellMonth:s,lastVisibleDate:o}=t,a=e.cellMap||t._cellMap||(t._cellMap=new PS);o&&o.setDate(o.getDate()+1);let l=e.startDate||t.firstVisibleDate||t.startDate,c=e.endDate||o||t.endDate;if(s.configure({weekBase:null,weekStartDay:t.weekStartDay,nonWorkingDays:t.nonWorkingDays,hideNonWorkingDays:t.hideNonWorkingDays,sixWeeks:t.sixWeeks,date:l}),t.eventStore){e=sn.assign({dayTime:zd.MIDNIGHT},e,{filter:n&&i?e=>n(e)&&i(e):n||i,dateMap:a,startDate:l,endDate:c}),t.collectEvents(e),l=e.startDate,c=e.endDate;for(const[n,i]of a){let s=0;t.sortEvents(i);const o=e.dayTime,d=o.dayOfDate(en.parseKey(n)),u=t.createCellData(d);if(e.rawEvents?(s=Math.min(c,Math.max.apply(Math,i.map(OS))),u.events=i):u.events=i.map((e=>{const n=e.endingDate,i=n>u.tomorrow,o={isAllDay:t.isAllDayEvent(e),isOverflow:e.startDate<u.date&&d-l,eventRecord:e,eventEndDate:n,overflows:i,date:d};return r||(s=Math.min(c,Math.max(s,n)),i&&(o.propagateEndDate=t.calculatePropagateEndDate(o,c))),o})),!r)for(;d<s;d.setDate(d.getDate()+1)){const e=o.dateKey(d);a.has(e)||a.set(e,[])}a.set(n,u)}if(a.size){const e=[...a.values()].sort(FS);let n;a.clear(),e.forEach((e=>{a.set(e.key,e),n&&(n.nextEvents=e,e.previousEvents=n),n=e})),r||t.propagateCellEvents(e[0],a)}}return a.populated=!0,a}calculatePropagateEndDate(e,t=this.endDate){const{eventEndDate:n}=e,r=this.dayTime.startOfDay(n);return e.propagateEndDate=new Date(Math.min(n>r?en.add(r,1,"day"):n,t)),this.trigger("eventPropagate",e),e.propagateEndDate}collectEvents(e){return this.eventStore.getEvents(e)}propagateCellEvents(e,t){const{events:n,renderedEvents:r,previousEvents:i,nextEvents:s,date:o}=e,a=this.getEventsPerCell(o),{length:l}=n;for(let t=0;t<l;t++){const i=n[t],{eventRecord:o,propagateEndDate:a,eventEndDate:l}=i;let c=r.add(i);if(i.overflows){let t,n=e.visible;for(let e=s;e&&e.date<a;e=e.nextEvents)e.columnIndex||(c=e.renderedEvents.firstFreeSlot),e.renderedEvents.set(c,t={eventRecord:o,eventEndDate:l,propagateEndDate:a,isAllDay:i.isAllDay,isOverflow:n,overflows:!0}),n=n||e.visible;t&&(t.overflows=!1)}}e.maxRow=r.length;const c=r[a-1];if(r.length===a)null!=c&&c.isOverflow&&null!=i&&i.hasOverflow&&(e.maxRow--,e.hasOverflow=!0);else if(r.length>a&&(e.maxRow=a-1,e.hasOverflow=!0,null!=c&&c.isOverflow)){const n=new Date(o).setDate(o.getDate()-e.columnIndex),r=en.clearTime(c.eventRecord.startDate).valueOf();let i=t.get(en.makeKey(new Date(Math.max(n,r))));for(;i.key!==e.key;)i.hasOverflow=!0,i.maxRow=a-1,i=i.nextEvents}s&&this.propagateCellEvents(s,t)}createCellData(e){return Object.assign(this.cellMonth.getCellData(e,this.month,this.dayTime),{events:[],renderedEvents:new yS})}};class PS extends Map{constructor(...e){super(...e),v(this,"populated",!1)}get(e,t){return super.get(en.makeKey(e),t)}set(e,t){return e=en.makeKey(e),this.has(e)||(this.generation=(this.generation||0)+1),super.set(e,t)}delete(e,t){return e=en.makeKey(e),this.has(e)&&this.generation++,super.delete(e,t)}has(e){return super.has(en.makeKey(e))}clear(){return this.populated=!1,this.generation=(this.generation||0)+1,super.clear()}}class $S extends Ic{static get $name(){return"OverflowPopup"}static get type(){return"overflowpopup"}static get configurable(){return{textContent:!1,autoShow:!1,floating:!1,cls:"b-cal-event-list",closable:!0,draggable:{handleSelector:":not(.b-cal-event-wrap)"},anchor:!0,layout:"vbox",eventRenderer:null,eventSorter:bS.interDaySorterFn,eventList:{type:"widget",cls:"b-cal-event-bar-container",weight:500},items:{},tools:{maximize:null},dateFormat:"dddd, MMM DD",activeDate:{$config:{equal:"date"},value:null},scrollAction:"hide",align:{axisLock:"flexible",constrainPadding:20,minHeight:400},scrollable:{overflowY:"auto"},onlyShowOverflow:null}}calendarHitTest(e){const t=Mr.getEventElement(e).closest(".b-cal-event-wrap");return t?{type:"event",eventElement:t,eventRecord:this.owner.eventStore.getById(t.dataset.eventId),view:this}:null}onHeaderClick({event:e}){var t;e.target.closest(".b-header-title")?null===(t=this.owner)||void 0===t||t.trigger("dayNumberClick",{domEvent:e,date:this.activeDate,cellData:this.cellData,source:this.owner,fromOverflowPopup:!0}):super.onHeaderClick(...arguments)}get focusElement(){var e,t;const n=Mr.getActiveElement(this);return this.element.contains(n)?n:(null===(e=this.eventList)||void 0===e||null===(t=e.element)||void 0===t?void 0:t.firstElementChild)||super.focusElement}getDateFromPosition(){return this.activeDate}getEventElement(e){return this.contentElement.querySelector(`[data-event-id="${e.id}"]`)}showOverflow(e,t){const n=this.activeDate=t.date;var r;this.cellData=t,this.targetCell=e,this.refresh(t),this.showBy(e),this.isVisible&&(null===(r=this.owner)||void 0===r||r.trigger("showOverflowPopup",{cell:e,cellData:t,date:n,overflowPopup:this}))}onCalendarStoreChange(){const e=this;e.isVisible&&(e.cellData=e.owner.cellMap.get(en.makeKey(e.activeDate)),e.refresh(e.cellData))}refresh(e){var t,n;if(!this.eventList)return;e?this.cellData=e:e=this.cellData;const r=this,{owner:i,eventRenderer:s}=r,{element:o}=r.eventList,a=r.onlyShowOverflow?Math.max(i.eventsPerCell-1,0):0,l=null===(t=e)||void 0===t?void 0:t.renderedEvents.slice(a).sort(r.eventSorter),c=[];if(null==l||!l.length||(null===(n=e)||void 0===n||!n.hasOverflow)&&!i.isYearView)return r.hide();for(let t=0,n=0,{length:r}=l;t<r;t++,n++){const n=l[t];if(n){const t=i.createEventDomConfig(n,s);Object.assign(t.className,{"b-continues-past":n.eventRecord.startDate<e.date,"b-continues-future":n.eventRecord.endDate>e.tomorrow}),t.style.marginBottom=`${i.eventSpacing}px`,c.push(t)}}oa.sync({domConfig:{children:c},targetElement:o}),o.dataset.date=e.key,o.classList.add(`b-day-of-week-${e.day}`),o.classList.remove(`b-day-of-week-${r.lastRefreshDay}`),r.lastRefreshDay=e.day,r.realign()}changeItems(e){const{eventList:t}=this;t&&(e.eventList=t);const n=super.changeItems(e);return t&&(this.eventList=this.widgetMap.eventList),n}changeActiveDate(e,t){if(e="string"==typeof date?en.parse(e):new Date(e),isNaN(e))throw new Error("OverflowPopup date ingestion must be passed a Date, or a YYYY-MM-DD date string");return e}updateActiveDate(e){this.element.dataset.date=en.makeKey(e),this.title=en.format(e,this.dateFormat)}onDocumentMouseDown({event:e}){var t;const n=null===(t=this.lastAlignSpec)||void 0===t?void 0:t.target,{target:r}=e;if(null!=n&&n.contains(r)){const t=r.closest(".b-cal-cell-overflow");if(r.closest(".b-cal-event-bar-container")||r.matches(".b-cal-cell-overflow")||1===(null==t?void 0:t.children.length))return e.preventDefault()}super.onDocumentMouseDown(...arguments)}}$S.initClass(),$S._$name="OverflowPopup";const _S=()=>{},{eventNameMap:NS}=_n;var HS=e=>class extends(e||Te){static get $name(){return"DayCellRenderer"}static get configurable(){return{monitorResize:!0,dayCellRenderer:null,dynamicHideNonWorkingdayCls:"b-dynamic-nonworking-day",overflowPopup:{$config:["lazy","nullify"],value:{type:"overflowpopup"}},overflowPopupTrigger:"click",eventBarContainerCls:"b-cal-event-bar-container",overflowButtonRenderer:null,dayCellNameFormat:null,eventSpacing:2,emptyCellCls:"b-cal-empty-cell",emptyCellRenderer:null}}onCalendarStoreChange(){var e;super.onCalendarStoreChange(...arguments),null!==(e=this._overflowPopup)&&void 0!==e&&e.isVisible&&this._overflowPopup.onCalendarStoreChange(...arguments)}onCellOverflowGesture({domEvent:e,date:t}){const n=this,r=n.cellMap.get(en.makeKey(t));if(r){const{overflowPopup:i}=n,s=n.getCellFromEvent(e);i&&n.trigger("beforeShowOverflowPopup",{cell:s,cellData:r,date:t,overflowPopup:i})&&i.showOverflow(s,r)}}getCellFromEvent(e){return e.target.closest(".b-calendar-cell[data-date]")}updateOverflowPopupTrigger(e){this.onCellOverflowClick=this.onCellOverflowMouseOver=_S,"mouseover"!==(e=e.toLowerCase())&&"hover"!==e||(e="mouseOver"),this[`onCellOverflow${_.capitalize(e)}`]=this.onCellOverflowGesture}changeOverflowPopup(e,t){const n=this,r=n.up("calendar")||n.owner||n,i=$S.reconfigure(t,e,{owner:n,defaults:{owner:n,align:{constrainTo:globalThis}}});if(i){const{element:e}=i,{eventHeightInPixels:s}=n;i.floating||(i.positioned=!0,i.render(r.isCalendar?r.element:r.contentElement)),s&&(e.style.setProperty("--event-height",`${s}px`),e.style.setProperty("--arrow-width",s/3+"px")),i!==t&&r!==n&&(_n.on({thisObj:n,element:i.bodyElement,delegate:".b-cal-event-wrap",mouseover:"onEventMouseOverOut",mouseout:"onEventMouseOverOut",mousedown:"onCalendarPointerInteraction",mouseup:"onCalendarPointerInteraction",click:"onCalendarPointerInteraction",dblclick:"onCalendarPointerInteraction",contextmenu:"onCalendarPointerInteraction"}),i.headerElement&&_n.on({thisObj:n,element:i.headerElement,mousedown:"onCalendarPointerInteraction",mouseup:"onCalendarPointerInteraction",click:"onCalendarPointerInteraction",dblclick:"onCalendarPointerInteraction",contextmenu:"onCalendarPointerInteraction"}))}return i}onInternalResize(e,t,n,r,i){const{_eventsPerCell:s,_eventContainerTop:o}=this;super.onInternalResize(e,t,n,r,i),this.rendered&&n!==i&&this.performResizeRefresh(s,o)}performResizeRefresh(e,t,n){this._eventsPerCell=this._eventContainerTop=this._eventContainerHeight=null;const r=this,{eventsPerCell:i,_overflowPopup:s}=r;i!==e&&r.trigger("eventsPerCellChange",{value:i,oldValue:e}),r.eventContainerTop===t&&i===e||(n?r.doRefresh():r.refresh(),null!=s&&s.isVisible&&s.refresh(r._cellMap.get(en.makeKey(s.activeDate))))}updateEventHeight(){super.updateEventHeight(...arguments),this._eventsPerCell=null}updateEventSpacing(){this._eventsPerCell=null,this.isConfiguring||this.refreshSoon()}get weeksElement(){return this.contentElement}get eventContainerHeight(){if(null==this._eventContainerHeight&&this.isVisible&&!this.isConfiguring){const{firstVisibleCell:e}=this;this._eventContainerHeight=e?e.offsetHeight-this.eventContainerTop:NaN}return this._eventContainerHeight}get eventContainerTop(){const e=this;if(null==e._eventContainerTop&&e.isVisible&&!e.isConfiguring){const{firstVisibleCell:t}=e,n=t&&t.querySelector(`.${e.eventBarContainerCls}`),r=n?n.getBoundingClientRect().top-n.offsetParent.getBoundingClientRect().top:0;e._eventContainerTop=0===r?null:r}return e._eventContainerTop||0}getEventsPerCell(e){return this.eventsPerCell}get eventsPerCell(){const e=this;return null==e._eventsPerCell&&(e._eventsPerCell=Math.floor((e.eventContainerHeight+e.eventSpacing)/(e.eventHeightInPixels+e.eventSpacing))),e._eventsPerCell}get cellMap(){var e;return null!==(e=this._cellMap)&&void 0!==e&&e.populated?this._cellMap:this.createCellMap()}cellRenderer({cell:e}){const t=this.getCellDomConfig(...arguments);oa.sync({domConfig:t,targetElement:e})}getCellDomConfig({cell:e,columnIndex:t,row:n,date:r,day:i,dayTime:s=zd.MIDNIGHT,visibleColumnIndex:o,key:a}){const l=this,{eventHeightInPixels:c,eventSpacing:d,weekLength:u,todayCls:h,emptyCellRenderer:g}=l,m=!(r-l.dayTime.startOfDay(new Date)),p=r.getDate(),f={className:l.eventBarContainerCls,role:"presentation",children:[],syncOptions:{syncIdField:"eventId",releaseThreshold:0,strict:!0}},v={style:{},className:new Mn({"b-cal-cell-header":!0,[h]:m})},y={dataset:{},style:{},className:new Mn(null==e?void 0:e.className),children:[v,f]},b=!(r-(l.firstVisibleDate||-1));y.className[h]=m;let C,w,S=!l.isConfiguring&&l.cellMap.get(en.makeKey(r));if(l.addCellHeaderContent?C=l.addCellHeaderContent(v,S||(S=l.createCellData(r))):v.children=[C={className:{"b-day-name":!0}}],l.dayCellRenderer&&!l.isConfiguring){S||(S=l.createCellData(r)),S.style=y.style,S.cls=y.className,S.headerStyle=v.style,S.headerCls=v.className;const e=S&&S.isNonWorking,t=l.callback(l.dayCellRenderer,l,[S,y]);"string"==typeof S.cls&&(y.className=new Mn(S.cls)),"string"==typeof S.style&&(y.style=Mr.parseStyle(S.style)),"string"==typeof S.headerCls&&(v.className=new Mn(S.headerCls)),"string"==typeof S.headerStyle&&(v.style=Mr.parseStyle(S.headerStyle)),null!=t&&("string"==typeof t?C.html=t:(C.text=null,C.children=ke.asArray(t))),w=!e&&S.isNonWorking}if(C&&(C.text||C.html||(C.text=l.dayCellNameFormat?en.format(r,l.dayCellNameFormat):p),(C.text||C.html)==p&&(C.className["b-day-num"]=!0)),S.visible){const{hasOverflow:e,renderedEvents:a,maxRow:h}=S,m=a,{length:p}=m,v=f.children;y.className[l.nonWorkingDayCls]=S.isNonWorking,y.className[l.dynamicHideNonWorkingdayCls]=w,y.className[l.weekendCls]=en.weekends[i];for(let e=0,t=0;e<h;e++,t++){const n=m[e];if(n){const{eventRecord:e,isOverflow:i,propagateEndDate:a}=n,h=n.eventEndDate||e.endingDate,g=l.getDaySpan(r,a||h,s),m=l.getDaySpan(r,h,s),p=u-o,f=o&&i,y=sn.round((f?1:Math.min(g,p))/u*100,4),C=l.createEventDomConfig(n);Object.assign(C.style,{top:`${t*c+t*d+l.eventContainerTop}px`,width:Mr.percentify(y)}),Object.assign(C.className,{"b-overflow":f,"b-continues-past":!f&&(!o||b)&&e.startDate<r,"b-continues-future":!f&&(m>p||m>g)}),v.push(C)}}if(e?(n.classList.add("b-has-overflow"),y.children.push(l.getOverflowButtonDomConfig(p-Math.max(0,h)))):t||n.classList.remove("b-has-overflow"),(y.className[l.emptyCellCls]=!m.length)&&g){const e=typeof g,t="function"===e||"string"===e?l.resolveCallback(g,l,!1):null;(null!=t&&t.handler?t.handler.call(t.thisObj,S):g)&&(f.children[0]={tag:"button",class:"b-cal-cell-no-content",children:[null!=t&&t.handler?t.handler.call(t.thisObj,S):g]})}}return y}onCalendarPointerInteraction(e){const t=this,{target:n}=e;return!(n.closest(`.${t.emptyCellCls} .${t.eventBarContainerCls}`)&&(!t.emptyCellRenderer||n.closest(".b-cal-cell-no-content"))&&!1===t.trigger(`emptyCell${NS[e.type]}`,{date:t.getDateFromDomEvent(e),domEvent:e}))&&super.onCalendarPointerInteraction(e)}getDaySpan(e,t,n){if(this.hideNonWorkingDays){let r=0;for(const i=new Date(e),s=n.ceil(t,"1 day");i<s;i.setDate(i.getDate()+1))this.nonWorkingDays[i.getDay()]||r++;return r}return Math.max(en.diff(e,n.ceil(t,"1 day"),"day"),1)}getOverflowButtonDomConfig(e){const{overflowButtonRenderer:t}=this,n={tag:"button",className:{"b-cal-cell-overflow":1},text:this.L("L{Calendar.plusMore}",e),style:{lineHeight:`${this.eventHeightInPixels}px`,marginBottom:`${this.eventSpacing}px`},dataset:{eventId:"overflow"}};return t?this.callback(t,this,[n,e]):n}getCell(e){return"string"!=typeof e&&(e=this.dayTime.dateKey(e)),this.contentElement.querySelector(`[data-date="${e}"]`)}};const BS={day:1,week:1,month:1,year:1,decade:1},jS=(e,t)=>(null==e?void 0:e.unit)===(null==t?void 0:t.unit)&&(null==e?void 0:e.magnitude)===(null==t?void 0:t.magnitude);var VS=e=>{var t;return t=class extends(e||Te){previous(){const{range:e}=this;this.date=e?en.add(this.date,-e.magnitude,e.unit):en.add(this.date,-this.duration,"day")}next(){const{range:e}=this;this.date=e?en.add(this.date,e.magnitude,e.unit):en.add(this.date,this.duration,"day")}changeDate(e){if(e=super.changeDate(e||this.startDate),this.isConfiguring||this.isValidRange(this.range,e))return e}updateDate(e){var t;const n=this,{startDate:r,endDate:i,_month:s}=n,o=n.changeStartDate(e),a=null==s?void 0:s.generation;if(!r||o-r)if(n.hasConfig("endDate")){const t=en.diff(r,i,"d");!r||!i||e<r?n.startDate=e:e>=i&&(n.startDate=en.add(e,-(t-1),"day"))}else n.startDate=en.floor(e,n.range,void 0,n.weekStartDay);s&&s.generation===a&&(n._month.date=e),null===(t=super.updateDate)||void 0===t||t.call(this,...arguments)}changeStartDate(e,t){return super.changeStartDate(this.snapDate(this.ingestDate(e)),t)}updateStartDate(e,t){var n;const r=this,{refreshCount:i,_month:s}=r;if(r.date||(r.date=e),s&&(s.date=e),null===(n=super.updateStartDate)||void 0===n||n.call(this,...arguments),r.hasConfig("endDate")){const n=en.diff(t||e,r.endDate,"day");r.endDate=en.add(e,n,"day")}var o;r.isConfiguring||r.refreshCount===i&&(null===(o=r._cellMap)||void 0===o||o.clear(),r.refresh())}changeEndDate(e,t){return super.changeEndDate(this.snapDate(this.ingestDate(e),!0),t)}get range(){return this.hasConfig("endDate")?null:this._range}get endDate(){return this.hasConfig("endDate")?this._endDate:this.startDate&&en.add(this.startDate,this.range.magnitude,this.range.unit)}snapDate(e,t){const n=this.hasConfig("endDate")?null:this.range;return n&&"day"!==n.unit&&e?en[t?"ceil":"floor"](e,n,void 0,this.weekStartDay):e}changeRange(e){if(e){if("string"==typeof e)e=en.parseTimeUnit(e)?{magnitude:1,unit:e}:en.parseDuration(e);else if("number"==typeof e)return{magnitude:e,unit:"day"};if(!BS[e.unit])throw new Error("Range must be in days, weeks, months, years or decades");if(this._date&&!this.isValidRange(e))return}return e}isValidRange(e,t=this.date){var n,r;const i=this.minDate||(null===(n=this.calendar)||void 0===n?void 0:n.minDate),s=this.maxDate||(null===(r=this.calendar)||void 0===r?void 0:r.maxDate);if(e&&!isNaN(i)||!isNaN(s)){const n=this.calculateDateRange(e,t);if(!isNaN(i)&&n.startDate<i)return!1;if(!isNaN(s)&&n.endDate>s)return!1}return!0}updateRange(e){const t=this,{date:n}=t;e&&n&&!t.hasConfig("endDate")&&(t.startDate=n)}calculateDateRange(e,t){if(t)return"day"!==e.unit?{startDate:en.floor(t,e,void 0,this.weekStartDay),endDate:en.ceil(en.add(t,1,"day"),e,void 0,this.weekStartDay)}:{startDate:t,endDate:en.add(t,e.magnitude,"day")}}changeMonth(e){var t;const n=this,{date:r}=n;return super.changeMonth?super.changeMonth(...arguments):(null!==(t=e)&&void 0!==t&&t.isMonth||(e=new Wd({date:r,weekStartDay:n.weekStartDay,hideNonWorkingDays:n.hideNonWorkingDays,nonWorkingDays:n.nonWorkingDays}),null==n.nonWorkingDays&&(n.nonWorkingDays=e.nonWorkingDays),null==n.weekStartDay&&(n.weekStartDay=e.weekStartDay)),e)}get dateBounds(){return[this.startDate,this.lastDate]}get duration(){const{range:e}=this;return e?en.as("d",e.magnitude,e.unit):super.duration}get lastDate(){const e=this.endDate;return e&&en.add(e,-1,"day")}},v(t,"$name","DateRangeOwner"),v(t,"configurable",{month:!0,date:{$config:{equal:"date"},value:null},range:{$config:{lazy:!0,equal:jS},value:null},startDate:{$config:{equal:"date"}},endDate:{$config:{equal:"date"}}}),t};const zS=Object.freeze({}),WS={shrinkwrap:1,expand:1},US=(e,t,n,r,i)=>{const s=en.format(n,e);return r?`${s}${i?t.trim():t}${en.format(r,e).slice(i?-1:0)}`:s};class YS extends(Ka.mixin(AS,LS,HS,VS)){static get $name(){return"CalendarRow"}static get type(){return"calendarrow"}static get configurable(){return{cls:"b-calendar-days",animate:!0,autoHeight:null,autoRefresh:["dayNameFormat","dayNumberCompress","dayNumberFormat","daySeparator"],descriptionFormat:[!0,!0],dayStartShift:null,dayTime:0,defaultEventRowCount:3,fullWeek:null,minDayWidth:null,scrollable:{overflowX:"hidden",overflowY:"hidden"},headerScroller:{$config:["lazy","nullify"],value:{overflowX:"hidden",overflowY:"hidden"}},dayNameFormat:"ddd",dayNumberCompress:null,dayNumberFormat:"D",daySeparator:"-",responsive:{small:{dayNameFormat:"d1",dayNumberCompress:!0,daySeparator:"/"},"*":{dayNameFormat:"ddd",dayNumberCompress:!1,daySeparator:"-"}},dayNameSelector:".b-cal-cell-header",monitorResize:!1,eventRenderer:null,gutterHeight:null,expanded:null,overflowClickAction:"popup",dayHeaderRenderer:null}}static get properties(){return{heightAnimation:Promise.resolve()}}compose(){return{children:{headerElement:{className:"b-calendarrow-header",children:{headerCellContainer:{className:"b-calendarrow-header-container"},scrollPadElement:f({},Mr.scrollBarPadElement)}},bodyElement:{className:"b-calendarrow-body",children:{cellContainer:{reference:"cellContainer",className:"b-calendarrow-cell-container"}}}}}}onPaint({firstPaint:e}){if(e){const e=this,{fonts:t}=document,n=()=>{e._eventContainerTop=e._eventContainerHeight=null,e.eventStore.count&&e.performResizeRefresh(null,null,!0)};"loaded"!==(null==t?void 0:t.status)&&t.ready.then((()=>!e.isDestroyed&&n())),n()}}changeDaySeparator(e){return Array.isArray(e)?e:[e,e]}changeElement(){const e=super.changeElement(...arguments);return this.scrollable.addPartner(this.headerScroller,"x"),e}changeHeaderScroller(e,t){return e?e=wa.new({element:this.headerCellContainer,widget:this},e):null==t||t.destroy(),e}async scrollTo(e){const t=this,{eventFilter:n}=t;return e.isEvent&&(!n||n(e))&&en.intersectSpans(t.startDate,t.endDate,e.startDate,e.endDate)&&(t.getEventElement(e)||t.expanded||t.autoHeight||t.toggleExpandCollapse()),super.scrollTo(...arguments)}updateDate(e,t){var n,r,i;let s=t&&this.getDayHeader(t);null===(n=s)||void 0===n||n.classList.remove("b-selected-date"),null===(r=super.updateDate)||void 0===r||r.call(this,e,t),s=e&&this.getDayHeader(e),null===(i=s)||void 0===i||i.classList.add("b-selected-date")}getDayHeader(e){return"string"!=typeof e&&(e=this.dateKey(e)),this.headerCellContainer.querySelector(`.b-cal-cell-header[data-header-date="${e}"]`)}get overflowElement(){return this.bodyElement}createCellMap(e={}){const t=this,n=t.hideNonWorkingDays?t.nonWorkingDays:zS,{maxEventCount:r}=t,i=sn.assign({dayTime:t.dayTime},e),s=super.createCellMap(i);let o,a=0;return s.forEach((e=>{n[e.day]||(o=e),a=Math.max(a,e.renderedEvents.length)})),t.maxEventCount=a,a!==r?(s.clear(),t.createCellMap(i)):(o&&(o.isRowEnd=!0),s)}collectEvents(e){return e=sn.assign({dayTime:this.dayTime},e,{getDateIndex:e=>e>(this.firstVisibleDate||this.startDate)?"startDate":"date"}),this.eventStore.getEvents(e)}createCellData(e){const t=this,n=en.diff(t.startDate,e,"day"),r=n;return Object.assign(t.cellMonth.getCellData(e,t.month,t.dayTime),{visibleColumnIndex:r,columnIndex:n,isRowStart:0===r,isRowEnd:!1,renderedEvents:new yS})}get dayStartShift(){var e,t;return null!==(e=null===(t=this.dayTime)||void 0===t?void 0:t.startShift)&&void 0!==e?e:this._dayStartShift}updateDayStartShift(e){this.element.classList.toggle("b-shifted-day",Boolean(e)),this.dayTime=new zd(e)}changeDayTime(e){var t;if(e||(e=new zd(this.dayStartShift)),e.isDayTime||(e=new zd(e)),null===(t=this._dayTime)||void 0===t||!t.equals(e))return e}dayOfDate(e){return this.dayTime.dayOfDate(e)}updateMinDayWidth(e){const{scrollable:t,headerScroller:n}=this,{element:r}=t;this.contentElement.style.setProperty("--min-day-width",e?Mr.setLength(e):0),e&&r.scrollWidth>r.clientWidth?t.overflowX=n.overflowX="hidden-scroll":t.overflowX=n.overflowX=!1}updateEventHeight(){super.updateEventHeight(...arguments),this.autoHeight||this.isConfiguring||this.expanded||this.setEventContentHeight(this.cellContentHeight)}updateGutterHeight(){this.isConfiguring||this.setEventContentHeight(this.cellContentHeight)}get stepUnit(){return this.duration>1?`${this.duration} ${this.L("L{DayView.daysUnit}")}`:this.L("L{DayView.dayUnit}")}updateNonWorkingDays(){this.onVisibleDateRangeChange()}updateHideNonWorkingDays(){super.updateHideNonWorkingDays(...arguments),this.onVisibleDateRangeChange()}onCellOverflowGesture({date:e}){WS[this.overflowClickAction.toLowerCase()]?this.expanded=!0:super.onCellOverflowGesture(...arguments)}onVisibleDateRangeChange(){var e;this.isConfiguring||(null===(e=this._cellMap)||void 0===e||e.clear(),this.refresh())}changeAutoHeight(e){const t=this,{eventsPerCell:n}=t;t._autoHeight=e,t.setEventContentHeight(t.cellContentHeight),t.performResizeRefresh(n,t.eventContainerTop,!0)}async setEventContentHeight(e){if(this._eventContentHeight!==e){const r=this,{height:i,cellContainer:s}=r;let{animate:o}=r;r.isAnimating=o;const a=Mr.getPropertyTransitionDuration(s,"height");if(a||(r.isAnimating=o=!1),s.style.height=`${e}px`,r.bodyElement.classList.toggle("b-zero-height",!Boolean(e)),o&&await(r.heightAnimation=_n.waitForTransitionEnd({property:"height",element:s,duration:a})),!r.isDestroyed){var t,n;const{height:s}=r;r.isAnimating=!1,r._eventContentHeight=e,null===(t=r.owner)||void 0===t||null===(n=t.syncScrollbarPadding)||void 0===n||n.call(t),s!==i&&r.trigger("heightChange",{height:s,oldHeight:i})}}}get hasOverflow(){return!this.autoHeight&&this.maxEventCount>this.defaultEventRowCount}get eventsPerCell(){const e=this,{maxEventCount:t}=e;return e.expanded||e.autoHeight?t:Math.min(t,e.defaultEventRowCount)}get cellContentHeight(){const{parent:e}=this,t=null!=e&&e.isDayView&&e.parent?e.parent.items.filter((e=>!e.ResourceDayViewTimeAxis)):null;return null!=t&&t.every((e=>e.isDayView))?Math.max(...t.map((e=>{var t;return(null===(t=e.allDayEvents)||void 0===t?void 0:t.calculateCellContentHeight())||0}))):this.calculateCellContentHeight()}calculateCellContentHeight(){const e=this,{gutterHeight:t}=e;let n=Math.ceil(e.eventContainerTop+e.eventsPerCell*(e.eventHeightInPixels+e.eventSpacing));return t&&(e.eventsPerCell&&(n-=e.eventSpacing),isNaN(t)?n=`calc(${n}px + ${t})`:n+=Number(t)),n}getDateFromPosition(e,t){const n=this,{hideNonWorkingDays:r,contentElement:i}=n,s=i.querySelectorAll(`${n.visibleCellSelector}${r?":not(.b-nonworking-day":""}`),o=i.getBoundingClientRect(),a=n.rtl?o.right-e:e-o.left,l=s.length,{width:c}=o,d=Math.floor(a*l/c);if(a<0||c<a||t<o.top||o.bottom<t)return null;if(n.hideNonWorkingDays)return Array.from(s).map((e=>n.getDateFromElement(e)))[d];{const e=n.getDateFromElement(s[0]);return e.setDate(e.getDate()+d),e}}async toggleExpandCollapse(){const{expanded:e}=this;await this.updateExpanded(!Boolean(e),e)}async updateExpanded(e,t){const n=this;n._expanded=t;const{eventsPerCell:r}=n;n._expanded=e,n.expanded?(n.performResizeRefresh(r,n.eventContainerTop,!0),await n.heightAnimation):(n.scrollable.overflowY="hidden",await n.setEventContentHeight(n.cellContentHeight),t&&!n.isDestroyed&&n.performResizeRefresh(r,n.eventContainerTop,!0))}doRefresh(){var e,t;null===(e=this._cellMap)||void 0===e||e.clear();const n=this,{dayTime:r,fullWeek:i,startDate:s,endDate:o,headerCellContainer:a,cellContainer:l,dayHeaderRenderer:c}=n,d=(s||o)&&n.cellMap,u=null!==(t=n.nonWorkingDays)&&void 0!==t?t:n.month.nonWorkingDays,h=n.hideNonWorkingDays?u:zS,g=[],m=[],p=[];if(!d)return;let f,v,y,b=0,C=0,w=new Date(s),S=o;i&&(w=n.month.getWeekStart(n.month.getWeekNumber(w)),S=en.add(w,7,"d"));for(const e=w;e<S;e.setDate(e.getDate()+1),b++){const t=d.get(r.dateKey(e))||n.createCellData(e);t.columnIndex=t.cellIndex=b,h[t.day]?t.visibleColumnIndex=void 0:(t.isRowStart=0===C,t.visibleColumnIndex=C,i||C++),g.push(t)}n.weekLength=i?1:C;const D=g.length;for(v=0;v<D;v++){const e=g[v],{day:t,key:r}=e;if(!h[t]){const s=u[t],o=`b-day-of-week-${t}`;f=!(e.date-n.date),e.cell=n.getCell(r),e.row=n.cellContainer;const a=n.getCellDomConfig(e),l=Y.merge({dataset:{headerDate:r}},a.children[0]);l.className["b-selected-date"]=f,l.className["b-current-date"]=i&&f,l.className[o]=1,c&&n.callback(c,n,[l,e]),a.dataset.date=r,Object.assign(a.className,{"b-dayview-allday":1,[n.nonWorkingDayCls]:s,[n.weekendCls]:en.weekends[t],[n.dayCellCls]:1,[o]:1}),a.children.shift(),p.push(l),i&&!f||(m.push(a),s||(y=a))}}y&&(y.className["b-last-working-day"]=1),oa.sync({targetElement:a,domConfig:{children:p,syncOptions:{releaseThreshold:0,strict:!0}}}),oa.sync({targetElement:l,domConfig:{children:m,syncOptions:{releaseThreshold:0,strict:!0}}}),n.refreshCount=(n.refreshCount||0)+1,n.collapseGutter(),n.setEventContentHeight(n.cellContentHeight),n.trigger("refresh")}get eventContainerTop(){return 0}async expandGutter(){const e=this;e._isTemporarilyExpanded||(e.gutterHeight=(e.gutterHeight||0)+e.eventHeightInPixels+e.eventSpacing,await e.setEventContentHeight(e.cellContentHeight),e._isTemporarilyExpanded=!0)}async collapseGutter(){const e=this;e._isTemporarilyExpanded&&(e.gutterHeight=e.gutterHeight-(e.eventHeightInPixels+e.eventSpacing),await e.setEventContentHeight(e.cellContentHeight),e._isTemporarilyExpanded=!1)}addCellHeaderContent(e,t){var n;const r=this,{date:i,day:s,tomorrow:o}=t,{dayNameFormat:a,dayNumberCompress:l,daySeparator:c}=r,d=null==r||null===(n=r.dayTime)||void 0===n?void 0:n.startShift;e.children=[{className:"b-day-name-part b-day-name-day"+(l?" b-day-name-short":""),html:US(a,c[0],i,d&&o)},{className:"b-day-name-part b-day-name-date",html:US(r.dayNumberFormat,c[1],i,d&&o,l)}],e.className[r.nonWorkingDayCls]=t.isNonWorking,e.className[r.weekendCls]=en.weekends[s]}updateLocalization(){this.isConfiguring||this.refresh(),super.updateLocalization()}}YS.initClass(),YS._$name="CalendarRow";class GS extends YS{afterConfigure(){var e;const t=this,{owner:n}=t;super.afterConfigure(),null===(e=n.scrollable)||void 0===e||e.on({overflowChange:"onOwnerOverflowChange",thisObj:t}),n.descriptionRenderer=t.descriptionRenderer.bind(t),n.previous=function(){this.date=en.add(n.date,-n.duration,"d")},n.next=function(){this.date=en.add(n.date,n.duration,"d")},$e.before(n,"updateDate",this.beforeOwnerDateUpdate,this)}beforeOwnerDateUpdate(e){this.date=e}onOwnerOverflowChange({y:e}){this.headerElement.classList.toggle("b-show-yscroll-padding",Boolean(e))}onDayNumberClick({date:e}){return this.owner&&(this.owner.date=e),!1}descriptionRenderer(){const{startDate:e,endDate:t,owner:n}=this,r=e.getMonth()===t.getMonth()?en.format(e,"MMMM"):`${en.format(e,"MMM")} - ${en.format(t,"MMM")}`,i=n.month.getWeekNumber(e);return`${this.L("L{Object.Week}")} ${i[1]}, ${r} ${i[0]}`}}v(GS,"$name","DaySelector"),v(GS,"type","dayselector"),v(GS,"configurable",{readOnly:!0,autoCreate:!1,flex:"0 0 auto",dock:"top"}),GS.initClass(),GS._$name="DaySelector";var qS=e=>class extends(e||Te){static get $name(){return"CalendarMixin"}static get configurable(){return{daySelector:null}}changeDaySelector(e,t){const n=this;if(e){n.range="1 day",n.settings=null,n.hideHeaders=!0;const r=n.dayTime.shiftDate(n.month.getWeekStart(n.month.getWeekNumber(n.startDate))),i=GS.reconfigure(t,e,{owner:n,defaults:{type:"dayselector",calendar:n.calendar,parent:n,cls:{[`b-${n.type}-dayselector`]:1},dayStartShift:n.dayStartShift,dayTime:n.dayTime,month:n.month,date:n.date,startDate:r,range:{magnitude:1,unit:"week"},hideNonWorkingDays:n.hideNonWorkingDays,nonWorkingDays:n.nonWorkingDays,nonWorkingDayCls:n.nonWorkingDayCls,weekendCls:n.weekendCls,weekStartDay:n.weekStartDay}});return n.element.classList.add(`b-${n.type}-with-dayselector`),n.tbar=i,i}null==t||t.destroy()}getCurrentConfig(e){const t=super.getCurrentConfig(e);return delete t.daySelector,t}};const KS=(e,t)=>e.startDate.valueOf()-t.startDate.valueOf(),XS=(e,t)=>{if(t){if(e=e.data||e,sn.isObject(e)){const n=t.slice();for(const t in e){const r=e[t],i=n.findIndex((e=>e.id===t||e.field===t));if(r){const e=ae.merge(r,n[i]);e.id=t,n[-1===i?n.length:i]=e}else i>-1&&n.splice(i,1)}return n}t=new rs({values:t,idProperty:"field"});for(let n=0,{length:r}=e;n<r;n++){const r=e[n],i=t.get(r.field);i&&(e[n]=ae.merge(r,i),t.remove(i))}return e.push(...t.values),e}return e};class ZS extends(ip.mixin(AS,LS,qS,VS)){static get $name(){return"EventList"}static get type(){return"eventlist"}static get configurable(){return{cls:"b-slide-vertical",eventFilter:null,localizableProperties:["title","text"],title:"L{List}",range:"1 month",month:!0,columns:{$config:{merge:XS},value:[{text:"L{EventEdit.Name}",field:"name",flex:1},{text:"L{EventList.Start}",type:"date",editor:{type:"datetime",dateField:{step:null},timeField:{step:null}},field:"startDate",width:"16.5em",format:"L LT",renderer({record:e,value:t}){return e.allDay?en.format(t,"L"):this.defaultRenderer(...arguments)}},{text:"L{EventList.Finish}",type:"date",editor:{type:"datetime",dateField:{step:null},timeField:{step:null}},field:"endDate",width:"16.5em",format:"L LT",renderer({record:e,value:t}){return e.allDay?en.format(t,"L"):this.defaultRenderer(...arguments)}}]},features:{group:!1,rowCopyPaste:!1,columnPicker:{createColumnsFromModel:!0}},listeners:{beforeCellEditStart({editorContext:e}){var t,n,r,i;const{editor:s,record:o}=e;if(o.isRecurring||o.isOccurrence)return Gc.show({html:"Please use EventEdit to edit recurring events"}),!1;null===(t=this.calendar)||void 0===t||null===(n=t.features.eventTooltip)||void 0===n||null===(r=n._tooltip)||void 0===r||r.hide(),null===(i=s.timeField)||void 0===i||i[o.allDay?"hide":"show"]()}},settings:{$config:"lazy",value:null},eventListTimeFormat:"HH:mm"}}static get delayable(){return{populateStoreSoon:{type:"raf",cancelOutstanding:!0}}}doRefresh(){this.refreshRows()}eventListEventTimeRenderer(e){const t=this,n=en.diff(en.clearTime(e.startDate),en.clearTime(e.endDate),"day");return{className:{"b-cal-eventlist-event-time":1},text:t.eventTimeRenderer?t.callback(t.eventTimeRenderer,t,arguments):n>1?t.L("L{Calendar.endsOn}",en.format(e.endDate,"DD MMM")):e.allDay?t.L("L{Calendar.allDay}"):`${en.format(e.startDate,t.eventListTimeFormat)} - ${en.format(e.endDate,t.eventListTimeFormat)}`}}agendaEventDateRenderer(e){return{className:{"b-day-name":1,"b-cal-agenda-date":1,"b-today":!Boolean(en.clearTime(new Date)-en.clearTime(e))},children:[{className:{"b-cal-agenda-date-date-number":1},text:e.getDate()},{className:{"b-cal-agenda-date-date-text":1},children:[{text:en.format(e,"dddd")},{text:en.format(e,"MMM YYYY")}]}]}}destroy(){for(const t of Object.values(this.features)){var e;null===(e=t.destroy)||void 0===e||e.call(t)}super.destroy()}populateHeaderMenu({items:e}){e.listRangeItem={weight:-1e3,icon:"b-icon-calendar-week",text:"List Range",menu:this.listRangeMenu},super.populateHeaderMenu(...arguments)}refreshVirtualScrollbars(){super.refreshVirtualScrollbars(),this.bodyElement.classList[Mr.scrollBarWidth&&this.hasVerticalOverflow?"add":"remove"]("b-has-scrollbar")}get listRangeMenu(){const e=this,{unit:t}=e.range;if(!e._listRangeMenu){const t=`${e.id}-range-items`;e._listRangeMenu={anchor:!0,onToggle:t=>{t.checked&&(e.range=t.item.range,t.bubbles=!1),Mr.scrollBarWidth&&t.menu.realign()},items:{listRangeDayItem:{toggleGroup:t,range:"day",text:"L{EventEdit.day}",_unit:"day"},listRangeWeekItem:{toggleGroup:t,range:"week",text:"L{EventEdit.week}",_unit:"week"},listRangeMonthItem:{toggleGroup:t,range:"month",text:"L{EventEdit.month}",_unit:"month"},listRangeYearItem:{toggleGroup:t,range:"year",text:"L{EventEdit.year}",_unit:"year"},listRangeDecadeItem:{toggleGroup:t,range:"decade",text:"L{EventEdit.decade}",_unit:"decade"}}}}for(const n of Object.values(e._listRangeMenu.items))n.checked=n._unit===t;return e._listRangeMenu}updateRowManager(e){var t;null===(t=super.updateRowManager)||void 0===t||t.call(this,...arguments),e.on({beforeRenderRow:"onBeforeRenderRow",thisObj:this})}onBeforeRenderRow({row:e,record:t}){const{_elementsArray:n}=e,{id:r,startDate:i}=t;if(t.isEventModel){for(let e=0,{length:t}=n;e<t;e++)n[e].dataset.eventId=r,n[e].dataset.date=en.makeKey(i);e.cls[`b-day-of-week-${i.getDay()}`]=1}}onInternalKeyDown(e){}handleEvent(e){this.preventScroll=!0,super.handleEvent(e),this.preventScroll=!1}get displayName(){let e=this.title;return"string"!=typeof e&&(e=this.type),_.capitalize(e)}async scrollTo(e,t={animate:!0}){const n=this;if(e instanceof n.store.modelClass)await n.scrollRowIntoView(e,Object.assign({},t,{highlight:!1})),t.highlight&&(e=n.getEventElement(e,e.startDate),"boolean"==typeof t.highlight?Mr.highlight(e,n):(n.widget||n).callback(t.highlight,null,[e]));else if(sn.isDate(e)&&n.store.count){const r=n.dateIndex,i=en.makeKey(e);if(r[i])await n.scrollRowIntoView(r[i],t),n.scrolledToDate=e;else{let t=Number.MAX_SAFE_INTEGER;const i=Object.keys(r);for(let n=0,{length:r}=i;n<r;n++){const r=en.parseKey(i[n]);Math.abs(r-e)<Math.abs(t-e)&&(t=r)}await n.scrollTo(t)}}}updateStartDate(){const{refreshCount:e}=this;super.updateStartDate(...arguments),this.isConfiguring||this.refreshCount!==e||this.populateStoreSoon()}updateEndDate(){var e;const{refreshCount:t}=this;null===(e=super.updateEndDate)||void 0===e||e.call(this,...arguments),this.isConfiguring||this.refreshCount!==t||this.populateStoreSoon()}updateRange(){var e;const{refreshCount:t}=this;null===(e=super.updateRange)||void 0===e||e.call(this,...arguments),this.isConfiguring||this.refreshCount!==t||this.populateStoreSoon()}descriptionRenderer(){const e=this,{date:t,startDate:n,endDate:r,range:i,count:s}=e;let o;if(1===i.magnitude)switch(i.unit){case"day":o=en.format(t,"L");break;case"week":{const t=n.getMonth()===r.getMonth()?en.format(n,"MMMM"):`${en.format(n,"MMM")} - ${en.format(r,"MMM")}`,i=e.month.getWeekNumber(n);o=`${e.L("L{Object.Week}")} ${i[1]}, ${t} ${i[0]}`;break}case"month":o=en.format(t,"MMMM, YYYY");break;case"year":o=en.format(t,"YYYY");break;case"decade":o=`${en.format(n,"YYYY")}s`}else o=`${en.format(e.startDate,"L")} - ${en.format(e.endDate,"L")}`;return`${o}. ${e.L("eventCount",s)}`}get count(){return this.store.count}get stepUnit(){const{range:e}=this;return 1===e.magnitude?e.unit:this.range}updateEventStore(e){var t;null===(t=super.updateEventStore)||void 0===t||t.call(this,e),e.on({refresh:"onCalendarStoreChange",thisObj:this}),this.populateStoreSoon()}changeStore(e){return e&&(e=As.mergeConfigs({useRawData:{ignoreDefaults:!0,disableDefaultValue:!0,disableTypeConversion:!0,enabled:!0},modelClass:this.modelClass},e)),super.changeStore(e)}afterRemove({records:e}){this.eventStore.remove(e),super.afterRemove(...arguments)}get modelClass(){return this.eventStore.modelClass}populateStoreSoon(){const e=this,{project:t}=e;e.isVisible?(t.isInitialCommitPerformed&&!t.isWritingData||!t.eventStore.count)&&e.populateStore():e.whenVisible("populateStore")}populateStore(){var e;const t=this,n=t.eventStore.getEvents({startDate:t.startDate,endDate:t.endDate,filter:t.eventFilter}).sort(KS);t.dateIndex=n.reduce(((e,t)=>{const n=en.makeKey(t.startDate);return e[n]||(e[n]=t),e}),{}),t.store.data=n,t.trigger("refresh"),null===(e=t.calendar)||void 0===e||e.syncUIWithActiveView(this)}changeMonth(){const e=super.changeMonth(...arguments);return e.on({dateChange:"onMonthChange",thisObj:this}),e}onMonthChange({newDate:e}){const t=this,{startDate:n}=t,r=t.changeStartDate(e);(!n||r-n)&&t.updateRange(t.range),!t.preventScroll&&t.isVisible&&t.store.count&&(t.populateStoreSoon.flush(),t.scrollTo(e))}onCalendarStoreChange({source:e}){this.date||(this.date=e.map((e=>e.startDate)).sort(((e,t)=>e.valueOf()-t.valueOf()))[0]),this.populateStoreSoon()}changeSettings(e,t){return e&&cc.reconfigure(t,cc.mergeConfigs({type:"button",positioned:!0,icon:"b-icon-cog",menuIcon:null,cls:"b-blue b-cal-widget-settings-button",appendTo:this.bodyElement},e),this)}getCurrentConfig(e){const t=super.getCurrentConfig(e);return delete t.store,delete t.data,t}}ZS.initClass(),ZS._$name="EventList";const JS={mouseover:1,mouseout:1},QS={mousedown:1,mouseup:1,click:1,dblclick:1,contextmenu:1};class eD extends(ZS.mixin(_h)){static get $name(){return"AgendaView"}static get type(){return"agendaview"}static get configurable(){return{features:null,eventSorter:bS.interDaySorterFn,eventRowSpacing:8,title:"L{Agenda}",range:"year",hideEventOverflow:null,offsetStartsBeforeEvents:!0,handlePointerInteraction:!1,dayCellRenderer:null,eventRenderer:null,hideHeaders:!0,columns:{name:null,startDate:null,endDate:null,agenda:{type:"agendacolumn"}},eventTimeRenderer:null,enableSticky:!0,preserveScrollOnDatasetChange:!0,positionMode:"position",settings:{},cellTabIndex:null,rowCls:{"b-cal-agenda-grid-row":1},cellCls:{"b-calendar-cell":1},eventBarContainerCls:"b-cal-event-bar-container"}}construct(e){Object.defineProperty(this,"features",{get:()=>({}),set:()=>{}}),super.construct(e),this.bodyContainer.removeAttribute("tabIndex")}onResponsiveStateChange({state:e,oldState:t}){var n;null===(n=super.onResponsiveStateChange)||void 0===n||n.call(this,...arguments),!t||"small"!==t&&"small"!==e||this.refresh()}changeColumns(){var e;const t=super.changeColumns(...arguments);return null==t||null===(e=t.forEach)||void 0===e||e.call(t,(e=>{e.autoHeight=Boolean(!e.isAgendaColumn||e.renderer||this.eventRenderer)})),t}onFocusGesture(){}onGridElementFocus(){}onGridBodyFocusIn(){}focusCell(){}setHoveredRow(){}onElementKeyDown(){}onElementMouseDown(){}editAutoCreatedEvent(e,t){this.populateStoreSoon.now(),super.editAutoCreatedEvent(e,t)}handleEvent(e){const{type:t}=e;super.handleEvent(e),JS[e.type]?this.onEventMouseOverOut(e):QS[t]&&this.onCalendarPointerInteraction(e)}getCellDataFromEvent(e){if(e.target.closest(".b-grid-cell")){const t=super.getCellDataFromEvent(e);return t&&(t.record=this.getEventRecord(e.target)),t}}updateOffsetStartsBeforeEvents(e){this.element.classList.toggle("b-offset-continues-past",Boolean(e))}updateEventRowSpacing(e){this.contentElement.style.setProperty("--event-row-spacing",Mr.setLength(e))}updateSuppressLongEvents(){this.fillFromMaster()}onCalendarStoreChange({action:e,oldCount:t,records:n,removed:r,added:i}){const s=this;if(s.isPainted){if("filter"===e&&!r.length&&!i.length)return;if("dataset"===e)return;if("remove"===e&&1===n.length&&n[0].isEventModel){const{store:e}=s,t=n[0],r=en.clearTime(t.startDate),i=en.clearTime(t.endDate);do{const n=en.makeKey(r),i=s.cellMap.get(n);i&&(ke.remove(i.events,t),i.events.length?s.onStoreUpdateRecord({source:e,record:s.store.getById(n),changes:{}}):(s.cellMap.delete(n),delete s.dateIndex[n],e.remove(n,!0))),r.setDate(r.getDate()+1)}while(r<i);return}}s.populateStoreSoon()}get cellMap(){var e;return null!==(e=this._cellMap)&&void 0!==e&&e.populated?this._cellMap:this.createCellMap({rawEvents:!0,skipPropagate:!0})}populateStore(){var e,t;null===(e=this._cellMap)||void 0===e||e.clear();const n=this,{store:r,eventStore:i}=n;n.eventCount=0,n.date||(n.date=i.map((e=>e.startDate)).sort(((e,t)=>e.valueOf()-t.valueOf()))[0]);const{cellMap:s}=n,o=[...s.values()];n.dateIndex={};for(let e=0,{length:t}=o;e<t;e++){const t=o[e],{events:i,date:s}=t;for(let t=0,{length:r}=i;t<r;t++){const r=i[t];r.isInterDay&&e&&en.clearTime(r.startDate).valueOf()!==s.valueOf()||n.eventCount++}n.dateIndex[t.id]=o[e]=r.createRecord(t)}r.loadData(o),n.refreshCount=(n.refreshCount||0)+1,n.trigger("refresh"),null===(t=n.calendar)||void 0===t||t.syncUIWithActiveView(n),n.columns.forEach((e=>{var t,n;return null===(t=(n=e.constructor).exposeProperties)||void 0===t?void 0:t.call(n)})),n.getConfig("settings")}get count(){return this.eventCount}collectEvents(e){return e.getDateIndex=e=>e>this.startDate&&this.hideEventOverflow?"startDate":"date",this.eventStore.getEvents(e)}changeStore(e){return(e=super.changeStore(e))&&e.addFilter({id:`${this.id}-nonworkingday-filter`,filterBy:e=>!this.hideNonWorkingDays||!e.isNonWorking},!0),e}get modelClass(){return hg}updateHideNonWorkingDays(e){super.updateHideNonWorkingDays(e),this.store.filter()}updateHideEventOverflow(){this.populateStore()}doRefresh(){this.populateStore()}createCellData(e){return Object.assign(this.cellMonth.getCellData(e,this.month),{id:en.makeKey(e),events:[]})}set cellRenderer(e){this._cellRenderer=e}changeSettings(e){return e&&super.changeSettings({menu:f({align:{align:"t100-b100"}},this.listRangeMenu)})}}eD.initClass(),eD._$name="AgendaView";class tD extends(Sw.mixin(xS)){construct(e){if(!e.eventStore){var t;const n=null===(t=e.owner||e.parent)||void 0===t?void 0:t.up("calendar");n&&(e.eventStore=n.eventStore)}super.construct(...arguments)}refreshEventsMap(){const e=this;e.showEvents&&(e.eventsMap=e.eventStore["dots"===e.showEvents?"getEvents":"getEventCounts"]({startDate:e.startDate,endDate:e.endDate,dateMap:e.eventsMap||(e.eventsMap=new Map)}))}cellRenderer({cell:e,date:t}){var n,r;const{showEvents:i}=this,s=null===(n=this.eventsMap)||void 0===n||null===(r=n.get)||void 0===r?void 0:r.call(n,en.makeKey(t)),o="dots"===i?null==s?void 0:s.length:s,a="count"===i?"b-cell-events-badge":"dots"===i?"b-cal-minimal-event-container":"b-icon b-icon-circle";if("dots"===i&&(e.innerHTML="",Mr.createElement({class:"b-date-cell-inner",text:t.getDate(),parent:e})),o){const t={dataset:{count:o},class:{[a]:1,[Sw.getEventCountClass(o)]:1},parent:e,["count"===i?"text":""]:o};if("dots"===i){const e=t.children=[];for(let t=0;t<Math.min((null==s?void 0:s.length)||0,4);t++){const n=this.createEventDomConfig({eventRecord:s[t],minimal:!0});e.push(n)}}Mr.createElement(t)}}static setupClass(e){e.replaceType=!0,super.setupClass(e)}}v(tD,"$name","CalendarDatePicker"),v(tD,"type","datepicker"),v(tD,"configurable",{showEvents:null}),tD.initClass(),tD._$name="CalendarDatePicker";const{MILLIS_PER_HOUR:nD}=zd,rD=new Date(2020,10,22,22,59,59),iD={paint:1,refresh:1,resize:1,eventspercellchange:1},sD=e=>"string"==typeof e&&isNaN(e)?e:Mr.percentify(e),oD=e=>{e.stopImmediatePropagation(),e.cancelBubble=!0},aD=Object.freeze([]),lD=e=>e.ctrlKey&&e.preventDefault(),cD={level:0,step:"1 hour"},dD=new xn(0,0,0,0);class uD extends(kc.mixin(AS,LS,qS,VS)){static get $name(){return"DayView"}static get type(){return"dayview"}static get delayable(){return{updateElementLayout:{type:"raf",cancelOutstanding:!0},refreshDayBackground:{type:"raf",cancelOutstanding:!0}}}static get configurable(){return{textContent:!1,scrollable:{overflowY:!0},title:"L{Day}",eventRenderer:null,eventHeight:"auto",hourHeight:42,range:{magnitude:1,unit:"day"},fixedDuration:null,visibleStartTime:7,dayStartShift:null,dayStartTime:null,dayEndTime:null,dayTime:0,increment:"15 min",intradayCls:null,showTime:!0,showCircle:!1,iconTarget:"header",eventLayout:{type:"fluid"},minDayWidth:null,eventColourStyleProperty:"backgroundColor",monitorResize:Boolean(Mr.scrollBarWidth),eventFilter:void 0,timeFormat:"LST",allDayEvents:{$config:["lazy","nullify"],value:{}},overflowPopup:null,showAllDayHeader:{value:null,$config:null,default:!0},eventSpacing:1,responsive:{small:{descriptionFormat:"MMMM YYYY"},"*":{descriptionFormat:null}},testConfig:{timeFormat:"LST"},maxAllDayHeight:null,fitHours:null,dayCellRenderer:null,coreHours:null,zoomOnMouseWheel:!y.isTouchDevice,hourHeightBreakpoints:{thirty:70,fifteen:140,ten:300,five:500},minEventHeight:"1em",shortEventHeight:32,currentTimeIndicatorRenderer:()=>({className:"b-current-time-indicator",retainElement:!0})}}construct(e){var t;const n=this;n.configuredHiddenVerticalScroll="hidden-scroll"===(null===(t=e.scrollable)||void 0===t?void 0:t.overflowY),n.cellMapEventFilter=n.cellMapEventFilter.bind(n),super.construct(...arguments),n.startDate||(n.startDate=n.month.date),zr.on({theme:"onThemeChange",thisObj:n})}get hasNonWorkingDays(){return!0}updateZoomOnMouseWheel(e){var t;e?this.zoomListener=_n.on({element:this.dayContentElement,wheel:"onDayContentMousewheel",thisObj:this,throttled:{buffer:100,alt:lD}}):null===(t=this.zoomListener)||void 0===t||t.call(this)}get childItems(){const{allDayEvents:e}=this,t=super.childItems;return e&&t.push(e),t}get dayEndTime(){var e,t;return null!==(e=null===(t=this.dayTime)||void 0===t?void 0:t.timeEnd)&&void 0!==e?e:this._dayEndTime}get dayStartTime(){var e,t;return null!==(e=null===(t=this.dayTime)||void 0===t?void 0:t.timeStart)&&void 0!==e?e:this._dayStartTime}get dayStartShift(){var e,t;return null!==(e=null===(t=this.dayTime)||void 0===t?void 0:t.startShift)&&void 0!==e?e:this._dayStartShift}updateDayEndTime(e){this._dayTime=null,this.dayTime=new zd({startShift:this.dayStartShift,timeStart:this.dayStartTime,timeEnd:e})}updateDayStartTime(e){this._dayTime=null,this.dayTime=new zd({startShift:this.dayStartShift,timeStart:e,timeEnd:this.dayEndTime})}updateDayStartShift(e){this._dayTime=null,this.dayTime=new zd({startShift:e,timeStart:this.dayStartTime,timeEnd:this.dayEndTime})}changeDayTime(e){var t;if(e||(e=new zd(this)),null===(t=this._dayTime)||void 0===t||!t.equals(e))return e}updateDayTime(e,t){const n=this,{eventStore:r}=n;if(r&&(r.registerDayIndex(e),t&&r.unregisterDayIndex(t)),!n.isConfiguring){var i;const{startDate:t}=n;n.syncHours(),n.setConfig({date:t,startDate:t}),null===(i=n.allDayEvents)||void 0===i||i.setConfig({date:t,dayTime:e,startDate:t})}}dateKey(e){return this.dayTime.dateKey(e)}dayOfDate(e){return e&&this.dayTime.dayOfDate(e)}isAllDayEvent(e){return e.allDay||!this.dayTime.isIntraDay(e)}async scrollTo(e,t={animate:!0}){const n=this,{allDayEvents:r}=n;if(n.scrollPromise&&await n.scrollPromise,await(null==r?void 0:r.heightAnimation),n.isDestroyed)return;"number"==typeof e&&(e=en.add(n.startDate,e,"hour"));const i=Boolean(e.getHours);return await super.scrollTo(e,Object.assign({},t,{y:!i})),i?(e=e.getHours()+e.getMinutes()/60,n.scrollable.scrollTo(null,n.getPositionFromTime(e),t)):void 0}getEventElement(e,t){var n;return super.getEventElement(e,t)||(null===(n=this.allDayEvents)||void 0===n?void 0:n.getEventElement(e,t))}getEventElements(e){var t;return super.getEventElements(e)||(null===(t=this.allDayEvents)||void 0===t?void 0:t.getEventElements(e))}getPositionFromTime(e){return zd.parse(e)<zd.parse(this.dayStartTime)-this.dayStartShift?0:this.dayTime.delta(e,"h")*this.hourHeight}updateShowAllDayHeader(e){var t,n;const r=this,{_allDayEvents:i}=r;null===(t=r._cellMap)||void 0===t||t.clear(),null==i||null===(n=i._cellMap)||void 0===n||n.clear(),i&&(i.element.classList.toggle("b-hide-allday-header",!e),i.refresh()),r.refresh()}changeAllDayEvents(e,t){if(!e)return null==t?void 0:t.destroy();this.getConfig("date");const n=this,{autoCreate:r,dayHeaderRenderer:i,overflowButtonRenderer:s,overflowClickAction:o,overflowPopup:a,avatarRendering:l,range:c}=n,d=YS.reconfigure(t,e,{owner:n,defaults:{type:"calendarrow",calendar:n.calendar,parent:n,rtl:n.rtl,cls:{"b-dayview-schedule-container":1,"b-dayview-initializing":1},[void 0!==a?"overflowPopup":"_"]:a,[s?"overflowButtonRenderer":"_"]:s,[o?"overflowClickAction":"_"]:o,[i?"dayHeaderRenderer":"_"]:i,[l?"avatarRendering":"_"]:l,autoCreate:r?{newName:r.newName,gesture:r.gesture,startHour:0,duration:"1 day"}:null,dayNameSelector:".b-day-name-date",eventFilter:e=>n.showAllDayHeader&&n.isAllDayEvent(e)&&(!n.eventFilter||n.eventFilter(e)),dayStartTime:n.dayStartTime,dayEndTime:n.dayEndTime,dayStartShift:n.dayStartShift,eventRenderer:n.eventRenderer,eventStore:n.eventStore,month:n.month,fullWeek:1===n.duration,startDate:n.startDate,[c?"range":"_"]:c,[c?"_":"endDate"]:n.endDate,nonWorkingDays:n.nonWorkingDays,nonWorkingDayCls:n.nonWorkingDayCls,weekendCls:n.weekendCls,weekStartDay:n.weekStartDay,defaultCalendar:n.defaultCalendar,emptyCellRenderer:n.emptyCellRenderer,listeners:{heightChange:"updateElementLayout",refresh:"updateElementLayout",catchall:"relayAllDayEvents",showoverflowpopup:"onAllDayOverflowPopupShown",thisObj:n}},setup(e){e.hideNonWorkingDays=!(1===n.duration&&!e.fullWeek)&&n._hideNonWorkingDays}});return d&&(d.height=d.flex=null,n.originalAllDayEventsScrollTo=d.scrollTo,d.scrollTo=n.allDayEventsScrollTo.bind(n)),d}onAllDayOverflowPopupShown({overflowPopup:e}){this._overflowPopup=e}allDayEventsScrollTo(e){const t=this,n=e.isEvent?e.startDate:t.changeEndDate(e);return(e.isEvent?en.intersectSpans(t.startDate,t.endDate,e.startDate,e.endDate):en.betweenLesser(n,t.startDate,t.endDate))||(t.date=n),t.originalAllDayEventsScrollTo.call(t.allDayEvents,...arguments)}updateAutoCreate(e){var t;const{_allDayEvents:n}=this;null===(t=super.updateAutoCreate)||void 0===t||t.call(this,e),n&&(n.autoCreate=!!e&&{newName:e.newName,gesture:e.gesture,startHour:0,duration:"1 day"})}updateWeekStartDay(e,t){var n;null===(n=super.updateWeekStartDay)||void 0===n||n.call(this,e),!this.isConfiguring&&this.allDayEvents&&(this.allDayEvents.weekStartDay=e)}updateEventStore(e,t){super.updateEventStore(e,t);const{dayTime:n}=this;n&&(null==e||e.registerDayIndex(n),null==t||t.unregisterDayIndex(n))}get overflowPopup(){var e;return(null===(e=this._allDayEvents)||void 0===e?void 0:e.overflowPopup)||this._overflowPopup}get stepUnit(){return this.duration>1?`${this.duration} ${this.L("L{daysUnit}")}`:this.L("L{dayUnit}")}get eventContentElement(){return this.dayContainerElement}getDateFromDomEvent(e,t=!1){let n=super.getDateFromDomEvent(e);const r=this,i=Mr.getEventElement(e);return n&&i!==e&&r.dayContainerElement.contains(i)&&(n=en.add(n,r.dayStartHour+(e.clientY-r.scrollable.element.getBoundingClientRect().y+r.scrollable.y)/r.hourHeight,"hour"),t||(n=en.round(n,r.increment))),n}getDateFromPosition(e,t,n=!1){const r=this,{eventContentElement:i,allDayEvents:s}=r,o=r.dayContainerElement.querySelectorAll(`.${r.dayCellCls}`),a=n?dD:xn.fromScreen(i).roundPx().translate(-i.scrollLeft),l=i.scrollWidth,{height:c}=xn.fromScreen(o[0]).roundPx(),d=n?e:e-a.x,u=r.rtl?r.eventContentElement.offsetWidth-d:d,h=t-a.y,g=o.length,m=Math.min(Math.floor(u/l*g),o.length-1);if(s&&(u<0||l<u||h<0||c<h))return s.getDateFromPosition(e,t);let p=r.getDateFromElement(o[0]);return r.hideNonWorkingDays?p=Array.from(o).map((e=>r.getDateFromElement(e)))[m]:m&&p.setDate(p.getDate()+m),en.clearTime(p,!1),p.setMilliseconds(p.getMilliseconds()+r.dayStartMs+Math.floor(h/c*r.getDayLength())),en.round(p,r.increment)}doRefresh(){const e=this;if(e.isVisible){Mr.addTemporaryClass(e.element,"b-no-transitions",200,e);const t=[];e.today=e.dayTime.startOfDay(new Date);for(const n=new Date(e.startDate);n<e.endDate;n.setDate(n.getDate()+1))t.push(e.getDayDomConfig(n));oa.sync({targetElement:e.dayContainerElement,domConfig:{onlyChildren:!0,children:t,syncOptions:{syncIdField:"date",releaseThreshold:0,strict:!0}}}),e.refreshDayBackground(),e.refreshCount=(e.refreshCount||0)+1,e.syncCurrentTimeIndicator(),e.trigger("refresh")}}getDayDomConfig(e){const t=this,{dayCellRenderer:n}=t,r=t.dayTime.dateKey(e),i=t.cellMap.get(r)||n&&t.createCellData(e),s=i?i.day:e.getDay(),o=t.nonWorkingDays||t.month.nonWorkingDays;if(!t.hiddenNonWorkingDays[e.getDay()]||1===t.duration){const a={dataset:{date:r},className:{"b-dayview-day-detail":1,[t.dayCellCls]:1,[t.nonWorkingDayCls]:o[s]||!1,[t.weekendCls]:en.weekends[s],[t.todayCls]:!(e-t.today),"b-last-cell":!(e-t.lastVisibleDate),[`b-day-of-week-${s}`]:1},style:{},children:[],syncOptions:{syncIdField:"eventId",releaseThreshold:0,strict:!0}};return null!=i&&i.events.length&&t.renderEvents(i,a),n?t.callback(n,t,[a,i]):a}}refreshDayEvents(e){const t=this;e=t.changeEndDate(e),t.today=t.dayTime.startOfDay(new Date);const n=t.getDayDomConfig(e);Mr.addTemporaryClass(t.element,"b-no-transitions",200,t),n.onlyChildren=!0,oa.sync({targetElement:t.getDayElement(e),domConfig:n})}renderEvents(e,t){const n=this,{eventSpacing:r}=n,i=n.rtl?"right":"left",s=n.eventLayout.layoutEvents(e);for(let e,o,a,l=0,c=s.length;l<c;l++)o=s[l],a=o.eventRecord,e=n.createEventDomConfig({eventRecord:a}),e.className["b-starts-above"]=o.startsBefore,e.className["b-ends-below"]=o.endsAfter,o.cluster.items.length>1&&(e.className["b-cal-in-cluster"]=1),Object.assign(e.style,{top:sD(o.top),[i]:sD(o.left),width:sD(o.width),height:sD(o.height),[r?"padding-bottom":""]:`${r}px`,minWidth:sD(o.minWidth)}),t.children.push(e)}get overflowElement(){return this.dayContentElement}get cellMap(){var e;return null!==(e=this._cellMap)&&void 0!==e&&e.populated?this._cellMap:this.createCellMap()}get bodyConfig(){const e=this,{allDayEvents:t,maxAllDayHeight:n}=e;return Object.assign(super.bodyConfig,{children:{alldayRowElement:t?{className:{"b-dayview-allday-row":1},style:{[n?"maxHeight":""]:Mr.setLength(n)},children:{cornerElement:{className:{"b-dayview-allday-row-start":1,"b-dayview-allday-autoheight":t.autoHeight},children:{allDayTextElement:{className:"b-dayview-allday-text",html:e.L("L{EventEdit.All day}")},allDayToggleIcon:{tag:"button",className:"b-expand-allday-button b-icon b-icon-expand-row",dataset:{btip:"L{DayView.expandAllDayRow}"}}}},allDayEvents:null==t?void 0:t.element,$scrollerPad:Mr.scrollBarPadElement}}:null,dayContentElement:{tabIndex:-1,className:{"b-dayview-day-content":1},children:{timeAxisElement:{children:e.getTimeElementConfigs(),className:{"b-timeaxis-container":1}},dayContainerElement:{className:{"b-dayview-day-container":1}}}},horizontalScrollerElement:{className:"b-virtual-scrollers b-hide-display",children:[{className:"b-virtual-scroller"},Mr.scrollBarPadElement]}}})}onDayContentMousewheel(e){if(e.ctrlKey){e.preventDefault();const t=e.clientY-this.scrollable.element.getBoundingClientRect().y,n=Math.min(Math.abs(e.wheelDeltaY),10)*Math.sign(e.wheelDeltaY);this.zoomBy(n,t)}}zoomBy(e,t=Math.min(this.scrollable.scrollHeight,this.scrollable.clientHeight)/2-1){this.updateElementLayout.flush();const n=this,{scrollable:r,hourHeight:i}=n,s=en.round("number"==typeof t?n.getDateFromPosition(n.dayContainerElement.offsetWidth/2,t+r.y,!0):en.parse(t,"HH:mm:ss"),n.increment),o=n.getDayLength("h"),a=Math.max(i+e,n.dayContentClientHeight/o),l=n.getPositionFromTime(s)-r.y;n.on({layoutUpdate:()=>{r.scrollTo(null,n.getPositionFromTime(s)-l),r.syncPartners(!1,!0)},once:!0,prio:1e3}),n.fitHours=!1,n.hourHeight=a}zoomTo(e,t){this.zoomBy(e-this.hourHeight,t)}createCellMap(){const{showAllDayHeader:e}=this;return super.createCellMap({dayTime:this.dayTime,startOnly:e,allowPartial:!e,skipPropagate:!0,rawEvents:!0,filter:this.cellMapEventFilter})}cellMapEventFilter(e){const{dayTime:t,hiddenNonWorkingDays:n,showAllDayHeader:r}=this;return(!r||t.isIntraDay(e)&&!e.allDay)&&t.intersects(e)&&!n[t.dayOfWeek(e.startDate)]}getDayLength(e="ms"){return this.dayTime.duration(e)}changeIncrement(e){return"string"==typeof e?(e=en.parseDuration(e),en.as("ms",e.magnitude,e.unit)):e}get dayStartHour(){return null==this.dayStartTime?0:Math.floor(this.dayStartTime/nD)}get dayEndHour(){return null==this.dayEndTime?24:Math.ceil(this.dayEndTime/nD)}get dayStartMs(){return null==this.dayStartTime?0:this.dayStartTime}get dayEndMs(){return null==this.dayEndTime?24*nD:this.dayEndTime}get dayStartOffset(){return this.dayTime.startTimeOffsetMs/nD*this.hourHeight}changeEventFilter(e){return void 0===e&&(e=e=>!this.isAllDayEvent(e)),e}changeEventLayout(e,t){return uS.reconfigure(t,e,this)}updateNonWorkingDays(e){var t;const n=this;var r;null===(t=super.updateNonWorkingDays)||void 0===t||t.call(this,e),n._allDayEvents&&(n._allDayEvents.nonWorkingDays=e),n.isConfiguring||(null===(r=n._cellMap)||void 0===r||r.clear(),n.refresh())}updateMaxAllDayHeight(e){Mr.setLength(this.alldayRowElement,"max-height",e)}get hideNonWorkingDays(){return(!0!==this._hideNonWorkingDays||1!==this.duration)&&this._hideNonWorkingDays}set hideNonWorkingDays(e){super.hideNonWorkingDays=e}updateHideNonWorkingDays(e){const t=this,{_allDayEvents:n}=t;var r;super.updateHideNonWorkingDays(e),n&&(n.hideNonWorkingDays=!(1===t.duration&&!n.fullWeek)&&t._hideNonWorkingDays),t.isConfiguring||(null===(r=t._cellMap)||void 0===r||r.clear(),t.refresh())}syncHours(){var e;const t=this;null===(e=t._cellMap)||void 0===e||e.clear(),oa.sync({targetElement:t.timeAxisElement,childrenOnly:!0,domConfig:{children:t.getTimeElementConfigs()}}),t.updateElementLayout.now(),t.refresh()}syncCurrentTimeIndicator(){const e=this,t=new Date,n=e.getDayElement(t),{currentTimeIndicator:r,dayTime:i,endDate:s,startDate:o}=e;if(o&&s)if(n&&en.betweenLesser(t,o,s)&&i.contains(t)){const s=e.getDayLength("ms"),o=i.delta(t,"ms");r.parentNode!==n&&(null==n||n.appendChild(r)),r.style.top=Mr.percentify(o/s*100)}else r.remove()}get currentTimeIndicator(){return this._currentTimeIndicator||(this._currentTimeIndicator=Mr.createElement(this.callback(this.currentTimeIndicatorRenderer,this)))}getTimeElementConfigs(){const e=this,t=[],{dayTime:n}=e,{startHour:r}=n,i=new Date(2e3,5,15,r,0,0),s=n.duration("h");for(let n,r=1;r<=s;r++){const r=this.createFiveMinuteTicks(i);i.setHours(n=i.getHours()+1),i.setMinutes(0),t.push({className:`b-dayview-timeaxis-time b-dayview-timeaxis-time-${n<10?"0":""}${n}`,children:r.concat([{className:"b-dayview-hour-tick",text:en.format(i,e.timeFormat)}])})}return t.push(...e.coreHoursBlockers),t}createFiveMinuteTicks(e){const t=[];for(let n=1;n<12;n++)e.setMinutes(5*n),t.push({className:{"b-dayview-five-minute-tick":1,"b-dayview-ten-minute-tick":!(1&n),"b-dayview-fifteen-minute-tick":!(n%3),"b-dayview-half-hour-tick":6===n},text:en.format(e,this.timeFormat)});return t}changeCoreHours(e){const t=this;return e&&(e._overlayDay=e.overlayDay,Object.defineProperty(e,"overlayDay",{set(e){this._overlayDay=e,t.updateElementLayout()},get(e){return this._overlayDay}})),e}get coreHoursBlockers(){const{dayTime:e,coreHours:t}=this;return t?[{style:{height:`calc(var(--hour-height) * ${e.delta(t.start,"h")})`},class:"b-outside-core-hours b-before-core-hours"},{style:{top:`calc(var(--hour-height) * ${e.delta(t.end,"h")})`,height:`calc(var(--hour-height) * ${e.timeEnd/1e3/60/60-t.end})`},class:"b-outside-core-hours b-after-core-hours"}]:aD}changeStartDate(){return this.dayOfDate(super.changeStartDate(...arguments))}updateStartDate(e){const{_allDayEvents:t}=this;t&&this._allDayEvents.setConfig({date:this.date,startDate:e}),super.updateStartDate(...arguments)}changeEndDate(){return this.dayOfDate(super.changeEndDate(...arguments))}updateEndDate(e){var t;const{_allDayEvents:n}=this;null===(t=super.updateEndDate)||void 0===t||t.call(this,...arguments),n&&!this.updatingRange&&this._allDayEvents.setConfig({date:this.date,endDate:e})}changeMinDayWidth(e){return"number"==typeof e?Math.max(e,50):null}updateMinDayWidth(e){this.contentElement.style.setProperty("--min-day-width",Mr.setLength(e)),this._allDayEvents&&(this._allDayEvents.minDayWidth=e),this.updateElementLayout()}updateHourHeight(e){this.shortEventDuration=36e5/(e/this.shortEventHeight),this.isConfiguring||(this.updateElementLayout(),this.fitHours&&this.refresh())}updateShortEventHeight(e){this.updateHourHeight(this.hourHeight)}updateMinEventHeight(e){this.contentElement.style.setProperty("--dayview-min-event-height",Mr.setLength(e))}updateHourHeightBreakpoints(){this.isConfiguring||this.updateElementLayout()}get hourHeight(){return!this.isConfiguring&&this.fitHours?Math.max(this.dayContentClientHeight/this.getDayLength("hour"),this.minHourHeight):this._hourHeight}changeFitHours(e){return null!=e&&e.minHeight?this.minHourHeight=Math.max(e.minHeight,9):this.minHourHeight=17,e}get dayContentClientHeight(){return Mr.floorPx(xn.client(this.dayContentElement).height)}updateFitHours(e){const t=this;t.isConfiguring||e&&(t.hourHeight=Math.max(t.dayContentClientHeight/t.getDayLength("hour"),t.minHourHeight)),t.element.classList.toggle("b-fit-hours",Boolean(e)),t.monitorResize=Mr.scrollBarWidth||e}updateEventSpacing(){var e;this.isConfiguring||(null===(e=this._cellMap)||void 0===e||e.clear(),this.refresh())}onPaint({firstPaint:e}){const t=this,{dayContainerElement:n,horizontalScrollerElement:r}=t,{scrollBarWidth:i}=Mr;if(e){const{allDayEvents:e}=t;t.horizontalScroller=new wa({widget:t,element:n,overflowX:!i||"hidden-scroll",overflowY:"clip"}),e&&(e.element.classList.remove("b-dayview-initializing"),t.horizontalScroller.addPartner(e.headerScroller)),ua.addResizeListener(t.dayContainerElement,t.onDayContainerResize.bind(t)),t.scrollbarScroller=new wa({widget:t,element:r.firstChild,scrollWidth:n.scrollWidth-i,overflowX:!0,overflowY:!1}),t.horizontalScroller.addPartner(t.scrollbarScroller),t.refresh(),t.updateElementLayout.now(),t.setInterval(t.syncCurrentTimeIndicator.bind(t),3e4,"syncCurrentTimeIndicator"),e&&(_n.on({click:{element:t.cornerElement,handler:"onCornerClick"},mousemove:{element:t.allDayEvents.element.nextSibling,handler:oD,capture:!0},thisObj:t}),t.scrollable.on({overflowChange:"syncScrollbarPadding",thisObj:t})),t.scrollToVisibleStartTime()}}scrollToVisibleStartTime(){const e=this,{scrollable:t}=e,n=e.getPositionFromTime(e.visibleStartTime),r=()=>{t.scrollTo(null,n,{animate:!1,block:"start"})};!e.scrollToStartTimer&&e.allDayEvents&&n>t.maxY?e.scrollToStartTimer=e.allDayEvents.on({heightChange:r,once:!0,expires:{delay:5e3,alt:r},name:"scrollToVisibleStartTime"}):r()}relayAllDayEvents(e){const{type:t}=e;if(!iD[t])return this.trigger(t,e)}async onCornerClick(){const{allDayEvents:e}=this;e.isAnimating||(await e.toggleExpandCollapse(),this.isDestroyed||(this.allDayToggleIcon.dataset.btip=e.expanded?this.L("L{collapseAllDayRow}"):this.L("L{expandAllDayRow}")))}syncScrollbarPadding(){if(!this.configuredHiddenVerticalScroll&&this.allDayEvents)if(Mr.scrollBarWidth){if(!this.allDayEvents.isAnimating){const{allDayEvents:e,alldayRowElement:t,scrollable:n}=this,r=this.fitHours&&n.clientHeight/this.getDayLength("hour")>=this.minHourHeight,i=!r&&n.hasOverflow(),{headerElement:s,scrollable:o}=e,a=e.expanded||e.autoHeight,l=Boolean(a&&o.hasOverflow());i&&l?(s.classList.add("b-show-yscroll-padding"),t.classList.remove("b-show-yscroll-padding"),n.overflowY=o.overflowY="auto"):l!==i?l?(s.classList.add("b-show-yscroll-padding"),o.overflowY="auto",n.overflowY="scroll"):(s.classList.remove("b-show-yscroll-padding"),t.classList.add("b-show-yscroll-padding"),o.overflowY="hidden",n.overflowY=!r&&"auto"):(t.classList.remove("b-show-yscroll-padding"),s.classList.remove("b-show-yscroll-padding"),n.overflowY=!r&&"auto",o.overflowY="hidden")}}else this.scrollable.overflowY=this.allDayEvents.scrollable.overflowY="auto"}onInternalResize(e,t,n,r,i){const{_allDayEvents:s}=this;super.onInternalResize(e,t,n,r,i),i&&(null==s||s.performResizeRefresh(s.eventsPerCell,s.eventContainerTop),n!==i&&(this.updateElementLayout(),this.syncScrollbarPadding()))}onThemeChange(){this.updateElementLayout()}onDayContainerResize(e,{height:t}={},{height:n}){t&&(n!==t||Mr.scrollBarWidth&&this.minDayWidth)&&(this.updateElementLayout(),this.fitHours&&this.updateFitHours(this.fitHours))}async updateElementLayout(){var e,t;if(!this.refreshCount||null!==(e=this.owner)&&void 0!==e&&e.isDestroyed)return;const n=this,{dayContainerElement:r,horizontalScrollerElement:i,horizontalScroller:s,allDayEvents:o}=n,a=r.querySelectorAll(`.${n.dayCellCls}`),{scrollBarWidth:l}=Mr;let c,d;if(n.timeAxisElement.classList.toggle("b-core-hours-overlay-day",Boolean(null===(t=n.coreHours)||void 0===t?void 0:t.overlayDay)),o){const e=n.cornerElement.classList;o.hasOverflow?(e.add("b-has-cell-overflow"),e.toggle("b-expanded",Boolean(o.expanded))):e.remove("b-has-cell-overflow")}for(n.refreshDayBackground.now(),c=0,d=a.length-1;c<=d;c++)a[c].classList.toggle("b-last-cell",c===d);if(o&&n.syncScrollbarPadding(),l&&i.classList.toggle("b-show-yscroll-padding",n.scrollable.hasOverflow()),a.length)if(n.minDayWidth&&r.scrollWidth>r.clientWidth){const e=(n.minDayWidth||(a.length?a[0].offsetWidth:0))*a.length;i.classList.remove("b-hide-display"),n.scrollbarScroller.scrollWidth=e,s.overflowX="hidden-scroll"}else i.classList.add("b-hide-display"),s.overflowX=!1;n.trigger("layoutUpdate")}refreshDayBackground(){const e=this,{contentElement:t,hourHeight:n,dayStartOffset:r,_hourHeightLevel:i,hourHeightLevel:s}=e,o=e.dayContentElement.classList,a=e.getDayLength("hour"),l=n*a,c=(n-1)/2,d=(n-1)/12,u=t.style,h=Math.ceil(en.format(rD,e.timeFormat).length/2);o.remove("b-dayview-hourheight-level-1","b-dayview-hourheight-level-2","b-dayview-hourheight-level-3","b-dayview-hourheight-level-4"),o.add(`b-dayview-hourheight-level-${s.level}`),u.setProperty("--time-axis-width",`${h}em`),u.setProperty("--day-length",a),u.setProperty("--day-height",`${l}px`),u.setProperty("--hour-height",`${n}px`),u.setProperty("--half-hour-height",`${c}px`),u.setProperty("--five-minute-height",`${d}px`),u.setProperty("--day-start-offset",`${r}px`),s.level!==(null==i?void 0:i.level)&&e.trigger("tickChange",{old:i||cD,new:s})}get hourHeightLevel(){const e=this,{hourHeight:t,hourHeightBreakpoints:n}=e;return t>=n.five?e._hourHeightLevel={level:4,step:"5 minutes"}:t>=n.ten?e._hourHeightLevel={level:3,step:"10 minutes"}:t>=n.fifteen?e._hourHeightLevel={level:2,step:"15 minutes"}:t>=n.thirty?e._hourHeightLevel={level:1,step:"30 minutes"}:e._hourHeightLevel=cD,e._hourHeightLevel}updateLocalization(){!this.isConfiguring&&this.allDayTextElement&&oa.sync({targetElement:this.allDayTextElement,domConfig:{html:this.L("L{EventEdit.All day}")}}),super.updateLocalization()}}uD.initClass(),uD._$name="DayView";class hD extends(ll.mixin(Nd,kh,_h)){get hideNonWorkingDays(){var e;return null===(e=this.calendar)||void 0===e?void 0:e.hideNonWorkingDays}set hideNonWorkingDays(e){const{calendar:t}=this;t&&(e||null!=t.hideNonWorkingDays)&&(t.hideNonWorkingDays=e)}changeIncludeWeekendsButton(e,t){var n;const r=this,i=e&&(null===(n=r.calendar)||void 0===n?void 0:n.includeWeekendsButton);return i&&(e=cc.mergeConfigs(e,i)),e&&!t?r.add(e):cc.reconfigure(t,e,r)}updateIncludeWeekendsButton(e){e&&(e.toggleGroup=null),this.syncFullWeek()}changeIncludeWeekendsMenuItem(e,t){var n;const r=null==this||null===(n=this.button)||void 0===n?void 0:n.menu;return e&&!t?null==r?void 0:r.add(e):Oc.reconfigure(t,e,r)}updateIncludeWeekendsMenuItem(){this.syncFullWeek()}onBeforeFirstShowModeMenu({menu:e}){const t=this,{calendar:n}=t,{activeView:r}=n,i=Object.values(n.modes);let s,o;for(o of i)s=o.$modeMenuItem,e.add(s),s.checked=o===r,s.onToggle="up.onToggleMenuItem";t.getConfig("includeWeekendsMenuItem"),t.syncFullWeek(),t.menuReady=!0}addMode(e,t,n){const r=this,{buttonBar:i}=r,s=t.$modeMenuItem=Oc.reconfigure(t.$modeMenuItem,Oc.mergeConfigs({type:Oc,view:t,ref:`${e}ShowMenuItem`,checked:!1,closeParent:!0,toggleGroup:`${r.id}-modeSelectorMenuItem`,localizable:!1,text:t.displayName,weight:0},n)),o=i.add(cc.mergeConfigs({view:t,ref:`${e}ShowButton`,toggleGroup:`${r.id}-modeSelectorButton`,text:t.displayName,localizable:!1,onToggle:"up.onToggleButton",weight:0},n));r.getConfig("includeWeekendsButton"),t.on({thisObj:r,localized(){o.text=t.displayName,s.text=t.displayName}})}onToggleButton({source:e,pressed:t}){t&&(this.calendar.mode=e.view)}onToggleMenuItem({source:e,checked:t}){t&&(this.calendar.mode=e.view)}onToggleWorkingDaysButton({pressed:e}){this.hideNonWorkingDays=!e}onToggleWorkingDaysMenu({checked:e}){this.hideNonWorkingDays=!e}syncActiveMode(e){const t=this,n=t.buttonBar.items;let r;for(r of(t.button.text=e.displayName,t.includeWeekendsButton.hidden=!e.hasNonWorkingDays,t.syncFullWeek(),n))r.view&&(r.pressed=r.view===e);if(t.menuReady)for(r of t.button.menu.items){var i;(null===(i=r.view)||void 0===i?void 0:i.$modeMenuItem)===r&&(r.checked=r.view===e)}t[n.length>1?"show":"hide"]()}syncFullWeek(){const{calendar:e,hideNonWorkingDays:t,_includeWeekendsButton:n,_includeWeekendsMenuItem:r}=this,i=!t;e.isConfiguring||(n&&(n.pressed=i),r&&(r.checked=i))}changeButton(e,t){return cc.reconfigure(t,e)}updateButton(e){e&&this.add(e)}changeButtonBar(e,t){return Mu.reconfigure(t,e)}updateButtonBar(e){e&&this.add(e)}changeCalendar(e){return e&&!e.isWidget&&(e=this.up(e)),e}updateCalendar(e){this.detachListeners("cal"),this.syncFullWeek(),null==e||e.on({name:"cal",changeHideNonWorkingDays:"syncFullWeek",thisObj:this})}}v(hD,"$name","ModeSelector"),v(hD,"type","calendarmodeselector"),v(hD,"configurable",{minifiable:!0,minified:null,button:{type:"button",icon:"b-icon-calendar-days",cls:"b-calendar-mode-button",menuIcon:null,menu:[],listeners:{beforeShowMenu:"up.onBeforeFirstShowModeMenu",once:!0}},buttonBar:{type:"buttongroup",ignoreParentReadOnly:!0},calendar:{value:"calendar",$config:"lazy"},includeWeekendsButton:{$config:"lazy",value:{type:"button",cls:"b-calendar-fullweek-button",toggleGroup:"no",text:"L{ModeSelector.weekends}",tooltip:"L{ModeSelector.includeWeekends}",onToggle:"up.onToggleWorkingDaysButton",weight:-1}},includeWeekendsMenuItem:{$config:"lazy",value:{separator:!0,text:"L{ModeSelector.includeWeekends}",checked:!1,onToggle:"up.onToggleWorkingDaysMenu",weight:10}},layout:{type:"box",wrap:!1},overflowable:"none",responsive:{large:{minifiable:!0,minified:null},"*":{minifiable:!1,minified:!0}},responsiveTarget:"@calendar"}),v(hD,"fenced",{onToggleButton:!0,onToggleMenuItem:!0,syncFullWeek:!0,syncActiveMode:{all:"syncActiveMode",lock:["onToggleButton","onToggleMenuItem","syncActiveMode"]}}),hD.initClass(),hD._$name="ModeSelector";const gD=/^(\d+)ev$/,mD={shrinkwrap:1,expand:1};class pD extends(ku.mixin(AS,LS,HS)){static get $name(){return"MonthView"}static get type(){return"monthview"}static get configurable(){return{eventSorter:bS.interDaySorterFn,localizableProperties:["title","stepUnit"],title:"L{Month}",stepUnit:"L{monthUnit}",localeClass:this,descriptionFormat:"MMMM, YYYY",dayNumberCentered:null,eventHeight:20,minHeight:485,autoRowHeight:{$config:"lazy",value:!1},maxEventsPerCell:100,minRowHeight:null,overflowClickAction:"popup",alwaysRefreshOnMonthChange:!0}}static get delayable(){return{syncCalendarWeekDaysWithScrollable:{type:"raf",cancelOutstanding:!0},onAllWeekElementsCollapsed:{type:"raf",cancelOutstanding:!0}}}onCalendarStoreChange(){super.onCalendarStoreChange(...arguments),this.syncShrinkwrappedRows()}onDateChange({changes:e}){e.m&&this.syncShrinkwrappedRows()}onCellOverflowGesture({date:e}){mD[this.overflowClickAction.toLowerCase()]?this.shrinkwrapWeekRow(e):super.onCellOverflowGesture(...arguments)}addCellHeaderContent(e,t){const n={className:{"b-day-name":!0}};return e.children=[t.visibleColumnIndex||this.showWeekColumn?null:{className:"b-week-num",text:t.week[1]},n],n}get shrinkwrappedRows(){return this.weeksElement.querySelectorAll(".b-shrinkwrapped")}get shrinkwrapRowHeights(){const e=this,t=[],{cellMap:n}=e;return e.month.eachWeek(((e,[r])=>{let i=0;for(let e=0;e<7;e++,r.setDate(r.getDate()+1)){const e=n.get(en.makeKey(r));e&&(i=Math.max(i,e.renderedEvents.length))}t.push(i)})),t.map((t=>e.eventHeightInPixels*t+e.eventSpacing*(t+1)+Math.ceil(e._eventContainerTop)))}getEventsPerCell(e){const t=this;if(t.hasShrinkwrappedRows){const n=Math.floor(en.diff(t.startDate,e,"d")/7);if(t.weekElements[n].classList.contains("b-shrinkwrapped"))return t.maxEventsPerCell;{const e=t.weekElements[n].querySelector(t.visibleCellSelector).offsetHeight-t.eventContainerTop;return Math.floor((e+t.eventSpacing)/(t.eventHeightInPixels+t.eventSpacing))}}return t.eventsPerCell}getMaxEventsForWeek(e){const{row:t}=this.getWeekContext(e);return Math.max(...Array.from(t.querySelectorAll(this.visibleCellSelector)).map((e=>{const t=this.cellMap.get(e.dataset.date);return(null==t?void 0:t.renderedEvents.length)||0})))}getWeekContext(e){let t,n;if("number"==typeof e)n=e,t=en.parseKey(this.weekElements[e].querySelector(this.visibleCellSelector).dataset.date);else if(1===e.nodeType)t=en.parseKey(e.closest(".b-calendar-row").querySelector("[data-date]").dataset.date),n=Math.floor(en.diff(this.startDate,t,"d")/7);else{const r=(e.getDay(e)-en.weekStartDay+7)%7;t=en.add(en.clearTime(e),-r,"d"),n=Math.floor(en.diff(this.startDate,e,"d")/7)}return{rowIndex:n,weekStart:t,row:this.weekElements[n]}}shrinkwrapWeekRow(e,t=!0){const n=this,{weekStart:r,row:i}=n.getWeekContext(e),{weekElements:s}=n,o=i.classList.contains("b-shrinkwrapped"),a=n.getMaxEventsForWeek(e),l=n.eventHeightInPixels*a+n.eventSpacing*(a+1)+Math.ceil(n._eventContainerTop);for(let e=0,{length:t}=s;e<t;e++){const t=s[e];t.classList.contains("b-shrinkwrapped")||(t.style.flex=`0 0 ${Mr.percentify(1/n.visibleWeekCount*100)}`)}t&&(n.scrollable={overflowY:"auto"});const c=i.getBoundingClientRect();if(i.classList.add("b-shrinkwrapped"),l>c.height&&i.classList.add("b-expanded"),n.hasShrinkwrappedRows=!0,i.style.flex=`0 0 ${l}px`,t&&n.refresh(),o||n.trigger("weekShrinkwrap",{weekStart:r,element:i}),t)return n.isAnimating=!0,new Promise((e=>{_n.onTransitionEnd({element:i,property:"flex-basis",handler:"onAllWeekElementsExpanded",thisObj:n,args:[e]})}))}onAllWeekElementsExpanded(e,t,n){this.isAnimating=!1,this.syncCalendarWeekDaysWithScrollable(),n()}flexWeekRow(e,t=!0){const n=this,{weekStart:r,row:i}=n.getWeekContext(e);if(i.classList.contains("b-shrinkwrapped"))return i.style.flex=`0 0 ${Mr.percentify(1/n.visibleWeekCount*100)}`,i.classList.add("b-flexing"),n._autoRowHeight=!1,n.trigger("weekFlex",{weekStart:r,element:i}),t&&(n.isAnimating=!0),new Promise((e=>{_n.onTransitionEnd({element:i,property:"flex-basis",handler:t?"onAllWeekElementsCollapsed":"onWeekElementCollapsed",thisObj:n,args:[e]})}))}onWeekElementCollapsed(e,t,n){e.classList.remove("b-shrinkwrapped","b-flexing","b-expanded"),n()}onAllWeekElementsCollapsed(e,t,n){const r=this,{weekElements:i}=r;if(r.scrollable.overflowY=r.scrollable.hasOverflow("y"),e.classList.remove("b-shrinkwrapped","b-flexing","b-expanded"),!r.contentElement.querySelector(".b-calendar-week.b-shrinkwrapped"))for(let e=0,{length:t}=i;e<t;e++){const t=i[e];t.classList.contains("b-shrinkwrapped")||(t.style.flex="")}r.isAnimating=!1,r.hasShrinkwrappedRows=r.shrinkwrappedRows.length,r.refresh(),r.syncCalendarWeekDaysWithScrollable(),n()}syncCalendarWeekDaysWithScrollable(){var e;this.weekdaysHeader.classList[null!==(e=this.scrollable)&&void 0!==e&&e.hasScrollbar()?"add":"remove"]("b-show-yscroll-padding")}updateHideOtherMonthCells(){super.updateHideOtherMonthCells(...arguments),this.refresh()}updateEventHeight(e,t){const n=this;if(super.updateEventHeight(e,t),!n.isConfiguring){var r;null!==(r=n.minRowHeight)&&void 0!==r&&r.match(gD)&&n.updateMinRowHeight(n._minRowHeight),n.syncShrinkwrappedRows();const e=Mr.getEdgeSize(n.element,"padding","tb");n.minHeight=6*(2*(n.eventHeightInPixels+1)+3*n.eventSpacing+Math.ceil(n.eventContainerTop))+n.weekdaysHeader.offsetHeight+7+e.height}}updateMinRowHeight(e){var t,n,r;const i=this,s=parseInt(null===(t=e)||void 0===t||null===(n=t.match)||void 0===n||null===(r=n.call(t,gD))||void 0===r?void 0:r[1]);if(!isNaN(s)){if(i.isConfiguring)return i.on({paint:"updateMinRowHeight",args:[e],once:!0});e=i.eventHeightInPixels*s+i.eventSpacing*(s+1)+Math.ceil(i.eventContainerTop)}i.cssMinRowHeight=Mr.setLength(e),super.updateMinRowHeight(e),i.isAnimating?i.on({animationEnd:"performResizeRefresh",thisObj:i,args:[i._eventsPerCell,i._eventContainerTop],once:!0}):i.performResizeRefresh(i._eventsPerCell,i._eventContainerTop)}async updateAutoRowHeight(e,t){var n,r;if(this.initializingAutoRowHeight&&e===Boolean(t))return;const i=this,{weekElements:s}=i,{length:o}=s,a=null===(n=i.features||(null===(r=i.calendar)||void 0===r?void 0:r.features))||void 0===n?void 0:n.weekExpander;let l;if(a&&e&&(a.disabled=a.disabledByAutoRowHeight=!0),e)for(let e=0;e<o;e++)l=i.shrinkwrapWeekRow(e,e===o-1);else for(let e=0;e<o;e++)l=i.flexWeekRow(e,e===o-1);await l,a&&!e&&a.disabledByAutoRowHeight&&(a.disabled=a.disabledByAutoRowHeight=!1),e||(i._eventContainerHeight=i._eventsPerCell=null,i.refresh())}syncShrinkwrappedRows(){if(this.isVisible){const{shrinkwrappedRows:e}=this;for(let t=0,{length:n}=e;t<n;t++)this.shrinkwrapWeekRow(e[t],t===n-1)}}changeScrollable(e,t){var n;return null!==(n=e=super.changeScrollable(e,t))&&void 0!==n&&n.overflowX&&(this.weekdaysScrollable||(this.weekdaysScrollable=new wa({widget:this,element:this.weekdaysHeader,overflowX:"hidden-scroll"})),e.addPartner(this.weekdaysScrollable,"x")),e}collectEvents(e){if(this.hideOtherMonthCells){const{year:t,month:n}=this.month;e.startDate=new Date(t,n,1),e.endDate=new Date(t,n+1,1)}return e.getDateIndex=e=>e>(this.firstVisibleDate||this.startDate)?"startDate":"date",this.eventStore.getEvents(e)}getDayElement(e,t){if("string"!=typeof e&&(e=en.makeKey(e)),!t||parseInt(e.substr(5,2))===this.month.month+1)return super.getDayElement(e)}calendarHitTest(e){const t=super.calendarHitTest(e),n=Mr.getEventElement(e);if(t){var r;if(t.date.getMonth()!==this.month.month&&(this.disableOtherMonthCells||this.hideOtherMonthCells))return;const e=n.closest(".b-calendar-week"),s=null==e||null===(r=e.dataset.week)||void 0===r?void 0:r.split(",").map(Number);var i;s&&(t.cell=t.cell||n.closest(".b-calendar-cell"),t.dayNumber=Number(null===(i=t.cell)||void 0===i?void 0:i.dataset.columnIndex),t.week=s,t.weekElement=e,t.weekNumber=s[1],t.weekOffset=s[1]-Number(this.weeksElement.firstElementChild.dataset.week.split(",")[1]))}return t}getDateFromPosition(e,t){const n=this,r=n.weeksElement.childNodes;for(let i,s=0;s<r.length;++s)if(i=r[s].getBoundingClientRect(),i.top<=t&&t<i.bottom&&i.left<=e&&e<i.right){const t=n.rtl?i.right-e:e-i.x,o=Math.floor(t*n.weekLength/i.width);if(n.hideNonWorkingDays)return Array.from(r[s].querySelectorAll(n.visibleCellSelector)).map((e=>n.getDateFromElement(e)))[o];{const e=n.getDateFromElement(r[s].querySelector(n.visibleCellSelector));return e.setDate(e.getDate()+o),e}}return null}getWeekElementFor(e){const t=Mr.getEventElement(e);return(null==t?void 0:t.closest(".b-calendar-week"))||null}updateEventStore(e,t){var n;null===(n=super.updateEventStore)||void 0===n||n.call(this,e,t),ku.prototype.doRefresh.call(this)}updateOverflowClickAction(){this.refresh()}updateSixWeeks(){this._eventsPerCell=this._eventContainerTop=this._eventContainerHeight=null,super.updateSixWeeks(...arguments)}onMonthDateChange({changes:e}){e.r&&!this.sixWeeks&&(this._eventsPerCell=this._eventContainerTop=this._eventContainerHeight=null),super.onMonthDateChange(...arguments)}doRefresh(){var e;this.isConfiguring||(this.getConfig("autoRowHeight"),null===(e=this._cellMap)||void 0===e||e.clear());const t=super.doRefresh();return this.syncCalendarWeekDaysWithScrollable(),t}showEvent(e){this.setDate(e.startDate)}changeDayNumberCentered(e){return Boolean(e)}updateShowWeekColumn(e){e||this.element.querySelector(".b-week-num")||this.doRefresh(),super.updateShowWeekColumn(e)}updateHideNonWorkingDays(e){var t;null===(t=super.updateHideNonWorkingDays)||void 0===t||t.call(this,e),this.isConfiguring||this.refresh()}updateDayNumberCentered(e){const t=this;t._dayNumberCentered||"nonCenteredDayNumShowWeekColumn"in t||(t.nonCenteredDayNumShowWeekColumn=t.showWeekColumn),t._dayNumberCentered=e,t.element.classList[e?"add":"remove"]("day-number-center"),t.showWeekColumn=!!e||t.nonCenteredDayNumShowWeekColumn}get dayNameSelector(){return this.showWeekColumn?".b-cal-cell-header":super.dayNameSelector}set dayNameSelector(e){this._dayNameSelector=e}isValidTargetDate(e){if(e.getMonth()!==this.month.month){var t,n;const r=this.minDate||(null===(t=this.calendar)||void 0===t?void 0:t.minDate),i=this.maxDate||(null===(n=this.calendar)||void 0===n?void 0:n.maxDate);if(!isNaN(r)||!isNaN(i)){const{cellMonth:t}=this;if(t.date=e,!isNaN(r)&&t.startDate<r)return!1;if(!isNaN(i)&&en.add(t.endDate,1,"d")>i)return!1}}return!0}set startDate(e){this.date=e}get startDate(){return super.startDate}next(){this.date=en.add(this.date||this.startDate,1,"month")}previous(){this.date=en.add(this.date||this.startDate,-1,"month")}}pD.initClass(),pD._$name="MonthView";const fD=new Date(0),vD=en.add(fD,1,"day"),yD=Object.freeze(new Map),bD={hourHeight:1,showAllDayHeader:1};class CD extends(kc.mixin(AS)){static get $name(){return"ResourceView"}static get type(){return"resourceview"}static get configurable(){return{textContent:!1,scrollable:{overflowX:!0},date:{$config:{equal:"date"},value:null},view:{type:"weekview"},timeAxisConfigs:["allDayEvents","timeFormat","hourHeight","visibleStartTime","dayStartTime","dayEndTime","zoomOnMouseWheel"],stableResourceOrder:!0,resourceWidth:null,hideNonWorkingDays:null,viewCache:{$config:["lazy","nullify"],value:!0},avatarRendering:{},meta:null,showAvatars:!0}}construct(){var e,t;super.construct(...arguments),null===(e=this.calendar.sidebar)||void 0===e||null===(t=e.widgetMap.resourceFilter)||void 0===t||t.on({change:"onResourceFilterSelectionChange",thisObj:this})}get hasNonWorkingDays(){return!0}changeView(e){const t=this,n=new Proxy(sn.assign({},e),{set(e,n,r){const i=Reflect.set(...arguments);return t.syncViewConfig(n,r),i},deleteProperty(e,n){const r=Reflect.deleteProperty(...arguments);return t.syncViewConfig(n,null),r}});return t.viewType=bryntum.Calendar.Modes.resolveType(e.type),n}eachView(e,t,n=null){const r=null==t,i=[...this.viewCache];for(let s=0,{length:o}=i;s<o;s++){const o=i[s];if(r&&(t=[o,s]),!1===o.callback(e,n||o,t))return}}get views(){return[...this.viewCache]}updateResourceStore(e){var t;this.detachListeners("resourceViewResourceChange"),null===(t=super.updateResourceStore)||void 0===t||t.call(this,e),e.on({name:"resourceViewResourceChange",change:"onResourceStoreChange",sort:"onResourceStoreSort",thisObj:this}),this.refreshSoon()}onResourceStoreChange(){this.refreshSoon()}onResourceStoreSort({source:e}){const t=this.items.filter((e=>e.isVisible&&!e.isResourceDayViewTimeAxis)),n=e.map((e=>this.createViewId(e))),r=t.map((e=>e.id));sn.isEqual(n,r)||(this.remove(...t),this.refreshSoon())}onResourceFilterSelectionChange(){this.refreshSoon()}changeViewCache(e,t){if(e)return new os;t&&(t.forEach((e=>e.destroy())),t.clear())}getResourceView(e){return this.viewCache.get(this.createViewId(e))||this.createView(e)}doRefresh(){const e=this,{scrollBarWidth:t}=Mr,{calendar:n,_items:r,resourceStore:i}=e,{resourceFilter:s}=null==n?void 0:n.widgetMap,o=s?e.resourceStore.records.filter((e=>s.value.includes(e))):e.resourceStore.records,{length:a}=o,l=[],c=[],d={};e.refreshSoon.cancel();let u=0;for(let t=0;t<a;t++){const n=e.getResourceView(o[t]),s=r.includes(n);i.getById(n.resourceId)?(n.title=e.titleTemplate(n.resource),s?u++:l.push(n),d[n.id]=1):s&&c.push(n)}if(u<r.count&&(e.eachView((e=>{d[e.id]||c.push(e)})),e.remove(c)),e.viewType.isDayView&&(r.includes(e.dayViewTimeAxis)||l.unshift(e.dayViewTimeAxis),t&&!r.includes(e.dayViewScroller)&&l.push(e.dayViewScroller)),e.add(...l),l.length||c.length){let t;for(let n=0,{items:r}=e,{length:i}=r;n<i;n++){var h;const e=r[n],{scrollable:i}=e;e.element.classList.remove("b-last-resource-view"),e.isResourceDayViewTimeAxis||(e.element.classList[n>1?"remove":"add"]("b-first-resource-view"),t=e),i&&(i.clearPartners(),n&&e.scrollable.addPartner(r[n-1].scrollable,"y")),null===(h=e.allDayEvents)||void 0===h||h.refresh()}t&&t.element.classList.add("b-last-resource-view")}e.viewType.isDayView&&(r.forEach((e=>{var t,n;null===(t=e.allDayEvents)||void 0===t||t.setEventContentHeight(null===(n=e.allDayEvents)||void 0===n?void 0:n.cellContentHeight)})),e.syncDayViewScrollerVisibility()),e.refreshCount=(e.refreshCount||0)+1,e.trigger("refresh")}onCalendarPointerInteraction(){}onCalendarStoreChange(){}onChildAdd(e){super.onChildAdd(e),$e.before(e,"onConfigChange","onChildViewConfigChange",this,{return:!1})}onChildViewConfigChange({name:e,value:t}){this.syncingChildViewConfigs||(this.syncingChildViewConfigs=!0,this.timeAxisConfigs.includes(e)&&this.items.forEach((n=>{e in n&&(n[e]=t)})),this.syncingChildViewConfigs=!1)}createView(e){var t;const n=this,{id:r}=e,{resourceStore:i}=n,{project:s}=i,o=Y.merge({project:s,readOnly:n.readOnly,allowOverlap:n.allowOverlap,calendar:n.calendar,id:n.createViewId(e),cls:"b-resourceview-resource",defaultCalendar:r,resource:e,resourceId:r,hideNonWorkingDays:n.hideNonWorkingDays,parent:n,date:n.date,dateFormat:n.dateFormat,title:n.titleTemplate(e)},n.view);n.visibleStartTime&&(o.visibleStartTime=n.visibleStartTime),Mr.scrollBarWidth&&n.viewType.isDayView&&(o.scrollable={overflowX:!1,overflowY:"hidden-scroll"});const a=bryntum.Calendar.Modes.create(o);return a.on({catchAll:"onChildViewCatchAll",thisObj:n}),a.element.removeAttribute("tabIndex"),a.element.dataset.viewResourceId=e.id,null===(t=a.contentElement)||void 0===t||t.removeAttribute("tabIndex"),Object.defineProperty(a,"weight",{get(){return n.stableResourceOrder?i.allIndexOf(r):0}}),Object.defineProperty(a,"resource",{get(){return i.getById(r)}}),Object.defineProperty(a,"eventFilter",{get(){return e=>e.resources.includes(this.resource)}}),n.viewCache.add(a),n.trigger("viewCreate",{view:a}),a}onChildViewCatchAll(e){e.resourceRecord=e.source.resource,"paint"!==e.type&&this.trigger(e.type,e),"heightchange"===e.type&&this.syncDayViewScrollerVisibility()}changeAvatarRendering(e){if(e)return Yh.new({element:this.element},e)}titleTemplate(e){const t=this,{meta:n}=t,r="string"==typeof n?e[n]:null==n?void 0:n(e),i=Mr.isNamedColor(e.eventColor)&&e.eventColor,s=!i&&e.eventColor;return{class:{"b-resourceview-title":1,"b-has-meta":r},children:[t.showAvatars&&{class:{"b-resource-avatar-container":1,[`b-sch-foreground-${i}`]:i},style:{color:s||null},children:[t.getResourceAvatar(e)]},{class:"b-resource-name",text:e.name},r&&{class:"b-resource-meta",text:r}]}}getEventElement(e,t=e.startDate){var n;return null===(n=this.getResourceView(e.resource))||void 0===n?void 0:n.getEventElement(e,t)}get dayViewTimeAxis(){const e=this;if(!e._dayViewTimeAxis){const t=sn.copyProperties({},e.view,e.timeAxisConfigs);e._dayViewTimeAxis=wD.create(f(f({},t),{},{weight:-1,project:e.project,type:"resourcedayviewtimeaxis",minWidth:0,cls:"b-resource-dayview-timeaxis",startDate:fD,endDate:vD,scrollable:{overflowX:!1,overflowY:"hidden-scroll"},onCornerClick(){const{expanded:t}=e.firstChild.allDayEvents,n=[];let r=null;e.eachView((({allDayEvents:e})=>{t?(!r||e.maxEventCount<r.maxEventCount)&&(r=e):(!r||e.maxEventCount>r.maxEventCount)&&(r=e)}));const i=r.refreshCount;r.expanded=!t,r.refreshCount===i&&n.push(r),e.items.forEach((e=>{if(e!==r){const{allDayEvents:r}=e,i=r.refreshCount;e.allDayEvents.expanded=!t,r.refreshCount===i&&n.push(r)}}));for(let e=0,{length:t}=n;e<t;e++)n[e].doRefresh()}}),e),ua.addResizeListener(e._dayViewTimeAxis.timeAxisElement,e.syncDayViewScrollerVisibility.bind(e))}return e._dayViewTimeAxis}get dayViewScroller(){const e=this;if(!e._dayViewScroller){const t=sn.copyProperties({},e.view,e.timeAxisConfigs);e._dayViewScroller=wD.create(f(f({},t),{},{weight:999,project:e.project,type:"resourcedayviewtimeaxis",flex:`0 0 ${Mr.scrollBarWidth}px`,minWidth:Mr.scrollBarWidth,cls:"b-resource-dayview-scroller",startDate:fD,endDate:vD,scrollable:{overflowX:!1,overflowY:"scroll"}}),e),e._dayViewScroller.scrollable.addPartner(e.dayViewTimeAxis.scrollable,"y"),e.monitorResize=!0}return e._dayViewScroller}onElementResize(){super.onElementResize(),this.syncDayViewScrollerVisibility()}syncDayViewScrollerVisibility(){if(this.dayViewScroller){const e=this.dayViewTimeAxis.scrollable.hasOverflow("y");this.dayViewScroller.isVisible!==e&&this.dayViewScroller[e?"show":"hide"]()}}scrollTo(e){const{items:t}=this;if(e.isEventModel){const n=t.find((t=>t.eventStore.includes(e)));return null==n?void 0:n.scrollTo(e)}return t[0].scrollTo(e)}createViewId(e){return`${this.id}-resource${this.config.view.type}-${e.id}`}updateDate(e){this.suspendVisibility(),this.viewCache.forEach((t=>{t.isResourceDayViewTimeAxis||(t.date=e)})),this.resumeVisibility(),this.viewType.isDayView&&this.items.forEach((e=>{var t,n;null===(t=e.allDayEvents)||void 0===t||t.setEventContentHeight(null===(n=e.allDayEvents)||void 0===n?void 0:n.cellContentHeight)}))}updateResourceWidth(e){this.contentElement.style.setProperty("--resource-width",Mr.setLength(e))}updateHideNonWorkingDays(e){this.isConfiguring||this.syncViewConfig("hideNonWorkingDays",e)}updateNonWorkingDays(e){this.isConfiguring||this.syncViewConfig("nonWorkingDays",e)}syncViewConfig(e,t){const n=n=>{n[e]=t};bD[e]?this.items.forEach(n):this.eachView(n)}descriptionRenderer(){var e;return(null===(e=[...this.viewCache.items][0])||void 0===e?void 0:e.description)||"No resources"}get startDate(){return new Date(Math.min(...this.items.reduce(((e,t)=>(t.isResourceDayViewTimeAxis||e.push(t.startDate),e)),[])))}get endDate(){return new Date(Math.max(...this.items.reduce(((e,t)=>(t.isResourceDayViewTimeAxis||e.push(t.endDate),e)),[])))}get stepUnit(){const e=[...this.viewCache][0];return null==e?void 0:e.stepUnit}get firstChild(){return this.items.filter((e=>!e.isResourceDayViewTimeAxis))[0]}previous(){const e=[...this.viewCache][0];e&&(this.date=en.add(this.date,-e.duration,"day"))}next(){const e=[...this.viewCache][0];e&&(this.date=en.add(this.date,e.duration,"day"))}}class wD extends uD{static get $name(){return"ResourceDayViewTimeAxis"}static get type(){return"resourcedayviewtimeaxis"}static get configurable(){return{allDayEvents:{type:"resourcedayviewalldayevents"}}}compose(){const e=super.compose();return e["aria-hidden"]=!0,e}scrollToVisibleStartTime(){}createCellMap(){return yD}calculateCellContentHeight(){return 0}getDateFromPosition(e,t,n=!1){const r=this,i=r.startDate,s=n?0:r.dayContentElement.getBoundingClientRect().y,o=r.timeAxisElement.offsetHeight,a=t-s;return en.round(en.add(en.clearTime(i),r.dayStartMs+Math.floor(a/o*r.getDayLength()),"ms"),r.increment)}}(class extends YS{static get $name(){return"ResourceDayViewAllDayEvents"}static get type(){return"resourcedayviewalldayevents"}get hasOverflow(){return this.up("resourceview").views.some((e=>{var t;return null===(t=e.allDayEvents)||void 0===t?void 0:t.hasOverflow}))}createCellMap(){return yD}}).initClass(),wD.initClass(),CD.initClass(),CD._$name="ResourceView";class SD extends(kc.mixin(_h)){static get $name(){return"Sidebar"}static get type(){return"sidebar"}static get configurable(){return{focusable:!1,bbar:{cls:"b-cal-nav-item",layout:{justify:"center"},items:{todayButtonSidebar:{text:"L{Calendar.Today}",onClick:"up.shiftToNow",weight:200},prevButtonSidebar:{onClick:"up.shiftPrevious",cls:"b-borderless",icon:"b-icon-previous",weight:300},nextButtonSidebar:{onClick:"up.shiftNext",cls:"b-borderless",icon:"b-icon-next",weight:400}}},items:{datePicker:{type:"datepicker",weight:100,listeners:{selectionChange:"up.onMonthSelectionChange"}},eventFilter:{type:"filterfield",field:"name",weight:150,placeholder:"L{Filter events}",localeClass:this},resourceFilter:{ignoreParentReadOnly:!0}},date:{$config:{equal:"date"},value:null},eventStore:null,responsive:{},stepUnitText:null,side:"left",collapsible:{tool:null},resourceFilter:{type:"resourcefilter",flex:"1 1 auto",weight:200,minHeight:110,scrollable:{overflowY:"auto"},store:{sorters:[{field:"name",ascending:!0}]},masterFilter(e){return this.eventStore.resourceStore.isAvailable(e)}}}}setupWidgetConfig(e,t){let n=super.setupWidgetConfig(...arguments);return"eventFilter"===n.ref&&(n.store=this.initialConfig.eventStore),"resourceFilter"===n.ref&&(n.type&&n.type!==this.resourceFilter.type||(n=SD.mergeConfigs(this.resourceFilter,n))),"datepicker"===n.type&&(this.element.classList.add("b-has-datepicker"),this.element.classList.toggle("b-datepicker-with-events",Boolean(n.events))),n}updateSide(e,t){const{classList:n}=this.element;n.remove(`b-sidebar-${t}`),n.add(`b-sidebar-${e}`),this.collapsible&&(this.collapsible.direction=e)}updateStepUnitText(e){const t=this,{prevButtonSidebar:n,nextButtonSidebar:r}=t.widgetMap;n&&(n.tooltip=e?t.L("L{Calendar.previous}",e):"",n.disabled=!e),r&&(r.tooltip=e?t.L("L{Calendar.next}",e):"",r.disabled=!e)}updateEventStore(e){const{resourceFilter:t,datePicker:n}=this.widgetMap;t&&(t.eventStore=e),n&&(n.eventStore=e)}onMonthSelectionChange({selection:e,userAction:t}){this.UIdateChange=t,this.date=e[0],this.UIdateChange=!1}changeDate(e,t){if(e="string"==typeof e?en.parse(e):new Date(e),isNaN(e))throw new Error("Calendar widget date ingestion must be passed a Date, or a YYYY-MM-DD date string");if(e=en.clearTime(e),!t||e-t)return e}updateDate(e){const{datePicker:t}=this.widgetMap;t&&(t.value=e),this.trigger("dateChange",{date:e,userAction:Boolean(this.UIdateChange)})}}SD.initClass(),SD._$name="Sidebar";class DD extends uD{static get $name(){return"WeekView"}static get type(){return"weekview"}static get configurable(){return{localizableProperties:["title","stepUnit"],title:"L{Week}",stepUnit:"L{weekUnit}",range:{magnitude:1,unit:"week"},responsive:{small:{descriptionFormat:"MMMM YYYY"},large:{descriptionFormat:["MMMM YYYY (Wp)","S{MMM} - E{MMM YYYY} (S{Wp})"]},"*":{descriptionFormat:["MMMM YYYY","S{MMM} - E{MMM YYYY}"]}},week:null,fixedDuration:!0}}calculateDuration(){return 7}updateWeekStartDay(e,t){var n;if(null===(n=super.updateWeekStartDay)||void 0===n||n.call(this,e),!this.isConfiguring){const n=new Date(this.startDate);n.setDate(n.getDate()+e-t),this.startDate=n}}changeMonth(){const e=super.changeMonth(...arguments);return e.on({weekChange:"onMonthWeekChange",thisObj:this}),e}onMonthWeekChange({source:e,newDate:t}){this.week=e.getWeekNumber(t)}changeWeek(e,t){const n=this;if(e=Array.isArray(e)?e:[n.month.year,e],!sn.isEqual(e,t)){var r,i;const t=n.minDate||(null===(r=n.calendar)||void 0===r?void 0:r.minDate),s=n.maxDate||(null===(i=n.calendar)||void 0===i?void 0:i.maxDate);if(!isNaN(t)||!isNaN(s)){const r=n.month.getWeekStart(e),i=en.add(r,n.duration,"d");if(!isNaN(t)&&r<t)return;if(!isNaN(s)&&i>s)return}return e}}updateWeek(e){const t=this,{month:n,date:r,dayTime:i}=t,s=i.shiftDate(n.getWeekStart(e));r&&sn.isEqual(n.getWeekNumber(r),e)?t.startDate=s:t.date=s,t.week=n.getWeekNumber(t.date)}}DD.initClass(),DD._$name="WeekView";class ED extends(kc.mixin(AS,LS,HS)){static get $name(){return"YearView"}static get type(){return"yearview"}static get configurable(){return{textContent:!1,localizableProperties:["title","stepUnit"],title:"L{Year}",scrollable:{overflowY:!0},stepUnit:"L{yearUnit}",month:!0,date:{$config:{equal:"date"},value:null},descriptionFormat:"YYYY",year:null,monitorResize:!1,showWeekColumn:!0,hideWeekColumnCls:"b-hide-week-numbers",otherMonthCls:"b-other-month",sixWeeks:!0,dayCellRenderer:null,monthSelector:".b-yearview-month-name",focusable:!1,showEvents:"heatmap"}}createCellMap(e){const t=super.createCellMap(e=f({skipPropagate:!0},e));for(const e of t.values())e.renderedEvents.setEvents(e.events);return t}get date(){return this._date||!this.isConfiguring&&this.firstEventDate||this.startDate}next(){this.date=new Date(this.year+1,this.date.getMonth(),this.date.getDate())}previous(){this.date=new Date(this.year-1,this.date.getMonth(),this.date.getDate())}get firstEventDate(){const e=[...this.cellMap.values()];if(e.length)return e[0].date}get lastEventDate(){const e=[...this.cellMap.values()];if(e.length)return e[e.length-1].date}onCalendarPointerInteraction(e){var t,n;const r=this,i=super.onCalendarPointerInteraction,{target:s,type:o}=e;if(("mousedown"===o||o.endsWith("click"))&&r.clearTimeout(r.cellOverflowTimer),"mousedown"===o&&null!==(t=r._overflowPopup)&&void 0!==t&&t.isVisible&&s.closest(".b-cal-cell-overflow")&&e.preventDefault(),"click"!==r.overflowPopupTrigger||"dblclick"!==(null===(n=r.autoCreate)||void 0===n?void 0:n.gesture)||"click"!==o||!s.closest(`.${r.emptyCellCls}`)||r.emptyCellRenderer)return i.apply(r,arguments);r.cellOverflowTimer=r.setTimeout({fn:i,delay:300,args:[e]})}async createEvent(e){var t;null===(t=this.calendar)||void 0===t||t.handleYearCreateEvent({source:this,date:e})}changeMonth(e,t){const n=this,r={name:"yearChangeListener",yearChange:"onMonthYearChange",thisObj:n};return n.detachListeners("yearChangeListener"),e instanceof Wd?(e.on(r),n._year=e.year):e=new Wd({date:new Date(n.year||(new Date).getFullYear(),0,1),weekStartDay:n.weekStartDay,hideNonWorkingDays:n.hideNonWorkingDays,nonWorkingDays:n.nonWorkingDays,sixWeeks:n.sixWeeks,listeners:r}),null==n.nonWorkingDays&&(n.nonWorkingDays=n._month.nonWorkingDays),n._year=e.year,e}onMonthYearChange({source:e}){const t=this;t._year=e.year,t.isConfiguring||(t._cellMap&&t._cellMap.clear(),t.date=e.date,t.refresh())}get eventsPerCell(){return 0}get startDate(){return this.month.getOtherMonth(new Date(this.year,0,1)).startDate}get endDate(){return en.add(this.month.getOtherMonth(new Date(this.year,11,1)).endDate,1,"day")}set startDate(e){this.date=e}isValidTargetDate(e){const t=e.getFullYear();if(t!==this.year){var n,r;const e=this.minDate||(null===(n=this.calendar)||void 0===n?void 0:n.minDate),i=this.maxDate||(null===(r=this.calendar)||void 0===r?void 0:r.maxDate);if(!isNaN(e)||!isNaN(i)){const{cellMonth:n}=this;if(!isNaN(e)&&n.getWeekStart(n.getWeekNumber(new Date(t,0,1)))<e)return!1;if(!isNaN(i)&&(n.date=new Date(t,11,31),en.add(n.endDate,1,"d")>i))return!1}}return!0}updateDate(e){this.month.date=e}changeYear(e){return this.isConfiguring?e:(this.month.year=e,this.month.year)}changeShowEvents(e,t){return!0===e?"heatmap":e}updateShowEvents(e,t){const{classList:n}=this.contentElement;e&&n.add(`b-show-events-${e}`),n.remove(`b-show-events-${t}`),this.isConfiguring||this.doRefresh()}updateShowWeekNumber(){this.bodyElement.classList[this.showWeekColumn?"remove":"add"](this.hideWeekColumnCls)}doRefresh(){const e=this,{bodyElement:t,month:n,dayCellCls:r,otherMonthCls:i,weekendCls:s,todayCls:o,nonWorkingDayCls:a,emptyCellCls:l,cellMap:c,showEvents:d}=e,u=[],h=en.makeKey(new Date);for(let t=0;t<12;t++){n.month=t;const g={tag:"button",className:"b-yearview-month-name",html:en.getMonthName(t),dataset:{monthDate:en.makeKey(new Date(e.year,t,1))}},m=[{className:"b-week-number-cell"}],p={className:"b-yearview-month",children:[g,{className:"b-calendar-week b-calendar-weekdays",children:m}]},f=p.children;u.push(p);let v=0;n.eachWeek(((t,u)=>{if(1===m.length)for(let t=0;t<7;t++)m.push({className:{"b-yearview-weekday-cell":1,[a]:e.nonWorkingDays[n.canonicalDayNumbers[t]]},text:en.format(u[t],"d1")});const g={className:"b-calendar-week",dataset:{week:`${t[0]},${t[1]}`}},p=g.children=[{tag:"button",ariaLabel:e.L("L{Calendar.weekOfYear}",t),className:"b-week-number-cell",html:t[1]}];f.push(g);for(let t=0;t<7;t++){var y;const g=u[t],m=g.getMonth()!==n.month,f=en.makeKey(g),C=g.getDay(),w=!e.isConfiguring&&c.get(f),S=(null==w||null===(y=w.events)||void 0===y?void 0:y.length)||0,D=!m&&S,E={style:{},className:{"b-day-name":1,[r]:1,[l]:!S},dataset:{date:f,cellIndex:v,columnIndex:t}},x=null==w?void 0:w.events;let R=String(g.getDate());if(Object.assign(E.className,{[s]:en.weekends[C],[o]:f===h&&!m,[a]:e.nonWorkingDays[C],[i]:m,"b-cal-cell-overflow":D,[Sw.getEventCountClass(S)]:D,[`b-day-of-week-${C}`]:1}),e.dayCellRenderer){var b;const t=e.callback(e.dayCellRenderer,e,[{cellConfig:E,date:g,events:(null==w||null===(b=w.events)||void 0===b?void 0:b.map((e=>e.eventRecord)))||[]}]);null!=t&&(R=t)}if("dots"===d){const e=[];for(let t=0;t<Math.min((null==x?void 0:x.length)||0,3);t++){const n=this.createEventDomConfig({eventRecord:x[t].eventRecord,minimal:!0});e.push(n)}R=["object"==typeof R?R:{tag:"span",html:R},{className:"b-cal-minimal-event-container",children:e}]}E.children=[{className:"b-calendar-cell-inner",["string"==typeof R?"html":"children"]:R}],p.push(E),v++}}))}oa.sync({targetElement:t,domConfig:{children:u}}),e.refreshCount=(e.refreshCount||0)+1,e.trigger("refresh")}getDayElement(e,t){if("string"!=typeof e&&(e=en.makeKey(e)),!t||parseInt(e.substr(0,4))===this.year)return this.contentElement.querySelector(`.b-calendar-cell[data-date="${e}"]:not(.b-other-month)`)}getCell(){return this.getDayElement(...arguments)}onPaint({firstPaint:e}){e&&this.refresh()}}ED.initClass(),ED._$name="YearView";const xD=e=>e.isCalendarMixin;var RD=e=>class extends(tw(e||Te)){static get configurable(){return{navigator:{allowCtrlKey:!0,scrollSilently:!0,datasetIdProperty:"eventId",itemsTabbable:!0,keys:{ArrowUp:null,ArrowDown:null,Escape:null,Tab:null,"SHIFT+Tab":null}}}}normalizeTarget(e){return e.eventRecord}changeNavigator(e){const t=this;return t.getConfig("eventCls"),super.changeNavigator(t.constructor.mergeConfigs({target:t.element,itemSelector:`.b-cal-cell-overflow,.b-cal-cell-no-content,${t.eventSelector}`,skipScrollIntoView:!0},e))}onViewRefresh(){var e;if(null===(e=super.onViewRefresh)||void 0===e||e.call(this,...arguments),this.navigator.activeItem){const e=this.getEventRecord(this.navigator.activeItem);e&&this.navigator.updateActiveItem(this.getElementFromEventRecord(e))}}onCalendarStoreChange({action:e,records:t}){var n;const r=this,{navigator:i}=r,s=null==i?void 0:i.activeItem;if(s&&!r.eventStore.includes(s.dataset.eventId)){const e=r.constructor.fromElement(s,xD)||r.activeView,{_overflowPopup:t}=e,n=i.next;if(n!==s.nextSibling||n.parentNode.syncIdMap){let o=n||i.previous;if(null!=t&&t.containsFocus&&!t.contentElement.contains(o)){const{target:e}=t.lastAlignSpec;o=i.getAdjacent(1,e.nextSibling)||i.getAdjacent(-1,e)}if(o){const t=e.getDateFromElement(o),n=o.dataset.eventId,a=r.constructor.fromElement(o).closest(xD);o.focus(),a.on({refresh:()=>{o=a.getEventElement(n,t),o&&(o===Mr.getActiveElement(o)?i.triggerNavigate({},o):o.focus()),i.updateActiveItem(o,s)},once:!0})}else r.widgetMap.viewContainer.revertFocus(!0)}else i.triggerNavigate({},n)}null===(n=super.onCalendarStoreChange)||void 0===n||n.call(this,...arguments)}onElementKeyDown(e){var t;e.target.closest(this.navigator.itemSelector)&&(null===(t=super.onElementKeyDown)||void 0===t||t.call(this,e))}get activeEvent(){const{activeItem:e}=this.navigator;if(e)return this.resolveEventRecord(e)}get widgetClass(){}},TD=e=>class extends(XC(e||Te)){normalizeTarget(e){return e.eventRecord}onSelectedCollectionChange({added:e,removed:t}){const n=this,r=n.selectedCollection,i=e||[],s=t||[];if(n.updateSelected(),!n.silent){const e=r.count>0?i.length>0&&s.length>0?"update":i.length>0?"select":"deselect":"clear";n.trigger("selectionChange",{action:e,selection:r.values,selected:i,deselected:s})}}onCalendarStoreChange({action:e,records:t}){var n;"remove"===e&&this.selectedCollection.remove(...t),null===(n=super.onCalendarStoreChange)||void 0===n||n.call(this,...arguments)}clearEventSelection(){this.selectedCollection.clear()}get selectedEvents(){return this.selectedCollection.values}set selectedEvents(e){e=ke.asArray(e),this.selectedCollection.splice(0,this.selectedCollection.count,e)}isEventSelected(e){return this.selectedCollection.includes(e)}select(e,t=!1){this.selectEvent(e,t)}selectEvent(e,t=!1){const{selectedCollection:n}=this;this.isEventSelected(e)||(t?n.add(e):n.splice(0,n.count,e))}deselect(e){this.deselectEvent(e)}deselectEvent(e){this.isEventSelected(e)&&this.selectedCollection.remove(e)}selectEvents(e){this.selectedCollection.add(e)}deselectEvents(e){this.selectedCollection.remove(e)}onEventSelectionClick(e){this.isEventSelected(e)?zr.ctrlKeyDown&&this.deselectEvent(e):this.selectEvent(e,this.multiEventSelect&&zr.ctrlKeyDown)}onEventNavigate({event:e,item:t}){if(t){const n=this.activeView.getEventRecord(t);if(n){if(2===e.button&&this.isEventSelected(n))return;this.onEventSelectionClick(n)}else this.clearEventSelection()}}get widgetClass(){}};const MD=(e,t)=>(e.weight||0)-(t.weight||0),kD=/(?:.)cell|number|name|overflow|mouse|down|up|dbl|click|over|out|context|menu|date|change|element|popup/g,ID=/^.*event.*|.*resource.*|.*cell.*|.*row.*|.*schedule.*|daynumber.*|weeknumber.*|monthname.*|weekname.*$|beforedatechange|tickchange|.*showoverflowpopup/,AD=e=>_.capitalize(e),FD=e=>e.isCalendarMixin&&e.containsFocus;class OD extends(kc.mixin(DS,vS,wd,Kf,RD,TD,$C,_h,oi,CC)){static get $name(){return"Calendar"}static get type(){return"calendar"}static get configurable(){return{enableRecurringEvents:!0,localizableProperties:["autoCreate.newName"],crudManager:null,crudManagerClass:py,features:{drag:{},eventEdit:{},eventTooltip:{},eventMenu:{}},navigatorPlacement:null,responsive:{small:{when:600,once:{mode:"day"}},medium:{when:800},large:{overlaySidebar:!1},"*":{overlaySidebar:!0,once:{mode:"week"}}},responsiveRoot:!0,stateful:["hideNonWorkingDays","mode"],tbar:{cls:"b-calendar-toolbar",items:{toggleSideBar:{icon:"b-icon-menu-vertical",cls:"b-sidebar-toggle b-borderless b-transparent",onClick:"up.onToggleSidebarClick",weight:100},todayButton:{text:"L{Calendar.Today}",cls:"b-cal-nav-item b-calendar-today-button",icon:"b-icon-calendar-day",onClick:"up.shiftToNow",weight:200},prevButton:{onClick:"up.shiftPrevious",cls:"b-cal-nav-item b-borderless b-transparent",icon:"b-icon-previous",weight:300},nextButton:{onClick:"up.shiftNext",cls:"b-cal-nav-item b-borderless b-transparent",icon:"b-icon-next",weight:400},viewDescription:{cls:"b-calendar-view-desc",type:"widget",flex:"",html:" ",overflowable:"none",weight:500},spacer:{type:"widget",cls:"b-toolbar-fill",weight:600},modeSelector:{type:"calendarModeSelector",weight:700}},listeners:{paint:"up.onToolbarPaint"}},items:{viewContainer:{type:"container",cls:"b-calendar-viewcontainer",flex:"1 1 100%",layout:{type:"card"},scrollable:{overflowY:!0,overflowX:!0},suppressChildHeaders:!0,layoutStyle:{padding:0},listeners:{beforeActiveItemChange:"up.onBeforeModeChange",activeItemChange:"up.onModeChange"}}},includeWeekendsButton:!1,layoutStyle:{padding:0,flexFlow:"row nowrap"},modes:{day:{fixedDuration:!0},week:{},month:{},year:{},agenda:{}},mode:"week",modeDefaults:{value:null},sidebar:{$config:{merge:"objects"},value:{type:"sidebar",side:"left",scrollable:{overflowY:!0},listeners:{dateChange:"up.onCalendarDateChange"}}},datePicker:{$config:{merge:"objects"},value:{weight:100,dayNameFormat:"d1",editMonth:null,focusable:!1,trapFocus:!1}},overlaySidebar:null,date:{$config:{equal:"date"},value:new Date},dateFormat:"MMMM DD, YYYY",scrollManager:{$config:["lazy","nullify"],value:{direction:"vertical"}},viewUpdateDelay:2e3,readOnly:null,allowOverlap:!0,testConfig:{viewUpdateDelay:5,loadMask:{text:"L{GridBase.loadMask}",showDelay:0}},highlightDate:null,autoCreate:{gesture:"dblclick",newName:"L{Object.newEvent}",step:"15 minutes",duration:"1 hour",startHour:8},focusable:!1,eventCls:"b-cal-event",weekStartDay:!1,hideNonWorkingDays:null,nonWorkingDays:!1,contextMenuTriggerEvent:"contextmenu",enableUndoRedoKeys:!0,resourceImagePath:null,minDate:null,maxDate:null}}static get delayable(){return{refresh:{type:"raf",cancelOutstanding:!0},syncUIWithActiveView:{type:null!==globalThis&&void 0!==globalThis&&globalThis.requestIdleCallback?"idle":"buffer",delay:1,cancelOutstanding:!0}}}compose(){const{includeWeekendsButton:e,navigatorPlacement:t}=this;return{class:{[`b-calendar-nav-${t||"toolbar"}`]:1,"b-calendar-include-weekends-button":e}}}static getLKey(){return"6817134a-cdf3-11e8-bff0-d094661a2df4"}onPaintOverride(){}onPaint(){this.onPaintOverride()||super.onPaint()}onShowOverflowPopup({overflowPopup:e}){this.element.classList.add("b-overflow-popup-visible"),e.on({hide:()=>this.element.classList.remove("b-overflow-popup-visible"),once:!0})}static get featureable(){return{factory:Mw}}finalizeInit(){var e;super.finalizeInit();const t=this,n=null===(e=t.activeView)||void 0===e?void 0:e.hideNonWorkingDays;null!=n&&null==t.hideNonWorkingDays&&(t.hideNonWorkingDays=n)}toggleEmptyText(){const{crudManager:e}=this,{eventStore:t}=e||this;Mr.toggleClasses(this.contentElement,"b-calendar-empty",!(t.count||null!=e&&e.isLoading))}refresh(){this.eachView((e=>{var t;return null===(t=e.refresh)||void 0===t?void 0:t.call(e)}))}get views(){const{modes:e}=this;return e?Object.values(e):[]}get activeView(){return this.viewContainer.layout.activeItem}get activeSubView(){var e;const{activeView:t}=this,{items:n}=t;return(null===(e=n.filter(FD))||void 0===e?void 0:e[0])||t}captureFocus(){return this.activeView.captureFocus()}getEventRecord(e){return this.activeView.getEventRecord(e)}resolveEventRecord(e){return this.getEventRecord(e)}onBeforeModeChange({prevActiveItem:e,activeItem:t}){var n,r;if(!1===this.trigger("beforeActiveItemChange",arguments[0]))return!1;if(null===(n=e._overflowPopup)||void 0===n||null===(r=n.hide)||void 0===r||r.call(n),"date"in t&&!1!==t.syncViewDate){const n=this.date||e.date;n&&(t.date=n)}}onModeChange(e){this.trigger("activeItemChange",e)}onToggleSidebarClick(){const{sidebar:e}=this,{collapsible:t}=e;null!=t&&t.isPanelCollapserOverlay?t.toggleReveal(!e.revealed):e.toggleCollapsed()}shiftToNow(){var e;const t=this,n=null===(e=t.sidebar)||void 0===e?void 0:e.widgetMap.datePicker,{dayTime:r}=t.activeView,i=new Date,s=r?r.startOfDay(i):en.clearTime(i);t.date=s,n&&(n.date=s),t.updateViewDescription()}shiftPrevious(){const{activeItem:e}=this.viewContainer.layout;null!=e&&e.previous&&(e.previous(),this.updateViewDescription(e),e.animateTimeShift&&Mr.slideIn(e.contentElement,-1))}shiftNext(){const{activeItem:e}=this.viewContainer.layout;null!=e&&e.next&&(e.next(),this.updateViewDescription(e),e.animateTimeShift&&Mr.slideIn(e.contentElement,1))}async onCalendarDateChange({date:e,userAction:t}){const n=this,{activeItem:r}=n.viewContainer.layout,{date:i,highlightDate:s}=n;if(r&&!1!==r.syncViewDate&&"date"in r){const{getDayElement:i}=r;var o,a;if(en.betweenLesser(e,r.startDate,r.endDate)||null===(o=r._overflowPopup)||void 0===o||null===(a=o.hide)||void 0===a||a.call(o),r.date=e,t&&s&&i){var l;r.scrollTo&&(await r.scrollTo(e),r.scrolledToDate&&(e=r.scrolledToDate));const t=null===(l=r.getDayElement)||void 0===l?void 0:l.call(r,e);t&&(isNaN(s)?n.callback(s,n,[t,n]):Mr.highlight(xn.from(t)))}}n.trigger("dateChange",{oldDate:i,date:e})}updateViewDescription(e=this.activeView){const t=this,{tbar:n,widgetMap:r}=t,{viewDescription:i}=r,s=`<span class="b-calendar-view-desc-text">${(null==e?void 0:e.description)||""}</span>`;if(t.element.dataset.mode=t.activeView.modeName,e){n&&i&&i.content!==s&&(i.content=s);const t=e.date||e.startDate;t&&(this.date=t)}}getStepUnitText(e=this.activeView){return e.stepUnit}syncUIWithActiveView(e=this.activeView){const t=this,{tbar:n,sidebar:r,widgetMap:i}=t,{toggleSideBar:s}=i;if(n&&null!=e&&e.isVisible){const{prevButton:n,nextButton:s,modeSelector:o}=i,a=t.getStepUnitText(e);null==o||o.syncActiveMode(e),r&&(r.stepUnitText=a),t.updateViewDescription(e),n&&(n.tooltip=a?t.L("L{previous}",a):"",n.disabled=!a),s&&(s.tooltip=a?t.L("L{next}",a):"",s.disabled=!a)}r||null==s||s.hide()}updateEventStore(e){this.detachListeners("eventStoreDateRange"),this.processConfiguredListeners(),e.on({loadDateRange:"onEventStoreDateRangeChange",name:"eventStoreDateRange",thisObj:this}),this.sidebar&&(this.sidebar.eventStore=e)}eachView(e,t,n=null){const r=null==t;for(const i of this.views)if(r&&(t=[i]),!1===i.callback(e,n||i,t))return}onEventStoreDateRangeChange(e){this.trigger("dateRangeChange",e)}async onModeSelectorToggle({source:e,pressed:t}){if(t){const t=this,{layout:n}=t.viewContainer,{view:r}=e;await t.modeSelectionPromise,t.modeSelectionPromise=n.setActiveItem(r).promise}}updateMode(e){const t=this,n=t.initialConfig||{};t.isConfiguring||t._responsiveUpdating&&("mode"in n||"activeIndex"in n)||(e="string"==typeof e?t.modes[e]:e)&&e!==t.activeView&&t.viewContainer.layout.setActiveItem(e,void 0,{animation:!t.isResponsiveUpdating})}onEventStoreRefresh(){this.isConfiguring||this.syncUIWithActiveView(this.viewContainer.layout.activeItem)}handleViewPaint({source:e}){this.syncUIWithActiveView(e),this._mode=e.modeName,this.trigger("viewPaint",f({},arguments[0]))}onViewRefresh({source:e}){var t;null===(t=super.onViewRefresh)||void 0===t||t.call(this,...arguments),e.isVisible&&(e===this.activeView?this.updateViewDescription(e):this.activeView.owns(e)&&this.syncUIWithActiveView(this.activeView))}updateEventCls(e){this.initialConfig.eventInnerSelector||(this.eventInnerSelector=`.${e}`),this.initialConfig.eventSelector||(this.eventSelector=`${this.eventInnerSelector}-wrap`)}changeModes(e,t){const n=this,{mode:r}=n;if(n.getConfig("crudManager"),n.getConfig("defaultCalendar"),r&&r in e){const t=[];let s,o=null,a=0;for(const n in e){var i;s=e[n],s?("object"==typeof s&&"weight"in s?o=null:s&&n===r&&(o=a),t.push(sn.assign({modeType:n,weight:null!==(i=s.weight)&&void 0!==i?i:0},s)),a++):t.push(!1)}if(null==o){e={},t.sort(MD);for(let n=0,{length:i}=t;n<i;n++)s=t[n],e[s.modeType]=s,t[n].modeType===r&&(o=n)}n.activeModeIndex=o}const{tbar:s,element:o}=n,a={thisObj:n,descriptionChange:"onViewDescriptionChange",weekNumberClick:"onViewWeekNumberClick",monthNameClick:"onViewMonthNameClick",dayNumberClick:"onViewDayNumberClick",beforeEventAdd:"onViewBeforeEventAdd",catchAll:{fn:"onViewCatchAll",prio:1e4},paint:"handleViewPaint",refresh:"onViewRefresh"},l=n.$modes||(n.$modes=new Ul({factory:LD,inferType:!0,owner:n,ownerName:"calendar",created(e,t){var r;if(e.modeName=t,e.isScheduler){const{eventEdit:t}=n.features;t&&(t.applyPluginConfig(e),e.editEvent=n.editEvent.bind(n))}!1!==e.autoCreate&&(e.autoCreate=n.autoCreate),o.classList.add(`b-cal-${t}`),e.on(a),n.relayEvents(e,["eventPropagate"]),n.isConfiguring||n.trigger("addMode",{mode:e});const i=null==s||null===(r=s.widgetMap)||void 0===r?void 0:r.modeSelector;i&&(i.calendar=n,i.addMode(t,e))},setup(e){const{defaultCalendar:t,hideNonWorkingDays:r,modeDefaults:i}=n,s=LD.resolveType(e.type);if(i&&(e=sn.merge({},i,e)),s.isScheduler){const t=e.features||(e.features={});t.eventTooltip=t.eventMenu=t.eventEdit=t.scheduleMenu=!1}else e.eventSelector=n.eventSelector,e.eventInnerSelector=n.eventInnerSelector;return e.rtl=n.rtl,e.project=n.project,e.readOnly=n.readOnly,e.allowOverlap=n.allowOverlap,e.hidden=!0,e.weekStartDay=n.weekStartDay,e.nonWorkingDays=n.nonWorkingDays,n.resourceImagePath&&(e.resourceImagePath=n.resourceImagePath),sn.hasOwn(n,"_defaultCalendar")?e.defaultCalendar=n._defaultCalendar:null!=t&&(e.defaultCalendar=t),null!=r&&(e.hideNonWorkingDays=r),n.date&&!e.date&&(e.date=n.date),e.dateFormat||(e.dateFormat=n.dateFormat),n.visibleStartTime&&(e.visibleStartTime=n.visibleStartTime),e}}));if(l.update(e),!t)return l.target}changeModeDefaults(e){const t=this,n=new Proxy(sn.assign({},e),{set(e,n,r){const i=Reflect.set(...arguments);return t.updateModeDefaults({[n]:r}),i},deleteProperty(e,n){const r=Reflect.deleteProperty(...arguments);return t.updateModeDefaults({[n]:null}),r}});return n}updateModeDefaults(e){this.isConfiguring||this.eachView((t=>t.setConfig(e)))}get collapsibleConfig(){const e=this.peekConfig("overlaySidebar"),t={type:e?"overlay":"inline",tool:null};return e&&(t.recollapseTool=null),t}updateOverlaySidebar(e){const{sidebar:t,collapsibleConfig:n}=this,r=null==t?void 0:t.collapsible;r&&(r.type!==n.type&&(t.collapsible=n),e?t.collapsed||(t.collapsed=!0,t.collapsedDueToOverlay=!0):(t.collapsedDueToOverlay||t.isVisible&&r.isPanelCollapserOverlay)&&(t.collapsed=!1,t.collapsedDueToOverlay=!1))}changeSidebar(e,t){const n=this,{datePicker:r,statefulId:i}=n;if(e){const t=e.items||(e.items={}),n=t.datePicker;r?null!==n&&!1!==n&&(t.datePicker=OD.mergeConfigs(t.datePicker,r)):t.datePicker=null}return SD.reconfigure(t,e,{owner:n,setup:(e,t)=>n.setupWidgetConfig(e,t),defaults:{stateId:i&&`${i}:sidebar`,eventStore:n.eventStore,date:n.date,weight:"right"===(null==e?void 0:e.side)?10:-10,collapsible:n.collapsibleConfig,items:{datePicker:{weekStartDay:n.weekStartDay}}}})}changeDatePicker(e){if(e)return Object.assign(e,{eventStore:this.eventStore,date:this.date})}get datePicker(){return this.isConfiguring?this._datePicker:this.sidebar.widgetMap.datePicker}changeItems(e){const{modes:t,sidebar:n}=this,{viewContainer:r}=e;n&&(e.sidebar=n),r&&(r.items=t),this.activeModeIndex&&(r.layout.activeIndex=this.activeModeIndex);const i=super.changeItems(e);return this.viewContainer=this.widgetMap.viewContainer,i}onViewCatchAll(e){const t=this,{fromOverflowPopup:n,type:r,source:i}=e;if(e.bubbles)return;let s,o,{domEvent:a}=e;if(!a&&Mr.isDOMEvent(e.event)&&(a=e.event),t.eventSource=i,!a||!1!==t.handleEvent(a)){var l;const c=r.startsWith("emptycell");if(r.endsWith("click")&&t.activeView.isCalendarMixin&&(o=e.date||(null===(l=i.getDateFromDomEvent)||void 0===l?void 0:l.call(i,a)))){const e=n||"celloverflowclick"===r||a.target.closest(".b-cal-cell-overflow"),s=i.getDayElement&&!i.getDayElement(o,!0);!(n&&s||c||"daynumberclick"!==r&&s&&(e||r.startsWith("event")||r.startsWith("schedule")))&&(t.date=o)}(c||ID.test(r))&&(s=t.trigger(r.replaceAll(kD,AD),f(f({},e),{},{view:i})))}return t.eventSource=null,s}onViewDescriptionChange(){this.updateViewDescription()}onViewWeekNumberClick({week:e}){const t=this.modes.week||this.viewContainer.query((e=>{var t;return"weekview"===(null===(t=e.view)||void 0===t?void 0:t.type.toLowerCase())}));t&&(t.week=e,this.viewContainer.layout.activeItem=t)}onViewMonthNameClick({date:e}){const t=this.modes.month||this.viewContainer.query((e=>{var t;return"monthview"===(null===(t=e.view)||void 0===t?void 0:t.type.toLowerCase())}));t&&(t.date=e,this.viewContainer.layout.activeItem=t)}onViewDayNumberClick({source:e,date:t,cellData:n,fromOverflowPopup:r,domEvent:i}){var s;const o=e.isYearView&&("click"!==e.overflowPopupTrigger||r||!(null!==(s=n.events)&&void 0!==s&&s.length)&&!e.emptyCellRenderer);if(e.isCalendarRow||e.isMonthView||o||e.isAgendaView){const{viewContainer:n}=this,r=this.modes.day||n.query((e=>{var t;return"dayview"===(null===(t=e.view)||void 0===t?void 0:t.type.toLowerCase())}));if(r&&e!==r.allDayEvents){const{layout:e}=n,{activeItem:i}=e,{syncViewDate:s}=i;return i.syncViewDate=!1,this.date=t,n.layout.activeItem=r,i.syncViewDate=s,!1}}}onViewBeforeEventAdd({eventRecord:e,assignmentRecords:t}){const{eventEdit:n}=this.features,r=n&&!n.disabled;e.isCreating=r,null==t||t.forEach((e=>e.isCreating=r))}handleYearCreateEvent({source:e,date:t}){if(e.isYearView){const{modes:e}=this,n=e.week||e.month||e.day,{viewContainer:r}=this.widgetMap,{layout:i}=r;if(n)return r.on({activeItemChange:"onYearViewAutoCreateClickItemChange",thisObj:this,once:!0,args:[n,t]}),n.date=t,i.activeItem=n,!1}}onYearViewAutoCreateClickItemChange(e,t){var n,r;const i=(null===(n=e.allDayEvents)||void 0===n||null===(r=n.getDayHeader)||void 0===r?void 0:r.call(n,t))||e.getDayElement(t);i&&Mr.highlight(i),e.createEvent(t)}createEvent(e=this.date,...t){return this.activeView.createEvent(e,...t)}changeDate(e,t){if(e="string"==typeof e?en.parse(e):new Date(e),isNaN(e))throw new Error("Calendar widget date ingestion must be passed a Date, or a YYYY-MM-DD date string");if(e=en.clearTime(e),!t||e-t)return e}updateAutoCreate(e){this.isConfiguring||this.eachView((t=>{t.autoCreate=e}))}updateDate(e,t){if(!this.isConfiguring){const{sidebar:t}=this;t?t.date=e:this.onCalendarDateChange({date:e})}}updateDateFormat(e){this.isConfiguring||this.eachView((t=>t.dateFormat=e))}changeIncludeWeekendsButton(e){return!0===e?{}:e}updateIncludeWeekendsButton(e){!this.isConstructing&&e&&sn.isObject(e)&&(this.widgetMap.modeSelector.includeWeekendsButton=e)}changeScrollManager(e,t){if(null==t||t.destroy(),!this.isDestroying)return new ru(Object.assign({element:this.element},e))}updateDefaultCalendar(e){this.isConfiguring||this.eachView((t=>t.defaultCalendar=e))}changeWeekStartDay(e){return!1===e&&(e=en.weekStartDay),e}updateReadOnly(e){super.updateReadOnly(...arguments),this.isConfiguring||this.eachView((t=>{t.readOnly=e}))}updateWeekStartDay(e){var t;this.isConfiguring||(this.eachView((t=>t.weekStartDay=e)),null!==(t=this.sidebar)&&void 0!==t&&t.widgetMap.datePicker&&(this.sidebar.widgetMap.datePicker.weekStartDay=e))}updateHideNonWorkingDays(e,t){this.isConfiguring||(this.eachView((t=>{t.hideNonWorkingDays=e})),this.trigger("changeHideNonWorkingDays",{value:e,was:t}))}changeNonWorkingDays(e){return!1===e&&(e=sn.assign({},en.nonWorkingDays)),e}updateNonWorkingDays(e){this.isConfiguring||this.eachView((t=>{t.nonWorkingDays=e}))}onCalendarStoreChange(){var e;null===(e=super.onCalendarStoreChange)||void 0===e||e.call(this,...arguments)}updateSelected(){const e=this.viewContainer.contentElement.querySelectorAll(".b-cal-event-wrap");for(let t=0,{length:n}=e;t<n;t++)e[t].classList[this.isEventSelected(e[t].dataset.eventId)?"add":"remove"]("b-selected")}getElementFromEventRecord(e){return this.activeView.getEventElement(e)}updateLocalization(){const e=this;if(e.isPainted){let t=!1;"weekStartDay"in e.initialConfig||e.weekStartDay===en.weekStartDay||(e.weekStartDay=en.weekStartDay,t=!0),"nonWorkingDays"in e.initialConfig||sn.isEqual(e.nonWorkingDays,en.nonWorkingDays)||(e.nonWorkingDays=en.nonWorkingDays,t=!0),t||e.refresh(),e.syncUIWithActiveView()}super.updateLocalization()}updateTheme({theme:e}){const t=null!=e&&e.startsWith("classic")?"add":"remove";Mr.forEachSelector(this.tbar.element,".b-button",(e=>e.classList[t]("b-raised")))}onToolbarPaint({firstPaint:e}){var t,n;e&&zr.on({theme:"updateTheme",thisObj:this}),this.updateTheme({theme:null===(t=Mr.themeInfo)||void 0===t||null===(n=t.name)||void 0===n?void 0:n.toLowerCase()})}}OD.initClass(),globalThis.bryntum&&(globalThis.bryntum.Calendar=OD);class LD extends(Te.mixin(Ci)){static get factoryable(){return{extends:Ka}}}LD.register("agenda",eD),LD.register("year",ED),LD.register("month",pD),LD.register("week",DD),LD.register("day",uD),LD.register("list",ZS),LD.register("resource",CD),OD.Modes=LD,K.setVersion("calendar","5.2.4"),OD._$name="Calendar";var PD=function(e){d()(s,e);var t,n,r=(t=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=m()(t);if(n){var i=m()(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return h()(this,e)});function s(){return i()(this,s),r.apply(this,arguments)}return o()(s,[{key:"changeModes",value:function(e,t){var n=l()(m()(s.prototype),"changeModes",this).call(this,e,t);return this.$modes.flush(),n}}]),s}(OD),$D=(n(92222),function(){function e(t){i()(this,e),this.scheduler=t,this.dateFormat=t.dateFormat}return o()(e,[{key:"getConfig",value:function(){var e=this;return{header:{titleAlign:"start"},template:function(t){return e.getTooltip(t)}}}},{key:"getCalendarConfig",value:function(){var e=this;return{showOn:"hover",closable:!1,align:"l-r",onClientOverflowChange:function(){this.lastAlignSpec&&(DomHelper.isVisible(this.lastAlignSpec.target)||this.hide())},tooltip:{getHtml:function(t){return e.getTooltip({tip:t.tip,eventRecord:t.tip.eventRecord})},tools:{edit:!1,delete:!1}}}}},{key:"getTooltip",value:function(e){var t=this,n=e.eventRecord;if(n){var r=n.eventType,i="";if("pts"===r){var s=n.PersonDetails,o=s?s.Fullname:"";i=n.isApproved()?n.TypeOfEvent.Name:"P "+o}else i=n.Title;e.tip.title=i;var a="";switch(r){case"pts":a=t.getTitleLine(n)+t.getRangeLine(n)+t.getLocationLine(n)+t.getPersonNameLine(n)+t.getPersonRankLine(n)+t.getPersonNationalityLine(n);break;case"training":a=t.getRangeLine(n);break;case"planningcalendar":case"pmt":case"plannedactivity":case"planningcalendarcategories":a=t.getRangeLine(n)+t.getDescriptionLine(n)+t.getActionOfficerLine(n)+t.getStrategicApproachLine(n)}return"<dl>"+a+"</dl>"}}},{key:"getRangeLine",value:function(e){return"<dt>Schedule:</dt>\n                <dd>\n                    ".concat(en.format(e.startDate,this.dateFormat)," - ").concat(en.format(e.endDate,this.dateFormat),"\n                </dd>")}},{key:"getTitleLine",value:function(e){return"<dt>Title:</dt><dd>".concat(e.Title,"</dd>")}},{key:"getDescriptionLine",value:function(e){return"<dt>Description:</dt><dd>".concat(this.getValue(e.Description),"</dd>")}},{key:"getLocationLine",value:function(e){var t=e.PersonDetails,n=e.Location||e.LocationName;return n?"<dt>Location:</dt><dd>".concat(n,"</dd>"):t?"<dt>Location:</dt><dd>".concat(t.City||"",", ").concat(t.Country,"</dd>"):this.getValue(n)}},{key:"getPersonNameLine",value:function(e){var t=e.PersonDetails;return t?"<dt>Person:</dt><dd>".concat(t.Fullname,"</dd>"):""}},{key:"getPersonRankLine",value:function(e){var t=e.PersonDetails;return t?"<dt>Rank:</dt><dd>".concat(t.Rank,"</dd>"):""}},{key:"getPersonNationalityLine",value:function(e){var t=e.PersonDetails;return t?"<dt>Nationality:</dt><dd>".concat(t.Nationality,"</dd>"):""}},{key:"getActionOfficerLine",value:function(e){return"<dt>Action Officer:</dt><dd>".concat(this.getValue(e.ActionOfficer),"</dd>")}},{key:"getStrategicApproachLine",value:function(e){var t=e.StrategicApproachTypeName;return this.scheduler.strategic&&t&&t.length>0?"<dt>Strategic Approach:</dt><dd>".concat(t,"</dd>"):""}},{key:"getValue",value:function(e){return null===e||""===e||void 0===e?"no data":e}}]),e}()),_D=function(){function e(t){i()(this,e),this.scheduler=t,this.dateFormat=t.dateFormat}return o()(e,[{key:"getConfig",value:function(){return{readOnly:!0,timeFormat:"HH:mm",showRecurringUI:!1,dateFormat:this.dateFormat,triggerEvent:"eventclick",bbar:{items:{deleteButton:!1}},toggleEventType:function(e){this.editor.element.dataset.eventType=e||"",this.editor.eachWidget((function(t){t.dataset&&t.dataset.eventType&&(t.hidden=!0!==Boolean(t.dataset[e])),"allDay"===t.ref&&(t.hidden=!1)}))},items:{nameField:!1,resourceField:!1,eventTypeField:{type:"text",weight:-1e3,ref:"eventTypeField",label:"Type",dataset:{eventType:!0,planningcalendar:!0,training:!0,plannedactivity:!0,pmt:!0,planningcalendarcategories:!0}},descriptionField:{type:"displayfield",weight:900,ref:"descriptionField",label:"Description",dataset:{eventType:!0,planningcalendar:!0,plannedactivity:!0,pmt:!0,planningcalendarcategories:!0}},locationField:{type:"text",weight:910,ref:"locationField",label:"Location",dataset:{eventType:!0,pts:!0}},personDetailsField:{type:"text",weight:930,ref:"personDetailsField",label:"Person",dataset:{eventType:!0,pts:!0}},actionOfficerField:{type:"text",weight:940,ref:"actionOfficerField",name:"ActionOfficer",label:"Action Officer",dataset:{eventType:!0,planningcalendar:!0,plannedactivity:!0,pmt:!0,planningcalendarcategories:!0}},directorateField:{type:"text",weight:950,ref:"directorateField",name:"DirectorateOrDivisionName",label:"Directorate",dataset:{eventType:!0,planningcalendar:!0,plannedactivity:!0,planningcalendarcategories:!0}},strategicApproachTypeField:{type:"text",weight:960,ref:"strategicApproachTypeField",name:"StrategicApproachTypeName",label:"Strategic Approach",dataset:{eventType:!0,planningcalendar:!0,plannedactivity:!0,planningcalendarcategories:!0,pmt:!0}},participantsField:{type:"display",weight:970,cls:"b-has-label nthqparticipants_table",label:"Participants",ref:"participantsField",dataset:{eventType:!0,plannedactivity:!0}}}}}},{key:"setTitle",value:function(e,t){var n="";if("pts"===t.eventType){var r=t.PersonDetails,i=r?r.Fullname:"";n=t.isApproved()?t.TypeOfEvent.Name:"P "+i}else n=t.Title;var s=t.LinkToDetails;s&&(n='<a style="color: white;" target="_blank" href="'+s.Url+'">'+n+"</a>"),e.title=n}},{key:"setValues",value:function(e,t){var n=this;e.eachWidget((function(e){if(e.suspendEvents(),!e.hidden)switch(e.ref){case"allDay":e.hidden=!t.allDay;break;case"eventTypeField":e.value=t.TypeOfEvent.Name;break;case"personDetailsField":e.value=t.PersonDetails.Fullname;break;case"locationField":var r=t.PersonDetails;e.value=r.City+","+r.Country;break;case"descriptionField":t.Description?(e.content='<dl><dt style="margin-bottom: 10px">Description</dt><dd>'+t.Description+"</dd></dl>",e.hidden=!1):e.hidden=!0;break;case"strategicApproachTypeField":var i=n.scheduler.strategic,s=t.StrategicApproachTypeName;i&&s&&s.length>0?e.hidden=!1:e.hidden=!0;break;case"participantsField":var o=t.Participants,a='<label class="b-align-start">Participants</label>';a+='<div class="b-field-inner">',o&&(a+="<table><th>Directorate</th><th>Number</th><th>Attendee</th>",(o=o.split("|###")).forEach((function(e){a+="<tr>";var t=e.split("|");3===t.length&&t.forEach((function(e){var t=e.split("=");a+="<td>"+t[1]+"</td>"})),a+="</tr>"})),a+="</table>"),a+="</div>",e.content=a}e.resumeEvents()}))}}]),e}();n(47941),n(68216),n(79433),n(64211),n(41874),n(88674),n(69600),n(74916),n(15306),n(26833);var ND=function(e){d()(s,e);var t,n,r=(t=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=m()(t);if(n){var i=m()(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return h()(this,e)});function s(){return i()(this,s),r.apply(this,arguments)}return o()(s,[{key:"isEventType",get:function(){return!0}},{key:"getCategoryName",value:function(){var e=this.get("Category");return"SynchTool"===e&&(e="Planned Activity"),e.toLowerCase().replace(/ /g,"")}},{key:"getCls",value:function(){var e=this.get("Name").toLowerCase(),t="nthq";return t+this.getCategoryName()+" "+t+e.replace(/ /g,"-")}}],[{key:"fields",get:function(){return[{name:"Id"},{name:"Category"},{name:"Name",dataSource:"Title"},{name:"ShortName"},{name:"Tooltip"},{name:"NonWorking",defaultValue:!1},{name:"Selected",defaultValue:!1},{name:"InLegend",defaultValue:!1},{name:"EventBackgroundColor",dataSource:"seeb"},{name:"EventFontColor"},{name:"Icon"}]}}]),s}(Hi);ND.idField="Id";var HD=function(e){d()(s,e);var t,n,r=(t=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=m()(t);if(n){var i=m()(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return h()(this,e)});function s(){return i()(this,s),r.apply(this,arguments)}return o()(s,[{key:"isDirectorate",get:function(){return!0}},{key:"getCategoryName",value:function(){return this.get("Category").toLowerCase().replace(" ","")}}],[{key:"fields",get:function(){return[{name:"Id"},{name:"Category"},{name:"Name",dataSource:"Title"},{name:"Selected",defaultValue:!1}]}}]),s}(Hi);HD.idField="Id";var BD=function(e){d()(s,e);var t,n,r=(t=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=m()(t);if(n){var i=m()(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return h()(this,e)});function s(){return i()(this,s),r.apply(this,arguments)}return o()(s,[{key:"isEventType",get:function(){return!1}},{key:"isEventTag",get:function(){return!0}}]),s}(ND);BD.idField="Id";var jD=function(e){d()(s,e);var t,n,r=(t=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=m()(t);if(n){var i=m()(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return h()(this,e)});function s(){return i()(this,s),r.apply(this,arguments)}return o()(s,null,[{key:"fields",get:function(){return[{name:"FileRef"},{name:"CountryCode"},{name:"CountryName"}]}}]),s}(Hi);jD.idField="CountryCode";var VD=function(e){d()(s,e);var t,n,r=(t=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=m()(t);if(n){var i=m()(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return h()(this,e)});function s(){return i()(this,s),r.apply(this,arguments)}return o()(s,[{key:"isEventType",get:function(){return!1}},{key:"isLOE",get:function(){return"loe"===this.getCategoryName()}},{key:"isStrategicType",get:function(){return!0}}]),s}(ND);VD.idField="Id";var zD=function(e){d()(s,e);var t,n,r=(t=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=m()(t);if(n){var i=m()(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return h()(this,e)});function s(){return i()(this,s),r.apply(this,arguments)}return o()(s,[{key:"isEventType",get:function(){return!1}},{key:"isStrategicType",get:function(){return!1}},{key:"isNetworkType",get:function(){return!0}}]),s}(ND);zD.idField="Id";var WD=function(e){d()(s,e);var t,n,r=(t=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=m()(t);if(n){var i=m()(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return h()(this,e)});function s(){return i()(this,s),r.apply(this,arguments)}return o()(s,[{key:"isPerson",get:function(){return!0}}],[{key:"fields",get:function(){return[{name:"Building"},{name:"City"},{name:"Country"},{name:"CountryCode",convert:function(e){return e?e.toLowerCase():e}},{name:"DeskPhone"},{name:"EmailClass"},{name:"EmailUnclass"},{name:"Firstname"},{name:"Floor"},{name:"Lastname"},{name:"Location"},{name:"MobilePhone"},{name:"Nationality"},{name:"PersonId"},{name:"Rank"},{name:"Room"},{name:"Nationality"},{name:"Section",dataSource:"SectionId"},{name:"Fullname",dataSource:"Title"},{name:"VoipPhone"}]}}]),s}(Hi);WD.idField="PersonId";var UD=function(e){d()(s,e);var t,n,r=(t=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=m()(t);if(n){var i=m()(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return h()(this,e)});function s(){return i()(this,s),r.apply(this,arguments)}return o()(s,null,[{key:"fields",get:function(){return[{name:"id",dataSource:"Id"},{name:"Text",dataSource:"Title"},{name:"Url"},{name:"Icon"}]}}]),s}(Hi),YD=(n(82481),n(91058),n(4723),function(){function e(){i()(this,e)}return o()(e,null,[{key:"xml2json",value:function(e){var t=this;return function(e){for(var n,r,i,s,o,a={};e.match(/<[^\/][^>]*>/);)n=(o=e.match(/<[^\/][^>]*>/)[0]).substring(1,o.length-1),-1==(r=e.indexOf(o.replace("<","</")))&&(n=o.match(/[^<][\w+$]*/)[0],-1==(r=e.indexOf("</"+n))&&(r=e.indexOf("<\\/"+n))),s=(i=e.substring(o.length,r)).match(/<[^\/][^>]*>/)?t.xml2json(i):i,void 0===a[n]?a[n]=s:Array.isArray(a[n])?a[n].push(s):a[n]=[a[n],s],e=e.substring(2*o.length+1+i.length);return a}(e=function(e){return function(e){var t=e.match(/<[^\/][^>][^<]+\s+.[^<]+[=][^<]+>/g);if(t)for(var n=0;n<t.length;n++){var r=t[n],i="<"+r.match(/[^<][\w+$]*/)[0]+">",s=r.match(/(\S+)=["']?((?:.(?!["']?\s+(?:\S+)=|[>"']))+.)["']?/g);if(s)for(var o=0;o<s.length;o++){var a=s[o],l=a.substring(0,a.indexOf("="));i+="<"+l+">"+a.substring(a.indexOf('"')+1,a.lastIndexOf('"'))+"</"+l+">"}e=e.replace(r,i)}return e}(e=function(e){var t=e.match(/<[^\/][^>][^<]+\s+.[^<]+[=][^<]+>{1}([^<]+)/g);if(t)for(var n=0;n<t.length;n++){var r=t[n],i=r.substring(0,r.indexOf(">")+1)+"<_@ttribute>"+r.substring(r.indexOf(">")+1)+"</_@ttribute>";e=e.replace(r,i)}return e}(e=function(e){var t=e.match(/<[^/][^>]*\/>/g);if(t)for(var n=0;n<t.length;n++){var r=t[n],i=r.substring(0,r.length-2);i+=">";var s=r.match(/[^<][\w+$]*/)[0],o="</"+s+">",a="<"+s+">",l=i.match(/(\S+)=["']?((?:.(?!["']?\s+(?:\S+)=|[>"']))+.)["']?/g);if(l)for(var c=0;c<l.length;c++){var d=l[c],u=d.substring(0,d.indexOf("="));a+="<"+u+">"+d.substring(d.indexOf('"')+1,d.lastIndexOf('"'))+"</"+u+">"}a+=o,e=e.replace(r,a)}return e}(e=(e=(e=(e=(e=e.replace(/<!--[\s\S]*?-->/g,"")).replace(/\n|\t|\r/g,"")).replace(/ {1,}<|\t{1,}</g,"<")).replace(/> {1,}|>\t{1,}/g,">")).replace(/<\?[^>]*\?>/g,""))))}(e))}}]),e}());n(73210);var GD=function(e){d()(s,e);var t,n,r=(t=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=m()(t);if(n){var i=m()(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return h()(this,e)});function s(){return i()(this,s),r.apply(this,arguments)}return o()(s,[{key:"getDirectorateOrDivisionName",value:function(){return this.DirectorateOrDivision.map((function(e){return e.Name})).join(", ")}},{key:"getStrategicApproachName",value:function(){return this.StrategicApproachType.map((function(e){return e.Name})).join(", ")}},{key:"getStrategicApproachDescription",value:function(){return this.StrategicApproachType.map((function(e){return e.Description})).join(", ").trim()}},{key:"getStrategicApproachLOEType",value:function(){var e=this.StrategicApproachType.filter((function(e){return e.isLOE}));if(e.length>0)return e[0]}},{key:"getStrategicApproachLOEName",value:function(){var e=this.getStrategicApproachLOEType();return e?e.Name:"Other"}},{key:"isApproved",value:function(){var e=this.ApprovalStatus||this.TypeOfEvent.Name;if(e)return-1!==e.toLowerCase().indexOf("approved")}},{key:"getOccurrencesForDateRange",value:function(e,t){try{return l()(m()(s.prototype),"getOccurrencesForDateRange",this).apply(this,arguments)}catch(n){return this.stores.length?(this.project=this.stores[0],this.stores[0].getOccurrencesForTimeSpan(this,e,t)):[]}}}],[{key:"fields",get:function(){return[{name:"id",dataSource:"Id"},{name:"ActionOfficer"},{name:"ApprovalStatus"},{name:"Category"},{name:"Classification"},{name:"Command"},{name:"CommandProperties"},{name:"CommunityOfInterest"},{name:"DataSource"},{name:"CommandProperties"},{name:"DirectorateOrDivision"},{name:"DirectorateOrDivisionId",dataSource:"DirectorateOrDivisionId",convert:this.getLookupValues},{name:"DirectorateOrDivisionName"},{name:"EnduringGoals"},{name:"EventId",dataSource:"Id"},{name:"FocusArea"},{name:"InternalEvent"},{name:"LevelOfAttendance"},{name:"LinesOfEffort"},{name:"LinesOfEngagement"},{name:"LinesOfOperation"},{name:"LinesOfDetails"},{name:"LinkToRelatedDocument"},{name:"LinkToRelatedWorkSpace"},{name:"LinkToDetails"},{name:"LocationLatitude"},{name:"LocationLongitude"},{name:"Location"},{name:"LocationName"},{name:"LocationRoom"},{name:"MissionNumber"},{name:"NatoResponseForce",dataSource:"NATOResponseForce"},{name:"NatoExercise"},{name:"NatoOperation"},{name:"Participants",dataSource:"Participants0"},{name:"PartnerShip"},{name:"PersonDetails"},{name:"PersonId"},{name:"resourceId"},{name:"Title"},{name:"Description"},{name:"name",dataSource:"Title"},{name:"TypeOfEvent"},{name:"TypeOfEventId"},{name:"eventType"},{name:"RecurrenceData"},{name:"UID"},{name:"Duration"},{name:"RecurrenceID"},{name:"StrategicApproachType"},{name:"StrategicApproachTypeId",convert:this.getLookupValues},{name:"StrategicApproachTypeName"},{name:"StrategicApproachTypeDescription"},{name:"NetworkId"},{name:"NetworkType"},{name:"EventTags"},{name:"EventTagsId",convert:this.getLookupValues},{name:"allDay"},{name:"fontColor"}]}},{key:"getLookupValues",value:function(e){return e&&e.results?e.results:[]}},{key:"getAllDayEndDate",value:function(e){return e&&e.isEvent&&(e=e.get("endDate")),e}}]),s}(Zv),qD=function(){function e(t,n,r,s){i()(this,e);var o=this;o.rawEvents=t,o.tzString=s,o.dayOfWeek=["su","mo","tu","we","th","fr","sa"],o.weekOfMonth=["first","second","third","fourth"],o.start=n,o.end=r,o.parseRecurrentEvents(t)}return o()(e,[{key:"adjustForTimezone",value:function(e){return new Date(new Date(e.getTime()).toLocaleString("en-US",{timeZone:this.tzString}))}},{key:"parseRecurrentEvents",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=this;t.events=[],t.recurringEvents={},e.forEach((function(e){if(e.EventDate&&e.EndDate)switch(!0===e.fAllDayEvent?(e.startDate=e.EventDate.replace(/:\d\dZ/,""),e.endDate=e.EndDate.replace(/:\d\dZ/,"")):(e.startDate=e.EventDate,e.endDate=e.EndDate),(e=new GD(e)).setStartEndDate(t.adjustForTimezone(e.startDate),t.adjustForTimezone(e.endDate),!0),e.EventType){case 0:t.events.push(e);break;case 1:t.getRecurrentEvent(e.UID).event=t.parseRecurrenceRule(e);break;case 3:t.getRecurrentEvent(e.UID).deletions.push(e);break;case 4:t.getRecurrentEvent(e.UID).exceptions.push(e)}}));var n=t.getRecurringEvents();n.forEach((function(e){var n=e.event,r=e.exceptions.map((function(e){return e.RecurrenceID})),i=e.deletions.map((function(e){return e.RecurrenceID}));n.exceptionDates=r.concat(i),[].push.apply(t.events,e.exceptions),n.recurrence.count||(n.recurrence.endDate=n.endDate);var s=t.dayOfWeek.indexOf(n.RecurrenceData.firstDayOfWeek||"su");n.allDay?(n.startDate=en.clearTime(n.startDate,!0),n.endDate=en.getNext(n.startDate,"s",n.Duration,s)):n.endDate=en.getNext(n.startDate,"s",n.Duration,s),t.events.push(n)}))}},{key:"getRecurrentEvent",value:function(e){var t=this;return t.recurringEvents[e]||(t.recurringEvents[e]={exceptions:[],deletions:[]}),t.recurringEvents[e]}},{key:"getEvents",value:function(){return this.events}},{key:"getRecurringEvents",value:function(){return Object.values(this.recurringEvents)}},{key:"getTimespans",value:function(){return Object.values(this.recurringEvents).map((function(e){return e.event}))}},{key:"parseRecurrenceRule",value:function(e){var t=this,n=YD.xml2json(e.RecurrenceData);if(n){e.RecurrenceData=n.recurrence.rule||{};var r,i,s,o,a,l,c,d=e.RecurrenceData.repeat,u=e.RecurrenceData.repeatInstances;if(c=t.parseNumber(u),d){var h=d.monthly||d.monthlyByDay||d.yearly||d.yearlyByDay;d.daily&&(r="DAILY",i=d.daily.dayFrequency?parseInt(d.daily.dayFrequency):1),d.weekly&&(r="WEEKLY",i=d.weekly.weekFrequency?parseInt(d.weekly.weekFrequency):1),(d.monthly||d.monthlyByDay)&&(r="MONTHLY",i=h.monthFrequency?parseInt(h.monthFrequency):1),(d.yearly||d.yearlyByDay)&&(r="YEARLY",i=h.yearFrequency?parseInt(h.yearFrequency):1),h&&(s=t.parseWeekDayOfMonth(h.weekdayOfMonth),a=t.parseNumber(h.month),l=t.parseNumber(h.day)),o=t.parseDays(h||d.weekly)}e.recurrenceRule=t.buildRule({freq:r,interval:i,bysetpos:s,byday:o,bymonth:a,bymonthday:l,count:c})}return e}},{key:"parseWeekDayOfMonth",value:function(e){if(isNaN(parseInt(e))){var t=this.weekOfMonth.indexOf(e);return-1===t?t:t+1}return parseInt(e)}},{key:"parseNumber",value:function(e){if(!isNaN(parseInt(e)))return parseInt(e)}},{key:"parseDays",value:function(e){if(e){var t=me.dayOfWeek.filter((function(t){return e[t]}));return t.length?t.join(",").toUpperCase():null}}},{key:"buildRule",value:function(e){var t=Object.keys(e),n="";return t.forEach((function(t){void 0!==e[t]&&null!==e[t]&&(n+=t.toUpperCase()+"="+e[t]+";")})),n}}]),e}();var KD=function(e){d()(s,e);var t,n,r=(t=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=m()(t);if(n){var i=m()(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return h()(this,e)});function s(){return i()(this,s),r.apply(this,arguments)}return o()(s,null,[{key:"fields",get:function(){return[{name:"ResourceId"},{name:"Title"},{name:"DirectorateOrDivisionName"},{name:"DirectorateOrDivisionId",defaultValue:[]},{name:"PersonDetails"},{name:"Rank"},{name:"Nationality"},{name:"Lastname"},{name:"TypeOfEvent"},{name:"TypeOfEventName"},{name:"TypeOfEventId"},{name:"StrategicApproachTypeId",defaultValue:[]},{name:"StrategicApproachTypeName"},{name:"StrategicApproachTypeLOEName"},{name:"Location"},{name:"Country"},{name:"imageUrl"},{name:"startDate",type:"date"},{name:"NetworkId"}]}}]),s}(ov);KD.idField="ResourceId";var XD=function(e){d()(s,e);var t,n,r=(t=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=m()(t);if(n){var i=m()(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return h()(this,e)});function s(){return i()(this,s),r.apply(this,arguments)}return o()(s,[{key:"getBoolValue",value:function(){var e=this.Value.toLowerCase();return e="yes"===e||"no"!==e&&e,Boolean(e)}}],[{key:"fields",get:function(){return[{name:"id",dataSource:"Title"},{name:"Name"},{name:"Value",defaultValue:""},{name:"LegendWidth"}]}}]),s}(Hi),ZD=function(){function e(t,n){i()(this,e);var r=this;r.app=t,r.scheduler=n,r.lists=t.lists,r.filters={},r.eventTypesLoaded=!1,r.directoratesLoaded=!1,r.personnelLoaded=!1,r.countryFlagsLoaded=!0,r.strategicTypesLoaded=!1,r.networkTypesLoaded=!1,r.configLoaded=!1,r.navigationItemsLoaded=!1,r.eventTagsLoaded=!1,r.createStores()}return o()(e,[{key:"setTimespan",value:function(e,t){var n=this;t||(t=en.add(e,1,"month")),n.filters.startDate=e,n.filters.endDate=t;var r=n.getScheduler();n.loadData(n.filters).then((function(){r&&r.activeView.refreshSoonNow()}))}},{key:"getScheduler",value:function(){return this.scheduler.scheduler}},{key:"getStore",value:function(){return this.resourceStore}},{key:"getTimeRangesStore",value:function(){return this.timeRangesStore}},{key:"filter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this;e.startDate=t.filters.startDate,e.endDate=t.filters.endDate,t.filters=e;var n=t.scheduler.isScheduler?t.resourceStore:t.eventStore;n.clearFilters(!0),t.timeRangesStore.clearFilters(!0),t.scheduler.strategic=!!Object.keys(t.filters.strategicTypes).length;var r=function(e,t,n){return n?t.length>0&&t.every((function(t){return e[t]})):t.some((function(t){return e[t]}))};if(e.eventTypes&&e.directorates){var i=function(n){var i=!1,s=n.recurringEvent||n;return i=t.scheduler.strategic?e.eventTypes[s.TypeOfEventId]&&r(e.directorates,s.DirectorateOrDivisionId)&&r(e.strategicTypes,s.StrategicApproachTypeId,e.unaligned):e.eventTypes[s.TypeOfEventId]&&r(e.directorates,s.DirectorateOrDivisionId),t.scheduler.disableNetworkFilter||(i=i&&!!e.networkTypes[s.NetworkId]),Object.keys(e.eventTags).length&&(i=!!s.EventTagsId.length&&i&&r(e.eventTags,s.EventTagsId)),i||t.filters.unplanned&&r(e.directorates,s.DirectorateOrDivisionId)&&"unplanned"===s.TypeOfEventId};n.filterBy(i)}}},{key:"setRemoteFilter",value:function(e){if(e.startDate&&e.endDate){var t="(EventDate lt '"+e.startDate.toISOString()+"' and EndDate gt '"+e.startDate.toISOString()+"')",n="(EventDate gt '"+e.startDate.toISOString()+"' and EventDate lt '"+e.endDate.toISOString()+"')";this.lists.events.query="$select=*,Duration,RecurrenceData,EventType,MasterSeriesItemID,RecurrenceID,UID&$top=2000&$filter="+t+" or "+n}else console.log("No start- or enddate set")}},{key:"loadData",value:function(e){var t=this,n=this;return console.log("Load data"),e=e||n.filters||{},n.setRemoteFilter(e),new Promise((function(e){t.loadListItem(n.lists.config,n.configLoaded).then((function(){return n.loadListItem(n.lists.directorates,n.directoratesLoaded).then((function(){return n.loadListItem(n.lists.eventTypes,n.eventTypesLoaded).then((function(){return n.loadListItem(n.lists.strategicTypes,n.strategicTypesLoaded).then((function(){return n.loadListItem(n.lists.networkTypes,n.networkTypesLoaded).then((function(){return n.loadListItem(n.lists.personnel,n.personnelLoaded).then((function(){return n.loadListItem(n.lists.countryFlags,n.countryFlagsLoaded).then((function(){return n.loadListItem(n.lists.navigationItems,n.navigationItemsLoaded).then((function(){return n.loadListItem(n.lists.eventTags,n.eventTagsLoaded).then((function(){return n.loadListItem(n.lists.events).then((function(){n.extractResourcesFromEvents(),n.setNewData(),e()}))}))}))}))}))}))}))}))}))}))}))}},{key:"loadListItem",value:function(e,t){var n=this;return new Promise((function(r){t?r.call(n):n.app.getDataset(e,(function(t){e.data=t,r.call(n,t)}),n.errorFn,n)}))}},{key:"setEventTypeAndDirectorateData",value:function(){var e=this;if(!e.configLoaded){e.configStore.data=e.lists.config.data,e.configLoaded=!0;var t=e.configStore.getById("Timezone");t?e.tzString=t.Value:this.tzString="Europe/Brussels"}e.eventTypesLoaded||e.directoratesLoaded||e.strategicTypesLoaded||e.networkTypesLoaded||(e.eventTypeStore.data=e.lists.eventTypes.data,e.eventTypesLoaded=!0,e.directorateStore.data=e.lists.directorates.data,e.directoratesLoaded=!0,e.strategicTypeStore.data=e.lists.strategicTypes.data,e.strategicTypesLoaded=!0,e.networkTypeStore.data=e.lists.networkTypes.data,e.networkTypesLoaded=!0,e.eventTagStore.data=e.lists.eventTags.data,e.eventTagsLoaded=!0,e.setFilterDefaults(),e.scheduler.eventTypesLoaded())}},{key:"setPersonnelData",value:function(){var e=this;e.personnelLoaded||(e.personnelStore.data=e.lists.personnel.data,e.personnelLoaded=!0)}},{key:"setCountryData",value:function(){var e=this;e.countryFlagsLoaded||(e.countryFlagStore.data=e.lists.countryFlags.data,e.countryFlagsLoaded=!0)}},{key:"setNavigationData",value:function(){var e=this;e.navigationItemsLoaded||(e.navigationItemStore.data=e.lists.navigationItems.data,e.navigationItemsLoaded=!0)}},{key:"setNewData",value:function(){var e=this;e.filter(e.filters),e.eventStore.clear(),e.eventStore.data=e.getEventRecords(),e.resourceStore.data=e.getResourceRecords(e.filters.unplanned)}},{key:"errorFn",value:function(e){console.log(e)}},{key:"resetFilter",value:function(){this.filter(this.setFilterDefaults())}},{key:"createStores",value:function(){var e=this;e.configStore=new As({modelClass:XD}),e.eventTypeStore=new As({modelClass:ND}),e.strategicTypeStore=new As({modelClass:VD}),e.networkTypeStore=new As({modelClass:zD}),e.directorateStore=new As({modelClass:HD}),e.personnelStore=new As({modelClass:WD}),e.eventStore=new Qv({modelClass:GD}),e.resourceStore=new lv({modelClass:KD}),e.timeRangesStore=new As({modelClass:GD}),e.countryFlagStore=new As({modelClass:jD}),e.navigationItemStore=new As({modelClass:UD}),e.eventTagStore=new As({modelClass:BD})}},{key:"extractResourcesFromEvents",value:function(){var e=this,t=this,n={};t.events=[],t.nonWorkingEvents=[],t.setNavigationData(),t.setEventTypeAndDirectorateData(),t.setPersonnelData(),t.setCountryData();var r=new qD(t.lists.events.data,t.filters.startDate,t.filters.endDate,this.tzString).getEvents(),i="person_",s=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];n.forEach((function(n){var r=t.getById(n);r&&e.push(r)}))};r.forEach((function(e){var r,o=t.eventTypeStore.getById(e.TypeOfEventId);if(e.DirectorateOrDivision=[],e.StrategicApproachType=[],e.EventTags=[],s(e.DirectorateOrDivision,t.directorateStore,e.DirectorateOrDivisionId),s(e.StrategicApproachType,t.strategicTypeStore,e.StrategicApproachTypeId),s(e.EventTags,t.eventTagStore,e.EventTagsId),o&&e.DirectorateOrDivision.length>0)if(e.TypeOfEvent=o,e.eventColor=o.EventBackgroundColor,e.fontColor=o.EventFontColor,!0===o.NonWorking)e.isNonWorking=!0,e.allDay=e.fAllDayEvent,e.allDay&&(e.cls=["non-working","all-day"]),t.events.push(e);else{var a,l=o.getCategoryName();if(e.eventType=l,"pts"===l){var c=e.PersonDetails;if(c&&!c.isPerson)try{c=JSON.parse(c)}catch(t){c=null,console.log("Error parsing json for event "+e.Title)}if(c){a=i+c.id;var d=t.personnelStore.getById(c.id);d&&(r=t.buildPersonResource(i,d),e.PersonDetails=d,e.person=d.Fullname)}}else a="planning_"+e.TypeOfEvent.id+"_"+e.DirectorateOrDivisionId.join("-")+e.Title.replace(/ /g,"_"),e.PersonDetails=null,r={ResourceId:a,Title:e.Title,Location:e.LocationName};!n[a]&&r?(r.DirectorateOrDivisionId=e.DirectorateOrDivisionId,r.DirectorateOrDivisionName=e.getDirectorateOrDivisionName(),r.TypeOfEvent=o,r.TypeOfEventName=o.Name,r.TypeOfEventId=o.id,r.startDate=e.startDate,r.StrategicApproachTypeId=e.StrategicApproachTypeId,r.StrategicApproachTypeName=e.getStrategicApproachName(),r.StrategicApproachTypeLOEName=e.getStrategicApproachLOEName(),r.NetworkId=e.NetworkId,n[a]=r):r=n[a],r&&(e.DirectorateOrDivisionName=e.getDirectorateOrDivisionName(),e.StrategicApproachTypeName=e.getStrategicApproachName(),e.StrategicApproachTypeDescription=e.getStrategicApproachDescription(),e.resourceId=a,e.style={border:"0px;"},t.events.push(e))}})),t.scheduler.isCalendar||t.personnelStore.forEach((function(r){if(!n[i+r.id]){var s=t.buildPersonResource("unplanned_",r),o=e.directorateStore.getById(r.Section);o&&(s.DirectorateOrDivisionId=[o.id],s.DirectorateOrDivisionName=o.Name,s.NetworkId="None"),s.StrategicApproachTypeLOEName="Unplanned",n[s.ResourceId]=s}})),t.resources=n}},{key:"buildPersonResource",value:function(e,t){var n=t.CountryCode,r=null;if(n){var i=this.countryFlagStore.getById(n.toLowerCase());i&&(r=i.FileRef)}return{ResourceId:e+t.id,Title:t.Fullname,Rank:t.Rank,Nationality:t.Nationality,Lastname:t.Lastname,imageUrl:r,Location:t.City+", "+t.Country,TypeOfEventId:"unplanned"}}},{key:"getResourceRecords",value:function(e){var t=Object.values(this.resources);return e?t:t.filter((function(e){return"unplanned"!==e.TypeOfEventId}))}},{key:"getEventRecords",value:function(){return this.events}},{key:"getNonWorkingTimeRecords",value:function(){return this.nonWorkingEvents}},{key:"setFilterDefaults",value:function(){var e=this,t=e.filters||{};t.unplanned=!1,t.unaligned=!1,t.eventTypes={},t.directorates={},t.strategicTypes={},t.networkTypes={},t.eventTags={};var n=e.eventTypeStore.records,r=e.directorateStore.records,i=e.strategicTypeStore.records,s=e.networkTypeStore.records,o=e.eventTagStore.records;return n.forEach((function(e){!0===e.Selected&&(t.eventTypes[e.id]=!0)})),r.forEach((function(e){!0!==e.Selected&&null!==e.Selected||(t.directorates[e.id]=!0)})),i.forEach((function(e){!0!==e.Selected&&null!==e.Selected||(t.strategicTypes[e.id]=!0)})),s.forEach((function(e){!0!==e.Selected&&null!==e.Selected||(t.networkTypes[e.id]=!0)})),o.forEach((function(e){!0!==e.Selected&&null!==e.Selected||(t.eventTags[e.id]=!0)})),e.filters}}]),e}(),JD=n(63038),QD=n.n(JD),eE=(n(47042),n(40561),n(68309),n(69826),n(31672),n(59461),function(){function e(t,n){i()(this,e);var r=this;r.app=t,r.scheduler=n,r.data=n.data,r.categories={},r.categoryHeaders=[],r.numberOfItemsPerColumn=6,r.containerHeight=210,r.disableNetworkFilter=n.disableNetworkFilter;var s=qc.append([{type:"button",cls:"nthqfilterbtn",ref:"filterBtn",text:"Filter",color:"b-orange b-raised",icon:"b-icon b-fa-filter",onAction:r.openFilterWindow.bind(r)},{type:"button",ref:"resetFilterBtn",text:"Reset Filter",color:"b-orange b-raised",cls:"nthqfilterbtn",icon:"b-icon b-fa-redo",disabled:!0,onAction:r.resetFilter.bind(r)}],{appendTo:document.getElementById("filterplaceholder")}),o=QD()(s,2),a=o[0],l=o[1];r.filterBtn=a,r.resetFilterBtn=l}return o()(e,[{key:"openFilterWindow",value:function(){var e=this;e.data.eventTypesLoaded&&e.data.directoratesLoaded&&e.data.strategicTypesLoaded&&(e.popup||e.createPopup(),e.popup.isVisible?e.popup.hide():(e.setFilters(),e.toggleSelectButtons(),e.popup.show()))}},{key:"getContainers",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this,i={};e.filter((function(e){return!e.isEventType||e.Visible})).forEach((function(e){i[e.Category]||(i[e.Category]=[]),i[e.Category].push(new Au({cls:"nthqcategoryitem",typeId:e.id,checked:!0,maxWidth:150,style:"padding-left: 10px;",categoryItem:e,category:e.Category,onAction:r.onItemCheck.bind(r),tabIndex:t,text:e.Name}))}));var s=[];return Object.keys(i).forEach((function(e){var n=[];for(r.categories[e]=i[e].slice();i[e].length>0;)n.push(i[e].splice(0,r.numberOfItemsPerColumn));n.forEach((function(n,i){var o={type:"container",cls:"nthqcategory"},a={style:"height: 25px;",cls:"nthqcategoryitem",tabIndex:t};0===i&&(a.category=e,a.checked=!0,a.onAction=r.onCategoryCheck.bind(r),a.text="<b><u>"+e+"</u></b>",a=new Au(a),r.categoryHeaders.push(a)),n.unshift(a),o.items=n,s.push(o)}))})),n.unaligned&&(r.unaligned=new Au({checked:!1,cls:"nthqcategoryitem",text:"<b>Unaligned Activities</b>",tabIndex:t,typeId:"unalignedactivities"}),s[0].items.push(r.unaligned)),s}},{key:"createPopup",value:function(){var e=this,t=e.data.eventTypeStore.records,n=e.data.directorateStore.records,r=e.data.strategicTypeStore.records,i=e.data.networkTypeStore.records,s=e.data.eventTagStore.records,o=[];e.disableNetworkFilter||o.push({name:"Network",items:i,options:{}});var a=(o=o.concat([{name:"Applications",items:t,options:{}},{name:"Directorates",items:n,options:{}},{name:"Strategic Approach",items:r,options:{unaligned:!0}},{name:"Tags",items:s,options:{}}])).map((function(t,n){return{title:t.name,height:e.containerHeight,layoutStyle:{flexDirection:"column"},items:e.getContainers(t.items,n,t.options)}}));e.tabPanel=new Rh({ref:"filterTabpanel",cls:"nthqfilter-tabpanel",onTabchange:function(){e.toggleSelectButtons()},items:a}),e.popup=new Ic({forElement:document.querySelector(".nthqfilterbtn"),header:!1,autoClose:!1,autoShow:!1,style:"width: 900px;",cls:"nthqfilter-popup",layoutStyle:{flexDirection:"column"},items:[e.tabPanel,{type:"container",cls:"b-raised",items:[{type:"button",text:"Select all",disabled:!0,ref:"selectAllBtn",color:"b-orange b-raised",onAction:e.selectAll.bind(e)},{type:"button",text:"Deselect all",ref:"deselectAllBtn",color:"b-orange b-raised",onAction:e.deselectAll.bind(e)},{type:"button",text:"Submit",color:"b-orange b-raised",onAction:e.submitFilter.bind(e)},{type:"button",text:"Cancel",color:"b-orange b-raised",onAction:e.closeFilterPopup.bind(e)}]}]})}},{key:"toggleSelectButtons",value:function(){var e=this,t=e.tabPanel.activeIndex,n=e.getAllCheckBoxes(t),r=!n.some((function(e){return!e.checked})),i=!n.some((function(e){return e.checked}));e.popup.widgetMap.selectAllBtn.disabled=r,e.popup.widgetMap.deselectAllBtn.disabled=i}},{key:"resetFilter",value:function(){var e=this;e.resetFilterBtn.disabled=!0,e.data.resetFilter(),e.popup&&e.popup.close()}},{key:"onCategoryCheck",value:function(e){e.userAction&&(this.categories[e.source.category].forEach((function(t){t.checked=e.checked})),this.toggleSelectButtons())}},{key:"onItemCheck",value:function(e){e.userAction&&(this.setValueCategoryHeader(e.source.category),this.toggleSelectButtons())}},{key:"setValueCategoryHeader",value:function(e){var t=this.categories[e],n=!t.some((function(e){return!e.checked})),r=t.some((function(e){return!e.checked}));if(n||r){var i=this.categoryHeaders.find((function(t){return t.category===e}));n&&(i.checked=!0),r&&(i.checked=!1)}}},{key:"selectOrDeselectAllItems",value:function(e){var t=this,n=t.tabPanel.activeIndex,r=t.getAllCheckBoxes(n);r.forEach((function(t){t.checked=e})),(r=t.getCategoryCheckboxes(n)).forEach((function(t){t.checked=e})),this.popup.widgetMap.selectAllBtn.disabled=e,this.popup.widgetMap.deselectAllBtn.disabled=!e}},{key:"selectAll",value:function(){this.selectOrDeselectAllItems(!0)}},{key:"deselectAll",value:function(){this.selectOrDeselectAllItems(!1)}},{key:"submitFilter",value:function(){var e=this;e.resetFilterBtn.disabled=!1;var t={eventTypes:{},directorates:{},strategicTypes:{},networkTypes:{},eventTags:{}};e.getAllCheckBoxes().forEach((function(e){e.checked&&(e.categoryItem.isEventType&&(t.eventTypes[e.categoryItem.id]=e.categoryItem),e.categoryItem.isDirectorate&&(t.directorates[e.categoryItem.id]=e.categoryItem),e.categoryItem.isStrategicType&&(t.strategicTypes[e.categoryItem.id]=e.categoryItem),e.categoryItem.isNetworkType&&(t.networkTypes[e.categoryItem.id]=!0),e.categoryItem.isEventTag&&(t.eventTags[e.categoryItem.id]=e.categoryItem))})),e.unaligned.checked&&(t.unaligned=!0),e.scheduler.data.filter(t),e.popup.close()}},{key:"getAllCheckBoxes",value:function(e){var t=this,n=[];return Object.keys(t.categories).forEach((function(r){t.categories[r].forEach((function(t){(void 0===e||t.tabIndex===e)&&n.push(t)}))})),n}},{key:"getCategoryCheckboxes",value:function(e){var t=[];return this.categoryHeaders.forEach((function(n){n.tabIndex===e&&t.push(n)})),t}},{key:"setFilters",value:function(){var e=this,t=e.data.filters;e.getAllCheckBoxes().forEach((function(e){e.checked=!1,e.categoryItem.isEventType&&t.eventTypes[e.typeId]&&(e.checked=!0),e.categoryItem.isDirectorate&&t.directorates[e.typeId]&&(e.checked=!0),e.categoryItem.isStrategicType&&t.strategicTypes[e.typeId]&&(e.checked=!0),e.categoryItem.isNetworkType&&t.networkTypes[e.typeId]&&(e.checked=!0),e.categoryItem.isEventTag&&t.eventTags[e.typeId]&&(e.checked=!0)})),Object.keys(e.categories).forEach((function(t){e.setValueCategoryHeader(t)}))}},{key:"closeFilterPopup",value:function(){this.popup.close()}}]),e}()),tE=function(){function e(t,n){i()(this,e);var r=this;r.navigationItemStore=n.data.navigationItemStore;var s=document.querySelector(".nthq_nav_row"),o=[];r.navigationItemStore.forEach((function(e){o.push(r.createItem(e))})),qc.append([{type:"container",items:o}],{appendTo:s})}return o()(e,[{key:"createItem",value:function(e){var t=e.Url||{};return{cls:"nthq_navigation_item",type:"button",tooltip:t.Description,href:t.Url,text:e.Text,target:"_blank",icon:e.Icon}}}]),e}(),nE=function(){function e(){i()(this,e)}return o()(e,null,[{key:"getColorRule",value:function(e,t){if(t)return t;if(e){var n="#"===e.charAt(0)?e.substring(1,7):e;return.299*parseInt(n.substring(0,2),16)+.587*parseInt(n.substring(2,4),16)+.114*parseInt(n.substring(4,6),16)>160?"black":"white"}}},{key:"getColorStyle",value:function(e,t){return"color:"+this.getColorRule(e,t)+" !important;background-color:"+e+" !important;"}}]),e}(),rE=function(){function e(t,n){i()(this,e);var r=this;r.eventTypeStore=n.data.eventTypeStore,r.configStore=n.data.configStore;var s=r.configStore.getById("LegendWidth"),o=document.getElementById("eventtypelegendplaceholder");s&&(o.style.width=s.Value+"px");var a=[];r.eventTypeStore.forEach((function(e){e.InLegend&&a.push(r.createItem(e))})),qc.append([{type:"container",items:[{type:"container",items:a}]}],{appendTo:o})}return o()(e,[{key:"createItem",value:function(e){return{cls:"nthqeventtypelegend_box",style:nE.getColorStyle(e.EventBackgroundColor,e.EventFontColor),tooltip:e.Tooltip||e.Name,html:e.ShortName||e.Name}}}]),e}(),iE=function(){function e(t,n){i()(this,e);var r=this;r.eventTagStore=n.data.eventTagStore,r.configStore=n.data.configStore;var s=r.configStore.getById("LegendWidth"),o=document.getElementById("eventtaglegendplaceholder");s&&(o.style.width=s.Value+"px");var a=[];r.eventTagStore.forEach((function(e){a.push(r.createItem(e))})),qc.append([{type:"container",cls:"nthqeventtaglegend_container",items:a}],{appendTo:o})}return o()(e,[{key:"createItem",value:function(e){return{cls:"nthqeventtaglegend_box",tooltip:e.Name,html:'<i class="'.concat(e.Icon,' b-fa" aria-hidden="true"></i><span> -- ').concat(e.Name,"</span>")}}}]),e}(),sE=o()((function e(t,n){i()(this,e);var r=this;r.app=t,r.scheduler=n,r.app.header=this,r.navigationBar=new tE(t,n),r.filter=new eE(t,n),r.eventTypelegend=new rE(t,n),r.eventTagLegend=new iE(t,n)}));lt.extendLocale("En",{DayView:{expandAllDayRow:"Click to expand all-day section"}});var oE=function(){function e(t,n){i()(this,e);var r=this;r.app=t,r.data=new ZD(t,r),window.data=r.data,r.dateFormat="DD/MM/YYYY",r.strategic=!!n,r.eventDetails=new _D(r),r.eventToolTip=new $D(r),r.createScheduler(),r.data.setTimespan(r.scheduler.activeView.startDate,r.scheduler.activeView.endDate),r.keys={}}return o()(e,[{key:"isCalendar",get:function(){return!0}},{key:"isScheduler",get:function(){return!1}},{key:"eventRenderer",value:function(e){var t=e.eventRecord,n=e.renderData;n.isAllDay&&(n.style.color=nE.getColorRule(t.eventColor,t.fontColor));var r=t.EventTags.map((function(e){return e.Icon}));if(r.length){var i=[];r.forEach((function(e){i.unshift({tag:"i",className:"b-fa "+e})}));var s={tag:"span",html:t.Title};return i.push(s),{children:i}}return t.Title}},{key:"dayHeaderRenderer",value:function(e,t){this.keys[t.key]=t.renderedEvents}},{key:"dayCellRenderer",value:function(e,t){var n=e.filter((function(e){var t=e.eventRecord||e;return(e.isAllDay||t.fAllDayEvent)&&t.isNonWorking})).map((function(e){return e.eventRecord||e}));if(n.length){var r=n[0];if(n.length>1){var i=n.filter((function(e){return"SHAPE Holiday"===e.TypeOfEvent.Name}))[0];i&&(r=i)}t.backgroundColor=r.eventColor}}},{key:"createScheduler",value:function(){var e=this,t=new Date((new Date).getFullYear(),(new Date).getMonth(),1);e.scheduler=new PD({appendTo:"schedulerplaceholder",eventStyle:"border",monitorResize:!0,autoCreate:!1,scrollToDate:function(e,t){try{e.scrollTo(new Date,{highlight:!0}).catch((function(){}))}catch(e){console.log(e)}},shiftToNow:function(){this.date=en.clearTime(new Date),this.updateViewDescription(),this.activeView.isAgendaView&&this.scrollToDate(this.activeView,new Date)},tbar:{items:{addEventButton:{type:"button",text:"Add event",weight:400,icon:"b-fa b-fa-calendar",onAction:function(){var t=e.data.configStore.getById("NewEventUrl");t&&window.open(t.Value,"_blank")}},print:{type:"button",text:"Print",weight:401,icon:"b-fa b-fa-print",onClick:function(){e.scheduler.features.print.print()}},settings:{type:"button",icon:"b-fa b-fa-cog",weight:800,style:"margin-left: 1em",menu:{items:{toggleShowWeek:{text:"Week column",checked:!0,onToggle:function(t){var n=t.checked;e.scheduler&&(e.scheduler.activeView.showWeekNumber=n)}},toggleNonWorkingDays:{text:"Nonworking days",checked:!0,onToggle:function(t){var n=t.checked;e.scheduler&&(e.scheduler.activeView.hideNonWorkingDays=!n)}}}}}}},sidebar:{collapsed:!0,items:{resourceFilter:{hidden:!0}},listeners:{dateChange:function(t){e.scheduler.onMyDateChange(t)}}},mode:"month",modeDefaults:{eventRenderer:this.eventRenderer.bind(e),overflowClickAction:"expand",myOnOverflowClick:function(){var e=this.allDayEvents;e&&(e.toggleExpandCollapse(),this.allDayToggleIcon.dataset.btip=e.expanded?this.L("L{collapseAllDayRow}"):this.L("L{expandAllDayRow}"))},listeners:{cellOverflowClick:function(e){e.domEvent.preventDefault()}},onCornerClick:function(e){e.preventDefault(),this.myOnOverflowClick()}},modes:{agenda:{range:"1 week",preserveScrollOnDatasetChange:!1,cellRenderer:function(t){var n=t.record.events,r={};e.dayCellRenderer(n,r),t.rowElement.style.backgroundColor=r.backgroundColor?r.backgroundColor:""},listeners:{beforeShow:function(t){var n=t.source;n._listRangeMenu||(n.listRangeMenu.items.listRangeDecadeItem.hidden=!0,n.listRangeMenu.items.listRangeYearItem.hidden=!0),e.scheduler.selectedEvents=[]}}},year:!1,month:{minRowHeight:100,dayCellRenderer:function(t,n){e.dayCellRenderer(t.renderedEvents,n.style)},weekRenderer:function(e,t){e.innerHTML='<span class="week-text">WEEK '.concat(t[1],"</span>")}},week:{dayHeaderRenderer:e.dayHeaderRenderer.bind(e),dayCellRenderer:function(t,n){var r=e.keys[n.key];return r&&e.dayCellRenderer(r,t.style),t}},day:{dayHeaderRenderer:e.dayHeaderRenderer.bind(e),dayCellRenderer:function(t,n){var r=e.keys[n.key];return r&&e.dayCellRenderer(r,t.style),t}}},features:{print:!0,drag:!1,eventTooltip:e.eventToolTip.getCalendarConfig(),eventEdit:e.eventDetails.getConfig()},date:t,eventStore:e.data.eventStore,resourceStore:e.data.resourceStore,onMyDateChange:function(t){var n=t.date,r=this.widgetMap.viewContainer.layout.activeItem;r&&(en.intersectSpans(r.startDate,r.endDate,n,n)&&!this.changingSidebarDate?r._date=n:r.date=n,en.timeSpanContains(e.data.filters.startDate,e.data.filters.endDate,r.startDate,r.endDate)||e.data.setTimespan(r.startDate,r.endDate),r.isAgendaView&&this.scrollToDate(r,n))},listeners:{activeItemChange:function(t){var n=t.activeItem;e.keys={},n.isAgendaView&&(e.scheduler.date=new Date,this.scrollToDate(n,e.scheduler.date))},viewPaint:function(e){var t=e.source,n=this.tbar.widgetMap.settings.menu.widgetMap;t.isMonthView||t.isYearView?(n.toggleShowWeek.disabled=!1,n.toggleShowWeek.checked=t.showWeekNumber):n.toggleShowWeek.disabled=!0,t.isDayView&&1===t.duration?n.toggleNonWorkingDays.disabled=!0:(n.toggleNonWorkingDays.disabled=!1,n.toggleNonWorkingDays.checked=!t.hideNonWorkingDays)},beforeEventEditShow:function(t){var n=t.editor,r=t.eventRecord;e.eventDetails.setTitle(n,r),e.eventDetails.setValues(n,r)},beforeEventEdit:function(e){var t=e.eventRecord;e.eventEdit.eventRecord=t}}}),window.scheduler=e.scheduler}},{key:"eventTypesLoaded",value:function(){var e=this,t=e.data.configStore.getById("DisableNetworkFilterCalendar");e.disableNetworkFilter=t&&t.getBoolValue(),t=e.data.configStore.getById("DisablePrintCalendar"),e.disablePrint=t&&t.getBoolValue(),e.scheduler.tbar.widgetMap.print.hidden=this.disablePrint,new sE(this.app,this)}}]),e}()},19662:function(e,t,n){var r=n(60614),i=n(66330),s=TypeError;e.exports=function(e){if(r(e))return e;throw s(i(e)+" is not a function")}},39483:function(e,t,n){var r=n(4411),i=n(66330),s=TypeError;e.exports=function(e){if(r(e))return e;throw s(i(e)+" is not a constructor")}},96077:function(e,t,n){var r=n(60614),i=String,s=TypeError;e.exports=function(e){if("object"==typeof e||r(e))return e;throw s("Can't set "+i(e)+" as a prototype")}},51223:function(e,t,n){var r=n(5112),i=n(70030),s=n(3070).f,o=r("unscopables"),a=Array.prototype;null==a[o]&&s(a,o,{configurable:!0,value:i(null)}),e.exports=function(e){a[o][e]=!0}},31530:function(e,t,n){"use strict";var r=n(28710).charAt;e.exports=function(e,t,n){return t+(n?r(e,t).length:1)}},25787:function(e,t,n){var r=n(47976),i=TypeError;e.exports=function(e,t){if(r(t,e))return e;throw i("Incorrect invocation")}},19670:function(e,t,n){var r=n(70111),i=String,s=TypeError;e.exports=function(e){if(r(e))return e;throw s(i(e)+" is not an object")}},23013:function(e){e.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},7556:function(e,t,n){var r=n(47293);e.exports=r((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}}))},90260:function(e,t,n){"use strict";var r,i,s,o=n(23013),a=n(19781),l=n(17854),c=n(60614),d=n(70111),u=n(92597),h=n(70648),g=n(66330),m=n(68880),p=n(98052),f=n(3070).f,v=n(47976),y=n(79518),b=n(27674),C=n(5112),w=n(69711),S=n(29909),D=S.enforce,E=S.get,x=l.Int8Array,R=x&&x.prototype,T=l.Uint8ClampedArray,M=T&&T.prototype,k=x&&y(x),I=R&&y(R),A=Object.prototype,F=l.TypeError,O=C("toStringTag"),L=w("TYPED_ARRAY_TAG"),P=o&&!!b&&"Opera"!==h(l.opera),$=!1,_={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},N={BigInt64Array:8,BigUint64Array:8},H=function(e){var t=y(e);if(d(t)){var n=E(t);return n&&u(n,"TypedArrayConstructor")?n.TypedArrayConstructor:H(t)}},B=function(e){if(!d(e))return!1;var t=h(e);return u(_,t)||u(N,t)};for(r in _)(s=(i=l[r])&&i.prototype)?D(s).TypedArrayConstructor=i:P=!1;for(r in N)(s=(i=l[r])&&i.prototype)&&(D(s).TypedArrayConstructor=i);if((!P||!c(k)||k===Function.prototype)&&(k=function(){throw F("Incorrect invocation")},P))for(r in _)l[r]&&b(l[r],k);if((!P||!I||I===A)&&(I=k.prototype,P))for(r in _)l[r]&&b(l[r].prototype,I);if(P&&y(M)!==I&&b(M,I),a&&!u(I,O))for(r in $=!0,f(I,O,{get:function(){return d(this)?this[L]:void 0}}),_)l[r]&&m(l[r],L,r);e.exports={NATIVE_ARRAY_BUFFER_VIEWS:P,TYPED_ARRAY_TAG:$&&L,aTypedArray:function(e){if(B(e))return e;throw F("Target is not a typed array")},aTypedArrayConstructor:function(e){if(c(e)&&(!b||v(k,e)))return e;throw F(g(e)+" is not a typed array constructor")},exportTypedArrayMethod:function(e,t,n,r){if(a){if(n)for(var i in _){var s=l[i];if(s&&u(s.prototype,e))try{delete s.prototype[e]}catch(n){try{s.prototype[e]=t}catch(e){}}}I[e]&&!n||p(I,e,n?t:P&&R[e]||t,r)}},exportTypedArrayStaticMethod:function(e,t,n){var r,i;if(a){if(b){if(n)for(r in _)if((i=l[r])&&u(i,e))try{delete i[e]}catch(e){}if(k[e]&&!n)return;try{return p(k,e,n?t:P&&k[e]||t)}catch(e){}}for(r in _)!(i=l[r])||i[e]&&!n||p(i,e,t)}},getTypedArrayConstructor:H,isView:function(e){if(!d(e))return!1;var t=h(e);return"DataView"===t||u(_,t)||u(N,t)},isTypedArray:B,TypedArray:k,TypedArrayPrototype:I}},13331:function(e,t,n){"use strict";var r=n(17854),i=n(1702),s=n(19781),o=n(23013),a=n(76530),l=n(68880),c=n(89190),d=n(47293),u=n(25787),h=n(19303),g=n(17466),m=n(57067),p=n(11179),f=n(79518),v=n(27674),y=n(8006).f,b=n(3070).f,C=n(21285),w=n(41589),S=n(58003),D=n(29909),E=a.PROPER,x=a.CONFIGURABLE,R=D.get,T=D.set,M="ArrayBuffer",k="Wrong index",I=r.ArrayBuffer,A=I,F=A&&A.prototype,O=r.DataView,L=O&&O.prototype,P=Object.prototype,$=r.Array,_=r.RangeError,N=i(C),H=i([].reverse),B=p.pack,j=p.unpack,V=function(e){return[255&e]},z=function(e){return[255&e,e>>8&255]},W=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},U=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},Y=function(e){return B(e,23,4)},G=function(e){return B(e,52,8)},q=function(e,t){b(e.prototype,t,{get:function(){return R(this)[t]}})},K=function(e,t,n,r){var i=m(n),s=R(e);if(i+t>s.byteLength)throw _(k);var o=R(s.buffer).bytes,a=i+s.byteOffset,l=w(o,a,a+t);return r?l:H(l)},X=function(e,t,n,r,i,s){var o=m(n),a=R(e);if(o+t>a.byteLength)throw _(k);for(var l=R(a.buffer).bytes,c=o+a.byteOffset,d=r(+i),u=0;u<t;u++)l[c+u]=d[s?u:t-u-1]};if(o){var Z=E&&I.name!==M;if(d((function(){I(1)}))&&d((function(){new I(-1)}))&&!d((function(){return new I,new I(1.5),new I(NaN),1!=I.length||Z&&!x})))Z&&x&&l(I,"name",M);else{(A=function(e){return u(this,F),new I(m(e))}).prototype=F;for(var J,Q=y(I),ee=0;Q.length>ee;)(J=Q[ee++])in A||l(A,J,I[J]);F.constructor=A}v&&f(L)!==P&&v(L,P);var te=new O(new A(2)),ne=i(L.setInt8);te.setInt8(0,2147483648),te.setInt8(1,2147483649),!te.getInt8(0)&&te.getInt8(1)||c(L,{setInt8:function(e,t){ne(this,e,t<<24>>24)},setUint8:function(e,t){ne(this,e,t<<24>>24)}},{unsafe:!0})}else F=(A=function(e){u(this,F);var t=m(e);T(this,{bytes:N($(t),0),byteLength:t}),s||(this.byteLength=t)}).prototype,L=(O=function(e,t,n){u(this,L),u(e,F);var r=R(e).byteLength,i=h(t);if(i<0||i>r)throw _("Wrong offset");if(i+(n=void 0===n?r-i:g(n))>r)throw _("Wrong length");T(this,{buffer:e,byteLength:n,byteOffset:i}),s||(this.buffer=e,this.byteLength=n,this.byteOffset=i)}).prototype,s&&(q(A,"byteLength"),q(O,"buffer"),q(O,"byteLength"),q(O,"byteOffset")),c(L,{getInt8:function(e){return K(this,1,e)[0]<<24>>24},getUint8:function(e){return K(this,1,e)[0]},getInt16:function(e){var t=K(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=K(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return U(K(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return U(K(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return j(K(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return j(K(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){X(this,1,e,V,t)},setUint8:function(e,t){X(this,1,e,V,t)},setInt16:function(e,t){X(this,2,e,z,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){X(this,2,e,z,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){X(this,4,e,W,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){X(this,4,e,W,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){X(this,4,e,Y,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){X(this,8,e,G,t,arguments.length>2?arguments[2]:void 0)}});S(A,M),S(O,"DataView"),e.exports={ArrayBuffer:A,DataView:O}},1048:function(e,t,n){"use strict";var r=n(47908),i=n(51400),s=n(26244),o=n(85117),a=Math.min;e.exports=[].copyWithin||function(e,t){var n=r(this),l=s(n),c=i(e,l),d=i(t,l),u=arguments.length>2?arguments[2]:void 0,h=a((void 0===u?l:i(u,l))-d,l-c),g=1;for(d<c&&c<d+h&&(g=-1,d+=h-1,c+=h-1);h-- >0;)d in n?n[c]=n[d]:o(n,c),c+=g,d+=g;return n}},21285:function(e,t,n){"use strict";var r=n(47908),i=n(51400),s=n(26244);e.exports=function(e){for(var t=r(this),n=s(t),o=arguments.length,a=i(o>1?arguments[1]:void 0,n),l=o>2?arguments[2]:void 0,c=void 0===l?n:i(l,n);c>a;)t[a++]=e;return t}},18533:function(e,t,n){"use strict";var r=n(42092).forEach,i=n(9341)("forEach");e.exports=i?[].forEach:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}},97745:function(e,t,n){var r=n(26244);e.exports=function(e,t){for(var n=0,i=r(t),s=new e(i);i>n;)s[n]=t[n++];return s}},48457:function(e,t,n){"use strict";var r=n(49974),i=n(46916),s=n(47908),o=n(53411),a=n(97659),l=n(4411),c=n(26244),d=n(86135),u=n(18554),h=n(71246),g=Array;e.exports=function(e){var t=s(e),n=l(this),m=arguments.length,p=m>1?arguments[1]:void 0,f=void 0!==p;f&&(p=r(p,m>2?arguments[2]:void 0));var v,y,b,C,w,S,D=h(t),E=0;if(!D||this===g&&a(D))for(v=c(t),y=n?new this(v):g(v);v>E;E++)S=f?p(t[E],E):t[E],d(y,E,S);else for(w=(C=u(t,D)).next,y=n?new this:[];!(b=i(w,C)).done;E++)S=f?o(C,p,[b.value,E],!0):b.value,d(y,E,S);return y.length=E,y}},41318:function(e,t,n){var r=n(45656),i=n(51400),s=n(26244),o=function(e){return function(t,n,o){var a,l=r(t),c=s(l),d=i(o,c);if(e&&n!=n){for(;c>d;)if((a=l[d++])!=a)return!0}else for(;c>d;d++)if((e||d in l)&&l[d]===n)return e||d||0;return!e&&-1}};e.exports={includes:o(!0),indexOf:o(!1)}},9671:function(e,t,n){var r=n(49974),i=n(68361),s=n(47908),o=n(26244),a=function(e){var t=1==e;return function(n,a,l){for(var c,d=s(n),u=i(d),h=r(a,l),g=o(u);g-- >0;)if(h(c=u[g],g,d))switch(e){case 0:return c;case 1:return g}return t?-1:void 0}};e.exports={findLast:a(0),findLastIndex:a(1)}},42092:function(e,t,n){var r=n(49974),i=n(1702),s=n(68361),o=n(47908),a=n(26244),l=n(65417),c=i([].push),d=function(e){var t=1==e,n=2==e,i=3==e,d=4==e,u=6==e,h=7==e,g=5==e||u;return function(m,p,f,v){for(var y,b,C=o(m),w=s(C),S=r(p,f),D=a(w),E=0,x=v||l,R=t?x(m,D):n||h?x(m,0):void 0;D>E;E++)if((g||E in w)&&(b=S(y=w[E],E,C),e))if(t)R[E]=b;else if(b)switch(e){case 3:return!0;case 5:return y;case 6:return E;case 2:c(R,y)}else switch(e){case 4:return!1;case 7:c(R,y)}return u?-1:i||d?d:R}};e.exports={forEach:d(0),map:d(1),filter:d(2),some:d(3),every:d(4),find:d(5),findIndex:d(6),filterReject:d(7)}},86583:function(e,t,n){"use strict";var r=n(22104),i=n(45656),s=n(19303),o=n(26244),a=n(9341),l=Math.min,c=[].lastIndexOf,d=!!c&&1/[1].lastIndexOf(1,-0)<0,u=a("lastIndexOf"),h=d||!u;e.exports=h?function(e){if(d)return r(c,this,arguments)||0;var t=i(this),n=o(t),a=n-1;for(arguments.length>1&&(a=l(a,s(arguments[1]))),a<0&&(a=n+a);a>=0;a--)if(a in t&&t[a]===e)return a||0;return-1}:c},81194:function(e,t,n){var r=n(47293),i=n(5112),s=n(7392),o=i("species");e.exports=function(e){return s>=51||!r((function(){var t=[];return(t.constructor={})[o]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},9341:function(e,t,n){"use strict";var r=n(47293);e.exports=function(e,t){var n=[][e];return!!n&&r((function(){n.call(null,t||function(){return 1},1)}))}},53671:function(e,t,n){var r=n(19662),i=n(47908),s=n(68361),o=n(26244),a=TypeError,l=function(e){return function(t,n,l,c){r(n);var d=i(t),u=s(d),h=o(d),g=e?h-1:0,m=e?-1:1;if(l<2)for(;;){if(g in u){c=u[g],g+=m;break}if(g+=m,e?g<0:h<=g)throw a("Reduce of empty array with no initial value")}for(;e?g>=0:h>g;g+=m)g in u&&(c=n(c,u[g],g,d));return c}};e.exports={left:l(!1),right:l(!0)}},83658:function(e,t,n){"use strict";var r=n(19781),i=n(43157),s=TypeError,o=Object.getOwnPropertyDescriptor,a=r&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}();e.exports=a?function(e,t){if(i(e)&&!o(e,"length").writable)throw s("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t}},41589:function(e,t,n){var r=n(51400),i=n(26244),s=n(86135),o=Array,a=Math.max;e.exports=function(e,t,n){for(var l=i(e),c=r(t,l),d=r(void 0===n?l:n,l),u=o(a(d-c,0)),h=0;c<d;c++,h++)s(u,h,e[c]);return u.length=h,u}},50206:function(e,t,n){var r=n(1702);e.exports=r([].slice)},94362:function(e,t,n){var r=n(41589),i=Math.floor,s=function(e,t){var n=e.length,l=i(n/2);return n<8?o(e,t):a(e,s(r(e,0,l),t),s(r(e,l),t),t)},o=function(e,t){for(var n,r,i=e.length,s=1;s<i;){for(r=s,n=e[s];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==s++&&(e[r]=n)}return e},a=function(e,t,n,r){for(var i=t.length,s=n.length,o=0,a=0;o<i||a<s;)e[o+a]=o<i&&a<s?r(t[o],n[a])<=0?t[o++]:n[a++]:o<i?t[o++]:n[a++];return e};e.exports=s},77475:function(e,t,n){var r=n(43157),i=n(4411),s=n(70111),o=n(5112)("species"),a=Array;e.exports=function(e){var t;return r(e)&&(t=e.constructor,(i(t)&&(t===a||r(t.prototype))||s(t)&&null===(t=t[o]))&&(t=void 0)),void 0===t?a:t}},65417:function(e,t,n){var r=n(77475);e.exports=function(e,t){return new(r(e))(0===t?0:t)}},21753:function(e,t,n){var r=n(46916),i=n(35005),s=n(58173);e.exports=function(e,t,n,o){try{var a=s(e,"return");if(a)return i("Promise").resolve(r(a,e)).then((function(){t(n)}),(function(e){o(e)}))}catch(e){return o(e)}t(n)}},45348:function(e,t,n){"use strict";var r=n(46916),i=n(12534),s=n(19670),o=n(70030),a=n(68880),l=n(89190),c=n(5112),d=n(29909),u=n(35005),h=n(58173),g=n(66462),m=n(76178),p=n(99212),f=u("Promise"),v="AsyncIteratorHelper",y="WrapForValidAsyncIterator",b=d.set,C=c("toStringTag"),w=function(e){var t=!e,n=e?y:v,c=d.getterFor(n),u=function(e){var n=i((function(){return c(e)})),r=n.error,s=n.value;return r||t&&s.done?{exit:!0,value:r?f.reject(s):f.resolve(m(void 0,!0))}:{exit:!1,value:s}},b=function(e,n){var r=function(){var r=n();if(t){e.awaiting=r;var i=function(){e.awaiting===r&&(e.awaiting=null)};r.then(i,i)}return r};return e.awaiting?e.awaiting=e.awaiting.then(r,r):r()},w=l(o(g),{next:function(){var e=u(this),t=e.exit,n=e.value;return t?n:b(n,(function(){var e=i((function(){return s(n.nextHandler(f))})),t=e.error,r=e.value;return t&&(n.done=!0),t?f.reject(r):f.resolve(r)}))},return:function(){var t=u(this),n=t.exit,o=t.value;return n?o:b(o,(function(){o.done=!0;var t,n,a=o.iterator,l=i((function(){if(o.inner)try{p(o.inner.iterator,"return")}catch(e){return p(a,"throw",e)}return h(a,"return")}));return t=n=l.value,l.error?f.reject(n):void 0===t?f.resolve(m(void 0,!0)):(n=(l=i((function(){return r(t,a)}))).value,l.error?f.reject(n):e?f.resolve(n):f.resolve(n).then((function(e){return s(e),m(void 0,!0)})))}))}});return t&&a(w,C,"Async Iterator Helper"),w},S=w(!1),D=w(!0);e.exports=function(e,t){var n=t?y:v,r=function(t,r){r?(r.iterator=t.iterator,r.next=t.next):r=t,r.type=n,r.nextHandler=e,r.counter=0,r.done=!1,r.awaiting=null,b(this,r)};return r.prototype=t?D:S,r}},12269:function(e,t,n){"use strict";var r=n(46916),i=n(19662),s=n(19670),o=n(70111),a=n(7207),l=n(35005),c=n(24942),d=n(21753),u=function(e){var t=0==e,n=1==e,u=2==e,h=3==e;return function(e,g,m){var p=c(e),f=l("Promise"),v=p.iterator,y=p.next,b=0,C=void 0!==g;return!C&&t||i(g),new f((function(e,i){var l=function(e){d(v,i,e,i)},c=function(){try{if(C)try{a(b)}catch(e){l(e)}f.resolve(s(r(y,v))).then((function(r){try{if(s(r).done)t?(m.length=b,e(m)):e(!h&&(u||void 0));else{var a=r.value;try{if(C){var p=g(a,b),y=function(r){if(n)c();else if(u)r?c():d(v,e,!1,i);else if(t)try{m[b++]=r,c()}catch(e){l(e)}else r?d(v,e,h||a,i):c()};o(p)?f.resolve(p).then(y,l):y(p)}else m[b++]=a,c()}catch(e){l(e)}}}catch(e){i(e)}}),i)}catch(e){i(e)}};c()}))}};e.exports={toArray:u(0),forEach:u(1),every:u(2),some:u(3),find:u(4)}},66462:function(e,t,n){var r,i,s=n(17854),o=n(5465),a=n(60614),l=n(70030),c=n(79518),d=n(98052),u=n(5112),h=n(31913),g=u("asyncIterator"),m=s.AsyncIterator,p=o.AsyncIteratorPrototype;if(p)r=p;else if(a(m))r=m.prototype;else if(o.USE_FUNCTION_CONSTRUCTOR||s.USE_FUNCTION_CONSTRUCTOR)try{i=c(c(c(Function("return async function*(){}()")()))),c(i)===Object.prototype&&(r=i)}catch(e){}r?h&&(r=l(r)):r={},a(r[g])||d(r,g,(function(){return this})),e.exports=r},14170:function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n={},r=0;r<66;r++)n[t.charAt(r)]=r;e.exports={itoc:t,ctoi:n}},53411:function(e,t,n){var r=n(19670),i=n(99212);e.exports=function(e,t,n,s){try{return s?t(r(n)[0],n[1]):t(n)}catch(t){i(e,"throw",t)}}},17072:function(e,t,n){var r=n(5112)("iterator"),i=!1;try{var s=0,o={next:function(){return{done:!!s++}},return:function(){i=!0}};o[r]=function(){return this},Array.from(o,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var s={};s[r]=function(){return{next:function(){return{done:n=!0}}}},e(s)}catch(e){}return n}},84326:function(e,t,n){var r=n(40084),i=r({}.toString),s=r("".slice);e.exports=function(e){return s(i(e),8,-1)}},70648:function(e,t,n){var r=n(51694),i=n(60614),s=n(84326),o=n(5112)("toStringTag"),a=Object,l="Arguments"==s(function(){return arguments}());e.exports=r?s:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=a(e),o))?n:l?s(t):"Object"==(r=s(t))&&i(t.callee)?"Arguments":r}},95631:function(e,t,n){"use strict";var r=n(3070).f,i=n(70030),s=n(89190),o=n(49974),a=n(25787),l=n(68554),c=n(20408),d=n(51656),u=n(76178),h=n(96340),g=n(19781),m=n(62423).fastKey,p=n(29909),f=p.set,v=p.getterFor;e.exports={getConstructor:function(e,t,n,d){var u=e((function(e,r){a(e,h),f(e,{type:t,index:i(null),first:void 0,last:void 0,size:0}),g||(e.size=0),l(r)||c(r,e[d],{that:e,AS_ENTRIES:n})})),h=u.prototype,p=v(t),y=function(e,t,n){var r,i,s=p(e),o=b(e,t);return o?o.value=n:(s.last=o={index:i=m(t,!0),key:t,value:n,previous:r=s.last,next:void 0,removed:!1},s.first||(s.first=o),r&&(r.next=o),g?s.size++:e.size++,"F"!==i&&(s.index[i]=o)),e},b=function(e,t){var n,r=p(e),i=m(t);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==t)return n};return s(h,{clear:function(){for(var e=p(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,g?e.size=0:this.size=0},delete:function(e){var t=this,n=p(t),r=b(t,e);if(r){var i=r.next,s=r.previous;delete n.index[r.index],r.removed=!0,s&&(s.next=i),i&&(i.previous=s),n.first==r&&(n.first=i),n.last==r&&(n.last=s),g?n.size--:t.size--}return!!r},forEach:function(e){for(var t,n=p(this),r=o(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!b(this,e)}}),s(h,n?{get:function(e){var t=b(this,e);return t&&t.value},set:function(e,t){return y(this,0===e?0:e,t)}}:{add:function(e){return y(this,e=0===e?0:e,e)}}),g&&r(h,"size",{get:function(){return p(this).size}}),u},setStrong:function(e,t,n){var r=t+" Iterator",i=v(t),s=v(r);d(e,t,(function(e,t){f(this,{type:r,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=s(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?u("keys"==t?n.key:"values"==t?n.value:[n.key,n.value],!1):(e.target=void 0,u(void 0,!0))}),n?"entries":"values",!n,!0),h(t)}}},29320:function(e,t,n){"use strict";var r=n(1702),i=n(89190),s=n(62423).getWeakData,o=n(25787),a=n(19670),l=n(68554),c=n(70111),d=n(20408),u=n(42092),h=n(92597),g=n(29909),m=g.set,p=g.getterFor,f=u.find,v=u.findIndex,y=r([].splice),b=0,C=function(e){return e.frozen||(e.frozen=new w)},w=function(){this.entries=[]},S=function(e,t){return f(e.entries,(function(e){return e[0]===t}))};w.prototype={get:function(e){var t=S(this,e);if(t)return t[1]},has:function(e){return!!S(this,e)},set:function(e,t){var n=S(this,e);n?n[1]=t:this.entries.push([e,t])},delete:function(e){var t=v(this.entries,(function(t){return t[0]===e}));return~t&&y(this.entries,t,1),!!~t}},e.exports={getConstructor:function(e,t,n,r){var u=e((function(e,i){o(e,g),m(e,{type:t,id:b++,frozen:void 0}),l(i)||d(i,e[r],{that:e,AS_ENTRIES:n})})),g=u.prototype,f=p(t),v=function(e,t,n){var r=f(e),i=s(a(t),!0);return!0===i?C(r).set(t,n):i[r.id]=n,e};return i(g,{delete:function(e){var t=f(this);if(!c(e))return!1;var n=s(e);return!0===n?C(t).delete(e):n&&h(n,t.id)&&delete n[t.id]},has:function(e){var t=f(this);if(!c(e))return!1;var n=s(e);return!0===n?C(t).has(e):n&&h(n,t.id)}}),i(g,n?{get:function(e){var t=f(this);if(c(e)){var n=s(e);return!0===n?C(t).get(e):n?n[t.id]:void 0}},set:function(e,t){return v(this,e,t)}}:{add:function(e){return v(this,e,!0)}}),u}}},77710:function(e,t,n){"use strict";var r=n(82109),i=n(17854),s=n(1702),o=n(54705),a=n(98052),l=n(62423),c=n(20408),d=n(25787),u=n(60614),h=n(68554),g=n(70111),m=n(47293),p=n(17072),f=n(58003),v=n(79587);e.exports=function(e,t,n){var y=-1!==e.indexOf("Map"),b=-1!==e.indexOf("Weak"),C=y?"set":"add",w=i[e],S=w&&w.prototype,D=w,E={},x=function(e){var t=s(S[e]);a(S,e,"add"==e?function(e){return t(this,0===e?0:e),this}:"delete"==e?function(e){return!(b&&!g(e))&&t(this,0===e?0:e)}:"get"==e?function(e){return b&&!g(e)?void 0:t(this,0===e?0:e)}:"has"==e?function(e){return!(b&&!g(e))&&t(this,0===e?0:e)}:function(e,n){return t(this,0===e?0:e,n),this})};if(o(e,!u(w)||!(b||S.forEach&&!m((function(){(new w).entries().next()})))))D=n.getConstructor(t,e,y,C),l.enable();else if(o(e,!0)){var R=new D,T=R[C](b?{}:-0,1)!=R,M=m((function(){R.has(1)})),k=p((function(e){new w(e)})),I=!b&&m((function(){for(var e=new w,t=5;t--;)e[C](t,t);return!e.has(-0)}));k||((D=t((function(e,t){d(e,S);var n=v(new w,e,D);return h(t)||c(t,n[C],{that:n,AS_ENTRIES:y}),n}))).prototype=S,S.constructor=D),(M||I)&&(x("delete"),x("has"),y&&x("get")),(I||T)&&x(C),b&&S.clear&&delete S.clear}return E[e]=D,r({global:!0,constructor:!0,forced:D!=w},E),f(D,e),b||n.setStrong(D,e,y),D}},99920:function(e,t,n){var r=n(92597),i=n(53887),s=n(31236),o=n(3070);e.exports=function(e,t,n){for(var a=i(t),l=o.f,c=s.f,d=0;d<a.length;d++){var u=a[d];r(e,u)||n&&r(n,u)||l(e,u,c(t,u))}}},84964:function(e,t,n){var r=n(5112)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[r]=!1,"/./"[e](t)}catch(e){}}return!1}},49920:function(e,t,n){var r=n(47293);e.exports=!r((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},14230:function(e,t,n){var r=n(1702),i=n(84488),s=n(41340),o=/"/g,a=r("".replace);e.exports=function(e,t,n,r){var l=s(i(e)),c="<"+t;return""!==n&&(c+=" "+n+'="'+a(s(r),o,"&quot;")+'"'),c+">"+l+"</"+t+">"}},76178:function(e){e.exports=function(e,t){return{value:e,done:t}}},68880:function(e,t,n){var r=n(19781),i=n(3070),s=n(79114);e.exports=r?function(e,t,n){return i.f(e,t,s(1,n))}:function(e,t,n){return e[t]=n,e}},79114:function(e){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},86135:function(e,t,n){"use strict";var r=n(34948),i=n(3070),s=n(79114);e.exports=function(e,t,n){var o=r(t);o in e?i.f(e,o,s(0,n)):e[o]=n}},85573:function(e,t,n){"use strict";var r=n(1702),i=n(47293),s=n(76650).start,o=RangeError,a=isFinite,l=Math.abs,c=Date.prototype,d=c.toISOString,u=r(c.getTime),h=r(c.getUTCDate),g=r(c.getUTCFullYear),m=r(c.getUTCHours),p=r(c.getUTCMilliseconds),f=r(c.getUTCMinutes),v=r(c.getUTCMonth),y=r(c.getUTCSeconds);e.exports=i((function(){return"0385-07-25T07:06:39.999Z"!=d.call(new Date(-50000000000001))}))||!i((function(){d.call(new Date(NaN))}))?function(){if(!a(u(this)))throw o("Invalid time value");var e=this,t=g(e),n=p(e),r=t<0?"-":t>9999?"+":"";return r+s(l(t),r?6:4,0)+"-"+s(v(e)+1,2,0)+"-"+s(h(e),2,0)+"T"+s(m(e),2,0)+":"+s(f(e),2,0)+":"+s(y(e),2,0)+"."+s(n,3,0)+"Z"}:d},38709:function(e,t,n){"use strict";var r=n(19670),i=n(92140),s=TypeError;e.exports=function(e){if(r(this),"string"===e||"default"===e)e="string";else if("number"!==e)throw s("Incorrect hint");return i(this,e)}},47045:function(e,t,n){var r=n(56339),i=n(3070);e.exports=function(e,t,n){return n.get&&r(n.get,t,{getter:!0}),n.set&&r(n.set,t,{setter:!0}),i.f(e,t,n)}},98052:function(e,t,n){var r=n(60614),i=n(3070),s=n(56339),o=n(13072);e.exports=function(e,t,n,a){a||(a={});var l=a.enumerable,c=void 0!==a.name?a.name:t;if(r(n)&&s(n,c,a),a.global)l?e[t]=n:o(t,n);else{try{a.unsafe?e[t]&&(l=!0):delete e[t]}catch(e){}l?e[t]=n:i.f(e,t,{value:n,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return e}},89190:function(e,t,n){var r=n(98052);e.exports=function(e,t,n){for(var i in t)r(e,i,t[i],n);return e}},13072:function(e,t,n){var r=n(17854),i=Object.defineProperty;e.exports=function(e,t){try{i(r,e,{value:t,configurable:!0,writable:!0})}catch(n){r[e]=t}return t}},85117:function(e,t,n){"use strict";var r=n(66330),i=TypeError;e.exports=function(e,t){if(!delete e[t])throw i("Cannot delete property "+r(t)+" of "+r(e))}},19781:function(e,t,n){var r=n(47293);e.exports=!r((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},4154:function(e){var t="object"==typeof document&&document.all,n=void 0===t&&void 0!==t;e.exports={all:t,IS_HTMLDDA:n}},80317:function(e,t,n){var r=n(17854),i=n(70111),s=r.document,o=i(s)&&i(s.createElement);e.exports=function(e){return o?s.createElement(e):{}}},7207:function(e){var t=TypeError;e.exports=function(e){if(e>9007199254740991)throw t("Maximum allowed index exceeded");return e}},93678:function(e){e.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},48324:function(e){e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},98509:function(e,t,n){var r=n(80317)("span").classList,i=r&&r.constructor&&r.constructor.prototype;e.exports=i===Object.prototype?void 0:i},68886:function(e,t,n){var r=n(88113).match(/firefox\/(\d+)/i);e.exports=!!r&&+r[1]},7871:function(e,t,n){var r=n(83823),i=n(35268);e.exports=!r&&!i&&"object"==typeof window&&"object"==typeof document},83823:function(e){e.exports="object"==typeof Deno&&Deno&&"object"==typeof Deno.version},30256:function(e,t,n){var r=n(88113);e.exports=/MSIE|Trident/.test(r)},71528:function(e,t,n){var r=n(88113),i=n(17854);e.exports=/ipad|iphone|ipod/i.test(r)&&void 0!==i.Pebble},6833:function(e,t,n){var r=n(88113);e.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(r)},35268:function(e,t,n){var r=n(84326),i=n(17854);e.exports="process"==r(i.process)},71036:function(e,t,n){var r=n(88113);e.exports=/web0s(?!.*chrome)/i.test(r)},88113:function(e,t,n){var r=n(35005);e.exports=r("navigator","userAgent")||""},7392:function(e,t,n){var r,i,s=n(17854),o=n(88113),a=s.process,l=s.Deno,c=a&&a.versions||l&&l.version,d=c&&c.v8;d&&(i=(r=d.split("."))[0]>0&&r[0]<4?1:+(r[0]+r[1])),!i&&o&&(!(r=o.match(/Edge\/(\d+)/))||r[1]>=74)&&(r=o.match(/Chrome\/(\d+)/))&&(i=+r[1]),e.exports=i},98008:function(e,t,n){var r=n(88113).match(/AppleWebKit\/(\d+)\./);e.exports=!!r&&+r[1]},80748:function(e){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},11060:function(e,t,n){var r=n(1702),i=Error,s=r("".replace),o=String(i("zxcasd").stack),a=/\n\s*at [^:]*:[^\n]*/,l=a.test(o);e.exports=function(e,t){if(l&&"string"==typeof e&&!i.prepareStackTrace)for(;t--;)e=s(e,a,"");return e}},22914:function(e,t,n){var r=n(47293),i=n(79114);e.exports=!r((function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",i(1,7)),7!==e.stack)}))},7762:function(e,t,n){"use strict";var r=n(19781),i=n(47293),s=n(19670),o=n(70030),a=n(56277),l=Error.prototype.toString,c=i((function(){if(r){var e=o(Object.defineProperty({},"name",{get:function(){return this===e}}));if("true"!==l.call(e))return!0}return"2: 1"!==l.call({message:1,name:2})||"Error"!==l.call({})}));e.exports=c?function(){var e=s(this),t=a(e.name,"Error"),n=a(e.message);return t?n?t+": "+n:t:n}:l},82109:function(e,t,n){var r=n(17854),i=n(31236).f,s=n(68880),o=n(98052),a=n(13072),l=n(99920),c=n(54705);e.exports=function(e,t){var n,d,u,h,g,m=e.target,p=e.global,f=e.stat;if(n=p?r:f?r[m]||a(m,{}):(r[m]||{}).prototype)for(d in t){if(h=t[d],u=e.dontCallGetSet?(g=i(n,d))&&g.value:n[d],!c(p?d:m+(f?".":"#")+d,e.forced)&&void 0!==u){if(typeof h==typeof u)continue;l(h,u)}(e.sham||u&&u.sham)&&s(h,"sham",!0),o(n,d,h,e)}}},47293:function(e){e.exports=function(e){try{return!!e()}catch(e){return!0}}},27007:function(e,t,n){"use strict";n(74916);var r=n(1702),i=n(98052),s=n(22261),o=n(47293),a=n(5112),l=n(68880),c=a("species"),d=RegExp.prototype;e.exports=function(e,t,n,u){var h=a(e),g=!o((function(){var t={};return t[h]=function(){return 7},7!=""[e](t)})),m=g&&!o((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[c]=function(){return n},n.flags="",n[h]=/./[h]),n.exec=function(){return t=!0,null},n[h](""),!t}));if(!g||!m||n){var p=r(/./[h]),f=t(h,""[e],(function(e,t,n,i,o){var a=r(e),l=t.exec;return l===s||l===d.exec?g&&!o?{done:!0,value:p(t,n,i)}:{done:!0,value:a(n,t,i)}:{done:!1}}));i(String.prototype,e,f[0]),i(d,h,f[1])}u&&l(d[h],"sham",!0)}},6790:function(e,t,n){"use strict";var r=n(43157),i=n(26244),s=n(7207),o=n(49974),a=function(e,t,n,l,c,d,u,h){for(var g,m,p=c,f=0,v=!!u&&o(u,h);f<l;)f in n&&(g=v?v(n[f],f,t):n[f],d>0&&r(g)?(m=i(g),p=a(e,t,g,m,p,d-1)-1):(s(p+1),e[p]=g),p++),f++;return p};e.exports=a},76677:function(e,t,n){var r=n(47293);e.exports=!r((function(){return Object.isExtensible(Object.preventExtensions({}))}))},22104:function(e,t,n){var r=n(34374),i=Function.prototype,s=i.apply,o=i.call;e.exports="object"==typeof Reflect&&Reflect.apply||(r?o.bind(s):function(){return o.apply(s,arguments)})},49974:function(e,t,n){var r=n(1702),i=n(19662),s=n(34374),o=r(r.bind);e.exports=function(e,t){return i(e),void 0===t?e:s?o(e,t):function(){return e.apply(t,arguments)}}},34374:function(e,t,n){var r=n(47293);e.exports=!r((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))},27065:function(e,t,n){"use strict";var r=n(1702),i=n(19662),s=n(70111),o=n(92597),a=n(50206),l=n(34374),c=Function,d=r([].concat),u=r([].join),h={},g=function(e,t,n){if(!o(h,t)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";h[t]=c("C,a","return new C("+u(r,",")+")")}return h[t](e,n)};e.exports=l?c.bind:function(e){var t=i(this),n=t.prototype,r=a(arguments,1),o=function(){var n=d(r,a(arguments));return this instanceof o?g(t,n.length,n):t.apply(e,n)};return s(n)&&(o.prototype=n),o}},46916:function(e,t,n){var r=n(34374),i=Function.prototype.call;e.exports=r?i.bind(i):function(){return i.apply(i,arguments)}},76530:function(e,t,n){var r=n(19781),i=n(92597),s=Function.prototype,o=r&&Object.getOwnPropertyDescriptor,a=i(s,"name"),l=a&&"something"===function(){}.name,c=a&&(!r||r&&o(s,"name").configurable);e.exports={EXISTS:a,PROPER:l,CONFIGURABLE:c}},40084:function(e,t,n){var r=n(34374),i=Function.prototype,s=i.call,o=r&&i.bind.bind(s,s);e.exports=r?o:function(e){return function(){return s.apply(e,arguments)}}},1702:function(e,t,n){var r=n(84326),i=n(40084);e.exports=function(e){if("Function"===r(e))return i(e)}},35005:function(e,t,n){var r=n(17854),i=n(60614),s=function(e){return i(e)?e:void 0};e.exports=function(e,t){return arguments.length<2?s(r[e]):r[e]&&r[e][t]}},24942:function(e,t,n){var r=n(19662),i=n(19670);e.exports=function(e){return{iterator:e,next:r(i(e).next)}}},71246:function(e,t,n){var r=n(70648),i=n(58173),s=n(68554),o=n(97497),a=n(5112)("iterator");e.exports=function(e){if(!s(e))return i(e,a)||i(e,"@@iterator")||o[r(e)]}},18554:function(e,t,n){var r=n(46916),i=n(19662),s=n(19670),o=n(66330),a=n(71246),l=TypeError;e.exports=function(e,t){var n=arguments.length<2?a(e):t;if(i(n))return s(r(n,e));throw l(o(e)+" is not iterable")}},58173:function(e,t,n){var r=n(19662),i=n(68554);e.exports=function(e,t){var n=e[t];return i(n)?void 0:r(n)}},10647:function(e,t,n){var r=n(1702),i=n(47908),s=Math.floor,o=r("".charAt),a=r("".replace),l=r("".slice),c=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,d=/\$([$&'`]|\d{1,2})/g;e.exports=function(e,t,n,r,u,h){var g=n+e.length,m=r.length,p=d;return void 0!==u&&(u=i(u),p=c),a(h,p,(function(i,a){var c;switch(o(a,0)){case"$":return"$";case"&":return e;case"`":return l(t,0,n);case"'":return l(t,g);case"<":c=u[l(a,1,-1)];break;default:var d=+a;if(0===d)return i;if(d>m){var h=s(d/10);return 0===h?i:h<=m?void 0===r[h-1]?o(a,1):r[h-1]+o(a,1):i}c=r[d-1]}return void 0===c?"":c}))}},17854:function(e,t,n){var r=function(e){return e&&e.Math==Math&&e};e.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof n.g&&n.g)||function(){return this}()||Function("return this")()},92597:function(e,t,n){var r=n(1702),i=n(47908),s=r({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return s(i(e),t)}},3501:function(e){e.exports={}},842:function(e,t,n){var r=n(17854);e.exports=function(e,t){var n=r.console;n&&n.error&&(1==arguments.length?n.error(e):n.error(e,t))}},60490:function(e,t,n){var r=n(35005);e.exports=r("document","documentElement")},64664:function(e,t,n){var r=n(19781),i=n(47293),s=n(80317);e.exports=!r&&!i((function(){return 7!=Object.defineProperty(s("div"),"a",{get:function(){return 7}}).a}))},11179:function(e){var t=Array,n=Math.abs,r=Math.pow,i=Math.floor,s=Math.log,o=Math.LN2;e.exports={pack:function(e,a,l){var c,d,u,h=t(l),g=8*l-a-1,m=(1<<g)-1,p=m>>1,f=23===a?r(2,-24)-r(2,-77):0,v=e<0||0===e&&1/e<0?1:0,y=0;for((e=n(e))!=e||e===1/0?(d=e!=e?1:0,c=m):(c=i(s(e)/o),e*(u=r(2,-c))<1&&(c--,u*=2),(e+=c+p>=1?f/u:f*r(2,1-p))*u>=2&&(c++,u/=2),c+p>=m?(d=0,c=m):c+p>=1?(d=(e*u-1)*r(2,a),c+=p):(d=e*r(2,p-1)*r(2,a),c=0));a>=8;)h[y++]=255&d,d/=256,a-=8;for(c=c<<a|d,g+=a;g>0;)h[y++]=255&c,c/=256,g-=8;return h[--y]|=128*v,h},unpack:function(e,t){var n,i=e.length,s=8*i-t-1,o=(1<<s)-1,a=o>>1,l=s-7,c=i-1,d=e[c--],u=127&d;for(d>>=7;l>0;)u=256*u+e[c--],l-=8;for(n=u&(1<<-l)-1,u>>=-l,l+=t;l>0;)n=256*n+e[c--],l-=8;if(0===u)u=1-a;else{if(u===o)return n?NaN:d?-1/0:1/0;n+=r(2,t),u-=a}return(d?-1:1)*n*r(2,u-t)}}},68361:function(e,t,n){var r=n(1702),i=n(47293),s=n(84326),o=Object,a=r("".split);e.exports=i((function(){return!o("z").propertyIsEnumerable(0)}))?function(e){return"String"==s(e)?a(e,""):o(e)}:o},79587:function(e,t,n){var r=n(60614),i=n(70111),s=n(27674);e.exports=function(e,t,n){var o,a;return s&&r(o=t.constructor)&&o!==n&&i(a=o.prototype)&&a!==n.prototype&&s(e,a),e}},42788:function(e,t,n){var r=n(1702),i=n(60614),s=n(5465),o=r(Function.toString);i(s.inspectSource)||(s.inspectSource=function(e){return o(e)}),e.exports=s.inspectSource},58340:function(e,t,n){var r=n(70111),i=n(68880);e.exports=function(e,t){r(t)&&"cause"in t&&i(e,"cause",t.cause)}},62423:function(e,t,n){var r=n(82109),i=n(1702),s=n(3501),o=n(70111),a=n(92597),l=n(3070).f,c=n(8006),d=n(1156),u=n(52050),h=n(69711),g=n(76677),m=!1,p=h("meta"),f=0,v=function(e){l(e,p,{value:{objectID:"O"+f++,weakData:{}}})},y=e.exports={enable:function(){y.enable=function(){},m=!0;var e=c.f,t=i([].splice),n={};n[p]=1,e(n).length&&(c.f=function(n){for(var r=e(n),i=0,s=r.length;i<s;i++)if(r[i]===p){t(r,i,1);break}return r},r({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:d.f}))},fastKey:function(e,t){if(!o(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!a(e,p)){if(!u(e))return"F";if(!t)return"E";v(e)}return e[p].objectID},getWeakData:function(e,t){if(!a(e,p)){if(!u(e))return!0;if(!t)return!1;v(e)}return e[p].weakData},onFreeze:function(e){return g&&m&&u(e)&&!a(e,p)&&v(e),e}};s[p]=!0},29909:function(e,t,n){var r,i,s,o=n(94811),a=n(17854),l=n(70111),c=n(68880),d=n(92597),u=n(5465),h=n(6200),g=n(3501),m="Object already initialized",p=a.TypeError,f=a.WeakMap;if(o||u.state){var v=u.state||(u.state=new f);v.get=v.get,v.has=v.has,v.set=v.set,r=function(e,t){if(v.has(e))throw p(m);return t.facade=e,v.set(e,t),t},i=function(e){return v.get(e)||{}},s=function(e){return v.has(e)}}else{var y=h("state");g[y]=!0,r=function(e,t){if(d(e,y))throw p(m);return t.facade=e,c(e,y,t),t},i=function(e){return d(e,y)?e[y]:{}},s=function(e){return d(e,y)}}e.exports={set:r,get:i,has:s,enforce:function(e){return s(e)?i(e):r(e,{})},getterFor:function(e){return function(t){var n;if(!l(t)||(n=i(t)).type!==e)throw p("Incompatible receiver, "+e+" required");return n}}}},97659:function(e,t,n){var r=n(5112),i=n(97497),s=r("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||o[s]===e)}},43157:function(e,t,n){var r=n(84326);e.exports=Array.isArray||function(e){return"Array"==r(e)}},44067:function(e,t,n){var r=n(70648),i=n(1702)("".slice);e.exports=function(e){return"Big"===i(r(e),0,3)}},60614:function(e,t,n){var r=n(4154),i=r.all;e.exports=r.IS_HTMLDDA?function(e){return"function"==typeof e||e===i}:function(e){return"function"==typeof e}},4411:function(e,t,n){var r=n(1702),i=n(47293),s=n(60614),o=n(70648),a=n(35005),l=n(42788),c=function(){},d=[],u=a("Reflect","construct"),h=/^\s*(?:class|function)\b/,g=r(h.exec),m=!h.exec(c),p=function(e){if(!s(e))return!1;try{return u(c,d,e),!0}catch(e){return!1}},f=function(e){if(!s(e))return!1;switch(o(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return m||!!g(h,l(e))}catch(e){return!0}};f.sham=!0,e.exports=!u||i((function(){var e;return p(p.call)||!p(Object)||!p((function(){e=!0}))||e}))?f:p},45032:function(e,t,n){var r=n(92597);e.exports=function(e){return void 0!==e&&(r(e,"value")||r(e,"writable"))}},54705:function(e,t,n){var r=n(47293),i=n(60614),s=/#|\.prototype\./,o=function(e,t){var n=l[a(e)];return n==d||n!=c&&(i(t)?r(t):!!t)},a=o.normalize=function(e){return String(e).replace(s,".").toLowerCase()},l=o.data={},c=o.NATIVE="N",d=o.POLYFILL="P";e.exports=o},55988:function(e,t,n){var r=n(70111),i=Math.floor;e.exports=Number.isInteger||function(e){return!r(e)&&isFinite(e)&&i(e)===e}},68554:function(e){e.exports=function(e){return null==e}},70111:function(e,t,n){var r=n(60614),i=n(4154),s=i.all;e.exports=i.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:r(e)||e===s}:function(e){return"object"==typeof e?null!==e:r(e)}},31913:function(e){e.exports=!1},47850:function(e,t,n){var r=n(70111),i=n(84326),s=n(5112)("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[s])?!!t:"RegExp"==i(e))}},52190:function(e,t,n){var r=n(35005),i=n(60614),s=n(47976),o=n(43307),a=Object;e.exports=o?function(e){return"symbol"==typeof e}:function(e){var t=r("Symbol");return i(t)&&s(t.prototype,a(e))}},20408:function(e,t,n){var r=n(49974),i=n(46916),s=n(19670),o=n(66330),a=n(97659),l=n(26244),c=n(47976),d=n(18554),u=n(71246),h=n(99212),g=TypeError,m=function(e,t){this.stopped=e,this.result=t},p=m.prototype;e.exports=function(e,t,n){var f,v,y,b,C,w,S,D=n&&n.that,E=!(!n||!n.AS_ENTRIES),x=!(!n||!n.IS_RECORD),R=!(!n||!n.IS_ITERATOR),T=!(!n||!n.INTERRUPTED),M=r(t,D),k=function(e){return f&&h(f,"normal",e),new m(!0,e)},I=function(e){return E?(s(e),T?M(e[0],e[1],k):M(e[0],e[1])):T?M(e,k):M(e)};if(x)f=e.iterator;else if(R)f=e;else{if(!(v=u(e)))throw g(o(e)+" is not iterable");if(a(v)){for(y=0,b=l(e);b>y;y++)if((C=I(e[y]))&&c(p,C))return C;return new m(!1)}f=d(e,v)}for(w=x?e.next:f.next;!(S=i(w,f)).done;){try{C=I(S.value)}catch(e){h(f,"throw",e)}if("object"==typeof C&&C&&c(p,C))return C}return new m(!1)}},99212:function(e,t,n){var r=n(46916),i=n(19670),s=n(58173);e.exports=function(e,t,n){var o,a;i(e);try{if(!(o=s(e,"return"))){if("throw"===t)throw n;return n}o=r(o,e)}catch(e){a=!0,o=e}if("throw"===t)throw n;if(a)throw o;return i(o),n}},63061:function(e,t,n){"use strict";var r=n(13383).IteratorPrototype,i=n(70030),s=n(79114),o=n(58003),a=n(97497),l=function(){return this};e.exports=function(e,t,n,c){var d=t+" Iterator";return e.prototype=i(r,{next:s(+!c,n)}),o(e,d,!1,!0),a[d]=l,e}},54956:function(e,t,n){"use strict";var r=n(46916),i=n(70030),s=n(68880),o=n(89190),a=n(5112),l=n(29909),c=n(58173),d=n(13383).IteratorPrototype,u=n(76178),h=n(99212),g="IteratorHelper",m="WrapForValidIterator",p=l.set,f=a("toStringTag"),v=function(e){var t=e?m:g,n=l.getterFor(t),a=o(i(d),{next:function(){var t=n(this);if(e)return t.nextHandler();try{var r=t.done?void 0:t.nextHandler();return u(r,t.done)}catch(e){throw t.done=!0,e}},return:function(){var t=n(this),i=t.iterator;if(t.done=!0,e){var s=c(i,"return");return s?r(s,i):u(void 0,!0)}if(t.inner)try{h(t.inner.iterator,"return")}catch(e){return h(i,"throw",e)}return h(i,"return"),u(void 0,!0)}});return e||s(a,f,"Iterator Helper"),a},y=v(!1),b=v(!0);e.exports=function(e,t){var n=t?m:g,r=function(t,r){r?(r.iterator=t.iterator,r.next=t.next):r=t,r.type=n,r.nextHandler=e,r.counter=0,r.done=!1,p(this,r)};return r.prototype=t?b:y,r}},51656:function(e,t,n){"use strict";var r=n(82109),i=n(46916),s=n(31913),o=n(76530),a=n(60614),l=n(63061),c=n(79518),d=n(27674),u=n(58003),h=n(68880),g=n(98052),m=n(5112),p=n(97497),f=n(13383),v=o.PROPER,y=o.CONFIGURABLE,b=f.IteratorPrototype,C=f.BUGGY_SAFARI_ITERATORS,w=m("iterator"),S="keys",D="values",E="entries",x=function(){return this};e.exports=function(e,t,n,o,m,f,R){l(n,t,o);var T,M,k,I=function(e){if(e===m&&P)return P;if(!C&&e in O)return O[e];switch(e){case S:case D:case E:return function(){return new n(this,e)}}return function(){return new n(this)}},A=t+" Iterator",F=!1,O=e.prototype,L=O[w]||O["@@iterator"]||m&&O[m],P=!C&&L||I(m),$="Array"==t&&O.entries||L;if($&&(T=c($.call(new e)))!==Object.prototype&&T.next&&(s||c(T)===b||(d?d(T,b):a(T[w])||g(T,w,x)),u(T,A,!0,!0),s&&(p[A]=x)),v&&m==D&&L&&L.name!==D&&(!s&&y?h(O,"name",D):(F=!0,P=function(){return i(L,this)})),m)if(M={values:I(D),keys:f?P:I(S),entries:I(E)},R)for(k in M)(C||F||!(k in O))&&g(O,k,M[k]);else r({target:t,proto:!0,forced:C||F},M);return s&&!R||O[w]===P||g(O,w,P,{name:m}),p[t]=P,M}},13383:function(e,t,n){"use strict";var r,i,s,o=n(47293),a=n(60614),l=n(70111),c=n(70030),d=n(79518),u=n(98052),h=n(5112),g=n(31913),m=h("iterator"),p=!1;[].keys&&("next"in(s=[].keys())?(i=d(d(s)))!==Object.prototype&&(r=i):p=!0),!l(r)||o((function(){var e={};return r[m].call(e)!==e}))?r={}:g&&(r=c(r)),a(r[m])||u(r,m,(function(){return this})),e.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:p}},97497:function(e){e.exports={}},26244:function(e,t,n){var r=n(17466);e.exports=function(e){return r(e.length)}},56339:function(e,t,n){var r=n(47293),i=n(60614),s=n(92597),o=n(19781),a=n(76530).CONFIGURABLE,l=n(42788),c=n(29909),d=c.enforce,u=c.get,h=Object.defineProperty,g=o&&!r((function(){return 8!==h((function(){}),"length",{value:8}).length})),m=String(String).split("String"),p=e.exports=function(e,t,n){"Symbol("===String(t).slice(0,7)&&(t="["+String(t).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!s(e,"name")||a&&e.name!==t)&&(o?h(e,"name",{value:t,configurable:!0}):e.name=t),g&&n&&s(n,"arity")&&e.length!==n.arity&&h(e,"length",{value:n.arity});try{n&&s(n,"constructor")&&n.constructor?o&&h(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var r=d(e);return s(r,"source")||(r.source=m.join("string"==typeof t?t:"")),e};Function.prototype.toString=p((function(){return i(this)&&u(this).source||l(this)}),"toString")},66736:function(e){var t=Math.expm1,n=Math.exp;e.exports=!t||t(10)>22025.465794806718||t(10)<22025.465794806718||-2e-17!=t(-2e-17)?function(e){var t=+e;return 0==t?t:t>-1e-6&&t<1e-6?t+t*t/2:n(t)-1}:t},26130:function(e,t,n){var r=n(64310),i=Math.abs,s=Math.pow,o=s(2,-52),a=s(2,-23),l=s(2,127)*(2-a),c=s(2,-126);e.exports=Math.fround||function(e){var t,n,s=+e,d=i(s),u=r(s);return d<c?u*function(e){return e+1/o-1/o}(d/c/a)*c*a:(n=(t=(1+a/o)*d)-(t-d))>l||n!=n?u*(1/0):u*n}},20403:function(e){var t=Math.log,n=Math.LOG10E;e.exports=Math.log10||function(e){return t(e)*n}},26513:function(e){var t=Math.log;e.exports=Math.log1p||function(e){var n=+e;return n>-1e-8&&n<1e-8?n-n*n/2:t(1+n)}},64310:function(e){e.exports=Math.sign||function(e){var t=+e;return 0==t||t!=t?t:t<0?-1:1}},74758:function(e){var t=Math.ceil,n=Math.floor;e.exports=Math.trunc||function(e){var r=+e;return(r>0?n:t)(r)}},95948:function(e,t,n){var r,i,s,o,a,l,c,d,u=n(17854),h=n(49974),g=n(31236).f,m=n(20261).set,p=n(6833),f=n(71528),v=n(71036),y=n(35268),b=u.MutationObserver||u.WebKitMutationObserver,C=u.document,w=u.process,S=u.Promise,D=g(u,"queueMicrotask"),E=D&&D.value;E||(r=function(){var e,t;for(y&&(e=w.domain)&&e.exit();i;){t=i.fn,i=i.next;try{t()}catch(e){throw i?o():s=void 0,e}}s=void 0,e&&e.enter()},p||y||v||!b||!C?!f&&S&&S.resolve?((c=S.resolve(void 0)).constructor=S,d=h(c.then,c),o=function(){d(r)}):y?o=function(){w.nextTick(r)}:(m=h(m,u),o=function(){m(r)}):(a=!0,l=C.createTextNode(""),new b(r).observe(l,{characterData:!0}),o=function(){l.data=a=!a})),e.exports=E||function(e){var t={fn:e,next:void 0};s&&(s.next=t),i||(i=t,o()),s=t}},78523:function(e,t,n){"use strict";var r=n(19662),i=TypeError,s=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw i("Bad Promise constructor");t=e,n=r})),this.resolve=r(t),this.reject=r(n)};e.exports.f=function(e){return new s(e)}},56277:function(e,t,n){var r=n(41340);e.exports=function(e,t){return void 0===e?arguments.length<2?"":t:r(e)}},3929:function(e,t,n){var r=n(47850),i=TypeError;e.exports=function(e){if(r(e))throw i("The method doesn't accept regular expressions");return e}},77023:function(e,t,n){var r=n(17854).isFinite;e.exports=Number.isFinite||function(e){return"number"==typeof e&&r(e)}},2814:function(e,t,n){var r=n(17854),i=n(47293),s=n(1702),o=n(41340),a=n(53111).trim,l=n(81361),c=s("".charAt),d=r.parseFloat,u=r.Symbol,h=u&&u.iterator,g=1/d(l+"-0")!=-1/0||h&&!i((function(){d(Object(h))}));e.exports=g?function(e){var t=a(o(e)),n=d(t);return 0===n&&"-"==c(t,0)?-0:n}:d},83009:function(e,t,n){var r=n(17854),i=n(47293),s=n(1702),o=n(41340),a=n(53111).trim,l=n(81361),c=r.parseInt,d=r.Symbol,u=d&&d.iterator,h=/^[+-]?0x/i,g=s(h.exec),m=8!==c(l+"08")||22!==c(l+"0x16")||u&&!i((function(){c(Object(u))}));e.exports=m?function(e,t){var n=a(o(e));return c(n,t>>>0||(g(h,n)?16:10))}:c},21574:function(e,t,n){"use strict";var r=n(19781),i=n(1702),s=n(46916),o=n(47293),a=n(81956),l=n(25181),c=n(55296),d=n(47908),u=n(68361),h=Object.assign,g=Object.defineProperty,m=i([].concat);e.exports=!h||o((function(){if(r&&1!==h({b:1},h(g({},"a",{enumerable:!0,get:function(){g(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol(),i="abcdefghijklmnopqrst";return e[n]=7,i.split("").forEach((function(e){t[e]=e})),7!=h({},e)[n]||a(h({},t)).join("")!=i}))?function(e,t){for(var n=d(e),i=arguments.length,o=1,h=l.f,g=c.f;i>o;)for(var p,f=u(arguments[o++]),v=h?m(a(f),h(f)):a(f),y=v.length,b=0;y>b;)p=v[b++],r&&!s(g,f,p)||(n[p]=f[p]);return n}:h},70030:function(e,t,n){var r,i=n(19670),s=n(36048),o=n(80748),a=n(3501),l=n(60490),c=n(80317),d=n(6200)("IE_PROTO"),u=function(){},h=function(e){return"<script>"+e+"<\/script>"},g=function(e){e.write(h("")),e.close();var t=e.parentWindow.Object;return e=null,t},m=function(){try{r=new ActiveXObject("htmlfile")}catch(e){}var e,t;m="undefined"!=typeof document?document.domain&&r?g(r):((t=c("iframe")).style.display="none",l.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(h("document.F=Object")),e.close(),e.F):g(r);for(var n=o.length;n--;)delete m.prototype[o[n]];return m()};a[d]=!0,e.exports=Object.create||function(e,t){var n;return null!==e?(u.prototype=i(e),n=new u,u.prototype=null,n[d]=e):n=m(),void 0===t?n:s.f(n,t)}},36048:function(e,t,n){var r=n(19781),i=n(3353),s=n(3070),o=n(19670),a=n(45656),l=n(81956);t.f=r&&!i?Object.defineProperties:function(e,t){o(e);for(var n,r=a(t),i=l(t),c=i.length,d=0;c>d;)s.f(e,n=i[d++],r[n]);return e}},3070:function(e,t,n){var r=n(19781),i=n(64664),s=n(3353),o=n(19670),a=n(34948),l=TypeError,c=Object.defineProperty,d=Object.getOwnPropertyDescriptor;t.f=r?s?function(e,t,n){if(o(e),t=a(t),o(n),"function"==typeof e&&"prototype"===t&&"value"in n&&"writable"in n&&!n.writable){var r=d(e,t);r&&r.writable&&(e[t]=n.value,n={configurable:"configurable"in n?n.configurable:r.configurable,enumerable:"enumerable"in n?n.enumerable:r.enumerable,writable:!1})}return c(e,t,n)}:c:function(e,t,n){if(o(e),t=a(t),o(n),i)try{return c(e,t,n)}catch(e){}if("get"in n||"set"in n)throw l("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},31236:function(e,t,n){var r=n(19781),i=n(46916),s=n(55296),o=n(79114),a=n(45656),l=n(34948),c=n(92597),d=n(64664),u=Object.getOwnPropertyDescriptor;t.f=r?u:function(e,t){if(e=a(e),t=l(t),d)try{return u(e,t)}catch(e){}if(c(e,t))return o(!i(s.f,e,t),e[t])}},1156:function(e,t,n){var r=n(84326),i=n(45656),s=n(8006).f,o=n(41589),a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"Window"==r(e)?function(e){try{return s(e)}catch(e){return o(a)}}(e):s(i(e))}},8006:function(e,t,n){var r=n(16324),i=n(80748).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},25181:function(e,t){t.f=Object.getOwnPropertySymbols},79518:function(e,t,n){var r=n(92597),i=n(60614),s=n(47908),o=n(6200),a=n(49920),l=o("IE_PROTO"),c=Object,d=c.prototype;e.exports=a?c.getPrototypeOf:function(e){var t=s(e);if(r(t,l))return t[l];var n=t.constructor;return i(n)&&t instanceof n?n.prototype:t instanceof c?d:null}},52050:function(e,t,n){var r=n(47293),i=n(70111),s=n(84326),o=n(7556),a=Object.isExtensible,l=r((function(){a(1)}));e.exports=l||o?function(e){return!!i(e)&&(!o||"ArrayBuffer"!=s(e))&&(!a||a(e))}:a},47976:function(e,t,n){var r=n(1702);e.exports=r({}.isPrototypeOf)},16324:function(e,t,n){var r=n(1702),i=n(92597),s=n(45656),o=n(41318).indexOf,a=n(3501),l=r([].push);e.exports=function(e,t){var n,r=s(e),c=0,d=[];for(n in r)!i(a,n)&&i(r,n)&&l(d,n);for(;t.length>c;)i(r,n=t[c++])&&(~o(d,n)||l(d,n));return d}},81956:function(e,t,n){var r=n(16324),i=n(80748);e.exports=Object.keys||function(e){return r(e,i)}},55296:function(e,t){"use strict";var n={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,i=r&&!n.call({1:2},1);t.f=i?function(e){var t=r(this,e);return!!t&&t.enumerable}:n},69026:function(e,t,n){"use strict";var r=n(31913),i=n(17854),s=n(47293),o=n(98008);e.exports=r||!s((function(){if(!(o&&o<535)){var e=Math.random();__defineSetter__.call(null,e,(function(){})),delete i[e]}}))},27674:function(e,t,n){var r=n(1702),i=n(19670),s=n(96077);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=r(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return i(n),s(r),t?e(n,r):n.__proto__=r,n}}():void 0)},44699:function(e,t,n){var r=n(19781),i=n(1702),s=n(81956),o=n(45656),a=i(n(55296).f),l=i([].push),c=function(e){return function(t){for(var n,i=o(t),c=s(i),d=c.length,u=0,h=[];d>u;)n=c[u++],r&&!a(i,n)||l(h,e?[n,i[n]]:i[n]);return h}};e.exports={entries:c(!0),values:c(!1)}},90288:function(e,t,n){"use strict";var r=n(51694),i=n(70648);e.exports=r?{}.toString:function(){return"[object "+i(this)+"]"}},92140:function(e,t,n){var r=n(46916),i=n(60614),s=n(70111),o=TypeError;e.exports=function(e,t){var n,a;if("string"===t&&i(n=e.toString)&&!s(a=r(n,e)))return a;if(i(n=e.valueOf)&&!s(a=r(n,e)))return a;if("string"!==t&&i(n=e.toString)&&!s(a=r(n,e)))return a;throw o("Can't convert object to primitive value")}},53887:function(e,t,n){var r=n(35005),i=n(1702),s=n(8006),o=n(25181),a=n(19670),l=i([].concat);e.exports=r("Reflect","ownKeys")||function(e){var t=s.f(a(e)),n=o.f;return n?l(t,n(e)):t}},40857:function(e,t,n){var r=n(17854);e.exports=r},12534:function(e){e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},63702:function(e,t,n){var r=n(17854),i=n(2492),s=n(60614),o=n(54705),a=n(42788),l=n(5112),c=n(7871),d=n(83823),u=n(31913),h=n(7392),g=i&&i.prototype,m=l("species"),p=!1,f=s(r.PromiseRejectionEvent),v=o("Promise",(function(){var e=a(i),t=e!==String(i);if(!t&&66===h)return!0;if(u&&(!g.catch||!g.finally))return!0;if(!h||h<51||!/native code/.test(e)){var n=new i((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};if((n.constructor={})[m]=r,!(p=n.then((function(){}))instanceof r))return!0}return!t&&(c||d)&&!f}));e.exports={CONSTRUCTOR:v,REJECTION_EVENT:f,SUBCLASSING:p}},2492:function(e,t,n){var r=n(17854);e.exports=r.Promise},69478:function(e,t,n){var r=n(19670),i=n(70111),s=n(78523);e.exports=function(e,t){if(r(e),i(t)&&t.constructor===e)return t;var n=s.f(e);return(0,n.resolve)(t),n.promise}},80612:function(e,t,n){var r=n(2492),i=n(17072),s=n(63702).CONSTRUCTOR;e.exports=s||!i((function(e){r.all(e).then(void 0,(function(){}))}))},2626:function(e,t,n){var r=n(3070).f;e.exports=function(e,t,n){n in e||r(e,n,{configurable:!0,get:function(){return t[n]},set:function(e){t[n]=e}})}},18572:function(e){var t=function(){this.head=null,this.tail=null};t.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}},e.exports=t},97651:function(e,t,n){var r=n(46916),i=n(19670),s=n(60614),o=n(84326),a=n(22261),l=TypeError;e.exports=function(e,t){var n=e.exec;if(s(n)){var c=r(n,e,t);return null!==c&&i(c),c}if("RegExp"===o(e))return r(a,e,t);throw l("RegExp#exec called on incompatible receiver")}},22261:function(e,t,n){"use strict";var r,i,s=n(46916),o=n(1702),a=n(41340),l=n(67066),c=n(52999),d=n(72309),u=n(70030),h=n(29909).get,g=n(9441),m=n(38173),p=d("native-string-replace",String.prototype.replace),f=RegExp.prototype.exec,v=f,y=o("".charAt),b=o("".indexOf),C=o("".replace),w=o("".slice),S=(i=/b*/g,s(f,r=/a/,"a"),s(f,i,"a"),0!==r.lastIndex||0!==i.lastIndex),D=c.BROKEN_CARET,E=void 0!==/()??/.exec("")[1];(S||E||D||g||m)&&(v=function(e){var t,n,r,i,o,c,d,g=this,m=h(g),x=a(e),R=m.raw;if(R)return R.lastIndex=g.lastIndex,t=s(v,R,x),g.lastIndex=R.lastIndex,t;var T=m.groups,M=D&&g.sticky,k=s(l,g),I=g.source,A=0,F=x;if(M&&(k=C(k,"y",""),-1===b(k,"g")&&(k+="g"),F=w(x,g.lastIndex),g.lastIndex>0&&(!g.multiline||g.multiline&&"\n"!==y(x,g.lastIndex-1))&&(I="(?: "+I+")",F=" "+F,A++),n=new RegExp("^(?:"+I+")",k)),E&&(n=new RegExp("^"+I+"$(?!\\s)",k)),S&&(r=g.lastIndex),i=s(f,M?n:g,F),M?i?(i.input=w(i.input,A),i[0]=w(i[0],A),i.index=g.lastIndex,g.lastIndex+=i[0].length):g.lastIndex=0:S&&i&&(g.lastIndex=g.global?i.index+i[0].length:r),E&&i&&i.length>1&&s(p,i[0],n,(function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(i[o]=void 0)})),i&&T)for(i.groups=c=u(null),o=0;o<T.length;o++)c[(d=T[o])[0]]=i[d[1]];return i}),e.exports=v},67066:function(e,t,n){"use strict";var r=n(19670);e.exports=function(){var e=r(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}},34706:function(e,t,n){var r=n(46916),i=n(92597),s=n(47976),o=n(67066),a=RegExp.prototype;e.exports=function(e){var t=e.flags;return void 0!==t||"flags"in a||i(e,"flags")||!s(a,e)?t:r(o,e)}},52999:function(e,t,n){var r=n(47293),i=n(17854).RegExp,s=r((function(){var e=i("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),o=s||r((function(){return!i("a","y").sticky})),a=s||r((function(){var e=i("^r","gy");return e.lastIndex=2,null!=e.exec("str")}));e.exports={BROKEN_CARET:a,MISSED_STICKY:o,UNSUPPORTED_Y:s}},9441:function(e,t,n){var r=n(47293),i=n(17854).RegExp;e.exports=r((function(){var e=i(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)}))},38173:function(e,t,n){var r=n(47293),i=n(17854).RegExp;e.exports=r((function(){var e=i("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")}))},84488:function(e,t,n){var r=n(68554),i=TypeError;e.exports=function(e){if(r(e))throw i("Can't call method on "+e);return e}},81150:function(e){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},17152:function(e,t,n){var r=n(17854),i=n(22104),s=n(60614),o=n(88113),a=n(50206),l=n(48053),c=/MSIE .\./.test(o),d=r.Function,u=function(e){return c?function(t,n){var r=l(arguments.length,1)>2,o=s(t)?t:d(t),c=r?a(arguments,2):void 0;return e(r?function(){i(o,this,c)}:o,n)}:e};e.exports={setTimeout:u(r.setTimeout),setInterval:u(r.setInterval)}},96340:function(e,t,n){"use strict";var r=n(35005),i=n(3070),s=n(5112),o=n(19781),a=s("species");e.exports=function(e){var t=r(e),n=i.f;o&&t&&!t[a]&&n(t,a,{configurable:!0,get:function(){return this}})}},58003:function(e,t,n){var r=n(3070).f,i=n(92597),s=n(5112)("toStringTag");e.exports=function(e,t,n){e&&!n&&(e=e.prototype),e&&!i(e,s)&&r(e,s,{configurable:!0,value:t})}},6200:function(e,t,n){var r=n(72309),i=n(69711),s=r("keys");e.exports=function(e){return s[e]||(s[e]=i(e))}},5465:function(e,t,n){var r=n(17854),i=n(13072),s="__core-js_shared__",o=r[s]||i(s,{});e.exports=o},72309:function(e,t,n){var r=n(31913),i=n(5465);(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.26.0",mode:r?"pure":"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.26.0/LICENSE",source:"https://github.com/zloirock/core-js"})},36707:function(e,t,n){var r=n(19670),i=n(39483),s=n(68554),o=n(5112)("species");e.exports=function(e,t){var n,a=r(e).constructor;return void 0===a||s(n=r(a)[o])?t:i(n)}},43429:function(e,t,n){var r=n(47293);e.exports=function(e){return r((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}))}},28710:function(e,t,n){var r=n(1702),i=n(19303),s=n(41340),o=n(84488),a=r("".charAt),l=r("".charCodeAt),c=r("".slice),d=function(e){return function(t,n){var r,d,u=s(o(t)),h=i(n),g=u.length;return h<0||h>=g?e?"":void 0:(r=l(u,h))<55296||r>56319||h+1===g||(d=l(u,h+1))<56320||d>57343?e?a(u,h):r:e?c(u,h,h+2):d-56320+(r-55296<<10)+65536}};e.exports={codeAt:d(!1),charAt:d(!0)}},54986:function(e,t,n){var r=n(88113);e.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(r)},76650:function(e,t,n){var r=n(1702),i=n(17466),s=n(41340),o=n(38415),a=n(84488),l=r(o),c=r("".slice),d=Math.ceil,u=function(e){return function(t,n,r){var o,u,h=s(a(t)),g=i(n),m=h.length,p=void 0===r?" ":s(r);return g<=m||""==p?h:((u=l(p,d((o=g-m)/p.length))).length>o&&(u=c(u,0,o)),e?h+u:u+h)}};e.exports={start:u(!1),end:u(!0)}},33197:function(e,t,n){"use strict";var r=n(1702),i=2147483647,s=/[^\0-\u007E]/,o=/[.\u3002\uFF0E\uFF61]/g,a="Overflow: input needs wider integers to process",l=RangeError,c=r(o.exec),d=Math.floor,u=String.fromCharCode,h=r("".charCodeAt),g=r([].join),m=r([].push),p=r("".replace),f=r("".split),v=r("".toLowerCase),y=function(e){return e+22+75*(e<26)},b=function(e,t,n){var r=0;for(e=n?d(e/700):e>>1,e+=d(e/t);e>455;)e=d(e/35),r+=36;return d(r+36*e/(e+38))},C=function(e){var t=[];e=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=h(e,n++);if(i>=55296&&i<=56319&&n<r){var s=h(e,n++);56320==(64512&s)?m(t,((1023&i)<<10)+(1023&s)+65536):(m(t,i),n--)}else m(t,i)}return t}(e);var n,r,s=e.length,o=128,c=0,p=72;for(n=0;n<e.length;n++)(r=e[n])<128&&m(t,u(r));var f=t.length,v=f;for(f&&m(t,"-");v<s;){var C=i;for(n=0;n<e.length;n++)(r=e[n])>=o&&r<C&&(C=r);var w=v+1;if(C-o>d((i-c)/w))throw l(a);for(c+=(C-o)*w,o=C,n=0;n<e.length;n++){if((r=e[n])<o&&++c>i)throw l(a);if(r==o){for(var S=c,D=36;;){var E=D<=p?1:D>=p+26?26:D-p;if(S<E)break;var x=S-E,R=36-E;m(t,u(y(E+x%R))),S=d(x/R),D+=36}m(t,u(y(S))),p=b(c,w,v==f),c=0,v++}}c++,o++}return g(t,"")};e.exports=function(e){var t,n,r=[],i=f(p(v(e),o,"."),".");for(t=0;t<i.length;t++)n=i[t],m(r,c(s,n)?"xn--"+C(n):n);return g(r,".")}},38415:function(e,t,n){"use strict";var r=n(19303),i=n(41340),s=n(84488),o=RangeError;e.exports=function(e){var t=i(s(this)),n="",a=r(e);if(a<0||a==1/0)throw o("Wrong number of repetitions");for(;a>0;(a>>>=1)&&(t+=t))1&a&&(n+=t);return n}},10365:function(e,t,n){"use strict";var r=n(53111).end,i=n(76091);e.exports=i("trimEnd")?function(){return r(this)}:"".trimEnd},76091:function(e,t,n){var r=n(76530).PROPER,i=n(47293),s=n(81361);e.exports=function(e){return i((function(){return!!s[e]()||"​᠎"!=="​᠎"[e]()||r&&s[e].name!==e}))}},33217:function(e,t,n){"use strict";var r=n(53111).start,i=n(76091);e.exports=i("trimStart")?function(){return r(this)}:"".trimStart},53111:function(e,t,n){var r=n(1702),i=n(84488),s=n(41340),o=n(81361),a=r("".replace),l="["+o+"]",c=RegExp("^"+l+l+"*"),d=RegExp(l+l+"*$"),u=function(e){return function(t){var n=s(i(t));return 1&e&&(n=a(n,c,"")),2&e&&(n=a(n,d,"")),n}};e.exports={start:u(1),end:u(2),trim:u(3)}},36293:function(e,t,n){var r=n(7392),i=n(47293);e.exports=!!Object.getOwnPropertySymbols&&!i((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&r&&r<41}))},56532:function(e,t,n){var r=n(46916),i=n(35005),s=n(5112),o=n(98052);e.exports=function(){var e=i("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,a=s("toPrimitive");t&&!t[a]&&o(t,a,(function(e){return r(n,this)}),{arity:1})}},2015:function(e,t,n){var r=n(36293);e.exports=r&&!!Symbol.for&&!!Symbol.keyFor},20261:function(e,t,n){var r,i,s,o,a=n(17854),l=n(22104),c=n(49974),d=n(60614),u=n(92597),h=n(47293),g=n(60490),m=n(50206),p=n(80317),f=n(48053),v=n(6833),y=n(35268),b=a.setImmediate,C=a.clearImmediate,w=a.process,S=a.Dispatch,D=a.Function,E=a.MessageChannel,x=a.String,R=0,T={};try{r=a.location}catch(e){}var M=function(e){if(u(T,e)){var t=T[e];delete T[e],t()}},k=function(e){return function(){M(e)}},I=function(e){M(e.data)},A=function(e){a.postMessage(x(e),r.protocol+"//"+r.host)};b&&C||(b=function(e){f(arguments.length,1);var t=d(e)?e:D(e),n=m(arguments,1);return T[++R]=function(){l(t,void 0,n)},i(R),R},C=function(e){delete T[e]},y?i=function(e){w.nextTick(k(e))}:S&&S.now?i=function(e){S.now(k(e))}:E&&!v?(o=(s=new E).port2,s.port1.onmessage=I,i=c(o.postMessage,o)):a.addEventListener&&d(a.postMessage)&&!a.importScripts&&r&&"file:"!==r.protocol&&!h(A)?(i=A,a.addEventListener("message",I,!1)):i="onreadystatechange"in p("script")?function(e){g.appendChild(p("script")).onreadystatechange=function(){g.removeChild(this),M(e)}}:function(e){setTimeout(k(e),0)}),e.exports={set:b,clear:C}},50863:function(e,t,n){var r=n(1702);e.exports=r(1..valueOf)},51400:function(e,t,n){var r=n(19303),i=Math.max,s=Math.min;e.exports=function(e,t){var n=r(e);return n<0?i(n+t,0):s(n,t)}},64599:function(e,t,n){var r=n(57593),i=TypeError;e.exports=function(e){var t=r(e,"number");if("number"==typeof t)throw i("Can't convert number to bigint");return BigInt(t)}},57067:function(e,t,n){var r=n(19303),i=n(17466),s=RangeError;e.exports=function(e){if(void 0===e)return 0;var t=r(e),n=i(t);if(t!==n)throw s("Wrong length or index");return n}},45656:function(e,t,n){var r=n(68361),i=n(84488);e.exports=function(e){return r(i(e))}},19303:function(e,t,n){var r=n(74758);e.exports=function(e){var t=+e;return t!=t||0===t?0:r(t)}},17466:function(e,t,n){var r=n(19303),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},47908:function(e,t,n){var r=n(84488),i=Object;e.exports=function(e){return i(r(e))}},84590:function(e,t,n){var r=n(73002),i=RangeError;e.exports=function(e,t){var n=r(e);if(n%t)throw i("Wrong offset");return n}},73002:function(e,t,n){var r=n(19303),i=RangeError;e.exports=function(e){var t=r(e);if(t<0)throw i("The argument can't be less than 0");return t}},57593:function(e,t,n){var r=n(46916),i=n(70111),s=n(52190),o=n(58173),a=n(92140),l=n(5112),c=TypeError,d=l("toPrimitive");e.exports=function(e,t){if(!i(e)||s(e))return e;var n,l=o(e,d);if(l){if(void 0===t&&(t="default"),n=r(l,e,t),!i(n)||s(n))return n;throw c("Can't convert object to primitive value")}return void 0===t&&(t="number"),a(e,t)}},34948:function(e,t,n){var r=n(57593),i=n(52190);e.exports=function(e){var t=r(e,"string");return i(t)?t:t+""}},51694:function(e,t,n){var r={};r[n(5112)("toStringTag")]="z",e.exports="[object z]"===String(r)},41340:function(e,t,n){var r=n(70648),i=String;e.exports=function(e){if("Symbol"===r(e))throw TypeError("Cannot convert a Symbol value to a string");return i(e)}},44038:function(e,t,n){var r=n(35268);e.exports=function(e){try{if(r)return Function('return require("'+e+'")')()}catch(e){}}},66330:function(e){var t=String;e.exports=function(e){try{return t(e)}catch(e){return"Object"}}},19843:function(e,t,n){"use strict";var r=n(82109),i=n(17854),s=n(46916),o=n(19781),a=n(63832),l=n(90260),c=n(13331),d=n(25787),u=n(79114),h=n(68880),g=n(55988),m=n(17466),p=n(57067),f=n(84590),v=n(34948),y=n(92597),b=n(70648),C=n(70111),w=n(52190),S=n(70030),D=n(47976),E=n(27674),x=n(8006).f,R=n(97321),T=n(42092).forEach,M=n(96340),k=n(3070),I=n(31236),A=n(29909),F=n(79587),O=A.get,L=A.set,P=A.enforce,$=k.f,_=I.f,N=Math.round,H=i.RangeError,B=c.ArrayBuffer,j=B.prototype,V=c.DataView,z=l.NATIVE_ARRAY_BUFFER_VIEWS,W=l.TYPED_ARRAY_TAG,U=l.TypedArray,Y=l.TypedArrayPrototype,G=l.aTypedArrayConstructor,q=l.isTypedArray,K="BYTES_PER_ELEMENT",X="Wrong length",Z=function(e,t){G(e);for(var n=0,r=t.length,i=new e(r);r>n;)i[n]=t[n++];return i},J=function(e,t){$(e,t,{get:function(){return O(this)[t]}})},Q=function(e){var t;return D(j,e)||"ArrayBuffer"==(t=b(e))||"SharedArrayBuffer"==t},ee=function(e,t){return q(e)&&!w(t)&&t in e&&g(+t)&&t>=0},te=function(e,t){return t=v(t),ee(e,t)?u(2,e[t]):_(e,t)},ne=function(e,t,n){return t=v(t),!(ee(e,t)&&C(n)&&y(n,"value"))||y(n,"get")||y(n,"set")||n.configurable||y(n,"writable")&&!n.writable||y(n,"enumerable")&&!n.enumerable?$(e,t,n):(e[t]=n.value,e)};o?(z||(I.f=te,k.f=ne,J(Y,"buffer"),J(Y,"byteOffset"),J(Y,"byteLength"),J(Y,"length")),r({target:"Object",stat:!0,forced:!z},{getOwnPropertyDescriptor:te,defineProperty:ne}),e.exports=function(e,t,n){var o=e.match(/\d+$/)[0]/8,l=e+(n?"Clamped":"")+"Array",c="get"+e,u="set"+e,g=i[l],v=g,y=v&&v.prototype,b={},w=function(e,t){$(e,t,{get:function(){return function(e,t){var n=O(e);return n.view[c](t*o+n.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,r){var i=O(e);n&&(r=(r=N(r))<0?0:r>255?255:255&r),i.view[u](t*o+i.byteOffset,r,!0)}(this,t,e)},enumerable:!0})};z?a&&(v=t((function(e,t,n,r){return d(e,y),F(C(t)?Q(t)?void 0!==r?new g(t,f(n,o),r):void 0!==n?new g(t,f(n,o)):new g(t):q(t)?Z(v,t):s(R,v,t):new g(p(t)),e,v)})),E&&E(v,U),T(x(g),(function(e){e in v||h(v,e,g[e])})),v.prototype=y):(v=t((function(e,t,n,r){d(e,y);var i,a,l,c=0,u=0;if(C(t)){if(!Q(t))return q(t)?Z(v,t):s(R,v,t);i=t,u=f(n,o);var h=t.byteLength;if(void 0===r){if(h%o)throw H(X);if((a=h-u)<0)throw H(X)}else if((a=m(r)*o)+u>h)throw H(X);l=a/o}else l=p(t),i=new B(a=l*o);for(L(e,{buffer:i,byteOffset:u,byteLength:a,length:l,view:new V(i)});c<l;)w(e,c++)})),E&&E(v,U),y=v.prototype=S(Y)),y.constructor!==v&&h(y,"constructor",v),P(y).TypedArrayConstructor=v,W&&h(y,W,l);var D=v!=g;b[l]=v,r({global:!0,constructor:!0,forced:D,sham:!z},b),K in v||h(v,K,o),K in y||h(y,K,o),M(l)}):e.exports=function(){}},63832:function(e,t,n){var r=n(17854),i=n(47293),s=n(17072),o=n(90260).NATIVE_ARRAY_BUFFER_VIEWS,a=r.ArrayBuffer,l=r.Int8Array;e.exports=!o||!i((function(){l(1)}))||!i((function(){new l(-1)}))||!s((function(e){new l,new l(null),new l(1.5),new l(e)}),!0)||i((function(){return 1!==new l(new a(2),1,void 0).length}))},43074:function(e,t,n){var r=n(97745),i=n(66304);e.exports=function(e,t){return r(i(e),t)}},97321:function(e,t,n){var r=n(49974),i=n(46916),s=n(39483),o=n(47908),a=n(26244),l=n(18554),c=n(71246),d=n(97659),u=n(44067),h=n(90260).aTypedArrayConstructor,g=n(64599);e.exports=function(e){var t,n,m,p,f,v,y,b,C=s(this),w=o(e),S=arguments.length,D=S>1?arguments[1]:void 0,E=void 0!==D,x=c(w);if(x&&!d(x))for(b=(y=l(w,x)).next,w=[];!(v=i(b,y)).done;)w.push(v.value);for(E&&S>2&&(D=r(D,arguments[2])),n=a(w),m=new(h(C))(n),p=u(m),t=0;n>t;t++)f=E?D(w[t],t):w[t],m[t]=p?g(f):+f;return m}},66304:function(e,t,n){var r=n(90260),i=n(36707),s=r.aTypedArrayConstructor,o=r.getTypedArrayConstructor;e.exports=function(e){return s(i(e,o(e)))}},69711:function(e,t,n){var r=n(1702),i=0,s=Math.random(),o=r(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+o(++i+s,36)}},85143:function(e,t,n){var r=n(47293),i=n(5112),s=n(31913),o=i("iterator");e.exports=!r((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n="";return e.pathname="c%20d",t.forEach((function(e,r){t.delete("b"),n+=r+e})),s&&!e.toJSON||!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[o]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://тест").host||"#%D0%B1"!==new URL("http://a#б").hash||"a1c3"!==n||"x"!==new URL("http://x",void 0).host}))},43307:function(e,t,n){var r=n(36293);e.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},3353:function(e,t,n){var r=n(19781),i=n(47293);e.exports=r&&i((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},48053:function(e){var t=TypeError;e.exports=function(e,n){if(e<n)throw t("Not enough arguments");return e}},94811:function(e,t,n){var r=n(17854),i=n(60614),s=r.WeakMap;e.exports=i(s)&&/native code/.test(String(s))},26800:function(e,t,n){var r=n(40857),i=n(92597),s=n(6061),o=n(3070).f;e.exports=function(e){var t=r.Symbol||(r.Symbol={});i(t,e)||o(t,e,{value:s.f(e)})}},6061:function(e,t,n){var r=n(5112);t.f=r},5112:function(e,t,n){var r=n(17854),i=n(72309),s=n(92597),o=n(69711),a=n(36293),l=n(43307),c=i("wks"),d=r.Symbol,u=d&&d.for,h=l?d:d&&d.withoutSetter||o;e.exports=function(e){if(!s(c,e)||!a&&"string"!=typeof c[e]){var t="Symbol."+e;a&&s(d,e)?c[e]=d[e]:c[e]=l&&u?u(t):h(t)}return c[e]}},81361:function(e){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},89191:function(e,t,n){"use strict";var r=n(35005),i=n(92597),s=n(68880),o=n(47976),a=n(27674),l=n(99920),c=n(2626),d=n(79587),u=n(56277),h=n(58340),g=n(11060),m=n(22914),p=n(19781),f=n(31913);e.exports=function(e,t,n,v){var y="stackTraceLimit",b=v?2:1,C=e.split("."),w=C[C.length-1],S=r.apply(null,C);if(S){var D=S.prototype;if(!f&&i(D,"cause")&&delete D.cause,!n)return S;var E=r("Error"),x=t((function(e,t){var n=u(v?t:e,void 0),r=v?new S(e):new S;return void 0!==n&&s(r,"message",n),m&&s(r,"stack",g(r.stack,2)),this&&o(D,this)&&d(r,this,x),arguments.length>b&&h(r,arguments[b]),r}));if(x.prototype=D,"Error"!==w?a?a(x,E):l(x,E,{name:!0}):p&&y in S&&(c(x,S,y),c(x,S,"prepareStackTrace")),l(x,S),!f)try{D.name!==w&&s(D,"name",w),D.constructor=x}catch(e){}return x}}},32120:function(e,t,n){var r=n(82109),i=n(35005),s=n(22104),o=n(47293),a=n(89191),l="AggregateError",c=i(l),d=!o((function(){return 1!==c([1]).errors[0]}))&&o((function(){return 7!==c([1],l,{cause:7}).cause}));r({global:!0,constructor:!0,arity:2,forced:d},{AggregateError:a(l,(function(e){return function(t,n){return s(e,this,arguments)}}),d,!0)})},56967:function(e,t,n){"use strict";var r=n(82109),i=n(47976),s=n(79518),o=n(27674),a=n(99920),l=n(70030),c=n(68880),d=n(79114),u=n(11060),h=n(58340),g=n(20408),m=n(56277),p=n(5112),f=n(22914),v=p("toStringTag"),y=Error,b=[].push,C=function(e,t){var n,r=arguments.length>2?arguments[2]:void 0,a=i(w,this);o?n=o(y(),a?s(this):w):(n=a?this:l(w),c(n,v,"Error")),void 0!==t&&c(n,"message",m(t)),f&&c(n,"stack",u(n.stack,1)),h(n,r);var d=[];return g(e,b,{that:d}),c(n,"errors",d),n};o?o(C,y):a(C,y,{name:!0});var w=C.prototype=l(y.prototype,{constructor:d(1,C),message:d(1,""),name:d(1,"AggregateError")});r({global:!0,constructor:!0,arity:2},{AggregateError:C})},9170:function(e,t,n){n(56967)},18264:function(e,t,n){"use strict";var r=n(82109),i=n(17854),s=n(13331),o=n(96340),a=s.ArrayBuffer;r({global:!0,constructor:!0,forced:i.ArrayBuffer!==a},{ArrayBuffer:a}),o("ArrayBuffer")},76938:function(e,t,n){var r=n(82109),i=n(90260);r({target:"ArrayBuffer",stat:!0,forced:!i.NATIVE_ARRAY_BUFFER_VIEWS},{isView:i.isView})},39575:function(e,t,n){"use strict";var r=n(82109),i=n(1702),s=n(47293),o=n(13331),a=n(19670),l=n(51400),c=n(17466),d=n(36707),u=o.ArrayBuffer,h=o.DataView,g=h.prototype,m=i(u.prototype.slice),p=i(g.getUint8),f=i(g.setUint8);r({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:s((function(){return!new u(2).slice(1,void 0).byteLength}))},{slice:function(e,t){if(m&&void 0===t)return m(a(this),e);for(var n=a(this).byteLength,r=l(e,n),i=l(void 0===t?n:t,n),s=new(d(this,u))(c(i-r)),o=new h(this),g=new h(s),v=0;r<i;)f(g,v++,p(o,r++));return s}})},52262:function(e,t,n){"use strict";var r=n(82109),i=n(47908),s=n(26244),o=n(19303),a=n(51223);r({target:"Array",proto:!0},{at:function(e){var t=i(this),n=s(t),r=o(e),a=r>=0?r:n+r;return a<0||a>=n?void 0:t[a]}}),a("at")},92222:function(e,t,n){"use strict";var r=n(82109),i=n(47293),s=n(43157),o=n(70111),a=n(47908),l=n(26244),c=n(7207),d=n(86135),u=n(65417),h=n(81194),g=n(5112),m=n(7392),p=g("isConcatSpreadable"),f=m>=51||!i((function(){var e=[];return e[p]=!1,e.concat()[0]!==e})),v=h("concat"),y=function(e){if(!o(e))return!1;var t=e[p];return void 0!==t?!!t:s(e)};r({target:"Array",proto:!0,arity:1,forced:!f||!v},{concat:function(e){var t,n,r,i,s,o=a(this),h=u(o,0),g=0;for(t=-1,r=arguments.length;t<r;t++)if(y(s=-1===t?o:arguments[t]))for(i=l(s),c(g+i),n=0;n<i;n++,g++)n in s&&d(h,g,s[n]);else c(g+1),d(h,g++,s);return h.length=g,h}})},50545:function(e,t,n){var r=n(82109),i=n(1048),s=n(51223);r({target:"Array",proto:!0},{copyWithin:i}),s("copyWithin")},26541:function(e,t,n){"use strict";var r=n(82109),i=n(42092).every;r({target:"Array",proto:!0,forced:!n(9341)("every")},{every:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},43290:function(e,t,n){var r=n(82109),i=n(21285),s=n(51223);r({target:"Array",proto:!0},{fill:i}),s("fill")},57327:function(e,t,n){"use strict";var r=n(82109),i=n(42092).filter;r({target:"Array",proto:!0,forced:!n(81194)("filter")},{filter:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},34553:function(e,t,n){"use strict";var r=n(82109),i=n(42092).findIndex,s=n(51223),o="findIndex",a=!0;o in[]&&Array(1).findIndex((function(){a=!1})),r({target:"Array",proto:!0,forced:a},{findIndex:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),s(o)},77287:function(e,t,n){"use strict";var r=n(82109),i=n(9671).findLastIndex,s=n(51223);r({target:"Array",proto:!0},{findLastIndex:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),s("findLastIndex")},67635:function(e,t,n){"use strict";var r=n(82109),i=n(9671).findLast,s=n(51223);r({target:"Array",proto:!0},{findLast:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),s("findLast")},69826:function(e,t,n){"use strict";var r=n(82109),i=n(42092).find,s=n(51223),o="find",a=!0;o in[]&&Array(1).find((function(){a=!1})),r({target:"Array",proto:!0,forced:a},{find:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),s(o)},86535:function(e,t,n){"use strict";var r=n(82109),i=n(6790),s=n(19662),o=n(47908),a=n(26244),l=n(65417);r({target:"Array",proto:!0},{flatMap:function(e){var t,n=o(this),r=a(n);return s(e),(t=l(n,0)).length=i(t,n,n,r,0,1,e,arguments.length>1?arguments[1]:void 0),t}})},84944:function(e,t,n){"use strict";var r=n(82109),i=n(6790),s=n(47908),o=n(26244),a=n(19303),l=n(65417);r({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=s(this),n=o(t),r=l(t,0);return r.length=i(r,t,t,n,0,void 0===e?1:a(e)),r}})},89554:function(e,t,n){"use strict";var r=n(82109),i=n(18533);r({target:"Array",proto:!0,forced:[].forEach!=i},{forEach:i})},91038:function(e,t,n){var r=n(82109),i=n(48457);r({target:"Array",stat:!0,forced:!n(17072)((function(e){Array.from(e)}))},{from:i})},26699:function(e,t,n){"use strict";var r=n(82109),i=n(41318).includes,s=n(47293),o=n(51223);r({target:"Array",proto:!0,forced:s((function(){return!Array(1).includes()}))},{includes:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),o("includes")},82772:function(e,t,n){"use strict";var r=n(82109),i=n(1702),s=n(41318).indexOf,o=n(9341),a=i([].indexOf),l=!!a&&1/a([1],1,-0)<0,c=o("indexOf");r({target:"Array",proto:!0,forced:l||!c},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return l?a(this,e,t)||0:s(this,e,t)}})},79753:function(e,t,n){n(82109)({target:"Array",stat:!0},{isArray:n(43157)})},66992:function(e,t,n){"use strict";var r=n(45656),i=n(51223),s=n(97497),o=n(29909),a=n(3070).f,l=n(51656),c=n(76178),d=n(31913),u=n(19781),h="Array Iterator",g=o.set,m=o.getterFor(h);e.exports=l(Array,"Array",(function(e,t){g(this,{type:h,target:r(e),index:0,kind:t})}),(function(){var e=m(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,c(void 0,!0)):c("keys"==n?r:"values"==n?t[r]:[r,t[r]],!1)}),"values");var p=s.Arguments=s.Array;if(i("keys"),i("values"),i("entries"),!d&&u&&"values"!==p.name)try{a(p,"name",{value:"values"})}catch(e){}},69600:function(e,t,n){"use strict";var r=n(82109),i=n(1702),s=n(68361),o=n(45656),a=n(9341),l=i([].join),c=s!=Object,d=a("join",",");r({target:"Array",proto:!0,forced:c||!d},{join:function(e){return l(o(this),void 0===e?",":e)}})},94986:function(e,t,n){var r=n(82109),i=n(86583);r({target:"Array",proto:!0,forced:i!==[].lastIndexOf},{lastIndexOf:i})},21249:function(e,t,n){"use strict";var r=n(82109),i=n(42092).map;r({target:"Array",proto:!0,forced:!n(81194)("map")},{map:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},26572:function(e,t,n){"use strict";var r=n(82109),i=n(47293),s=n(4411),o=n(86135),a=Array;r({target:"Array",stat:!0,forced:i((function(){function e(){}return!(a.of.call(e)instanceof e)}))},{of:function(){for(var e=0,t=arguments.length,n=new(s(this)?this:a)(t);t>e;)o(n,e,arguments[e++]);return n.length=t,n}})},57658:function(e,t,n){"use strict";var r=n(82109),i=n(47908),s=n(26244),o=n(83658),a=n(7207),l=n(47293)((function(){return 4294967297!==[].push.call({length:4294967296},1)})),c=!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(e){return e instanceof TypeError}}();r({target:"Array",proto:!0,arity:1,forced:l||c},{push:function(e){var t=i(this),n=s(t),r=arguments.length;a(n+r);for(var l=0;l<r;l++)t[n]=arguments[l],n++;return o(t,n),n}})},96644:function(e,t,n){"use strict";var r=n(82109),i=n(53671).right,s=n(9341),o=n(7392),a=n(35268);r({target:"Array",proto:!0,forced:!s("reduceRight")||!a&&o>79&&o<83},{reduceRight:function(e){return i(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}})},85827:function(e,t,n){"use strict";var r=n(82109),i=n(53671).left,s=n(9341),o=n(7392),a=n(35268);r({target:"Array",proto:!0,forced:!s("reduce")||!a&&o>79&&o<83},{reduce:function(e){var t=arguments.length;return i(this,e,t,t>1?arguments[1]:void 0)}})},65069:function(e,t,n){"use strict";var r=n(82109),i=n(1702),s=n(43157),o=i([].reverse),a=[1,2];r({target:"Array",proto:!0,forced:String(a)===String(a.reverse())},{reverse:function(){return s(this)&&(this.length=this.length),o(this)}})},47042:function(e,t,n){"use strict";var r=n(82109),i=n(43157),s=n(4411),o=n(70111),a=n(51400),l=n(26244),c=n(45656),d=n(86135),u=n(5112),h=n(81194),g=n(50206),m=h("slice"),p=u("species"),f=Array,v=Math.max;r({target:"Array",proto:!0,forced:!m},{slice:function(e,t){var n,r,u,h=c(this),m=l(h),y=a(e,m),b=a(void 0===t?m:t,m);if(i(h)&&(n=h.constructor,(s(n)&&(n===f||i(n.prototype))||o(n)&&null===(n=n[p]))&&(n=void 0),n===f||void 0===n))return g(h,y,b);for(r=new(void 0===n?f:n)(v(b-y,0)),u=0;y<b;y++,u++)y in h&&d(r,u,h[y]);return r.length=u,r}})},5212:function(e,t,n){"use strict";var r=n(82109),i=n(42092).some;r({target:"Array",proto:!0,forced:!n(9341)("some")},{some:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},2707:function(e,t,n){"use strict";var r=n(82109),i=n(1702),s=n(19662),o=n(47908),a=n(26244),l=n(85117),c=n(41340),d=n(47293),u=n(94362),h=n(9341),g=n(68886),m=n(30256),p=n(7392),f=n(98008),v=[],y=i(v.sort),b=i(v.push),C=d((function(){v.sort(void 0)})),w=d((function(){v.sort(null)})),S=h("sort"),D=!d((function(){if(p)return p<70;if(!(g&&g>3)){if(m)return!0;if(f)return f<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)v.push({k:t+r,v:n})}for(v.sort((function(e,t){return t.v-e.v})),r=0;r<v.length;r++)t=v[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));r({target:"Array",proto:!0,forced:C||!w||!S||!D},{sort:function(e){void 0!==e&&s(e);var t=o(this);if(D)return void 0===e?y(t):y(t,e);var n,r,i=[],d=a(t);for(r=0;r<d;r++)r in t&&b(i,t[r]);for(u(i,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:c(t)>c(n)?1:-1}}(e)),n=a(i),r=0;r<n;)t[r]=i[r++];for(;r<d;)l(t,r++);return t}})},38706:function(e,t,n){n(96340)("Array")},40561:function(e,t,n){"use strict";var r=n(82109),i=n(47908),s=n(51400),o=n(19303),a=n(26244),l=n(83658),c=n(7207),d=n(65417),u=n(86135),h=n(85117),g=n(81194)("splice"),m=Math.max,p=Math.min;r({target:"Array",proto:!0,forced:!g},{splice:function(e,t){var n,r,g,f,v,y,b=i(this),C=a(b),w=s(e,C),S=arguments.length;for(0===S?n=r=0:1===S?(n=0,r=C-w):(n=S-2,r=p(m(o(t),0),C-w)),c(C+n-r),g=d(b,r),f=0;f<r;f++)(v=w+f)in b&&u(g,f,b[v]);if(g.length=r,n<r){for(f=w;f<C-r;f++)y=f+n,(v=f+r)in b?b[y]=b[v]:h(b,y);for(f=C;f>C-r+n;f--)h(b,f-1)}else if(n>r)for(f=C-r;f>w;f--)y=f+n-1,(v=f+r-1)in b?b[y]=b[v]:h(b,y);for(f=0;f<n;f++)b[f+w]=arguments[f+2];return l(b,C-r+n),g}})},99244:function(e,t,n){n(51223)("flatMap")},33792:function(e,t,n){n(51223)("flat")},30541:function(e,t,n){"use strict";var r=n(82109),i=n(47908),s=n(26244),o=n(83658),a=n(85117),l=n(7207),c=1!==[].unshift(0),d=!function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(e){return e instanceof TypeError}}();r({target:"Array",proto:!0,arity:1,forced:c||d},{unshift:function(e){var t=i(this),n=s(t),r=arguments.length;if(r){l(n+r);for(var c=n;c--;){var d=c+r;c in t?t[d]=t[c]:a(t,d)}for(var u=0;u<r;u++)t[u]=arguments[u]}return o(t,n+r)}})},3690:function(e,t,n){var r=n(82109),i=n(13331);r({global:!0,constructor:!0,forced:!n(23013)},{DataView:i.DataView})},16716:function(e,t,n){n(3690)},43016:function(e,t,n){"use strict";var r=n(82109),i=n(1702),s=n(47293)((function(){return 120!==new Date(16e11).getYear()})),o=i(Date.prototype.getFullYear);r({target:"Date",proto:!0,forced:s},{getYear:function(){return o(this)-1900}})},3843:function(e,t,n){var r=n(82109),i=n(1702),s=Date,o=i(s.prototype.getTime);r({target:"Date",stat:!0},{now:function(){return o(new s)}})},81801:function(e,t,n){"use strict";var r=n(82109),i=n(1702),s=n(19303),o=Date.prototype,a=i(o.getTime),l=i(o.setFullYear);r({target:"Date",proto:!0},{setYear:function(e){a(this);var t=s(e);return l(this,0<=t&&t<=99?t+1900:t)}})},9550:function(e,t,n){n(82109)({target:"Date",proto:!0},{toGMTString:Date.prototype.toUTCString})},28733:function(e,t,n){var r=n(82109),i=n(85573);r({target:"Date",proto:!0,forced:Date.prototype.toISOString!==i},{toISOString:i})},5735:function(e,t,n){"use strict";var r=n(82109),i=n(47293),s=n(47908),o=n(57593);r({target:"Date",proto:!0,arity:1,forced:i((function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}))},{toJSON:function(e){var t=s(this),n=o(t,"number");return"number"!=typeof n||isFinite(n)?t.toISOString():null}})},96078:function(e,t,n){var r=n(92597),i=n(98052),s=n(38709),o=n(5112)("toPrimitive"),a=Date.prototype;r(a,o)||i(a,o,s)},83710:function(e,t,n){var r=n(1702),i=n(98052),s=Date.prototype,o="Invalid Date",a=r(s.toString),l=r(s.getTime);String(new Date(NaN))!=o&&i(s,"toString",(function(){var e=l(this);return e==e?a(this):o}))},21703:function(e,t,n){var r=n(82109),i=n(17854),s=n(22104),o=n(89191),a=i.WebAssembly,l=7!==Error("e",{cause:7}).cause,c=function(e,t){var n={};n[e]=o(e,t,l),r({global:!0,constructor:!0,arity:1,forced:l},n)},d=function(e,t){if(a&&a[e]){var n={};n[e]=o("WebAssembly."+e,t,l),r({target:"WebAssembly",stat:!0,constructor:!0,arity:1,forced:l},n)}};c("Error",(function(e){return function(t){return s(e,this,arguments)}})),c("EvalError",(function(e){return function(t){return s(e,this,arguments)}})),c("RangeError",(function(e){return function(t){return s(e,this,arguments)}})),c("ReferenceError",(function(e){return function(t){return s(e,this,arguments)}})),c("SyntaxError",(function(e){return function(t){return s(e,this,arguments)}})),c("TypeError",(function(e){return function(t){return s(e,this,arguments)}})),c("URIError",(function(e){return function(t){return s(e,this,arguments)}})),d("CompileError",(function(e){return function(t){return s(e,this,arguments)}})),d("LinkError",(function(e){return function(t){return s(e,this,arguments)}})),d("RuntimeError",(function(e){return function(t){return s(e,this,arguments)}}))},96647:function(e,t,n){var r=n(98052),i=n(7762),s=Error.prototype;s.toString!==i&&r(s,"toString",i)},62130:function(e,t,n){"use strict";var r=n(82109),i=n(1702),s=n(41340),o=i("".charAt),a=i("".charCodeAt),l=i(/./.exec),c=i(1..toString),d=i("".toUpperCase),u=/[\w*+\-./@]/,h=function(e,t){for(var n=c(e,16);n.length<t;)n="0"+n;return n};r({global:!0},{escape:function(e){for(var t,n,r=s(e),i="",c=r.length,g=0;g<c;)t=o(r,g++),l(u,t)?i+=t:i+=(n=a(t,0))<256?"%"+h(n,2):"%u"+d(h(n,4));return i}})},24812:function(e,t,n){var r=n(82109),i=n(27065);r({target:"Function",proto:!0,forced:Function.bind!==i},{bind:i})},4855:function(e,t,n){"use strict";var r=n(60614),i=n(70111),s=n(3070),o=n(79518),a=n(5112),l=n(56339),c=a("hasInstance"),d=Function.prototype;c in d||s.f(d,c,{value:l((function(e){if(!r(this)||!i(e))return!1;var t=this.prototype;if(!i(t))return e instanceof this;for(;e=o(e);)if(t===e)return!0;return!1}),c)})},68309:function(e,t,n){var r=n(19781),i=n(76530).EXISTS,s=n(1702),o=n(3070).f,a=Function.prototype,l=s(a.toString),c=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,d=s(c.exec);r&&!i&&o(a,"name",{configurable:!0,get:function(){try{return d(c,l(this))[1]}catch(e){return""}}})},35837:function(e,t,n){var r=n(82109),i=n(17854);r({global:!0,forced:i.globalThis!==i},{globalThis:i})},38862:function(e,t,n){var r=n(82109),i=n(35005),s=n(22104),o=n(46916),a=n(1702),l=n(47293),c=n(43157),d=n(60614),u=n(70111),h=n(52190),g=n(50206),m=n(36293),p=i("JSON","stringify"),f=a(/./.exec),v=a("".charAt),y=a("".charCodeAt),b=a("".replace),C=a(1..toString),w=/[\uD800-\uDFFF]/g,S=/^[\uD800-\uDBFF]$/,D=/^[\uDC00-\uDFFF]$/,E=!m||l((function(){var e=i("Symbol")();return"[null]"!=p([e])||"{}"!=p({a:e})||"{}"!=p(Object(e))})),x=l((function(){return'"\\udf06\\ud834"'!==p("\udf06\ud834")||'"\\udead"'!==p("\udead")})),R=function(e,t){var n=g(arguments),r=t;if((u(t)||void 0!==e)&&!h(e))return c(t)||(t=function(e,t){if(d(r)&&(t=o(r,this,e,t)),!h(t))return t}),n[1]=t,s(p,null,n)},T=function(e,t,n){var r=v(n,t-1),i=v(n,t+1);return f(S,e)&&!f(D,i)||f(D,e)&&!f(S,r)?"\\u"+C(y(e,0),16):e};p&&r({target:"JSON",stat:!0,arity:3,forced:E||x},{stringify:function(e,t,n){var r=g(arguments),i=s(E?R:p,null,r);return x&&"string"==typeof i?b(i,w,T):i}})},73706:function(e,t,n){var r=n(17854);n(58003)(r.JSON,"JSON",!0)},69098:function(e,t,n){"use strict";n(77710)("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),n(95631))},51532:function(e,t,n){n(69098)},99752:function(e,t,n){var r=n(82109),i=n(26513),s=Math.acosh,o=Math.log,a=Math.sqrt,l=Math.LN2;r({target:"Math",stat:!0,forced:!s||710!=Math.floor(s(Number.MAX_VALUE))||s(1/0)!=1/0},{acosh:function(e){var t=+e;return t<1?NaN:t>94906265.62425156?o(t)+l:i(t-1+a(t-1)*a(t+1))}})},82376:function(e,t,n){var r=n(82109),i=Math.asinh,s=Math.log,o=Math.sqrt;r({target:"Math",stat:!0,forced:!(i&&1/i(0)>0)},{asinh:function e(t){var n=+t;return isFinite(n)&&0!=n?n<0?-e(-n):s(n+o(n*n+1)):n}})},73181:function(e,t,n){var r=n(82109),i=Math.atanh,s=Math.log;r({target:"Math",stat:!0,forced:!(i&&1/i(-0)<0)},{atanh:function(e){var t=+e;return 0==t?t:s((1+t)/(1-t))/2}})},23484:function(e,t,n){var r=n(82109),i=n(64310),s=Math.abs,o=Math.pow;r({target:"Math",stat:!0},{cbrt:function(e){var t=+e;return i(t)*o(s(t),1/3)}})},2388:function(e,t,n){var r=n(82109),i=Math.floor,s=Math.log,o=Math.LOG2E;r({target:"Math",stat:!0},{clz32:function(e){var t=e>>>0;return t?31-i(s(t+.5)*o):32}})},88621:function(e,t,n){var r=n(82109),i=n(66736),s=Math.cosh,o=Math.abs,a=Math.E;r({target:"Math",stat:!0,forced:!s||s(710)===1/0},{cosh:function(e){var t=i(o(e)-1)+1;return(t+1/(t*a*a))*(a/2)}})},60403:function(e,t,n){var r=n(82109),i=n(66736);r({target:"Math",stat:!0,forced:i!=Math.expm1},{expm1:i})},84755:function(e,t,n){n(82109)({target:"Math",stat:!0},{fround:n(26130)})},25438:function(e,t,n){var r=n(82109),i=Math.hypot,s=Math.abs,o=Math.sqrt;r({target:"Math",stat:!0,arity:2,forced:!!i&&i(1/0,NaN)!==1/0},{hypot:function(e,t){for(var n,r,i=0,a=0,l=arguments.length,c=0;a<l;)c<(n=s(arguments[a++]))?(i=i*(r=c/n)*r+1,c=n):i+=n>0?(r=n/c)*r:n;return c===1/0?1/0:c*o(i)}})},90332:function(e,t,n){var r=n(82109),i=n(47293),s=Math.imul;r({target:"Math",stat:!0,forced:i((function(){return-5!=s(4294967295,5)||2!=s.length}))},{imul:function(e,t){var n=65535,r=+e,i=+t,s=n&r,o=n&i;return 0|s*o+((n&r>>>16)*o+s*(n&i>>>16)<<16>>>0)}})},40658:function(e,t,n){n(82109)({target:"Math",stat:!0},{log10:n(20403)})},40197:function(e,t,n){n(82109)({target:"Math",stat:!0},{log1p:n(26513)})},44914:function(e,t,n){var r=n(82109),i=Math.log,s=Math.LN2;r({target:"Math",stat:!0},{log2:function(e){return i(e)/s}})},52420:function(e,t,n){n(82109)({target:"Math",stat:!0},{sign:n(64310)})},60160:function(e,t,n){var r=n(82109),i=n(47293),s=n(66736),o=Math.abs,a=Math.exp,l=Math.E;r({target:"Math",stat:!0,forced:i((function(){return-2e-17!=Math.sinh(-2e-17)}))},{sinh:function(e){var t=+e;return o(t)<1?(s(t)-s(-t))/2:(a(t-1)-a(-t-1))*(l/2)}})},60970:function(e,t,n){var r=n(82109),i=n(66736),s=Math.exp;r({target:"Math",stat:!0},{tanh:function(e){var t=+e,n=i(t),r=i(-t);return n==1/0?1:r==1/0?-1:(n-r)/(s(t)+s(-t))}})},10408:function(e,t,n){n(58003)(Math,"Math",!0)},73689:function(e,t,n){n(82109)({target:"Math",stat:!0},{trunc:n(74758)})},9653:function(e,t,n){"use strict";var r=n(19781),i=n(17854),s=n(1702),o=n(54705),a=n(98052),l=n(92597),c=n(79587),d=n(47976),u=n(52190),h=n(57593),g=n(47293),m=n(8006).f,p=n(31236).f,f=n(3070).f,v=n(50863),y=n(53111).trim,b="Number",C=i.Number,w=C.prototype,S=i.TypeError,D=s("".slice),E=s("".charCodeAt),x=function(e){var t=h(e,"number");return"bigint"==typeof t?t:R(t)},R=function(e){var t,n,r,i,s,o,a,l,c=h(e,"number");if(u(c))throw S("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=y(c),43===(t=E(c,0))||45===t){if(88===(n=E(c,2))||120===n)return NaN}else if(48===t){switch(E(c,1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+c}for(o=(s=D(c,2)).length,a=0;a<o;a++)if((l=E(s,a))<48||l>i)return NaN;return parseInt(s,r)}return+c};if(o(b,!C(" 0o1")||!C("0b1")||C("+0x1"))){for(var T,M=function(e){var t=arguments.length<1?0:C(x(e)),n=this;return d(w,n)&&g((function(){v(n)}))?c(Object(t),n,M):t},k=r?m(C):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),I=0;k.length>I;I++)l(C,T=k[I])&&!l(M,T)&&f(M,T,p(C,T));M.prototype=w,w.constructor=M,a(i,b,M,{constructor:!0})}},93299:function(e,t,n){n(82109)({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{EPSILON:Math.pow(2,-52)})},35192:function(e,t,n){n(82109)({target:"Number",stat:!0},{isFinite:n(77023)})},33161:function(e,t,n){n(82109)({target:"Number",stat:!0},{isInteger:n(55988)})},44048:function(e,t,n){n(82109)({target:"Number",stat:!0},{isNaN:function(e){return e!=e}})},78285:function(e,t,n){var r=n(82109),i=n(55988),s=Math.abs;r({target:"Number",stat:!0},{isSafeInteger:function(e){return i(e)&&s(e)<=9007199254740991}})},44363:function(e,t,n){n(82109)({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{MAX_SAFE_INTEGER:9007199254740991})},55994:function(e,t,n){n(82109)({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{MIN_SAFE_INTEGER:-9007199254740991})},61874:function(e,t,n){var r=n(82109),i=n(2814);r({target:"Number",stat:!0,forced:Number.parseFloat!=i},{parseFloat:i})},9494:function(e,t,n){var r=n(82109),i=n(83009);r({target:"Number",stat:!0,forced:Number.parseInt!=i},{parseInt:i})},31354:function(e,t,n){"use strict";var r=n(82109),i=n(1702),s=n(19303),o=n(50863),a=n(38415),l=n(20403),c=n(47293),d=RangeError,u=String,h=isFinite,g=Math.abs,m=Math.floor,p=Math.pow,f=Math.round,v=i(1..toExponential),y=i(a),b=i("".slice),C="-6.9000e-11"===v(-69e-12,4)&&"1.25e+0"===v(1.255,2)&&"1.235e+4"===v(12345,3)&&"3e+1"===v(25,0),w=c((function(){v(1,1/0)}))&&c((function(){v(1,-1/0)})),S=!c((function(){v(1/0,1/0)}))&&!c((function(){v(NaN,1/0)}));r({target:"Number",proto:!0,forced:!C||!w||!S},{toExponential:function(e){var t=o(this);if(void 0===e)return v(t);var n=s(e);if(!h(t))return String(t);if(n<0||n>20)throw d("Incorrect fraction digits");if(C)return v(t,n);var r="",i="",a=0,c="",w="";if(t<0&&(r="-",t=-t),0===t)a=0,i=y("0",n+1);else{var S=l(t);a=m(S);var D=0,E=p(10,a-n);2*t>=(2*(D=f(t/E))+1)*E&&(D+=1),D>=p(10,n+1)&&(D/=10,a+=1),i=u(D)}return 0!==n&&(i=b(i,0,1)+"."+b(i,1)),0===a?(c="+",w="0"):(c=a>0?"+":"-",w=u(g(a))),r+(i+"e")+c+w}})},56977:function(e,t,n){"use strict";var r=n(82109),i=n(1702),s=n(19303),o=n(50863),a=n(38415),l=n(47293),c=RangeError,d=String,u=Math.floor,h=i(a),g=i("".slice),m=i(1..toFixed),p=function(e,t,n){return 0===t?n:t%2==1?p(e,t-1,n*e):p(e*e,t/2,n)},f=function(e,t,n){for(var r=-1,i=n;++r<6;)i+=t*e[r],e[r]=i%1e7,i=u(i/1e7)},v=function(e,t){for(var n=6,r=0;--n>=0;)r+=e[n],e[n]=u(r/t),r=r%t*1e7},y=function(e){for(var t=6,n="";--t>=0;)if(""!==n||0===t||0!==e[t]){var r=d(e[t]);n=""===n?r:n+h("0",7-r.length)+r}return n};r({target:"Number",proto:!0,forced:l((function(){return"0.000"!==m(8e-5,3)||"1"!==m(.9,0)||"1.25"!==m(1.255,2)||"1000000000000000128"!==m(0xde0b6b3a7640080,0)}))||!l((function(){m({})}))},{toFixed:function(e){var t,n,r,i,a=o(this),l=s(e),u=[0,0,0,0,0,0],m="",b="0";if(l<0||l>20)throw c("Incorrect fraction digits");if(a!=a)return"NaN";if(a<=-1e21||a>=1e21)return d(a);if(a<0&&(m="-",a=-a),a>1e-21)if(n=(t=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}(a*p(2,69,1))-69)<0?a*p(2,-t,1):a/p(2,t,1),n*=4503599627370496,(t=52-t)>0){for(f(u,0,n),r=l;r>=7;)f(u,1e7,0),r-=7;for(f(u,p(10,r,1),0),r=t-1;r>=23;)v(u,1<<23),r-=23;v(u,1<<r),f(u,1,1),v(u,2),b=y(u)}else f(u,0,n),f(u,1<<-t,0),b=y(u)+h("0",l);return l>0?m+((i=b.length)<=l?"0."+h("0",l-i)+b:g(b,0,i-l)+"."+g(b,i-l)):m+b}})},55147:function(e,t,n){"use strict";var r=n(82109),i=n(1702),s=n(47293),o=n(50863),a=i(1..toPrecision);r({target:"Number",proto:!0,forced:s((function(){return"1"!==a(1,void 0)}))||!s((function(){a({})}))},{toPrecision:function(e){return void 0===e?a(o(this)):a(o(this),e)}})},19601:function(e,t,n){var r=n(82109),i=n(21574);r({target:"Object",stat:!0,arity:2,forced:Object.assign!==i},{assign:i})},78011:function(e,t,n){n(82109)({target:"Object",stat:!0,sham:!n(19781)},{create:n(70030)})},59595:function(e,t,n){"use strict";var r=n(82109),i=n(19781),s=n(69026),o=n(19662),a=n(47908),l=n(3070);i&&r({target:"Object",proto:!0,forced:s},{__defineGetter__:function(e,t){l.f(a(this),e,{get:o(t),enumerable:!0,configurable:!0})}})},33321:function(e,t,n){var r=n(82109),i=n(19781),s=n(36048).f;r({target:"Object",stat:!0,forced:Object.defineProperties!==s,sham:!i},{defineProperties:s})},69070:function(e,t,n){var r=n(82109),i=n(19781),s=n(3070).f;r({target:"Object",stat:!0,forced:Object.defineProperty!==s,sham:!i},{defineProperty:s})},35500:function(e,t,n){"use strict";var r=n(82109),i=n(19781),s=n(69026),o=n(19662),a=n(47908),l=n(3070);i&&r({target:"Object",proto:!0,forced:s},{__defineSetter__:function(e,t){l.f(a(this),e,{set:o(t),enumerable:!0,configurable:!0})}})},69720:function(e,t,n){var r=n(82109),i=n(44699).entries;r({target:"Object",stat:!0},{entries:function(e){return i(e)}})},43371:function(e,t,n){var r=n(82109),i=n(76677),s=n(47293),o=n(70111),a=n(62423).onFreeze,l=Object.freeze;r({target:"Object",stat:!0,forced:s((function(){l(1)})),sham:!i},{freeze:function(e){return l&&o(e)?l(a(e)):e}})},38559:function(e,t,n){var r=n(82109),i=n(20408),s=n(86135);r({target:"Object",stat:!0},{fromEntries:function(e){var t={};return i(e,(function(e,n){s(t,e,n)}),{AS_ENTRIES:!0}),t}})},38880:function(e,t,n){var r=n(82109),i=n(47293),s=n(45656),o=n(31236).f,a=n(19781),l=i((function(){o(1)}));r({target:"Object",stat:!0,forced:!a||l,sham:!a},{getOwnPropertyDescriptor:function(e,t){return o(s(e),t)}})},49337:function(e,t,n){var r=n(82109),i=n(19781),s=n(53887),o=n(45656),a=n(31236),l=n(86135);r({target:"Object",stat:!0,sham:!i},{getOwnPropertyDescriptors:function(e){for(var t,n,r=o(e),i=a.f,c=s(r),d={},u=0;c.length>u;)void 0!==(n=i(r,t=c[u++]))&&l(d,t,n);return d}})},36210:function(e,t,n){var r=n(82109),i=n(47293),s=n(1156).f;r({target:"Object",stat:!0,forced:i((function(){return!Object.getOwnPropertyNames(1)}))},{getOwnPropertyNames:s})},29660:function(e,t,n){var r=n(82109),i=n(36293),s=n(47293),o=n(25181),a=n(47908);r({target:"Object",stat:!0,forced:!i||s((function(){o.f(1)}))},{getOwnPropertySymbols:function(e){var t=o.f;return t?t(a(e)):[]}})},30489:function(e,t,n){var r=n(82109),i=n(47293),s=n(47908),o=n(79518),a=n(49920);r({target:"Object",stat:!0,forced:i((function(){o(1)})),sham:!a},{getPrototypeOf:function(e){return o(s(e))}})},46314:function(e,t,n){n(82109)({target:"Object",stat:!0},{hasOwn:n(92597)})},41825:function(e,t,n){var r=n(82109),i=n(52050);r({target:"Object",stat:!0,forced:Object.isExtensible!==i},{isExtensible:i})},98410:function(e,t,n){var r=n(82109),i=n(47293),s=n(70111),o=n(84326),a=n(7556),l=Object.isFrozen;r({target:"Object",stat:!0,forced:i((function(){l(1)}))||a},{isFrozen:function(e){return!s(e)||!(!a||"ArrayBuffer"!=o(e))||!!l&&l(e)}})},72200:function(e,t,n){var r=n(82109),i=n(47293),s=n(70111),o=n(84326),a=n(7556),l=Object.isSealed;r({target:"Object",stat:!0,forced:i((function(){l(1)}))||a},{isSealed:function(e){return!s(e)||!(!a||"ArrayBuffer"!=o(e))||!!l&&l(e)}})},43304:function(e,t,n){n(82109)({target:"Object",stat:!0},{is:n(81150)})},47941:function(e,t,n){var r=n(82109),i=n(47908),s=n(81956);r({target:"Object",stat:!0,forced:n(47293)((function(){s(1)}))},{keys:function(e){return s(i(e))}})},94869:function(e,t,n){"use strict";var r=n(82109),i=n(19781),s=n(69026),o=n(47908),a=n(34948),l=n(79518),c=n(31236).f;i&&r({target:"Object",proto:!0,forced:s},{__lookupGetter__:function(e){var t,n=o(this),r=a(e);do{if(t=c(n,r))return t.get}while(n=l(n))}})},33952:function(e,t,n){"use strict";var r=n(82109),i=n(19781),s=n(69026),o=n(47908),a=n(34948),l=n(79518),c=n(31236).f;i&&r({target:"Object",proto:!0,forced:s},{__lookupSetter__:function(e){var t,n=o(this),r=a(e);do{if(t=c(n,r))return t.set}while(n=l(n))}})},57227:function(e,t,n){var r=n(82109),i=n(70111),s=n(62423).onFreeze,o=n(76677),a=n(47293),l=Object.preventExtensions;r({target:"Object",stat:!0,forced:a((function(){l(1)})),sham:!o},{preventExtensions:function(e){return l&&i(e)?l(s(e)):e}})},67987:function(e,t,n){"use strict";var r=n(19781),i=n(47045),s=n(70111),o=n(47908),a=n(84488),l=Object.getPrototypeOf,c=Object.setPrototypeOf,d=Object.prototype,u="__proto__";if(r&&l&&c&&!(u in d))try{i(d,u,{configurable:!0,get:function(){return l(o(this))},set:function(e){var t=a(this);(s(e)||null===e)&&s(t)&&c(t,e)}})}catch(e){}},60514:function(e,t,n){var r=n(82109),i=n(70111),s=n(62423).onFreeze,o=n(76677),a=n(47293),l=Object.seal;r({target:"Object",stat:!0,forced:a((function(){l(1)})),sham:!o},{seal:function(e){return l&&i(e)?l(s(e)):e}})},68304:function(e,t,n){n(82109)({target:"Object",stat:!0},{setPrototypeOf:n(27674)})},41539:function(e,t,n){var r=n(51694),i=n(98052),s=n(90288);r||i(Object.prototype,"toString",s,{unsafe:!0})},26833:function(e,t,n){var r=n(82109),i=n(44699).values;r({target:"Object",stat:!0},{values:function(e){return i(e)}})},54678:function(e,t,n){var r=n(82109),i=n(2814);r({global:!0,forced:parseFloat!=i},{parseFloat:i})},91058:function(e,t,n){var r=n(82109),i=n(83009);r({global:!0,forced:parseInt!=i},{parseInt:i})},17922:function(e,t,n){"use strict";var r=n(82109),i=n(46916),s=n(19662),o=n(78523),a=n(12534),l=n(20408);r({target:"Promise",stat:!0},{allSettled:function(e){var t=this,n=o.f(t),r=n.resolve,c=n.reject,d=a((function(){var n=s(t.resolve),o=[],a=0,c=1;l(e,(function(e){var s=a++,l=!1;c++,i(n,t,e).then((function(e){l||(l=!0,o[s]={status:"fulfilled",value:e},--c||r(o))}),(function(e){l||(l=!0,o[s]={status:"rejected",reason:e},--c||r(o))}))})),--c||r(o)}));return d.error&&c(d.value),n.promise}})},70821:function(e,t,n){"use strict";var r=n(82109),i=n(46916),s=n(19662),o=n(78523),a=n(12534),l=n(20408);r({target:"Promise",stat:!0,forced:n(80612)},{all:function(e){var t=this,n=o.f(t),r=n.resolve,c=n.reject,d=a((function(){var n=s(t.resolve),o=[],a=0,d=1;l(e,(function(e){var s=a++,l=!1;d++,i(n,t,e).then((function(e){l||(l=!0,o[s]=e,--d||r(o))}),c)})),--d||r(o)}));return d.error&&c(d.value),n.promise}})},34668:function(e,t,n){"use strict";var r=n(82109),i=n(46916),s=n(19662),o=n(35005),a=n(78523),l=n(12534),c=n(20408),d="No one promise resolved";r({target:"Promise",stat:!0},{any:function(e){var t=this,n=o("AggregateError"),r=a.f(t),u=r.resolve,h=r.reject,g=l((function(){var r=s(t.resolve),o=[],a=0,l=1,g=!1;c(e,(function(e){var s=a++,c=!1;l++,i(r,t,e).then((function(e){c||g||(g=!0,u(e))}),(function(e){c||g||(c=!0,o[s]=e,--l||h(new n(o,d)))}))})),--l||h(new n(o,d))}));return g.error&&h(g.value),r.promise}})},94164:function(e,t,n){"use strict";var r=n(82109),i=n(31913),s=n(63702).CONSTRUCTOR,o=n(2492),a=n(35005),l=n(60614),c=n(98052),d=o&&o.prototype;if(r({target:"Promise",proto:!0,forced:s,real:!0},{catch:function(e){return this.then(void 0,e)}}),!i&&l(o)){var u=a("Promise").prototype.catch;d.catch!==u&&c(d,"catch",u,{unsafe:!0})}},43401:function(e,t,n){"use strict";var r,i,s,o=n(82109),a=n(31913),l=n(35268),c=n(17854),d=n(46916),u=n(98052),h=n(27674),g=n(58003),m=n(96340),p=n(19662),f=n(60614),v=n(70111),y=n(25787),b=n(36707),C=n(20261).set,w=n(95948),S=n(842),D=n(12534),E=n(18572),x=n(29909),R=n(2492),T=n(63702),M=n(78523),k="Promise",I=T.CONSTRUCTOR,A=T.REJECTION_EVENT,F=T.SUBCLASSING,O=x.getterFor(k),L=x.set,P=R&&R.prototype,$=R,_=P,N=c.TypeError,H=c.document,B=c.process,j=M.f,V=j,z=!!(H&&H.createEvent&&c.dispatchEvent),W="unhandledrejection",U=function(e){var t;return!(!v(e)||!f(t=e.then))&&t},Y=function(e,t){var n,r,i,s=t.value,o=1==t.state,a=o?e.ok:e.fail,l=e.resolve,c=e.reject,u=e.domain;try{a?(o||(2===t.rejection&&Z(t),t.rejection=1),!0===a?n=s:(u&&u.enter(),n=a(s),u&&(u.exit(),i=!0)),n===e.promise?c(N("Promise-chain cycle")):(r=U(n))?d(r,n,l,c):l(n)):c(s)}catch(e){u&&!i&&u.exit(),c(e)}},G=function(e,t){e.notified||(e.notified=!0,w((function(){for(var n,r=e.reactions;n=r.get();)Y(n,e);e.notified=!1,t&&!e.rejection&&K(e)})))},q=function(e,t,n){var r,i;z?((r=H.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),c.dispatchEvent(r)):r={promise:t,reason:n},!A&&(i=c["on"+e])?i(r):e===W&&S("Unhandled promise rejection",n)},K=function(e){d(C,c,(function(){var t,n=e.facade,r=e.value;if(X(e)&&(t=D((function(){l?B.emit("unhandledRejection",r,n):q(W,n,r)})),e.rejection=l||X(e)?2:1,t.error))throw t.value}))},X=function(e){return 1!==e.rejection&&!e.parent},Z=function(e){d(C,c,(function(){var t=e.facade;l?B.emit("rejectionHandled",t):q("rejectionhandled",t,e.value)}))},J=function(e,t,n){return function(r){e(t,r,n)}},Q=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,G(e,!0))},ee=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw N("Promise can't be resolved itself");var r=U(t);r?w((function(){var n={done:!1};try{d(r,t,J(ee,n,e),J(Q,n,e))}catch(t){Q(n,t,e)}})):(e.value=t,e.state=1,G(e,!1))}catch(t){Q({done:!1},t,e)}}};if(I&&(_=($=function(e){y(this,_),p(e),d(r,this);var t=O(this);try{e(J(ee,t),J(Q,t))}catch(e){Q(t,e)}}).prototype,(r=function(e){L(this,{type:k,done:!1,notified:!1,parent:!1,reactions:new E,rejection:!1,state:0,value:void 0})}).prototype=u(_,"then",(function(e,t){var n=O(this),r=j(b(this,$));return n.parent=!0,r.ok=!f(e)||e,r.fail=f(t)&&t,r.domain=l?B.domain:void 0,0==n.state?n.reactions.add(r):w((function(){Y(r,n)})),r.promise})),i=function(){var e=new r,t=O(e);this.promise=e,this.resolve=J(ee,t),this.reject=J(Q,t)},M.f=j=function(e){return e===$||void 0===e?new i(e):V(e)},!a&&f(R)&&P!==Object.prototype)){s=P.then,F||u(P,"then",(function(e,t){var n=this;return new $((function(e,t){d(s,n,e,t)})).then(e,t)}),{unsafe:!0});try{delete P.constructor}catch(e){}h&&h(P,_)}o({global:!0,constructor:!0,wrap:!0,forced:I},{Promise:$}),g($,k,!1,!0),m(k)},17727:function(e,t,n){"use strict";var r=n(82109),i=n(31913),s=n(2492),o=n(47293),a=n(35005),l=n(60614),c=n(36707),d=n(69478),u=n(98052),h=s&&s.prototype;if(r({target:"Promise",proto:!0,real:!0,forced:!!s&&o((function(){h.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=c(this,a("Promise")),n=l(e);return this.then(n?function(n){return d(t,e()).then((function(){return n}))}:e,n?function(n){return d(t,e()).then((function(){throw n}))}:e)}}),!i&&l(s)){var g=a("Promise").prototype.finally;h.finally!==g&&u(h,"finally",g,{unsafe:!0})}},88674:function(e,t,n){n(43401),n(70821),n(94164),n(6027),n(60683),n(96294)},6027:function(e,t,n){"use strict";var r=n(82109),i=n(46916),s=n(19662),o=n(78523),a=n(12534),l=n(20408);r({target:"Promise",stat:!0,forced:n(80612)},{race:function(e){var t=this,n=o.f(t),r=n.reject,c=a((function(){var o=s(t.resolve);l(e,(function(e){i(o,t,e).then(n.resolve,r)}))}));return c.error&&r(c.value),n.promise}})},60683:function(e,t,n){"use strict";var r=n(82109),i=n(46916),s=n(78523);r({target:"Promise",stat:!0,forced:n(63702).CONSTRUCTOR},{reject:function(e){var t=s.f(this);return i(t.reject,void 0,e),t.promise}})},96294:function(e,t,n){"use strict";var r=n(82109),i=n(35005),s=n(31913),o=n(2492),a=n(63702).CONSTRUCTOR,l=n(69478),c=i("Promise"),d=s&&!a;r({target:"Promise",stat:!0,forced:s||a},{resolve:function(e){return l(d&&this===c?o:this,e)}})},36535:function(e,t,n){var r=n(82109),i=n(22104),s=n(19662),o=n(19670);r({target:"Reflect",stat:!0,forced:!n(47293)((function(){Reflect.apply((function(){}))}))},{apply:function(e,t,n){return i(s(e),t,o(n))}})},12419:function(e,t,n){var r=n(82109),i=n(35005),s=n(22104),o=n(27065),a=n(39483),l=n(19670),c=n(70111),d=n(70030),u=n(47293),h=i("Reflect","construct"),g=Object.prototype,m=[].push,p=u((function(){function e(){}return!(h((function(){}),[],e)instanceof e)})),f=!u((function(){h((function(){}))})),v=p||f;r({target:"Reflect",stat:!0,forced:v,sham:v},{construct:function(e,t){a(e),l(t);var n=arguments.length<3?e:a(arguments[2]);if(f&&!p)return h(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return s(m,r,t),new(s(o,e,r))}var i=n.prototype,u=d(c(i)?i:g),v=s(e,u,t);return c(v)?v:u}})},69596:function(e,t,n){var r=n(82109),i=n(19781),s=n(19670),o=n(34948),a=n(3070);r({target:"Reflect",stat:!0,forced:n(47293)((function(){Reflect.defineProperty(a.f({},1,{value:1}),1,{value:2})})),sham:!i},{defineProperty:function(e,t,n){s(e);var r=o(t);s(n);try{return a.f(e,r,n),!0}catch(e){return!1}}})},52586:function(e,t,n){var r=n(82109),i=n(19670),s=n(31236).f;r({target:"Reflect",stat:!0},{deleteProperty:function(e,t){var n=s(i(e),t);return!(n&&!n.configurable)&&delete e[t]}})},95683:function(e,t,n){var r=n(82109),i=n(19781),s=n(19670),o=n(31236);r({target:"Reflect",stat:!0,sham:!i},{getOwnPropertyDescriptor:function(e,t){return o.f(s(e),t)}})},39361:function(e,t,n){var r=n(82109),i=n(19670),s=n(79518);r({target:"Reflect",stat:!0,sham:!n(49920)},{getPrototypeOf:function(e){return s(i(e))}})},74819:function(e,t,n){var r=n(82109),i=n(46916),s=n(70111),o=n(19670),a=n(45032),l=n(31236),c=n(79518);r({target:"Reflect",stat:!0},{get:function e(t,n){var r,d,u=arguments.length<3?t:arguments[2];return o(t)===u?t[n]:(r=l.f(t,n))?a(r)?r.value:void 0===r.get?void 0:i(r.get,u):s(d=c(t))?e(d,n,u):void 0}})},51037:function(e,t,n){n(82109)({target:"Reflect",stat:!0},{has:function(e,t){return t in e}})},5898:function(e,t,n){var r=n(82109),i=n(19670),s=n(52050);r({target:"Reflect",stat:!0},{isExtensible:function(e){return i(e),s(e)}})},67556:function(e,t,n){n(82109)({target:"Reflect",stat:!0},{ownKeys:n(53887)})},14361:function(e,t,n){var r=n(82109),i=n(35005),s=n(19670);r({target:"Reflect",stat:!0,sham:!n(76677)},{preventExtensions:function(e){s(e);try{var t=i("Object","preventExtensions");return t&&t(e),!0}catch(e){return!1}}})},39532:function(e,t,n){var r=n(82109),i=n(19670),s=n(96077),o=n(27674);o&&r({target:"Reflect",stat:!0},{setPrototypeOf:function(e,t){i(e),s(t);try{return o(e,t),!0}catch(e){return!1}}})},83593:function(e,t,n){var r=n(82109),i=n(46916),s=n(19670),o=n(70111),a=n(45032),l=n(47293),c=n(3070),d=n(31236),u=n(79518),h=n(79114);r({target:"Reflect",stat:!0,forced:l((function(){var e=function(){},t=c.f(new e,"a",{configurable:!0});return!1!==Reflect.set(e.prototype,"a",1,t)}))},{set:function e(t,n,r){var l,g,m,p=arguments.length<4?t:arguments[3],f=d.f(s(t),n);if(!f){if(o(g=u(t)))return e(g,n,r,p);f=h(0)}if(a(f)){if(!1===f.writable||!o(p))return!1;if(l=d.f(p,n)){if(l.get||l.set||!1===l.writable)return!1;l.value=r,c.f(p,n,l)}else c.f(p,n,h(0,r))}else{if(void 0===(m=f.set))return!1;i(m,p,r)}return!0}})},81299:function(e,t,n){var r=n(82109),i=n(17854),s=n(58003);r({global:!0},{Reflect:{}}),s(i.Reflect,"Reflect",!0)},24603:function(e,t,n){var r=n(19781),i=n(17854),s=n(1702),o=n(54705),a=n(79587),l=n(68880),c=n(8006).f,d=n(47976),u=n(47850),h=n(41340),g=n(34706),m=n(52999),p=n(2626),f=n(98052),v=n(47293),y=n(92597),b=n(29909).enforce,C=n(96340),w=n(5112),S=n(9441),D=n(38173),E=w("match"),x=i.RegExp,R=x.prototype,T=i.SyntaxError,M=s(R.exec),k=s("".charAt),I=s("".replace),A=s("".indexOf),F=s("".slice),O=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,L=/a/g,P=/a/g,$=new x(L)!==L,_=m.MISSED_STICKY,N=m.UNSUPPORTED_Y;if(o("RegExp",r&&(!$||_||S||D||v((function(){return P[E]=!1,x(L)!=L||x(P)==P||"/a/i"!=x(L,"i")}))))){for(var H=function(e,t){var n,r,i,s,o,c,m=d(R,this),p=u(e),f=void 0===t,v=[],C=e;if(!m&&p&&f&&e.constructor===H)return e;if((p||d(R,e))&&(e=e.source,f&&(t=g(C))),e=void 0===e?"":h(e),t=void 0===t?"":h(t),C=e,S&&"dotAll"in L&&(r=!!t&&A(t,"s")>-1)&&(t=I(t,/s/g,"")),n=t,_&&"sticky"in L&&(i=!!t&&A(t,"y")>-1)&&N&&(t=I(t,/y/g,"")),D&&(s=function(e){for(var t,n=e.length,r=0,i="",s=[],o={},a=!1,l=!1,c=0,d="";r<=n;r++){if("\\"===(t=k(e,r)))t+=k(e,++r);else if("]"===t)a=!1;else if(!a)switch(!0){case"["===t:a=!0;break;case"("===t:M(O,F(e,r+1))&&(r+=2,l=!0),i+=t,c++;continue;case">"===t&&l:if(""===d||y(o,d))throw new T("Invalid capture group name");o[d]=!0,s[s.length]=[d,c],l=!1,d="";continue}l?d+=t:i+=t}return[i,s]}(e),e=s[0],v=s[1]),o=a(x(e,t),m?this:R,H),(r||i||v.length)&&(c=b(o),r&&(c.dotAll=!0,c.raw=H(function(e){for(var t,n=e.length,r=0,i="",s=!1;r<=n;r++)"\\"!==(t=k(e,r))?s||"."!==t?("["===t?s=!0:"]"===t&&(s=!1),i+=t):i+="[\\s\\S]":i+=t+k(e,++r);return i}(e),n)),i&&(c.sticky=!0),v.length&&(c.groups=v)),e!==C)try{l(o,"source",""===C?"(?:)":C)}catch(e){}return o},B=c(x),j=0;B.length>j;)p(H,x,B[j++]);R.constructor=H,H.prototype=R,f(i,"RegExp",H,{constructor:!0})}C("RegExp")},28450:function(e,t,n){var r=n(19781),i=n(9441),s=n(84326),o=n(47045),a=n(29909).get,l=RegExp.prototype,c=TypeError;r&&i&&o(l,"dotAll",{configurable:!0,get:function(){if(this!==l){if("RegExp"===s(this))return!!a(this).dotAll;throw c("Incompatible receiver, RegExp required")}}})},74916:function(e,t,n){"use strict";var r=n(82109),i=n(22261);r({target:"RegExp",proto:!0,forced:/./.exec!==i},{exec:i})},92087:function(e,t,n){var r=n(17854),i=n(19781),s=n(47045),o=n(67066),a=n(47293),l=r.RegExp,c=l.prototype;i&&a((function(){var e=!0;try{l(".","d")}catch(t){e=!1}var t={},n="",r=e?"dgimsy":"gimsy",i=function(e,r){Object.defineProperty(t,e,{get:function(){return n+=r,!0}})},s={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var o in e&&(s.hasIndices="d"),s)i(o,s[o]);return Object.getOwnPropertyDescriptor(c,"flags").get.call(t)!==r||n!==r}))&&s(c,"flags",{configurable:!0,get:o})},88386:function(e,t,n){var r=n(19781),i=n(52999).MISSED_STICKY,s=n(84326),o=n(47045),a=n(29909).get,l=RegExp.prototype,c=TypeError;r&&i&&o(l,"sticky",{configurable:!0,get:function(){if(this!==l){if("RegExp"===s(this))return!!a(this).sticky;throw c("Incompatible receiver, RegExp required")}}})},77601:function(e,t,n){"use strict";n(74916);var r,i,s=n(82109),o=n(46916),a=n(60614),l=n(19670),c=n(41340),d=(r=!1,(i=/[ac]/).exec=function(){return r=!0,/./.exec.apply(this,arguments)},!0===i.test("abc")&&r),u=/./.test;s({target:"RegExp",proto:!0,forced:!d},{test:function(e){var t=l(this),n=c(e),r=t.exec;if(!a(r))return o(u,t,n);var i=o(r,t,n);return null!==i&&(l(i),!0)}})},39714:function(e,t,n){"use strict";var r=n(76530).PROPER,i=n(98052),s=n(19670),o=n(41340),a=n(47293),l=n(34706),c="toString",d=RegExp.prototype.toString,u=a((function(){return"/a/b"!=d.call({source:"a",flags:"b"})})),h=r&&d.name!=c;(u||h)&&i(RegExp.prototype,c,(function(){var e=s(this);return"/"+o(e.source)+"/"+o(l(e))}),{unsafe:!0})},37227:function(e,t,n){"use strict";n(77710)("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),n(95631))},70189:function(e,t,n){n(37227)},15218:function(e,t,n){"use strict";var r=n(82109),i=n(14230);r({target:"String",proto:!0,forced:n(43429)("anchor")},{anchor:function(e){return i(this,"a","name",e)}})},24506:function(e,t,n){"use strict";var r=n(82109),i=n(1702),s=n(84488),o=n(19303),a=n(41340),l=n(47293),c=i("".charAt);r({target:"String",proto:!0,forced:l((function(){return"\ud842"!=="𠮷".at(-2)}))},{at:function(e){var t=a(s(this)),n=t.length,r=o(e),i=r>=0?r:n+r;return i<0||i>=n?void 0:c(t,i)}})},74475:function(e,t,n){"use strict";var r=n(82109),i=n(14230);r({target:"String",proto:!0,forced:n(43429)("big")},{big:function(){return i(this,"big","","")}})},57929:function(e,t,n){"use strict";var r=n(82109),i=n(14230);r({target:"String",proto:!0,forced:n(43429)("blink")},{blink:function(){return i(this,"blink","","")}})},50915:function(e,t,n){"use strict";var r=n(82109),i=n(14230);r({target:"String",proto:!0,forced:n(43429)("bold")},{bold:function(){return i(this,"b","","")}})},79841:function(e,t,n){"use strict";var r=n(82109),i=n(28710).codeAt;r({target:"String",proto:!0},{codePointAt:function(e){return i(this,e)}})},27852:function(e,t,n){"use strict";var r,i=n(82109),s=n(1702),o=n(31236).f,a=n(17466),l=n(41340),c=n(3929),d=n(84488),u=n(84964),h=n(31913),g=s("".endsWith),m=s("".slice),p=Math.min,f=u("endsWith");i({target:"String",proto:!0,forced:!(!h&&!f&&(r=o(String.prototype,"endsWith"),r&&!r.writable)||f)},{endsWith:function(e){var t=l(d(this));c(e);var n=arguments.length>1?arguments[1]:void 0,r=t.length,i=void 0===n?r:p(a(n),r),s=l(e);return g?g(t,s,i):m(t,i-s.length,i)===s}})},29253:function(e,t,n){"use strict";var r=n(82109),i=n(14230);r({target:"String",proto:!0,forced:n(43429)("fixed")},{fixed:function(){return i(this,"tt","","")}})},42125:function(e,t,n){"use strict";var r=n(82109),i=n(14230);r({target:"String",proto:!0,forced:n(43429)("fontcolor")},{fontcolor:function(e){return i(this,"font","color",e)}})},78830:function(e,t,n){"use strict";var r=n(82109),i=n(14230);r({target:"String",proto:!0,forced:n(43429)("fontsize")},{fontsize:function(e){return i(this,"font","size",e)}})},94953:function(e,t,n){var r=n(82109),i=n(1702),s=n(51400),o=RangeError,a=String.fromCharCode,l=String.fromCodePoint,c=i([].join);r({target:"String",stat:!0,arity:1,forced:!!l&&1!=l.length},{fromCodePoint:function(e){for(var t,n=[],r=arguments.length,i=0;r>i;){if(t=+arguments[i++],s(t,1114111)!==t)throw o(t+" is not a valid code point");n[i]=t<65536?a(t):a(55296+((t-=65536)>>10),t%1024+56320)}return c(n,"")}})},32023:function(e,t,n){"use strict";var r=n(82109),i=n(1702),s=n(3929),o=n(84488),a=n(41340),l=n(84964),c=i("".indexOf);r({target:"String",proto:!0,forced:!l("includes")},{includes:function(e){return!!~c(a(o(this)),a(s(e)),arguments.length>1?arguments[1]:void 0)}})},58734:function(e,t,n){"use strict";var r=n(82109),i=n(14230);r({target:"String",proto:!0,forced:n(43429)("italics")},{italics:function(){return i(this,"i","","")}})},78783:function(e,t,n){"use strict";var r=n(28710).charAt,i=n(41340),s=n(29909),o=n(51656),a=n(76178),l="String Iterator",c=s.set,d=s.getterFor(l);o(String,"String",(function(e){c(this,{type:l,string:i(e),index:0})}),(function(){var e,t=d(this),n=t.string,i=t.index;return i>=n.length?a(void 0,!0):(e=r(n,i),t.index+=e.length,a(e,!1))}))},29254:function(e,t,n){"use strict";var r=n(82109),i=n(14230);r({target:"String",proto:!0,forced:n(43429)("link")},{link:function(e){return i(this,"a","href",e)}})},76373:function(e,t,n){"use strict";var r=n(82109),i=n(46916),s=n(1702),o=n(63061),a=n(76178),l=n(84488),c=n(17466),d=n(41340),u=n(19670),h=n(68554),g=n(84326),m=n(47850),p=n(34706),f=n(58173),v=n(98052),y=n(47293),b=n(5112),C=n(36707),w=n(31530),S=n(97651),D=n(29909),E=n(31913),x=b("matchAll"),R="RegExp String Iterator",T=D.set,M=D.getterFor(R),k=RegExp.prototype,I=TypeError,A=s("".indexOf),F=s("".matchAll),O=!!F&&!y((function(){F("a",/./)})),L=o((function(e,t,n,r){T(this,{type:R,regexp:e,string:t,global:n,unicode:r,done:!1})}),"RegExp String",(function(){var e=M(this);if(e.done)return a(void 0,!0);var t=e.regexp,n=e.string,r=S(t,n);return null===r?(e.done=!0,a(void 0,!0)):e.global?(""===d(r[0])&&(t.lastIndex=w(n,c(t.lastIndex),e.unicode)),a(r,!1)):(e.done=!0,a(r,!1))})),P=function(e){var t,n,r,i=u(this),s=d(e),o=C(i,RegExp),a=d(p(i));return t=new o(o===RegExp?i.source:i,a),n=!!~A(a,"g"),r=!!~A(a,"u"),t.lastIndex=c(i.lastIndex),new L(t,s,n,r)};r({target:"String",proto:!0,forced:O},{matchAll:function(e){var t,n,r,s,o=l(this);if(h(e)){if(O)return F(o,e)}else{if(m(e)&&(t=d(l(p(e))),!~A(t,"g")))throw I("`.matchAll` does not allow non-global regexes");if(O)return F(o,e);if(void 0===(r=f(e,x))&&E&&"RegExp"==g(e)&&(r=P),r)return i(r,e,o)}return n=d(o),s=new RegExp(e,"g"),E?i(P,s,n):s[x](n)}}),E||x in k||v(k,x,P)},4723:function(e,t,n){"use strict";var r=n(46916),i=n(27007),s=n(19670),o=n(68554),a=n(17466),l=n(41340),c=n(84488),d=n(58173),u=n(31530),h=n(97651);i("match",(function(e,t,n){return[function(t){var n=c(this),i=o(t)?void 0:d(t,e);return i?r(i,t,n):new RegExp(t)[e](l(n))},function(e){var r=s(this),i=l(e),o=n(t,r,i);if(o.done)return o.value;if(!r.global)return h(r,i);var c=r.unicode;r.lastIndex=0;for(var d,g=[],m=0;null!==(d=h(r,i));){var p=l(d[0]);g[m]=p,""===p&&(r.lastIndex=u(i,a(r.lastIndex),c)),m++}return 0===m?null:g}]}))},66528:function(e,t,n){"use strict";var r=n(82109),i=n(76650).end;r({target:"String",proto:!0,forced:n(54986)},{padEnd:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},83112:function(e,t,n){"use strict";var r=n(82109),i=n(76650).start;r({target:"String",proto:!0,forced:n(54986)},{padStart:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},38992:function(e,t,n){var r=n(82109),i=n(1702),s=n(45656),o=n(47908),a=n(41340),l=n(26244),c=i([].push),d=i([].join);r({target:"String",stat:!0},{raw:function(e){for(var t=s(o(e).raw),n=l(t),r=arguments.length,i=[],u=0;n>u;){if(c(i,a(t[u++])),u===n)return d(i,"");u<r&&c(i,a(arguments[u]))}}})},82481:function(e,t,n){n(82109)({target:"String",proto:!0},{repeat:n(38415)})},68757:function(e,t,n){"use strict";var r=n(82109),i=n(46916),s=n(1702),o=n(84488),a=n(60614),l=n(68554),c=n(47850),d=n(41340),u=n(58173),h=n(34706),g=n(10647),m=n(5112),p=n(31913),f=m("replace"),v=TypeError,y=s("".indexOf),b=s("".replace),C=s("".slice),w=Math.max,S=function(e,t,n){return n>e.length?-1:""===t?n:y(e,t,n)};r({target:"String",proto:!0},{replaceAll:function(e,t){var n,r,s,m,D,E,x,R,T,M=o(this),k=0,I=0,A="";if(!l(e)){if((n=c(e))&&(r=d(o(h(e))),!~y(r,"g")))throw v("`.replaceAll` does not allow non-global regexes");if(s=u(e,f))return i(s,e,M,t);if(p&&n)return b(d(M),e,t)}for(m=d(M),D=d(e),(E=a(t))||(t=d(t)),x=D.length,R=w(1,x),k=S(m,D,0);-1!==k;)T=E?d(t(D,k,m)):g(D,m,k,[],void 0,t),A+=C(m,I,k)+T,I=k+x,k=S(m,D,k+R);return I<m.length&&(A+=C(m,I)),A}})},15306:function(e,t,n){"use strict";var r=n(22104),i=n(46916),s=n(1702),o=n(27007),a=n(47293),l=n(19670),c=n(60614),d=n(68554),u=n(19303),h=n(17466),g=n(41340),m=n(84488),p=n(31530),f=n(58173),v=n(10647),y=n(97651),b=n(5112)("replace"),C=Math.max,w=Math.min,S=s([].concat),D=s([].push),E=s("".indexOf),x=s("".slice),R="$0"==="a".replace(/./,"$0"),T=!!/./[b]&&""===/./[b]("a","$0");o("replace",(function(e,t,n){var s=T?"$":"$0";return[function(e,n){var r=m(this),s=d(e)?void 0:f(e,b);return s?i(s,e,r,n):i(t,g(r),e,n)},function(e,i){var o=l(this),a=g(e);if("string"==typeof i&&-1===E(i,s)&&-1===E(i,"$<")){var d=n(t,o,a,i);if(d.done)return d.value}var m=c(i);m||(i=g(i));var f=o.global;if(f){var b=o.unicode;o.lastIndex=0}for(var R=[];;){var T=y(o,a);if(null===T)break;if(D(R,T),!f)break;""===g(T[0])&&(o.lastIndex=p(a,h(o.lastIndex),b))}for(var M,k="",I=0,A=0;A<R.length;A++){for(var F=g((T=R[A])[0]),O=C(w(u(T.index),a.length),0),L=[],P=1;P<T.length;P++)D(L,void 0===(M=T[P])?M:String(M));var $=T.groups;if(m){var _=S([F],L,O,a);void 0!==$&&D(_,$);var N=g(r(i,void 0,_))}else N=v(F,a,O,L,$,i);O>=I&&(k+=x(a,I,O)+N,I=O+F.length)}return k+x(a,I)}]}),!!a((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}))||!R||T)},64765:function(e,t,n){"use strict";var r=n(46916),i=n(27007),s=n(19670),o=n(68554),a=n(84488),l=n(81150),c=n(41340),d=n(58173),u=n(97651);i("search",(function(e,t,n){return[function(t){var n=a(this),i=o(t)?void 0:d(t,e);return i?r(i,t,n):new RegExp(t)[e](c(n))},function(e){var r=s(this),i=c(e),o=n(t,r,i);if(o.done)return o.value;var a=r.lastIndex;l(a,0)||(r.lastIndex=0);var d=u(r,i);return l(r.lastIndex,a)||(r.lastIndex=a),null===d?-1:d.index}]}))},37268:function(e,t,n){"use strict";var r=n(82109),i=n(14230);r({target:"String",proto:!0,forced:n(43429)("small")},{small:function(){return i(this,"small","","")}})},23123:function(e,t,n){"use strict";var r=n(22104),i=n(46916),s=n(1702),o=n(27007),a=n(19670),l=n(68554),c=n(47850),d=n(84488),u=n(36707),h=n(31530),g=n(17466),m=n(41340),p=n(58173),f=n(41589),v=n(97651),y=n(22261),b=n(52999),C=n(47293),w=b.UNSUPPORTED_Y,S=4294967295,D=Math.min,E=[].push,x=s(/./.exec),R=s(E),T=s("".slice),M=!C((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]}));o("split",(function(e,t,n){var s;return s="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,n){var s=m(d(this)),o=void 0===n?S:n>>>0;if(0===o)return[];if(void 0===e)return[s];if(!c(e))return i(t,s,e,o);for(var a,l,u,h=[],g=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),p=0,v=new RegExp(e.source,g+"g");(a=i(y,v,s))&&!((l=v.lastIndex)>p&&(R(h,T(s,p,a.index)),a.length>1&&a.index<s.length&&r(E,h,f(a,1)),u=a[0].length,p=l,h.length>=o));)v.lastIndex===a.index&&v.lastIndex++;return p===s.length?!u&&x(v,"")||R(h,""):R(h,T(s,p)),h.length>o?f(h,0,o):h}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:i(t,this,e,n)}:t,[function(t,n){var r=d(this),o=l(t)?void 0:p(t,e);return o?i(o,t,r,n):i(s,m(r),t,n)},function(e,r){var i=a(this),o=m(e),l=n(s,i,o,r,s!==t);if(l.done)return l.value;var c=u(i,RegExp),d=i.unicode,p=(i.ignoreCase?"i":"")+(i.multiline?"m":"")+(i.unicode?"u":"")+(w?"g":"y"),f=new c(w?"^(?:"+i.source+")":i,p),y=void 0===r?S:r>>>0;if(0===y)return[];if(0===o.length)return null===v(f,o)?[o]:[];for(var b=0,C=0,E=[];C<o.length;){f.lastIndex=w?0:C;var x,M=v(f,w?T(o,C):o);if(null===M||(x=D(g(f.lastIndex+(w?C:0)),o.length))===b)C=h(o,C,d);else{if(R(E,T(o,b,C)),E.length===y)return E;for(var k=1;k<=M.length-1;k++)if(R(E,M[k]),E.length===y)return E;C=b=x}}return R(E,T(o,b)),E}]}),!M,w)},23157:function(e,t,n){"use strict";var r,i=n(82109),s=n(1702),o=n(31236).f,a=n(17466),l=n(41340),c=n(3929),d=n(84488),u=n(84964),h=n(31913),g=s("".startsWith),m=s("".slice),p=Math.min,f=u("startsWith");i({target:"String",proto:!0,forced:!(!h&&!f&&(r=o(String.prototype,"startsWith"),r&&!r.writable)||f)},{startsWith:function(e){var t=l(d(this));c(e);var n=a(p(arguments.length>1?arguments[1]:void 0,t.length)),r=l(e);return g?g(t,r,n):m(t,n,n+r.length)===r}})},7397:function(e,t,n){"use strict";var r=n(82109),i=n(14230);r({target:"String",proto:!0,forced:n(43429)("strike")},{strike:function(){return i(this,"strike","","")}})},60086:function(e,t,n){"use strict";var r=n(82109),i=n(14230);r({target:"String",proto:!0,forced:n(43429)("sub")},{sub:function(){return i(this,"sub","","")}})},83650:function(e,t,n){"use strict";var r=n(82109),i=n(1702),s=n(84488),o=n(19303),a=n(41340),l=i("".slice),c=Math.max,d=Math.min;r({target:"String",proto:!0,forced:!"".substr||"b"!=="ab".substr(-1)},{substr:function(e,t){var n,r,i=a(s(this)),u=i.length,h=o(e);return h===1/0&&(h=0),h<0&&(h=c(u+h,0)),(n=void 0===t?u:o(t))<=0||n===1/0||h>=(r=d(h+n,u))?"":l(i,h,r)}})},80623:function(e,t,n){"use strict";var r=n(82109),i=n(14230);r({target:"String",proto:!0,forced:n(43429)("sup")},{sup:function(){return i(this,"sup","","")}})},48702:function(e,t,n){n(83462);var r=n(82109),i=n(10365);r({target:"String",proto:!0,name:"trimEnd",forced:"".trimEnd!==i},{trimEnd:i})},99967:function(e,t,n){var r=n(82109),i=n(33217);r({target:"String",proto:!0,name:"trimStart",forced:"".trimLeft!==i},{trimLeft:i})},83462:function(e,t,n){var r=n(82109),i=n(10365);r({target:"String",proto:!0,name:"trimEnd",forced:"".trimRight!==i},{trimRight:i})},55674:function(e,t,n){n(99967);var r=n(82109),i=n(33217);r({target:"String",proto:!0,name:"trimStart",forced:"".trimStart!==i},{trimStart:i})},73210:function(e,t,n){"use strict";var r=n(82109),i=n(53111).trim;r({target:"String",proto:!0,forced:n(76091)("trim")},{trim:function(){return i(this)}})},72443:function(e,t,n){n(26800)("asyncIterator")},4032:function(e,t,n){"use strict";var r=n(82109),i=n(17854),s=n(46916),o=n(1702),a=n(31913),l=n(19781),c=n(36293),d=n(47293),u=n(92597),h=n(47976),g=n(19670),m=n(45656),p=n(34948),f=n(41340),v=n(79114),y=n(70030),b=n(81956),C=n(8006),w=n(1156),S=n(25181),D=n(31236),E=n(3070),x=n(36048),R=n(55296),T=n(98052),M=n(72309),k=n(6200),I=n(3501),A=n(69711),F=n(5112),O=n(6061),L=n(26800),P=n(56532),$=n(58003),_=n(29909),N=n(42092).forEach,H=k("hidden"),B="Symbol",j=_.set,V=_.getterFor(B),z=Object.prototype,W=i.Symbol,U=W&&W.prototype,Y=i.TypeError,G=i.QObject,q=D.f,K=E.f,X=w.f,Z=R.f,J=o([].push),Q=M("symbols"),ee=M("op-symbols"),te=M("wks"),ne=!G||!G.prototype||!G.prototype.findChild,re=l&&d((function(){return 7!=y(K({},"a",{get:function(){return K(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=q(z,t);r&&delete z[t],K(e,t,n),r&&e!==z&&K(z,t,r)}:K,ie=function(e,t){var n=Q[e]=y(U);return j(n,{type:B,tag:e,description:t}),l||(n.description=t),n},se=function(e,t,n){e===z&&se(ee,t,n),g(e);var r=p(t);return g(n),u(Q,r)?(n.enumerable?(u(e,H)&&e[H][r]&&(e[H][r]=!1),n=y(n,{enumerable:v(0,!1)})):(u(e,H)||K(e,H,v(1,{})),e[H][r]=!0),re(e,r,n)):K(e,r,n)},oe=function(e,t){g(e);var n=m(t),r=b(n).concat(de(n));return N(r,(function(t){l&&!s(ae,n,t)||se(e,t,n[t])})),e},ae=function(e){var t=p(e),n=s(Z,this,t);return!(this===z&&u(Q,t)&&!u(ee,t))&&(!(n||!u(this,t)||!u(Q,t)||u(this,H)&&this[H][t])||n)},le=function(e,t){var n=m(e),r=p(t);if(n!==z||!u(Q,r)||u(ee,r)){var i=q(n,r);return!i||!u(Q,r)||u(n,H)&&n[H][r]||(i.enumerable=!0),i}},ce=function(e){var t=X(m(e)),n=[];return N(t,(function(e){u(Q,e)||u(I,e)||J(n,e)})),n},de=function(e){var t=e===z,n=X(t?ee:m(e)),r=[];return N(n,(function(e){!u(Q,e)||t&&!u(z,e)||J(r,Q[e])})),r};c||(W=function(){if(h(U,this))throw Y("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?f(arguments[0]):void 0,t=A(e),n=function(e){this===z&&s(n,ee,e),u(this,H)&&u(this[H],t)&&(this[H][t]=!1),re(this,t,v(1,e))};return l&&ne&&re(z,t,{configurable:!0,set:n}),ie(t,e)},T(U=W.prototype,"toString",(function(){return V(this).tag})),T(W,"withoutSetter",(function(e){return ie(A(e),e)})),R.f=ae,E.f=se,x.f=oe,D.f=le,C.f=w.f=ce,S.f=de,O.f=function(e){return ie(F(e),e)},l&&(K(U,"description",{configurable:!0,get:function(){return V(this).description}}),a||T(z,"propertyIsEnumerable",ae,{unsafe:!0}))),r({global:!0,constructor:!0,wrap:!0,forced:!c,sham:!c},{Symbol:W}),N(b(te),(function(e){L(e)})),r({target:B,stat:!0,forced:!c},{useSetter:function(){ne=!0},useSimple:function(){ne=!1}}),r({target:"Object",stat:!0,forced:!c,sham:!l},{create:function(e,t){return void 0===t?y(e):oe(y(e),t)},defineProperty:se,defineProperties:oe,getOwnPropertyDescriptor:le}),r({target:"Object",stat:!0,forced:!c},{getOwnPropertyNames:ce}),P(),$(W,B),I[H]=!0},41817:function(e,t,n){"use strict";var r=n(82109),i=n(19781),s=n(17854),o=n(1702),a=n(92597),l=n(60614),c=n(47976),d=n(41340),u=n(3070).f,h=n(99920),g=s.Symbol,m=g&&g.prototype;if(i&&l(g)&&(!("description"in m)||void 0!==g().description)){var p={},f=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:d(arguments[0]),t=c(m,this)?new g(e):void 0===e?g():g(e);return""===e&&(p[t]=!0),t};h(f,g),f.prototype=m,m.constructor=f;var v="Symbol(test)"==String(g("test")),y=o(m.valueOf),b=o(m.toString),C=/^Symbol\((.*)\)[^)]+$/,w=o("".replace),S=o("".slice);u(m,"description",{configurable:!0,get:function(){var e=y(this);if(a(p,e))return"";var t=b(e),n=v?S(t,7,-1):w(t,C,"$1");return""===n?void 0:n}}),r({global:!0,constructor:!0,forced:!0},{Symbol:f})}},40763:function(e,t,n){var r=n(82109),i=n(35005),s=n(92597),o=n(41340),a=n(72309),l=n(2015),c=a("string-to-symbol-registry"),d=a("symbol-to-string-registry");r({target:"Symbol",stat:!0,forced:!l},{for:function(e){var t=o(e);if(s(c,t))return c[t];var n=i("Symbol")(t);return c[t]=n,d[n]=t,n}})},92401:function(e,t,n){n(26800)("hasInstance")},8722:function(e,t,n){n(26800)("isConcatSpreadable")},32165:function(e,t,n){n(26800)("iterator")},82526:function(e,t,n){n(4032),n(40763),n(26620),n(38862),n(29660)},26620:function(e,t,n){var r=n(82109),i=n(92597),s=n(52190),o=n(66330),a=n(72309),l=n(2015),c=a("symbol-to-string-registry");r({target:"Symbol",stat:!0,forced:!l},{keyFor:function(e){if(!s(e))throw TypeError(o(e)+" is not a symbol");if(i(c,e))return c[e]}})},16066:function(e,t,n){n(26800)("matchAll")},69007:function(e,t,n){n(26800)("match")},83510:function(e,t,n){n(26800)("replace")},41840:function(e,t,n){n(26800)("search")},6982:function(e,t,n){n(26800)("species")},32159:function(e,t,n){n(26800)("split")},96649:function(e,t,n){var r=n(26800),i=n(56532);r("toPrimitive"),i()},39341:function(e,t,n){var r=n(35005),i=n(26800),s=n(58003);i("toStringTag"),s(r("Symbol"),"Symbol")},60543:function(e,t,n){n(26800)("unscopables")},48675:function(e,t,n){"use strict";var r=n(90260),i=n(26244),s=n(19303),o=r.aTypedArray;(0,r.exportTypedArrayMethod)("at",(function(e){var t=o(this),n=i(t),r=s(e),a=r>=0?r:n+r;return a<0||a>=n?void 0:t[a]}))},92990:function(e,t,n){"use strict";var r=n(1702),i=n(90260),s=r(n(1048)),o=i.aTypedArray;(0,i.exportTypedArrayMethod)("copyWithin",(function(e,t){return s(o(this),e,t,arguments.length>2?arguments[2]:void 0)}))},18927:function(e,t,n){"use strict";var r=n(90260),i=n(42092).every,s=r.aTypedArray;(0,r.exportTypedArrayMethod)("every",(function(e){return i(s(this),e,arguments.length>1?arguments[1]:void 0)}))},33105:function(e,t,n){"use strict";var r=n(90260),i=n(21285),s=n(64599),o=n(70648),a=n(46916),l=n(1702),c=n(47293),d=r.aTypedArray,u=r.exportTypedArrayMethod,h=l("".slice);u("fill",(function(e){var t=arguments.length;d(this);var n="Big"===h(o(this),0,3)?s(e):+e;return a(i,this,n,t>1?arguments[1]:void 0,t>2?arguments[2]:void 0)}),c((function(){var e=0;return new Int8Array(2).fill({valueOf:function(){return e++}}),1!==e})))},35035:function(e,t,n){"use strict";var r=n(90260),i=n(42092).filter,s=n(43074),o=r.aTypedArray;(0,r.exportTypedArrayMethod)("filter",(function(e){var t=i(o(this),e,arguments.length>1?arguments[1]:void 0);return s(this,t)}))},7174:function(e,t,n){"use strict";var r=n(90260),i=n(42092).findIndex,s=r.aTypedArray;(0,r.exportTypedArrayMethod)("findIndex",(function(e){return i(s(this),e,arguments.length>1?arguments[1]:void 0)}))},14590:function(e,t,n){"use strict";var r=n(90260),i=n(9671).findLastIndex,s=r.aTypedArray;(0,r.exportTypedArrayMethod)("findLastIndex",(function(e){return i(s(this),e,arguments.length>1?arguments[1]:void 0)}))},63408:function(e,t,n){"use strict";var r=n(90260),i=n(9671).findLast,s=r.aTypedArray;(0,r.exportTypedArrayMethod)("findLast",(function(e){return i(s(this),e,arguments.length>1?arguments[1]:void 0)}))},74345:function(e,t,n){"use strict";var r=n(90260),i=n(42092).find,s=r.aTypedArray;(0,r.exportTypedArrayMethod)("find",(function(e){return i(s(this),e,arguments.length>1?arguments[1]:void 0)}))},44197:function(e,t,n){n(19843)("Float32",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},76495:function(e,t,n){n(19843)("Float64",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},32846:function(e,t,n){"use strict";var r=n(90260),i=n(42092).forEach,s=r.aTypedArray;(0,r.exportTypedArrayMethod)("forEach",(function(e){i(s(this),e,arguments.length>1?arguments[1]:void 0)}))},98145:function(e,t,n){"use strict";var r=n(63832);(0,n(90260).exportTypedArrayStaticMethod)("from",n(97321),r)},44731:function(e,t,n){"use strict";var r=n(90260),i=n(41318).includes,s=r.aTypedArray;(0,r.exportTypedArrayMethod)("includes",(function(e){return i(s(this),e,arguments.length>1?arguments[1]:void 0)}))},77209:function(e,t,n){"use strict";var r=n(90260),i=n(41318).indexOf,s=r.aTypedArray;(0,r.exportTypedArrayMethod)("indexOf",(function(e){return i(s(this),e,arguments.length>1?arguments[1]:void 0)}))},35109:function(e,t,n){n(19843)("Int16",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},65125:function(e,t,n){n(19843)("Int32",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},87145:function(e,t,n){n(19843)("Int8",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},96319:function(e,t,n){"use strict";var r=n(17854),i=n(47293),s=n(1702),o=n(90260),a=n(66992),l=n(5112)("iterator"),c=r.Uint8Array,d=s(a.values),u=s(a.keys),h=s(a.entries),g=o.aTypedArray,m=o.exportTypedArrayMethod,p=c&&c.prototype,f=!i((function(){p[l].call([1])})),v=!!p&&p.values&&p[l]===p.values&&"values"===p.values.name,y=function(){return d(g(this))};m("entries",(function(){return h(g(this))}),f),m("keys",(function(){return u(g(this))}),f),m("values",y,f||!v,{name:"values"}),m(l,y,f||!v,{name:"values"})},58867:function(e,t,n){"use strict";var r=n(90260),i=n(1702),s=r.aTypedArray,o=r.exportTypedArrayMethod,a=i([].join);o("join",(function(e){return a(s(this),e)}))},37789:function(e,t,n){"use strict";var r=n(90260),i=n(22104),s=n(86583),o=r.aTypedArray;(0,r.exportTypedArrayMethod)("lastIndexOf",(function(e){var t=arguments.length;return i(s,o(this),t>1?[e,arguments[1]]:[e])}))},33739:function(e,t,n){"use strict";var r=n(90260),i=n(42092).map,s=n(66304),o=r.aTypedArray;(0,r.exportTypedArrayMethod)("map",(function(e){return i(o(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(s(e))(t)}))}))},95206:function(e,t,n){"use strict";var r=n(90260),i=n(63832),s=r.aTypedArrayConstructor;(0,r.exportTypedArrayStaticMethod)("of",(function(){for(var e=0,t=arguments.length,n=new(s(this))(t);t>e;)n[e]=arguments[e++];return n}),i)},14483:function(e,t,n){"use strict";var r=n(90260),i=n(53671).right,s=r.aTypedArray;(0,r.exportTypedArrayMethod)("reduceRight",(function(e){var t=arguments.length;return i(s(this),e,t,t>1?arguments[1]:void 0)}))},29368:function(e,t,n){"use strict";var r=n(90260),i=n(53671).left,s=r.aTypedArray;(0,r.exportTypedArrayMethod)("reduce",(function(e){var t=arguments.length;return i(s(this),e,t,t>1?arguments[1]:void 0)}))},12056:function(e,t,n){"use strict";var r=n(90260),i=r.aTypedArray,s=r.exportTypedArrayMethod,o=Math.floor;s("reverse",(function(){for(var e,t=this,n=i(t).length,r=o(n/2),s=0;s<r;)e=t[s],t[s++]=t[--n],t[n]=e;return t}))},3462:function(e,t,n){"use strict";var r=n(17854),i=n(46916),s=n(90260),o=n(26244),a=n(84590),l=n(47908),c=n(47293),d=r.RangeError,u=r.Int8Array,h=u&&u.prototype,g=h&&h.set,m=s.aTypedArray,p=s.exportTypedArrayMethod,f=!c((function(){var e=new Uint8ClampedArray(2);return i(g,e,{length:1,0:3},1),3!==e[1]})),v=f&&s.NATIVE_ARRAY_BUFFER_VIEWS&&c((function(){var e=new u(2);return e.set(1),e.set("2",1),0!==e[0]||2!==e[1]}));p("set",(function(e){m(this);var t=a(arguments.length>1?arguments[1]:void 0,1),n=l(e);if(f)return i(g,this,n,t);var r=this.length,s=o(n),c=0;if(s+t>r)throw d("Wrong length");for(;c<s;)this[t+c]=n[c++]}),!f||v)},30678:function(e,t,n){"use strict";var r=n(90260),i=n(66304),s=n(47293),o=n(50206),a=r.aTypedArray;(0,r.exportTypedArrayMethod)("slice",(function(e,t){for(var n=o(a(this),e,t),r=i(this),s=0,l=n.length,c=new r(l);l>s;)c[s]=n[s++];return c}),s((function(){new Int8Array(1).slice()})))},27462:function(e,t,n){"use strict";var r=n(90260),i=n(42092).some,s=r.aTypedArray;(0,r.exportTypedArrayMethod)("some",(function(e){return i(s(this),e,arguments.length>1?arguments[1]:void 0)}))},33824:function(e,t,n){"use strict";var r=n(17854),i=n(1702),s=n(47293),o=n(19662),a=n(94362),l=n(90260),c=n(68886),d=n(30256),u=n(7392),h=n(98008),g=l.aTypedArray,m=l.exportTypedArrayMethod,p=r.Uint16Array,f=p&&i(p.prototype.sort),v=!(!f||s((function(){f(new p(2),null)}))&&s((function(){f(new p(2),{})}))),y=!!f&&!s((function(){if(u)return u<74;if(c)return c<67;if(d)return!0;if(h)return h<602;var e,t,n=new p(516),r=Array(516);for(e=0;e<516;e++)t=e%4,n[e]=515-e,r[e]=e-2*t+3;for(f(n,(function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(n[e]!==r[e])return!0}));m("sort",(function(e){return void 0!==e&&o(e),y?f(this,e):a(g(this),function(e){return function(t,n){return void 0!==e?+e(t,n)||0:n!=n?-1:t!=t?1:0===t&&0===n?1/t>0&&1/n<0?1:-1:t>n}}(e))}),!y||v)},55021:function(e,t,n){"use strict";var r=n(90260),i=n(17466),s=n(51400),o=n(66304),a=r.aTypedArray;(0,r.exportTypedArrayMethod)("subarray",(function(e,t){var n=a(this),r=n.length,l=s(e,r);return new(o(n))(n.buffer,n.byteOffset+l*n.BYTES_PER_ELEMENT,i((void 0===t?r:s(t,r))-l))}))},12974:function(e,t,n){"use strict";var r=n(17854),i=n(22104),s=n(90260),o=n(47293),a=n(50206),l=r.Int8Array,c=s.aTypedArray,d=s.exportTypedArrayMethod,u=[].toLocaleString,h=!!l&&o((function(){u.call(new l(1))}));d("toLocaleString",(function(){return i(u,h?a(c(this)):c(this),a(arguments))}),o((function(){return[1,2].toLocaleString()!=new l([1,2]).toLocaleString()}))||!o((function(){l.prototype.toLocaleString.call([1,2])})))},15016:function(e,t,n){"use strict";var r=n(90260).exportTypedArrayMethod,i=n(47293),s=n(17854),o=n(1702),a=s.Uint8Array,l=a&&a.prototype||{},c=[].toString,d=o([].join);i((function(){c.call({})}))&&(c=function(){return d(this)});var u=l.toString!=c;r("toString",c,u)},8255:function(e,t,n){n(19843)("Uint16",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},29135:function(e,t,n){n(19843)("Uint32",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},82472:function(e,t,n){n(19843)("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},49743:function(e,t,n){n(19843)("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}),!0)},78221:function(e,t,n){"use strict";var r=n(82109),i=n(1702),s=n(41340),o=String.fromCharCode,a=i("".charAt),l=i(/./.exec),c=i("".slice),d=/^[\da-f]{2}$/i,u=/^[\da-f]{4}$/i;r({global:!0},{unescape:function(e){for(var t,n,r=s(e),i="",h=r.length,g=0;g<h;){if("%"===(t=a(r,g++)))if("u"===a(r,g)){if(n=c(r,g+1,g+5),l(u,n)){i+=o(parseInt(n,16)),g+=5;continue}}else if(n=c(r,g,g+2),l(d,n)){i+=o(parseInt(n,16)),g+=2;continue}i+=t}return i}})},41202:function(e,t,n){"use strict";var r,i=n(17854),s=n(1702),o=n(89190),a=n(62423),l=n(77710),c=n(29320),d=n(70111),u=n(52050),h=n(29909).enforce,g=n(94811),m=!i.ActiveXObject&&"ActiveXObject"in i,p=function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},f=l("WeakMap",p,c);if(g&&m){r=c.getConstructor(p,"WeakMap",!0),a.enable();var v=f.prototype,y=s(v.delete),b=s(v.has),C=s(v.get),w=s(v.set);o(v,{delete:function(e){if(d(e)&&!u(e)){var t=h(this);return t.frozen||(t.frozen=new r),y(this,e)||t.frozen.delete(e)}return y(this,e)},has:function(e){if(d(e)&&!u(e)){var t=h(this);return t.frozen||(t.frozen=new r),b(this,e)||t.frozen.has(e)}return b(this,e)},get:function(e){if(d(e)&&!u(e)){var t=h(this);return t.frozen||(t.frozen=new r),b(this,e)?C(this,e):t.frozen.get(e)}return C(this,e)},set:function(e,t){if(d(e)&&!u(e)){var n=h(this);n.frozen||(n.frozen=new r),b(this,e)?w(this,e,t):n.frozen.set(e,t)}else w(this,e,t);return this}})}},4129:function(e,t,n){n(41202)},72098:function(e,t,n){"use strict";n(77710)("WeakSet",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),n(29320))},38478:function(e,t,n){n(72098)},68216:function(e,t,n){"use strict";var r=n(82109),i=n(12269).every;r({target:"AsyncIterator",proto:!0,real:!0,forced:!0},{every:function(e){return i(this,e)}})},88449:function(e,t,n){"use strict";var r=n(82109),i=n(46916),s=n(19662),o=n(19670),a=n(70111),l=n(24942),c=n(45348),d=n(76178),u=n(21753),h=c((function(e){var t=this,n=t.iterator,r=t.filterer;return new e((function(s,l){var c=function(e){t.done=!0,l(e)},h=function(e){u(n,c,e,c)},g=function(){try{e.resolve(o(i(t.next,n))).then((function(n){try{if(o(n).done)t.done=!0,s(d(void 0,!0));else{var i=n.value;try{var l=r(i,t.counter++),u=function(e){e?s(d(i,!1)):g()};a(l)?e.resolve(l).then(u,h):u(l)}catch(e){h(e)}}}catch(e){c(e)}}),c)}catch(e){c(e)}};g()}))}));r({target:"AsyncIterator",proto:!0,real:!0,forced:!0},{filter:function(e){return new h(l(this),{filterer:s(e)})}})},31672:function(e,t,n){"use strict";var r=n(82109),i=n(12269).find;r({target:"AsyncIterator",proto:!0,real:!0,forced:!0},{find:function(e){return i(this,e)}})},15581:function(e,t,n){"use strict";var r=n(82109),i=n(12269).forEach;r({target:"AsyncIterator",proto:!0,real:!0,forced:!0},{forEach:function(e){return i(this,e)}})},57640:function(e,t,n){"use strict";var r=n(82109),i=n(46916),s=n(19662),o=n(19670),a=n(70111),l=n(24942),c=n(45348),d=n(76178),u=n(21753),h=c((function(e){var t=this,n=t.iterator,r=t.mapper;return new e((function(s,l){var c=function(e){t.done=!0,l(e)},h=function(e){u(n,c,e,c)};e.resolve(o(i(t.next,n))).then((function(n){try{if(o(n).done)t.done=!0,s(d(void 0,!0));else{var i=n.value;try{var l=r(i,t.counter++),u=function(e){s(d(e,!1))};a(l)?e.resolve(l).then(u,h):u(l)}catch(e){h(e)}}}catch(e){c(e)}}),c)}))}));r({target:"AsyncIterator",proto:!0,real:!0,forced:!0},{map:function(e){return new h(l(this),{mapper:s(e)})}})},64211:function(e,t,n){"use strict";var r=n(82109),i=n(12269).some;r({target:"AsyncIterator",proto:!0,real:!0,forced:!0},{some:function(e){return i(this,e)}})},2490:function(e,t,n){"use strict";var r=n(82109),i=n(17854),s=n(25787),o=n(60614),a=n(68880),l=n(47293),c=n(92597),d=n(5112),u=n(13383).IteratorPrototype,h=n(31913),g=d("toStringTag"),m=i.Iterator,p=h||!o(m)||m.prototype!==u||!l((function(){m({})})),f=function(){s(this,u)};c(u,g)||a(u,g,"Iterator"),!p&&c(u,"constructor")&&u.constructor!==Object||a(u,"constructor",f),f.prototype=u,r({global:!0,constructor:!0,forced:p},{Iterator:f})},79433:function(e,t,n){"use strict";var r=n(82109),i=n(20408),s=n(19662),o=n(24942);r({target:"Iterator",proto:!0,real:!0,forced:!0},{every:function(e){var t=o(this),n=0;return s(e),!i(t,(function(t,r){if(!e(t,n++))return r()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},59849:function(e,t,n){"use strict";var r=n(82109),i=n(46916),s=n(19662),o=n(19670),a=n(24942),l=n(54956),c=n(53411),d=l((function(){for(var e,t,n=this.iterator,r=this.filterer,s=this.next;;){if(e=o(i(s,n)),this.done=!!e.done)return;if(t=e.value,c(n,r,[t,this.counter++],!0))return t}}));r({target:"Iterator",proto:!0,real:!0,forced:!0},{filter:function(e){return new d(a(this),{filterer:s(e)})}})},59461:function(e,t,n){"use strict";var r=n(82109),i=n(20408),s=n(19662),o=n(24942);r({target:"Iterator",proto:!0,real:!0,forced:!0},{find:function(e){var t=o(this),n=0;return s(e),i(t,(function(t,r){if(e(t,n++))return r(t)}),{IS_RECORD:!0,INTERRUPTED:!0}).result}})},34514:function(e,t,n){"use strict";var r=n(82109),i=n(20408),s=n(19662),o=n(24942);r({target:"Iterator",proto:!0,real:!0,forced:!0},{forEach:function(e){var t=o(this),n=0;s(e),i(t,(function(t){e(t,n++)}),{IS_RECORD:!0})}})},9924:function(e,t,n){"use strict";var r=n(82109),i=n(46916),s=n(19662),o=n(19670),a=n(24942),l=n(54956),c=n(53411),d=l((function(){var e=this.iterator,t=o(i(this.next,e));if(!(this.done=!!t.done))return c(e,this.mapper,[t.value,this.counter++],!0)}));r({target:"Iterator",proto:!0,real:!0,forced:!0},{map:function(e){return new d(a(this),{mapper:s(e)})}})},41874:function(e,t,n){"use strict";var r=n(82109),i=n(20408),s=n(19662),o=n(24942);r({target:"Iterator",proto:!0,real:!0,forced:!0},{some:function(e){var t=o(this),n=0;return s(e),i(t,(function(t,r){if(e(t,n++))return r()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},75505:function(e,t,n){var r=n(82109),i=n(35005),s=n(1702),o=n(47293),a=n(41340),l=n(92597),c=n(48053),d=n(14170).ctoi,u=/[^\d+/a-z]/i,h=/[\t\n\f\r ]+/g,g=/[=]+$/,m=i("atob"),p=String.fromCharCode,f=s("".charAt),v=s("".replace),y=s(u.exec),b=o((function(){return""!==m(" ")})),C=!o((function(){m("a")})),w=!b&&!C&&!o((function(){m()})),S=!b&&!C&&1!==m.length;r({global:!0,enumerable:!0,forced:b||C||w||S},{atob:function(e){if(c(arguments.length,1),w||S)return m(e);var t,n,r=v(a(e),h,""),s="",o=0,b=0;if(r.length%4==0&&(r=v(r,g,"")),r.length%4==1||y(u,r))throw new(i("DOMException"))("The string is not correctly encoded","InvalidCharacterError");for(;t=f(r,o++);)l(d,t)&&(n=b%4?64*n+d[t]:d[t],b++%4&&(s+=p(255&n>>(-2*b&6))));return s}})},27479:function(e,t,n){var r=n(82109),i=n(35005),s=n(1702),o=n(47293),a=n(41340),l=n(48053),c=n(14170).itoc,d=i("btoa"),u=s("".charAt),h=s("".charCodeAt),g=!!d&&!o((function(){d()})),m=!!d&&o((function(){return"bnVsbA=="!==d(null)})),p=!!d&&1!==d.length;r({global:!0,enumerable:!0,forced:g||m||p},{btoa:function(e){if(l(arguments.length,1),g||m||p)return d(a(e));for(var t,n,r=a(e),s="",o=0,f=c;u(r,o)||(f="=",o%1);){if((n=h(r,o+=3/4))>255)throw new(i("DOMException"))("The string contains characters outside of the Latin1 range","InvalidCharacterError");s+=u(f,63&(t=t<<8|n)>>8-o%1*8)}return s}})},11091:function(e,t,n){var r=n(82109),i=n(17854),s=n(20261).clear;r({global:!0,bind:!0,enumerable:!0,forced:i.clearImmediate!==s},{clearImmediate:s})},54747:function(e,t,n){var r=n(17854),i=n(48324),s=n(98509),o=n(18533),a=n(68880),l=function(e){if(e&&e.forEach!==o)try{a(e,"forEach",o)}catch(t){e.forEach=o}};for(var c in i)i[c]&&l(r[c]&&r[c].prototype);l(s)},33948:function(e,t,n){var r=n(17854),i=n(48324),s=n(98509),o=n(66992),a=n(68880),l=n(5112),c=l("iterator"),d=l("toStringTag"),u=o.values,h=function(e,t){if(e){if(e[c]!==u)try{a(e,c,u)}catch(t){e[c]=u}if(e[d]||a(e,d,t),i[t])for(var n in o)if(e[n]!==o[n])try{a(e,n,o[n])}catch(t){e[n]=o[n]}}};for(var g in i)h(r[g]&&r[g].prototype,g);h(s,"DOMTokenList")},87714:function(e,t,n){"use strict";var r=n(82109),i=n(44038),s=n(35005),o=n(47293),a=n(70030),l=n(79114),c=n(3070).f,d=n(98052),u=n(47045),h=n(92597),g=n(25787),m=n(19670),p=n(7762),f=n(56277),v=n(93678),y=n(11060),b=n(29909),C=n(19781),w=n(31913),S="DOMException",D=s("Error"),E=s(S)||function(){try{(new(s("MessageChannel")||i("worker_threads").MessageChannel)).port1.postMessage(new WeakMap)}catch(e){if("DATA_CLONE_ERR"==e.name&&25==e.code)return e.constructor}}(),x=E&&E.prototype,R=D.prototype,T=b.set,M=b.getterFor(S),k="stack"in D(S),I=function(e){return h(v,e)&&v[e].m?v[e].c:0},A=function(){g(this,F);var e=arguments.length,t=f(e<1?void 0:arguments[0]),n=f(e<2?void 0:arguments[1],"Error"),r=I(n);if(T(this,{type:S,name:n,message:t,code:r}),C||(this.name=n,this.message=t,this.code=r),k){var i=D(t);i.name=S,c(this,"stack",l(1,y(i.stack,1)))}},F=A.prototype=a(R),O=function(e){return{enumerable:!0,configurable:!0,get:e}},L=function(e){return O((function(){return M(this)[e]}))};C&&(u(F,"code",L("code")),u(F,"message",L("message")),u(F,"name",L("name"))),c(F,"constructor",l(1,A));var P=o((function(){return!(new E instanceof D)})),$=P||o((function(){return R.toString!==p||"2: 1"!==String(new E(1,2))})),_=P||o((function(){return 25!==new E(1,"DataCloneError").code})),N=P||25!==E.DATA_CLONE_ERR||25!==x.DATA_CLONE_ERR,H=w?$||_||N:P;r({global:!0,constructor:!0,forced:H},{DOMException:H?A:E});var B=s(S),j=B.prototype;for(var V in $&&(w||E===B)&&d(j,"toString",p),_&&C&&E===B&&u(j,"code",O((function(){return I(m(this).name)}))),v)if(h(v,V)){var z=v[V],W=z.s,U=l(6,z.c);h(B,W)||c(B,W,U),h(j,W)||c(j,W,U)}},82801:function(e,t,n){"use strict";var r=n(82109),i=n(17854),s=n(35005),o=n(79114),a=n(3070).f,l=n(92597),c=n(25787),d=n(79587),u=n(56277),h=n(93678),g=n(11060),m=n(19781),p=n(31913),f="DOMException",v=s("Error"),y=s(f),b=function(){c(this,C);var e=arguments.length,t=u(e<1?void 0:arguments[0]),n=u(e<2?void 0:arguments[1],"Error"),r=new y(t,n),i=v(t);return i.name=f,a(r,"stack",o(1,g(i.stack,1))),d(r,this,b),r},C=b.prototype=y.prototype,w="stack"in v(f),S="stack"in new y(1,2),D=y&&m&&Object.getOwnPropertyDescriptor(i,f),E=!(!D||D.writable&&D.configurable),x=w&&!E&&!S;r({global:!0,constructor:!0,forced:p||x},{DOMException:x?b:y});var R=s(f),T=R.prototype;if(T.constructor!==R)for(var M in p||a(T,"constructor",o(1,R)),h)if(l(h,M)){var k=h[M],I=k.s;l(R,I)||a(R,I,o(6,k.c))}},1174:function(e,t,n){var r=n(35005),i="DOMException";n(58003)(r(i),i)},84633:function(e,t,n){n(11091),n(12986)},85844:function(e,t,n){var r=n(82109),i=n(17854),s=n(95948),o=n(19662),a=n(48053),l=n(35268),c=i.process;r({global:!0,enumerable:!0,dontCallGetSet:!0},{queueMicrotask:function(e){a(arguments.length,1),o(e);var t=l&&c.domain;s(t?t.bind(e):e)}})},71550:function(e,t,n){"use strict";var r=n(82109),i=n(17854),s=n(47045),o=n(19781),a=TypeError,l=Object.defineProperty,c=i.self!==i;try{if(o){var d=Object.getOwnPropertyDescriptor(i,"self");!c&&d&&d.get&&d.enumerable||s(i,"self",{get:function(){return i},set:function(e){if(this!==i)throw a("Illegal invocation");l(i,"self",{value:e,writable:!0,configurable:!0,enumerable:!0})},configurable:!0,enumerable:!0})}else r({global:!0,simple:!0,forced:c},{self:i})}catch(e){}},12986:function(e,t,n){var r=n(82109),i=n(17854),s=n(20261).set;r({global:!0,bind:!0,enumerable:!0,forced:i.setImmediate!==s},{setImmediate:s})},96815:function(e,t,n){var r=n(82109),i=n(17854),s=n(17152).setInterval;r({global:!0,bind:!0,forced:i.setInterval!==s},{setInterval:s})},88417:function(e,t,n){var r=n(82109),i=n(17854),s=n(17152).setTimeout;r({global:!0,bind:!0,forced:i.setTimeout!==s},{setTimeout:s})},61295:function(e,t,n){var r,i=n(31913),s=n(82109),o=n(17854),a=n(35005),l=n(1702),c=n(47293),d=n(69711),u=n(60614),h=n(4411),g=n(68554),m=n(70111),p=n(52190),f=n(20408),v=n(19670),y=n(70648),b=n(92597),C=n(86135),w=n(68880),S=n(26244),D=n(48053),E=n(34706),x=n(22914),R=n(7392),T=n(7871),M=n(83823),k=n(35268),I=o.Object,A=o.Date,F=o.Error,O=o.EvalError,L=o.RangeError,P=o.ReferenceError,$=o.SyntaxError,_=o.TypeError,N=o.URIError,H=o.PerformanceMark,B=o.WebAssembly,j=B&&B.CompileError||F,V=B&&B.LinkError||F,z=B&&B.RuntimeError||F,W=a("DOMException"),U=a("Set"),Y=a("Map"),G=Y.prototype,q=l(G.has),K=l(G.get),X=l(G.set),Z=l(U.prototype.add),J=a("Object","keys"),Q=l([].push),ee=l((!0).valueOf),te=l(1..valueOf),ne=l("".valueOf),re=l(A.prototype.getTime),ie=d("structuredClone"),se="DataCloneError",oe="Transferring",ae=function(e){return!c((function(){var t=new o.Set([7]),n=e(t),r=e(I(7));return n==t||!n.has(7)||"object"!=typeof r||7!=r}))&&e},le=function(e,t){return!c((function(){var n=new t,r=e({a:n,b:n});return!(r&&r.a===r.b&&r.a instanceof t&&r.a.stack===n.stack)}))},ce=o.structuredClone,de=i||!le(ce,F)||!le(ce,W)||(r=ce,!!c((function(){var e=r(new o.AggregateError([1],ie,{cause:3}));return"AggregateError"!=e.name||1!=e.errors[0]||e.message!=ie||3!=e.cause}))),ue=!ce&&ae((function(e){return new H(ie,{detail:e}).detail})),he=ae(ce)||ue,ge=function(e){throw new W("Uncloneable type: "+e,se)},me=function(e,t){throw new W((t||"Cloning")+" of "+e+" cannot be properly polyfilled in this engine",se)},pe=function(e,t){if(p(e)&&ge("Symbol"),!m(e))return e;if(t){if(q(t,e))return K(t,e)}else t=new Y;var n,r,i,s,l,c,d,h,g,f,v=y(e),D=!1;switch(v){case"Array":i=[],D=!0;break;case"Object":i={},D=!0;break;case"Map":i=new Y,D=!0;break;case"Set":i=new U,D=!0;break;case"RegExp":i=new RegExp(e.source,E(e));break;case"Error":switch(r=e.name){case"AggregateError":i=a("AggregateError")([]);break;case"EvalError":i=O();break;case"RangeError":i=L();break;case"ReferenceError":i=P();break;case"SyntaxError":i=$();break;case"TypeError":i=_();break;case"URIError":i=N();break;case"CompileError":i=j();break;case"LinkError":i=V();break;case"RuntimeError":i=z();break;default:i=F()}D=!0;break;case"DOMException":i=new W(e.message,e.name),D=!0;break;case"DataView":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":n=o[v],m(n)||me(v),i=new n(pe(e.buffer,t),e.byteOffset,"DataView"===v?e.byteLength:e.length);break;case"DOMQuad":try{i=new DOMQuad(pe(e.p1,t),pe(e.p2,t),pe(e.p3,t),pe(e.p4,t))}catch(t){he?i=he(e):me(v)}break;case"FileList":if(s=function(){var e;try{e=new o.DataTransfer}catch(t){try{e=new o.ClipboardEvent("").clipboardData}catch(e){}}return e&&e.items&&e.files?e:null}()){for(l=0,c=S(e);l<c;l++)s.items.add(pe(e[l],t));i=s.files}else he?i=he(e):me(v);break;case"ImageData":try{i=new ImageData(pe(e.data,t),e.width,e.height,{colorSpace:e.colorSpace})}catch(t){he?i=he(e):me(v)}break;default:if(he)i=he(e);else switch(v){case"BigInt":i=I(e.valueOf());break;case"Boolean":i=I(ee(e));break;case"Number":i=I(te(e));break;case"String":i=I(ne(e));break;case"Date":i=new A(re(e));break;case"ArrayBuffer":(n=o.DataView)||"function"==typeof e.slice||me(v);try{if("function"==typeof e.slice)i=e.slice(0);else for(c=e.byteLength,i=new ArrayBuffer(c),g=new n(e),f=new n(i),l=0;l<c;l++)f.setUint8(l,g.getUint8(l))}catch(e){throw new W("ArrayBuffer is detached",se)}break;case"SharedArrayBuffer":i=e;break;case"Blob":try{i=e.slice(0,e.size,e.type)}catch(e){me(v)}break;case"DOMPoint":case"DOMPointReadOnly":n=o[v];try{i=n.fromPoint?n.fromPoint(e):new n(e.x,e.y,e.z,e.w)}catch(e){me(v)}break;case"DOMRect":case"DOMRectReadOnly":n=o[v];try{i=n.fromRect?n.fromRect(e):new n(e.x,e.y,e.width,e.height)}catch(e){me(v)}break;case"DOMMatrix":case"DOMMatrixReadOnly":n=o[v];try{i=n.fromMatrix?n.fromMatrix(e):new n(e)}catch(e){me(v)}break;case"AudioData":case"VideoFrame":u(e.clone)||me(v);try{i=e.clone()}catch(e){ge(v)}break;case"File":try{i=new File([e],e.name,e)}catch(e){me(v)}break;case"CropTarget":case"CryptoKey":case"FileSystemDirectoryHandle":case"FileSystemFileHandle":case"FileSystemHandle":case"GPUCompilationInfo":case"GPUCompilationMessage":case"ImageBitmap":case"RTCCertificate":case"WebAssembly.Module":me(v);default:ge(v)}}if(X(t,e,i),D)switch(v){case"Array":case"Object":for(d=J(e),l=0,c=S(d);l<c;l++)h=d[l],C(i,h,pe(e[h],t));break;case"Map":e.forEach((function(e,n){X(i,pe(n,t),pe(e,t))}));break;case"Set":e.forEach((function(e){Z(i,pe(e,t))}));break;case"Error":w(i,"message",pe(e.message,t)),b(e,"cause")&&w(i,"cause",pe(e.cause,t)),"AggregateError"==r&&(i.errors=pe(e.errors,t));case"DOMException":x&&w(i,"stack",pe(e.stack,t))}return i},fe=ce&&!c((function(){if(M&&R>92||k&&R>94||T&&R>97)return!1;var e=new ArrayBuffer(8),t=ce(e,{transfer:[e]});return 0!=e.byteLength||8!=t.byteLength})),ve=function(e,t){if(!m(e))throw _("Transfer option cannot be converted to a sequence");var n=[];f(e,(function(e){Q(n,v(e))}));var r,i,s,a,l,c,d=0,g=S(n);if(fe)for(a=ce(n,{transfer:n});d<g;)X(t,n[d],a[d++]);else for(;d<g;){if(r=n[d++],q(t,r))throw new W("Duplicate transferable",se);switch(i=y(r)){case"ImageBitmap":s=o.OffscreenCanvas,h(s)||me(i,oe);try{(c=new s(r.width,r.height)).getContext("bitmaprenderer").transferFromImageBitmap(r),l=c.transferToImageBitmap()}catch(e){}break;case"AudioData":case"VideoFrame":u(r.clone)&&u(r.close)||me(i,oe);try{l=r.clone(),r.close()}catch(e){}break;case"ArrayBuffer":case"MediaSourceHandle":case"MessagePort":case"OffscreenCanvas":case"ReadableStream":case"TransformStream":case"WritableStream":me(i,oe)}if(void 0===l)throw new W("This object cannot be transferred: "+i,se);X(t,r,l)}};s({global:!0,enumerable:!0,sham:!fe,forced:de},{structuredClone:function(e){var t,n=D(arguments.length,1)>1&&!g(arguments[1])?v(arguments[1]):void 0,r=n?n.transfer:void 0;return void 0!==r&&(t=new Y,ve(r,t)),pe(e,t)}})},32564:function(e,t,n){n(96815),n(88417)},65556:function(e,t,n){"use strict";n(66992);var r=n(82109),i=n(17854),s=n(46916),o=n(1702),a=n(19781),l=n(85143),c=n(98052),d=n(89190),u=n(58003),h=n(63061),g=n(29909),m=n(25787),p=n(60614),f=n(92597),v=n(49974),y=n(70648),b=n(19670),C=n(70111),w=n(41340),S=n(70030),D=n(79114),E=n(18554),x=n(71246),R=n(48053),T=n(5112),M=n(94362),k=T("iterator"),I="URLSearchParams",A="URLSearchParamsIterator",F=g.set,O=g.getterFor(I),L=g.getterFor(A),P=Object.getOwnPropertyDescriptor,$=function(e){if(!a)return i[e];var t=P(i,e);return t&&t.value},_=$("fetch"),N=$("Request"),H=$("Headers"),B=N&&N.prototype,j=H&&H.prototype,V=i.RegExp,z=i.TypeError,W=i.decodeURIComponent,U=i.encodeURIComponent,Y=o("".charAt),G=o([].join),q=o([].push),K=o("".replace),X=o([].shift),Z=o([].splice),J=o("".split),Q=o("".slice),ee=/\+/g,te=Array(4),ne=function(e){return te[e-1]||(te[e-1]=V("((?:%[\\da-f]{2}){"+e+"})","gi"))},re=function(e){try{return W(e)}catch(t){return e}},ie=function(e){var t=K(e,ee," "),n=4;try{return W(t)}catch(e){for(;n;)t=K(t,ne(n--),re);return t}},se=/[!'()~]|%20/g,oe={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},ae=function(e){return oe[e]},le=function(e){return K(U(e),se,ae)},ce=h((function(e,t){F(this,{type:A,iterator:E(O(e).entries),kind:t})}),"Iterator",(function(){var e=L(this),t=e.kind,n=e.iterator.next(),r=n.value;return n.done||(n.value="keys"===t?r.key:"values"===t?r.value:[r.key,r.value]),n}),!0),de=function(e){this.entries=[],this.url=null,void 0!==e&&(C(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===Y(e,0)?Q(e,1):e:w(e)))};de.prototype={type:I,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,r,i,o,a,l,c=x(e);if(c)for(n=(t=E(e,c)).next;!(r=s(n,t)).done;){if(o=(i=E(b(r.value))).next,(a=s(o,i)).done||(l=s(o,i)).done||!s(o,i).done)throw z("Expected sequence with length 2");q(this.entries,{key:w(a.value),value:w(l.value)})}else for(var d in e)f(e,d)&&q(this.entries,{key:d,value:w(e[d])})},parseQuery:function(e){if(e)for(var t,n,r=J(e,"&"),i=0;i<r.length;)(t=r[i++]).length&&(n=J(t,"="),q(this.entries,{key:ie(X(n)),value:ie(G(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],r=0;r<t.length;)e=t[r++],q(n,le(e.key)+"="+le(e.value));return G(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var ue=function(){m(this,he);var e=arguments.length>0?arguments[0]:void 0;F(this,new de(e))},he=ue.prototype;if(d(he,{append:function(e,t){R(arguments.length,2);var n=O(this);q(n.entries,{key:w(e),value:w(t)}),n.updateURL()},delete:function(e){R(arguments.length,1);for(var t=O(this),n=t.entries,r=w(e),i=0;i<n.length;)n[i].key===r?Z(n,i,1):i++;t.updateURL()},get:function(e){R(arguments.length,1);for(var t=O(this).entries,n=w(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){R(arguments.length,1);for(var t=O(this).entries,n=w(e),r=[],i=0;i<t.length;i++)t[i].key===n&&q(r,t[i].value);return r},has:function(e){R(arguments.length,1);for(var t=O(this).entries,n=w(e),r=0;r<t.length;)if(t[r++].key===n)return!0;return!1},set:function(e,t){R(arguments.length,1);for(var n,r=O(this),i=r.entries,s=!1,o=w(e),a=w(t),l=0;l<i.length;l++)(n=i[l]).key===o&&(s?Z(i,l--,1):(s=!0,n.value=a));s||q(i,{key:o,value:a}),r.updateURL()},sort:function(){var e=O(this);M(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,n=O(this).entries,r=v(e,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new ce(this,"keys")},values:function(){return new ce(this,"values")},entries:function(){return new ce(this,"entries")}},{enumerable:!0}),c(he,k,he.entries,{name:"entries"}),c(he,"toString",(function(){return O(this).serialize()}),{enumerable:!0}),u(ue,I),r({global:!0,constructor:!0,forced:!l},{URLSearchParams:ue}),!l&&p(H)){var ge=o(j.has),me=o(j.set),pe=function(e){if(C(e)){var t,n=e.body;if(y(n)===I)return t=e.headers?new H(e.headers):new H,ge(t,"content-type")||me(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),S(e,{body:D(0,w(n)),headers:D(0,t)})}return e};if(p(_)&&r({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return _(e,arguments.length>1?pe(arguments[1]):{})}}),p(N)){var fe=function(e){return m(this,B),new N(e,arguments.length>1?pe(arguments[1]):{})};B.constructor=fe,fe.prototype=B,r({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:fe})}}e.exports={URLSearchParams:ue,getState:O}},41637:function(e,t,n){n(65556)},68789:function(e,t,n){"use strict";n(78783);var r,i=n(82109),s=n(19781),o=n(85143),a=n(17854),l=n(49974),c=n(1702),d=n(98052),u=n(47045),h=n(25787),g=n(92597),m=n(21574),p=n(48457),f=n(41589),v=n(28710).codeAt,y=n(33197),b=n(41340),C=n(58003),w=n(48053),S=n(65556),D=n(29909),E=D.set,x=D.getterFor("URL"),R=S.URLSearchParams,T=S.getState,M=a.URL,k=a.TypeError,I=a.parseInt,A=Math.floor,F=Math.pow,O=c("".charAt),L=c(/./.exec),P=c([].join),$=c(1..toString),_=c([].pop),N=c([].push),H=c("".replace),B=c([].shift),j=c("".split),V=c("".slice),z=c("".toLowerCase),W=c([].unshift),U="Invalid scheme",Y="Invalid host",G="Invalid port",q=/[a-z]/i,K=/[\d+-.a-z]/i,X=/\d/,Z=/^0x/i,J=/^[0-7]+$/,Q=/^\d+$/,ee=/^[\da-f]+$/i,te=/[\0\t\n\r #%/:<>?@[\\\]^|]/,ne=/[\0\t\n\r #/:<>?@[\\\]^|]/,re=/^[\u0000-\u0020]+|[\u0000-\u0020]+$/g,ie=/[\t\n\r]/g,se=function(e){var t,n,r,i;if("number"==typeof e){for(t=[],n=0;n<4;n++)W(t,e%256),e=A(e/256);return P(t,".")}if("object"==typeof e){for(t="",r=function(e){for(var t=null,n=1,r=null,i=0,s=0;s<8;s++)0!==e[s]?(i>n&&(t=r,n=i),r=null,i=0):(null===r&&(r=s),++i);return i>n&&(t=r,n=i),t}(e),n=0;n<8;n++)i&&0===e[n]||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=$(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},oe={},ae=m({},oe,{" ":1,'"':1,"<":1,">":1,"`":1}),le=m({},ae,{"#":1,"?":1,"{":1,"}":1}),ce=m({},le,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),de=function(e,t){var n=v(e,0);return n>32&&n<127&&!g(t,e)?e:encodeURIComponent(e)},ue={ftp:21,file:null,http:80,https:443,ws:80,wss:443},he=function(e,t){var n;return 2==e.length&&L(q,O(e,0))&&(":"==(n=O(e,1))||!t&&"|"==n)},ge=function(e){var t;return e.length>1&&he(V(e,0,2))&&(2==e.length||"/"===(t=O(e,2))||"\\"===t||"?"===t||"#"===t)},me=function(e){return"."===e||"%2e"===z(e)},pe={},fe={},ve={},ye={},be={},Ce={},we={},Se={},De={},Ee={},xe={},Re={},Te={},Me={},ke={},Ie={},Ae={},Fe={},Oe={},Le={},Pe={},$e=function(e,t,n){var r,i,s,o=b(e);if(t){if(i=this.parse(o))throw k(i);this.searchParams=null}else{if(void 0!==n&&(r=new $e(n,!0)),i=this.parse(o,null,r))throw k(i);(s=T(new R)).bindURL(this),this.searchParams=s}};$e.prototype={type:"URL",parse:function(e,t,n){var i,s,o,a,l,c=this,d=t||pe,u=0,h="",m=!1,v=!1,y=!1;for(e=b(e),t||(c.scheme="",c.username="",c.password="",c.host=null,c.port=null,c.path=[],c.query=null,c.fragment=null,c.cannotBeABaseURL=!1,e=H(e,re,"")),e=H(e,ie,""),i=p(e);u<=i.length;){switch(s=i[u],d){case pe:if(!s||!L(q,s)){if(t)return U;d=ve;continue}h+=z(s),d=fe;break;case fe:if(s&&(L(K,s)||"+"==s||"-"==s||"."==s))h+=z(s);else{if(":"!=s){if(t)return U;h="",d=ve,u=0;continue}if(t&&(c.isSpecial()!=g(ue,h)||"file"==h&&(c.includesCredentials()||null!==c.port)||"file"==c.scheme&&!c.host))return;if(c.scheme=h,t)return void(c.isSpecial()&&ue[c.scheme]==c.port&&(c.port=null));h="","file"==c.scheme?d=Me:c.isSpecial()&&n&&n.scheme==c.scheme?d=ye:c.isSpecial()?d=Se:"/"==i[u+1]?(d=be,u++):(c.cannotBeABaseURL=!0,N(c.path,""),d=Oe)}break;case ve:if(!n||n.cannotBeABaseURL&&"#"!=s)return U;if(n.cannotBeABaseURL&&"#"==s){c.scheme=n.scheme,c.path=f(n.path),c.query=n.query,c.fragment="",c.cannotBeABaseURL=!0,d=Pe;break}d="file"==n.scheme?Me:Ce;continue;case ye:if("/"!=s||"/"!=i[u+1]){d=Ce;continue}d=De,u++;break;case be:if("/"==s){d=Ee;break}d=Fe;continue;case Ce:if(c.scheme=n.scheme,s==r)c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=f(n.path),c.query=n.query;else if("/"==s||"\\"==s&&c.isSpecial())d=we;else if("?"==s)c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=f(n.path),c.query="",d=Le;else{if("#"!=s){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=f(n.path),c.path.length--,d=Fe;continue}c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=f(n.path),c.query=n.query,c.fragment="",d=Pe}break;case we:if(!c.isSpecial()||"/"!=s&&"\\"!=s){if("/"!=s){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,d=Fe;continue}d=Ee}else d=De;break;case Se:if(d=De,"/"!=s||"/"!=O(h,u+1))continue;u++;break;case De:if("/"!=s&&"\\"!=s){d=Ee;continue}break;case Ee:if("@"==s){m&&(h="%40"+h),m=!0,o=p(h);for(var C=0;C<o.length;C++){var w=o[C];if(":"!=w||y){var S=de(w,ce);y?c.password+=S:c.username+=S}else y=!0}h=""}else if(s==r||"/"==s||"?"==s||"#"==s||"\\"==s&&c.isSpecial()){if(m&&""==h)return"Invalid authority";u-=p(h).length+1,h="",d=xe}else h+=s;break;case xe:case Re:if(t&&"file"==c.scheme){d=Ie;continue}if(":"!=s||v){if(s==r||"/"==s||"?"==s||"#"==s||"\\"==s&&c.isSpecial()){if(c.isSpecial()&&""==h)return Y;if(t&&""==h&&(c.includesCredentials()||null!==c.port))return;if(a=c.parseHost(h))return a;if(h="",d=Ae,t)return;continue}"["==s?v=!0:"]"==s&&(v=!1),h+=s}else{if(""==h)return Y;if(a=c.parseHost(h))return a;if(h="",d=Te,t==Re)return}break;case Te:if(!L(X,s)){if(s==r||"/"==s||"?"==s||"#"==s||"\\"==s&&c.isSpecial()||t){if(""!=h){var D=I(h,10);if(D>65535)return G;c.port=c.isSpecial()&&D===ue[c.scheme]?null:D,h=""}if(t)return;d=Ae;continue}return G}h+=s;break;case Me:if(c.scheme="file","/"==s||"\\"==s)d=ke;else{if(!n||"file"!=n.scheme){d=Fe;continue}if(s==r)c.host=n.host,c.path=f(n.path),c.query=n.query;else if("?"==s)c.host=n.host,c.path=f(n.path),c.query="",d=Le;else{if("#"!=s){ge(P(f(i,u),""))||(c.host=n.host,c.path=f(n.path),c.shortenPath()),d=Fe;continue}c.host=n.host,c.path=f(n.path),c.query=n.query,c.fragment="",d=Pe}}break;case ke:if("/"==s||"\\"==s){d=Ie;break}n&&"file"==n.scheme&&!ge(P(f(i,u),""))&&(he(n.path[0],!0)?N(c.path,n.path[0]):c.host=n.host),d=Fe;continue;case Ie:if(s==r||"/"==s||"\\"==s||"?"==s||"#"==s){if(!t&&he(h))d=Fe;else if(""==h){if(c.host="",t)return;d=Ae}else{if(a=c.parseHost(h))return a;if("localhost"==c.host&&(c.host=""),t)return;h="",d=Ae}continue}h+=s;break;case Ae:if(c.isSpecial()){if(d=Fe,"/"!=s&&"\\"!=s)continue}else if(t||"?"!=s)if(t||"#"!=s){if(s!=r&&(d=Fe,"/"!=s))continue}else c.fragment="",d=Pe;else c.query="",d=Le;break;case Fe:if(s==r||"/"==s||"\\"==s&&c.isSpecial()||!t&&("?"==s||"#"==s)){if(".."===(l=z(l=h))||"%2e."===l||".%2e"===l||"%2e%2e"===l?(c.shortenPath(),"/"==s||"\\"==s&&c.isSpecial()||N(c.path,"")):me(h)?"/"==s||"\\"==s&&c.isSpecial()||N(c.path,""):("file"==c.scheme&&!c.path.length&&he(h)&&(c.host&&(c.host=""),h=O(h,0)+":"),N(c.path,h)),h="","file"==c.scheme&&(s==r||"?"==s||"#"==s))for(;c.path.length>1&&""===c.path[0];)B(c.path);"?"==s?(c.query="",d=Le):"#"==s&&(c.fragment="",d=Pe)}else h+=de(s,le);break;case Oe:"?"==s?(c.query="",d=Le):"#"==s?(c.fragment="",d=Pe):s!=r&&(c.path[0]+=de(s,oe));break;case Le:t||"#"!=s?s!=r&&("'"==s&&c.isSpecial()?c.query+="%27":c.query+="#"==s?"%23":de(s,oe)):(c.fragment="",d=Pe);break;case Pe:s!=r&&(c.fragment+=de(s,ae))}u++}},parseHost:function(e){var t,n,r;if("["==O(e,0)){if("]"!=O(e,e.length-1))return Y;if(t=function(e){var t,n,r,i,s,o,a,l=[0,0,0,0,0,0,0,0],c=0,d=null,u=0,h=function(){return O(e,u)};if(":"==h()){if(":"!=O(e,1))return;u+=2,d=++c}for(;h();){if(8==c)return;if(":"!=h()){for(t=n=0;n<4&&L(ee,h());)t=16*t+I(h(),16),u++,n++;if("."==h()){if(0==n)return;if(u-=n,c>6)return;for(r=0;h();){if(i=null,r>0){if(!("."==h()&&r<4))return;u++}if(!L(X,h()))return;for(;L(X,h());){if(s=I(h(),10),null===i)i=s;else{if(0==i)return;i=10*i+s}if(i>255)return;u++}l[c]=256*l[c]+i,2!=++r&&4!=r||c++}if(4!=r)return;break}if(":"==h()){if(u++,!h())return}else if(h())return;l[c++]=t}else{if(null!==d)return;u++,d=++c}}if(null!==d)for(o=c-d,c=7;0!=c&&o>0;)a=l[c],l[c--]=l[d+o-1],l[d+--o]=a;else if(8!=c)return;return l}(V(e,1,-1)),!t)return Y;this.host=t}else if(this.isSpecial()){if(e=y(e),L(te,e))return Y;if(t=function(e){var t,n,r,i,s,o,a,l=j(e,".");if(l.length&&""==l[l.length-1]&&l.length--,(t=l.length)>4)return e;for(n=[],r=0;r<t;r++){if(""==(i=l[r]))return e;if(s=10,i.length>1&&"0"==O(i,0)&&(s=L(Z,i)?16:8,i=V(i,8==s?1:2)),""===i)o=0;else{if(!L(10==s?Q:8==s?J:ee,i))return e;o=I(i,s)}N(n,o)}for(r=0;r<t;r++)if(o=n[r],r==t-1){if(o>=F(256,5-t))return null}else if(o>255)return null;for(a=_(n),r=0;r<n.length;r++)a+=n[r]*F(256,3-r);return a}(e),null===t)return Y;this.host=t}else{if(L(ne,e))return Y;for(t="",n=p(e),r=0;r<n.length;r++)t+=de(n[r],oe);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"==this.scheme},includesCredentials:function(){return""!=this.username||""!=this.password},isSpecial:function(){return g(ue,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"==this.scheme&&1==t&&he(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,r=e.password,i=e.host,s=e.port,o=e.path,a=e.query,l=e.fragment,c=t+":";return null!==i?(c+="//",e.includesCredentials()&&(c+=n+(r?":"+r:"")+"@"),c+=se(i),null!==s&&(c+=":"+s)):"file"==t&&(c+="//"),c+=e.cannotBeABaseURL?o[0]:o.length?"/"+P(o,"/"):"",null!==a&&(c+="?"+a),null!==l&&(c+="#"+l),c},setHref:function(e){var t=this.parse(e);if(t)throw k(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"==e)try{return new _e(e.path[0]).origin}catch(e){return"null"}return"file"!=e&&this.isSpecial()?e+"://"+se(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(b(e)+":",pe)},getUsername:function(){return this.username},setUsername:function(e){var t=p(b(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=de(t[n],ce)}},getPassword:function(){return this.password},setPassword:function(e){var t=p(b(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=de(t[n],ce)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?se(e):se(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,xe)},getHostname:function(){var e=this.host;return null===e?"":se(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,Re)},getPort:function(){var e=this.port;return null===e?"":b(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""==(e=b(e))?this.port=null:this.parse(e,Te))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+P(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Ae))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""==(e=b(e))?this.query=null:("?"==O(e,0)&&(e=V(e,1)),this.query="",this.parse(e,Le)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!=(e=b(e))?("#"==O(e,0)&&(e=V(e,1)),this.fragment="",this.parse(e,Pe)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var _e=function(e){var t=h(this,Ne),n=w(arguments.length,1)>1?arguments[1]:void 0,r=E(t,new $e(e,!1,n));s||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},Ne=_e.prototype,He=function(e,t){return{get:function(){return x(this)[e]()},set:t&&function(e){return x(this)[t](e)},configurable:!0,enumerable:!0}};if(s&&(u(Ne,"href",He("serialize","setHref")),u(Ne,"origin",He("getOrigin")),u(Ne,"protocol",He("getProtocol","setProtocol")),u(Ne,"username",He("getUsername","setUsername")),u(Ne,"password",He("getPassword","setPassword")),u(Ne,"host",He("getHost","setHost")),u(Ne,"hostname",He("getHostname","setHostname")),u(Ne,"port",He("getPort","setPort")),u(Ne,"pathname",He("getPathname","setPathname")),u(Ne,"search",He("getSearch","setSearch")),u(Ne,"searchParams",He("getSearchParams")),u(Ne,"hash",He("getHash","setHash"))),d(Ne,"toJSON",(function(){return x(this).serialize()}),{enumerable:!0}),d(Ne,"toString",(function(){return x(this).serialize()}),{enumerable:!0}),M){var Be=M.createObjectURL,je=M.revokeObjectURL;Be&&d(_e,"createObjectURL",l(Be,M)),je&&d(_e,"revokeObjectURL",l(je,M))}C(_e,"URL"),i({global:!0,constructor:!0,forced:!o,sham:!s},{URL:_e})},60285:function(e,t,n){n(68789)},83753:function(e,t,n){"use strict";var r=n(82109),i=n(46916);r({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return i(URL.prototype.toString,this)}})},28594:function(e,t,n){n(82526),n(41817),n(72443),n(92401),n(8722),n(32165),n(69007),n(16066),n(83510),n(41840),n(6982),n(32159),n(96649),n(39341),n(60543),n(21703),n(96647),n(9170),n(32120),n(52262),n(92222),n(50545),n(26541),n(43290),n(57327),n(69826),n(34553),n(67635),n(77287),n(84944),n(86535),n(89554),n(91038),n(26699),n(82772),n(79753),n(66992),n(69600),n(94986),n(21249),n(26572),n(57658),n(85827),n(96644),n(65069),n(47042),n(5212),n(2707),n(38706),n(40561),n(33792),n(99244),n(30541),n(18264),n(76938),n(39575),n(16716),n(43016),n(3843),n(81801),n(9550),n(28733),n(5735),n(96078),n(83710),n(62130),n(24812),n(4855),n(68309),n(35837),n(38862),n(73706),n(51532),n(99752),n(82376),n(73181),n(23484),n(2388),n(88621),n(60403),n(84755),n(25438),n(90332),n(40658),n(40197),n(44914),n(52420),n(60160),n(60970),n(10408),n(73689),n(9653),n(93299),n(35192),n(33161),n(44048),n(78285),n(44363),n(55994),n(61874),n(9494),n(31354),n(56977),n(55147),n(19601),n(78011),n(59595),n(33321),n(69070),n(35500),n(69720),n(43371),n(38559),n(38880),n(49337),n(36210),n(30489),n(46314),n(43304),n(41825),n(98410),n(72200),n(47941),n(94869),n(33952),n(57227),n(67987),n(60514),n(68304),n(41539),n(26833),n(54678),n(91058),n(88674),n(17922),n(34668),n(17727),n(36535),n(12419),n(69596),n(52586),n(74819),n(95683),n(39361),n(51037),n(5898),n(67556),n(14361),n(83593),n(39532),n(81299),n(24603),n(28450),n(74916),n(92087),n(88386),n(77601),n(39714),n(70189),n(24506),n(79841),n(27852),n(94953),n(32023),n(78783),n(4723),n(76373),n(66528),n(83112),n(38992),n(82481),n(15306),n(68757),n(64765),n(23123),n(23157),n(83650),n(73210),n(48702),n(55674),n(15218),n(74475),n(57929),n(50915),n(29253),n(42125),n(78830),n(58734),n(29254),n(37268),n(7397),n(60086),n(80623),n(44197),n(76495),n(87145),n(35109),n(65125),n(82472),n(49743),n(8255),n(29135),n(48675),n(92990),n(18927),n(33105),n(35035),n(74345),n(7174),n(63408),n(14590),n(32846),n(98145),n(44731),n(77209),n(96319),n(58867),n(37789),n(33739),n(95206),n(29368),n(14483),n(12056),n(3462),n(30678),n(27462),n(33824),n(55021),n(12974),n(15016),n(78221),n(4129),n(38478),n(75505),n(27479),n(54747),n(33948),n(87714),n(82801),n(1174),n(84633),n(85844),n(71550),n(61295),n(32564),n(60285),n(83753),n(41637),n(40857)}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(28594);var r=n(34835);BryntumLib=r}();